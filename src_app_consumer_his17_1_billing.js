var app;function rateChangeController(e,t,a,i,r,n,l,s,o,c){var d=this;i.loadModule("billing");var p=l.getLanguageToSet();i.changeLanguage(p),d.serviceItmsWiseGridData=angular.copy(a),e.serviceWiseGridColDef(d.serviceItmsWiseGridData),d.serviceItmsWiseGridData.data=[],d.serviceItmsWiseGridData.onRegisterApi=function(e){d.gridApiItem=e},d.closePopUp=function(){o.dismiss("cancel")},d.updateRates=function(){let e=r.createSaveObjForServiceWise(d.serviceItmsWiseGridData.data,c[1],!0,void 0);n.saveTariffForServiceWise(e,c[2]).then(function(e){o.close(d.serviceItmsWiseGridData.data)})},s.fieldValidation=function(e,t,a,i,r){i<=a&&(1==r?e.entity.MIN_VALUE=i:e.entity.FUTURE_MIN_VALUE=i),i>=t&&(1==r?e.entity.MAX_VALUE=i:e.entity.FUTURE_MAX_VALUE=i)},trf=c[2],t.getTariffDataServiceWise(c[1],trf,!0,d,c[0])}rateChangeController.$inject=["newTariffRateServiceGrid","GetGridDataService","newTariffRateGridConstant","hisTranslationsService","SaveObjPreServiceTariff","saveCallServiceTariff","hisTranslationsGlobalLang","$scope","$uibModalInstance","items"],function(){"use strict";angular.module("napierContainerUi").constant("BILLING_APIS",{HISAMBULANCEMAINTAINANCESERVICES:{URL:"HISServices/AmbulanceMaintenanceService",METHOD:"POST"},HISCOMBOFILLING:{URL:"HISServices/QueryService",METHOD:"POST"},HISPAYERSERVICE:{URL:"HISServices/PayerDetailsService",METHOD:"POST"},HISSCMSERVICE:{URL:"HISServices/ScmMasterService",METHOD:"POST"},HISPACKSERVICE:{URL:"HISServices/PackageMasterService",METHOD:"POST"},HISPLANSERVICEINCEXC:{URL:"HISServices/InsuranceCompanyMasterService",METHOD:"POST"},HISBANNERSERVICE:{URL:"HISServices/PatientBannerService",METHOD:"POST"},HISRATECARDSERVICE:{URL:"HISServices/RateCardService",METHOD:"POST"},HISBASERATESERVICE:{URL:"HISServices/RateCardService",METHOD:"POST"},HISDEPOSITSEARCH:{URL:"HISServices/HITService",METHOD:"POST"},HISDEPOSITHITSERVICE:{URL:"HISServices/HITService",METHOD:"POST"},HISDEPOSITSERVICEEDIT:{URL:"HISServices/HITService",METHOD:"POST"},HISDEPOSITSERVICEGRIDACTIVE:{URL:"HISServices/HITService",METHOD:"POST"},HISAPPWORKREQFORCOMBO:{URL:"HISServices/HITService",METHOD:"POST"},HISAPPWORKSTATUSCOMBO:{URL:"HISServices/HITService",METHOD:"POST"},HISCONSESSIONSERVICEDETAILS:{URL:"HISServices/HITService",METHOD:"POST"},HISCONSESSIONTYPECOMBO:{URL:"HISServices/HITService",METHOD:"POST"},HISCONBILLWISESAVE:{URL:"HISServices/HITService",METHOD:"POST"},HISCONCESSIONREQUESTCOMBO:{URL:"HISServices/HITService",METHOD:"POST"},HISCONSERVICEWISESAVE:{URL:"HISServices/HITService",METHOD:"POST"},HISCONCESSIONDETAILSCHECK:{URL:"HISServices/HITService",METHOD:"POST"},HISCONSESSIONUPLOADFILES:{URL:"HISServices/HITService",METHOD:"POST"},HISGETTRANSACTIONSUMMARY:{URL:"HISServices/HITService",METHOD:"POST"},HISCOLLSUMCASHHANDOVERCOMBO:{URL:"HISServices/HITService",METHOD:"POST"},HISCOLLSUMCASHIERCOMBO:{URL:"HISServices/HITService",METHOD:"POST"},HISSUMMARYGRIDLIST:{URL:"HISServices/HITService",METHOD:"POST"},HISGETTRANSACTIONSUMMARYLIST:{URL:"HISServices/HITService",METHOD:"POST"},HISIPINDENT:{URL:"HISServices/HITService",METHOD:"POST"},HISTARIFFPRIORITYSAVE:{URL:"HISServices/HITService",METHOD:"POST"},HSC_AGENT_MASTER_DETAILS:{URL:"HISServices/HITService",METHOD:"POST"}})}(),function(){"use strict";function e(e,t){e.state("index.billingSub",{url:"/billingSub",views:{main:{controller:"PreUserManagementController",templateUrl:"app/consumer/his17_1/customDirectives/patientSearch/subMenu.html"}}}).state("index.billingSub.EstimateBill",{url:"/EstimateBill/:id",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/estimateBill/estimatebill.list.screen.html",controller:"estimateBillList"}}}).state("index.billingSub.EstimateBillNew",{url:"/EstimateBillNew/:id",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/estimateBill/estimateBill.new.screen.html",controller:"BillingEstimateController",controllerAs:"etb"}}}).state("index.billingSub.EstimateBillClone",{url:"/EstimateBillClone/:id",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/estimateBill/clone-estimateBill/estimateBillClone.screen.html",controller:"estimateCloneCtrl"}}}).state("index.billingSub.EstimateBillGenPreAuth",{url:"/EstimateBillGenPreAuth/:id",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/estimateBill/generate_pre_auth_from_estimate/generate_pre_auth.screen.html",controller:"GenPreAuthEstimateCtrl",controllerAs:"billEst"}}}).state("index.billingSub.preAuthList",{url:"/preAuthList/:id",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_list_screen/pre_auth_list.screen.html",controller:"preAuthListController"}}}).state("index.billingSub.preAuthNew",{url:"/preAuthNew",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_new_screen/pre_auth_new_registered.screen.html",controller:"PreAutoNewRegController",controllerAs:"preNew"}}}).state("index.billingSub.preAuthUpdate",{url:"/preAuthUpdate/:id",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_update_screen/pre_auth_update.screen.html",controller:"preAuthUpdateCtrl",controllerAs:"preUp"}}}).state("index.billingSub.preAuthView",{url:"/preAuthView/:id",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_view_screen/pre_auth_view.screen.html",controller:"preAuthViewCtrl",controllerAs:"viewPre"}}}).state("index.billingSub.preAuthApprovalDtls",{url:"/preAuthApprovalDtls/:id",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_approvalDtls_screen/pre_auth_approvalDtls.screen.html",controller:"preAuthApprovalDtlsCtrl",controllerAs:"preAppEn"}}}).state("index.billingSub.preAuthLimitEnh",{url:"/preAuthLimitEnh/:id",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_enhancement_screen/pre_auth_limitEnh.screen.html",controller:"preAuthLimitEnhCtrl",controllerAs:"limEnh"}}}).state("index.billingSub.servicePosting",{url:"/servicePosting/:patObj/:visitType",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/service_posting/service_posting.html",controller:"servicePostingController",controllerAs:"svp"}}}).state("index.billingSub.servicePostingNew",{url:"/servicePostingNew/:patObj/:gridObj",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/service_posting/service-posting-New/service.posting.new.html",controller:"servicePostingNewController",controllerAs:"svpN"}}}).state("index.billingSub.serviceBillPosting",{url:"/serviceBillPosting/:allObj/:gridObj/:visitType",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/service_posting/service-bill-posting/bill_posting.html",controller:"billPostingController",controllerAs:"bilP"}}}).state("index.billingSub.servicePostingCancel",{url:"/servicePostingCancel/:patObj/:gridObj/:flag/:flag1/:visitType",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/service_posting/service-posting-Cancel/service.posting.cancel.html",controller:"servicePostingCnclCtrl",controllerAs:"svpC"}}}).state("index.billingSub.servicePostingPackageCancel",{url:"/servicePostingPackageCancel/:patObj/:gridObj/:visitType",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/service_posting/CancelPackage/service.posting.package.cancel.html",controller:"servicePostingPackageCnclCtrl",controllerAs:"svppC"}}}).state("index.billingSub.servicePostSheet",{url:"/servicePostSheet/:patObj/:gridObj/:visitType/:folio/:folioList/:allObj",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/service_posting/service-post-sheet/service.post.sheet.html",controller:"servicePostSheetCtrl",controllerAs:"pSheet"}}}).state("index.billingSub.packageAssignment",{url:"/packageAssignment",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/package-assignment/package_assignment.screen.html",controller:"packageAssignment"}}}).state("index.billingSub.packageAssignmentNew",{url:"/packageAssignmentNew",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/packageAssignment/package.assignment.screen.html",controller:"packageAssignmentController"}}}).state("index.billingSub.billingDischarges",{url:"/billingDischarges",views:{sub:{templateUrl:"app/consumer/his17_1/common/NursingStation/screens/dischargeList/view/DischargeScreenList.html",controller:"nsDischargeListController"}}}).state("index.billingSub.billingDischargeInitmationTemplateView",{url:"/billingDischargeInitmationTemplateView",views:{sub:{templateUrl:"app/consumer/his17_1/common/NursingStation/screens/dischargeList/view/DischargeIntimationTemplate.html",controller:"dischargeIntimationCtrl",name:"Billing Discharge Intimation"}}}).state("index.billingSub.BillingWorkList",{url:"/BillingWorkList",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/billingWorkList/billing_work_list.html",controller:"billWorkListCtrl"}}}).state("index.billingSub.patientBilling",{url:"/patientBilling",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/patientBilling/patient.billing.screen.html",controller:"patientBillingCtrl",controllerAs:"pbc"}}}).state("index.billingSub.patientBilling.patientBillingDischargeInitmationTemplateView",{url:"/patientBillingDischargeInitmationTemplateView",views:{includeView:{templateUrl:"app/consumer/his17_1/common/NursingStation/screens/dischargeList/view/DischargeIntimationTemplate.html",controller:"dischargeIntimationCtrl",name:"Billing Discharge Intimation"}}}).state("index.billingSub.patientBilling.patientBillingPaymentTabView",{url:"/patientBillingPaymentTabView/:billObj",views:{includeView:{templateUrl:"app/consumer/his17_1/billing/screens/patientBilling/patient.billing.payment_deposit_credit_refund.screen.html",controller:"angPaymentController",controllerAs:"payment"}}}).state("index.billingSub.patientBilling.patientBillingPreAuthTabView",{url:"/patientBillingPreAuthTabView/:valueObj",views:{includeView:{templateUrl:"app/consumer/his17_1/billing/screens/patientBilling/patient.billing.pre_auth.screen.html",controller:"PreAutoNewRegController",controllerAs:"preNew"}}}).state("index.billingSub.patientBilling.patientBillingDiscount",{url:"/patientBillingDiscount/:valueObj/:billSeqID",views:{includeView:{templateUrl:"app/consumer/his17_1/billing/screens/patientBilling/patientDiscountBill.html",controller:"patientBillingDiscount",controllerAs:"pbd"}}}).state("index.billingSub.angularbillappwrklist",{url:"/angularbillappwrklist",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/approval-worklist/approval.worklist.html",controller:"angapprovalWorklistController",controllerAs:"awl"}}}).state("index.billingSub.payment",{url:"/payment/:billObj",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/payment/payment.html",controller:"angPaymentController",controllerAs:"payment"}}}).state("index.billingSub.coveringLetterGeneration",{url:"/coveringLetterGeneration",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/coveringLetterGeneration/covering.letter.html",controller:"coveringLetterGenController",controllerAs:"clg"}}}).state("index.billingSub.creditLettersTracking",{url:"/creditLettersTracking",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/creditLettersTracking/credit.letters.tracking.html",controller:"creditLettersTrackingCtrl",controllerAs:"clt"}}}).state("index.billingSub.invoiceCompanySettlement",{url:"/invoiceCompanySettlement",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/companySettlements/company.settlements.html",controller:"invoiceCompanySettlement",controllerAs:"ics"}}}).state("index.billingSub.agentCommission",{url:"/agentCommission",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/AgentComission/agent.commission.screen.html",controller:"AgentCommissionController",controllerAs:"aCC"}}}).state("index.billingSub.agentCommissionNewUpdate",{url:"/agentCommissionNewUpdate/:action/:data",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/AgentComission/partials/agent.commission.screenNewUpdate.html",controller:"AgentCommissionNewUpdateController",controllerAs:"aCNU"}}}).state("index.billingSub.depositRequests",{url:"/depositRequests",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/depositRequests/deposit.request.screen.html",controller:"depositRequestsController",controllerAs:"deptReq"}}}).state("index.billingSub.demandNote",{url:"/demandNote",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/demandNote/demand.note.screen.html",controller:"demandNoteCntr",controllerAs:"demNote"}}}).state("index.billingSub.invoiceList",{url:"/invoiceList",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/InvoiceList/invoicelist.html",controller:"invoiceListCtrl",controllerAs:"invoiceList"}}}).state("index.billingSub.mergebills",{url:"/mergebills",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/mergeBills/merge.bills.html",controller:"billinMergeBillCtrl",controllerAs:"mergeBill"}}}).state("index.billingSub.refundWorklist",{url:"/refundWorklist",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/depostRefundWorklist/refund.worklist.screen.html",controller:"refundWorklistCntrl",controllerAs:"refundCtrl"}}}).state("index.billingSub.changeCategory",{url:"/changeCategory",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/changeCategory/change.category.screen.html",controller:"changeCategoryCtrl",controllerAs:"cc"}}}).state("index.billingSub.billingConversion",{url:"/billingConversion",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/billingConversion/billing.conversion.screen.html",controller:"billingConversionCtrl",controllerAs:"bc"}}}).state("index.billingSub.billingReports",{url:"/billingReports",views:{sub:{templateUrl:"app/consumer/his17_1/report-builder/report-render-index.html"}}}).state("index.scrollSub.collectionSummary",{url:"/collectionSummary",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/collection-summary/collection.summary.html",controller:"angCollectionSummaryController",controllerAs:"csc"}}}).state("index.scrollSub.tranSummaryList",{url:"/tranSummaryList",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/summary-list/summary.list.html",controller:"angTranSummaryListController",controllerAs:"tsl"}}}).state("index.billingSub.onAccountDeposit",{url:"/onAccountDeposit",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/onAccountDeposit/onAccDeposit.html",controller:"onAccountDepositsController"}}}).state("index.billingSub.onAccountDepositRefund",{url:"/onAccountDepositRefund",views:{sub:{templateUrl:"app/consumer/his17_1/billing/screens/onAccountDepositRefund/onAccountDepositRefund.html",controller:"onAccountDepositRefundController"}}}).state("billingpayerdetails",{url:"/billingpayerdetails",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/payer-details/payer.details.screen.html",controller:"BillingPayerDetailsController"}}}).state("payer",{url:"/payer",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/payer/payer.screen.html",controller:"BillingPayerController"}}}).state("oppackage",{url:"/oppackage",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/op-package-creation/op-package.screen.html",controller:"opPackageController"}}}).state("packageSearch",{url:"/packageSearch",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/packageSearch/packageSearch.screen.html",controller:"packageSearchController",controllerAs:"packser"}}}).state("serviceMaster",{url:"/serviceMaster",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/serviceMastersNew/service.masters.screen.html",controller:"serMasterCntrl",controllerAs:"servm"}}}).state("creditPay",{url:"/creditPay/:id",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/corporate/corporate.html",controller:"BillingCorporateController"}}}).state("tariffClass",{url:"/tariffClass",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/tariffClass/tariffClass.screen.html",controller:"tariffClassController",controllerAs:"tc"}}}).state("tariffRates",{url:"/tariffRates",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/tariffRates/tariffRates.screen.html",controller:"tariffRatesController",controllerAs:"tr"}}}).state("addInsurancePlan",{url:"/addInsurancePlan",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/corporate/insurance.screen.html",controller:"BillingAddInsuranceController",controllerAs:"vm"}}}).state("inner.billingpayerdetails2",{url:"/billingpayerdetails2",views:{header:{template:"<container-header></container-header>"},sidebar:{template:"<container-sidebar></container-sidebar>"},content:{template:"<container-content></container-content>"}}}).state("tariffCategory",{url:"/tariffCategory",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/tariffCategory/tariffCategory.screen.html",controller:"BillingBaseRateTariffCategoryController",controllerAs:"tCat"}}}).state("baseRates",{url:"/baseRates",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/BaseRates/baserates.screen.html",controller:"BillingBaseRatesController"}}}).state("DepositMasters",{url:"/DepositMasters",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/deposit-masters/deposit.masters.html",controller:"angdepositMastersController",controllerAs:"depositMasters"}}}).state("TaxMasters",{url:"/TaxMasters",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/tax-masters/tax.masters.html",controller:"angTaxMastersController",controllerAs:"taxMasters"}}}).state("tempBillWorklist",{url:"/tempBillWorklist",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/tempBillWorklist/tempBillWorklist.html",controller:"tempBillWorklistController",controllerAs:"bwl"}}}).state("angularmergebill",{url:"/angularmergebill",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/merge-bill/merge.bill.html",controller:"mergeBillController",controllerAs:"mergeBill"}}}).state("payerRank",{url:"/payerRank",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/payer-rank/payer.rank.list/payer.rank.html",controller:"payerRankListController",controllerAs:"payerRankList"}}}).state("payerRankUpdate",{url:"/payerRankUpdate/:object/:payerData",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/payer-rank/payer.rank.assignment.update/payer.rank.update.html",controller:"payerRankAssignmentUpdateController",controllerAs:"payerRankAssignmentUpdate"}}}).state("payerRankNew",{url:"/payerRankNew/:object",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/payer-rank/payer.rank.assignment.new/payer.rank.assignment.new.html",controller:"payerRankNewController",controllerAs:"payerRankAssignmentNew"}}}).state("payerRankAssignment",{url:"/payerRankAssignment",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/payer-rank/payer.rank.assignment/payer.rank.assignment.html",controller:"payerRankAssignmentController",controllerAs:"payerRankAssignment"}}}).state("payerRankView",{url:"/payerRankView/:object/:payerData",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/payer-rank/payer.rank.view/payer.rank.view.html",controller:"payerRankViewController",controllerAs:"payerRankView"}}}).state("insuranceSponsorDetails",{url:"/insuranceSponsorDetails",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/corporate/insurance-sponsor-details/insurance.sponsor.details.html",controller:"insuranceSponsorController",controllerAs:"insuranceSponsor"}}}).state("newbillingconfiguration",{url:"/newbillingconfiguration",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/billing-configuration/billing.config.html",controller:"billingConfigController",controllerAs:"billingConfig"}}}).state("insuranceSponsorPlans",{url:"/insuranceSponsorPlans",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/corporate/sponsor-plans/insurance.sponsor.plans.html",controller:"insuranceSponsorPlansController",controllerAs:"sponsorPlan"}}}).state("splitBill",{url:"/splitBill/:selectBill",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/billingWorkList/split-bill/split.bill.html",controller:"splitBillController",controllerAs:"splitBill"}}}).state("AngCollectionSummary",{url:"/AngCollectionSummary",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/collection-summary/collection.summary.html",controller:"angCollectionSummaryController",controllerAs:"csc"}}}).state("AngTranSummaryList",{url:"/AngTranSummaryList",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/summary-list/summary.list.html",controller:"angTranSummaryListController",controllerAs:"tsl"}}}).state("facilityServiceMapping",{url:"/facilityServiceMapping",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/service-masters/facility.service.mapping.html",controller:"FacilityServiceMappingController",controllerAs:"fm"}}}).state("hscbillListing",{url:"/hscbillListing",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/reports/bill.listing.reports.html",controller:"billListingPrintController",controllerAs:"billLists"}}}).state("hscbillListingOutstanding",{url:"/hscbillListingOutstanding",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/reports/bill-Listing-Outstanding-Reports.html",controller:"billListingPrintController",controllerAs:"billLists"}}}).state("hscbillListingCancelled",{url:"/hscbillListingCancelled",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/reports/bill-Listing-Cancelled-Reports.html",controller:"billListingPrintController",controllerAs:"billLists"}}}).state("hscbillListingPaid",{url:"/hscbillListingPaid",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/reports/bill-Listing-PaidBills-Reports.html",controller:"billListingPrintController",controllerAs:"billLists"}}}).state("agentReportDetails",{url:"/agentReportDetails",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/agentMasterReport/agentReportDetails.html",controller:"agentReportDetailsController"}}}).state("hscLabCostAnalysis",{url:"/hscLabCostAnalysis",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/labCostAnalysis/labCostAnalysis-screen.html",controller:"labCostAnalysisPrintController",controllerAs:"labcost"}}}).state("cashDrawingListing",{url:"/cashDrawingListing",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/reports/cashier-drawer-listing.html",controller:"cashierDrawerkLisitngCtlr",controllerAs:"cashierCtrl"}}}).state("hscCashDrawerDepartment",{url:"/hscCashDrawerDepartment",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/reports/cashier-drawer-listing-department.html",controller:"cashDrawerDepartmentCtrl",controllerAs:"cashCtrlDept"}}}).state("billingConfiguration",{url:"/billingConfiguration",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/billing-configuration/sections/ot.config.html",controller:"otConfigCtrl",controllerAs:"otcc"}}}).state("dependency",{url:"/dependency",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/dependency/dependency.html",controller:"dependencyController",controllerAs:"dep"}}}).state("ageWiseBilledCollective",{url:"/ageWiseBilledCollective",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/billingWorkList/screens/age_wise_bill_report.html",controller:"ageWiseBilledController",controllerAs:"ageWise"}}}).state("schemeProfile",{url:"/schemeProfile",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/SchemeProfile/screens/scheme_profile_list.html",controller:"schemeProfileController"}}}).state("newTariffRates",{url:"/newTariffRates",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/newTariffRates/newTariffRates.screen.html",controller:"newTariffRatesController",controllerAs:"trf"}}}).state("schemeRegistration",{url:"/schemeRegistration",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/SchemeProfile/screens/scheme_registration_form.html",controller:"schemeRegistrationController"}}}).state("healthCheckPackage",{url:"/healthCheckPackage/:actionName/:PackData",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/healthCheckPackage/partials/healthCheckPackage.html",controller:"healthCheckPackageController"}}}).state("claimsDenialSummaryReport",{url:"/claimsDenialSummaryReport",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/claimsDenialSummaryReport/claimsDenialSummaryReport.html",controller:"ClaimsDenialSummaryReportController",controllerAs:"cr"}}}).state("healthCheckPackageMaster",{url:"/healthCheckPackageMaster",views:{inner:{templateUrl:"app/consumer/his17_1/billing/screens/healthCheckPackageMaster/partials/healthCheckPackageMaster.html",controller:"healthCheckPackageMasterController"}}}).state("index.scrollSub",{url:"/scrollSub",views:{main:{controller:"PreUserManagementController",templateUrl:"app/consumer/his17_1/customDirectives/patientSearch/subMenu.html"}}})}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("napierContainerUi").config(e)}(),function(){"use strict";function e(e,t,a,i){a.translations("en",i.EN),a.preferredLanguage("en")}e.$inject=["$logProvider","toastrConfig","$translateProvider","I18N"],angular.module("napierContainerUi").config(e)}(),function(){"use strict";function e(e,t,a,i,r,n,l){var s=this;a.loadModule("billing");var o=i.getLanguageToSet();a.changeLanguage(o),s.data={},s.rowList=[],s.validateSuccessFlag=!1,s.validateFlag=!1,e.agentCommissionModalGridData=angular.copy(n),s.getTableHeight=function(){var t;return e.agentCommissionModalGridData.data.length>=10?(t=400,t+="px"):0==e.agentCommissionModalGridData.data.length?t="200px !important":(t=30*e.agentCommissionModalGridData.data.length+30+70,t+="px"),{height:t}},e.bigTotalItems=0;var c={pageNumber:1,pageSize:8,sort:null};e.agentCommissionModalGridData.onRegisterApi=function(t){e.agentCommissionModalGridDataApi=t,t.pagination.on.paginationChanged(e,function(e,t){c.pageNumber=e,c.pageSize=t})},s.clearAll=function(){e.agentCommissionModalGridData.data=[],s.data=[],s.data.agentCode=""},s.agentName=[],s.agentComboInputs={pPracticeId:JSON.parse(sessionStorage.userContextObj).CLIENT_REF_ID,pFacilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID},r.loadCombos("REF_MAST_AGENT_COMBO",s.agentComboInputs).then(function(e){s.agentName=e[1]}),s.roleValue=r.loadRoleTaskService("T_BL_AGENT_COMMISSION"),s.loadDailypatGrid=function(){if(e.loading=!0,e.agentCommissionModalGridData.data=[],null==s.data.agentName||null==s.data.agentName.REFERRAL_AGENT_CODE)l.information("alert","Please enter Agent Name");else{var t={pAgentCode:s.data.agentName.REFERRAL_AGENT_CODE,pAgentName:s.data.agentName.REFERRAL_AGENT_NAME};r.loadCombos("AGENT_WORK_FLOW_SEARCH",t).then(function(t){e.agentCommissionModalGridData.data=t[1],e.loading=!1})}},s.selectAgent=function(e,t,a,i){s.data.agentCode=e.REFERRAL_AGENT_CODE},s.selectAgentPatient=function(){1==e.agentCommissionModalGridDataApi.selection.getSelectedCount()?t.close(e.agentCommissionModalGridDataApi.selection.getSelectedRows()[0]):l.information("alert","Please select one agent record")}}e.$inject=["$scope","$uibModalInstance","hisTranslationsService","hisTranslationsGlobalLang","adtDailyReportComboQueryservice","agentCommissionModalGrid","hisAlertService"],angular.module("napierContainerUi").controller("AgentCommissionModalController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o){var c=this;a.loadModule("billing");var d=i.getLanguageToSet();a.changeLanguage(d),c.data={},c.rowList=[],c.validateSuccessFlag=!1,c.validateFlag=!1,c.reqFields={color:"red"},c.data.status=-999,e.agentCommissionGridData=angular.copy(l),c.fromdate=new Date,c.toDate=new Date,c.fromDateOptions={format:"DD-MM-YYYY"},c.toDateOptions={format:"DD-MM-YYYY"},c.fromDateOptions.maxDate=new Date,c.toDateOptions.maxDate=new Date,c.changeFromDate=function(e){null!=e&&(c.toDateOptions.minDate=new Date(e)),null==c.fromdate?c.fmReqDate=!0:c.fmReqDate=!1},c.changeToDate=function(e){null==c.toDate?c.toReqDate=!0:c.toReqDate=!1},c.hscAgentRemove=function(){c.data.agentCode=""},c.agentStatus=[{code:-999,Desc:"Both"},{code:0,Desc:"Pending"},{code:1,Desc:"Account Processed"}],c.getTableHeight=function(){var t;return e.agentCommissionGridData.data.length>=10?(t=400,t+="px"):0==e.agentCommissionGridData.data.length?t="200px !important":(t=30*e.agentCommissionGridData.data.length+30+70,t+="px"),{height:t}},e.bigTotalItems=0;var p={pageNumber:1,pageSize:8,sort:null};e.agentCommissionGridData.onRegisterApi=function(t){t.pagination.on.paginationChanged(e,function(e,t){p.pageNumber=e,p.pageSize=t})},c.clearAll=function(){e.agentCommissionGridData.data=[],c.fromDateOptions.maxDate=new Date,c.toDateOptions.maxDate=new Date;var t=new Date;t.setSeconds(t.getSeconds()-1e3),c.fromdate=new Date(t),c.toDate=new Date(t),c.data=[],c.data.agentCode="",c.data.status=-999},e.OPVMsearchBypatientSearch=function(t){var a=t;e.OPVMsearchBypatientName=[],e.multipleComboDataForList={1:e.OPVMsearchBypatientName};var i=r.executeQueryURLReset();return e.OPVMsearchBypatientNameList=new Array,r.prepareParamListWithParam("pMRNo","",e.OPVMsearchBypatientNameList),r.prepareParamListWithParam("pName",a,e.OPVMsearchBypatientNameList),r.executeQueryInput("PATIENT_SEARCH_QUERY",e.OPVMsearchBypatientNameList,e.multipleComboDataForList,!0,!0,i,"popUp",{}).then(function(t){if(0!==t)return(t[1]instanceof Array?t[1]:[t[1]]).map(function(e){return e});e.noResults=!0})},c.doctors=[],c.agentName=[],c.speCombo={pSpecializationId:-999,pPracticeId:JSON.parse(sessionStorage.userContextObj).CLIENT_REF_ID,pDoctorId:"",pDoctorName:""},n.loadCombos("OP_DOCTOR_ADVANCE_SEARCH",c.speCombo).then(function(e){c.doctors=e[1]}),c.agentComboInputs={pPracticeId:JSON.parse(sessionStorage.userContextObj).CLIENT_REF_ID,pFacilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID},n.loadCombos("REF_MAST_AGENT_COMBO",c.agentComboInputs).then(function(e){c.agentName=e[1]}),c.checkValidation=function(){return null==c.fromdate?c.fmReqDate=!0:c.fmReqDate=!1,null==c.toDate?c.toReqDate=!0:c.toReqDate=!1,null!=c.fromdate&&null!=c.toDate?c.validateFlag=!0:c.validateFlag=!1,c.validateFlag},c.roleValue=n.loadRoleTaskService("T_BL_AGENT_COMMISSION"),c.agentGrid=function(){if(e.loading=!0,e.agentCommissionGridData.data=[],c.validateSuccessFlag=c.checkValidation(),c.validateSuccessFlag){var t=null,a=null;null!=c.data.agentName?(t=c.data.agentName.REFERRAL_AGENT_CODE,a=c.data.agentName.REFERRAL_AGENT_NAME):(t="",a="");var i={pFromDate:moment(new Date(c.fromdate._d)).format("YYYY-MM-DD")+" 00:00:00",pToDate:moment(new Date(c.toDate._d)).format("YYYY-MM-DD")+" 23:59:59",pAgentCode:t,pAgentName:a,pPatName:c.data.pPatName?"%"+c.data.pPatName.NAME+"%":"",pAcctStatus:c.data.status};n.loadCombos("AGENT_BILL_SERVICE_LIST",i).then(function(t){for(var a=0;a<t[1].length;a++)t[1][a].slno=a+1,0==t[1][a].ACCOUNT_PROCESS_STATUS&&(t[1][a].aCPrcStatus="Pending"),1==t[1][a].ACCOUNT_PROCESS_STATUS&&(t[1][a].aCPrcStatus="Account Processed");e.agentCommissionGridData.data=t[1],e.bigTotalItems=10*Math.ceil(t[1].length/e.agentCommissionGridData.paginationPageSize),e.loading=!1})}},c.newAgentComission=function(e){t.go("index.billingSub.agentCommissionNewUpdate",{action:"new"})},e.editAgentComm=function(e,a,i,r){if("Account Processed"==e.entity.aCPrcStatus)s.information("Information","Account Processed for this bill");else{var n=angular.toJson(e.entity);t.go("index.billingSub.agentCommissionNewUpdate",{action:"update",data:n})}},e.viewAgentComm=function(e,a,i,r){var n=angular.toJson(e.entity);t.go("index.billingSub.agentCommissionNewUpdate",{action:"view",data:n})},c.selectAgent=function(e,t,a,i){c.data.agentCode=e.REFERRAL_AGENT_CODE},e.printAgentComm=function(e,t,a,i){var r=angular.copy(e.entity),n={pBillNo:r.BILL_NO,pAgentSeqId:r.REFERRAL_AGENT_SEQ_ID,pAgentName:r.REFERRAL_AGENT_NAME,pPatName:r.PAT_NAME,pAgentCode:r.REFERRAL_AGENT_CODE,pPatMrNo:r.MR_NO,pPatVisitAdmNo:r.VISIT_NO,pPatBillNo:r.BILL_NO,pPatVisitAdmDate:new Date(r.VISIT_ADM_DATE).toISOString().slice(0,10)+" 00:00:00",pAgentFormDate:"",pTotalBillAmt:r.BILL_AMT,pTotalEligibleAmt:"",pTotalAgentAmt:""};o.printReportModal("printAgentPDFCtrl","lg","PDF",n)}}e.$inject=["$scope","$state","hisTranslationsService","hisTranslationsGlobalLang","QueryService","adtDailyReportComboQueryservice","agentCommissionGrid","hisAlertService","PrintService"],angular.module("napierContainerUi").controller("AgentCommissionController",e).directive("loading",function(){return{restrict:"A",replace:!0,link:function(e,t,a){var i=angular.element(document.getElementById("overlay"));e.$watch("loading",function(e){e?($(t).show(),i.show()):($(t).hide(),i.hide())})}}})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m){var g=this;g.data={},n.loadModule("billing");var S=l.getLanguageToSet();n.changeLanguage(S),e.agentCommissionSeviceSelectGridData=angular.copy(c),e.agentCommissionServiceCalculationGridData=angular.copy(d),e.deletedRecords=[],e.initialValues=function(){if(g.accPrcssMode=!0,"update"==a.action||"view"==a.action){g.updateMode=!0,g.new=!1;var e=angular.fromJson(a.data);g.data.agentName=e.REFERRAL_AGENT_NAME,g.data.agentCode=e.REFERRAL_AGENT_CODE,g.data.patName=e.PAT_NAME,g.data.mrNo=e.MR_NO,g.data.visitNo=e.VISIT_NO,g.data.billNo=e.BILL_NO,g.loadAgentServSelectGrid(e),g.loadAgentServCalculateGrid(e)}else g.updateMode=!1,g.new=!0;"view"==a.action?(g.viewMode=!0,g.calcCommRateDis=!0):(g.viewMode=!1,g.calcCommRateDis=!1),"update"==a.action?g.accPrcssMode=!1:g.accPrcssMode=!0},g.rowList=[],g.validateSuccessFlag=!1,g.validateFlag=!1,g.reqFields={color:"red"},g.getTableHeight=function(){var t;return e.agentCommissionServiceCalculationGridData.data.length>=10?(t=400,t+="px"):0==e.agentCommissionServiceCalculationGridData.data.length?t="200px !important":(t=30*e.agentCommissionServiceCalculationGridData.data.length+30+70,t+="px"),{height:t}},e.bigTotalItems=0,e.bigTotalItems1=0;var v={pageNumber:1,pageSize:8,sort:null};e.agentCommissionSeviceSelectGridData.onRegisterApi=function(t){e.agentCommissionSeviceSelectGridDataApi=t,t.pagination.on.paginationChanged(e,function(e,t){v.pageNumber=e,v.pageSize=t})},e.agentCommissionServiceCalculationGridData.onRegisterApi=function(t){t.pagination.on.paginationChanged(e,function(e,t){v.pageNumber=e,v.pageSize=t})},g.clearAll=function(){"update"==a.action?e.initialValues():(e.agentCommissionSeviceSelectGridData.data=[],e.agentCommissionServiceCalculationGridData.data=[],g.data=[],e.bigTotalItems=0,e.bigTotalItems1=0)},g.doctors=[],g.agentName=[],g.checkValidation=function(){return null==g.fromdate?g.fmReqDate=!0:g.fmReqDate=!1,null==g.toDate?g.toReqDate=!0:g.toReqDate=!1,null!=g.fromdate&&null!=g.toDate?g.validateFlag=!0:g.validateFlag=!1,g.validateFlag},e.calculateServCommTotal=function(e,t){for(var a=0,i=null,r=0;r<e.length;r++)"service"==t?i=e[r].SERVICE_RATE:(null!=e[r].commissionAmount&&""!=e[r].commissionAmount||(e[r].commissionAmount=0),i=e[r].commissionAmount),a+=parseFloat(i);return a.toFixed(2)},g.roleValue=s.loadRoleTaskService("T_BL_AGENT_COMMISSION"),g.loadAgentServSelectGrid=function(t){e.agentCommissionSeviceSelectGridData.data=[],e.agentCommissionServiceCalculationGridData.data=[];var a={pBillNo:t.BILL_NO,pAgentSeqId:t.REFERRAL_AGENT_SEQ_ID};s.loadCombos("AGENT_BILL_SERVICE_SEARCH",a).then(function(t){for(var a=0;a<t[1].length;a++)t[1][a].slno=a+1;e.agentCommissionSeviceSelectGridData.data=t[1],e.bigTotalItems=10*Math.ceil(t[1].length/e.agentCommissionSeviceSelectGridData.paginationPageSize);var i=e.calculateServCommTotal(e.agentCommissionSeviceSelectGridData.data,"service");g.data.totBillAmnt=parseFloat(i).toFixed(2)})},g.showAgentModal=function(){"new"==a.action&&r.open("",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/AgentComission/partials/agent.commission.agent.modal.html",size:"lg",scope:e,controller:"AgentCommissionModalController",controllerAs:"aCMP"}).result.then(function(e){g.data.agentName=e.REFERRAL_AGENT_NAME,g.data.agentCode=e.REFERRAL_AGENT_CODE,g.data.patName=e.PAT_NAME,g.data.mrNo=e.MR_NO,g.data.visitNo=e.VISIT_NO,g.data.billNo=e.BILL_NO,g.loadAgentServSelectGrid(e),g.printObjectPrint=angular.copy(e)})},g.newAgentComission=function(e){i.go("index.billingSub.agentCommissionNewUpdate",{action:"new"})},g.closeAgentCalculation=function(e){i.go("index.billingSub.agentCommission",{})},e.$on("agentPrintReload",function(){g.closeAgentCalculation()}),g.addSelectedAgentServices=function(){if(e.agentCommissionSeviceSelectGridDataApi.selection.getSelectedCount()>0){var t=e.agentCommissionSeviceSelectGridDataApi.selection.getSelectedRows();if(e.agentCommissionServiceCalculationGridData.data.length>0)t=e.checkDuplicateServices(t);var a=null;a=0==e.agentCommissionServiceCalculationGridData.data.length?0:e.agentCommissionServiceCalculationGridData.data.length;for(var i=!1,r=0;r<t.length;r++)t[r].SERVICE_RATE<0||"Y"==t[r].IS_PHARMACY_SERV?i=!0:(a=e.agentCommissionServiceCalculationGridData.data.length,t[r].slNo=a+1,t[r].commissionAmount="",t[r].commissionRate="",e.agentCommissionServiceCalculationGridData.data.push(t[r]),e.bigTotalItems1=10*Math.ceil(e.agentCommissionServiceCalculationGridData.data.length/e.agentCommissionServiceCalculationGridData.paginationPageSize));i&&p.information("Information","Cannot add negative services and pharmacy issuse/return services");var n=e.calculateServCommTotal(e.agentCommissionServiceCalculationGridData.data,"service");g.data.totEligAmnt=parseFloat(n).toFixed(2),e.agentCommissionSeviceSelectGridDataApi.selection.clearSelectedRows()}else p.failure("Information","Please select one agent record")},g.loadAgentServCalculateGrid=function(t){e.agentCommissionServiceCalculationGridData.data=[];var a={pBillNo:t.BILL_NO,pAgentSeqId:t.REFERRAL_AGENT_SEQ_ID};s.loadCombos("AGENT_BILL_SERVICE_SEARCH_UPDATE",a).then(function(t){for(var a=0;a<t[1].length;a++)t[1][a].slNo=a+1;e.agentCommissionServiceCalculationGridData.data=t[1],e.bigTotalItems1=10*Math.ceil(t[1].length/e.agentCommissionServiceCalculationGridData.paginationPageSize);var i=e.calculateServCommTotal(e.agentCommissionServiceCalculationGridData.data,"commService");g.data.agentCommAmnt=parseFloat(i).toFixed(2);var r=e.calculateServCommTotal(e.agentCommissionServiceCalculationGridData.data,"service");g.data.totEligAmnt=parseFloat(r).toFixed(2)})},e.removeOneService=function(t,i,r,n){if("view"==a.action)return!1;var l=_.remove(e.agentCommissionServiceCalculationGridData.data,function(e){if(e.SP_SEQ_ID==t.entity.SP_SEQ_ID)return e});e.deletedRecords.push(l[0]);var s=e.calculateServCommTotal(e.agentCommissionServiceCalculationGridData.data,"commService");g.data.agentCommAmnt=parseFloat(s).toFixed(2);var o=e.calculateServCommTotal(e.agentCommissionServiceCalculationGridData.data,"service");g.data.totEligAmnt=parseFloat(o).toFixed(2);var c=e.agentCommissionServiceCalculationGridData.data;e.agentCommissionServiceCalculationGridData.data=[];for(var d=0;d<c.length;d++)c[d].slNo=d+1,e.agentCommissionServiceCalculationGridData.data.push(c[d]);e.bigTotalItems1=10*Math.ceil(c.length/e.agentCommissionServiceCalculationGridData.paginationPageSize)},e.calcCommRate=function(t,a,i,r){if(parseInt(t.entity.commissionRate)>100)return p.failure("Information","Please enter commission percentage less than or equal to 100"),t.entity.commissionRate=0,void(t.entity.editable=!0);var n;n=null==t.entity.commissionRate||""==t.entity.commissionRate?0:t.entity.commissionRate,t.entity.commissionAmount=(parseFloat(t.entity.CHARGEABLE_AMT)*(parseFloat(n)/100)).toFixed(2);var l=e.calculateServCommTotal(e.agentCommissionServiceCalculationGridData.data,"commService");g.data.agentCommAmnt=parseFloat(l).toFixed(2),t.entity.editable=!1},e.calcCommRateFlag=function(e,t){"view"==a.action?e.entity.editable=!1:e.entity.editable=!0},e.calcCommRateHide=function(e,t){g.accPrcssMode=!0},e.checkDuplicateServices=function(t){for(var a=e.agentCommissionServiceCalculationGridData.data,i=0,r="",n=[],l=!1,s=0;s<t.length;s++){l=!1;for(var o=0;o<a.length;o++)t[s].SERV_CODE==a[o].SERV_CODE&&t[s].ORD_DATE==a[o].ORD_DATE&&(i+=1,r=r+" "+t[s].SERV_NAME+"<br>",l=!0);l||n.push(t[s])}return i>0&&p.information("Information","Following services are already added : "+r),n},g.selectAgent=function(e,t,a,i){g.data.agentCode=e.CODE},g.saveUpdateAgentCalculation=function(){if(e.agentCommissionServiceCalculationGridData.data.length>0){var r={};r.url=t.updateService.URL;for(var n=[],l=0;l<e.agentCommissionServiceCalculationGridData.data.length;l++){if(null==e.agentCommissionServiceCalculationGridData.data[l].commissionRate||""==e.agentCommissionServiceCalculationGridData.data[l].commissionRate)return p.information("Information","Please Enter Commission Rate"),!1;var s={"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",spSeqId:e.agentCommissionServiceCalculationGridData.data[l].SP_SEQ_ID,agentCommissionRate:e.agentCommissionServiceCalculationGridData.data[l].commissionRate,agentCommissionAmt:e.agentCommissionServiceCalculationGridData.data[l].commissionAmount,agentCommissionStatus:1,serviceVo:{"@class":"com.napier.core.scm.master.vo.ServiceVo",servSeqId:e.agentCommissionServiceCalculationGridData.data[l].SERV_SEQ_ID},commissionCreatedBy:JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID};n.push(s)}if(e.deletedRecords.length>0)for(var c=e.agentCommissionServiceCalculationGridData.data,d=0;d<e.deletedRecords.length;d++){for(var u=!1,S=0;S<c.length;S++)c[S].SP_SEQ_ID==e.deletedRecords[d].SP_SEQ_ID&&(u=!0);if(!u){var v={"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",spSeqId:e.deletedRecords[d].SP_SEQ_ID,agentCommissionRate:e.deletedRecords[d].commissionRate?e.deletedRecords[d].commissionRate:0,agentCommissionAmt:e.deletedRecords[d].commissionAmount?e.deletedRecords[d].commissionAmount:0,agentCommissionStatus:2,serviceVo:{"@class":"com.napier.core.scm.master.vo.ServiceVo",servSeqId:e.deletedRecords[d].SERV_SEQ_ID},commissionCreatedBy:JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID};n.push(v)}}r.requestData={operation:"saveOrUpdateServicePosting",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingVo",subAccSeqId:e.agentCommissionServiceCalculationGridData.data[0].SUB_ACC_SEQ_ID,servicePostingDetailsList:[{"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo":n}]}},o.sendRestRequest(r).then(function(e){if(e.data.HITService.message.errorCode)return p.warning("Failure","Order Saving Failed"),!1;g.updatePrintData=e.data.HITService.message;var t={buttonClose:function(){m.dismissAll(),i.go("index.billingSub.agentCommission",{reload:!0})}},r={buttonCallBack1:g.closeAgentCalculation,buttonCallBack2:g.processPrintConfirm},n=null;"update"==a.action&&(n="Agent Commission Calculation Updated Successfully. Do you Want to Print?"),"new"==a.action&&(n="Agent Commission Calculation Saved Successfully. Do you Want to Print?"),p.hisAlertMulti("success","Success",n,{buttonText:"No",buttonText2:"Yes"},r,t)})}else p.information("alert","Please add atleast one service to save")},g.closeAgentCalculationProcess=function(){m.dismissAll()},g.processAgentCalculation=function(){var e={buttonCallBack1:g.processAgentCalculationConfirm,buttonCallBack2:g.closeAgentCalculationProcess};p.confirmation("Success","Do you want to confirm Account Processing?",{buttonText:"Yes",buttonText2:"No"},e)},g.processAgentCalculationConfirm=function(){var a={};a.url=t.updateService.URL;for(var i=[],r=0;r<e.agentCommissionServiceCalculationGridData.data.length;r++){var n={"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",spSeqId:e.agentCommissionServiceCalculationGridData.data[r].SP_SEQ_ID,agentAccProcessStatus:1,serviceVo:{"@class":"com.napier.core.scm.master.vo.ServiceVo",servSeqId:e.agentCommissionServiceCalculationGridData.data[r].SERV_SEQ_ID}};i.push(n)}a.requestData={operation:"saveOrUpdateServicePosting",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingVo",subAccSeqId:e.agentCommissionServiceCalculationGridData.data[0].SUB_ACC_SEQ_ID,servicePostingDetailsList:[{"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo":i}]}},o.sendRestRequest(a).then(function(e){if(""==e.data.HITService.message||null==e.data.HITService.message)p.warning("Failure","Account Processed Failed");else{var t={buttonCallBack1:g.closeAgentCalculation};p.confirmation("Success","Account Processed Successfully",{buttonText:"OK"},t)}})},g.processPrintConfirm=function(){var e=g.printObjectPrint;if("update"==a.action)e=angular.fromJson(a.data);var t={pBillNo:e.BILL_NO,pAgentSeqId:e.REFERRAL_AGENT_SEQ_ID,pAgentName:e.REFERRAL_AGENT_NAME,pPatName:e.PAT_NAME,pAgentCode:e.REFERRAL_AGENT_CODE,pPatMrNo:e.MR_NO,pPatVisitAdmNo:e.VISIT_NO,pPatBillNo:e.BILL_NO,pPatVisitAdmDate:new Date(e.VISIT_ADM_DATE).toISOString().slice(0,10)+" 00:00:00",pAgentFormDate:"",pTotalBillAmt:e.BILL_AMT?e.BILL_AMT:"",pTotalEligibleAmt:"",pTotalAgentAmt:""};u.printReportModal("printAgentPDFCtrl","lg","PDF",t)},e.initialValues()}function t(e,t,a,i,r,n,l){r.pageName="Agent Commission",r.cancel=function(){n.$broadcast("agentPrintReload");var t=e.getTop();e.dismiss(t.key)},r.printParameterList=new Array,a.prepareParamList("pBillNo",l.pBillNo,r.printParameterList),a.prepareParamList("pAgentSeqId",l.pAgentSeqId,r.printParameterList),a.prepareParamList("pAgentName",l.pAgentName,r.printParameterList),a.prepareParamList("pPatName",l.pPatName,r.printParameterList),a.prepareParamList("pAgentCode",l.pAgentCode,r.printParameterList),a.prepareParamList("pPatMrNo",l.pPatMrNo,r.printParameterList),a.prepareParamList("pPatVisitAdmNo",l.pPatVisitAdmNo,r.printParameterList),a.prepareParamList("pPatBillNo",l.pPatBillNo,r.printParameterList),a.prepareParamList("pPatVisitAdmDate",l.pPatVisitAdmDate,r.printParameterList),a.prepareParamList("pAgentFormDate",l.pAgentFormDate,r.printParameterList),a.prepareParamList("pTotalBillAmt",l.pTotalBillAmt,r.printParameterList),a.prepareParamList("pTotalEligibleAmt",l.pTotalEligibleAmt,r.printParameterList),a.prepareParamList("pTotalAgentAmt",l.pTotalAgentAmt,r.printParameterList),r.printObject={};r.printObject.reportId="AGENT_COMMISSION_CALCULATION_FORM_REPORT",r.printObject.destination="reportingServiceImpl",r.printObject.reportType={"@class":"com.napier.report.type.ReportType",id:"PDF"==t?4:5,desc:t},r.printObject.paramsList=r.printParameterList,i.printReportFunction(r.printObject,r)}e.$inject=["$scope","OPVISIT_MGMT_APIS","$stateParams","$state","hisModalService","hisTranslationsService","hisTranslationsGlobalLang","adtDailyReportComboQueryservice","CallManager","agentCommissionSeviceSelectGrid","agentCommissionServiceCalculationGrid","hisAlertService","PrintService","$uibModalStack"],t.$inject=["$uibModalStack","selectedPrintType","QueryService","PrintService","$scope","$rootScope","returnObj"],angular.module("napierContainerUi").controller("AgentCommissionNewUpdateController",e).controller("printAgentPDFCtrl",t)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o){t.loadModule("billing");var c=a.getLanguageToSet();t.changeLanguage(c);var d=this;function p(){d.getRoleList=n.rolePermission("T_BL_M_BILL_GEN_CLEARANCE"),d.billClearnceCheckList=[],d.data={IS_CLAERANCE_MANDATORY:"Y",isMandatory:"N"},d.addMoreLocations(8),d.gridOptions={enableHorizontalScrollbar:0,enableVerticalScrollbar:1,enableCellEdit:!1,columnDefs:[{name:"LOCATION_DESCRIPTION",displayName:"billing.location",headerCellFilter:"translate"},{displayName:"billing.mandatory",headerCellFilter:"translate",name:"IS_CLAERANCE_MANDATORY",cellTemplate:'<div class="ui-grid-cell-contents">{{(row.entity.IS_CLAERANCE_MANDATORY=="Y")?"YES":"NO"}}</div>'},{displayName:"billing.checklistCount",headerCellFilter:"translate",name:"CHKLIST_CNT"},{name:"Actions",displayName:"billing.actions",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents action-row"><i  ng-if="grid.appScope.bg.getRoleList.T_BL_M_BILL_GEN_CLEARANCE_U" ng-click="grid.appScope.bg.getCheckListById(row.entity,rowRenderIndex)" class="fa fa-pencil"></i><i ng-click="grid.appScope.bg.changeStatus(row.entity.LOC_SEQ_ID)" ng-if="!row.entity.isEdit&& grid.appScope.bg.getRoleList.T_BL_M_BILL_GEN_CLEARANCE_DEL" class="fa fa-trash"></i></div>'}]},u()}function u(){let e={1:d.gridOptions.data=[]},t=i.executeQueryURLReset(),a=new Array;i.prepareParamListWithParam("pFaclityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a),i.executeQueryInput("GET_SERVICE_LOCATIONS_CONFIG_LIST",a,e,!0,!0,t,"popUp",d.gridOptions.data)}d.addMoreLocations=function(e){for(var t=0;t<e;t++)d.billClearnceCheckList.push({IS_MANDATORY:"N",CHECKLIST:""})},d.getAutoSearchQuery=function(e){let t={1:d.serviceLocationList=[]},a=i.executeQueryURLReset(),r=new Array;return i.prepareParamListWithParam("pFaclityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,r),i.prepareParamListWithParam("pLocation",e,r),i.executeQueryInput("GET_SERVICE_LOCATIONS_AUTO",r,t,!0,!0,a,"popUp",{}).then(function(e){return e[1].length>0?d.serviceLocationList.map(function(e){return e}):[]})},d.checkListGrid=function(e){let t=!1;if(null==e)if("Y"==d.data.isMandatory){for(var a=0;a<d.billClearnceCheckList.length;a++)d.billClearnceCheckList[a].CHECKLIST&&(d.billClearnceCheckList[a].IS_MANDATORY="Y",t=!0);t||(d.data.isMandatory="N")}else for(a=0;a<d.billClearnceCheckList.length;a++)d.billClearnceCheckList[a].IS_MANDATORY="N";else{d.billClearnceCheckList[e].CHECKLIST||(d.billClearnceCheckList[e].IS_MANDATORY="N");let t=!1;var i=0;for(a=0;a<d.billClearnceCheckList.length;a++)"Y"==d.billClearnceCheckList[e].IS_MANDATORY&&(t=!0),"Y"==d.billClearnceCheckList[a].IS_MANDATORY&&(i+=1);t?i==d.billClearnceCheckList.length&&(d.data.isMandatory="Y"):d.data.isMandatory="N"}},d.getCheckListById=function(e,t){if(d.gridOptions.data.length>0)var a=_.find(d.gridOptions.data,function(t){return t.LOC_SEQ_ID==e.LOC_SEQ_ID});else a=void 0;d.data.IS_CLAERANCE_MANDATORY=e.IS_CLAERANCE_MANDATORY?e.IS_CLAERANCE_MANDATORY:a&&a.IS_CLAERANCE_MANDATORY?a.IS_CLAERANCE_MANDATORY:"N",null!=t&&(d.data.serviceLocation={LOCATION_DESCRIPTION:e.LOCATION_DESCRIPTION,LOC_SEQ_ID:e.LOC_SEQ_ID});for(var r=0;r<d.gridOptions.data.length;r++)e.LOC_SEQ_ID==d.gridOptions.data[r].LOC_SEQ_ID&&null!=t?d.gridOptions.data[r].isEdit=!0:d.gridOptions.data[r].isEdit=!1;let n={1:d.billClearnceCheckList=[]};if(e.CHKLIST_CNT&&"0"!=e.CHKLIST_CNT||null==t){let t=i.executeQueryURLReset(),a=new Array;i.prepareParamListWithParam("pLocId",e.LOC_SEQ_ID,a),i.prepareParamListWithParam("pFaclityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a),i.executeQueryInput("GET_CHECK_LIST_BY_ID",a,n,!0,!0,t,"popUp",d.gridOptions.data).then(function(){0==d.billClearnceCheckList.length&&d.addMoreLocations(8)})}else d.addMoreLocations(8)},d.billingClearanceSave=function(){for(var e=[],t=0;t<d.billClearnceCheckList.length;t++)(d.billClearnceCheckList[t].CHECKLIST||d.billClearnceCheckList[t].LCH_SEQ_ID)&&e.push({lchSeqId:d.billClearnceCheckList[t].LCH_SEQ_ID,checkListName:d.billClearnceCheckList[t].CHECKLIST,isMandatory:d.billClearnceCheckList[t].IS_MANDATORY,createdBy:d.billClearnceCheckList[t].LCH_SEQ_ID?void 0:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,createdOn:d.billClearnceCheckList[t].LCH_SEQ_ID?void 0:new Date,gnStatus:d.billClearnceCheckList[t].CHECKLIST?1:2,modifiedOn:d.billClearnceCheckList[t].LCH_SEQ_ID?new Date:void 0,modifiedBy:d.billClearnceCheckList[t].LCH_SEQ_ID?angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID:void 0,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID});var a={"@class":"com.napier.core.scm.serviceposting.vo.BillClearenceConfigurationVo",loc_seq_id:d.data.serviceLocation.LOC_SEQ_ID,is_claerance_mandatory:d.data.IS_CLAERANCE_MANDATORY,is_claerance_mandatory:d.data.IS_CLAERANCE_MANDATORY,is_clearance_required:"Y",billClearenceCheckListDetailsVoList:[{"com.napier.core.scm.serviceposting.vo.BillClearenceCheckListDetailsVo":e}]},i={};i.url=s.HISAPPWORKREQFORCOMBO.URL,i.requestData={operation:"saveOrUpdateBillClearnceConfig",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:a},o.sendRestRequest(i).then(function(e){if(e){var t=e.data.HITService.message;null!=t&&Object.keys(t).length>0&&(r.success("Success","Saved Successfully"),p())}},function(){})},d.changeStatus=function(e){var t={buttonCallBack1:function(){},buttonCallBack2:function(){var t={};t.url=s.HISAPPWORKREQFORCOMBO.URL,t.requestData={operation:"updateBillClerenceGNStatus",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:{"@class":"com.napier.core.scm.serviceposting.vo.BillClearenceConfigurationVo",loc_seq_id:e}},o.sendRestRequest(t).then(function(e){e&&(r.success("Success","Deleted  Successfully"),u())},function(){})},buttonClose:function(){}};r.hisAlertMulti("warning","Warning","Do You Want To Delete?",{buttonText:"No",buttonText2:"Yes"},t,t)},p()}e.$inject=["$scope","hisTranslationsService","hisTranslationsGlobalLang","QueryService","hisAlertService","RoleTaskService","$q","BILLING_APIS","CallManager"],angular.module("napierContainerUi").controller("billClearanceCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n){e.discountModelGridOptions=angular.copy(t),e.discountModelGridOptions.data=[],e.selectButtonFlag=!1,e.getDiscount=function(t){e.discountList=[],e.discountList1={1:e.discountList};var i=a.executeQueryURLReset(),r=new Array;a.prepareParamListWithParam("pDiscName","",r),a.prepareParamListWithParam("pDiscSeqId",-999,r),a.executeQueryInput("GET_DISCOUNT_MASTERS_DISTINCT_DATA",r,e.discountList1,!0,!0,i,"popUp",{}).then(function(t){e.discountModelGridOptions.data=e.discountList})},e.getDiscount(),e.onRadioBtnClick=function(t){e.selectButtonFlag=!0,t&&t.entity&&(e.discountName=t.entity.DISCOUNT_NAME)},e.onRowSelection=function(){n.close(e.discountName)},e.clear=function(){n.close()}}e.$inject=["$scope","discountModelGridDef","QueryService","$uibModal","$uibModalStack","$uibModalInstance"],angular.module("napierContainerUi").controller("discountModalCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y){var f=this;r.getTaskPermissionDetails("T_BL_DISCOUNT_MASTER").then(function(e){a.roleValue=e}),f.data={},f.data.applicability=1,f.data.gnStatus=1,a.gridDiscountSerivceApi,a.gridOptionsDiscountSerivce=angular.copy(D),a.gridOptionsDiscountSerivce.onRegisterApi=function(e){a.gridDiscountSerivceApi=e},a.gridOptionsDiscountSerivce.data=[],a.gridOptionsDiscountSerivce.data[0]=[],a.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},a.alertFlag=!1,a.updateFlag=!1,a.saveFlag=!1,a.discountTextVal=!1,a.discountVal=!1,a.editRowFlag=!1,a.duplicateFlag=!1,f.getDiscountTypeDropDown=function(){f.discountTypeList=[],f.discountTypeList1={1:f.discountTypeList};var e=m.executeQueryURLReset(),t=new Array;m.prepareParamListWithParam("pMasterSqId","6502",t),m.executeQueryInput("TRN003",t,f.discountTypeList1,!0,!0,e,"popUp",{}).then(function(e){f.data.discountType=e[1][0],a.gridOptionsDiscountSerivce.data[0].discountType=f.data.discountType})},f.getDiscountTypeDropDown(),f.getDiscount=function(e){e&&(a.duplicateFlag=!1,a.saveFlag=!0),f.discountList=[],f.discountList1={1:f.discountList};var t=m.executeQueryURLReset(),i=new Array;m.prepareParamListWithParam("pDiscName",e||"",i),m.prepareParamListWithParam("pDiscSeqId",-999,i),m.prepareParamListWithParam("pGNSTATUS",-999,i),m.executeQueryInput("GET_DISCOUNT_MASTERS_DISTINCT_DATA",i,f.discountList1,!0,!0,t,"popUp",{}).then(function(t){if(t&&t[1])for(var i=0;i<t[1].length;i++)if(t[1][i].DISCOUNT_NAME===e)return void(a.duplicateFlag=!0)})},f.getDiscount(),Number.prototype.pad=function(e){for(var t=String(this);t.length<(e||2);)t="0"+t;return t},f.getSelectedItem=function(e){f.gridDataList=[],f.getDiscountList=[],f.getDiscountList1={1:f.getDiscountList};var t=m.executeQueryURLReset(),i=new Array;m.prepareParamListWithParam("pDiscName",e.discount?e.discount.DISCOUNT_NAME:"",i),m.prepareParamListWithParam("pDiscSeqId",e.discount&&e.discount.CONC_SEQ_ID?e.discount.CONC_SEQ_ID:-999,i),m.executeQueryInput("GET_DISCOUNT_MASTERS_GRID_DATA",i,f.getDiscountList1,!0,!0,t,"popUp",{}).then(function(t){if(a.alertFlag=!0,a.updateFlag=!0,a.gridOptionsDiscountSerivce.data=[],a.gridOptionsDiscountSerivce.data[0]=[],a.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},t&&t[1]&&t[1][0]&&1==t[1][0].IS_BILL_OR_SERVICE_LEVEL){var i={DT_CODE:t[1][0].DISCOUNT_TYPE,DETAIL_DESC:t[1][0].DISCOUNT_TYPE_DESC};f.data.applicability=t[1][0].IS_BILL_OR_SERVICE_LEVEL,f.data.discountType=i,f.data.discountText=t[1][0].DISCOUNT_VALUE,f.data.gnStatus=t[1][0].GN_STATUS,f.data.discSeqId=t[1][0].DISC_SEQ_ID,f.data.discount=e.discount}if(t&&t[1]&&2==t[1][0].IS_BILL_OR_SERVICE_LEVEL){if(f.data.applicability=t[1][0].IS_BILL_OR_SERVICE_LEVEL,f.data.gnStatus=t[1][0].GN_STATUS,t[1].length>0&&null!=t[1][0]){a.gridOptionsDiscountSerivce.data=[],a.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1};for(var r=0;r<t[1].length;r++){var n={},l={};l.CODE=t[1][r].PRI_SERV_SEQ_ID,l.DESCRIPTION=t[1][r].PRIMARY_SERVICE_DESC,n.primayServiceGroup=l;var s={};null!=t[1][r].DEPT_CODE&&null!=t[1][r].DEPT_CODE&&(s.CODE=t[1][r].DEPT_CODE.pad(3),s.DESCRIPTION=t[1][r].DEPT_DESC,n.department=s,f.loadDeptDropdown(l,r+1));var o={};if(null!=t[1][r].SEPL_CODE&&null!=t[1][r].SEPL_CODE){o.CODE=t[1][r].SEPL_CODE,o.DESCRIPTION=t[1][r].SPL_DESC,n.speciality=o;var c={};c.primayServiceGroup=l,c.department=s,f.OnChangeDept(c,r+1)}var d={};null!=t[1][r].SERV_SEQ_ID&&null!=t[1][r].SERV_SEQ_ID&&(d.SERV_SEQ_ID=t[1][r].SERV_SEQ_ID,d.SERV_NAME=t[1][r].SERV_DESC,d.CODE=t[1][r].SERV_SEQ_ID,n.service=d);var p={};null!=t[1][r].DISCOUNT_TYPE&&null!=t[1][r].DISCOUNT_TYPE&&(p.DETAIL_DESC=t[1][r].DISCOUNT_TYPE_DESC,p.DT_CODE=t[1][r].DISCOUNT_TYPE,n.discountType=p),n.discSeqId=t[1][r].DISC_SEQ_ID,n.discountName=t[1][r].DISCOUNT_NAME,n.discountValue=t[1][r].DISCOUNT_VALUE,n.serviceHierarcyLevel=t[1][r].SERVICE_HIERARCHY_LEVEL,n.isFirstRow=!0,n.isEditable=!0,a.gridOptionsDiscountSerivce.data.push(n)}}a.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},a.gridOptionsDiscountSerivce.data[0].discountType=f.data.discountType}})},f.loadCoPayCombo=function(){f.psgdwn_copay=[],f.coPayQueryMap={1:f.psgdwn_copay};var e=m.executeQueryURLReset(),t=new Array;m.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,t),m.executeQueryInput("BL_GET_PSG_SEARCH_SP",t,f.coPayQueryMap,!0,!0,e,"popUp",{}).then(function(e){if(e&&e[1]){f.psgdwn_copay=[];for(var t=0;t<e[1].length&&"N"==e[1][t].IS_MATERIAL;t++)f.psgdwn_copay.push(e[1][t])}})},f.loadCoPayCombo(),f.deptdwn_copay=[],f.loadDeptDropdown=function(e,t){f.deptdwn_copay[t]=[],f.deptQueryMap={1:f.deptdwn_copay[t]};var i=m.executeQueryURLReset(),r=new Array;m.prepareParamListWithParam("pPSG_CODE",e?e.CODE:-999,r),m.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,r),m.executeQueryInput("BL_GET_DEPARTMENT_SEARCH_SP",r,f.deptQueryMap,!0,!0,i,"popUp",{}).then(function(e){e[1][0]&&a.gridOptionsDiscountSerivce.data[t].department&&a.gridOptionsDiscountSerivce.data[t].department.CODE&&(a.gridOptionsDiscountSerivce.data[t].department=_.find(f.deptdwn_copay[t],function(e){return e.CODE==a.gridOptionsDiscountSerivce.data[t].department.CODE}))})},f.deptSpecicityService=[],f.OnChangeDept=function(e,t){f.deptSpecicityService[t]=[],f.specilityMap={1:f.deptSpecicityService[t]};var i=m.executeQueryURLReset(),r=new Array;m.prepareParamListWithParam("pPSG_CODE",e&&e.primayServiceGroup?e.primayServiceGroup.CODE:-999,r),m.prepareParamListWithParam("pDEPT_CODE",e&&e.department?e.department.CODE:-999,r),m.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,r),m.executeQueryInput("BL_GET_SPECIALITY_SEARCH_SP",r,f.specilityMap,!0,!0,i,"popUp",{}).then(function(i){i[1][0]&&(f.deptSpecicityService[t]=i[1],e.speciality&&e.speciality.CODE&&(a.gridOptionsDiscountSerivce.data[t].speciality=_.find(f.deptSpecicityService[t],function(t){return t.CODE==e.speciality.CODE})))})},f.serchOptimSpeciSerch=function(e,t,a){f.optServSerch=[],f.copayserviceMap={1:f.optServSerch};var i=m.executeQueryURLReset(),r=new Array;return m.prepareParamListWithParam("pPSG_CODE",a&&a.primayServiceGroup?a.primayServiceGroup.CODE:-999,r),m.prepareParamListWithParam("pDEPT_CODE",a&&a.department?a.department.CODE:-999,r),m.prepareParamListWithParam("pSPECL_CODE",a&&a.speciality?a.speciality.CODE:-999,r),m.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,r),m.prepareParamListWithParam("pSERV_NAME",e,r),m.executeQueryInput("BL_GET_SERVICE_SEARCH_SP",r,f.copayserviceMap,!0,!0,i,"popUp",{}).then(function(e){if(e[1])return f.optServSerch.map(function(e){return e.CODE=e.SERV_SEQ_ID,f.serchCopayResult=e,e})})},f.serchOptimSpeciSerch(""),f.setdWData=function(e,t){e&&(a.gridOptionsDiscountSerivce.data[t]=[],a.gridOptionsDiscountSerivce.data[t].service={},a.gridOptionsDiscountSerivce.data[t].primayServiceGroup={},a.gridOptionsDiscountSerivce.data[t].department={},a.gridOptionsDiscountSerivce.data[t].speciality={},a.gridOptionsDiscountSerivce.data[t].discountType={},a.gridOptionsDiscountSerivce.data[t].primayServiceGroup.CODE=e.PRI_SERV_CODE,a.gridOptionsDiscountSerivce.data[t].primayServiceGroup.DESCRIPTION=e.PRI_SERV_DESC,a.gridOptionsDiscountSerivce.data[t].department.CODE=e.DEPT_CODE,a.gridOptionsDiscountSerivce.data[t].department.DESCRIPTION=e.SEPT_DESC,a.gridOptionsDiscountSerivce.data[t].speciality.CODE=e.SPL_CODE,a.gridOptionsDiscountSerivce.data[t].speciality.DESCRIPTION=e.SPL_DESC,a.gridOptionsDiscountSerivce.data[t].discountType=f.data.discountType,f.loadDeptDropdown(a.gridOptionsDiscountSerivce.data[t].primayServiceGroup,t),f.OnChangeDept(a.gridOptionsDiscountSerivce.data[t],t),a.gridOptionsDiscountSerivce.data[t].service.SERV_CODE=e.SERV_CODE,a.gridOptionsDiscountSerivce.data[t].service.SERV_NAME=e.SERV_NAME,a.gridOptionsDiscountSerivce.data[t].service.SERV_SEQ_ID=e.SERV_SEQ_ID,a.gridOptionsDiscountSerivce.data[t].service.CODE=e.SERV_SEQ_ID)},f.discountMasterServiceGridList=function(e,t){if(null!=f.data.discount&&""!=f.data.discount)if(null!=e.primayServiceGroup)if(null!=e.discountValue){var i={primayServiceGroup:e.primayServiceGroup,isFirstRow:!0,isEditable:!0};null!=e.department&&(i.department=e.department),null!=e.speciality&&(i.speciality=e.speciality),null!=e.service&&(e.service.CODE=e.service.SERV_SEQ_ID,i.service=e.service),null!=e.discountValue&&(i.discountValue=e.discountValue),e.discountType&&(i.discountType=e.discountType),f.data&&f.data.discount&&(i.discountName=f.data.discount.DISCOUNT_NAME?f.data.discount.DISCOUNT_NAME:f.data.discount),f.data&&f.data.gnStatus&&(i.gnStatus=f.data.gnStatus),null!=e.primayServiceGroup&&(i.serviceHierarcyLevel=1),null!=e.primayServiceGroup&&null!=e.department&&(i.serviceHierarcyLevel=2),null!=e.primayServiceGroup&&null!=e.department&&null!=e.speciality&&(i.serviceHierarcyLevel=3),null!=e.primayServiceGroup&&null!=e.department&&null!=e.speciality&&null!=e.service&&(i.serviceHierarcyLevel=4),f.gridValidationForAddition(e,0,i.serviceHierarcyLevel)?c.warning("Warning","Not allowed to add record under same hierarchy",!1,!1,n.time):(f.deptdwn_copay[a.gridOptionsDiscountSerivce.data.length]=angular.copy(f.deptdwn_copay[0]),f.deptSpecicityService[a.gridOptionsDiscountSerivce.data.length]=angular.copy(f.deptSpecicityService[0]),a.gridOptionsDiscountSerivce.data.push(angular.copy(i)),a.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},a.gridOptionsDiscountSerivce.data[0].discountType=f.data.discountType,a.gridOptionsDiscountSerivce.data[0].discountValue="")}else c.warning("warning","Please enter discountValue");else c.warning("warning","Please select primary service group");else c.warning("warning","Please enter discount name")},f.editRow=function(e,t){if(a.selectedIndex=t,a.editRowFlag=!0,Array.isArray(e))e=Object.assign({},e);let i=angular.copy(e);i.isFirstRow=!1,i.isEditable=!1,a.gridOptionsDiscountSerivce.data[0]=i,f.loadDeptDropdown(e.primayServiceGroup,0),f.OnChangeDept(e,0)},f.updateDiscountServiceGrid=function(e,t){null!=e.primayServiceGroup?null!=e.discountValue&&""!=e.discountValue?(null!=e.primayServiceGroup&&null!=e.department&&null!=e.speciality&&null!=e.service?e.serviceHierarcyLevel=4:null!=e.primayServiceGroup&&null!=e.department&&null!=e.speciality?e.serviceHierarcyLevel=3:null!=e.primayServiceGroup&&null!=e.department?e.serviceHierarcyLevel=2:null!=e.primayServiceGroup&&(e.serviceHierarcyLevel=1),f.gridValidationForAddition(e,a.selectedIndex,e.serviceHierarcyLevel)?c.warning("Warning","Not allowed to add record under same hierarchy",!1,!1,n.time):(f.deptdwn_copay[a.gridOptionsDiscountSerivce.data.length]=angular.copy(f.deptdwn_copay[a.selectedIndex]),f.deptSpecicityService[a.gridOptionsDiscountSerivce.data.length]=angular.copy(f.deptSpecicityService[a.selectedIndex]),a.gridOptionsDiscountSerivce.data[a.selectedIndex]=[],a.gridOptionsDiscountSerivce.data[a.selectedIndex].primayServiceGroup={},a.gridOptionsDiscountSerivce.data[a.selectedIndex].department={},a.gridOptionsDiscountSerivce.data[a.selectedIndex].speciality={},a.gridOptionsDiscountSerivce.data[a.selectedIndex].discountType={},a.gridOptionsDiscountSerivce.data[a.selectedIndex].isEditable=!0,a.gridOptionsDiscountSerivce.data[a.selectedIndex].isFirstRow=!0,a.gridOptionsDiscountSerivce.data[a.selectedIndex].discountValue=e.discountValue,f.data.discount&&(a.gridOptionsDiscountSerivce.data[a.selectedIndex].discountName=f.data.discount),f.data.discount&&f.data.discount.DISCOUNT_NAME&&(a.gridOptionsDiscountSerivce.data[a.selectedIndex].discountName=f.data.discount.DISCOUNT_NAME),a.gridOptionsDiscountSerivce.data[a.selectedIndex].serviceHierarcyLevel=e.serviceHierarcyLevel,a.editRowFlag=!1,e.primayServiceGroup&&(a.gridOptionsDiscountSerivce.data[a.selectedIndex].primayServiceGroup.CODE=e.primayServiceGroup.CODE,a.gridOptionsDiscountSerivce.data[a.selectedIndex].primayServiceGroup.DESCRIPTION=e.primayServiceGroup.DESCRIPTION),e.department&&(a.gridOptionsDiscountSerivce.data[a.selectedIndex].department.CODE=e.department.CODE,a.gridOptionsDiscountSerivce.data[a.selectedIndex].department.DESCRIPTION=e.department.DESCRIPTION),e.speciality&&(a.gridOptionsDiscountSerivce.data[a.selectedIndex].speciality.CODE=e.speciality.CODE,a.gridOptionsDiscountSerivce.data[a.selectedIndex].speciality.DESCRIPTION=e.speciality.DESCRIPTION),e.discountType&&(a.gridOptionsDiscountSerivce.data[a.selectedIndex].discountType.DT_CODE=e.discountType.DT_CODE,a.gridOptionsDiscountSerivce.data[a.selectedIndex].discountType.DETAIL_DESC=e.discountType.MASTER_DESC),f.loadDeptDropdown(a.gridOptionsDiscountSerivce.data[a.selectedIndex].primayServiceGroup,a.selectedIndex),f.OnChangeDept(a.gridOptionsDiscountSerivce.data[a.selectedIndex],a.selectedIndex),e.service&&(a.gridOptionsDiscountSerivce.data[a.selectedIndex].service={},a.gridOptionsDiscountSerivce.data[a.selectedIndex].service.SERV_CODE=e.service.SERV_CODE,a.gridOptionsDiscountSerivce.data[a.selectedIndex].service.SERV_NAME=e.service.SERV_NAME,a.gridOptionsDiscountSerivce.data[a.selectedIndex].service.SERV_SEQ_ID=e.service.SERV_SEQ_ID,a.gridOptionsDiscountSerivce.data[a.selectedIndex].service.CODE=e.service.SERV_SEQ_ID),a.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},a.gridOptionsDiscountSerivce.data[0].discountType=f.data.discountType)):c.warning("warning","Please enter discountValue"):c.warning("warning","Please select primary service group")},a.deletedRowData=[],f.deleteRow=function(e,t){a.gridOptionsDiscountSerivce.data.splice(t,1)},f.saveDiscountMaster=function(e){if(!a.duplicateFlag||a.updateFlag)if(null!=e.discountText&&""!=e.discountText||1!=e.applicability){if(null!=e.discount&&""!=e.discount||(a.discountVal=!0),2==e.applicability&&a.gridOptionsDiscountSerivce.data.length<2)c.warning("Warning","Please select atleast one row",!1,!1,n.time);else if(1==e.applicability&&y.saveDiscountMasterData(e).then(function(e){null==e.data.HITService.message||a.updateFlag?(c.success("Success","Successfully updated",!1,!1,n.time),f.clear()):(c.success("Success","Successfully saved",!1,!1,n.time),f.clear()),null!=e.data.HITService.message&&null!=e.data.HITService.message.errorCode&&c.information("Information",e.data.HITService.message.errorMessage)}),2==e.applicability){for(var t=[],i=1;i<a.gridOptionsDiscountSerivce.data.length;i++)t.push(a.gridOptionsDiscountSerivce.data[i]);if(a.deletedRowData)t=t.concat(a.deletedRowData);y.saveDiscountMasterData(e,t).then(function(e){null==e.data.HITService.message||a.updateFlag?(c.success("Success","Successfully updated",!1,!1,n.time),f.clear()):(c.success("Success","Successfully saved",!1,!1,n.time),f.clear()),null!=e.data.HITService.message&&null!=e.data.HITService.message.errorCode&&c.information("Information",e.data.HITService.message.errorMessage)})}}else a.discountTextVal=!0;else c.warning("Warning","Already discount name is existed",!1,!1,n.time)},f.onStatusChange=function(e){if(a.alertFlag){var t={buttonCallBack1:function(){var e={discount:{}};f.data.discount&&(e.discount.DISCOUNT_NAME=f.data.discount),f.data.discount&&f.data.discount.DISCOUNT_NAME&&(e.discount.DISCOUNT_NAME=f.data.discount.DISCOUNT_NAME),f.getSelectedItem(e)},buttonCallBack2:function(){},buttonClose:function(){}};c.hisAlertMulti("warning","warning","You will lose the existing data ?",{buttonText:"No",buttonText2:"Yes"},t,t)}},f.clear=function(){f.data={},f.data.applicability=1,f.data.gnStatus=1,f.getDiscount(),f.getDiscountTypeDropDown(),a.gridOptionsDiscountSerivce.data=[],a.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},a.alertFlag=!1,a.updateFlag=!1,a.saveFlag=!1,a.discountTextVal=!1,a.discountVal=!1,a.editRowFlag=!1,a.duplicateFlag=!1},f.openDisMastPopup=function(){u.open("Discount List",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/DiscountMasters/sections/discount.masters.modal.html",size:"lg",controller:"discountModalCtrl"}).result.then(function(e){if(e){var t={discount:{}};t.discount.DISCOUNT_NAME=e,f.data.discount=e,f.getSelectedItem(t)}},function(){})},f.validateDiscountVal=function(e){e.discountType&&1==e.discountType.DT_CODE&&null!=e.discountValue&&null!=e.discountValue&&""!=e.discountValue&&parseFloat(e.discountValue)>parseFloat(100)&&(e.discountValue=100)},f.validateDiscountText=function(e){e.discountType&&1==e.discountType.DT_CODE&&null!=e.discountText&&null!=e.discountText&&""!=e.discountText&&parseFloat(e.discountText)>parseFloat(100)&&(f.data.discountText=100)};var C={1:"primayServiceGroup",2:"department",3:"speciality",4:"service"};f.gridValidationForAddition=function(e,t,i){for(var r=!1,n=a.gridOptionsDiscountSerivce.data,l=1;l<n.length&&l!=t;l++){for(var s=[],o=n[l].serviceHierarcyLevel,c=1;c<=o;c++){if(r=f.validate(e,n[l],C[c]),s.push(r),r&&1==i||r&&1==o)return!0;r=!1}var d=s.filter(function(e){return!0===e}).length;if(s.length==d||r&&i<o&&d-1==s.length-1||i<o&&d>=2)return!0}return r},f.validate=function(e,t,a){return null!=e[a]&&e[a].CODE==t[a].CODE}}e.$inject=["uiGridConstants","$filter","$scope","$uibModal","taskPermissionService","hisAlertConstants","RoleTaskService","$uibModalStack","CallManager","hisAlertService","$rootScope","hisTranslationsService","hisModalService","QueryService","$timeout","hisTranslationsGlobalLang","hisGenericAlertService","discountServiceGridDef","discountMasterService"],angular.module("napierContainerUi").controller("discountMasterCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c){var d=this;s.loadModule("billing");var p=o.getLanguageToSet();s.changeLanguage(p),e.comDateformat=angular.copy(c),d.format=e.comDateformat.dateOnlySlash.format,d.invoiceGridOptions={enableCellEditOnFocus:!1,enableRowSelection:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,multiSelect:!1,enableFiltering:!1,enableSorting:!1,columnDefs:[{field:"invoiceNo",displayName:"Invoice No"},{field:"noOfBills",displayName:"No of Bills"},{field:"billCategory",displayName:"Bill Category"},{field:"companyId",displayName:"Company Id"},{field:"companyName",displayName:"Company Name"},{field:"invoiceDateTime",displayName:"Invoice Date Time",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.invoiceDateTime | date :"dd-MM-yyyy HH:mm:ss"}}</div>'},{field:"totalAmt",displayName:"Total Amount"},{field:"settledAmt",displayName:"Settled Amount"},{field:"corporateDue",displayName:"Corporate Due"},{field:"coveringLetter",displayName:"Covering Letter"},{field:"InvoiceStatus",displayName:"Invoice Status"}]},d.invoiceGridOptions.onRegisterApi=function(e){d.invoicegridApi=e,e.selection.on.rowSelectionChanged(d,function(e){e.isSelected})},e.popup1={opened:!1},e.popup2={opened:!1},e.open1=function(){e.popup1.opened=!0},e.open2=function(){e.popup2.opened=!0},d.clear=function(){d.invoiceListObj.toDate=new Date,d.invoiceListObj.fromDate=new Date,d.invoiceListObj.invoiceNo=null,d.coveringltr=null,d.payerNameList=null,d.invcstatus=null,d.billcategory=null,d.invoiceGridOptions.data=[]},e.payerSearch=function(e){var t="%"+e+"%";d.payerNameList=[],d.multipleComboDataForList={1:d.payerNameList};var i=a.executeQueryURLReset();return d.payerName=new Array,a.prepareParamListWithParam("pCompCode",t,d.payerName),a.prepareParamListWithParam("pCompName",t,d.payerName),a.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,d.payerName),a.executeQueryInput("GET_COPMANY_ACC_BILL_DTLS",d.payerName,d.multipleComboDataForList,!0,!0,i,"popUp").then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})},e.loadinvoiceListGrid=function(e){if(null==d.invoiceListObj.fromDate||null==d.invoiceListObj.fromDate||null==d.invoiceListObj.toDate||null==d.invoiceListObj.toDate)i.warning("Warning","Date Range should not empty",!1,!1,r.time);else if(moment(d.invoiceListObj.fromDate)>moment(d.invoiceListObj.toDate))i.warning("Warning","To Date greater than From Date",!1,!1,r.time);else{if(d.invoiceGridOptions.data=[],null!=d.payerNameList&&null!=d.payerNameList&&""!=d.payerNameList){var t=moment(d.invoiceListObj.fromDate).format("YYYY-MM-DD 00:00:00"),n=moment(d.invoiceListObj.toDate).format("YYYY-MM-DD 23:59:59");d.invcList=[],d.invcListData={1:d.invcList};var l=a.executeQueryURLReset(),s=new Array;return a.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,s),a.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,s),a.prepareParamListWithParam("pFromDate",t,s),a.prepareParamListWithParam("pToDate",n,s),a.prepareParamListWithParam("pInvoiceStatus",d.invcstatus?d.invcstatus.gQDataCode:-999,s),a.prepareParamListWithParam("pCoverLetterStatus",d.coveringltr?d.coveringltr.gQDataCode:-999,s),a.prepareParamListWithParam("pBillCategory",d.billcategory?d.billcategory.gQDataCode:-999,s),a.prepareParamListWithParam("pCompanyName",d.payerNameList?d.payerNameList.gQDataName:"",s),a.prepareParamListWithParam("pInvoiceNo",d.invoiceListObj.invoiceNo?d.invoiceListObj.invoiceNo:"",s),a.executeQueryInput("BL_INVOICE_001",s,d.invcListData,!0,!0,l,"popUp",{}).then(function(e){if(d.invcListData=e[1],""==d.invcListData)i.information("Information","No Records Found",!1,!1,r.time),d.invoiceGridOptions.data=[];else for(var t=0;t<d.invcListData.length;t++){let e={invoiceNo:d.invcListData[t].INVOICE_NO,noOfBills:d.invcListData[t].NO_OF_BILLS,billCategory:d.invcListData[t].DESCRIPTION,companyId:d.invcListData[t].COMPANY_ID,companyName:d.invcListData[t].COMPANY_NAME,invoiceDateTime:d.invcListData[t].INVOICE_DATE,totalAmt:d.invcListData[t].INVOICE_AMT,settledAmt:d.invcListData[t].SETTLED_AMT,corporateDue:d.invcListData[t].DUE_AMT,coveringLetter:d.invcListData[t].COVER_LETTER_STATUS_DESC,InvoiceStatus:d.invcListData[t].INVOICE_STATUS_DESC,invHdSeqId:d.invcListData[t].INVC_HD_SEQ_ID};d.invoiceGridOptions.data.push(e)}})}i.information("Information","Please Enter the Company Name.",!1,!1,r.time)}},e.viewCancelPopup=function(a,n){if(d.rowsSelected=d.invoicegridApi.selection.getSelectedRows()," Cancel"==n){if(""==d.rowsSelected||null==d.rowsSelected)return i.warning("Warning","Please Select only one Record to Cancel.",!1,!1,r.time),!1;if("Original Generated"==d.rowsSelected[0].coveringLetter&&"Settled"==d.rowsSelected[0].InvoiceStatus||"Original Generated"==d.rowsSelected[0].coveringLetter&&"Partially Settled"==d.rowsSelected[0].InvoiceStatus||"Original Generated"==d.rowsSelected[0].coveringLetter&&"Cancelled"==d.rowsSelected[0].InvoiceStatus)return i.warning("Warning","Covering Letter already Generated. Can not cancel the Selected Invoice.",!1,!1,r.time),!1;if("Not Generated"==d.rowsSelected[0].coveringLetter&&"Cancelled"==d.rowsSelected[0].InvoiceStatus)return i.warning("Warning","Invoice already Cancelled.",!1,!1,r.time),!1}else if(" View"==n&&(""==d.rowsSelected||null==d.rowsSelected))return i.warning("Warning","Please Select only one Record to View.",!1,!1,r.time),!1;t.open(" View"==n?"View Details":"Cancel Details",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/InvoiceList/view.cancel.invoice.modal.html",controller:"viewCancelCtrl",controllerAs:"viewCntrl",resolve:{SelectedData:function(){return d.rowsSelected},type:function(){return n}}}).result.then(function(t){e.loadinvoiceListGrid(t)})},e.viewPrint=function(){if(d.rowsSelected=d.invoicegridApi.selection.getSelectedRows(),0!=d.rowsSelected.length)if("UnSettled"!=d.rowsSelected[0].InvoiceStatus&&"Cancelled"!=d.rowsSelected[0].InvoiceStatus)if(d.rowsSelected[0].invHdSeqId){l.invHDSeqId=d.rowsSelected[0].invHdSeqId;n.printReportModal("invoicelistPrintCntrl","lg","PDF")}else i.warning("Warning","Please Select only one Record to Print.",!1,!1,r.time);else i.warning("Warning","Please Select Partially Settled And Settled record to Print",!1,!1,r.time);else i.warning("Warning","Please Select only one Record to Print.",!1,!1,r.time)},function(){d.invoiceListObj={fromDate:new Date,toDate:new Date};var e={1:d.billCategoryListData=[],2:d.invoiceStatusListData=[],3:d.coveringltrListData=[]},t=a.executeQueryURLReset(),i=[];a.prepareParamListWithParam("pMasterSqId",6512,i),a.executeQueryInput("TRN003",i,e,!0,!1,t,"popUp");var r=[];a.prepareParamListWithParam("pMasterSqId",6504,r),a.executeQueryInput("TRN003",r,e,!0,!1,t,"popUp");var n=[];a.prepareParamListWithParam("pMasterSqId",6503,n),a.executeQueryInput("TRN003",n,e,!0,!0,t,"popUp").then(function(e){e[1]&&console.log(d.billCategoryListData)})}()}e.$inject=["$scope","hisModalService","QueryService","hisAlertService","hisAlertConstants","PrintService","$rootScope","hisTranslationsService","hisTranslationsGlobalLang","hisCalDefConstant"],angular.module("napierContainerUi").controller("invoiceListCtrl",e)}(),angular.module("napierContainerUi").controller("invoicelistPrintCntrl",["$uibModalInstance","selectedPrintType","QueryService","PrintService","$rootScope","$scope",function(e,t,a,i,r,n){n.pageName="Print",n.cancel=function(){e.dismiss("cancel")},n.printParameterList=new Array,a.prepareParamList("pSettleHdSeId",-999,n.printParameterList),a.prepareParamList("pInvHdSeqId",r.invHDSeqId,n.printParameterList),a.prepareParamList("pColStatus",-999,n.printParameterList),n.printObject={},n.printObject.reportId="On_Account_Settlement_DotMatrixReport",n.printObject.reportType={id:"PDF"==t?4:5,desc:t},n.printObject.paramsList=n.printParameterList,n.printObject.destination="reportingServiceImpl",i.printReportFunction(n.printObject,n)}]),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d){e.type=a;var p=this;c.loadModule("billing");var u=d.getLanguageToSet();c.changeLanguage(u),p.viewCancelgridOpts={enableCellEditOnFocus:!1,enableRowSelection:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,multiSelect:!1,enableFiltering:!1,enableSorting:!1,columnDefs:[{field:"billNo",displayName:"Bill No"},{field:"billDate",displayName:"Bill Date",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.billDate | date :"dd-MM-yyyy HH:mm:ss"}}</div>'},{field:"mrNo",displayName:"Mr No."},{field:"patientName",displayName:"Patient Name"},{field:"corporateDue",displayName:"Corporate Due"},{field:"settledAmt",displayName:"Settled Amt"},{field:"payment",displayName:"Payment",cellTemplate:'<div class="ui-grid-cell-contents"><i class="fa fa-money" ng-click="grid.appScope.openPaymentModal(row);"></i></div>'}]},p.viewCancelgridOpts.onRegisterApi=function(e){p.invoicegridApi=e,e.selection.on.rowSelectionChanged(p,function(e){e.isSelected})},p.viewCancelgridOpts.data=[],p.invoiceNo=i[0].invoiceNo,p.invoiceDate=moment(i[0].invoiceDateTime).format("YYYY-MM-DD HH:mm:ss"),function(){p.invcViewList=[],p.invcViewListData={1:p.invcViewList};var e=r.executeQueryURLReset(),t=new Array;r.prepareParamListWithParam("pInvoiceHdSeqId",i[0].invHdSeqId?i[0].invHdSeqId:-999,t),r.executeQueryInput("BL_INVOICE_002",t,p.invcViewListData,!0,!0,e,"popUp",{}).then(function(e){p.invcViewListData=e[1];for(var t=0;t<p.invcViewListData.length;t++){let e={billNo:p.invcViewList[t].BILL_NO,billDate:p.invcViewList[t].BILL_DATE,mrNo:p.invcViewList[t].RG_INT_MR_NO,patientName:p.invcViewList[t].RG_FIRST_NAME+p.invcViewList[t].RG_MIDDLE_NAME+p.invcViewList[t].RG_LAST_NAME,corporateDue:p.invcViewList[t].PAYER_AMOUNT,settledAmt:p.invcViewList[t].SETTLED_AMT,billSeqId:p.invcViewList[t].BILL_SEQ_ID,payment:""};p.viewCancelgridOpts.data.push(e)}})}(),p.cancelInvoiceList=function(){var e={"@class":"com.napier.core.invoicesettlement.vo.InvoiceHeader",cancelRemarks:p.cancelReason?p.cancelReason:"",invoiceHdSeqId:i[0].invHdSeqId};n.cancleInvoice(e).then(function(e){l.success("Success","Post Successfully.",!1,!1,s.time),o.close(e)})},e.openPaymentModal=function(e){p.rowsSelected=e.entity;t.open("Payment Details",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/InvoiceList/view.payment.details.modal.html",controller:"viewPaymentModalCtrl",controllerAs:"payerCntrl",resolve:{SelectedData:function(){return p.rowsSelected}}})}}e.$inject=["$scope","hisModalService","type","SelectedData","QueryService","demandNoteService","hisAlertService","hisAlertConstants","$uibModalInstance","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("viewCancelCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n){var l=this;r.loadModule("billing");var s=n.getLanguageToSet();r.changeLanguage(s),l.viewPaymentgridOpts={enableCellEditOnFocus:!1,enableRowSelection:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,multiSelect:!1,enableFiltering:!1,enableSorting:!1,columnDefs:[{field:"payer",displayName:"Payer"},{field:"paidDate",displayName:"Paid Date",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.paidDate | date :"dd-MM-yyyy HH:mm:ss"}}</div>'},{field:"scrollNo",displayName:"Scroll No"},{field:"paidAmt",displayName:"Paid Amt"},{field:"tdsAmt",displayName:"TDS Amt"},{field:"onAcAdj",displayName:"On Account Adjustment"},{field:"depositAdj",displayName:"Deposit Adjustment"}]},l.viewPaymentgridOpts.data=[],function(){l.invcViewList=[],l.invcViewListData={1:l.invcViewList};var e=i.executeQueryURLReset(),t=new Array;i.prepareParamListWithParam("pBillSeqId",a.billSeqId?a.billSeqId:-999,t),i.executeQueryInput("BL_INV_STL_PAYMENY_DTLS",t,l.invcViewListData,!0,!0,e,"popUp",{}).then(function(e){l.invcViewListData=e[1];for(var t=0;t<l.invcViewListData.length;t++){let e={payer:l.invcViewList[t].CREDIT_CMP_NAME,paidDate:l.invcViewList[t].RECP_DATE,scrollNo:l.invcViewList[t].RECP_NO,paidAmt:l.invcViewList[t].PAID_AMT,tdsAmt:l.invcViewList[t].TAX_AMT,onAcAdj:l.invcViewList[t].COMP_ADJUSTMENT_AMT,depositAdj:l.invcViewList[t].PAT_ADJUSTMENT_AMT};l.viewPaymentgridOpts.data.push(e)}})}()}e.$inject=["$scope","hisModalService","SelectedData","QueryService","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("viewPaymentModalCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p){i.loadModule("billing");var u=r.getLanguageToSet();i.changeLanguage(u),t.MISSubGroupMasterOptions=angular.copy(e),t.openNewScreen=function(){a.open("MIS Billing Sub Groups",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/MISSubGroupMaster/sections/MISSubGroupMaster.new.html",size:"lg",scope:t})}}e.$inject=["MISSubGroupMasterDefinition","$scope","hisModalService","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","CallManager","BILLING_APIS","QueryService","$location","RoleTaskService"],angular.module("napierContainerUi").controller("MISSubGroupMasterController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S){r.loadModule("prescriptions");var v=n.getLanguageToSet();r.changeLanguage(v),a.alertObj={},l.loadAlerts(v).then(function(e){a.alertObj=e}),a.SIGMasterSubPageOptions1=angular.copy(e),a.SIGMasterSubPageOptions2=angular.copy(t),a.hideGrid=!0,a.disableDrug=!1,a.drug={},a.obj={},a.obj.sigAdministerByMasterSeqIdArray=[],a.obj.sigDirectionMasterSeqIdArray=[],a.obj.sigDirectionMasterSeqId=[],a.obj.sigAdministerByMasterSeqId=[],a.flag1=0,a.flag2=0,a.result=void 0,a.onSelectDrug=function(e){a.searchDrugFormType(e,2)},a.updategrid=function(){a.drug.dtype&&(a.drug.drugtypeseqid=a.drug.dtype.DRFRMTP_SEQ_ID,a.obj.drugtypeseqid=a.drug.dtype.DRFRMTP_SEQ_ID),a.drug.dname&&(a.obj.drugseqid=a.drug.dname.DRFRM_SEQ_ID,a.obj.drugassoc=a.drug.dname.DRFA_SEQ_ID,a.drug.drugassoc=a.drug.dname.DRFA_SEQ_ID,a.drug.drugseqid=a.drug.dname.DRFRM_SEQ_ID),a.displayUpdateData(a.drug)},a.SIGMasterSubPageOptions1.onRegisterApi=function(e){a.gridApi1=e,a.gridApi1.selection.on.rowSelectionChangedBatch(a,function(e){a.selectGridRecords1()}),a.gridApi1.selection.on.rowSelectionChanged(a,function(e){a.selectGridRecords1()})},a.selectGridRecords1=function(){var e;a.selectDrug1=a.gridApi1.selection.getSelectedRows();var t=[];a.selectDrug1.length>=1?a.flag1=1:a.flag1=0;for(var i=0;i<a.selectDrug1.length;i++)t[i]=a.selectDrug1[i].sigAdministerByMasterSeqId;a.obj.sigAdministerByMasterSeqId=t,e=a.obj.sigAdministerByMasterSeqId.length;var r=[];for(let t=0;t<e;t++){var n={};n.sigAdministerByMasterSeqId=a.obj.sigAdministerByMasterSeqId[t],r.push(n)}a.obj.sigAdministerByMasterSeqIdArray=r},a.SIGMasterSubPageOptions2.onRegisterApi=function(e){a.gridApi2=e,a.gridApi2.selection.on.rowSelectionChangedBatch(a,function(e){a.selectGridRecords2()}),a.gridApi2.selection.on.rowSelectionChanged(a,function(e){a.selectGridRecords2()})},a.selectGridRecords2=function(){var e;a.selectDrug2=a.gridApi2.selection.getSelectedRows();var t=[];a.selectDrug2.length>=1?a.flag2=1:a.flag2=0;for(var i=0;i<a.selectDrug2.length;i++)t[i]=a.selectDrug2[i].sigDirectionMasterSeqId;a.obj.sigDirectionMasterSeqId=t,e=a.obj.sigDirectionMasterSeqId.length;var r=[];for(let t=0;t<e;t++){var n={};n.sigDirectionMasterSeqId=a.obj.sigDirectionMasterSeqId[t],r.push(n)}a.obj.sigDirectionMasterSeqIdArray=r},a.clearData=function(){a.drug.dname=void 0,a.drug.dtype=void 0,a.gridApi1.selection.clearSelectedRows(),a.gridApi2.selection.clearSelectedRows(),a.obj={}},a.searchDrug=function(e){a.drugName=[],a.multipleComboDataForDrugList={1:a.drugName};var t=d.executeQueryURLReset();a.drugList=new Array;var i="";null!=a.drug.dname&&(i="%"+a.drug.dname+"%"),d.prepareParamListWithParam("pStatus",1,a.drugList),d.prepareParamListWithParam("pDrugform",-999,a.drugList),d.prepareParamListWithParam("pdesc",i,a.drugList),d.prepareParamListWithParam("pPracticeId","Napier123",a.drugList),d.executeQueryInput("DRUG_FORM_TYPE_ASSO1",a.drugList,a.multipleComboDataForDrugList,!0,!0,t,"popUp",{}).then(function(e){var t=e[1]instanceof Array?e[1]:[e[1]];a.drugNameList=t})},a.searchDrugFormType=function(e,t){a.drugTypeName=[],a.multipleComboDataForDrugTypeList={1:a.drugTypeName},a.obj.drugseqid=-999,e&&(a.obj.drugseqid=e.DRFRM_SEQ_ID);var i=d.executeQueryURLReset();a.drugTypeList=new Array,d.prepareParamListWithParam("pStatus",1,a.drugTypeList),d.prepareParamListWithParam("pDrugform",a.obj.drugseqid,a.drugTypeList),d.prepareParamListWithParam("ptype",-999,a.drugTypeList),d.prepareParamListWithParam("pPracticeId","Napier123",a.drugTypeList),d.executeQueryInput("DRUG_FORM_TYPE_DRUG_FORM",a.drugTypeList,a.multipleComboDataForDrugTypeList,!0,!0,i,"popUp",{}).then(function(e){var i=e[1]instanceof Array?e[1]:[e[1]];if(2==t){if(0!=i.length){for(var r=0;r<a.drugTypeNameList.length;r++)a.drugTypeNameList[r].DRFRMTP_SEQ_ID==i[0].DRFRMTP_SEQ_ID&&(a.drug.dtype=a.drugTypeNameList[r]);a.updategrid()}}else a.drugTypeNameList=i})},a.init=function(){a.searchDrug(a.drug),a.searchDrugFormType(a.drug,1)},a.init(),a.displayData=function(e){a.obj=angular.copy(a.drug),m.displayDataService(a.obj).then(function(e){var t=e;if(a.result=t,0==t.length&&s.warning(a.alertObj.alertTypeWarn,a.alertObj.noRecordsFound,!1,!1,g.time),null==t)if(t.errorMessage){var i=t.errorMessage;s.failure(a.alertObj.alertTypeFail,i,!1,!1,g.time)}else s.failure(a.alertObj.alertTypeFail,a.alertObj.alertTypeFail,!1,!1,g.time);else a.SIGMasterSubPageOptions1.data=t[0],a.tempDrugList1=a.SIGMasterSubPageOptions1.data,a.SIGMasterSubPageOptions2.data=t[1],a.tempDrugList2=a.SIGMasterSubPageOptions2.data})},a.calldisplay=void a.displayData(a.drug),a.saveSigMaster=function(e){null==e.dname?s.warning(a.alertObj.alertTypeWarn,a.alertObj.selectDrugForm,!1,!1,g.time):null==e.dtype?s.warning(a.alertObj.alertTypeWarn,a.alertObj.selectDrugFormType,!1,!1,g.time):0==a.flag1||null==a.obj.sigAdministerByMasterSeqIdArray||a.obj.sigAdministerByMasterSeqIdArray==[]?s.warning(a.alertObj.alertTypeWarn,a.alertObj.selectAb,!1,!1,g.time):0==a.flag2||null==a.obj.sigDirectionMasterSeqIdArray||a.obj.sigDirectionMasterSeqIdArray==[]?s.warning(a.alertObj.alertTypeWarn,a.alertObj.selectDirection,!1,!1,g.time):(a.obj.drugtypeseqid=e.dtype.DRFRMTP_SEQ_ID,a.obj.drugseqid=e.dname.DRFRM_SEQ_ID,m.saveSigMasterService(a.obj).then(function(e){var t=e;if(null==t.data.HITService.messageId)if(t.data.HITService.message.errorMessage){t.data.HITService.message.errorMessage;s.failure(a.alertObj.alertTypeFail,a.alertObj.failToinvoke,!1,!1,g.time)}else s.failure(a.alertObj.alertTypeFail,a.alertObj.failToSveSig,!1,!1,g.time);else t.data.HITService.hasOwnProperty("messageId")&&s.success(a.alertObj.alertTypeSucss,a.alertObj.saveSig,!1,!1,g.time);a.clearData(),a.obj={},a.drug={}}))},a.displayUpdateData=function(e){m.displayUpdateDataService(a.obj).then(function(e){var t=e;if(0==t.length&&s.warning(a.alertObj.alertTypeWarn,"",!1,!1,g.time),null==t)if(t.errorMessage){var i=t.errorMessage;s.failure(a.alertObj.alertTypeFail,i,!1,!1,g.time)}else s.failure(a.alertObj.alertTypeFail,a.alertObj.alertTypeFail,!1,!1,g.time);else a.gridApi1.selection.clearSelectedRows(),a.gridApi2.selection.clearSelectedRows(),a.gridCheckRows(t[0],a.SIGMasterSubPageOptions1,a.gridApi1,"sigAdministerByMasterSeqId"),a.gridCheckRows(t[1],a.SIGMasterSubPageOptions2,a.gridApi2,"sigDirectionMasterSeqId")})},a.gridCheckRows=function(e,t,a,i){e=e instanceof Array?e:[e];for(let r=0;r<e.length;r++)for(let n=0;n<t.data.length;n++)e[r][i]==t.data[n][i]&&a.selection.selectRow(t.data[n])},a.sigListGridSearch=function(e,t,i){for(1==i?t.data=a.tempDrugList1:2==i&&(t.data=a.tempDrugList2);e;){var r=e.split(" ");null!=t.data&&0!=t.data.length&&(t.data=S("filter")(t.data,r[0],void 0)),r.shift(),e=0!==r.length?r.join(" "):""}}}e.$inject=["SIGMasterSubPageDefinition1","SIGMasterSubPageDefinition2","$scope","hisModalService","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","CallManager","BILLING_APIS","QueryService","$location","RoleTaskService","SIGMasterPageService","hisAlertConstants","$filter"],angular.module("napierContainerUi").controller("SIGMasterPageController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u){e.agentFormDetails={},e.mode="new",e.agentDetailsList={},e.agentDetailsListSearch={},e.agentCountryDetails={},e.agentCityDetails={},e.agentViewDisable=!1,n.loadModule("billing");var m,g,S=s.getLanguageToSet();n.changeLanguage(S),e.taskIdPermission=r.rolePermission("T_BL_AGENT_MASTER"),e.taskIdPermission_N=e.taskIdPermission.T_BL_AGENT_MASTER_N,e.taskIdPermission_U=e.taskIdPermission.T_BL_AGENT_MASTER_U,e.taskIdPermission_V=e.taskIdPermission.T_BL_AGENT_MASTER_V,l.loadAlerts(S).then(function(t){e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}},function(e){}),e.agentComboInputs={pPracticeId:JSON.parse(sessionStorage.userContextObj).CLIENT_REF_ID,pFacilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID},i.loadCombos("REF_MAST_AGENT_COMBO_STATUS_ALL",e.agentComboInputs).then(function(t){e.agentName=t[1]}),e.selectAgent=function(t,a,i,r){e.agentDetailsListSearch.refAgentCode=t.REFERRAL_AGENT_CODE},e.selectAgentName=function(t,a,i,r){e.agentDetailsListSearch.refAgentName=t.REFERRAL_AGENT_NAME},e.agentGridOptions=angular.copy(o),c.getCountries().then(function(t){e.facilitiesCountryList=angular.copy(t)}),e.getStateDetails=function(t){var a="";a=t.code?angular.fromJson(t.code):angular.fromJson(t.levelValue),c.getStates(a).then(function(t){e.facilitiesStateList=angular.copy(t),e.safeApply()})},e.getCityDetails=function(t){var a="";a=t.addrCode?angular.fromJson(t.addrCode):angular.fromJson(t.levelValue),c.getCity(a).then(function(t){e.facilitiesCityList=angular.copy(t),e.safeApply()})},e.agentCorpClick=function(t,a){e.activeInactiveCode=angular.copy(t);var i={"@class":"com.napier.core.service.vo.emrmasters.ReferralAgentMaster",refAgentCode:e.activeInactiveCode.refAgentCode?e.activeInactiveCode.refAgentCode:"",refAgentName:e.activeInactiveCode.refAgentName?e.activeInactiveCode.refAgentName:"",refAgentSeqId:e.activeInactiveCode.refAgentSeqId,isAgent:1,status:e.activeInactiveCode.status.toString(),address:{"@class":"com.napier.core.service.vo.emrmasters.AddressMasterGenericVo",address1:e.activeInactiveCode.address1?e.activeInactiveCode.address1:"",address2:e.activeInactiveCode.address2?e.activeInactiveCode.address2:"",gnAddressId:e.activeInactiveCode.gnAddressId,pinOrZip:e.activeInactiveCode.pinOrZip?e.activeInactiveCode.pinOrZip:"",resPhone1:e.activeInactiveCode.resPhone1?e.activeInactiveCode.resPhone1:"",resPhone2:e.activeInactiveCode.resPhone2?e.activeInactiveCode.resPhone2:"",createdBy:1,mobileNo:e.activeInactiveCode.mobileNo,emailId:e.activeInactiveCode.emailId,levelMappingVoList:[{"com.napier.core.service.vo.emrmasters.LevelMappingVo":[{level:1,levelDescription:e.activeInactiveCode.listLevelData[0].levelValue,levelValue:e.activeInactiveCode.listLevelData[0].levelValue},{level:2,levelDescription:e.activeInactiveCode.listLevelData[1].levelValue,levelValue:e.activeInactiveCode.listLevelData[1].levelValue},{level:4,levelDescription:e.activeInactiveCode.listLevelData[3].levelValue,levelValue:e.activeInactiveCode.listLevelData[3].levelValue}]}]}},r={};r.url=d.HSC_AGENT_MASTER_DETAILS.URL,r.requestData={operation:"updateReferralAgentMaster",destination:"com.napier.core.master.service.external.ReferralMasterService",messageId:"",message:i},p.sendRestRequest(r).then(function(e){},function(e){})},e.saveAgentObj=!0,e.save=function(t){if("NEW"==t){if(!e.agentDetailsList.$valid)return!e.agentDetailsList.teleMobi&&e.agentDetailsList.agentMobile.$dirty&&(e.agentDetailsList.showMobileErrors=!0),void(e.agentDetailsList.showErrors=!0);(i={}).url=d.HSC_AGENT_MASTER_DETAILS.URL;var a={"@class":"com.napier.core.service.vo.emrmasters.ReferralAgentMaster",refAgentCode:e.agentDetailsList.refAgentCode?e.agentDetailsList.refAgentCode:"",refAgentName:e.agentDetailsList.refAgentName?e.agentDetailsList.refAgentName:"",isAgent:1,status:1,address:{"@class":"com.napier.core.service.vo.emrmasters.AddressMasterGenericVo",address1:e.agentDetailsList.address1?e.agentDetailsList.address1:"",address2:e.agentDetailsList.address2?e.agentDetailsList.address2:"",pinOrZip:e.agentDetailsList.postal?e.agentDetailsList.postal:"",resPhone1:e.agentDetailsList.teleWork?e.agentDetailsList.teleWork:"",resPhone2:e.agentDetailsList.teleHome?e.agentDetailsList.teleHome:"",createdBy:1,mobileNo:e.agentDetailsList.teleMobi,emailId:e.agentDetailsList.email,levelMappingVoList:[{"com.napier.core.service.vo.emrmasters.LevelMappingVo":[{level:1,levelDescription:e.agentCountryDetails.description,levelValue:e.agentCountryDetails.code},{level:2,levelDescription:e.agentCityDetails.addrDescription,levelValue:e.agentCityDetails.addrCode},{level:4,levelDescription:e.agentStateDetails.addrDescription,levelValue:e.agentStateDetails.addrCode}]}]}};i.requestData={operation:"createReferralAgentMaster",destination:"com.napier.core.master.service.external.ReferralMasterService",messageId:"",message:a},p.sendRestRequest(i).then(function(t){if(t.data.HITService.message.errorCode){u.hisAlertMulti("warning","Warning","Agent Code And Agent Name Already Exists",!1,!1,e.close,2e3)}else u.success("Success","Agent Details Saved Successfully"),e.agentSearch(),e.reloadPage(),e.agentCategoryDetails=!1,e.agentCategoryDetailsForm=!1},function(e){})}else if("UPDATE"==t){if(!e.agentDetailsList.$valid)return!e.agentDetailsList.teleMobi&&e.agentDetailsList.agentMobile.$dirty&&(e.agentDetailsList.showMobileErrors=!0),void(e.agentDetailsList.showErrors=!0);var i,r={"@class":"com.napier.core.service.vo.emrmasters.ReferralAgentMaster",refAgentCode:e.agentDetailsList.refAgentCode?e.agentDetailsList.refAgentCode:"",refAgentName:e.agentDetailsList.refAgentName?e.agentDetailsList.refAgentName:"",refAgentSeqId:m,isAgent:1,status:e.agentDetailsList.status,address:{"@class":"com.napier.core.service.vo.emrmasters.AddressMasterGenericVo",address1:e.agentDetailsList.address1?e.agentDetailsList.address1:"",address2:e.agentDetailsList.address2?e.agentDetailsList.address2:"",gnAddressId:g,pinOrZip:e.agentDetailsList.postal?e.agentDetailsList.postal:"",resPhone1:e.agentDetailsList.teleWork?e.agentDetailsList.teleWork:"",resPhone2:e.agentDetailsList.teleHome?e.agentDetailsList.teleHome:"",createdBy:1,mobileNo:e.agentDetailsList.teleMobi,emailId:e.agentDetailsList.email,levelMappingVoList:[{"com.napier.core.service.vo.emrmasters.LevelMappingVo":[{level:1,levelDescription:e.agentCountryDetails.description,levelValue:e.agentCountryDetails.code},{level:2,levelDescription:e.agentCityDetails.addrDescription,levelValue:e.agentCityDetails.addrCode},{level:4,levelDescription:e.agentStateDetails.addrDescription,levelValue:e.agentStateDetails.addrCode}]}]}};(i={}).url=d.HSC_AGENT_MASTER_DETAILS.URL,i.requestData={operation:"updateReferralAgentMaster",destination:"com.napier.core.master.service.external.ReferralMasterService",messageId:"",message:r},p.sendRestRequest(i).then(function(t){u.success("Success","Agent Details Updated Successfully"),e.agentSearch(),e.reloadPage(),e.agentCategoryDetails=!1,e.agentCategoryDetailsForm=!1},function(e){})}else u.warning("Warning","Please select reason for swap")},e.agentSearch=function(){e.bigTotalItems=0;var t={};t.url=d.HSC_AGENT_MASTER_DETAILS.URL,t.requestData={operation:"retrieveReferralAgentMaster",messageId:"",destination:"com.napier.core.master.service.external.ReferralMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.ReferralAgentMaster",refAgentCode:e.agentDetailsListSearch.refAgentCode?e.agentDetailsListSearch.refAgentCode.REFERRAL_AGENT_CODE:"",refAgentName:e.agentDetailsListSearch.refAgentName?e.agentDetailsListSearch.refAgentName.REFERRAL_AGENT_NAME:""}},p.sendRestRequest(t).then(function(t){if(""!=t.data.HITService.message[0]){var a=t.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.ReferralAgentMaster"];if(null!=(a=angular.isArray(a)?a:[a])[0]){e.agentGetDataDetails=[];for(var i=0;i<a.length;i++){var r=a[i].address.levelMappingVoList[0]["com.napier.core.service.vo.emrmasters.LevelMappingVo"];e.agentGetDataDetails.push({refAgentCode:a[i].refAgentCode,refAgentName:a[i].refAgentName,refAgentSeqId:a[i].refAgentSeqId,status:a[i].status,address1:a[i].address.address1,address2:a[i].address.address2,mobileNo:a[i].address.mobileNo,resPhone1:a[i].address.resPhone1,resPhone2:a[i].address.resPhone2,pinOrZip:a[i].address.pinOrZip,emailId:a[i].address.emailId,gnAddressId:a[i].address.gnAddressId,listLevelData:r,permissionId:e.taskIdPermission_V,editPermissionId:e.taskIdPermission_U})}e.agentGridOptions.data=[],e.agentGridOptions.data=e.agentGetDataDetails,e.bigTotalItems=10*Math.ceil(e.agentGridOptions.data.length/e.agentGridOptions.paginationPageSize)}}else{u.hisAlertMulti("warning","Warning","No Data Found",!1,!1,e.close,2e3)}})},e.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)},e.editFlag=function(t,a,i,r,n,l,s){e.agentViewDisable=t,e.agentCategoryDetailsForm=a,e.agentCategoryDetails=i,e.saveBtn=r,e.saveBtn1=n,e.updateBtun1=l,e.manageStatus=s},e.editrow=function(a,i){e.agentCountryDetails="",e.agentCityDetails="",e.agentStateDetails="","U"==e.taskIdPermission_U?e.updateBtun=!0:e.updateBtun=!1;var r=angular.copy(a);e.editFlag(!1,!0,!0,!1,!1,!0,!0),e.agentCodeDisable=!0,e.mode="update",m=r.refAgentSeqId,g=r.gnAddressId,e.agentDetailsList.refAgentName=r.refAgentName,e.agentDetailsList.refAgentCode=r.refAgentCode,e.agentDetailsList.address1=r.address1,e.agentDetailsList.address2=r.address2,e.agentDetailsList.postal=r.pinOrZip,e.agentDetailsList.teleWork=r.resPhone1,e.agentDetailsList.teleHome=r.resPhone2,e.agentDetailsList.teleMobi=r.mobileNo,e.agentDetailsList.email=r.emailId,e.agentDetailsList.status=r.status.toString(),e.agentCountryDetails={code:r.listLevelData[0].levelValue},t(function(){e.getStateDetails(r.listLevelData[0])},10),t(function(){e.agentCityDetails={addrCode:r.listLevelData[1].levelValue}},10),t(function(){e.getCityDetails(r.listLevelData[1])},10),t(function(){e.agentStateDetails={addrCode:r.listLevelData[3].levelValue}},10)},e.commonSetFlag=function(t,a,i,r,n,l){e.updateBtun1=t,e.saveBtn1=a,e.agentCodeDisable=i,e.agentCategoryDetailsForm=r,e.agentCategoryDetails=n,e.agentViewDisable=l},e.editView=function(a,i){e.facilitiesStateList="",e.facilitiesCityList="",e.editFlag(!0,!0,!0,!1,!1,!0,!0),e.updateBtun=!1,e.agentDetailsList.refAgentName=a.refAgentName,e.agentDetailsList.refAgentCode=a.refAgentCode,e.agentDetailsList.address1=a.address1,e.agentDetailsList.address2=a.address2,e.agentDetailsList.postal=a.pinOrZip,e.agentDetailsList.teleWork=a.resPhone1,e.agentDetailsList.teleHome=a.resPhone2,e.agentDetailsList.teleMobi=a.mobileNo,e.agentDetailsList.email=a.emailId,e.agentDetailsList.status=a.status.toString(),e.agentCountryDetails={code:a.listLevelData[0].levelValue},t(function(){e.getStateDetails(a.listLevelData[0])},10),t(function(){e.agentCityDetails={addrCode:a.listLevelData[1].levelValue}},10),t(function(){e.getCityDetails(a.listLevelData[1])},10),t(function(){e.agentStateDetails={addrCode:a.listLevelData[3].levelValue}},10)},e.reloadPage=function(){a.go("agentReportDetails",{},{reload:!0}),e.agentSearch()},e.reset=function(){e.agentDetailsList.refAgentCode="",e.agentDetailsList.refAgentName="",e.agentCountryDetails="",e.agentDetailsList.teleHome="",e.agentDetailsList.teleMobi="",e.agentDetailsList.teleWork="",e.agentDetailsList.email="",e.agentDetailsList.postal="",e.agentDetailsList.address1="",e.agentDetailsList.address2="",e.agentCityDetails="",e.agentStateDetails="",e.facilitiesStateList="",e.facilitiesCityList=""},e.clear=function(){e.agentCategoryDetailsForm=!1,e.agentCategoryDetails=!1,e.facilitiesStateList="",e.facilitiesCityList="",e.agentClaear(),e.reloadPage()},e.agentClaear=function(){e.agentDetailsListSearch.refAgentCode="",e.agentDetailsListSearch.refAgentName="",e.bigTotalItems=0,e.agentSearch()},e.agentAdd=function(){e.mode="new",e.facilitiesStateList="",e.facilitiesCityList="",e.updateBtun=!1,e.manageStatus=!1,"N"==e.taskIdPermission_N?e.saveBtn=!0:e.saveBtn=!1,e.commonSetFlag(!0,!0,!1,!0,!0,!1)},e.getTableHeight=function(){var t;return e.agentGridOptions.data.length>=10?(t=400,t+="px"):0==e.agentGridOptions.data.length?t="200px !important":(t=30*e.agentGridOptions.data.length+30+70,t+="px"),{height:t}};var v={pageNumber:1,pageSize:8,sort:null};e.agentGridOptions.onRegisterApi=function(t){t.pagination.on.paginationChanged(e,function(e,t){v.pageNumber=e,v.pageSize=t})}}e.$inject=["$scope","$timeout","$state","adtDailyReportComboQueryservice","RoleTaskService","hisTranslationsService","hisGenericAlertService","hisTranslationsGlobalLang","agentViewGridList","dropdownServicePermanent","BILLING_APIS","CallManager","hisAlertService"],angular.module("napierContainerUi").controller("agentReportDetailsController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f){u.loadModule("billing");var C=m.getLanguageToSet();u.changeLanguage(C);var I=this;function A(){return moment("1800-01-01T00:00:00.000Z")}function E(){var e=moment();return moment(e.format("YYYY-MM-DD"))}function h(){I.isViewDisable=!0,I.isProceedDisable=!0,I.selectedApprovalListRowData={}}function b(e){I.id=e;var t={1:I.dependencyList=[]},a=D.executeQueryURLReset(),i=new Array;D.prepareParamListWithParam("pRgSeqId",e,i),D.executeQueryInput("GET_ADMIN_ID",i,t,!0,!0,a,"popUp",{}).then(function(e){if(e[1][0]){var t={regSeqId:I.id,admissionSeqid:I.dependencyList[0].IPADM_SEQ_ID};y.getPatientBanner(t,1).then(function(e){S.patientGlobalDtls=e})}})}function T(e,t){var a=angular.copy(I.concession);if(1==t&&(e[0].hasApproved&&(null==e[0].concessionRequest||""==e[0].concessionRequest)||!e[0].hasApproved&&!e[0].hasRejected))return"Please enter concession approval amount/percentage";if(2==t){var i=!0;if(angular.forEach(I.serviceGridOptions.data,function(e,t){if(e.hasApproved&&null!=e.reqserviceLimitPercent&&e.reqserviceLimitPercent>0&&(null==e.concessionRequest||""==e.concessionRequest)||null!=e.reqserviceLimitPercent&&e.reqserviceLimitPercent>0&&!e.hasApproved&&!e.hasRejected)return!0===i&&(i="Please enter concession approval amount/percentage"),!1}),!0!==i)return i}return(0!=I.showApprove||null!=a.approvalRemarks&&""!=a.approvalRemarks)&&(0!=I.showReject||null!=a.cancellationreason&&""!=a.cancellationreason)&&(1!=I.showApprove||1!=I.showReject)||"Please enter the reasons for Approve/Reject"}function _(){I.mainScreen(),I.getGridData(angular.copy(I.search))}function L(){parseInt(I.approvedCount)>0?I.showApprove=!1:I.showApprove=!0,parseInt(I.rejectCount)>0?I.showReject=!1:I.showReject=!0}I.totalPages=0,I.appAndReject=!0,I.approvalorrejectview=!1,I.isSplitBillVisible=!1,I.isApprovalWorkListVisible=!0,I.accordianstatus=!0,I.CD=angular.copy(s),I.CD.dateOnly.maxDate=moment(),I.CD.dateOnly.useCurrent=!1,I.serviceSelected=!1,I.departmentChanged=!1,I.autoCompleteMRNo=[],I.autoCompleteRequestNo=[],I.autoCompleteBillNo=[],I.isGridEmpty=!1,I.isDateError=!1,I.showApprove=!0,I.showReject=!0,I.isDisabledSBARemarks=!0,I.isDisabledSBRRemarks=!0,I.disableOnView=!0,I.gridOptions=angular.copy(r),I.numRows=10,I.billGridOptions=angular.copy(a),I.serviceGridOptions=angular.copy(i),I.splitBillGridOptions=angular.copy(n),I.selectApprovalListRow=!1,I.isShowAllLinkActive=!0,I.isPendingLinkActive=!I.isShowAllLinkActive,I.search={},I.gridrowdata={},I.concession={},I.splitBillForm={},I.approvedCount=0,I.rejectCount=0,I.viewMode=!1,I.search.fromDate=E(),I.search.toDate=E(),I.statusCount={pending:0,approved:0,cancelled:0,rejected:0},I.roleTask=f.rolePermission("T_BL_CONSCTLIST"),t(function e(){l.getTodayStatistics().then(function(a){t(e,12e4),I.statusCount.pending=null==a.pending?0:a.pending,I.statusCount.approved=null==a.approved?0:a.approved,I.statusCount.cancelled=null==a.cancelled?0:a.cancelled,I.statusCount.rejected=null==a.rejected?0:a.rejected},function(a){t(e,12e4)})},0),I.gridOptions.onRegisterApi=function(e){I.gridApi=e,e.selection.on.rowSelectionChanged(null,function(t){var a;(a=e.selection.getSelectedRows()).length>0?(I.selectApprovalListRow=!0,I.selectedApprovalListRowData=a[0],a[0].statusCode==o.PENDING?(I.isViewDisable=!0,I.isProceedDisable=!1):a[0].statusCode==o.APPROVED?(I.isViewDisable=!1,I.isProceedDisable=!0):a[0].statusCode==o.REJECTED?(I.isViewDisable=!1,I.isProceedDisable=!0):a[0].statusCode==o.CANCELLED&&(I.isViewDisable=!0,I.isProceedDisable=!0)):h()})},I.checkDateErr=function(e){I.isDateError=!1,null!=e.fromDate._isAMomentObject&&e.fromDate._isAMomentObject?I.isDateError=!1:I.isDateError=!0,null!=e.toDate._isAMomentObject&&e.toDate._isAMomentObject?I.isDateError=!1:I.isDateError=!0,!I.isDateError&&e.toDate<e.fromDate&&(I.isDateError=!0,p.information("INFORMATION","To date should be greater than From Date"))},I.getShowAll=function(){h(),I.isShowAllLinkActive=!0,I.isPendingLinkActive=!I.isShowAllLinkActive;var e=I.search.fromDate,t=I.search.toDate;I.search={},I.search.fromDate=e||A(),I.search.toDate=t||E(),I.checkDateErr(I.search),I.getGridData(angular.copy(I.search))},I.getPendingReqGridData=function(){I.isShowAllLinkActive=!1,I.isPendingLinkActive=!I.isShowAllLinkActive,h();var e=I.search.fromDate,t=I.search.toDate;I.search={},I.search.status={CODE:1},I.search.fromDate=e||A(),I.search.toDate=t||E(),I.checkDateErr(I.search),I.getGridData(angular.copy(I.search))},I.getGridData=function(e){I.isDateError||l.getGridData(e).then(function(e){I.refresh=!0,I.gridOptions.data=e,I.grid_data=e,I.totalPages=Math.ceil(I.gridOptions.data.length/I.gridOptions.paginationPageSize),I.autoCompleteMRNo=[],I.autoCompleteRequestNo=[],I.autoCompleteBillNo=[],e.length>0&&(I.isGridEmpty=e[0].isGridEmpty),angular.forEach(e,function(e,t){-1==I.autoCompleteMRNo.indexOf(e.MR)&&I.autoCompleteMRNo.push(e.MR),-1==I.autoCompleteRequestNo.indexOf(e.reqno)&&I.autoCompleteRequestNo.push(e.reqno),-1==I.autoCompleteBillNo.indexOf(e.billno)&&I.autoCompleteBillNo.push(e.billno)})})},h(),I.getGridData(angular.copy(I.search)),I.downloadDocuments=function(e,t){I.a=t,l.downloaddocument(e).then(function(e){I.a="data:application/octet-stream;base64,"+e;var a=document.createElement("a");a.download=t,a.href=I.a,a.click(),a.remove()})},I.proceedClick=function(e){if(1==e){if(I.viewMode=!0,I.disableOnView=!1,I.selectApprovalListRow){if(I.selectedApprovalListRowData.reqforCode==c.CONCESSION)I.approvalorrejectview=!0,I.isSplitBillVisible=!1,I.isApprovalWorkListVisible=!1,S.myservice=I.selectedApprovalListRowData,S.pageName="view",I.discountNumberStatus=!0,I.discountNumber=I.selectedApprovalListRowData.reqno;else if(I.selectedApprovalListRowData.reqforCode==c.SPLITBILL){var t=I.selectedApprovalListRowData.concessionReqSeqId;l.getSplitBillView(t).then(function(e){e.statusCode==o.APPROVED?(I.splitBillForm.approvalRemarks=e.remarks,I.selectedApprovalListRowData.hasApproved=!0,I.selectedApprovalListRowData.hasRejected=!1):e.statusCode==o.REJECTED&&(I.splitBillForm.cancellationreason=e.remarks,I.selectedApprovalListRowData.hasApproved=!1,I.selectedApprovalListRowData.hasRejected=!0),I.isSplitBillVisible=!0,I.approvalorrejectview=!1,I.isApprovalWorkListVisible=!1,I.isDisabledSBARemarks=!0,I.isDisabledSBRRemarks=!0,I.splitBillGridOptions.data=[I.selectedApprovalListRowData]})}else I.selectedApprovalListRowData.reqforCode==c.OPPARTIALPAID&&(S.visitFlag=!I.selectedApprovalListRowData.visitNo,l.getOPPartialPaidDetails(I.selectedApprovalListRowData.concessionReqSeqId).then(function(e){if(e){S.opPartialCloseMode=!0,S.opPartialClearMode=!1,S.opPartialSubmitMode=!1,S.opAppRejectStatusMode=!0,S.opAppRejectRemarksMode=!0,S.apao={},S.apao.payAuthTotalAmount=e.totalAmount,S.apao.payAuthPatientAmount=e.patientAmount,S.apao.payAuthPayingAmount=e.patientPayingAmount,S.apao.payAuthDueAmount=e.dueAmount,S.apao.payAuthRemarks=e.requestRemarks,S.apao.arStatus=e.requeststatus.toString(),S.apao.approvalRejectedRemarks=e.appRejRemarks;g.open("PARTIAL PAYMENT AUTHORIZATION",{animation:!0,windowClass:"search-service-modals-popups",templateUrl:"app/consumer/his17_1/billing/screens/approval-worklist/sections/op-visit-mgt-partial-pay-approval.html",scope:S,keyboard:!1,backdrop:"static",size:"lg"})}}));var a=I.selectedApprovalListRowData.rgSeqId;if(S.visitFlag)b(a);else{var i={regSeqId:a};y.getPatientBanner(i,2).then(function(e){S.patientGlobalDtls=e})}d.patientBannerDetail(a).then(function(e){I.patientDetails=e}),l.documentNames(I.selectedApprovalListRowData).then(function(e){I.documentNames=e}),l.concessionReqCombo().then(function(e){I.conReqCombo=e})}}else if(I.viewMode=!1,I.disableOnView=!0,I.selectApprovalListRow){I.selectedApprovalListRowData.reqforCode==c.CONCESSION?(I.approvalorrejectview=!0,I.isSplitBillVisible=!1,I.isApprovalWorkListVisible=!1,S.myservice=I.selectedApprovalListRowData,I.discountNumberStatus=!0,I.discountNumber=I.selectedApprovalListRowData.reqno):I.selectedApprovalListRowData.reqforCode==c.SPLITBILL?(I.isSplitBillVisible=!0,I.isApprovalWorkListVisible=!1,I.approvalorrejectview=!1,I.isDisabledSBARemarks=!0,I.isDisabledSBRRemarks=!0,I.splitBillGridOptions.data=[I.selectedApprovalListRowData]):I.selectedApprovalListRowData.reqforCode==c.OPPARTIALPAID&&(S.visitFlag=!I.selectedApprovalListRowData.visitNo,l.getOPPartialPaidDetails(I.selectedApprovalListRowData.concessionReqSeqId).then(function(e){if(e){S.opPartialCloseMode=!1,S.opPartialClearMode=!0,S.opPartialSubmitMode=!0,S.opAppRejectStatusMode=!1,S.opAppRejectRemarksMode=!1,S.apao={},S.apao.selectedRecord=I.selectedApprovalListRowData,S.apao.partialPaidDetails=e,S.apao.payAuthTotalAmount=e.totalAmount,S.apao.payAuthPatientAmount=e.patientAmount,S.apao.payAuthPayingAmount=e.patientPayingAmount,S.apao.payAuthDueAmount=e.dueAmount,S.apao.payAuthRemarks=e.requestRemarks,S.apao.arStatus="2";g.open("PARTIAL PAYMENT AUTHORIZATION",{animation:!0,windowClass:"search-service-modals-popups",templateUrl:"app/consumer/his17_1/billing/screens/approval-worklist/sections/op-visit-mgt-partial-pay-approval.html",scope:S,keyboard:!1,backdrop:"static",size:"lg"})}}));a=I.selectedApprovalListRowData.rgSeqId;if(S.visitFlag)b(a);else{i={regSeqId:a};y.getPatientBanner(i,2).then(function(e){S.patientGlobalDtls=e})}d.patientBannerDetail(a).then(function(e){I.patientDetails=e}),l.documentNames(I.selectedApprovalListRowData).then(function(e){I.documentNames=e}),l.concessionReqCombo().then(function(e){I.conReqCombo=e})}},I.classFunction=function(e){var t=e.replace(/^.*\./,"");return"doc"==t?"fa fa-file-word-o":"jpg"==t?"fa fa-picture-o ":"pdf"==t?"fa fa-file-pdf-o":void 0},I.approveRejectFormSubmit=function(e){if(I.disableOnView){I.disableOnView=!1;var t={};if(I.check)var a=T(t=angular.copy(I.billGridOptions.data),1);else if(I.checked)a=T(t=angular.copy(I.serviceGridOptions.data),2);if(!0!==a)return p.warning("Warning",a),I.disableOnView=!0,!1;null!=t&&l.submitApprovalorRejectForm(e,t).then(function(e){I.disableOnView=!0,p.success("SUCCESS","Records Successfully Saved"),_()})}},S.opPartialPaidArroval=function(e){if(!e.approvalRejectedRemarks)return p.warning("Warning!","Please Enter Approval / Rejected Remarks"),!1;l.opPartialDetailsSave(e).then(function(e){e.partialPaymentSeqId?(v.dismissAll(),I.searchApprovalDetails(I.search),2==e.requestStatus&&p.success("SUCCESS","Partial Amount Request Approved Successfully"),3==e.requestStatus&&p.success("SUCCESS","Partial Amount Request Rejected Successfully")):p.failure("FAILED"," Save Failed")})},S.opPartialPaidArrovalCancel=function(){S.apao.arStatus="2",S.apao.approvalRejectedRemarks=""},S.opPartialPaidArrovalClose=function(){v.dismissAll()},I.searchApprovalDetails=function(e){if(h(),!e)return p.information("INFORMATION","Please enter a search criteria"),!1;I.search.fromDate||(I.search.fromDate=A()),I.search.toDate||(I.search.toDate=E()),I.checkDateErr(I.search),I.isDateError||l.getGridData(e).then(function(e){I.isShowAllLinkActive=!1,I.isPendingLinkActive=!1,I.gridOptions.data=e,I.totalPages=Math.ceil(I.gridOptions.data.length/I.gridOptions.paginationPageSize),I.autoCompleteMRNo=[],I.autoCompleteRequestNo=[],I.autoCompleteBillNo=[],e.length>0&&(I.isGridEmpty=e[0].isGridEmpty),angular.forEach(e,function(e,t){-1==I.autoCompleteMRNo.indexOf(e.MR)&&I.autoCompleteMRNo.push(e.MR),-1==I.autoCompleteRequestNo.indexOf(e.reqno)&&I.autoCompleteRequestNo.push(e.reqno),-1==I.autoCompleteBillNo.indexOf(e.billno)&&I.autoCompleteBillNo.push(e.billno)})})},I.clearSearchData=function(){I.isShowAllLinkActive=!0,I.isPendingLinkActive=!1,I.search={},I.search.fromDate=E(),I.search.toDate=E(),I.getGridData(angular.copy(I.search))},l.requestForCombo().then(function(e){I.requestForCombo=e}),I.isRejected=function(e){I.concession={},!I.checked||null!=I.serviceGridOptions.data&&I.serviceGridOptions.data.length<2?(I.showReject=!e.hasRejected,e.hasRejected&&(e.hasApproved=!1,I.showApprove=!0)):(e.hasRejected?(I.approvedCount>0&&e.hasApproved&&(I.approvedCount=parseInt(I.approvedCount)-1),e.hasApproved=!1,I.rejectCount=parseInt(I.rejectCount)+1):I.rejectCount>0&&!e.hasRejected&&(I.rejectCount=parseInt(I.rejectCount)-1),L())},I.isApproved=function(e){I.concession={},!I.checked||null!=I.serviceGridOptions.data&&I.serviceGridOptions.data.length<2?(I.showApprove=!e.hasApproved,e.hasApproved&&(e.hasRejected=!1,I.showReject=!0)):(e.hasApproved?(I.rejectCount>0&&e.hasRejected&&(I.rejectCount=parseInt(I.rejectCount)-1),e.hasRejected=!1,I.approvedCount=parseInt(I.approvedCount)+1):I.approvedCount>0&&!e.hasApproved&&(I.approvedCount=parseInt(I.approvedCount)-1),L())},I.concessionCompare=function(e,t){if(1==e.amountType&&null!=e.concessionRequest&&""!=e.concessionRequest&&parseFloat(e.concessionRequest)>0){if("bill"==t){var a=parseFloat(1==e.defaultamountType?e.reqConession:e.requestedAmount);if(a>parseFloat(e.concessionRequest))return e.concessionRequest=e.concessionRequest,!1;e.concessionRequest=a}else if("service"==t&&parseFloat(e.concessionRequest)>parseFloat(e.reqserviceLimitPercent))return e.concessionRequest=e.reqserviceLimitPercent,!1}else if(2==e.amountType&&null!=e.concessionRequest&&""!=e.concessionRequest&&parseFloat(e.concessionRequest)>0){if("bill"==t)return parseFloat(e.concessionRequest)>parseFloat(e.reqbillLimitAmount)&&(e.concessionRequest=e.reqbillLimitAmount),parseFloat(e.reqbillLimitAmount)>parseFloat(e.billAmount)&&parseFloat(e.concessionRequest)>parseFloat(e.billAmount)&&(e.concessionRequest=e.billAmount),!1;if("service"==t)return parseFloat(e.concessionRequest)>parseFloat(e.reqserviceLimitAmount)&&(e.concessionRequest=e.reqserviceLimitAmount),parseFloat(e.reqserviceLimitAmount)>parseFloat(e.totalAmount)&&parseFloat(e.concessionRequest)>parseInt(e.totalAmount)&&(e.concessionRequest=e.totalAmount),!1}else null!=e.concessionRequest&&""!=e.concessionRequest&&0==parseFloat(e.concessionRequest)&&(e.concessionRequest="");return!0},I.concessionCompareChange=function(e){e.concessionRequest=""},I.checkValue=function(e){var t=e.concessionRequest;/^[0-9]\d{0,}(\.\d{0,2})?$/.test(t)||(e.concessionRequest="")},I.isSplitBillApproved=function(e){e.hasApproved?(e.hasRejected=!1,I.isDisabledSBARemarks=!1,I.isDisabledSBRRemarks=!0):I.isDisabledSBARemarks=!0},I.isSplitBillRejected=function(e){e.hasRejected?(e.hasApproved=!1,I.isDisabledSBRRemarks=!1,I.isDisabledSBARemarks=!0):I.isDisabledSBRRemarks=!0},I.submitSplitBillForm=function(e){var t=I.splitBillGridOptions.data[0],a={};a.billSeqId=t.concessionReqSeqId;var i=function(e){return 0!=I.isDisabledSBARemarks||null!=e.approvalRemarks&&0!=e.approvalRemarks.length?0!=I.isDisabledSBRRemarks||null!=e.cancellationreason&&0!=e.cancellationreason.length?1==I.isDisabledSBARemarks&&1==I.isDisabledSBRRemarks?"Please select Approve/Reject":void 0:"Please enter the reasons for Reject":"Please enter the reasons for Approve"}(e);null==i?(t.hasApproved?(a.gnStatus=o.APPROVED,a.remarks=e.approvalRemarks):t.hasRejected&&(a.gnStatus=o.REJECTED,a.remarks=e.cancellationreason),l.updateSplitBillStatus(a).then(function(e){_()})):p.warning("Warning",i)},I.clearSplitBillForm=function(){I.splitBillForm={},I.isDisabledSBRRemarks=!0,I.isDisabledSBARemarks=!0,angular.forEach(I.splitBillGridOptions.data,function(e,t){e.hasApproved=!1,e.hasRejected=!1})},I.clear=function(){I.concession={},angular.forEach(I.billGridOptions.data,function(e,t){null!=e.concessionRequest&&(e.concessionRequest="")}),angular.forEach(I.serviceGridOptions.data,function(e,t){null!=e.concessionRequest&&(e.concessionRequest="")})},l.awlStatusCombo().then(function(e){I.statusCombo=e}),l.getComboDataForVisitType().then(function(e){I.visitTypeForComboList=e}),I.mainScreen=function(){I.approvalorrejectview=!1,I.isSplitBillVisible=!1,I.isApprovalWorkListVisible=!0,I.documentNames=[],I.concession={},I.splitBillForm={},I.billGridOptions.data=[],I.serviceGridOptions.data=[],I.showApprove=!0,I.showReject=!0,I.approvedCount=0,I.rejectCount=0,h()},S.$on("awl.approvalDone",function(e,t){I.mainScreen();var a={fromDate:E(),toDate:E()};I.searchApprovalDetails(a)})}e.$inject=["$mdDialog","$timeout","approveRejectConcessionGridDef","approveRejectServiceGridDef","appWorklistGridDef","SplitBillGridDef","angapprovalWorklistService","hisCalDefConstant","statusCodeConstant","requestForCodeConstant","PatientBannerApproval","hisAlertService","hisTranslationsService","hisTranslationsGlobalLang","hisModalService","$scope","$uibModalStack","QueryService","PatientBannerGlobal","RoleTaskService"],angular.module("napierContainerUi").controller("angapprovalWorklistController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v){t.openNew=function(){S.open("NEW",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/billCancelReq/sections/billingCancel.html",size:"md",scope:t})},t.gridOptions={columnDefs:[{field:"Code",displayName:"Code"},{field:"Description",displayName:"Description"},{field:"Status",displayName:"Status"}]},t.gridOptions.onRegisterApi=function(e){t.gridApi=e}}e.$inject=["$state","$scope","$filter","QueryService","$uibModalStack","$mdDialog","$timeout","hisCalDefConstant","uiGridConstants","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","RoleTaskService","hisAlertConstants","hisModalService","$uibModal"],angular.module("napierContainerUi").controller("billingCancelReqCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C){var I=this;I.rrGridOpts=angular.copy(t),I.rrGridOpts.data=[{}],I._=_,I.deptradio="1",I.general={fetchBy:1,convertType:1},I.ipvisit={},I.inventory={},I.otconfig={},I.opvisit={},I.discount={},I.equipment={},I.roomRent={},I.slotroomRent={},I.cutoffRoomRent={},I.currencySaved=!1,I.generalSaved=!1,I.rentSaved=!1,I.ipSaved=!1,I.discTabSaved=!1,I.corpSaved=!1,I.facilitySelected=!1,I.ageError=!1,I.applyingDrShareError=!1,I.checkSelected=!0,I.onloadData=!1,I.saveCorpTabClicked=!1,I.serviceDiscountCheck=!1,I.itemDiscountCheck=!1,I.isTarrifVal=!1,I.slotDurationErr=!1,I.editFlag=!1,I.hideRate=!0,I.serviceGridOptions=angular.copy(s),I.serviceDiscountOptions=angular.copy(o);var A=JSON.parse(sessionStorage.userContextObj),E=A.WORKSTATION,h=A.FACILITY_ID_DESC,b=A.FACILITY_ID,T=A.FACILITY_CODE.toString();I.general.facilityId=T.trim(),I.errRentStatus=2,I.rrConfig={},I.rrConfig.ipFlwUpCode=null,I.rrConfig.ipFlwUpName=null,I.rrConfig.ipFlwUpseqId=null,u.loadModule("billing");var L=m.getLanguageToSet();u.changeLanguage(L),I.alertObj={},g.loadAlerts(L).then(function(e){I.alertObj=e,I.alertData={buttonText:I.alertObj.ok},I.alertFunction={buttonCallBack1:function(){}},I.close={buttonClose:function(){}}},function(e){}),I.opDeptList=[],I.configOpList=[],I.multipleComboDataForList={1:I.opDeptList,2:I.configOpList};var P=c.executeQueryURLReset();I.opDeptListArr=new Array,c.prepareParamListWithParam("pFacId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,I.opDeptListArr),c.executeQueryInput("GET_OP_VISIT_DEPT_SUB_001",I.opDeptListArr,I.multipleComboDataForList,!0,!1,P,"popUp",I.multipleComboDataForList),I.configOpListArr=new Array,c.executeQueryInput("GET_SERVICE_CONFIG",I.configOpListArr,I.multipleComboDataForList,!0,!0,P,"popUp",I.multipleComboDataForList).then(function(e){if(I.configOpList.length>0)for(var t=0;t<I.configOpList.length;t++)140==I.configOpList[t].BL_CONFIG_SEQ_ID?(I.opvisit.consltCode=I.configOpList[t].SERV_CODE,I.opvisit.consltName=I.configOpList[t].SERV_NAME,I.opvisit.consltseqId=I.configOpList[t].CONFIG_VALUE):141==I.configOpList[t].BL_CONFIG_SEQ_ID?(I.opvisit.flwUpCode=I.configOpList[t].SERV_CODE,I.opvisit.flwUpName=I.configOpList[t].SERV_NAME,I.opvisit.flwUpseqId=I.configOpList[t].CONFIG_VALUE):142==I.configOpList[t].BL_CONFIG_SEQ_ID?(I.opvisit.freeFlwUpCode=I.configOpList[t].SERV_CODE,I.opvisit.freeFlwUpName=I.configOpList[t].SERV_NAME,I.opvisit.freeFlwUpseqId=I.configOpList[t].CONFIG_VALUE):143==I.configOpList[t].BL_CONFIG_SEQ_ID?(I.opvisit.ipFlwUpCode=I.configOpList[t].SERV_CODE,I.opvisit.ipFlwUpName=I.configOpList[t].SERV_NAME,I.opvisit.ipFlwUpseqId=I.configOpList[t].CONFIG_VALUE):144==I.configOpList[t].BL_CONFIG_SEQ_ID&&(I.flagRate=null!=I.configOpList[t].CONFIG_VALUE&&1==I.configOpList[t].CONFIG_VALUE)}),l.getDoctorDetails().then(function(e){angular.forEach(e,function(e,t){"DVC.DOCV_CONFIG_SEQ_ID"==e.name&&(r.docSeqId=e.data)})}),l.searchServices().then(function(e){l.fetchUpdateDetails("CONFIG_MASTER_001").then(function(t){0!=t.length&&(I.onloadData=!0),angular.forEach(t,function(t,a){"ICU Bed Rate Calculations"==t.configDesc&&(t.configVal?I.general.radioCode=t.configVal:I.general.radioCode=0),406==t.configSeqID&&(I.general.fetchBy=t.configVal),407==t.configSeqID&&(I.general.convertType=t.configVal),"Age of the senior citizen"==t.configDesc&&(I.general.ageOfSeniorCitizen=t.configVal),"% of bill to be settled for applying Doctor share"==t.configDesc&&(t.configVal?I.general.billPercent=t.configVal:I.general.billPercent=0),"Service Tax No."==t.configDesc&&(I.general.servTaxNum=t.configVal),"PAN No."==t.configDesc&&(I.general.incomeTaxNum=t.configVal),1==I.general.radioCode&&(I.general.radioCode="1"),2==I.general.radioCode&&(I.general.radioCode="2"),"Registration Service"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.general.regServCode=e.serviceCode,I.general.regServName=e.serviceName)}),"IP Admission Service"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.general.ipServCode=e.serviceCode,I.general.ipServName=e.serviceName)}),"MLC Service"==t.configDesc&&null!=t.configVal&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.general.mlcServCode=e.serviceCode,I.general.mlcServName=e.serviceName)}),"Op Cash Patients allows"==t.configDesc&&("true"==t.configVal?I.general.opCash=!0:I.general.opCash=!1),"OP Default Tariff Class"==t.configDesc&&(I.general.opTariff=t.configVal),"IP Default Tariff Category"==t.configDesc&&(I.general.ipTariff=t.configVal),"OP Default Tariff Category"==t.configDesc&&(I.general.opTariffCat=t.configVal),"Hold Bed Class Charges"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.general.retrievedBedCode=e.serviceCode,I.general.retrievedBedName=e.serviceName)}),"Map service under General Issue"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.generalIssuesCode=e.serviceCode,I.inventory.generalIssuesName=e.serviceName)}),"Map service under General Returns"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.generalReturnCode=e.serviceCode,I.inventory.generalReturnName=e.serviceName)}),"Map service under Pharmacy Issue"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.pharmacyIssuesCode=e.serviceCode,I.inventory.pharmacyIssuesName=e.serviceName)}),"Map service under Pharmacy Returns"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.pharmacyReturnCode=e.serviceCode,I.inventory.pharmacyReturnName=e.serviceName)}),"Map service under CSSD Issue"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.cssdIssuesCode=e.serviceCode,I.inventory.cssdIssuesName=e.serviceName)}),"Map service under CSSD Returns"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.cssdReturnCode=e.serviceCode,I.inventory.cssdReturnName=e.serviceName)}),"Map service under Others Issue"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.cathlabIssuesCode=e.serviceCode,I.inventory.cathlabIssuesName=e.serviceName)}),"Map service under Others Returns"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.cathlabReturnCode=e.serviceCode,I.inventory.cathlabReturnName=e.serviceName)}),"Map service under Stationary Issue"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.stationaryIssuesCode=e.serviceCode,I.inventory.stationaryIssuesName=e.serviceName)}),"Map service under Stationary Returns"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.stationaryReturnCode=e.serviceCode,I.inventory.stationaryReturnName=e.serviceName)}),"Map Service Retail Under pharmacy issue"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.retailIssuesCode=e.serviceCode,I.inventory.retailIssuesName=e.serviceName)}),"Map Service Under Pharmacy Retail Returns"==t.configDesc&&angular.forEach(e,function(e){e.serviceSeqId==t.configVal&&(I.inventory.retailReturnCode=e.serviceCode,I.inventory.retailReturnName=e.serviceName)})})}),l.fetchUpdateDetails("DISC_CONFG_ROOM_RENT").then(function(t){0!=t.length&&(I.onloadData=!0),"No Data"!==t&&angular.forEach(t,function(t,a){if("DSCG.RRC_SEQ_ID"==t.name&&(r.rrcSeqId=t.data),"DSCG.IS_SLOT_LEVEL"==t.name&&(1==t.data?(I.roomRent.confType="1",r.roomType="slot"):(I.roomRent.confType="2",r.roomType="cutoff")),"slot"==r.roomType&&("DSCG.SLOT_DURATION"==t.name&&(I.slotroomRent.slotDuration=t.data),"DSCG.GRACE_PERIOD_ADMISSION"==t.name&&t.data&&(I.slotroomRent.slotGracePeriod=!0,I.slotroomRent.slotGracePeriodTime=t.data),"DSCG.HALF_DAY_CUT_OFF"==t.name&&t.data&&(I.slotroomRent.slotHalfDay=!0,I.slotroomRent.halfDayTime=t.data),"DSCG.FULL_DAY_CUT_OFF"==t.name&&t.data&&(I.slotroomRent.slotFullDay=!0,I.slotroomRent.fullDayTime=t.data),I.slotroomRent.halfDayTime||(I.slotroomRent.halfDayTime=I.slotroomRent.fullDayTime),I.slotroomRent.fullDayTime||(I.slotroomRent.fullDayTime=I.slotroomRent.halfDayTime),"DSCG.HALF_DAY_ROOM_RENT_SERVICE_ID"==t.name&&angular.forEach(e,function(e){e.serviceSeqId==t.data&&(I.slotroomRent.halfDayRentCode=e.serviceCode,I.slotroomRent.halfDayRentName=e.serviceName)}),"DSCG.FULL_DAY_ROOM_RENT_SERVICE_ID"==t.name&&angular.forEach(e,function(e){e.serviceSeqId==t.data&&(I.slotroomRent.fullDayRentCode=e.serviceCode,I.slotroomRent.fullDayRentName=e.serviceName)}),"DSCG.MULTIPLE_TRANSFER"==t.name&&(1==t.data?I.slotroomRent.multipleTransfer=!0:I.slotroomRent.multipleTransfer=!1),"DSCG.IS_APPLY_HEIGHST_TARIFF_CLASS_RATE"==t.name&&(1==t.data?I.slotroomRent.slotTariffRate="01":I.slotroomRent.slotTariffRate="02"),"DSCG.MINTIMESPENT"==t.name&&("02"==I.slotroomRent.slotTariffRate?I.slotroomRent.minTimeSpent="":I.slotroomRent.minTimeSpent=t.data),"DSCG.SOLT_LEVEL_GRACE"==t.name&&t.data&&(I.slotroomRent.slotGracePeriod=!0,I.slotroomRent.slotGracePeriodTime=t.data)),"cutoff"==r.roomType){if(I.cutoffRoomRent.cutoffGracePeriod=!0,"DSCG.GRACE_PERIOD_ADMISSION"==t.name&&t.data&&(I.cutoffRoomRent.graceAdmsnCheck=!0,I.cutoffRoomRent.graceAdmsnTime=t.data),"DSCG.GRACE_PERIOD_DISCHARGE"==t.name&&t.data&&(I.cutoffRoomRent.graceDischargeCheck=!0,I.cutoffRoomRent.graceDischargeTime=t.data),"DSCG.CUTOFF_ADMISSION_TIME"==t.name){var i=t.data.split(" ");I.cutoffRoomRent.cutoffAdmsnTime=i[0],"AM"==i[1]?I.cutoffRoomRent.admissionMeridiam="1":"PM"==i[1]&&(I.cutoffRoomRent.admissionMeridiam="2")}if("DSCG.CUTOFF_DISCHARGE_TIME"==t.name){var n=t.data.split(" ");I.cutoffRoomRent.cutoffDischargeTime=n[0],"AM"==n[1]?I.cutoffRoomRent.cutoffMeridiam="1":"PM"==n[1]&&(I.cutoffRoomRent.cutoffMeridiam="2")}"DSCG.HALF_DAY_CUT_OFF"==t.name&&t.data&&(I.cutoffRoomRent.graceHalfDayCheck=!0,I.cutoffRoomRent.halfDayTime=t.data),"DSCG.FULL_DAY_CUT_OFF"==t.name&&t.data&&(I.cutoffRoomRent.graceFullDayCheck=!0,I.cutoffRoomRent.fullDayTime=t.data),I.cutoffRoomRent.halfDayTime||(I.cutoffRoomRent.halfDayTime=I.cutoffRoomRent.fullDayTime),I.cutoffRoomRent.fullDayTime||(I.cutoffRoomRent.fullDayTime=I.cutoffRoomRent.halfDayTime),"DSCG.DISCHRG_HALF_DAY_CUT_OFF"==t.name&&t.data&&(I.cutoffRoomRent.graceHalfDayCheckDis=!0,I.cutoffRoomRent.halfDayTimeDis=t.data),"DSCG.DISCHRG_FULL_DAY_CUT_OFF"==t.name&&t.data&&(I.cutoffRoomRent.graceFullDayCheckDis=!0,I.cutoffRoomRent.fullDayTimeDis=t.data),"DSCG.ERRSTATUS"==t.name&&t.data&&(I.errRentStatus=parseInt(t.data),I.toggleGridView=!I.toggleGridView),I.cutoffRoomRent.halfDayTimeDis||(I.cutoffRoomRent.halfDayTimeDis=I.cutoffRoomRent.fullDayTimeDis),I.cutoffRoomRent.fullDayTimeDis||(I.cutoffRoomRent.fullDayTimeDis=I.cutoffRoomRent.halfDayTimeDis),"DSCG.HALF_DAY_ROOM_RENT_SERVICE_ID"==t.name&&angular.forEach(e,function(e){e.serviceSeqId==t.data&&(I.cutoffRoomRent.halfDayRentCode=e.serviceCode,I.cutoffRoomRent.halfDayRentName=e.serviceName)}),"DSCG.FULL_DAY_ROOM_RENT_SERVICE_ID"==t.name&&angular.forEach(e,function(e){e.serviceSeqId==t.data&&(I.cutoffRoomRent.fullDayRentCode=e.serviceCode,I.cutoffRoomRent.fullDayRentName=e.serviceName)}),"DSCG.MULTIPLE_TRANSFER"==t.name&&(1==t.data?I.cutoffRoomRent.multipleTransfer=!0:I.cutoffRoomRent.multipleTransfer=!1),"DSCG.IS_APPLY_HEIGHST_TARIFF_CLASS_RATE"==t.name&&(1==t.data?I.cutoffRoomRent.cutoffTariff="01":I.cutoffRoomRent.cutoffTariff="02"),"DSCG.MINTIMESPENT"==t.name&&("02"==I.cutoffRoomRent.cutoffTariff?I.cutoffRoomRent.minTimeSpent="":I.cutoffRoomRent.minTimeSpent=t.data)}})})}),l.fetchUpdateDetails("GET_BED_CLASS_DTL_BY_BL_CONFIG_SEQ_ID").then(function(e){0!=e.length&&(I.onloadData=!0),angular.forEach(e,function(e,t){"CHBBC.CODE"==e.name&&(I.general.retrievedBedCode=e.data),"BC.DESCRIPTION"==e.name&&(I.general.retrievedBedName=e.data)})}),l.fetchUpdateDetails("DISC_CONFG_CURRENCT_TAB").then(function(e){0!=e.length&&(I.onloadData=!0),I.baseCurrency=e.data}),l.fetchUpdateDetails("DISCCOUNT_TAB_CONG").then(function(e){0!=e.length&&(I.onloadData=!0),I.discount.discConf=e+""}),l.fetchUpdateDetails("DISC_CONFG_DISC_TAB").then(function(e){0!=e.length&&(I.onloadData=!0),angular.forEach(e,function(e){if("DISC.BL_CONFIG_SEQ_ID"==e.name&&(r.corpSeqId=e.data),"DISC.PAYER_TYPE"==e.name&&e.data){I.discount.payer=e.data;var t=e.data;l.payerSelectionTariffCat("COMPBASED_TARIFF_COMBO",t).then(function(e){null!=e&&e.DESCRIPTION?(I.discount.tarrifCat=e.DESCRIPTION,I.isTarrifVal=!0):I.discount.tarrifCat||(I.isTarrifVal=!1)})}"DISC.SERVICE_DIS_OP"==e.name&&e.data&&(I.discount.serviceOPCheck=!0,I.discount.serviceOP=e.data),"DISC.SERVICE_DIS_IP"==e.name&&e.data&&(I.discount.serviceIPCheck=!0,I.discount.serviceIP=e.data),"DISC.ITEM_DISC_OP"==e.name&&e.data&&(I.discount.itemOPCheck=!0,I.discount.itemOP=e.data),"DISC.ITEM_DISC_IP"==e.name&&e.data&&(I.discount.itemIPCheck=!0,I.discount.itemIP=e.data)})}),I.mapService=function(t,a){if(I.rowSeleted=!1,I.serviceType="",I.subServiceType="",I.serviceName="",I.serviceFlag=!1,I.serviceGridOptions.data=[],I.popupname=a,"companionConfiguration"==a&&(I.serviceType=10030,I.serviceFlag=!0,I.onDeptChange(I.serviceType),I.searchService(I.serviceType,I.subServiceType,I.serviceName,!0)),"MLCService"==a&&(I.popupData=void 0,I.general.mlcServCode=void 0,I.general.mlcServName=void 0),I.modalInstance1=i.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"myModalContent1.html",size:t,scope:r,resolve:{popupData:function(){return I.popupData}}}),I.modalInstance1.result.then(function(t){if(t){I.selected=t;var a=I.selected[0].data.serviceCode,i=I.selected[0].data.serviceName,r=I.selected[0].data.serviceSeqId;I.rowSeleted&&("holdService"==I.selected[0].popupname?(I.general.retrievedBedCode=a,I.general.retrievedBedName=i):"isoService"==I.selected[0].popupname?(I.general.isolatedBedCode=a,I.general.isolatedBedName=i):"dualService"==I.selected[0].popupname?(I.general.dualBedCode=a,I.general.dualBedName=i):"IPService"==I.selected[0].popupname?(I.general.ipServCode=a,I.general.ipServName=i):"RegService"==I.selected[0].popupname?(I.general.regServCode=a,I.general.regServName=i):"MLCService"==I.selected[0].popupname?(I.general.mlcServCode=a,I.general.mlcServName=i):"FirstVisit"==I.selected[0].popupname?(I.data.firstVisitServId=r,I.data.firstServName=i,I.data.firstServCode=a):"DayVisit"==I.selected[0].popupname?(I.data.dayVisitServId=r,I.data.dayServName=i,I.data.dayServCode=a):"NightVisit"==I.selected[0].popupname?(I.data.nightVisitvServId=r,I.data.nightServName=i,I.data.nightServCode=a):"Pharmacy Issues"==I.selected[0].popupname?(I.inventory.pharmacyIssuesCode=a,I.inventory.pharmacyIssuesName=i):"Pharmacy Return"==I.selected[0].popupname?(I.inventory.pharmacyReturnCode=a,I.inventory.pharmacyReturnName=i):"General Issue"==I.selected[0].popupname?(I.inventory.generalIssuesCode=a,I.inventory.generalIssuesName=i):"General Return"==I.selected[0].popupname?(I.inventory.generalReturnCode=a,I.inventory.generalReturnName=i):"CSSD Issues"==I.selected[0].popupname?(I.inventory.cssdIssuesCode=a,I.inventory.cssdIssuesName=i):"CSSD Return"==I.selected[0].popupname?(I.inventory.cssdReturnCode=a,I.inventory.cssdReturnName=i):"Cathlab Issue"==I.selected[0].popupname?(I.inventory.cathlabIssuesCode=a,I.inventory.cathlabIssuesName=i):"Cathlab Return"==I.selected[0].popupname?(I.inventory.cathlabReturnCode=a,I.inventory.cathlabReturnName=i):"Stationary Issues"==I.selected[0].popupname?(I.inventory.stationaryIssuesCode=a,I.inventory.stationaryIssuesName=i):"Stationary Return"==I.selected[0].popupname?(I.inventory.stationaryReturnCode=a,I.inventory.stationaryReturnName=i):"Retail Issue"==I.selected[0].popupname?(I.inventory.retailIssuesCode=a,I.inventory.retailIssuesName=i):"Retail Return"==I.selected[0].popupname?(I.inventory.retailReturnCode=a,I.inventory.retailReturnName=i):"SlotHalfDay"==I.selected[0].popupname?(I.slotroomRent.halfDayRentCode=a,I.slotroomRent.halfDayRentName=i):"SlotFullDay"==I.selected[0].popupname?(I.slotroomRent.fullDayRentCode=a,I.slotroomRent.fullDayRentName=i):"CutHalfDay"==I.selected[0].popupname?(I.cutoffRoomRent.halfDayRentCode=a,I.cutoffRoomRent.halfDayRentName=i):"CutFullDay"==I.selected[0].popupname?(I.cutoffRoomRent.fullDayRentCode=a,I.cutoffRoomRent.fullDayRentName=i):"newConslt"==I.selected[0].popupname?(I.opvisit.consltCode=a,I.opvisit.consltName=i,I.opvisit.consltseqId=r):"followUp"==I.selected[0].popupname?(I.opvisit.flwUpCode=a,I.opvisit.flwUpName=i,I.opvisit.flwUpseqId=r):"freeFollowUp"==I.selected[0].popupname?(I.opvisit.freeFlwUpCode=a,I.opvisit.freeFlwUpName=i,I.opvisit.freeFlwUpseqId=r):"ipFollowUp"==I.selected[0].popupname?(I.opvisit.ipFlwUpCode=a,I.opvisit.ipFlwUpName=i,I.opvisit.ipFlwUpseqId=r):"EquipConfiguration"==I.selected[0].popupname?(I.equipment.ipFlwUpCode=a,I.equipment.ipFlwUpName=i,I.equipment.ipFlwUpseqId=r,e.$broadcast("equipmentVal",I.equipment)):"OtConfiguration"==I.selected[0].popupname?(I.otconfig.ipFlwUpCode=a,I.otconfig.ipFlwUpName=i,I.otconfig.ipFlwUpseqId=r,e.$broadcast("otconfigVal",I.otconfig)):"EmrRRConfiguration"==I.selected[0].popupname?(I.rrConfig.ipFlwUpCode=a,I.rrConfig.ipFlwUpName=i,I.rrConfig.ipFlwUpseqId=r):"companionConfiguration"==I.selected[0].popupname&&(I.servicedtail.ipFlwUpCode=a,I.servicedtail.ipFlwUpName=i,I.servicedtail.ipFlwUpseqId=r,N()))}}),"companionConfiguration"!=a){var n=!1;3==r.activeFirst&&(n=!0),l.searchServices("","","",n).then(function(e){I.serviceListArr=e})}},I.rowDblClick=function(e){r.rowData=e,I.rowSeleted=!0},I.mapData=function(){var e=r.rowData;if(e){I.popupData=[];var t={data:e.entity,popupname:I.popupname};I.popupData.push(t),I.modalInstance1.close(I.popupData)}},I.cancelMapService=function(){I.modalInstance1.close(I.popupData)},I.items=[],I.activeBed=function(e,t){I.modalInstance=i.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"myModalContent.html",size:e,scope:r,resolve:{items:function(){return I.items}}}),I.modalInstance.result.then(function(e){I.selected=e,"hold"==t&&(I.general.retrievedBedCode=I.selected[0].holdbedcode,I.general.retrievedBedName=I.selected[0].holdbedname),"isolate"==t&&(I.general.isolatedBedCode=I.selected[0].holdbedcode,I.general.isolatedBedName=I.selected[0].holdbedname),"dual"==t&&(I.general.dualBedCode=I.selected[0].holdbedcode,I.general.dualBedName=I.selected[0].holdbedname)})},I.onBedTypeChange=function(e){I.retrievedBedCode=e,angular.forEach(I.bedTypeComboObj,function(t,a){t.CODE==e&&(I.retrievedBedName=t.DESCRIPTION)})},I.bedSelection=function(e){I.items=[],angular.forEach(I.bedTypeComboObj,function(t,a){t.CODE==e&&(I.holdObj={holdbedname:t.DESCRIPTION,holdbedcode:t.CODE})}),I.items.push(I.holdObj),I.bedType=""},l.comboBoxFetch("FACILITY_DROPDOWN").then(function(e){I.facilityComboObj=e}),I.bedTypeComboObj=[],l.comboBoxFetch("GET_ACTIVE_BED_CLASSES").then(function(e){I.bedTypeComboObj=e}),l.comboBoxFetch("TARIFF_CARG").then(function(e){I.tariffCatComboObj=e}),l.comboBoxFetch("SCM_SERV_001").then(function(e){I.serviceComboObj=e}),I.onDeptChange=function(e){l.comboBoxFetch("SCM_SERV_002",e).then(function(e){I.subServiceComboObj=e})},I.onSubDeptChange=function(e){e&&l.comboBoxFetch("SCM_SERV_003",e).then(function(e){I.serviceNameComboObj=e})},l.comboBoxFetch("GET_CURRENCY_COUNTRY_DATA").then(function(e){I.currencyComboObj=e}),I.searchService=function(e,t,a,i){var n=!1;3==r.activeFirst&&(n=!0),l.searchServices(e,t,a,n).then(function(e){I.serviceGridOptions.data=e,i&&(I.serviceListArr=e)})},I.serviceListArr=[],I.getServiceDetails=function(e,t){e&&t&&l.searchServices(e,t).then(function(e){I.serviceListArr=e})},I.saveCurrencyDetails=function(e){if(e)l.saveCurrency(e).then(function(e){if(e.data.HITService.message.configurationBillingMasterList[0]["com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster"].configValue){var t=I.alertObj.savdSucesFuly;n.hisAlertMulti("success",I.alertObj.alertTypeConf,t,I.alertData,I.alertFunction,I.close),I.currencySaved=!0}});else{var t=I.alertObj.PlzFlAlMndtryFlds;n.hisAlertMulti("warning",I.alertObj.alertTypeConf,t,I.alertData,I.alertFunction,I.close)}},I.generalConfigSave=function(e){if(e.ageOfSeniorCitizen>120||e.ageOfSeniorCitizen<50)I.ageError=!0;else if(I.ageError=!1,I.general.billPercent>100||I.general.billPercent<0)I.applyingDrShareError=!0;else{I.applyingDrShareError=!1;var t=e;if(t.facilityId&&t.ageOfSeniorCitizen&&null!=t.billPercent&&t.servTaxNum&&t.incomeTaxNum&&t.opTariff&&t.ipTariff&&t.regServCode&&t.regServName&&t.ipServCode&&t.ipServName)l.searchServices().then(function(t){angular.forEach(t,function(t){t.serviceCode==e.ipServCode&&(I.ipSeqId=t.serviceSeqId),t.serviceCode==e.regServCode&&(I.regSeqId=t.serviceSeqId),null!=e.mlcServCode&&t.serviceCode==e.mlcServCode&&(I.mlcSeqId=t.serviceSeqId),t.serviceCode==e.retrievedBedCode&&(I.holdSeqId=t.serviceSeqId),t.serviceCode==e.isolatedBedCode&&(I.isoSeqId=t.serviceSeqId),t.serviceCode==e.dualBedCode&&(I.dualSeqId=t.serviceSeqId)});var a={ipSeqId:I.ipSeqId,regSeqId:I.regSeqId,mlcSeqId:I.mlcSeqId};l.saveGeneralConfig(e,a).then(function(e){if(e){var t=I.alertObj.savdSucesFuly;n.hisAlertMulti("success",I.alertObj.alertTypeConf,t,I.alertData,I.alertFunction,I.close),I.generalSaved=!0}})});else{var a=I.alertObj.PlzFlAlMndtryFlds;n.hisAlertMulti("warning",I.alertObj.alertTypeConf,a,I.alertData,I.alertFunction,I.close)}}},I.roleTask=D.rolePermission("T_BL_M_CONFIGURATION"),I.ongeneralConfigUpdate=function(){I.generalSaved=!1},I.onrentConfigUpdate=function(e){I.rentSaved=!1,"1"==e&&(I.slotSaved=!1),"2"==e&&(I.cutoffSaved=!1)},I.saveIPDetails=function(e){if("1"!=I.data.isFirstVisitBillable||I.data.firstVisitServId)if("1"!=I.data.isDayVisitBillable||I.data.dayVisitServId)if("1"!=I.data.isNightVisitBillable||I.data.nightVisitvServId){var t=[],a=I.allDoctorGridOptions.data;if(I.admittingDoctorGridOptions.data.length>1)var i=_.concat(I.admittingDoctorGridOptions.data);else i=angular.copy(a);if(I.otherDoctorGridOptions.data.length>1)var r=_.concat(i,I.otherDoctorGridOptions.data);else r=angular.copy(i);if(I.deletedList.length>0)var l=_.concat(r,I.deletedList);else l=angular.copy(r);delete y.ngModelOptions.timezone;for(var s=1;s<l.length;s++){var o=l[s];o.applicabilityType&&t.push({"@class":"com.napier.core.dao.entities.corebillingmasters.DoctorVisitBillingRuleVo",dvbrSeqId:o.dvbrSeqId,maxVisitNo:o.visitNo,visitPriority:o.visitPriority.gQDataCode,visitType:o.visitType.gQDataCode,applicabilityType:o.applicabilityType,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,createdOn:o.dvbrSeqId?void 0:moment().format("YYYY-MM-DD HH:mm:ss"),facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,lastUpdatedOn:moment().format("YYYY-MM-DD HH:mm:ss"),gnStatus:o.gnStatus})}var c=[];I.data.allDoctor&&c.push(1),I.data.otherDoctor&&c.push(3),I.data.admittingDoctor&&c.push(2);var d={"@class":"com.napier.core.dao.entities.corebillingmasters.DoctorVisitServiceVo",firstVisitServId:I.data.firstVisitServId?I.data.firstVisitServId:void 0,dayVisitServId:I.data.dayVisitServId?I.data.dayVisitServId:void 0,nightVisitvServId:I.data.nightVisitvServId?I.data.nightVisitvServId:void 0,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,applicabilityType:_.toString(c),practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnTranStatus:1,docConfigSeqId:I.data.docConfigSeqId?I.data.docConfigSeqId:void 0,isFirstVisitBillable:I.data.isFirstVisitBillable,isDayVisitBillable:I.data.isDayVisitBillable,isNightVisitBillable:I.data.isNightVisitBillable,doctorVisitBillingRuleVoList:[{"com.napier.core.dao.entities.corebillingmasters.DoctorVisitBillingRuleVo":t}]};S.saveIpConfigService(d).then(function(e){e.data.HITService.message&&e.data.HITService.message.doctorVisitBillingRuleVoList?(n.success("success","Data Saved successfully"),I.allDoctorGridOptions.data=[],I.admittingDoctorGridOptions.data=[],I.otherDoctorGridOptions.data=[],I.ipClear(1),I.ipClear(2),I.ipClear(3),R(),I.deletedList=[]):n.information("information","Data Not Saved")})}else n.information("information","Please Select Night Visit Service");else n.information("information","Please Select day Visit Service");else n.information("information","Please Select First Visit Service")},I.updateIPDetails=function(){I.ipSaved=!1},I.inventorySave=function(e){var t=e;if(t.pharmacyIssuesCode&&t.pharmacyReturnCode&&t.generalIssuesCode&&t.generalReturnCode&&t.cssdIssuesCode&&t.cssdReturnCode&&t.cathlabIssuesCode&&t.cathlabReturnCode&&t.stationaryIssuesCode&&t.stationaryReturnCode&&t.retailIssuesCode&&t.retailReturnCode)l.searchServices().then(function(t){angular.forEach(t,function(t){t.serviceCode==e.pharmacyIssuesCode&&(I.pharmacyIssuesSeqId=t.serviceSeqId),t.serviceCode==e.pharmacyReturnCode&&(I.pharmacyReturnSeqId=t.serviceSeqId),t.serviceCode==e.generalIssuesCode&&(I.generalIssuesSeqId=t.serviceSeqId),t.serviceCode==e.generalReturnCode&&(I.generalReturnSeqId=t.serviceSeqId),t.serviceCode==e.cssdIssuesCode&&(I.cssdIssuesSeqId=t.serviceSeqId),t.serviceCode==e.cssdReturnCode&&(I.cssdReturnSeqId=t.serviceSeqId),t.serviceCode==e.cathlabReturnCode&&(I.cathlabReturnSeqId=t.serviceSeqId),t.serviceCode==e.stationaryIssuesCode&&(I.stationaryIssuesSeqId=t.serviceSeqId),t.serviceCode==e.stationaryReturnCode&&(I.stationaryReturnSeqId=t.serviceSeqId),t.serviceCode==e.retailIssuesCode&&(I.retailIssuesSeqId=t.serviceSeqId),t.serviceCode==e.retailReturnCode&&(I.retailReturnSeqId=t.serviceSeqId),t.serviceCode==e.cathlabIssuesCode&&(I.cathlabIssuesSeqId=t.serviceSeqId)});var a={pharmacyIssuesSeqId:I.pharmacyIssuesSeqId,pharmacyReturnSeqId:I.pharmacyReturnSeqId,generalIssuesSeqId:I.generalIssuesSeqId,generalReturnSeqId:I.generalReturnSeqId,cssdIssuesSeqId:I.cssdIssuesSeqId,cssdReturnSeqId:I.cssdReturnSeqId,cathlabIssuesSeqId:I.cathlabIssuesSeqId,cathlabReturnSeqId:I.cathlabReturnSeqId,stationaryIssuesSeqId:I.stationaryIssuesSeqId,stationaryReturnSeqId:I.stationaryReturnSeqId,retailIssuesSeqId:I.retailIssuesSeqId,retailReturnSeqId:I.retailReturnSeqId};l.saveInventoryDetails(a).then(function(e){if(e){var t=I.alertObj.savdSucesFuly;n.hisAlertMulti("success",I.alertObj.alertTypeConf,t,I.alertData,I.alertFunction,I.close),I.invSaved=!0}})});else{var a=I.alertObj.PlzFlAlMndtryFlds;n.hisAlertMulti("warning",I.alertObj.alertTypeConf,a,I.alertData,I.alertFunction,I.close)}},I.inventoryUpdate=function(){I.invSaved=!1},I.discountCBSelection=function(e){"corpSelected"!=e&&"highValSelected"!=e||l.comboBoxFetch("SCM_EMER_NOT_ALLOW_SERVICES_01").then(function(e){I.payerComboObj=e})},I.payerSelection=function(e){I.discount.tarrifCat="",l.payerSelectionTariffCat("COMPBASED_TARIFF_COMBO",e).then(function(e){e?(I.discount.tarrifCat=e.DESCRIPTION,I.discount.tarrifCat?I.isTarrifVal=!0:I.discount.tarrifCat||(I.isTarrifVal=!1)):I.isTarrifVal=!1})},I.highPayerSelection=function(e){I.serviceDiscountOptions.data=[],l.payerSelectionTariffCat("COMPBASED_TARIFF_COMBO",e).then(function(e){e?(r.highTariffCatCode=e.CODE,I.discount.highTariffCat=e.DESCRIPTION,I.discount.highTariffCat?I.ishighTarrifVal=!0:I.discount.highTariffCat||(I.ishighTarrifVal=!1,I.discount.highTariffCat="")):(I.ishighTarrifVal=!1,I.discount.highTariffCat="")})},I.discountVal=function(e){I.discountValErr=e>100||e<0},I.onHalfDayTime=function(e){if(e){I.slotroomRent.fullDayTime=e;var t=moment(e,"HH:mm a");if(I.slotroomRent.slotGracePeriodTime){var a=moment(I.slotroomRent.slotGracePeriodTime,"HH:mm a");I.slotGraceTimeErr=t<a}if(I.slotroomRent.slotDuration){var i=moment(I.slotroomRent.slotDuration,"HH:mm a");I.slotDurationTimeErr=t>i}}else I.slotroomRent.fullDayTime=""},I.onFullDayTime=function(e){if(e){I.slotroomRent.halfDayTime=e;e=moment(e,"HH:mm a");if(I.slotroomRent.slotGracePeriodTime){var t=moment(I.slotroomRent.slotGracePeriodTime,"HH:mm a");e<t?I.slotGraceTimeErr=!0:e._i==t._i?(I.slotroomRent.halfDayTime="00:00",I.slotGraceTimeErr=!1):I.slotGraceTimeErr=!1}I.slotroomRent.halfDayTime}else I.slotroomRent.halfDayTime=""},I.onGraceHalfDayBlur=function(e){if(e){I.cutoffRoomRent.fullDayTime=e;var t=moment(e,"HH:mm a");if(I.cutoffRoomRent.graceAdmsnTime){var a=moment(I.cutoffRoomRent.graceAdmsnTime,"HH:mm a");I.cutoffullGraceTimeErr=t<a}}else I.cutoffRoomRent.fullDayTime=""},I.onGraceFullDayBlur=function(e){if(e){I.cutoffRoomRent.halfDayTime=e;e=moment(e,"HH:mm a");if(I.cutoffRoomRent.graceAdmsnTime){var t=moment(I.cutoffRoomRent.graceAdmsnTime,"HH:mm a");e<t?I.cutoffullGraceTimeErr=!0:e._i==t._i?(I.cutoffRoomRent.halfDayTime="00:00",I.cutoffullGraceTimeErr=!1):I.cutoffullGraceTimeErr=!1}}else I.cutoffRoomRent.halfDayTime=""},I.onDiscHalfDayBlur=function(e){if(e){I.cutoffRoomRent.fullDayTimeDis=e;var t=moment(e,"HH:mm a");if(I.cutoffRoomRent.graceDischargeTime){var a=moment(I.cutoffRoomRent.graceDischargeTime,"HH:mm a");I.cutoffullGraceTimeErr=t<a}}else I.cutoffRoomRent.fullDayTimeDis=""},I.onDiscFullDayBlur=function(e){if(e){I.cutoffRoomRent.halfDayTimeDis=e;e=moment(e,"HH:mm a");if(I.cutoffRoomRent.graceDischargeTime){var t=moment(I.cutoffRoomRent.graceDischargeTime,"HH:mm a");e<t?I.cutoffullGraceTimeErr=!0:e._i==t._i?(I.cutoffRoomRent.halfDayTimeDis="00:00",I.cutoffullGraceTimeErr=!1):I.cutoffullGraceTimeErr=!1}}else I.cutoffRoomRent.halfDayTimeDis=""},I.roomRentConfig=function(e,t){if("1"==I.roomRent.confType){if(I.slotDurationErr||I.gracePeriodErr||I.gracePeriodEmpty||I.slotHalfDayTimeErr||I.slotGraceTimeErr||I.slotDurationTimeErr||I.halfOrFullEmpty||I.minTimeErr)return;if(e.halfDayTime||e.fullDayTime){if(!e.slotGracePeriodTime)return I.gracePeriodErr=!1,void(I.gracePeriodEmpty=!0);e.slotGracePeriodTime&&(I.gracePeriodErr=!1,I.gracePeriodEmpty=!1)}if(e.slotGracePeriodTime){if(!e.halfDayTime||!e.fullDayTime)return void(I.halfOrFullEmpty=!0);(e.halfDayTime||e.fullDayTime)&&(I.halfOrFullEmpty=!1)}1==I.slotroomRent.slotHalfDay&&(e.fullDayTime=""),1==I.slotroomRent.slotFullDay&&(e.halfDayTime=""),I.roomrentSave(e)}else if("2"==I.roomRent.confType){if(I.cutoffAdmsnTimeErr||I.cutoffDischargeTimeErr||I.graceAdmsnTimeErr||I.graceDischargeTimeErr||I.graceAdmsnEmpty||I.graceDisEmpty||I.halfDayTimeErr||I.fullDayTimeErr||I.halfDayTimeErrDis||I.fullDayTimeErrDis||I.cutoffDurationTimeErr||I.cutoffullGraceTimeErr||I.cutoffHalfOrFullEmpty||I.minTimeSpentErr)return;if(t.halfDayTime||t.fullDayTime){if(!t.graceAdmsnTime)return I.graceAdmsnTimeErr=!1,void(I.graceAdmsnEmpty=!0);t.graceAdmsnTime&&(I.graceAdmsnTimeErr=!1,I.graceAdmsnEmpty=!1)}if(t.halfDayTimeDis||t.fullDayTimeDis){if(!t.graceDischargeTime)return I.graceDischargeTimeErr=!1,void(I.graceDisEmpty=!0);t.graceDischargeTime&&(I.graceDischargeTimeErr=!1,I.graceDisEmpty=!1)}if(t.graceAdmsnTime){if(!t.halfDayTime||!t.fullDayTime)return void(I.cutoffHalfOrFullEmpty=!0);I.cutoffHalfOrFullEmpty=!1}if(t.graceDischargeTime){if(!t.halfDayTimeDis||!t.fullDayTimeDis)return void(I.cutoffHalfOrFullEmpty=!0);I.cutoffHalfOrFullEmpty=!1}1==t.graceHalfDayCheck&&(t.fullDayTime=""),1==t.graceFullDayCheck&&(t.halfDayTime=""),1==t.graceHalfDayCheckDis&&(t.fullDayTimeDis=""),1==t.graceFullDayCheckDis&&(t.halfDayTimeDis=""),I.roomrentSave(t)}},I.roomrentSave=function(e){l.searchServices().then(function(t){angular.forEach(t,function(t){t.serviceCode==e.halfDayRentCode&&(I.halfDayRentCode=t.serviceSeqId),t.serviceCode==e.fullDayRentCode&&(I.fullDayRentCode=t.serviceSeqId)});var a={halfDayRentCode:I.halfDayRentCode,fullDayRentCode:I.fullDayRentCode},i={machineIP:E,practiceId:h,facilityId:b};r.rrcSeqId&&(e.rrcSeqId=r.rrcSeqId),1==I.roomRent.confType?e.slotLv=1:2==I.roomRent.confType&&(e.slotLv=0),e.slotTariffRate&&("01"==e.slotTariffRate?e.tariff=1:e.tariff=0),e.cutoffTariff&&("01"==e.cutoffTariff?e.tariff=1:e.tariff=0),l.saveRoomRentDetails(a,e,i).then(function(e){var t=I.alertObj.savdSucesFuly;n.hisAlertMulti("success",I.alertObj.alertTypeConf,t,I.alertData,I.alertFunction,I.close),I.rentSaved=!0,"1"==I.roomRent.confType&&(I.slotSaved=!0,I.slotroomRent.slotHalfDay&&(I.slotroomRent.fullDayTime=I.slotroomRent.halfDayTime),I.slotroomRent.slotFullDay&&(I.slotroomRent.halfDayTime=I.slotroomRent.fullDayTime),"02"==I.slotroomRent.slotTariffRate&&(I.slotroomRent.minTimeSpent="")),"2"==I.roomRent.confType&&(I.cutoffSaved=!0,I.cutoffRoomRent.graceHalfDayCheck&&(I.cutoffRoomRent.fullDayTime=I.cutoffRoomRent.halfDayTime),I.cutoffRoomRent.graceFullDayCheck&&(I.cutoffRoomRent.halfDayTime=I.cutoffRoomRent.fullDayTime),I.cutoffRoomRent.graceHalfDayCheckDis&&(I.cutoffRoomRent.fullDayTimeDis=I.cutoffRoomRent.halfDayTimeDis),I.cutoffRoomRent.graceFullDayCheckDis&&(I.cutoffRoomRent.halfDayTimeDis=I.cutoffRoomRent.fullDayTimeDis))})})},I.saveDiscTab=function(e){l.saveDiscountDetails(e).then(function(e){if(e){var t=I.alertObj.savdSucesFuly;n.hisAlertMulti("success",I.alertObj.alertTypeConf,t,I.alertData,I.alertFunction,I.close),I.discTabSaved=!0}})},I.ondiscountConfigUpdate=function(){I.discTabSaved=!1},I.saveCorpTab=function(e){if(I.saveCorpTabClicked=!0,I.discount.serviceOP>100||I.discount.serviceOP<0)I.serviceDiscountCheck=!0;else if(I.serviceDiscountCheck=!1,I.discount.serviceIP>100||I.discount.serviceIP<0)I.serviceDiscountCheck=!0;else if(I.serviceDiscountCheck=!1,I.discount.itemOP>100||I.discount.itemOP<0)I.itemDiscountCheck=!0;else if(I.itemDiscountCheck=!1,I.discount.itemIP>100||I.discount.itemIP<0)I.itemDiscountCheck=!0;else{I.itemDiscountCheck=!1;var t={machineIP:E,practiceId:h,facilityId:b};l.payerSelectionTariffCat("COMPBASED_TARIFF_COMBO",e.payer).then(function(a){var i=a.CODE;if(r.corpSeqId)var s=r.corpSeqId;l.saveCorporateDetails(e,t,i,s).then(function(e){if(e){var t=I.alertObj.savdSucesFuly;n.hisAlertMulti("success",I.alertObj.alertTypeConf,t,I.alertData,I.alertFunction,I.close),I.corpSaved=!0}})})}},I.onCorpUpdate=function(){I.corpSaved=!1},I.searchServiceDiscount=function(e,t){if(I.discount.quickSearch="",null==t||""==t)n.hisAlertMulti("warning",I.alertObj.alertTypeWarn,I.alertObj.PlzEntrMissTariffCat,I.alertData,I.alertFunction,I.close),I.highValDisclear();else{var a=r.highTariffCatCode;I.serviceDiscountOptions.data=[],l.searchDiscountServices(e,a).then(function(e){if(e){I.serviceDiscountOptions.data=e;var t=e.length-1;r.compHldiscHdSeqId=e[t].compHldiscHdSeqId,I.discount.billamount=e[t].billLimitValue}})}},I.highValServiceSearch=function(e,t,a){I.serviceDiscountOptions.data=[],e?l.highValDiscSearch(e,a).then(function(e){I.serviceDiscountOptions.data=e}):I.searchServiceDiscount(t,a)},I.onCurrencyUpdate=function(){I.currencySaved=!1},I.depositAmountBlur=function(e){e.entity.editable=!1},I.editDetails=function(e){e.entity.editable=!0},I.discountAmountBlur=function(e){if(e.entity.discountPercentage<0||e.entity.discountPercentage>100){var t=I.alertObj.PlzEntrValidDiscountAmount;n.hisAlertMulti("warning",I.alertObj.alertTypeConf,t,I.alertData,I.alertFunction,I.close)}else e.entity.editable=!1},I.applyToAllDiscountAmounts=function(e){if(!I.discountValErr){var t=0;angular.forEach(I.serviceDiscountOptions.data,function(e,a){e.checked&&t++}),angular.forEach(I.serviceDiscountOptions.data,function(a,i){t>0?a.checked&&(a.discountPercentage=e):a.discountPercentage=e})}},I.clear=function(e){e&&("general"==e?I.general={}:"currencyconfig"==e?I.baseCurrency="":"discount"==e?I.discount={}:"inventory"==e?I.inventory={}:"ipvisit"==e&&(I.ipvisit={}))},I.roomRentClear=function(e){"1"==e&&(I.slotroomRent={}),"2"==e&&(I.cutoffRoomRent={})},I.highValDisclear=function(){I.serviceDiscountOptions.data=[],I.discount.quickSearch="",I.discount.discountPercent="",I.discount.billamount="",I.discount.highTariffCat="",I.discount.highbillpayer=""},I.serviceDiscountOptions.onRegisterApi=function(e){I.grid=e,e.selection.on.rowSelectionChangedBatch(r,function(e){angular.forEach(e,function(e,t){e.isSelected?(e.entity.checked=!0,I.checkSelected=!1):(e.entity.checked=!1,I.checkSelected=!0)})}),e.selection.on.rowSelectionChanged(r,function(e,t){var a=0;e.isSelected?(e.entity.checked=!0,angular.forEach(I.serviceDiscountOptions.data,function(e,t){e.checked&&a++}),a>0&&(I.checkSelected=!1)):(e.entity.checked=!1,angular.forEach(I.serviceDiscountOptions.data,function(e,t){e.checked&&a++}),I.checkSelected=!(a>0))})},I.saveHighBill=function(e,t,a,i){var s=I.serviceDiscountOptions.data,o=0;if(angular.forEach(s,function(e,t){e.editable&&o++}),0==o){a=r.highTariffCatCode;var c=r.compHldiscHdSeqId;l.discountSaveHighBill(e,s,I.discountValErr,t,a,c,i).then(function(e){if(e){var t=I.alertObj.savdSucesFuly;n.hisAlertMulti("success",I.alertObj.alertTypeConf,t,I.alertData,I.alertFunction,I.close),I.highValDisclear()}})}else{var d=I.alertObj.PlzEntrValidDiscountAmount;n.hisAlertMulti("warning",I.alertObj.alertTypeConf,d,I.alertData,I.alertFunction,I.close)}},I.onAgeBlur=function(e){""==e||null==e?I.ageError=!1:e&&(I.ageError=!(e>=50&&e<=120))},I.onDrShareBlur=function(e){""==e||null==e?I.applyingDrShareError=!1:e&&(I.applyingDrShareError=!(e>=0&&e<=100))},I.currencyClear=function(){I.baseCurrency=""},I.generalClear=function(){I.general={};var e=A.FACILITY_CODE.toString();I.general.facilityId=e.trim()},I.ipvisitClear=function(){I.ipvisit={}},I.invClear=function(){I.inventory={}},I.discClear=function(){I.discount.discConf={}},I.corpClear=function(){I.discount.payer="",I.discount.tarrifCat="",I.isTarrifVal=!1,I.discount.serviceOPCheck=!1,I.discount.serviceIPCheck=!1,I.discount.serviceOP="",I.discount.serviceIP="",I.discount.itemOPCheck=!1,I.discount.itemIPCheck=!1,I.discount.itemOP="",I.discount.itemIP=""},I.onRemoveData=function(e,t,a){8!=e.keyCode&&46!=e.keyCode||(t==I.general.retrievedBedCode&&(I.general.retrievedBedCode="",I.general.retrievedBedName=""),t==I.general.isolatedBedCode&&(I.general.isolatedBedCode="",I.general.isolatedBedName=""),t==I.general.dualBedCode&&(I.general.dualBedCode="",I.general.dualBedName=""),t==I.general.regServCode&&(I.general.regServCode="",I.general.regServName=""),t==I.general.ipServCode&&(I.general.ipServCode="",I.general.ipServName=""),t==I.general.mlcServCode&&(I.general.mlcServCode="",I.general.mlcServName=""),t==I.slotroomRent.halfDayRentCode&&(I.slotroomRent.halfDayRentCode="",I.slotroomRent.halfDayRentName=""),t==I.slotroomRent.fullDayRentCode&&(I.slotroomRent.fullDayRentCode="",I.slotroomRent.fullDayRentName=""),t==I.cutoffRoomRent.halfDayRentCode&&(I.cutoffRoomRent.halfDayRentCode="",I.cutoffRoomRent.halfDayRentName=""),t==I.cutoffRoomRent.fullDayRentCode&&(I.cutoffRoomRent.fullDayRentCode="",I.cutoffRoomRent.fullDayRentName=""),t==I.ipvisit.firstVisitCode&&(I.data.firstServCode="",I.data.firstServName="",I.data.firstVisitServId=""),t==I.ipvisit.dayVisitCode&&(I.data.dayVisitServId="",I.data.dayServName="",I.data.dayServCode=""),t==I.ipvisit.nightVisitCode&&(I.data.nightVisitvServId="",I.data.nightServName="",I.data.nightServCode=""),t==I.inventory.pharmacyIssuesCode&&(I.inventory.pharmacyIssuesCode="",I.inventory.pharmacyIssuesName=""),t==I.inventory.pharmacyReturnCode&&(I.inventory.pharmacyReturnCode="",I.inventory.pharmacyReturnName=""),t==I.inventory.generalIssuesCode&&(I.inventory.generalIssuesCode="",I.inventory.generalIssuesName=""),t==I.inventory.generalReturnCode&&(I.inventory.generalReturnCode="",I.inventory.generalReturnName=""),t==I.inventory.cssdIssuesCode&&(I.inventory.cssdIssuesCode="",I.inventory.cssdIssuesName=""),t==I.inventory.cssdReturnCode&&(I.inventory.cssdReturnCode="",I.inventory.cssdReturnName=""),t==I.inventory.cathlabIssuesCode&&(I.inventory.cathlabIssuesCode="",I.inventory.cathlabIssuesName=""),t==I.inventory.cathlabReturnCode&&(I.inventory.cathlabReturnCode="",I.inventory.cathlabReturnName=""),t==I.inventory.stationaryIssuesCode&&(I.inventory.stationaryIssuesCode="",I.inventory.stationaryIssuesName=""),t==I.inventory.stationaryReturnCode&&(I.inventory.stationaryReturnCode="",I.inventory.stationaryReturnName=""),t==I.inventory.retailIssuesCode&&(I.inventory.retailIssuesCode="",I.inventory.retailIssuesName=""),t==I.inventory.retailReturnCode&&(I.inventory.retailReturnCode="",I.inventory.retailReturnName=""))},I.validateE=function(e){101!=e.charCode&&43!=e.charCode&&45!=e.charCode&&46!=e.charCode||e.preventDefault()},I.timeFormatBlur=function(e,t){if(e){var a=/^((([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])|(24:00))$/.test(e),i=/^((([0-9]|0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|6[0-9]|7[0-9]|8[0-9]|9[0-9]):[0-5][0-9]))$/.test(e);if("slotDurationErr"==t&&(I.slotDurationErr=0==i),"gracePeriodErr"==t){if(0==a?(I.gracePeriodEmpty=!1,I.gracePeriodErr=!0):(I.gracePeriodEmpty=!1,I.gracePeriodErr=!1,I.cutoffullGraceTimeErr=!1),I.slotroomRent.halfDayTime)var r=moment(I.slotroomRent.halfDayTime,"HH:mm a");if(I.slotroomRent.slotGracePeriodTime)var n=moment(I.slotroomRent.slotGracePeriodTime,"HH:mm a");r<n?(I.gracePeriodEmpty=!1,I.gracePeriodErr=!1,I.slotGraceTimeErr=!0):I.slotGraceTimeErr=!1}if("minTimeErr"==t&&(I.minTimeErr=0==a),"slotHalfDayTimeErr"==t&&(I.slotHalfDayTimeErr=0==a),"slotfullDayTimeErr"==t&&(I.slotHalfDayTimeErr=0==a),"cutoffAdmsnTimeErr"==t&&(I.cutoffAdmsnTimeErr=0==a),"cutoffDischargeTimeErr"==t&&(I.cutoffDischargeTimeErr=0==a),"graceAdmsnTimeErr"==t){if(I.graceAdmsnTimeErr=0==a,I.cutoffRoomRent.halfDayTime)r=moment(I.cutoffRoomRent.halfDayTime,"HH:mm a");if(I.cutoffRoomRent.graceAdmsnTime)n=moment(I.cutoffRoomRent.graceAdmsnTime,"HH:mm a");r<n?(I.graceAdmsnTimeErr=!1,I.cutoffullGraceTimeErr=!0):(I.graceAdmsnTimeErr=!1,I.cutoffullGraceTimeErr=!1)}if("graceDischargeTimeErr"==t){if(I.graceDischargeTimeErr=0==a,I.cutoffRoomRent.halfDayTimeDis)r=moment(I.cutoffRoomRent.halfDayTimeDis,"HH:mm a");if(I.cutoffRoomRent.graceDischargeTime)n=moment(I.cutoffRoomRent.graceDischargeTime,"HH:mm a");r<n?(I.graceDischargeTimeErr=!1,I.cutoffullGraceTimeErr=!0):(I.graceDischargeTimeErr=!1,I.cutoffullGraceTimeErr=!1)}"halfDayTimeErr"==t&&(0==a?I.halfDayTimeErr=!0:(I.halfDayTimeErr=!1,I.fullDayTimeErr=!1)),"fullDayTimeErr"==t&&(0==a?I.fullDayTimeErr=!0:(I.fullDayTimeErr=!1,I.halfDayTimeErr=!1)),"halfDayTimeErrDis"==t&&(0==a?I.halfDayTimeErrDis=!0:(I.halfDayTimeErrDis=!1,I.fullDayTimeErrDis=!1)),"fullDayTimeErrDis"==t&&(0==a?I.fullDayTimeErrDis=!0:(I.fullDayTimeErrDis=!1,I.halfDayTimeErrDis=!1)),"minTimeSpentErr"==t&&(I.minTimeSpentErr=0==a)}},I.deptgridOptions=angular.copy(p),d.getColumnDef(I.deptgridOptions),I.deptgridOptions.onRegisterApi=function(e){r.gridApi=e},I.deptgridOptions.data=[],I.filterDeptGrid=function(e){r.gridApi.grid.refresh();for(var t=e;e;){var a=e.split(" ");I.deptgridOptions.data=v("filter")(I.deptgridOptions.data,a[0],void 0),a.shift(),e=0!==a.length?a.join(" "):""}if(null!=t&&null!=t&&""!=t&&0==I.deptgridOptions.data.length){var i=I.alertObj.noRcrdFound;n.hisAlertMulti("information",I.alertObj.alertTypeConf,i,I.alertData,I.alertFunction,I.close)}else null!=t&&null!=t&&""!=t||(null!=I.opSubDept&&null!=I.opSubDept&&I.opSubDept.length>0?I.getValidSubDep(I.opSubDept):I.getValidData(I.opDept))},I.editDep=function(e,t,a){if(null!=e.tariffCategory)I.replaceFlag=!0,null!=I.previousEdit&&I.previousEdit!=t&&(I.tariffgridOptions.data[I.previousEdit].editable=!1,I.prevRows.isSelected=!1),e.editable?(e.editable=!1,a.isSelected&&(a.isSelected=!1)):e.editable=!0,I.previousEdit=t,I.prevRows=a;else if(null!=e.subDepartmentDesc)if(I.editFlag=!0,null!=I.previousDepEdit&&I.previousDepEdit!=t&&(I.validFlag||(null!=I.deptgridOptions.data[I.previousDepEdit]&&(I.deptgridOptions.data[I.previousDepEdit].editable=!1),I.prevDepRows.isSelected=!1)),I.validFlag){var i="";parseInt(I.deptgridOptions.data[I.previousDepEdit].noOfFreeVisits)>parseInt(I.deptgridOptions.data[I.previousDepEdit].noOfVisits)&&parseInt(I.deptgridOptions.data[I.previousDepEdit].freeDays)>parseInt(I.deptgridOptions.data[I.previousDepEdit].noOfValidDays)?i=I.alertObj.validDaysVisitFree:parseInt(I.deptgridOptions.data[I.previousDepEdit].freeDays)>parseInt(I.deptgridOptions.data[I.previousDepEdit].noOfValidDays)?i=I.alertObj.validDaysFreeDaysEnter:parseInt(I.deptgridOptions.data[I.previousDepEdit].noOfFreeVisits)>parseInt(I.deptgridOptions.data[I.previousDepEdit].noOfVisits)&&(i=I.alertObj.validVisitsFreeVisitsEnter),n.hisAlertMulti("information",I.alertObj.alertTypeInfo,i,I.alertData,I.alertFunction,I.close)}else e.editable?(e.editable=!1,a.isSelected&&(a.isSelected=!1)):e.editable=!0,I.previousDepEdit=t,I.prevDepRows=a},I.tariffgridOptions=angular.copy(p),d.getColumnDefTariff(I.tariffgridOptions),I.tariffgridOptions.onRegisterApi=function(e){r.gridApiT=e},I.tariffgridOptions.data=[],I.getValidData=function(e){if(null!=I.prevDept&&null!=I.prevDept&&I.editFlag){if(null==e||I.prevDept.CODE!=e.CODE){var t={buttonText:I.alertObj.no,buttonText2:I.alertObj.yes},a={buttonCallBack1:function(){I.opDept=I.prevDept,I.getSubDepartment(I.prevDept)},buttonCallBack2:function(){I.getSubDepartment(e),I.prevDept=angular.copy(e),I.editFlag=!1,I.validFlag=!1}},i={buttonClose:function(){I.opDept=I.prevDept,I.getSubDepartment(I.prevDept)}},r=I.alertObj.doUWantToReplace;n.hisAlertMulti("information",I.alertObj.alertTypeConf,r,t,a,i)}}else I.getSubDepartment(e),I.prevDept=angular.copy(e)},I.getValidSubDep=function(e){if(null!=I.prevSubDept&&null!=I.prevSubDept&&I.editFlag){for(var t=!1,a=e.length>I.prevSubDept.length?e:I.prevSubDept,i=e.length<I.prevSubDept.length?e:I.prevSubDept,r=0;r<a.length;r++){for(var l=0;l<i.length&&i[l].gQDataCode!=a[r].gQDataCode;l++)!0,l==i.length-1&&(t=!0);if(t)break}if(t){var s={buttonText:I.alertObj.no,buttonText2:I.alertObj.yes},o={buttonCallBack1:function(){I.opSubDept=I.prevSubDept},buttonCallBack2:function(){I.subDepartmentChange(e),I.prevSubDept=angular.copy(e),I.editFlag=!1}},c={buttonClose:function(){I.opSubDept=I.prevSubDept}},d=I.alertObj.doUWantToReplace;n.hisAlertMulti("information",I.alertObj.alertTypeConf,d,s,o,c)}else if(0==e.length){s={buttonText:I.alertObj.no,buttonText2:I.alertObj.yes},o={buttonCallBack1:function(){I.opSubDept=I.prevSubDept},buttonCallBack2:function(){I.opSubDept=I.opSubDepList,I.subDepartmentChange(I.opSubDept),I.prevSubDept=angular.copy(I.opSubDept),I.editFlag=!1}},c={buttonClose:function(){I.opSubDept=I.prevSubDept}},d=I.alertObj.doUWantToReplace;n.hisAlertMulti("information",I.alertObj.alertTypeConf,d,s,o,c)}else I.subDepartmentChange(e),I.prevSubDept=angular.copy(e)}else I.subDepartmentChange(e),I.prevSubDept=angular.copy(e)},I.getSubDepartment=function(e,t){if(t?I.opSubDeptTariff=[]:(I.opSubDept=[],I.deptgridOptions.data=[],I.opSubDepList=[]),null!=e&&null!=e&&null!=e.CODE){I.opSubDepList=[],I.opSubDepListTariff=[],I.multipleComboSubDataForList={1:I.opSubDepList,2:I.opSubDepListTariff};var a=c.executeQueryURLReset();I.opDeptListArr=new Array,c.prepareParamListWithParam("pDeptCode",e.CODE,I.opDeptListArr),c.executeQueryInput("SPECIALITY_DROPDOWN_FOR_DEPARTMENT_001",I.opDeptListArr,I.multipleComboSubDataForList,!0,!1,a,"popUp"),c.executeQueryInput("GET_SUB_DEPT_VISIT",I.opDeptListArr,I.multipleComboSubDataForList,!0,!0,a,"popUp").then(function(e){t?I.opSubDepListT=angular.copy(I.opSubDepListTariff):(I.deptgridOptions.data=[],I.subDepartmentChange(I.opSubDepList),I.opSubDept=I.opSubDepList)})}else t?I.opSubDeptTariff=[]:(I.opSubDept=[],I.deptgridOptions.data=[],I.opSubDepList=[])},I.getSeqId=function(e){I.getSeqIdList=[],I.multipleCombo={1:I.getSeqIdList};var t=c.executeQueryURLReset();return I.getSeqIdListArr=new Array,c.prepareParamListWithParam("pType",I.deptradio,I.getSeqIdListArr),c.prepareParamListWithParam("pDesc",e,I.getSeqIdListArr),c.executeQueryInput("GET_DOCT_AND_SUBDEPT",I.getSeqIdListArr,I.multipleCombo,!0,!0,t,"popUp",I.getSeqIdListArr).then(function(e){return I.getSeqIdList.map(function(e){return e})})},I.getTariffData=function(e,t){if(t||null!=e&&null!=e&&null!=e.CODE){t&&(I.opDeptTarif=null,I.opSubDeptTariff=[],I.docModel=[]),I.tariffDList=[],I.multipleComboD={1:I.tariffDList};var a=c.executeQueryURLReset();I.tariffDListArr=new Array,c.prepareParamListWithParam("pDoctorSeqId",null!=e&&null!=e&&null!=e.CODE?e.CODE:-999,I.tariffDListArr),c.prepareParamListWithParam("pDoctorSeqId",null!=e&&null!=e&&null!=e.CODE?e.CODE:-999,I.tariffDListArr),c.executeQueryInput("GET_CLINIC_WISE_DOCTOR_CHARGES_002",I.tariffDListArr,I.multipleComboD,!0,!0,a,"popUp",I.tariffDListArr).then(function(e){I.tariffgridOptions.data=[];for(var t=0;t<I.tariffDList.length;t++)I.tariffgridOptions.data.push({billVisitconfigSeqId:angular.copy(I.tariffDList[t].BLV_CONFIG_SEQ_ID),tariffCatgSeqId:angular.copy(I.tariffDList[t].CODE),tariffCategory:angular.copy(I.tariffDList[t].DESCRIPTION),followUpServiceRate:angular.copy(I.tariffDList[t].FOLLOWUP_SERVICE_RATE),ipFollowUpServiceRate:angular.copy(I.tariffDList[t].IP_FOLLOWUP_SERVICE_RATE),newServiceRate:angular.copy(I.tariffDList[t].NEW_SERVICE_RATE),opEmergencyRate:angular.copy(I.tariffDList[t].OP_EMERGENCY_RATE),tariffClsSeqId:angular.copy(I.tariffDList[t].TARIFF_CLS_SEQID),tariffClass:angular.copy(I.tariffDList[t].TARIFF_CLASS_NAME),status:1==I.tariffDList[t].GN_TRAN_STATUS})})}else if(null!=e&&null!=e&&""!=e&&null==e.CODE){I.getSingleObj=null;var i=I.alertObj.noRcrdFound;n.hisAlertMulti("information",I.alertObj.alertTypeInfo,i,I.alertData,I.alertFunction,I.close)}},I.subDepartmentChange=function(e){if(I.deptgridOptions.data=[],null!=e&&null!=e&&e instanceof Array&&e.length>0){I.getDaysData=[],I.multipleComboDaysForList={1:I.getDaysData};var t=c.executeQueryURLReset();I.getDaysDataArr=new Array;for(var a="",i=0;i<e.length;i++){var r=",";i==e.length-1&&(r=""),a=a+e[i].gQDataCode+r}c.prepareParamListWithParam("pDoctorSeqId",a,I.getDaysDataArr);c.executeQueryInput("GET_SPECIALITY_WISE_VISIT_CONFIGURATION_001",I.getDaysDataArr,I.multipleComboDaysForList,!0,!0,t,"popUp","for Test").then(function(e){I.deptgridOptions.data=[];for(var t=0;t<I.getDaysData.length;t++)I.deptgridOptions.data.push({billVisitconfigSeqId:I.getDaysData[t].BLV_CONFIG_SEQ_ID,subDepartmentDesc:I.getDaysData[t].SUB_DEPT_NAME,subSeqCode:I.getDaysData[t].CLINICAL_SEQ_ID,freeDays:I.getDaysData[t].FREE_DAYS,noOfFreeVisits:I.getDaysData[t].NO_OF_FREE_VISITS,noOfValidDays:I.getDaysData[t].NO_OF_VALID_DAYS,noOfVisits:I.getDaysData[t].NO_OF_VISITS,alternateDoctor:null==I.getDaysData[t].ALTERNATE_DOCTOR?"1":I.getDaysData[t].ALTERNATE_DOCTOR.toString(),alternateVisitType:null==I.getDaysData[t].ALTERNATE_VISIT_TYPE?"1":I.getDaysData[t].ALTERNATE_VISIT_TYPE.toString(),status:1==I.getDaysData[t].GN_TRAN_STATUS});if(0==I.getDaysData.length){var a=[];a=null!=I.opSubDept&&null!=I.opSubDept&&I.opSubDept.length>0?I.opSubDept:I.opSubDepList;for(t=0;t<a.length;t++)I.deptgridOptions.data.push({subDepartmentDesc:a[t].gQDataName,subSeqCode:a[t].gQDataCode,freeDays:0,noOfFreeVisits:0,noOfValidDays:0,noOfVisits:0,alternateDoctor:"2",alternateVisitType:"1",status:!0})}else{a=[];a=null!=I.opSubDept&&null!=I.opSubDept&&I.opSubDept.length>0?I.opSubDept:I.opSubDepList;for(var i=0;i<a.length;i++)for(var r=!1,n=0;n<I.getDaysData.length&&a[i].gQDataCode!=I.getDaysData[n].CLINICAL_SEQ_ID;n++)a[i].gQDataCode!=I.getDaysData[n].CLINICAL_SEQ_ID&&n==I.getDaysData.length-1&&(r=!0),r&&I.deptgridOptions.data.push({subDepartmentDesc:a[i].gQDataName,subSeqCode:a[i].gQDataCode,freeDays:0,noOfFreeVisits:0,noOfValidDays:0,noOfVisits:0,alternateDoctor:"2",alternateVisitType:"1",status:!0})}})}};var O=function(){I.docData=[],I.opDeptListT=[],I.multipleclinicDataForList={1:I.docData,2:I.opDeptListT};var e=c.executeQueryURLReset();I.docDataArr=new Array,c.executeQueryInput("GET_DOCTOR_VISIT",I.docDataArr,I.multipleclinicDataForList,!0,!1,e,"popUp",I.tariffgridOptions),c.executeQueryInput("GET_OP_VISIT_DEPT",I.docDataArr,I.multipleclinicDataForList,!0,!0,e,"popUp",I.tariffgridOptions)};function R(){var e={1:I.getGridData=[]},t=c.executeQueryURLReset();c.executeQueryInput("NH_BL_DOCT_VISIT_CONFIG",[],e,!0,!0,t,"popUp",{}).then(function(e){e[1][0]?(I.data={isFirstVisitBillable:I.getGridData[0].IS_FIRST_VISIT_BILLABLE?_.toString(I.getGridData[0].IS_FIRST_VISIT_BILLABLE):"1",isDayVisitBillable:I.getGridData[0].IS_DAY_VISIT_BILLABLE?_.toString(I.getGridData[0].IS_DAY_VISIT_BILLABLE):"1",isNightVisitBillable:I.getGridData[0].IS_NIGHT_VISIT_BILLABLE?_.toString(I.getGridData[0].IS_NIGHT_VISIT_BILLABLE):"1",firstVisitServId:I.getGridData[0].FIRST_VISIT_SERV_ID,firstServName:I.getGridData[0].FIRST_VISIT_SERVICE,firstServCode:I.getGridData[0].FIRST_VISIT_SERVICE_CODE,dayServCode:I.getGridData[0].DAY_VISIT_SERVICE_CODE,dayServName:I.getGridData[0].DAY_VISIT_SERVICE,dayVisitServId:I.getGridData[0].DAY_VISIT_SERV_ID,nightVisitvServId:I.getGridData[0].NIGHT_VISIT_SERV_ID,nightServName:I.getGridData[0].NIGHT_VISIT_SERVICE,nightServCode:I.getGridData[0].NIGHT_VISIT_SERV_ID,allDoctor:!1,otherDoctor:!1,admittingDoctor:!1,docConfigSeqId:I.getGridData[0].DOCV_CONFIG_SEQ_ID},I.getGridData[0].APPLICABILITY_TYPE&&I.getGridData[0].APPLICABILITY_TYPE.length>1?(I.data.admittingDoctor=!0,I.data.otherDoctor=!0,I.getGridDataForService(2),f(function(){I.getGridDataForService(3)},100)):I.getGridData[0].APPLICABILITY_TYPE&&(I.data.allDoctor=1==I.getGridData[0].APPLICABILITY_TYPE,I.data.otherDoctor=3==I.getGridData[0].APPLICABILITY_TYPE,I.data.admittingDoctor=2==I.getGridData[0].APPLICABILITY_TYPE,I.getGridDataForService(I.getGridData[0].APPLICABILITY_TYPE))):I.data={isFirstVisitBillable:"1",isDayVisitBillable:"1",isNightVisitBillable:"1",allDoctor:!0,otherDoctor:!1,admittingDoctor:!1}}),I.data={isFirstVisitBillable:"1",isDayVisitBillable:"1",isNightVisitBillable:"1",allDoctor:!0,otherDoctor:!1,admittingDoctor:!1}}function N(){I.rrGridOpts.data=[{flag:!0,byFixedSlot:"",freqyradio:1}],delete I.editIndex;var e={1:I.getCompanionFeeSlotsList=[],2:I.getCompanionFeeDetailsList=[]},t=c.executeQueryURLReset(),a=new Array;c.prepareParamListWithParam("pFacility",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a),c.prepareParamListWithParam("pServSeqId",I.servicedtail.ipFlwUpseqId?I.servicedtail.ipFlwUpseqId:-999,a),c.executeQueryInput("COMPANION_FEE_CHARGES_BILL_CONFIG",a,e,!0,!1,t,"popUp",{}),c.executeQueryInput("GET_COMPANION_FEE_CONNECTION_LEVEL_DATA",a,e,!0,!0,t,"popUp",{}).then(function(e){if(e[1]){I.getCompanionFeeDetailsList[0]&&(I.servicedtail={ipFlwUpseqId:I.getCompanionFeeDetailsList[0].SERV_SEQ_ID,serviceMapId:I.getCompanionFeeDetailsList[0].SERV_MAP_ID,ipFlwUpCode:I.getCompanionFeeDetailsList[0].SERV_CODE,ipFlwUpName:I.getCompanionFeeDetailsList[0].SERV_NAME}),I.is_slot=!!I.getCompanionFeeSlotsList[0]||I.is_slot;for(var t=0;t<I.getCompanionFeeSlotsList.length;t++){let e=I.getCompanionFeeSlotsList[t];if(e.IS_SLOT){let t={status:e.GN_STATUS,serviceslotId:e.SERV_SLOT_ID,isSlot:"true"==e.IS_SLOT};"true"==e.IS_SLOT?(t.byFixedSlot=parseInt(e.FROM_UNIT),t.dummyField=parseInt(e.TO_UNIT),t.freqyradio=1):"false"==e.IS_SLOT&&(t.byFrequencySlot=parseInt(e.FROM_UNIT),t.dummyField2=parseInt(e.TO_UNIT),t.freqyradio=2),I.rrGridOpts.data.push(t)}}}})}O(),I.changeValue=function(e,t){I.editFlag=!0},I.defaultValue=function(e,t){null==e[t.name]||null==e[t.name]||""==e[t.name]?e[t.name]=0:parseInt(e.freeDays)>parseInt(e.noOfValidDays)||parseInt(e.noOfFreeVisits)>parseInt(e.noOfVisits)?I.validFlag=!0:I.validFlag=!1},I.activeInactiveStatus=function(e){null!=e.entity.subDepartmentDesc?I.editFlag=!0:null!=e.entity.tariffCategory&&(I.replaceFlag=!0)},I.saveOPVisit=function(){var e;I.flagCreate?1==I.deptradio?e=I.opSubDeptTariff:2==I.deptradio&&(e=I.docModel):e=I.getSingleObj;var t=!1;if(I.deptgridOptions.data.length>0)for(var a=0;a<I.deptgridOptions.data.length;a++)if(I.deptgridOptions.data[a].editable){t=!0,r.gridApi.selection.selectRow(I.deptgridOptions.data[a]);break}if(I.tariffgridOptions.data.length>0)for(a=0;a<I.tariffgridOptions.data.length;a++)if(I.tariffgridOptions.data[a].editable){t=!0,r.gridApiT.selection.selectRow(I.tariffgridOptions.data[a]);break}if(t){var i=I.alertObj.GrdShntBinEditMde;n.hisAlertMulti("information",I.alertObj.alertTypeInfo,i,I.alertData,I.alertFunction,I.close)}else{d.saveBillOPVisitConfig(I.tariffgridOptions,I.deptgridOptions,e,I.deptradio).then(function(e){I.editFlag=!1,I.replaceFlag=!1});var s={consltseqId:I.opvisit.consltseqId,flwUpseqId:I.opvisit.flwUpseqId,freeFlwUpseqId:I.opvisit.freeFlwUpseqId,ipFlwUpseqId:I.opvisit.ipFlwUpseqId,flagRate:I.flagRate};l.saveGeneralConfig(s,!1,!0).then(function(e){var t=I.alertObj.savdSucesFuly,a={buttonText:I.alertObj.ok},i={buttonCallBack1:function(){I.flagCreate&&(I.flagCreate=!1,I.tariffgridOptions.data=[],I.docModel=null,O(),I.opDeptTarif=null,I.opSubDeptTariff=null),I.getValidData(I.opDept),I.filterValue=null}},r={buttonClose:function(){I.flagCreate&&(I.flagCreate=!1,I.tariffgridOptions.data=[],I.docModel=null,O(),I.opDeptTarif=null,I.opSubDeptTariff=null),I.getValidData(I.opDept),I.filterValue=null}};n.hisAlertMulti("success",I.alertObj.alertTypeSucss,t,a,i,r)})}},I.checkReplaceFlag=function(e,t,a){if(t&&null!=I.prevFlagR&&I.prevFlagR!=e||a&&null!=I.prevFlagOP&&I.prevFlagOP!=e||null!=I.prevFlag&&I.prevFlag!=e)if(I.replaceFlag){var i={buttonText:I.alertObj.no,buttonText2:I.alertObj.yes},r={buttonCallBack1:function(){t?(I.deptradio=I.prevFlagR.toString(),e=I.prevFlagR):a?I.flagRate=I.prevFlagOP:(I.flagCreate=I.prevFlag,e=I.prevFlag)},buttonCallBack2:function(){I.replaceFlag=!1,t?a?(I.prevFlagOP=e,I.flagCreate=!1,I.flagRate||(I.tariffgridOptions.data=[])):(I.prevFlagR=e,I.tariffgridOptions.data=[],I.getSingleObj=null,I.getTariffData(void 0,I.flagCreate)):(I.prevFlag=e,I.flagCreate?(I.getTariffData(void 0,!0),I.docModel=null,O(),I.getSingleObj=null):(I.tariffgridOptions.data=[],I.getSingleObj=null))}},l={buttonClose:function(){t?(I.deptradio=I.prevFlagR.toString(),e=I.prevFlagR):a?I.flagRate=I.prevFlagOP:(I.flagCreate=I.prevFlag,e=I.prevFlag)}},s=I.alertObj.doUWantToReplace;n.hisAlertMulti("information",I.alertObj.alertTypeConf,s,i,r,l)}else t?a?(I.prevFlagOP=e,I.flagRate||(I.tariffgridOptions.data=[])):(I.prevFlagR=e,I.getSingleObj=null,I.flagCreate?I.getTariffData(void 0,!0):I.tariffgridOptions.data=[]):(I.prevFlag=e,I.flagCreate?(I.getTariffData(void 0,!0),I.getSingleObj=null):(I.getSingleObj=null,I.tariffgridOptions.data=[]));else I.flagRate?(I.prevFlagOP=e,t||(I.prevFlag=e),I.tariffgridOptions.data=[],I.getTariffData(void 0,I.flagCreate),I.flagCreate?(I.docModel=null,O(),I.getSingleObj=null):I.getSingleObj=null):(I.prevFlagOP=e,I.tariffgridOptions.data=[])},I.roomRentCheck=function(){if(delete I.rrGridOpts,I.rrGridOpts=angular.copy(t),I.rrGridOpts.data=[{}],I.errRentStatus){I.roomrentSlots=[];var e={1:I.roomrentSlots},a=c.executeQueryURLReset();I.SetRoomrentSlots=new Array;var i=new Array;c.prepareParamListWithParam("pServTypeId",10006,i),c.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,i),c.executeQueryInput("GET_EMRR_SLOT_DETAILS",i,e,!0,!0,a,"popUp",{}).then(function(e){I.rrGridOpts.data=[],I.rrGridOpts.data[0]={flag:!0,byFixedSlot:"",freqyradio:1};let t=e[1];I.rrConfig.ipFlwUpCode=t[0].SERV_CODE,I.rrConfig.ipFlwUpName=t[0].SERV_NAME,I.rrConfig.ipFlwUpseqId=t[0].SERV_SEQ_ID,I.rrConfig.serviceTypeId=t[0].SERVICE_TYPEID;for(var a=0;a<e[1].length;a++){let i={status:t[a].GN_STATUS,serviceslotId:t[a].SERV_SLOT_ID,isSlot:"true"==t[a].IS_SLOT};"true"==e[1][a].IS_SLOT?(i.byFixedSlot=parseInt(e[1][a].FROM_UNIT),i.dummyField=parseInt(e[1][a].TO_UNIT),i.freqyradio=1):"false"==e[1][a].IS_SLOT&&(i.byFrequencySlot=parseInt(e[1][a].FROM_UNIT),i.dummyField2=parseInt(e[1][a].TO_UNIT),i.freqyradio=2),I.rrGridOpts.data.push(i)}I.rrList=[];var i={1:I.rrList},r=c.executeQueryURLReset();I.setRrList=new Array;var n=new Array;c.prepareParamListWithParam("pServTypeCode",I.rrConfig.serviceTypeId,n),c.prepareParamListWithParam("pServSeqId",I.rrConfig.ipFlwUpseqId,n),c.executeQueryInput("SURGERY_SERVICE_DETAILS_EMR_BED_RENTAL",n,i,!0,!0,r,"popUp",{}).then(function(e){I.rrList[0]&&(I.rrConfig.ipFlwUpCode=I.rrList[0].SERV_CODE,I.rrConfig.ipFlwUpName=I.rrList[0].SERV_NAME,I.rrConfig.ipFlwUpseqId=I.rrList[0].SERV_SEQ_ID)})})}},I.setGridInputs=function(e,t){1==I.rrGridOpts.data[0].freqyradio&&I.rrGridOpts.data.length>1?(I.rrGridOpts.data[0].byFixedSlot=parseInt(I.rrGridOpts.data[I.rrGridOpts.data.length-1].dummyField),I.rrGridOpts.data[0].byFrequencySlot="",I.rrGridOpts.data[0].dummyField2=""):2==I.rrGridOpts.data[0].freqyradio&&I.rrGridOpts.data.length>1&&(I.rrGridOpts.data[0].byFrequencySlot=parseInt(I.rrGridOpts.data[I.rrGridOpts.data.length-1].dummyField),I.rrGridOpts.data[0].dummyField2=I.rrGridOpts.data[0].byFrequencySlot?30:"",I.rrGridOpts.data[0].byFixedSlot="",I.rrGridOpts.data[0].dummyField="")},I.getMaxSlot=function(){for(var e=0,t=1;t<I.rrGridOpts.data.length;t++)e<I.rrGridOpts.data[t].dummyField&&(e=I.rrGridOpts.data[t].dummyField);return e},I.checkSlotValid=function(e,t,a,i){if(null!=t&&null!=t&&null!=a&&null!=a)for(var r=1;r<I.rrGridOpts.data.length;r++)if(r!=i){if(1==I.rrGridOpts.data[r].status&&2==I.rrGridOpts.data[r].freqyradio&&(I.rrGridOpts.data[r].byFrequencySlot<e.entity.byFixedSlot||I.rrGridOpts.data[r].byFrequencySlot<e.entity.dummyField))return void n.information("Information","Please inactivate the overlapped frequencyslot");if(1==a&&null!=I.rrGridOpts.data[r].byFixedSlot&&null!=I.rrGridOpts.data[r].byFixedSlot){if((t<I.rrGridOpts.data[r].byFixedSlot||t<I.rrGridOpts.data[r].dummyField)&&1==I.rrGridOpts.data[r].status)return n.information("Information","Enter valid fixedslot"),!1;if(2==a&&null!=I.rrGridOpts.data[r].byFrequencySlot&&null!=I.rrGridOpts.data[r].byFrequencySlot&&I.rrGridOpts.data[r].byFrequencySlot&&1==I.rrGridOpts.data[r].status)return n.information("Information","Please inactivate the overlapped frequencyslot"),!1;if(1==a&&I.rrGridOpts.data[r].byFixedSlot==e.entity.byFixedSlot&&2==I.rrGridOpts.data[r].status)return n.information("Information","Frequency slot is already Exist, Please Active it"),!1}else if(2==a&&null!=I.rrGridOpts.data[r].byFrequencySlot&&null!=I.rrGridOpts.data[r].byFrequencySlot){if(I.rrGridOpts.data[r].byFrequencySlot&&1==I.rrGridOpts.data[r].status)return n.information("Information","Enter valid frequencyslot/Please inactivate the overlapped frequencyslot"),!1;if(2==a&&I.rrGridOpts.data[r].byFrequencySlot==e.entity.byFrequencySlot&&2==I.rrGridOpts.data[r].status)return n.information("Information","Frequency slot is already Exist, Please Active it"),!1}else{if(1==a&&e.entity.byFrequencySlot||2==a&&(e.entity.byFixedSlot||e.entity.dummyField))return n.information("Information","Enter valid frequencyslot/inactivate the overlapped frequencyslot"),!1;if(1==a&&null!=e.entity.byFixedSlot&&null!=e.entity.byFixedSlot&&null!=e.entity.dummyField&&null!=e.entity.dummyField&&(e.entity.byFixedSlot>=I.rrGridOpts.data[r].byFrequencySlot||e.entity.dummyField>=I.rrGridOpts.data[r].byFrequencySlot)&&1==I.rrGridOpts.data[r].status)return n.information("Information","Please inactivate the overlapped frequencyslot"),!1;if(t==I.rrGridOpts.data[r].byFixedSlot&&t==I.rrGridOpts.data[r].dummyField&&2==I.rrGridOpts.data[r].status&&!I.rrGridOpts.data[r].isEdited)return n.information("Information","Please activate/update the existing slot"),!1;if(2==a&&null!=I.rrGridOpts.data[r].byFrequencySlot&&null!=I.rrGridOpts.data[r].byFrequencySlot&&I.rrGridOpts.data[r].byFrequencySlot&&2==I.rrGridOpts.data[r].status&&I.rrGridOpts.data[r].byFrequencySlot==e.entity.byFrequencySlot)return n.information("Information","Please activate/update the existing slot"),!1;if(2==a&&null!=I.rrGridOpts.data[r].byFrequencySlot&&(null!=I.rrGridOpts.data[r].byFrequencySlot||I.rrGridOpts.data[r].byFrequencySlot>e.entity.byFrequencySlot||I.rrGridOpts.data[r].byFixedSlot>e.entity.byFrequencySlot)&&1==I.rrGridOpts.data[r].status)return n.information("Information","Enter valid frequencyslot"),!1;if(2==a&&(I.rrGridOpts.data[r].byFrequencySlot>e.entity.byFrequencySlot||I.rrGridOpts.data[r].dummyField>e.entity.byFrequencySlot)&&1==I.rrGridOpts.data[r].status)return n.information("Information","Enter valid frequencyslot"),!1}}return!0},I.pepareJSONData=function(e){let t={byFixedSlot:e.entity.byFixedSlot,dummyField:e.entity.dummyField,byFrequencySlot:e.entity.byFrequencySlot,dummyField2:e.entity.dummyField2,status:1,freqyradio:e.entity.freqyradio,isSlot:e.entity.freqyradio,serviceslotId:e.entity.serviceslotId};I.editIndex?(I.rrGridOpts.data[I.editIndex]=angular.copy(t),delete I.editIndex):I.rrGridOpts.data.push(t),I.rrGridOpts.data[0]={flag:!0,byFixedSlot:I.rrGridOpts.data[I.rrGridOpts.data.length-1].dummyField,freqyradio:1}},I.addRow=function(e,t){if(e.entity.byFixedSlot=e.entity.byFixedSlot?parseInt(e.entity.byFixedSlot):void 0,e.entity.dummyField=e.entity.dummyField?parseInt(e.entity.dummyField):void 0,e.entity.byFrequencySlot=e.entity.byFrequencySlot?parseInt(e.entity.byFrequencySlot):void 0,e.entity.dummyField2=e.entity.dummyField2?parseInt(e.entity.dummyField2):void 0,1!=e.entity.freqyradio||null!=e.entity.byFixedSlot&&null!=e.entity.dummyField&&null!=e.entity.byFixedSlot&&null!=e.entity.dummyField&&""!==e.entity.byFixedSlot&&""!==e.entity.dummyField)if(2!=e.entity.freqyradio||null!=e.entity.byFrequencySlot&&null!=e.entity.dummyField2&&null!=e.entity.byFrequencySlot&&null!=e.entity.dummyField2&&""!==e.entity.byFrequencySlot&&""!==e.entity.dummyField2)if(1==e.entity.freqyradio&&(parseInt(e.entity.byFixedSlot)>e.entity.dummyField||e.entity.byFixedSlot==e.entity.dummyField)&&""!=e.entity.byFixedSlot&&""!=e.entity.dummyField)n.information("Information","From Slot is must be lesser then To Slot");else{I.getMaxSlot();if(1==e.entity.freqyradio){if(!I.checkSlotValid(e,e.entity.byFixedSlot,1,t)||!I.checkSlotValid(e,e.entity.dummyField,1,t))return;I.pepareJSONData(e)}else if(2==e.entity.freqyradio){if(!I.checkSlotValid(e,e.entity.byFrequencySlot,2,t))return;I.pepareJSONData(e)}}else n.information("Information","Enter valid frequency slot");else n.information("Information","Enter valid fixed slot")},I.validateSlotValue=function(e,t){var a=!1;return 2==e.entity.freqyradio?a=I.checkSlotValid(e,e.entity.byFrequencySlot,2,t):1==e.entity.freqyradio&&(a=I.checkSlotValid(e,e.entity.byFixedSlot,1,t)&&I.checkSlotValid(e,e.entity.dummyField,1,t)),a},I.statusChange=function(e,t){if(2==e.entity.freqyradio&&1==e.entity.status)for(var a=1;a<I.rrGridOpts.data.length;a++){if(I.rrGridOpts.data[a].byFrequencySlot>e.entity.byFrequencySlot)return n.information("Information","Please inactivate the overlapped frequencyslot"),void(I.rrGridOpts.data[t].status=2);(I.rrGridOpts.data[a].byFixedSlot>e.entity.byFrequencySlot||I.rrGridOpts.data[a].byFixedSlot>e.entity.byFrequencySlot||I.rrGridOpts.data[a].dummyField>e.entity.byFrequencySlot)&&(I.rrGridOpts.data[a].status=2)}else if(1==e.entity.freqyradio&&1==e.entity.status)for(a=1;a<I.rrGridOpts.data.length;a++){if(2==I.rrGridOpts.data[a].freqyradio&&1==I.rrGridOpts.data[a].status&&(I.rrGridOpts.data[a].byFrequencySlot<e.entity.byFixedSlot||I.rrGridOpts.data[a].byFrequencySlot<e.entity.dummyField))return I.rrGridOpts.data[t].status=2,void n.information("Information","Please inactivate the overlapped frequencyslot");if((I.rrGridOpts.data[I.rrGridOpts.data.length-1].byFrequencySlot&&2==I.rrGridOpts.data[I.rrGridOpts.data.length-1].status||!I.rrGridOpts.data[I.rrGridOpts.data.length-1].byFrequencySlot)&&t!=a&&1==I.rrGridOpts.data[a].status&&parseInt(I.rrGridOpts.data[a].dummyField)>e.entity.byFixedSlot)return I.rrGridOpts.data[t].status=2,void n.information("Information","Please inactivate the overlapped frequencyslot")}},I.chng2edit=function(e,t){I.editIndex=angular.copy(t),I.rrGridOpts.data[0]=angular.copy(e.entity);for(var a=0;a<I.rrGridOpts.data.length;a++)I.rrGridOpts.data[a].isEdited=t==a},I.saveRoomRentSlots=function(){for(var e=[],t=1;t<I.rrGridOpts.data.length;t++)e.push({sequence:t,serviceSeqId:I.rrConfig.ipFlwUpseqId,serviceslotId:I.rrGridOpts.data[t].serviceslotId,fromUnit:1==I.rrGridOpts.data[t].isSlot?parseInt(I.rrGridOpts.data[t].byFixedSlot):parseInt(I.rrGridOpts.data[t].byFrequencySlot),toUnit:1==I.rrGridOpts.data[t].isSlot?parseInt(I.rrGridOpts.data[t].dummyField):parseInt(I.rrGridOpts.data[t].dummyField2),gnStatus:1==I.rrGridOpts.data[t].status?1:2,isSlot:1==I.rrGridOpts.data[t].isSlot?1:0,isNotcon:I.is_slot,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,practiceId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID_DESC});var a={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList",billingHISConfigurationVo:[{"com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo":[{parameter:"EMERGENCY BED RENTAL CONFIGURATIONS",value:I.rrConfig.ipFlwUpseqId}]}],billingServiceConfigurationVoList:[{"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo":e}]};S.saveEmrgRoomRentService(a).then(function(e){if(null!=e.data.HITService.message.billingServiceConfigurationVoList){var t=e.data.HITService.message.billingServiceConfigurationVoList[0]["com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo"];if(null!=t.serviceslotId||t[0].serviceslotId){if(null!=t.serviceslotId){I.rrGridOpts.data=[],I.rrGridOpts.data[0]={flag:!0};let e={sequence:t.sequence,serviceSeqId:t.serviceSeqId,serviceslotId:t.serviceslotId,isSlot:t.status,byFrequencySlot:0==t.status?t.fromUnit:void 0,dummyField2:0==t.status?t.toUnit:void 0,byFixedSlot:1==t.status?t.fromUnit:void 0,dummyField:1==t.status?t.toUnit:void 0,freqyradio:1==t.status?1:2,status:t.gnStatus};I.rrGridOpts.data.push(e)}else{I.rrGridOpts.data=[],I.rrGridOpts.data[0]={flag:!0};for(var a=0;a<t.length;a++){let e={sequence:t[a].sequence,serviceSeqId:t[a].serviceSeqId,serviceslotId:t[a].serviceslotId,isSlot:t[a].status,byFrequencySlot:0==t[a].status?t[a].fromUnit:void 0,dummyField2:0==t[a].status?t[a].toUnit:void 0,byFixedSlot:1==t[a].status?t[a].fromUnit:void 0,dummyField:1==t[a].status?t[a].toUnit:void 0,freqyradio:1==t[a].status?1:2,status:t[a].gnStatus};I.rrGridOpts.data.push(e)}}var i=I.alertObj.savdSucesFuly;n.hisAlertMulti("success",I.alertObj.alertTypeConf,i,I.alertData,I.alertFunction,I.close),I.rentSaved=!0,r.$emit("opw.toggleStatus",{message:!0})}}else null!=e.data.HITService.message.errorMessage?n.failure("Error",e.data.HITService.message.errorMessage):n.failure("Error","Service Map Already existing")})},I.allDoctorGridOptions=angular.copy(a),I.allDoctorGridOptions.name=1,I.admittingDoctorGridOptions=angular.copy(a),I.admittingDoctorGridOptions.name=2,I.otherDoctorGridOptions=angular.copy(a),I.otherDoctorGridOptions.name=3,I.allDoctorGridOptions.data=[],I.admittingDoctorGridOptions.data=[],I.otherDoctorGridOptions.data=[],I.editRow=[],I.ipClear=function(e){var t={visitType:I.visitNoService[0],visitPriority:_.find(I.priorityList,function(e){return 1==e.gQDataCode}),visitNo:0,gnStatus:1};1==e?I.allDoctorGridOptions.data[0]=t:2==e?I.admittingDoctorGridOptions.data[0]=t:3==e&&(I.otherDoctorGridOptions.data[0]=t)},I.addRowToGrid=function(e,t){if(I.data.firstVisitServId||I.data.dayVisitServId||I.data.nightVisitvServId){if(1==t)var a=angular.copy(I.allDoctorGridOptions.data);else if(2==t)a=angular.copy(I.admittingDoctorGridOptions.data);else if(3==t)a=angular.copy(I.otherDoctorGridOptions.data);for(var i=1;i<a.length;i++)if(a[i].isEditable)I.indexId=i;else if(a[i].visitType.gQDataCode==e.visitType.gQDataCode&&a[i].visitPriority.gQDataCode==e.visitPriority.gQDataCode)return void n.information("information","Visit already exists in the grid");e.applicabilityType=t;var r=angular.copy(e);I.editRow[t]?(a[I.indexId]=angular.copy(r),delete I.editRow):a.push(r),1==t?I.allDoctorGridOptions.data=angular.copy(a):2==t?I.admittingDoctorGridOptions.data=angular.copy(a):3==t&&(I.otherDoctorGridOptions.data=angular.copy(a)),I.ipClear(t)}else n.information("information","Please Select Service")},I.editRowToGrid=function(e,t,a){var i=angular.copy(e);if(I.editRow=[],I.editRow[a]=!0,i.visitPriority=angular.copy(_.find(I.priorityList,function(e){return e.gQDataCode==i.visitPriority.gQDataCode})),i.visitType=angular.copy(_.find(I.visitNoService,function(e){return e.gQDataCode==i.visitType.gQDataCode})),1==a){I.allDoctorGridOptions.data[0]=angular.copy(i);var r=angular.copy(I.allDoctorGridOptions.data)}else if(2==a){I.admittingDoctorGridOptions.data[0]=angular.copy(i);r=angular.copy(I.admittingDoctorGridOptions.data)}else if(3==a){I.otherDoctorGridOptions.data[0]=angular.copy(i);r=angular.copy(I.otherDoctorGridOptions.data)}for(var n=0;n<r.length;n++)r[n].isEditable=n==t;1==a?I.allDoctorGridOptions.data=angular.copy(r):2==a?I.admittingDoctorGridOptions.data=angular.copy(r):3==a&&(I.otherDoctorGridOptions.data=angular.copy(r))},I.getGridDataForService=function(e){var t={1:I.getGridDataService=[]};1==e?(I.allDoctorGridOptions.data=[],I.ipClear(1)):2==e?(I.admittingDoctorGridOptions.data=[],I.ipClear(2)):3==e&&(I.otherDoctorGridOptions.data=[],I.ipClear(3)),I.deletedList=[];var a=c.executeQueryURLReset(),i=new Array;c.prepareParamListWithParam("pAPPLICABILITY_TYPE",e,i),c.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,i),c.executeQueryInput("GET_DOCTORS_DETAILS_BASED_ON_APPLICABLE",i,t,!0,!0,a,"popUp",{}).then(function(t){if(t[1][0])for(var a=0;a<I.getGridDataService.length;a++){var i={visitType:_.find(I.visitNoService,function(e){return e.gQDataCode==_.trimEnd(I.getGridDataService[a].VISIT_TYPE)}),visitPriority:_.find(I.priorityList,function(e){return e.gQDataCode==I.getGridDataService[a].VISIT_PRIORITY}),visitNo:parseInt(I.getGridDataService[a].MAX_VISIT_NO),applicabilityType:I.getGridDataService[a].APPLICABILITY_TYPE?I.getGridDataService[a].APPLICABILITY_TYPE:e,gnStatus:1,dvbrSeqId:I.getGridDataService[a].DVBR_SEQ_ID};1==e?I.allDoctorGridOptions.data.push(i):2==e?I.admittingDoctorGridOptions.data.push(i):3==e&&I.otherDoctorGridOptions.data.push(i)}})},function(){var e={1:I.visitService=[],2:I.servicePriority=[]},t=c.executeQueryURLReset(),a=new Array;c.prepareParamListWithParam("pMasterSqId",45006,a),c.executeQueryInput("TRN003",a,e,!0,!1,t,"popUp"),c.executeQueryInput("PRIORITY_TYPE",[],e,!0,!0,t,"popUp").then(function(e){e[1][0]&&(I.priorityList=_.remove(I.servicePriority,function(e){return 2!=e.gQDataCode}),I.visitNoService=_.remove(I.visitService,function(e){return 1!=e.gQDataCode}),I.ipClear(1),I.ipClear(2),I.ipClear(3),R())})}(),I.deletedList=[],I.deleteRowToGrid=function(e,t,a){var i={buttonCallBack1:function(){},buttonCallBack2:function(){if(e.dvbrSeqId){var i=e;i.applicabilityType=a,i.gnStatus=2,I.deletedList.push(i)}1==a?I.allDoctorGridOptions.data.splice(t,1):2==a?I.admittingDoctorGridOptions.data.splice(t,1):3==a&&I.otherDoctorGridOptions.data.splice(t,1)},buttonClose:function(){}};n.hisAlertMulti("warning","Warning","Do You Want To Delete?",{buttonText:"No",buttonText2:"Yes"},i,i)},I.changeVisitType=function(){"2"==I.data.isFirstVisitBillable&&"2"==I.data.isDayVisitBillable&&"2"==I.data.isNightVisitBillable&&(I.data.allDoctor=!1,I.data.otherDoctor=!1,I.data.admittingDoctor=!1)},I.updateRow=function(e,t){if(e.byFixedSlot=parseInt(e.byFixedSlot),e.dummyField=e.dummyField?parseInt(e.dummyField):void 0,e.byFrequencySlot=e.byFrequencySlot?parseInt(e.byFrequencySlot):void 0,e.dummyField2=e.dummyField2?parseInt(e.dummyField2):void 0,1!=e.freqyradio||null!=e.byFixedSlot&&null!=e.dummyField&&null!=e.byFixedSlot&&null!=e.dummyField&&""!==e.byFixedSlot&&""!==e.dummyField)if(2!=e.freqyradio||null!=e.byFrequencySlot&&null!=e.dummyField2&&null!=e.byFrequencySlot&&null!=e.dummyField2&&""!==e.byFrequencySlot&&""!==e.dummyField2)if(1==e.freqyradio&&(e.byFixedSlot>e.dummyField||e.byFixedSlot==e.dummyField)&&""!=e.byFixedSlot&&""!=e.dummyField)n.information("Information","From Slot is must be lesser then To Slot");else if(1==e.freqyradio&&I.rrGridOpts.data[I.editIndex].byFixedSlot==e.byFixedSlot&&I.rrGridOpts.data[I.editIndex].dummyField==e.dummyField||2==e.freqyradio&&I.rrGridOpts.data[I.editIndex].byFrequencySlot==e.byFrequencySlot&&I.rrGridOpts.data[I.editIndex].dummyField2==e.dummyField2)I.pepareJSONData({entity:e});else{for(var a=1;a<I.rrGridOpts.data.length;a++)if(!I.rrGridOpts.data[a].isEdited){if(1==I.rrGridOpts.data[a].status&&2==I.rrGridOpts.data[a].freqyradio&&(I.rrGridOpts.data[a].byFrequencySlot<=e.byFixedSlot||I.rrGridOpts.data[a].byFrequencySlot<=e.dummyField))return void n.information("Information","Please inactivate the overlapped frequencyslot");if(1==e.freqyradio){if(I.rrGridOpts.data[a].byFixedSlot==e.byFixedSlot&&2==I.rrGridOpts.data[a].status)return void n.information("Information","Frequency slot is already Exist, Please Active it");if(1==I.rrGridOpts.data[a].status&&(I.rrGridOpts.data[a].byFixedSlot>e.byFixedSlot||I.rrGridOpts.data[a].dummyField>e.byFixedSlot))return void n.information("Information","Please inactivate the overlapped frequencyslot")}else if(2==e.freqyradio){if(I.rrGridOpts.data[a].byFixedSlot==e.byFixedSlot&&2==I.rrGridOpts.data[a].status)return void n.information("Information","Frequency slot is already Exist, Please Active it");if(1==I.rrGridOpts.data[a].freqyradio&&(I.rrGridOpts.data[a].byFixedSlot>e.byFrequencySlot||I.rrGridOpts.data[a].dummyField>e.byFrequencySlot)&&1==I.rrGridOpts.data[a].status)return void n.information("Information","Please inactivate the overlapped frequencyslot")}}I.pepareJSONData({entity:e})}else n.information("Information","Enter valid frequency slot");else n.information("Information","Enter valid fixed slot")},I.showCompanionGrid=function(){if(10==r.activeFirst){I.rrGridOpts=angular.copy(C),I.servicedtail={};var e={1:I.getCompanionConfigList=[]},t=c.executeQueryURLReset(),a=new Array;c.prepareParamListWithParam("pFacility",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a),c.executeQueryInput("GET_COMPANION_FEE_SERV_ID_BILLING_CONFIG",a,e,!0,!0,t,"popUp",{}).then(function(e){e[1][0]&&(I.servicedtail.ipFlwUpseqId=I.getCompanionConfigList[0].CONFIG_VALUE,N())})}else 2==r.activeFirst&&1==I.errRentStatus&&I.roomRentCheck()},I.saveCompanionConfig=function(){var e=I.rrGridOpts.data;if(I.eqpconfiglist=[],I.is_slot){if(1==e.length)return;for(var t=1;t<e.length;t++){let a={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo",sequence:t,serviceSeqId:I.servicedtail.ipFlwUpseqId,fromUnit:1==e[t].isSlot?parseInt(e[t].byFixedSlot):parseInt(e[t].byFrequencySlot),toUnit:1==e[t].isSlot?parseInt(e[t].dummyField):parseInt(e[t].dummyField2),gnStatus:1==e[t].status?1:2,isSlot:1==e[t].isSlot?1:0,serviceMapId:I.servicedtail?I.servicedtail.serviceMapId:e[t].SERV_MAP_ID,serviceTypeId:10030,serviceslotId:e[t].serviceslotId,isNotcon:I.is_slot,serviceMasterSeqId:I.servicedtail.ipFlwUpseqId,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,practiceId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID_DESC,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID};I.eqpconfiglist.push(a)}}if(!I.is_slot){let e={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo",gnStatus:1,serviceTypeId:10030,serviceMapId:I.servicedtail.serviceMapId,isNotcon:I.is_slot,serviceSeqId:I.servicedtail.ipFlwUpseqId,serviceMasterSeqId:I.servicedtail.ipFlwUpseqId,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,practiceId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID_DESC,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID};I.eqpconfiglist.push(e)}l.companionSave(I.eqpconfiglist,I.is_slot).then(function(e){null==e.data.HITService.message?n.warning("warning","Data not saved successfully"):200==e.status&&(n.success("success","Data Saved successfully"),N())})},I.setGridMinMaxValues=function(e){1==e&&I.rrGridOpts.data[0].byFixedSlot&&parseInt(I.rrGridOpts.data[0].byFixedSlot)>24?1==I.rrGridOpts.data.length?I.rrGridOpts.data[0].byFixedSlot=0:I.editIndex?I.rrGridOpts.data[0].byFixedSlot=I.rrGridOpts.data[I.editIndex].byFixedSlot:I.rrGridOpts.data[0].byFixedSlot=parseInt(I.rrGridOpts.data[I.rrGridOpts.data.length-1].dummyField):2==e&&I.rrGridOpts.data[0].dummyField&&parseInt(I.rrGridOpts.data[0].dummyField)>24?1==I.rrGridOpts.data.length?I.rrGridOpts.data[0].dummyField=1:I.editIndex?I.rrGridOpts.data[0].dummyField=I.rrGridOpts.data[I.editIndex].dummyField:I.rrGridOpts.data[0].dummyField=parseInt(I.rrGridOpts.data[I.rrGridOpts.data.length-1].dummyField):4==e&&I.rrGridOpts.data[0].dummyField2&&parseInt(I.rrGridOpts.data[0].dummyField2)>60?I.editIndex?I.rrGridOpts.data[0].dummyField2=I.rrGridOpts.data[I.editIndex].dummyField2:I.rrGridOpts.data[0].dummyField2=30:3==e&&I.rrGridOpts.data[0].byFrequencySlot&&parseInt(I.rrGridOpts.data[0].byFrequencySlot)>24&&(1==I.rrGridOpts.data.length?I.rrGridOpts.data[0].byFrequencySlot=0:I.editIndex?I.rrGridOpts.data[0].byFrequencySlot=I.rrGridOpts.data[I.editIndex].byFrequencySlot:I.rrGridOpts.data[0].byFrequencySlot=parseInt(I.rrGridOpts.data[I.rrGridOpts.data.length-1].dummyField))}}e.$inject=["$rootScope","roomRentGridDef","ipVisitGridConstants","$uibModal","$scope","hisAlertService","angBillingConfigurationService","serviceMappingGrid","serviceDiscountGrid","QueryService","opVisitConfService","deptGridConst","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","otConfigurationService","$filter","RoleTaskService","uibDatepickerConfig","$timeout","companionConfigGridDef"],angular.module("napierContainerUi").controller("billingConfigController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l){var s=this;s.gridOptions=angular.copy(i),s.isslot=!0,s.equipList=[];var o={1:s.equipList},c=e.executeQueryURLReset();s.valuTypeParamListArr=new Array,e.executeQueryInput("GET_BILLING_EQP_MAST_CONFIG",s.valuTypeParamListArr,o,!0,!0,c,"popUp",{}).then(function(e){}),s.getserDetail=function(e){s.servicedtail=e,s.gridOptions.data=[{flag:!0,freqyradio:1}]},r.$on("equipmentVal",function(e,t){if(null!=s.servicedtail){if(s.servicedtail.ipFlwUpseqId!=t.ipFlwUpseqId){let e={};e.ipFlwUpCode=t.ipFlwUpCode,e.ipFlwUpName=t.ipFlwUpName,e.ipFlwUpseqId=t.ipFlwUpseqId,e.EqpMap=s.servicedtail.EqpMap,s.servicedtail.ipFlwUpseqId!=e.ipFlwUpseqId&&s.getserDetail(e)}}else{let e={};e.ipFlwUpCode=t.ipFlwUpCode,e.ipFlwUpName=t.ipFlwUpName,e.ipFlwUpseqId=t.ipFlwUpseqId,s.getserDetail(e)}}),s.setEqpserv=function(e){s.is_sloValid=!1,s.gridOptions.data[0].byFixedSlot=void 0;var t=s.gridOptions.data[0];s.gridOptions.data=[],s.gridOptions.data[0]=t,e&&s.getEqpDtl(!1)},s.getEqpDtl=function(i){s.eqpValid=!1,s.serviceValid=!1,s.servicedtail=void 0;s.bkpfreq={};var r={1:[]},l=e.executeQueryURLReset();s.eqpCnfList=new Array,e.prepareParamListWithParam("pEqpcode",s.equipmentObj.CODE,s.eqpCnfList),e.prepareParamListWithParam("pFacility",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,s.eqpCnfList),e.executeQueryInput("MEDICAL_EQUIPEMENT_CHARGES_BILL_CONFIG",s.eqpCnfList,r,!0,!0,l,"popUp",{}).then(function(e){s.gridOptions.data=[],s.gridOptions.data[0]={flag:!0,byFixedSlot:"",freqyradio:1};let r=e[1];if(r[0]){s.gridOptions.data[0].freqyradio=1;let t={};if(t.ipFlwUpCode=r[0].SERV_CODE,t.ipFlwUpName=r[0].SERV_NAME,t.ipFlwUpseqId=r[0].SERV_SEQ_ID,t.EqpMap=r[0].SERV_MAP_ID,s.getserDetail(t),r[0].IS_SLOT){for(var l=0;l<e[1].length;l++){if(!r[l].IS_SLOT)continue;let e={byFixedSlot:"true"==r[l].IS_SLOT?r[l].FROM_UNIT:void 0,dummyField:"true"==r[l].IS_SLOT?r[l].TO_UNIT:void 0,byFrequencySlot:"false"==r[l].IS_SLOT?r[l].FROM_UNIT:void 0,dummyField2:"false"==r[l].IS_SLOT?r[l].TO_UNIT:void 0,status:r[l].GN_STATUS,serviceslotId:r[l].SERV_SLOT_ID,serviceMapId:s.servicedtail.EqpMap,isfirst:!0,isEdited:!0,freqyradio:"true"==r[l].IS_SLOT?1:2,isSlot:"true"==r[l].IS_SLOT};s.gridOptions.data.push(e)}s.is_slot=!0}else s.is_slot=!1}else{var o={};o.url=t.PURCHASEENQUIRYSERVICE.URL,o.requestData=angular.copy(a),angular.extend(o.requestData.message,{queryList:[{"com.napier.core.service.vo.query.Query":{identifier:"GET_CONNECTION_LEVEL_DATA",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pEqpcode",value:s.equipmentObj.CODE},{paramName:"pFacility",value:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID}]}]}}]}),n.sendRestRequest(o).then(function(e){if(e.data.HITService.message.queryList&&e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]){if(e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].length>0)var t=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"];else t=[e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]];for(var a=0;a<t.length;a++)for(var r={},n=0;n<t[a].columnList[0]["com.napier.core.service.vo.query.Column"].length;n++)"A.SERV_MAP_ID"==t[a].columnList[0]["com.napier.core.service.vo.query.Column"][n].name&&angular.extend(r,{SERV_MAP_ID:t[a].columnList[0]["com.napier.core.service.vo.query.Column"][n].data}),"A.SERV_SEQ_ID"==t[a].columnList[0]["com.napier.core.service.vo.query.Column"][n].name&&angular.extend(r,{SERV_SEQ_ID:t[a].columnList[0]["com.napier.core.service.vo.query.Column"][n].data}),"A.EQUIP_CODE"==t[a].columnList[0]["com.napier.core.service.vo.query.Column"][n].name&&angular.extend(r,{EQUIP_CODE:t[a].columnList[0]["com.napier.core.service.vo.query.Column"][n].data}),"D.SERV_NAME"==t[a].columnList[0]["com.napier.core.service.vo.query.Column"][n].name&&angular.extend(r,{SERV_NAME:t[a].columnList[0]["com.napier.core.service.vo.query.Column"][n].data}),"D.SERV_CODE"==t[a].columnList[0]["com.napier.core.service.vo.query.Column"][n].name&&angular.extend(r,{SERV_CODE:t[a].columnList[0]["com.napier.core.service.vo.query.Column"][n].data});let l={};r&&(l.ipFlwUpCode=r.SERV_CODE,l.ipFlwUpName=r.SERV_NAME,l.ipFlwUpseqId=r.SERV_SEQ_ID,l.EqpMap=r.SERV_MAP_ID,s.getserDetail(l),null==i&&(s.is_slot=!1))}})}})},s.setGridInputs=function(e,t){1==s.gridOptions.data[0].freqyradio&&s.gridOptions.data.length>1?(s.gridOptions.data[0].byFixedSlot=s.gridOptions.data[s.gridOptions.data.length-1].dummyField,s.gridOptions.data[0].byFrequencySlot="",s.gridOptions.data[0].dummyField2=""):2==s.gridOptions.data[0].freqyradio&&s.gridOptions.data.length>1&&(s.gridOptions.data[0].byFrequencySlot=s.gridOptions.data[s.gridOptions.data.length-1].dummyField,s.gridOptions.data[0].dummyField2=30,s.gridOptions.data[0].byFixedSlot="",s.gridOptions.data[0].dummyField="")},s.addRow=function(e,t,a){if(s.bkpfreq.slot=void 0,null!=e.entity.byFixedSlot&&null!=e.entity.dummyField||null!=e.entity.byFrequencySlot&&null!=e.entity.dummyField2)if(parseInt(e.entity.byFixedSlot)>parseInt(e.entity.dummyField))l.information("Information","From Slot is must be lesser then To Slot");else{if(1==e.entity.freqyradio){s.k=0;for(var i=!0,r=1;r<s.gridOptions.data.length;r++){if(parseInt(e.entity.byFixedSlot)<=parseInt(s.gridOptions.data[r].byFixedSlot)||parseInt(e.entity.dummyField)<=parseInt(s.gridOptions.data[r].dummyField)){if(a){if(r==t)continue;return l.information("Information","Enter valid Fixedslot"),s.gridOptions.data[r].byFixedSlot=void 0,void(s.gridOptions.data[r].dummyField=void 0)}return void l.information("Information","Enter valid Fixedslot")}1==s.gridOptions.data[r].status&&s.k<s.gridOptions.data[r].byFrequencySlot&&i&&(s.k=s.gridOptions.data[r].byFrequencySlot,i=!1)}for(r=1;r<s.gridOptions.data.length;r++)if(1==s.gridOptions.data[r].status)if(s.k>0){if(s.k<=e.entity.byFixedSlot){if(a){if(r==t)continue;return l.information("Information","Slot already exist"),s.gridOptions.data[r].byFixedSlot=void 0,void(s.gridOptions.data[r].dummyField=void 0)}return void l.information("Information","Slot already exist")}}else if(parseInt(e.entity.byFixedSlot)<=parseInt(s.gridOptions.data[r].byFixedSlot)||parseInt(e.entity.dummyField)<=parseInt(s.gridOptions.data[r].dummyField))return void l.information("Information","Enter valid Fixedslot");if(parseInt(e.entity.byFixedSlot)>24||parseInt(e.entity.dummyField)>24)return void l.information("Information","Can not enter slot value more then 24 hours")}else if(2==e.entity.freqyradio){for(r=1;r<s.gridOptions.data.length;r++)if(1==s.gridOptions.data[r].status){if(s.gridOptions.data[r].byFrequencySlot&&(parseInt(e.entity.byFrequencySlot)<=parseInt(s.gridOptions.data[r].byFrequencySlot)||parseInt(e.entity.byFrequencySlot)>=parseInt(s.gridOptions.data[r].byFrequencySlot)))return void l.information("Information","Frequency slot is already in Active state")}else if(parseInt(e.entity.byFrequencySlot)==parseInt(s.gridOptions.data[r].byFrequencySlot))return void l.information("Information","Frequency slot is already Exist please Active it");if(parseInt(e.entity.dummyField2)>1440)return void l.information("Information","minute should not more then 1440 minutes")}if(null!=s.equipmentObj&&null!=s.servicedtail){if(1==parseInt(e.entity.freqyradio)&&parseInt(s.gridOptions.data.length)>1&&parseInt(2==s.gridOptions.data[s.gridOptions.data.length-1].freqyradio)&&(s.bkpfreq.isset||(s.bkpfreq.slot=s.gridOptions.data[s.gridOptions.data.length-1].serviceslotId,s.bkpfreq.isset=!0)),parseInt(e.entity.byFixedSlot)>24||parseInt(e.entity.dummyField)>24||parseInt(e.entity.byFrequencySlot)>24)l.information("Information","Fixed slot should not more then 24 hours");else if(!a){let t={byFixedSlot:e.entity.byFixedSlot,dummyField:e.entity.dummyField,byFrequencySlot:e.entity.byFrequencySlot,dummyField2:e.entity.dummyField2,serviceslotId:1==s.bkpfreq.isset?s.bkpfreq.slot:void 0,status:1,isfirst:!0,isEdited:!0,freqyradio:e.entity.freqyradio,isSlot:e.entity.freqyradio};s.gridOptions.data.push(t),s.gridOptions.data[0]={flag:!0,byFixedSlot:s.gridOptions.data[0].dummyField,dummyField:"",freqyradio:e.entity.freqyradio}}}else s.validate()}else l.information("Information","Set slot or frequency")},s.slotValid=function(e,t,a){t>0&&s.addRow(e,t,!0)},s.chng2edit=function(e,t){s.gridOptions.data[t].isEdited=!1},s.validate=function(){null==s.equipmentObj&&(s.eqpValid=!0),null==s.servicedtail&&(s.serviceValid=!0)},s.saveEqpConfig=function(e){if(null!=s.equipmentObj&&null!=s.servicedtail){if(s.eqpconfiglist=[],s.is_slot){if(1==e.length)return;for(var t=1;t<e.length;t++){let a={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo",sequence:t,serviceSeqId:s.servicedtail.ipFlwUpseqId,fromUnit:1==e[t].isSlot?parseInt(e[t].byFixedSlot):parseInt(e[t].byFrequencySlot),toUnit:1==e[t].isSlot?parseInt(e[t].dummyField):parseInt(e[t].dummyField2),gnStatus:1==e[t].status?1:2,isSlot:1==e[t].isSlot?1:0,serviceMapId:s.servicedtail?s.servicedtail.EqpMap:e[t].SERV_MAP_ID,serviceTypeId:10012,serviceslotId:e[t].serviceslotId,isNotcon:s.is_slot,serviceMasterSeqId:s.equipmentObj.CODE,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,practiceId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID_DESC,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID};s.eqpconfiglist.push(a)}}if(!s.is_slot){let e={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo",gnStatus:1,serviceTypeId:10012,serviceMapId:s.servicedtail.EqpMap,isNotcon:s.is_slot,serviceSeqId:s.servicedtail.ipFlwUpseqId,serviceMasterSeqId:s.equipmentObj.CODE,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,practiceId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID_DESC,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID};s.eqpconfiglist.push(e)}s.sendRequest(s.eqpconfiglist)}else s.validate()},s.status=function(e,t){for(var a=s.gridOptions.data,i=0,r=!1,n=1;n<a.length;n++)2==a[n].freqyradio&&n!=t?e.freqyradio==a[n].freqyradio&&(s.gridOptions.data[n].status=2):2==a[n].freqyradio&&n==t?(i=s.gridOptions.data[n].byFrequencySlot,r=!0):1==a[n].freqyradio&&n==t&&(s.gridOptions.data[n].status,s.gridOptions.data[n].status);for(n=0;n<a.length;n++)2==a[n].freqyradio&&1==a[n].status&&(i=s.gridOptions.data[n].byFrequencySlot,r=!0),r&&i<s.gridOptions.data[n].dummyField&&1==a[n].freqyradio&&t==n&&(s.gridOptions.data[n].status=2);for(n=0;n<a.length;n++)r&&i<s.gridOptions.data[n].dummyField&&1==a[n].freqyradio&&(s.gridOptions.data[n].status=2)},s.sendRequest=function(e){var t={url:"HISServices/daFeeStructure"};t.requestData={operation:"SaveServiceConfiguration",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:{"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList",billingHISConfigurationVo:[{"com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo":[{configurationId:12,value:0==s.is_slot?0:1}]}],billingServiceConfigurationVoList:[{"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList":e}]}},n.sendRestRequest(t).then(function(e){null==e.data.HITService.message?l.warning("warning","Data not saved successfully"):200==e.status&&l.information("information","Data Saved successfully")})}}e.$inject=["QueryService","PURCHASEAPIS","purchaseOrderSearchQuery","slotLevelGridDef","$scope","CallManager","hisAlertService"],angular.module("napierContainerUi").controller("equipmentConfigCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c){var d=this;d.gridOptions=angular.copy(t),d.gridOptions2=angular.copy(a),d.reducedRateGrid=angular.copy(n),d.gradeGridOptions=angular.copy(l),d.multipleSrugeries=!1,d.packSeqGridOptions={enableHorizontalScrollbar:0,columnDefs:[{field:"packSeqNo",displayName:"Package Sequence No.",cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" class="form-control" placeholder="#"></div>'},{field:"percentOfRate",displayName:"Package Sequence No.",cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" class="form-control" placeholder="Enter"></div>'},{field:"actions",displayName:"Actions",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="true"><button class="his-btn his-btn-info his-grid-btn"><i class="fa fa-plus"></i> Add</button></div><div ng-if="false"><i class="fa fa-pencil"></i></div></div>'}]},d.gridOptions.data=[{flag:!0}],d.reducedRateGrid.data=[{flag:!0}],d.otTheaterList=[],d.data={};var p={1:d.otTheaterList},u=e.executeQueryURLReset();d.setOTTheaterList=new Array;var m=new Array;e.prepareParamListWithParam("pFacility_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,m),e.executeQueryInput("THEATER_COMBO_001",m,p,!0,!0,u,"popUp",{}).then(function(e){}),d.callFetchData=function(){if(1==d.theaterradioCode){d.theatreList=[];var t={1:d.theatreList},a=e.executeQueryURLReset();d.setTheatreList=new Array;var i=new Array;e.prepareParamListWithParam("pConfigSeqId",400,i),e.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,i),e.executeQueryInput("GET_OT_PERCENTAGE_DATA",i,t,!0,!0,a,"popUp",{}).then(function(e){d.servicedt={},d.servicedt.ipFlwUpCode2=d.theatreList[0].SERV_CODE,d.servicedt.ipFlwUpName2=d.theatreList[0].SERV_NAME,d.servicedt.ipFlwUpseqId2=d.theatreList[0].CONFIG_VALUE})}},d.callServices=function(){if(2==d.radioCode){d.theatre=[];var t={1:d.theatre},a=e.executeQueryURLReset();d.setTheatre=new Array;var i=new Array;e.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,i),e.executeQueryInput("OT_CONF_GET_DATA",i,t,!0,!0,a,"popUp",{}).then(function(e){for(var t=0;t<d.theatre.length;t++)"IS_OT_SLOT_BASED"==d.theatre[t].PARAMETER&&(d.value=d.theatre[t].VALUE);0==d.value?(d.theaterradioCode=1,d.callFetchData(d.theaterradioCode)):d.theaterradioCode=2})}else if(3==d.radioCode){d.surgeonL=[];var r={1:d.surgeonL},n=e.executeQueryURLReset();d.setSurgeonL=new Array;var l=new Array;e.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,l),e.executeQueryInput("OT_CONF_GET_DATA",l,r,!0,!0,n,"popUp",{}).then(function(e){for(var t=0;t<d.surgeonL.length;t++)"IS_SURGEON_MANUAL_ENTRY"==d.surgeonL[t].PARAMETER&&(d.value=d.surgeonL[t].VALUE);0==d.value?d.surgeonRadio=1:d.surgeonRadio=2}),d.surgeonList=[];var s={1:d.surgeonList},o=e.executeQueryURLReset();d.setSurgeonList=new Array;var c=new Array;e.prepareParamListWithParam("pServTypeCode",10023,c),e.executeQueryInput("SURGERY_SERVICE_DETAILS",c,s,!0,!0,o,"popUp",{}).then(function(e){d.ipFlwUpCode3=d.surgeonList[0].SERV_CODE,d.ipFlwUpName3=d.surgeonList[0].SERV_NAME,d.ipFlwUpseqId3=d.surgeonList[0].SERV_SEQ_ID})}else if(4==d.radioCode){d.anesthetistL=[];var p={1:d.anesthetistL},u=e.executeQueryURLReset();d.setAnesthetistL=new Array;var m=new Array;e.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,m),e.executeQueryInput("OT_CONF_GET_DATA",m,p,!0,!0,u,"popUp",{}).then(function(e){for(var t=0;t<d.anesthetistL.length;t++)"IS_Anesthetist_MANUAL_ENTRY"==d.anesthetistL[t].PARAMETER&&(d.value=d.anesthetistL[t].VALUE);0==d.value?d.anesthetistRadio=1:d.anesthetistRadio=2}),d.anaesthetistList=[];var g={1:d.anaesthetistList},S=e.executeQueryURLReset();d.setAnaesthetistList=new Array;var v=new Array;e.prepareParamListWithParam("pServTypeCode",10003,v),e.executeQueryInput("SURGERY_SERVICE_DETAILS",v,g,!0,!0,S,"popUp",{}).then(function(e){d.ipFlwUpCode4=d.anaesthetistList[0].SERV_CODE,d.ipFlwUpName4=d.anaesthetistList[0].SERV_NAME,d.ipFlwUpseqId4=d.anaesthetistList[0].SERV_SEQ_ID})}else if(5==d.radioCode){d.asstsurgeonL=[];var D={1:d.asstsurgeonL},y=e.executeQueryURLReset();d.setAsstsurgeonL=new Array;var f=new Array;e.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,f),e.executeQueryInput("OT_CONF_GET_DATA",f,D,!0,!0,y,"popUp",{}).then(function(e){for(var t=0;t<d.asstsurgeonL.length;t++)"IS_Asst_Surgeon_MANUAL_ENTRY"==d.asstsurgeonL[t].PARAMETER&&(d.value=d.asstsurgeonL[t].VALUE);0==d.value?d.asstsurgeonRadio=1:d.asstsurgeonRadio=2}),d.asstsurgeonList=[];var C={1:d.asstsurgeonList},I=e.executeQueryURLReset();d.setAsstSurgeonList=new Array;var A=new Array;e.prepareParamListWithParam("pServTypeCode",10004,A),e.executeQueryInput("SURGERY_SERVICE_DETAILS",A,C,!0,!0,I,"popUp",{}).then(function(e){d.ipFlwUpCode5=d.asstsurgeonList[0].SERV_CODE,d.ipFlwUpName5=d.asstsurgeonList[0].SERV_NAME,d.ipFlwUpseqId5=d.asstsurgeonList[0].SERV_SEQ_ID})}else if(1==d.theaterradioCode){d.theatrePercentage=[];var E={1:d.theatrePercentage},h=e.executeQueryURLReset();d.setTheatrePercentage=new Array;var b=new Array;e.prepareParamListWithParam("pServTypeCode",74,b),e.executeQueryInput("SURGERY_SERVICE_DETAILS",b,E,!0,!0,h,"popUp",{}).then(function(e){d.servicedt={},d.servicedt.ipFlwUpCode2=d.theatrePercentage[0].SERV_CODE,d.servicedt.ipFlwUpName2=d.theatrePercentage[0].SERV_NAME,d.servicedt.ipFlwUpseqId2=d.theatrePercentage[0].SERV_SEQ_ID})}else if(1==d.radioCode){d.surgery=[];var T={1:d.surgery},_=e.executeQueryURLReset();d.setSurgery=new Array;var L=new Array;e.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,L),e.executeQueryInput("OT_CONF_GET_DATA",L,T,!0,!0,_,"popUp",{}).then(function(e){for(var t=0;t<d.surgery.length;t++)"IS_SURGEORY_GRADE_DEPENDENT"==d.surgery[t].PARAMETER?d.value=d.surgery[t].VALUE:"IS_Multible_Surgeory_Billing_Apllicatabale"==d.surgery[t].PARAMETER?d.msvalue=d.surgery[t].VALUE:"IS_AutoApply_Surgeory_withHighest_Rate"==d.surgery[t].PARAMETER&&(d.aasvalue=d.surgery[t].VALUE);0==d.value?(d.surgChrgRadio=1,1==d.surgChrgRadio&&0==d.msvalue&&(0==d.aasvalue?d.surgChrgRadio2=3:d.surgChrgRadio2=4)):(d.surgChrgRadio=2,2==d.surgChrgRadio&&d.getGradeData(),1==d.msvalue&&(0==d.aasvalue?d.surgChrgRadio2=3:d.surgChrgRadio2=4))})}};var g=d.reducedRateGrid.data[0];d.reducedRateGrid.data=[],d.reducedRateGrid.data[0]=g,d.addTheaterGrid=function(e){d.gridOptions2.data=[];let t={theaterType:e[0].THEATRE_NAME,slots:e[0].UNITS_VALUE};d.gridOptions2.data.push(t)},d.addReduceRateGridRow=function(t,a){if(null!=t){if(t.entity.percentageOfRate>100)return void s.information("Information","Don't Enter Percentage Morethan 100");if(t.entity.sequence>100)return void s.information("Information","Don't Enter Surgery Number Morethan 100");if(t.entity.percentageOfRate<0)return void s.information("Invalid Entry","Please Enter Only Positive values");if(t.entity.sequence<0)return void s.information("Invalid Entry","Please Enter Only Positive values");if(null==t.entity.sequence||""==t.entity.sequence||null==t.entity.sequence)return void s.information("Information","Please Enter Surgery Number");if(null==t.entity.percentageOfRate||""==t.entity.percentageOfRate||null==t.entity.percentageOfRate)return void s.information("Information","Please Enter Percentage");if(null!=t.entity.sequence){for(var i=1;i<t.grid.rows.length;i++)t.entity.sequence==t.grid.rows[i].entity.sequence&&(d.sequence=t.grid.rows[i].entity.sequence);if(d.sequence==t.entity.sequence)return void s.information("Information","Surgery Number Already Exist")}if(null!=t.entity.percentageOfRate){for(i=1;i<t.grid.rows.length;i++)t.entity.percentageOfRate==t.grid.rows[i].entity.percentageOfRate&&(d.percentageOfRate=t.grid.rows[i].entity.percentageOfRate,d.status=t.grid.rows[i].entity.status);if(d.percentageOfRate==t.entity.percentageOfRate&&2==d.status)return void s.information("Information","Percentage Already Exist,Please Active It");if(d.percentageOfRate==t.entity.percentageOfRate&&1==d.status)return void s.information("Information","Percentage Already Exist")}let e={sequence:t.entity.sequence,percentageOfRate:t.entity.percentageOfRate,status:1,isfirst:!0,isEdited:!0};d.reducedRateGrid.data.push(e),t.entity.sequence="",t.entity.percentageOfRate="",d.reducedRateGrid.data[0]={flag:!0}}else if(1==d.multipleSrugeries){if(d.reducedRateGrid.data.length>1)return;d.percentageList=[];var r={1:d.percentageList},n=e.executeQueryURLReset(),l=(new Array,new Array);e.prepareParamListWithParam("pFacility_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,l),e.executeQueryInput("REDUCERATE_GRID_001",l,r,!0,!0,n,"popUp",{}).then(function(e){if(d.percentageList.length>0)for(var t=0;t<d.percentageList.length;t++){let e={sequence:d.percentageList[t].SEQUENCE,percentageOfRate:d.percentageList[t].PERCENTAGE,status:d.percentageList[t].GN_STATUS,reducerateConfgId:d.percentageList[t].REDUCERATE_CONFIG_ID,isfirst:!0,isEdited:!0};d.reducedRateGrid.data.push(e),d.reducedRateGrid.data[0]={flag:!0}}})}else d.reducedRateGrid.data=[],d.reducedRateGrid.data[0]={flag:!0}},d.status=function(e,t){for(var a=d.gridOptions.data,i=0,r=!1,n=1;n<a.length;n++)2==a[n].freqyradio&&n!=t?e.freqyradio==a[n].freqyradio&&(d.gridOptions.data[n].status=2):2==a[n].freqyradio&&n==t?(i=d.gridOptions.data[n].byFrequencySlot,r=!0):1==a[n].freqyradio&&n==t&&(d.gridOptions.data[n].status,d.gridOptions.data[n].status);for(n=0;n<a.length;n++)2==a[n].freqyradio&&1==a[n].status&&(i=d.gridOptions.data[n].byFrequencySlot,r=!0),r&&i<d.gridOptions.data[n].dummyField&&1==a[n].freqyradio&&t==n&&(d.gridOptions.data[n].status=2);for(n=0;n<a.length;n++)r&&i<d.gridOptions.data[n].dummyField&&1==a[n].freqyradio&&(d.gridOptions.data[n].status=2)},d.addGradeRow=function(e){if(null==d.gradeName||""==d.gradeName)return void s.information("Information","Please Enter Grade");if(""==d.servicedt.ipFlwUpCode||""==d.servicedt.ipFlwUpName||null==d.servicedt.ipFlwUpCode||null==d.servicedt.ipFlwUpName)return void s.information("Information","Please Select Grade Service");if(null!=d.gradeName){for(var t=0;t<d.gradeGridOptions.data.length;t++)d.gradeName==d.gradeGridOptions.data[t].gradeName&&(d.grade=d.gradeGridOptions.data[t].gradeName,d.isEditFlag=d.gradeGridOptions.data[t].isEditedFlag);if(!d.isEditFlag&&d.grade==d.gradeName)return void s.information("Information","Grade Already Exist")}if(d.gradeGridOptions.data.length>0)for(t=0;t<d.gradeGridOptions.data.length;t++)if(d.gradeName==d.gradeGridOptions.data[t].gradeName||d.gradeGridOptions.data[t].gradeServiceCode==d.servicedt.ipFlwUpCode||d.gradeGridOptions.data[t].gradeServiceDesc==d.servicedt.ipFlwUpName)return d.gradeGridOptions.data[t].gradeName=d.gradeName,d.gradeGridOptions.data[t].gradeServiceCode=d.servicedt.ipFlwUpCode,d.gradeGridOptions.data[t].gradeServiceDesc=d.servicedt.ipFlwUpName,d.gradeGridOptions.data[t].serviceSeqId=d.servicedt.ipFlwUpseqId,d.gradeGridOptions.data[t].isEdited=!0,d.gradeName="",d.servicedt.ipFlwUpCode="",void(d.servicedt.ipFlwUpName="");let a={gradeName:d.gradeName,gradeServiceCode:d.servicedt.ipFlwUpCode,gradeServiceDesc:d.servicedt.ipFlwUpName,serviceSeqId:d.servicedt.ipFlwUpseqId,status:1,isfirst:!0,isEdited:!0};d.gradeGridOptions.data.push(a),d.gradeName="",d.servicedt.ipFlwUpCode="",d.servicedt.ipFlwUpName=""},d.getGradeData=function(){d.multipleSrugeries=!1,d.servicedt={},d.gradeName="",d.servicedt.ipFlwUpCode="",d.servicedt.ipFlwUpName="",d.gradeListData=[];var t={1:d.gradeListData},a=e.executeQueryURLReset();d.setgradeListData=new Array;var i=new Array;e.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,i),e.executeQueryInput("GET_GRADE_SERVICE_DATA",i,t,!0,!0,a,"popUp",{}).then(function(e){if(d.gradeGridOptions.data=[],d.gradeListData.length>0)for(var t=0;t<d.gradeListData.length;t++){let e={gradeName:d.gradeListData[t].DESCRIPTION,gradeServiceCode:d.gradeListData[t].SERV_CODE,gradeServiceDesc:d.gradeListData[t].SERV_NAME,status:d.gradeListData[t].GN_STATUS,serviceSeqId:d.gradeListData[t].SERV_SEQ_ID,serviceMapId:d.gradeListData[t].SERV_MAP_ID,gradeCode:d.gradeListData[t].CODE,gslSeqId:d.gradeListData[t].GSL_SEQ_ID,isfirst:!0,isEdited:!0};d.gradeGridOptions.data.push(e)}})},d.getotccDtl=function(){d.otccValid=!1,d.serviceValid=!1,d.servicedtail=void 0,d.otccCnfgList=[];var t={1:d.otccCnfgList},a=e.executeQueryURLReset();d.setOtccCnfgList=new Array;var i=new Array;e.prepareParamListWithParam("pServMasterSeqId",d.theaterObj.CODE,i),e.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,i),e.executeQueryInput("GET_THEATER_DETAILS",i,t,!0,!0,a,"popUp",{}).then(function(e){d.gridOptions.data=[],d.gridOptions.data[0]={flag:!0,byFixedSlot:"",freqyradio:1};let t=e[1];if(d.gridOptions.data[0].freqyradio=1,d.servicedt={},d.servicedt.ipFlwUpCode2=t[0].SERV_CODE,d.servicedt.ipFlwUpName2=t[0].SERV_NAME,d.servicedt.ipFlwUpseqId2=t[0].SERV_SEQ_ID,d.servicedt.otccMap=t[0].SERV_MAP_ID,d.getserDetail(d.servicedt),t[0].IS_SLOT){for(var a=0;a<e[1].length;a++){let e={byFixedSlot:"true"==t[a].IS_SLOT?t[a].FROM_UNIT:void 0,dummyField:"true"==t[a].IS_SLOT?t[a].TO_UNIT:void 0,byFrequencySlot:"false"==t[a].IS_SLOT?t[a].FROM_UNIT:void 0,dummyField2:"false"==t[a].IS_SLOT?t[a].TO_UNIT:void 0,status:t[a].GN_STATUS,serviceslotId:t[a].SERV_SLOT_ID,serviceMapId:d.servicedtail.otccMap,isfirst:!0,isEdited:!0,freqyradio:"true"==t[a].IS_SLOT?1:2,isSlot:"true"==t[a].IS_SLOT};d.gridOptions.data.push(e)}d.is_slot=!0}else d.is_slot=!1})},d.setGridInputs=function(e,t){d.k=0,1==d.gridOptions.data[0].freqyradio&&d.gridOptions.data.length>1?(d.gridOptions.data[0].byFixedSlot=d.gridOptions.data[d.gridOptions.data.length-1].dummyField,d.gridOptions.data[0].byFrequencySlot="",d.gridOptions.data[0].byFixedSlot="",d.gridOptions.data[0].dummyField2=""):2==d.gridOptions.data[0].freqyradio&&d.gridOptions.data.length>1&&(d.gridOptions.data[0].byFrequencySlot=d.gridOptions.data[d.gridOptions.data.length-1].dummyField,d.gridOptions.data[0].dummyField2="",d.gridOptions.data[0].byFixedSlot="",d.gridOptions.data[0].dummyField="")},d.addRow=function(e,t,a){if(null!=e.entity.byFixedSlot&&null!=e.entity.dummyField||null!=e.entity.byFrequencySlot&&null!=e.entity.dummyField2)if(parseInt(e.entity.byFixedSlot)>parseInt(e.entity.dummyField))s.information("Information","From Slot is must be lesser then To Slot");else{if(1==e.entity.freqyradio){d.k=0;for(var i=!0,r=1;r<d.gridOptions.data.length;r++){if(parseInt(e.entity.byFixedSlot)<=parseInt(d.gridOptions.data[r].byFixedSlot)||parseInt(e.entity.dummyField)<=parseInt(d.gridOptions.data[r].dummyField)){if(a){if(r==t)continue;return void s.information("Information","Enter valid Fixedslot")}return void s.information("Information","Enter valid Fixedslot")}1==d.gridOptions.data[r].status&&d.k<d.gridOptions.data[r].byFrequencySlot&&i&&(d.k=d.gridOptions.data[r].byFrequencySlot,i=!1)}for(r=1;r<d.gridOptions.data.length;r++)if(1==d.gridOptions.data[r].status)if(d.k>0){if(d.k<=e.entity.byFixedSlot){if(a){if(r==t)continue;return void s.information("Information","Slot already exist")}return void s.information("Information","Slot already exist")}}else if(parseInt(e.entity.byFixedSlot)<=parseInt(d.gridOptions.data[r].byFixedSlot)||parseInt(e.entity.dummyField)<=parseInt(d.gridOptions.data[r].dummyField))return void s.information("Information","Enter valid Fixedslot");if(parseInt(e.entity.byFixedSlot)>23||parseInt(e.entity.dummyField)>23)return void s.information("Information","slot could not enter more then 23 hours")}else if(2==e.entity.freqyradio){for(r=1;r<d.gridOptions.data.length;r++)if(1==d.gridOptions.data[r].status){if(d.gridOptions.data[r].byFrequencySlot&&(parseInt(e.entity.byFrequencySlot)<=parseInt(d.gridOptions.data[r].byFrequencySlot)||parseInt(e.entity.byFrequencySlot)>=parseInt(d.gridOptions.data[r].byFrequencySlot)))return void s.information("Information","Frequency slot is already in Active state")}else if(parseInt(e.entity.byFrequencySlot)==parseInt(d.gridOptions.data[r].byFrequencySlot))return void s.information("Information","Frequency slot is already Exist please Active it");if(parseInt(e.entity.dummyField2)>1440)return void s.information("Information","minute should not more then 1440 minutes")}if(null!=d.theaterObj&&null!=d.servicedtail){if(1==parseInt(e.entity.freqyradio)&&parseInt(d.gridOptions.data.length)>1&&parseInt(2==d.gridOptions.data[d.gridOptions.data.length-1].freqyradio)&&(d.bkpfreq.isset||(d.bkpfreq.slot=d.gridOptions.data[d.gridOptions.data.length-1].serviceslotId,d.bkpfreq.isset=!0)),parseInt(e.entity.byFixedSlot)>23||parseInt(e.entity.dummyField)>23||parseInt(e.entity.byFrequencySlot)>23)s.information("Information","Fixed slot should not more then 23 hours");else if(!a){let t={byFixedSlot:parseInt(e.entity.byFixedSlot),dummyField:parseInt(e.entity.dummyField),byFrequencySlot:e.entity.byFrequencySlot,dummyField2:e.entity.dummyField2,status:1,isfirst:!0,isEdited:!0,freqyradio:e.entity.freqyradio,isSlot:e.entity.freqyradio};d.gridOptions.data.push(t),d.gridOptions.data[0]={flag:!0,byFixedSlot:d.gridOptions.data[0].dummyField,dummyField:"",freqyradio:e.entity.freqyradio}}}else d.validate()}else s.information("Information","Set slot or frequency")},d.slotValid=function(e,t,a){t>0&&d.addRow(e,t,!0)},d.chng2edit=function(e,t){d.gridOptions.data[t]&&(d.gridOptions.data[t].isEdited=!1),d.reducedRateGrid.data[t]&&(d.reducedRateGrid.data[t].isEdited=!1),d.gradeGridOptions.data[t]&&(d.gradeGridOptions.data[t].isEdited=!1),d.gradeEdit(e)},d.gradeEdit=function(e){d.servicedt={},d.gradeGridOptions.data[t];for(var t=0;t<d.gradeGridOptions.data.length;t++)e.entity.gradeName==d.gradeGridOptions.data[t].gradeName?(d.gradeGridOptions.data[t].isEditedFlag=!0,d.gradeName=d.gradeGridOptions.data[t].gradeName,d.servicedt.ipFlwUpCode=d.gradeGridOptions.data[t].gradeServiceCode,d.servicedt.ipFlwUpName=d.gradeGridOptions.data[t].gradeServiceDesc,d.servicedt.ipFlwUpseqId=d.gradeGridOptions.data[t].serviceSeqId):d.gradeGridOptions.data[t].isEditedFlag=!1},d.gridEmpty=function(){if(1==d.radioCode&&1==d.surgChrgRadio&&(d.multipleSrugeries=!1),2==d.radioCode){if(2==d.theaterradioCode){var e=d.gridOptions.data[0];d.gridOptions.data=[],d.gridOptions.data.push(e),d.theaterObj="",d.servicedt.ipFlwUpCode2="",d.servicedt.ipFlwUpName2=""}}else data.ipFlwUpCode="",data.ipFlwUpName=""},d.validate=function(){1==d.radioCode?2==d.surgChrgRadio&&(null==d.gradeName&&(d.gradeValid=!0),null==d.servicedtail&&(d.serviceValid=!0)):2==d.radioCode&&2==d.theaterradioCode&&(null==d.theaterObj.CODE&&(d.theatervalid=!0),null==d.servicedtail&&(d.serviceValid=!0))},d.getserDetail=function(e){d.servicedtail=e},i.$on("otconfigVal",function(e,t){d.servicedt={},d.serviceValid=!1,1==d.radioCode?(d.servicedt.ipFlwUpCode=t.ipFlwUpCode,d.servicedt.ipFlwUpName=t.ipFlwUpName,d.servicedt.ipFlwUpseqId=t.ipFlwUpseqId):2==d.radioCode&&(d.servicedt.ipFlwUpCode2=t.ipFlwUpCode,d.servicedt.ipFlwUpName2=t.ipFlwUpName,d.servicedt.ipFlwUpseqId2=t.ipFlwUpseqId),d.getserDetail(d.servicedt)}),d.saveOTServiceConf=function(){if(2==d.radioCode){var t=[];if(2==d.theaterradioCode){for(var a=1;a<d.gridOptions.data.length;a++)t.push({sequence:a,serviceslotId:d.gridOptions.data[a].serviceslotId,serviceMapId:d.gridOptions.data[a].serviceMapId,serviceSeqId:d.servicedtail.ipFlwUpseqId2,fromUnit:1==d.gridOptions.data[a].isSlot?parseInt(d.gridOptions.data[a].byFixedSlot):parseInt(d.gridOptions.data[a].byFrequencySlot),toUnit:1==d.gridOptions.data[a].isSlot?parseInt(d.gridOptions.data[a].dummyField):parseInt(d.gridOptions.data[a].dummyField2),gnStatus:1==d.gridOptions.data[a].status?1:2,isSlot:1==d.gridOptions.data[a].isSlot?1:0,isNotcon:d.is_slot,serviceMasterSeqId:d.theaterObj.CODE,theaterDesc:d.theaterObj.DESCRIPTION,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,practiceId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID_DESC,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION});var r={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList",billingHISConfigurationVo:[{"com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo":[{parameter:"IS_OT_SLOT_BASED",value:1==d.theaterradioCode?0:1,type:d.radioCode}]}],billingServiceConfigurationVoList:[{"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo":t}]};o.saveSlotService(r).then(function(t){if(null!=t.data.HITService.message.billingServiceConfigurationVoList){var a=t.data.HITService.message.billingServiceConfigurationVoList[0]["com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo"];if(null!=a.serviceslotId||a[0].serviceslotId){if(null!=a.serviceslotId){d.gridOptions.data=[],d.gridOptions.data[0]={flag:!0};let e={sequence:a.sequence,serviceSeqId:a.serviceSeqId,serviceslotId:a.serviceslotId,serviceMapId:a.serviceMapId,isSlot:a.status,byFrequencySlot:0==a.status?a.fromUnit:void 0,dummyField2:0==a.status?a.toUnit:void 0,byFixedSlot:1==a.status?a.fromUnit:void 0,dummyField:1==a.status?a.toUnit:void 0,status:a.gnStatus,isfirst:!0,isEdited:!0};d.gridOptions.data.push(e)}else{d.gridOptions.data=[],d.gridOptions.data[0]={flag:!0};for(var r=0;r<a.length;r++){let e={sequence:a[r].sequence,serviceSeqId:a[r].serviceSeqId,serviceslotId:a[r].serviceslotId,serviceMapId:a[r].serviceMapId,isSlot:a[r].status,byFrequencySlot:0==a[r].status?a[r].fromUnit:void 0,dummyField2:0==a[r].status?a[r].toUnit:void 0,byFixedSlot:1==a[r].status?a[r].fromUnit:void 0,dummyField:1==a[r].status?a[r].toUnit:void 0,status:a[r].gnStatus,isfirst:!0,isEdited:!0};d.gridOptions.data.push(e)}}s.success("Success","Successfully Saved"),d.flagUpdate=!0,i.$emit("opw.toggleStatus",{message:!0}),d.slotsList=[];var n={1:d.slotsList},l=e.executeQueryURLReset(),o=new Array;e.prepareParamListWithParam("pFacilityid",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,o),e.prepareParamListWithParam("pMaster_service_id",a[0].serviceMasterSeqId,o),e.prepareParamListWithParam("pServMapId",a[0].serviceMapId,o),e.executeQueryInput("THEATER_GRID_DETAILS",o,n,!0,!0,l,"popUp",{}).then(function(e){d.addTheaterGrid(d.slotsList)})}}else s.failure("Error",t.data.HITService.message.errorMessage)})}else if(1==d.theaterradioCode){t.push({billConfigSeqId:400,configValue:d.servicedt.ipFlwUpseqId2});var n={"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMasterList",configurationBillingMasterList:[{"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster":t}]};o.saveOTPercService(n).then(function(e){if(null!=e.data.HITService.message.configurationBillingMasterList){var t=e.data.HITService.message.configurationBillingMasterList[0]["com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster"];(null!=t.billConfigSeqId||t[0].billConfigSeqId)&&(s.success("Success","Successfully Saved"),d.flagUpdate=!0,i.$emit("opw.toggleStatus",{message:!0}))}else null!=e.data.HITService.message.errorMessage?s.failure("Error",e.data.HITService.message.errorMessage):s.failure("Error","Service is not Saved")})}else if(2==d.theaterradioCode){r={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList",billingHISConfigurationVo:[{"com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo":[{parameter:"IS_OT_SLOT_BASED",value:1==d.theaterradioCode?0:1,type:d.radioCode}]}]};o.saveOTConfServices(r).then(function(e){if(null!=e.data.HITService.message.billingHISConfigurationVo){var t=e.data.HITService.message.billingHISConfigurationVo[0]["com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo"];(null!=t.parameter||t[0].parameter)&&(s.success("Success","Successfully Saved"),d.flagUpdate=!0,i.$emit("opw.toggleStatus",{message:!0}))}else null!=e.data.HITService.message.errorMessage?s.failure("Error",e.data.HITService.message.errorMessage):s.failure("Error","some went wrong")})}}else if(1==d.radioCode){t=[];if(2==d.surgChrgRadio&&0==d.multipleSrugeries){for(a=0;a<d.gradeGridOptions.data.length;a++)t.push({sequence:a+1,gradeCode:d.gradeGridOptions.data[a].gradeCode,gslSeqId:d.gradeGridOptions.data[a].gslSeqId,serviceMapId:d.gradeGridOptions.data[a].serviceMapId,serviceSeqId:d.gradeGridOptions.data[a].serviceSeqId,gradeName:d.gradeGridOptions.data[a].gradeName,gnStatus:d.gradeGridOptions.data[a].status,gradeServiceDesc:d.gradeGridOptions.data[a].gradeServiceDesc,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,practiceId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID_DESC,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID});r={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList",billingHISConfigurationVo:[{"com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo":[{parameter:"IS_SURGEORY_GRADE_DEPENDENT",value:1==d.surgChrgRadio?0:1}]}],billingServiceConfigurationVoList:[{"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo":t}]};o.saveGrademappingService(r).then(function(e){if(null!=e.data.HITService.message.billingServiceConfigurationVoList){var t=e.data.HITService.message.billingServiceConfigurationVoList[0]["com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo"];if(null!=t.serviceMapId||t[0].serviceMapId){if(null!=t.serviceMapId){d.gradeGridOptions.data=[];let e={sequence:t.sequence,serviceSeqId:t.serviceSeqId,gradeName:t.gradeName,gradeServiceDesc:t.gradeServiceDesc,gradeCode:t.gradeCode,gslSeqId:t.gslSeqId,status:t.gnStatus,serviceMapId:t.serviceMapId,isfirst:!0,isEdited:!0};d.gradeGridOptions.data.push(e)}else{d.gradeGridOptions.data=[];for(var a=0;a<t.length;a++){let e={sequence:t[a].sequence,serviceSeqId:t[a].serviceSeqId,gradeName:t[a].gradeName,gradeServiceDesc:t[a].gradeServiceDesc,gradeCode:t[a].gradeCode,gslSeqId:t[a].gslSeqId,status:t[a].gnStatus,serviceMapId:t[a].serviceMapId,isfirst:!0,isEdited:!0};d.gradeGridOptions.data.push(e)}}s.success("Success","Successfully Saved"),d.flagUpdate=!0,i.$emit("opw.toggleStatus",{message:!0})}}else null!=e.data.HITService.message.errorMessage?s.failure("Error",e.data.HITService.message.errorMessage):s.failure("Error","some went wrong")})}else{for(a=1;a<d.reducedRateGrid.data.length;a++)t.push({reducerateConfgId:d.reducedRateGrid.data[a].reducerateConfgId,sequence:d.reducedRateGrid.data[a].sequence,percentageOfRate:d.reducedRateGrid.data[a].percentageOfRate,gnStatus:1==d.reducedRateGrid.data[a].status?1:2,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,practiceId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID_DESC,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION});r={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList",billingHISConfigurationVo:[{"com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo":[{parameter:"IS_SURGEORY_GRADE_DEPENDENT",value:1==d.surgChrgRadio?0:1},{parameter:"IS_Multible_Surgeory_Billing_Apllicatabale",value:1==d.surgChrgRadio?0:1},{parameter:"IS_AutoApply_Surgeory_withHighest_Rate",value:3==d.surgChrgRadio2?0:1}]}],billingServiceConfigurationVoList:[{"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo":t}]};o.saveReducedRateService(r).then(function(e){if(null!=e.data.HITService.message.billingServiceConfigurationVoList){var t=e.data.HITService.message.billingServiceConfigurationVoList[0]?e.data.HITService.message.billingServiceConfigurationVoList[0]["com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVo"]:"";if(null!=t.reducerateConfgId||t[0]&&t[0].reducerateConfgId){if(null!=t.reducerateConfgId)d.reducedRateGrid.data=[],d.reducedRateGrid.data[0]={flag:!0},t.isfirst=!0,t.isEdited=!0,d.reducedRateGrid.data.push(t);else{d.reducedRateGrid.data=[],d.reducedRateGrid.data[0]={flag:!0};for(var a=0;a<t.length;a++){let e={sequence:t[a].sequence,percentageOfRate:t[a].percentageOfRate,reducerateConfgId:t[a].reducerateConfgId,status:t[a].gnStatus,isfirst:!0,isEdited:!0};d.reducedRateGrid.data.push(e)}}s.success("Success","Successfully Saved"),d.flagUpdate=!0,i.$emit("opw.toggleStatus",{message:!0})}else e.data.HITService.message.billingHISConfigurationVo[0]["com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo"].length>0&&(s.success("Success","Successfully Saved"),d.flagUpdate=!0,i.$emit("opw.toggleStatus",{message:!0}))}else null!=e.data.HITService.message.errorMessage?s.failure("Error",e.data.HITService.message.errorMessage):s.failure("Error","some went wrong")})}}else if(3==d.radioCode){r={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList",billingHISConfigurationVo:[{"com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo":[{parameter:"IS_SURGEON_MANUAL_ENTRY",value:1==d.surgeonRadio?0:1,type:d.radioCode}]}]};o.saveOTConfServices(r).then(function(e){if(null!=e.data.HITService.message.billingHISConfigurationVo){var t=e.data.HITService.message.billingHISConfigurationVo[0]["com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo"];(null!=t.parameter||t[0].parameter)&&(s.success("Success","Successfully Saved"),d.flagUpdate=!0,i.$emit("opw.toggleStatus",{message:!0}))}else null!=e.data.HITService.message.errorMessage?s.failure("Error",e.data.HITService.message.errorMessage):s.failure("Error","some went wrong")})}else if(4==d.radioCode){r={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList",billingHISConfigurationVo:[{"com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo":[{parameter:"IS_Anesthetist_MANUAL_ENTRY",value:1==d.anesthetistRadio?0:1,type:d.radioCode}]}]};o.saveOTConfServices(r).then(function(e){if(null!=e.data.HITService.message.billingHISConfigurationVo){var t=e.data.HITService.message.billingHISConfigurationVo[0]["com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo"];(null!=t.parameter||t[0].parameter)&&(s.success("Success","Successfully Saved"),d.flagUpdate=!0,i.$emit("opw.toggleStatus",{message:!0}))}else null!=e.data.HITService.message.errorMessage?s.failure("Error",e.data.HITService.message.errorMessage):s.failure("Error","some went wrong")})}else if(5==d.radioCode){r={"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList",billingHISConfigurationVo:[{"com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo":[{parameter:"IS_Asst_Surgeon_MANUAL_ENTRY",value:1==d.asstsurgeonRadio?0:1,type:d.radioCode}]}]};o.saveOTConfServices(r).then(function(e){if(null!=e.data.HITService.message.billingHISConfigurationVo){var t=e.data.HITService.message.billingHISConfigurationVo[0]["com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo"];(null!=t.parameter||t[0].parameter)&&(s.success("Success","Successfully Saved"),d.flagUpdate=!0,i.$emit("opw.toggleStatus",{message:!0}))}else null!=e.data.HITService.message.errorMessage?s.failure("Error",e.data.HITService.message.errorMessage):s.failure("Error","some went wrong")})}},d.closeOTConfScreen=function(){c.go("index.masters.newBillingConfiguration",{storeObj:r.storeObj,patObj:""})}}e.$inject=["QueryService","theaterslotLevelGridDef","theatreTypeGridDef","$scope","$stateParams","reducedRateGridDef","gradeGridDef","hisAlertService","otConfigurationService","$state"],angular.module("napierContainerUi").controller("otConfigCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S){var v=this;v.patientInput={},i.loadModule("billing");var D=g.getLanguageToSet();function y(e,t){let a={};a.CARD_NUMBER=e.CARD_NUMBER,a.POLICY_NO=e.POLICY_NO,a.COMP_NAME=e.COMP_NAME,a.INC_SEQ_ID=e.INC_SEQ_ID,a.PLAN_NAME=e.PLAN_NAME,a.IN_PLC_SEQ_CD=e.IN_PLC_SEQ_CD,a.PI_FROM_DATE=new Date(e.PI_FROM_DATE),a.PI_TO_DATE=new Date(e.PI_TO_DATE),v.payerArr.push(a),a={}}function f(e){let t={},a={};v.cardNumber=e.CARD_NUMBER,v.policyNumber=e.POLICY_NO,v.payerName=e.COMP_NAME,v.payerseqid=e.INC_SEQ_ID,v.planName=e.PLAN_NAME,v.planseqid=e.IN_PLC_SEQ_CD,v.validFrom=moment(new Date(e.PI_FROM_DATE)).format("DD/MM/YYYY"),v.validTo=moment(new Date(e.PI_TO_DATE)).format("DD/MM/YYYY"),a.payerName=v.payerName,a.incSeqId=v.payerseqid,t.planName=v.planName,t.INC_PLAN_SEQ_ID=v.planseqid,v.savevalidFrom=e.PI_FROM_DATE,v.savevalidTo=e.PI_TO_DATE,v.tariffSeqId=e.TARIFF_CATG_CODE}i.changeLanguage(D),v.visitdisableflag=!1,v.payerArr=[],v.currentPayerData={},v.payerType="2",v.visitType=2,v.editClear=!1,v.alertData={},m.loadAlerts(D).then(function(t){v.alertData=t,e.alertData={buttonText:v.alertData.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}}),v.checkClear=function(){if(1==v.editClear){let e={buttonText:v.alertData.no,buttonText2:v.alertData.yes},a={buttonCallBack1:function(){},buttonCallBack2:function(){v.clear()}},i={buttonClose:function(){}};t.hisAlertMulti("information",v.alertData.alertTypeInfo,"Are you sure want to do it, unsaved data will not get updated",e,a,i)}else v.clear()},v.clear=function(){v.editClear=!1,v.visitdisableflag=!1,v.patientIp=void 0,v.showPatientBanner=!1,v.visitType=2,v.payerType="2",v.currentPayerName=void 0,v.currentPlanName=void 0,v.currentPolicyNo=void 0,v.currentCardNo=void 0,v.currentValidFromDate=void 0,v.currentValidToDate=void 0,v.saveValidFromDate=void 0,v.saveValidToDate=void 0,v.gridOptions.data=[],v.changePayerName=void 0,v.changePlanName=void 0,v.changePolicyNumber=void 0,v.changeCardNumber=void 0,v.viewPayerName=void 0,v.viewPlanName=void 0,v.viewPolicyNumber=void 0,v.viewCardNumber=void 0,v.viewValidFrom=void 0,v.viewValidTo=void 0,v.dischargeDate=void 0,v.tarrifCategory=void 0,v.payerArr=[],v.currentPayerData={}},v.patientSearch=function(e){v.patientBannerArray=[],v.patientBannerArray1=[],e="%"+e+"%",v.patientBannerArray=[],v.multipleComboDataForList={1:v.patientBannerArray};var t=s.executeQueryURLReset();return v.srchPatientArray=new Array,s.prepareParamList(1,e,v.srchPatientArray),s.prepareParamList(2,e,v.srchPatientArray),s.prepareParamList(3,e,v.srchPatientArray),s.prepareParamList(4,e,v.srchPatientArray),s.prepareParamList(5,e,v.srchPatientArray),s.prepareParamList(6,e,v.srchPatientArray),s.executeQueryInput("SEARCH_PAT_BILL_PAYER_CONVERSION",v.srchPatientArray,v.multipleComboDataForList,!0,!0,t,"popUp",!0).then(function(e){return v.patientBannerArray=e[1],v.patientBannerArray1=v.patientBannerArray,v.patientBannerArray1=Array.isArray(v.patientBannerArray1)?v.patientBannerArray1:[v.patientBannerArray1],v.patientBannerArray1.map(function(e){return e})})},v.selectPatient=function(t,a,i,r){v.patientInput=t,null!=v.patientInput.admissionSeqid?v.visitType="1":v.visitType="2",l.getPatientBanner(v.patientInput,v.visitType).then(function(t){var a,i;e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=12,v.currentPayerName=null==e.patientGlobalDtls.insuranceComp||null==e.patientGlobalDtls.insuranceComp||""==e.patientGlobalDtls.insuranceComp?"Self":e.patientGlobalDtls.insuranceComp,v.currentPlanName=null==e.patientGlobalDtls.insurancePlan||null==e.patientGlobalDtls.insurancePlan||""==e.patientGlobalDtls.insurancePlan?"--":e.patientGlobalDtls.insurancePlan,v.tarrifCategory=null==e.patientGlobalDtls.tarrifCategory||null==e.patientGlobalDtls.tarrifCategory?"":e.patientGlobalDtls.tarrifCategory,v.currentValidFromDate=null==e.patientGlobalDtls||null==e.patientGlobalDtls.pEffectivedate||null==e.patientGlobalDtls.pEffectivedate||""===e.patientGlobalDtls.pEffectivedate?"--":"--"===v.currentPlanName?"--":null!=e.patientGlobalDtls.pEffectivedate.$?e.patientGlobalDtls.pEffectivedate.$:e.patientGlobalDtls.pEffectivedate,v.currentValidToDate=null==e.patientGlobalDtls||null==e.patientGlobalDtls.pExpiredate||null==e.patientGlobalDtls.pExpiredate||""===e.patientGlobalDtls.pExpiredate?"--":"--"===v.currentPlanName?"--":null!=e.patientGlobalDtls.pExpiredate.$?e.patientGlobalDtls.pExpiredate.$:e.patientGlobalDtls.pExpiredate,v.payerseqid=e.patientGlobalDtls.insuranceSeqId,v.planseqid=e.patientGlobalDtls.insurancePlanSeqId,v.currentPayerData.changePayerName=v.currentPayerName,v.currentPayerData.changePlanName=v.currentPlanName,v.currentPayerData.changePolicyNumber=v.currentPolicyNo,v.currentPayerData.changeCardNumber=v.currentCardNo,v.currentPayerData.changevalidFrom=null==v.currentValidFromDate||null==v.currentValidFromDate?S("date")(new Date,"yyyy-MM-dd hh:mm:ss.s"):S("date")(v.currentValidFromDate,"yyyy-MM-dd hh:mm:ss.s"),v.currentPayerData.changeValidTo=null==v.currentValidToDate||null==v.currentValidToDate?S("date")(new Date,"yyyy-MM-dd hh:mm:ss.s"):S("date")(v.currentValidToDate,"yyyy-MM-dd hh:mm:ss.s"),v.currentPayerData.changePayerseqid=v.payerseqid,v.currentPayerData.changePlanseqid=v.planseqid,v.currentPayerData.changeTariffSeqId=e.patientGlobalDtls.tariffSeqId,v.currentPayerData.defaultTariff=v.defaultTariff,v.currentPayerData.payerType=v.payerType,v.currentPayerData.regSeqId=v.regSeqId,a=parseInt(v.visitType),i=v.patientInput.ipNo,d.getVisitorIPBasedPayerDetails(a,i).then(function(e){2==a?(v.PatPayerData=e,v.PatPayerData.length>0&&angular.forEach(v.PatPayerData,function(e,t){null!=e.INC_SEQ_ID&&(y(e,v.flow),0==t&&f(e))})):1==a&&(v.PatPayerData=e,v.PatPayerData.length>0&&angular.forEach(v.PatPayerData,function(e,t){null!=e.INC_SEQ_ID&&(y(e,v.flow),0==t&&f(e))}))})}),o.patientBannerDetail(v.patientInput.regSeqId).then(function(t){e.patientBannerDetails=t,v.showPatientBanner=!0,e.patientRecordsDetail=e.patientBannerDetails});var n={1:v.defaultTariff=[],2:v.payerHistoryDetails=[],3:v.patientDischargeDate=[]},c=s.executeQueryURLReset();v.paramsValue=new Array,s.prepareParamListWithParam("pConfigSeqId","132",v.paramsValue),s.executeQueryInput("GET_DEFAULT_TARIFF_CAT_CODE_BILL_CONFIG",v.paramsValue,n,!0,!1,c,"popUp",{}),s.prepareParamListWithParam("pAdmSeqId",v.patientInput.admissionSeqid,v.paramsValue),s.executeQueryInput("GET_CHANGE_PAYER_CONVERSION_DTL_LIST",v.paramsValue,n,!0,!1,c,"popUp",{}),s.executeQueryInput("GET_CHANGE_CATEGORY_DISCHARGE_DATE_DTL",v.paramsValue,n,!0,!0,c,"popUp",{}).then(function(e){v.patientDischargeDate.length>0&&(v.dischargeDate=moment(v.patientDischargeDate[0].DISCHARGE_DATE).format("DD-MM-YYYY hh:mm A")),v.payerHistoryDetails.length>0&&(v.gridOptions.data=[],v.gridOptions.data=v.payerHistoryDetails),v.getInsuranceCardDetails(v)})},v.getInsuranceCardDetails=function(e){var t=s.executeQueryURLReset();e.paramsValue=new Array;var a={1:e.cardPolicyDtls=[]};s.prepareParamListWithParam("pRegSeqId",e.patientInput.regSeqId,e.paramsValue),s.executeQueryInput("GET_PAYER_CARD_POLOCY_DTL_FROM_INSURANCE",e.paramsValue,a,!0,!0,t,"popUp",{}).then(function(t){e.cardPolicyDtls.length>0&&(e.currentPolicyNo=null==e.cardPolicyDtls[0].POLICY_NO||null==e.cardPolicyDtls[0].POLICY_NO||""==e.cardPolicyDtls[0].POLICY_NO?"--":e.cardPolicyDtls[0].POLICY_NO,e.currentCardNo=null==e.cardPolicyDtls[0].CARD_NUMBER||null==e.cardPolicyDtls[0].CARD_NUMBER||""==e.cardPolicyDtls[0].CARD_NUMBER?"--":e.cardPolicyDtls[0].CARD_NUMBER,e.currentPayerData.changePolicyNumber=e.currentPolicyNo,e.currentPayerData.changeCardNumber=e.currentCardNo)})},v.openPayerpopup=function(a){let i=!0;if(v.payerseqid&&v.planseqid&&v.currentPolicyNo){for(let e=0;e<v.payerArr.length;e++)if(v.payerArr[e].INC_SEQ_ID==v.payerseqid&&v.payerArr[e].IN_PLC_SEQ_CD==v.planseqid&&v.payerArr[e].POLICY_NO==v.currentPolicyNo){i=!1;break}1==i&&y(v,5),console.log(v.payerArr)}c.open("Payer Search",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_new_screen/pre_auth_payer_search.html",size:a,controller:"PreAuthorizationPayerModalController",controllerAs:"prePay",resolve:{payer:function(){return v.payerArr},patientdata:function(){return null}}}).result.then(function(a){console.log(a),a&&(a.length>0&&a[0].prePay.planobj.INC_PLAN_SEQ_ID!=e.patientGlobalDtls.insurancePlanSeqId?(v.billPayerSeqId=a[0].prePay.billPayerSeqId,v.changePayerName=a[0].prePay.payer,v.changePlanName=a[0].prePay.plan,v.changePolicyNumber=a[0].prePay.policyno,v.changeCardNumber=a[0].prePay.cardno,v.viewValidFrom=a[0].prePay.viewfromDate,v.viewValidTo=a[0].prePay.viewtoDate,v.changevalidFrom=a[0].prePay.fromDate,v.changeValidTo=a[0].prePay.toDate,v.changePayerseqid=a[0].prePay.payerobj.incSeqId,v.changePlanseqid=a[0].prePay.planobj.INC_PLAN_SEQ_ID,v.changeTariffSeqId=a[0].prePay.tariffId,v.editClear=!0):t.warning("warning","This payer already associated"))},function(){})},v.addPayer=function(e){v.changePayerName="Self",v.changePlanName="--",v.changePolicyNumber="--",v.changeCardNumber="--",v.viewValidFrom="--",v.viewValidTo="--",v.editClear=!0},v.getPayer=function(t,a,i){var r={billPayerSeqId:null==a.billPayerSeqId||null==a.billPayerSeqId?void 0:a.billPayerSeqId,insuranceSeqId:"Self"==a.changePayerName||null==a.changePayerseqid||null==a.changePayerseqid?void 0:a.changePayerseqid,insurancePlanSeqId:"Self"==a.changePayerName||null==a.changePlanseqid||null==a.changePlanseqid?void 0:a.changePlanseqid,tariffCatgCode:2==a.payerType?a.defaultTariff[0].CONFIG_VALUE:a.changeTariffSeqId,policyNumber:"Self"==a.changePayerName||null==a.changePolicyNumber||null==a.changePolicyNumber?void 0:a.changePolicyNumber,cardNumber:"Self"==a.changePayerName||null==a.changeCardNumber||null==a.changeCardNumber?void 0:a.changeCardNumber,planValidFromDate:"Self"==a.changePayerName||null==a.changevalidFrom||null==a.changevalidFrom?void 0:a.changevalidFrom,planValidToDate:"Self"==a.changePayerName||null==a.changeValidTo||null==a.changeValidTo?void 0:a.changeValidTo,enSeqId:null==e.patientGlobalDtls||null==e.patientGlobalDtls||null==e.patientGlobalDtls.encounterSeqId||null==e.patientGlobalDtls.encounterSeqId?void 0:e.patientGlobalDtls.encounterSeqId,payerType:a.payerType,ipAdmSeqId:i.patientInput.admissionSeqid,regSeqId:i.patientInput.regSeqId,patientType:a.visitType,gnStatus:1,insTypeSeqCd:1,piInPriority:1,isNewPayer:a.isNewPayer};return t.push(r),t},v.processPayerList=function(e){var t=new Array;return e.isNewPayer=!0,e.currentPayerData.isNewPayer=!1,t=e.getPayer(t,e,e),t=e.getPayer(t,e.currentPayerData,e)},v.saveBillPayerConversion=function(){var e={};e.url=p.HISIPINDENT.URL,e.requestData={operation:"saveBillPayerConversionHistoryDetails",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.BillPayerConversionVoList",billPayerConversionHistoryVoList:[{"com.napier.core.scm.serviceposting.vo.BillPayerConversionHistoryVo":v.processPayerList(v)}]}},u.sendRestRequest(e).then(function(e){null!=e.data.HITService.message?(t.success("Success","Saved Successfully"),v.clear()):t.information("Information",e.data.HITService.message.errorMessage)})},v.gridOptions={enableHorizontalScrollbar:0,columnDefs:[{field:"payerName",displayName:"billing.payer",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.INC_COMP_NAME}}</div>'},{field:"planName",displayName:"billing.Plan",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.INC_PLAN_NAME}}</div>'},{field:"policyNumber",displayName:"billing.policyNo",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.POLICY_NO}}</div>'},{field:"cardNumber",displayName:"billing.cardNo",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.CARD_NUMBER}}</div>'},{field:"changedBy",displayName:"billing.changedBy",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.CHANGED_BY}}</div>'},{field:"changedOn",displayName:"billing.changedOn",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.CHANGED_ON|date:"dd/MM/yyyy"}}</div>'}]}}e.$inject=["$scope","hisAlertService","hisAlertConstants","hisTranslationsService","hisCalDefConstant","PatientGlobal","PatientBannerGlobal","QueryService","PatientBannerBilling","hisModalService","PreAuthService","IPINDENTAPIS","CallManager","hisGenericAlertService","hisTranslationsGlobalLang","$filter"],angular.module("napierContainerUi").controller("billingConversionCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v){t.openNew=function(){S.open("NEW",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/billingGroupMaster/sections/newBilling.html",size:"md",scope:t})},t.gridOptions={columnDefs:[{field:"Description",displayName:"Description"},{field:"Code",displayName:"Code"},{field:"Status",displayName:"Status"},{field:"Print",displayName:"Print Sequence"}]},t.gridOptions.onRegisterApi=function(e){t.gridApi=e}}e.$inject=["$state","$scope","$filter","QueryService","$uibModalStack","$mdDialog","$timeout","hisCalDefConstant","uiGridConstants","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","RoleTaskService","hisAlertConstants","hisModalService","$uibModal"],angular.module("napierContainerUi").controller("billingGroupMasterCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v){t.openNew=function(){S.open("NEW",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/billingSubGrpMaster/sections/newBillingSub.html",size:"md",scope:t})},t.gridOptions={columnDefs:[{field:"Description",displayName:"Description"},{field:"Code",displayName:"Code"},{field:"Status",displayName:"Status"},{field:"Print",displayName:"Print Sequence"}]},t.gridOptions.onRegisterApi=function(e){t.gridApi=e}}e.$inject=["$state","$scope","$filter","QueryService","$uibModalStack","$mdDialog","$timeout","hisCalDefConstant","uiGridConstants","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","RoleTaskService","hisAlertConstants","hisModalService","$uibModal"],angular.module("napierContainerUi").controller("billingSubGroupMasterCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c){var d=this;d.taskIdPermission=c.rolePermission("T_BL_AGE_WISE_DEBTOR"),d.taskIdPermission_P=d.taskIdPermission.T_BL_AGE_WISE_DEBTOR_P,d.ageWiseBillReportGrid=angular.copy(t),d.ageWiseBillSummaryReportGrid=angular.copy(a),e.bigTotalItems=0,e.ageTotalItems=0;var p=[{code:1,desc:"Itemized"},{code:2,desc:"Summary"}];d.reportTypeData=p,d.reportType=p[0],e.getTableHeight=function(){var e;return d.ageWiseBillReportGrid.data.length>=10?(e=400,e+="px"):0==d.ageWiseBillReportGrid.data.length?e="200px !important":(e=30*d.ageWiseBillReportGrid.data.length+30+70,e+="px"),{height:e}};var u={pageNumber:1,pageSize:8,sort:null};d.ageWiseBillReportGrid.onRegisterApi=function(t){t.pagination.on.paginationChanged(e,function(e,t){u.pageNumber=e,u.pageSize=t})},e.setTableHeight=function(){var e;return d.ageWiseBillSummaryReportGrid.data.length>=10?(e=400,e+="px"):0==d.ageWiseBillSummaryReportGrid.data.length?e="200px !important":(e=30*d.ageWiseBillSummaryReportGrid.data.length+30+70,e+="px"),{height:e}};u={pageNumber:1,pageSize:8,sort:null};d.ageWiseBillSummaryReportGrid.onRegisterApi=function(t){t.pagination.on.paginationChanged(e,function(e,t){u.pageNumber=e,u.pageSize=t})},d.creditCompanyData=[];var m={1:d.creditCompanyData},g=r.executeQueryURLReset(),S=new Array;r.prepareParamListWithParam("practiceId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,S),r.executeQueryInput("INSURER_DROPDOWN",S,m,!0,!0,g,"popUp").then(function(e){}),d.creditCompany=r.getModelByCode(d.creditCompanyData,-999,!1),d.ageingDaysData=[{name:"All",value:""},{name:"0-30 Days",value:"<30"},{name:"31-60 Days",value:"<60"},{name:"61-90 Days",value:"<90"},{name:">90 Days",value:">90"}],d.ageingDays=d.ageingDaysData[0];d.creditCompanyData.unshift({gQDataName:"All",gQDataCode:""}),d.creditCompany=d.creditCompanyData[0],i.getPatientCategory().then(function(e){d.patientCategoryData=e;d.patientCategoryData.unshift({code:"-999",description:"All",pcatgSeqId:"",tariffSeqId:""}),d.patientCategory=d.patientCategoryData[0]},function(e){}),d.fromdate=new Date,d.toDate=new Date,d.fromDateOptions={format:"DD-MM-YYYY"},d.toDateOptions={format:"DD-MM-YYYY"},d.fromDateOptions.maxDate=new Date,d.toDateOptions.maxDate=new Date,d.changeFromDate=function(e){null!=e&&(d.toDateOptions.minDate=new Date(e)),null==d.fromdate?d.fmReqDate=!0:d.fmReqDate=!1},d.changeToDate=function(e){null==d.toDate?d.toReqDate=!0:d.toReqDate=!1},d.reportTypeChange=function(){d.ageWiseBillReportGrid.data=[],d.ageWiseBillSummaryReportGrid.data=[],e.bigTotalItems=0,e.ageTotalItems=0},d.clearSearch=function(){d.fromdate=new Date,d.toDate=new Date,d.fromDateOptions={format:"DD-MM-YYYY"},d.toDateOptions={format:"DD-MM-YYYY"},d.fromDateOptions.maxDate=new Date,d.toDateOptions.maxDate=new Date,d.reportType=p[0],d.ageWiseBilling.showErrors=!1,d.ageWiseBillReportGrid.data=[],d.ageWiseBillSummaryReportGrid.data=[],e.bigTotalItems=0,e.ageTotalItems=0,d.patientCategory=d.patientCategoryData[0],d.ageingDays=d.ageingDaysData[0],d.creditCompany=d.creditCompanyData[0]},d.getSearch=function(t){if(t.ageWiseBilling.$valid){t.ageWiseBilling.showErrors=!1;var a=t.reportType;t.summaryData=[],t.summaryDataList={1:t.summaryData};var i=r.executeQueryURLReset();t.summaryDataDetails=new Array,r.prepareParamListWithParam("pFromDate",moment(new Date(t.fromdate._d)).format("YYYY-MM-DD"),t.summaryDataDetails),r.prepareParamListWithParam("pToDate",moment(new Date(t.todate._d)).format("YYYY-MM-DD"),t.summaryDataDetails),r.prepareParamListWithParam("pCreditComp",t.creditCompany?t.creditCompany.gQDataCode:"",t.summaryDataDetails),r.prepareParamListWithParam("pPatientcategory",t.patientCategory.pcatgSeqId,t.summaryDataDetails),r.prepareParamListWithParam("pAgingNo",t.ageingDays?t.ageingDays.value:"",t.summaryDataDetails),r.prepareParamListWithParam("pPayStatus","",t.summaryDataDetails),r.prepareParamListWithParam("pBill_No","",t.summaryDataDetails);var n="SP_AGING_BILL_RPT_HSC";return n=t.billOrUnbill&&2==t.billOrUnbill?"SP_AGING_UNBILL_RPT_HSC":"SP_AGING_BILL_RPT_HSC",r.executeQueryInput(n,t.summaryDataDetails,t.summaryDataList,!0,!0,i,"popUp",{}).then(function(i){var r=i[1];r?2==a.code?(t.ageWiseBillSummaryReportGrid.data=r,e.bigTotalItems=10*Math.ceil(t.ageWiseBillSummaryReportGrid.data.length/t.ageWiseBillSummaryReportGrid.paginationPageSize)):(angular.forEach(r,function(e,a){var i=e.AGEING_DAYS?parseInt(e.AGEING_DAYS):0;t.billOrUnbill&&2==t.billOrUnbill?(e.zeroTothirty=e.BILL_AMT,e.thirtyOneToSixty=0,e.sixtyoneToNinty=0,e.moreThanNinty=0):i<=30?(e.zeroTothirty=e.TOTAL_DUE,e.thirtyOneToSixty=0,e.sixtyoneToNinty=0,e.moreThanNinty=0):i>30&&i<=60?(e.zeroTothirty=0,e.thirtyOneToSixty=e.TOTAL_DUE,e.sixtyoneToNinty=0,e.moreThanNinty=0):i>60&&i<=90?(e.zeroTothirty=0,e.thirtyOneToSixty=0,e.sixtyoneToNinty=e.TOTAL_DUE,e.moreThanNinty=0):(e.zeroTothirty=0,e.thirtyOneToSixty=0,e.sixtyoneToNinty=0,e.moreThanNinty=e.TOTAL_DUE)}),t.ageWiseBillReportGrid.data=r,e.ageTotalItems=10*Math.ceil(t.ageWiseBillReportGrid.data.length/t.ageWiseBillReportGrid.paginationPageSize)):t.reportTypeChange()})}t.ageWiseBilling.showErrors=!0},d.checkValidity=function(e){d.ageWiseBilling.showErrors=!1},d.generateAgeWisePrint=function(e){if(d.ageWiseBilling.$valid){var t=d.reportType;if(e="pdf"==e?"PDF":"EXCEL","1"==t.code){var a={reportId:"DebtorAgingItemizedReport",printType:e,pFromDate:moment(new Date(d.fromdate._d)).format("YYYY-MM-DD"),pToDate:moment(new Date(d.todate._d)).format("YYYY-MM-DD"),pCompanyName:d.creditCompany?d.creditCompany.gQDataName:"",pCompanySeqId:d.creditCompany?d.creditCompany.gQDataCode:"",pBillType:d.billOrUnbill?d.billOrUnbill:1,pAgingNo:d.ageingDays?d.ageingDays.value:"",pPatientcategory:d.patientCategory.pcatgSeqId,reportType:t.code};if("PDF"==e)n.printReportModal("ageWiseBillPrintCtrl","lg",e,a);else{var i=a.reportId,r={pFromDate:a.pFromDate,pToDate:a.pToDate,pCreditComp:a.pCompanySeqId,pBillType:a.pBillType,pCompanyName:a.pCompanyName,pPatientcategory:a.pPatientcategory};s.generateExcel(i,r).then(function(e){try{var t="napier-his-web/NapierReportServlet?reportName="+(e.data.HITService.message.reportName+""),a=location.host;o.open("http://"+a+"/"+t)}catch(e){}})}}else{a={reportId:"DebtorAgingSummarizedReport",printType:e,pFromDate:moment(new Date(d.fromdate._d)).format("YYYY-MM-DD"),pToDate:moment(new Date(d.todate._d)).format("YYYY-MM-DD"),pCompanySeqId:d.creditCompany?d.creditCompany.gQDataCode:"",pCompanyName:d.creditCompany?d.creditCompany.gQDataName:"",pPatientcategory:d.patientCategory.pcatgSeqId,pBillType:d.billOrUnbill?d.billOrUnbill:1,pAgingNo:d.ageingDays?d.ageingDays.value:"",reportType:t.code};if("PDF"==e)n.printReportModal("ageWiseBillPrintCtrl","lg",e,a);else{i=a.reportId,r={pFromDate:a.pFromDate,pToDate:a.pToDate,pCreditComp:a.pCompanySeqId,pBillType:a.pBillType,pCompanyName:a.pCompanyName,pPatientcategory:a.pPatientcategory};s.generateExcel(i,r).then(function(e){try{var t="napier-his-web/NapierReportServlet?reportName="+(e.data.HITService.message.reportName+""),a=location.host;o.open("http://"+a+"/"+t)}catch(e){}})}}}else d.ageWiseBilling.showErrors=!0}}function t(e,t,a,i,r,n,l,s,o,c){l.cancel=function(){t.dismiss("cancel")},l.pageName="Age Wise Bill Print",l.printParameterListForBill=new Array,a.prepareParamList("pFromDate",e.pFromDate,l.printParameterListForBill),a.prepareParamList("pToDate",e.pToDate,l.printParameterListForBill),a.prepareParamList("pCreditComp",e.pCompanySeqId,l.printParameterListForBill),a.prepareParamList("pBillType",e.pBillType,l.printParameterListForBill),a.prepareParamList("pCompanyName",e.pCompanyName,l.printParameterListForBill),a.prepareParamList("pPatientcategory",e.pPatientcategory,l.printParameterListForBill),a.prepareParamList("pAgingNo",e.pAgingNo,l.printParameterListForBill),l.printObject={},l.printObject.reportId=e.reportId,l.printObject.destination="reportingServiceImpl",l.printObject.reportType={id:"PDF"==e.printType?4:1,desc:e.printType},l.printObject.paramsList=l.printParameterListForBill,i.printReportFunction(l.printObject,l)}e.$inject=["$scope","ageWiseBillReport","ageWiseBillSummaryReport","dropdownServicePermanent","QueryService","PrintService","CallManager","ExcelService","$window","RoleTaskService"],t.$inject=["returnObj","$uibModalInstance","QueryService","PrintServiceCustome","$sce","$rootScope","$scope","$uibModalStack","hisAlertService","PrintService"],angular.module("napierContainerUi").controller("ageWiseBilledController",e).controller("ageWiseBillPrintCtrl",t)}(),function(){"use strict";function e(e){return{restrict:"A",link:function(t,a,i){e(i.fileModel).assign;a.bind("change",function(){t.$emit("myFile",a[0].files[0])})}}}function t(e,t,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C,I,A,E){var h=this;n.loadModule("billing");var b=y.getLanguageToSet();n.changeLanguage(b),h.alertData={},f.loadAlerts(b).then(function(t){h.alertData=t,e.alertData={buttonText:h.alertData.ok},e.alertFunction={buttonCallBack1:function(){}},e.closefun={buttonClose:function(){}}}),e.roleTask=I.rolePermission("T_BL_BILLING"),e.CD=angular.copy(o),e.fromDateOptions={format:e.CD.dateOnly.format},e.toDateOptions={format:e.CD.dateOnly.format,maxDate:moment().add(1,"d")},e.billWorkSrch={},e.billWorkSrch.frmDate=new Date,e.billWorkSrch.toDate=new Date,e.changeToDate=function(t){e.toDateOptions.minDate=t},e.changeFromDate=function(t){e.fromDateOptions.maxDate=t},e.patientSearch=function(e){return u.paitentAutoSearchWithOutStatus(e)},e.raiseConcessionRequest=function(){null!=e.selectBill[0].billSeqId&&e.checkQueryService(e.selectBill[0].billSeqId,!1).then(function(t){if(0==parseInt(t[0][1][0].CNT)&&0==parseInt(t[0][2][0].CNT))v.checkConcessionStatus(e.selectBill[0].billSeqId).then(function(t){h.concessionModal=g.open("Request for Concession",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/billingWorkList/sections/concession.form.html",size:"lg",controller:a,keyboard:!1,windowClass:"billing-common-styles-main-v2",backdrop:"static",controllerAs:"bWC",resolve:{getbilldata:function(){return e.selectBill[0]}}}),h.concessionModal.result.then(function(t){t&&(e.billView=!1,e.billConcss=!1,e.billCnclD=!1,e.billWrite=!1,e.billSplit=!1,e.billPayment=!1,e.billDischClearn=!1,e.billDischClrnCncl=!1,e.billDischClrnCnclP=!1,e.billClaim=!1,e.searchResult(e.billWorkSrch,!0))})},function(e){m.warning("Warning",e)});else{var i=h.alertData.invStldPtlyStldSelBil;m.hisAlertMulti("information",h.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.closefun)}})},e.billWorkGridOptions=angular.copy(c),d.getColumnDefAll(e.billWorkGridOptions,r),e.billWorkGridOptions.onRegisterApi=function(t){e.gridApi=t,e.gridApi.grid.registerDataChangeCallback(function(){e.gridApi.treeBase.expandAllRows()}),t.selection.on.rowSelectionChanged(e,function(t){var a=e.gridApi.selection.getSelectedRows().length;if(e.selectBill=e.gridApi.selection.getSelectedRows(),a>0)if("Cancelled"==e.selectBill[0].billStatusDesc||1==e.selectBill[0].billPayStatus||"Generated"==e.selectBill[0].invoiceStatus||1==e.selectBill[0].consStatus||1==e.selectBill[0].splitStaus)e.billInovice=!1;else for(var i=0;i<e.selectBill.length;i++){if(null!=e.selectBill[i].billPayerDtList&&null!=e.selectBill[i].billPayerDtList[0]&&null!=e.selectBill[i].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"]){n=(n=e.selectBill[i].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"])instanceof Array?n:[n];for(var r=0;r<n.length;r++){if(4==n[r].payerType){e.billInovice=!1;break}if(r+1!=void 0&&n[r].payerSeqId!=n[r].payerSeqId){e.billInovice=!1;break}e.billInovice=!0}}if(!e.billInovice)break}else e.billInovice=!1;if(1==a){for(i=0;i<e.selectBill.length;i++){if(null!=e.selectBill[i].billPayerDtList&&null!=e.selectBill[i].billPayerDtList[0]&&null!=e.selectBill[i].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"]){var n;n=(n=e.selectBill[i].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"])instanceof Array?n:[n];for(r=0;r<n.length;r++)4==n[r].payerType&&1==n[r].paymentStatus?e.billConcss=!0:e.billConcss=!1;for(r=0;r<n.length;r++)if(4==n[r].payerType)e.billClaim=!1;else{if(4!=n[r].payerType){e.billClaim=!0;break}e.billClaim=!1}}if(!e.billClaim)break}e.billConcss||"Bill Generated"!=e.selectBill[0].billStatusDesc&&"Concession Pending"!=e.selectBill[0].billStatusDesc||1==e.selectBill[0].consStatus||1==e.selectBill[0].splitStaus||1==e.selectBill[0].billPayStatus||null==e.selectBill[0].ipAdmSeqId?e.billConcss=!1:e.billConcss=!0,null==e.selectBill[0].billStatusDesc||"Cancelled"==e.selectBill[0].billStatusDesc||1==e.selectBill[0].consStatus||1==e.selectBill[0].splitStaus||e.selectBill[0].billNo.includes("OPBL")?e.billCnclD=!1:e.billCnclD=!0,"UnPaid"==e.selectBill[0].billPayStatusDesc&&"Bill Generated"==e.selectBill[0].billStatusDesc&&2!=e.selectBill[0].splitStaus&&1!=e.selectBill[0].splitStaus?e.billSplit=!0:e.billSplit=!1,1!=e.selectBill[0].billPayStatus&&null!=e.selectBill[0].billStatusDesc&&"Cancelled"!=e.selectBill[0].billStatusDesc&&1!=e.selectBill[0].consStatus&&1!=e.selectBill[0].splitStaus?e.billWrite=!0:e.billWrite=!1,null==e.selectBill[0].billSplitNo&&1!=e.selectBill[0].billPayStatus&&"Cancelled"!=e.selectBill[0].billStatusDesc&&1!=e.selectBill[0].consStatus&&1!=e.selectBill[0].splitStaus?e.billSplit=!0:e.billSplit=!1,null!=e.selectBill[0].billStatusDesc&&"Cancelled"!=e.selectBill[0].billStatusDesc&&1!=e.selectBill[0].consStatus&&1!=e.selectBill[0].splitStaus&&1!=e.selectBill[0].billPayStatus?e.billPayment=!0:e.billPayment=!1,e.billView=!0,null!=e.selectBill[0].billStatusDesc&&"Cancelled"!=e.selectBill[0].billStatusDesc?4==e.selectBill[0].admissionStatus?(e.billDischClearn=!0,e.billDischClrnCncl=!1,e.billDischClrnCnclP=!1):5==e.selectBill[0].admissionStatus?(e.billDischClearn=!1,e.billDischClrnCncl=!0,e.billDischClrnCnclP=!0):2==e.selectBill[0].admissionStatus&&(e.billDischClearn=!1,e.billDischClrnCncl=!1,e.billDischClrnCnclP=!0):(e.billDischClearn=!1,e.billDischClrnCncl=!1,e.billDischClrnCnclP=!1)}else e.billView=!1,e.billConcss=!1,e.billCnclD=!1,e.billWrite=!1,e.billSplit=!1,e.billPayment=!1,e.billDischClearn=!1,e.billDischClrnCncl=!1,e.billDischClrnCnclP=!1,e.billClaim=!1})},e.checkQueryService=function(t,a){e.cancelChk=[],e.concsChk=[],e.writeOffChk=[],h.multipleChkDataForList={1:e.cancelChk,2:e.concsChk,3:e.writeOffChk};var r=i.executeQueryURLReset();return h.chkParamList=new Array,i.prepareParamListWithParam("pBillSeqId",t,h.chkParamList),i.executeQueryInput("BL_CANCEL_CHK",h.chkParamList,h.multipleChkDataForList,!0,!1,r,"popUp",e.billWorkGridOptions),a?a?(i.executeQueryInput("BL_CONCS_DUP_CHK1",h.chkParamList,h.multipleChkDataForList,!0,!1,r,"popUp",e.billWorkGridOptions),i.executeQueryInput("WRITEOFF_CHK",h.chkParamList,h.multipleChkDataForList,!0,!0,r,"popUp",e.billWorkGridOptions).then(function(e){return(e instanceof Array?e:[e]).map(function(e){return e})})):void 0:i.executeQueryInput("BL_CONCS_DUP_CHK1",h.chkParamList,h.multipleChkDataForList,!0,!0,r,"popUp",e.billWorkGridOptions).then(function(e){return(e instanceof Array?e:[e]).map(function(e){return e})})},e.payerSearch=function(t){var a="%"+t+"%";e.payerName=[],h.multipleComboDataForList={1:e.payerName};var r=i.executeQueryURLReset();return h.payerNameList=new Array,i.prepareParamListWithParam("pCompCode",a,h.payerNameList),i.prepareParamListWithParam("pCompCode",a,h.payerNameList),i.prepareParamListWithParam("pCompName",a,h.payerNameList),i.prepareParamListWithParam("pCompName",a,h.payerNameList),i.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,h.payerNameList),i.executeQueryInput("GET_COPMANY_ACC_BILL_DTLS",h.payerNameList,h.multipleComboDataForList,!0,!0,r,"popUp",e.billWorkGridOptions).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})},e.billNoSrch=function(t){var a="%"+t+"%";e.billData=[],h.multipleBillDataForList={1:e.billData};var r=i.executeQueryURLReset();return h.billDataList=new Array,i.prepareParamListWithParam("pBillNo",a,h.billDataList),i.prepareParamListWithParam("pBillNo",a,h.billDataList),i.executeQueryInput("GET_BILL_NO",h.billDataList,h.multipleBillDataForList,!0,!0,r,"popUp",e.billWorkGridOptions).then(function(t){return e.billData.map(function(e){return e})})},e.searchResult=function(t,a){if(null!=t.payer&&null!=t.payer&&null==t.payer.INS_SEQ_ID)if(1==e.payerName.length)t.payer=e.payerName[0];else for(var i=0;i<e.payerName.length;i++)if(t.payer==e.payerName[i].INS_COMP_NAME){t.payer=e.payerName[i];break}e.billWorkGridOptions.data=[];var r=!1;if(null!=t.payer&&null!=t.payer&&(r=null==t.payer.INS_SEQ_ID),r){var n=h.alertData.noRcrdFound;1==a&&m.hisAlertMulti("information",h.alertData.alertTypeInfo,n,e.alertData,e.alertFunction,e.closefun,2e3)}else p.getBillWorkList(t).then(function(t){if(null==t.data.HITService.message||null==t.data.HITService.message[0]||""==t.data.HITService.message[0]||null==t.data.HITService.message[0]){var i=h.alertData.noRcrdFound;1==a&&m.hisAlertMulti("information",h.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.closefun,2e3)}else{var r=t.data.HITService.message[0]["com.napier.core.billgeneration.vo.Bill"];p.getBillDataInGrid(r,e.billWorkGridOptions),e.billWorkGridOptions.isRowSelectable=function(e){return null!=e.entity.billNo}}})},e.splitBill=function(){e.checkQueryService(e.selectBill[0].billSeqId,!0).then(function(t){if(0==parseInt(t[0][1][0].CNT)&&0==parseInt(t[0][2][0].CNT)&&0==parseInt(t[0][3][0].CNT))"Concession Pending"==e.selectBill[0].billStatusDesc||"PARTIALLY PAID"==e.selectBill[0].billStatusDesc?m.warning("Warning","Concession already provided for the selected bill. Can't split the Bill"):l.go("splitBill",{selectBill:JSON.stringify(e.selectBill)});else{var a=h.alertData.invStldPtlyStldSelBilSplit;m.hisAlertMulti("information",h.alertData.alertTypeInfo,a,e.alertData,e.alertFunction,e.closefun)}})},e.paymentGen=function(){"Concession Pending"!=e.selectBill[0].billStatusDesc&&"Paid"!=e.selectBill[0].billStatusDesc&&l.go("index.billingSub.payment",{billObj:JSON.stringify(e.selectBill)})},e.generateInvoice=function(){for(var t=[],a={1:t},r=i.executeQueryURLReset(),n=new Array,l=e.selectBill[0].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"],s=0;s<l.length;s++)i.prepareParamListWithParam("pCompSeqId",l[s].payerSeqId,n);i.prepareParamListWithParam("pBillSeqId",e.selectBill[0].billSeqId,n),i.executeQueryInput("BL_INVOICE_DUP_CHK",n,a,!0,!0,r,"popUp",e.billWorkGridOptions).then(function(a){if(0==t[0].CNT)E.getPayerAccountBillAndClaim(e.selectBill[0].subAccSeqId).then(function(t){D.saveGenerateInvoice(e.selectBill,t).then(function(t){var a={buttonText:h.alertData.ok},i={buttonCallBack1:function(){e.searchResult(e.billWorkSrch,!1),e.billCnclD=!1,e.billConcss=!1,e.billWrite=!1,e.billAuth=!1,e.billRefund=!1,e.billInovice=!1,e.billPayment=!1,e.billSplit=!1}},r={buttonClose:function(){e.searchResult(e.billWorkSrch,!1),e.billCnclD=!1,e.billConcss=!1,e.billWrite=!1,e.billAuth=!1,e.billRefund=!1,e.billInovice=!1,e.billPayment=!1,e.billSplit=!1}},n=h.alertData.sucsflyGenInvNo;n+=t.data.HITService.message.invoiceNo,m.hisAlertMulti("success",h.alertData.alertTypeSucss,n,a,i,r)})});else{var i="<b>"+t[0].BILL_NO+"</b> "+h.alertData.hasAlrGenTheInvPlzUnBil;m.hisAlertMulti("success",h.alertData.alertTypeSucss,i,e.alertData,e.alertFunction,e.closefun)}})},e.viewCancelBill=function(t){if(2==e.selectBill[0].invoiceReturnAmt&&t){var a=h.alertData.inviceGenBillPlzCnlInvBill;return m.hisAlertMulti("information",h.alertData.alertTypeInfo,a,e.alertData,e.alertFunction,e.closefun),!1}e.checkQueryService(e.selectBill[0].billSeqId,!1).then(function(a){if(!t||0==parseInt(a[0][1][0].CNT)&&0==parseInt(a[0][2][0].CNT)){e.serviceData=[],e.singleComboDataForList={1:e.serviceData};var r=i.executeQueryURLReset();e.serviceDataList=new Array;let a=e.selectBill[0].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"],n="";if(null!=a)if(a instanceof Array){for(let e=0;e<a.length;e++)if(4!=a[e].payerType){n="Y";break}}else 4!=a.payerType&&(n="Y");i.prepareParamListWithParam("pBillSeqId",e.selectBill[0].billSeqId,e.serviceDataList),i.prepareParamListWithParam("pFlag",n,e.serviceDataList),i.executeQueryInput("BL_BILL_SERVICE_DTLS",e.serviceDataList,e.singleComboDataForList,!0,!0,r,"popUp",e.billWorkGridOptions).then(function(a){if(null!=a[1]&&null!=a[1]&&""!=a[1]&&a[1]instanceof Array){var i="";i=t?h.alertData.headerServiceCncl:h.alertData.headerViewBill;var r={flagComp:n,flag:t};g.open(i,{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/billingWorkList/cancel/cancel.screen.html",size:"lg",controller:"cancelController",keyboard:!1,backdrop:"static",resolve:{billSelectedData:function(){return e.selectBill},flag:function(){return r},serviceData:function(){return a[1]}}}).result.then(function(t){t&&(e.searchResult(e.billWorkSrch,!1),e.billCnclD=!1,e.billConcss=!1,e.billWrite=!1,e.billAuth=!1,e.billRefund=!1,e.billInovice=!1,e.billPayment=!1,e.billSplit=!1)})}else{var l=h.alertData.NoDataAvlble;m.hisAlertMulti("information",h.alertData.alertTypeInfo,l,e.alertData,e.alertFunction,e.closefun)}})}else{var n=h.alertData.invStldPtlyStldSelBilCncl;m.hisAlertMulti("information",h.alertData.alertTypeInfo,n,e.alertData,e.alertFunction,e.closefun)}})},e.clear=function(t){t.toDate=null,t.frmDate=null,t.toDate=moment().add(0,"d"),t.frmDate=moment().add(0,"d").add(-10,"m"),t.patientInput=void 0,t.patientName=void 0,t.payer=void 0,t.billNo=void 0,t.billStatus="0",t.paymentStatus="0",t.invoiceStatus="0",t.billCategory="0",e.billWorkGridOptions.data=[]},e.parseDate=function(e){return t("date")(e,"dd/MM/yyyy hh:mm a")},e.showBillPrintOptions=function(t){e.billNoData=t;e.BillData=[],e.BillDataList={1:e.BillData};var a=i.executeQueryURLReset();e.billDetailsValues=new Array,i.prepareParamListWithParam("pMasterSqId","700411",e.billDetailsValues),i.executeQueryInput("TRN003",e.billDetailsValues,e.BillDataList,!0,!0,a,"popUp",{}).then(function(t){var a=t[1];a&&(e.BillTypeData=a,e.billType=e.BillTypeData[0])}),e.patCatData=[],e.patCatDataList={1:e.patCatData};a=i.executeQueryURLReset();e.patCatDetailsValues=new Array,i.prepareParamListWithParam("pBillNo",t,e.patCatDetailsValues),i.executeQueryInput("BILL_PRINT_FOR_PAT_CATEGORY",e.patCatDetailsValues,e.patCatDataList,!0,!0,a,"popUp",{}).then(function(t){var a=t[1];a&&(e.patCatCode=a[0].CODE,e.patCatPayer=a[0].PAYER_NAME)});e.PrintTypeData=[{code:1,desc:"PDF"}],e.printType=e.PrintTypeData[0],g.open("Bill Print",{animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",windowClass:"bill-print-model-popups",templateUrl:"app/consumer/his17_1/opVisitManagement/screens/opVisitManagement/templates/op-visit-mgt-bill-print.html",size:"sm",scope:e})},e.printBill=function(){if("HSC"==sessionStorage.productCustomization)e.showBillPrintOptions(e.selectBill[0].billNo);else{var t=e.selectBill[0].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"];let r="N";if(t instanceof Array){for(let e=0;e<t.length;e++)if(4!=t[e].payerType){r="Y";break}}else 4!=t.payerType&&(r="Y");var a={billSeqId:e.selectBill[0].billSeqId,pFlagComp:r,splitStaus:e.selectBill[0].splitStaus,BillPayerSeqId:t instanceof Array?t[t.length-1].billPayerSeqId:t.billPayerSeqId,splitBillReportId:"BILL_SPLIT_REPORT"};if(2==e.selectBill[0].billType||3==e.selectBill[0].billType?3==e.selectBill[0].billType?a.reportId="OutPatientConsultationBillReport":"N"==r?a.reportId="OutPatient_CashBillGeneratedReports_ReportId":"Y"==r&&(a.reportId="OutPatient_CreditBillGeneratedReports_ReportId"):1==e.selectBill[0].billType&&("N"==r?a.reportId="BillingInPatientFinalBillReceiptReport":"Y"==r&&(a.reportId="BillingInPatientFinalCrBillReceiptReport")),e.selectBill[0].taxInvoiceNo&&7!=e.selectBill[0].billStatus.code)var i=!0;else i=!1;S.printReportModal("PrintTypeSelection","sm",i).then(function(e){"2"==e.taxType&&(a.reportId="TAX_INVOICE_GST_REPORT_ID"),S.printReportModal("printBillWorkList","lg",e.printType?e.printType:e,a,e.taxType)})}},e.generateBillPrintReportType=function(t,a){var i=C.getPrintData(e.patCatCode,e.billNoData,a,t,e.patCatPayer);e.generateBillPrintReport(i)},e.generateBillPrintReport=function(e){S.printReportModal("printBillCtrl","lg","PDF",e)},e.claimFormPrint=function(){var t={regSeqId:e.selectBill[0].regSeqId,encSeqId:e.selectBill[0].enSeqId,reportId:"CLAIM_FORM_TEMPLATE"};S.printReportModal("printBillWorkList","lg","PDF",t)},e.dischargeClarnce=function(t){var a={buttonText:h.alertData.yes,buttonText2:h.alertData.no},r={buttonCallBack1:function(){e.disClnStatus=[],e.dataObj={1:e.disClnStatus};var a=i.executeQueryURLReset();e.disClnStatusList=new Array,i.prepareParamListWithParam("pAdmSeqId",e.selectBill[0].ipAdmSeqId,e.disClnStatusList),i.prepareParamListWithParam("pUserSeqId",angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,e.disClnStatusList),i.prepareParamListWithParam("pStatus",t?5:4,e.disClnStatusList),i.executeQueryInput("UPDATE_ADMISSION_STAUTS_FOR_DISCHARGE_CLEARANCE",e.disClnStatusList,e.dataObj,!0,!0,a,"popUp",{}).then(function(a){if(null!=e.disClnStatus[0]&&e.disClnStatus[0].CNT)if(e.searchResult(e.billWorkSrch,!1),t){var i={buttonText:h.alertData.yes,buttonText2:h.alertData.no},r={buttonCallBack1:function(){S.printDischargeSlip(e.selectBill[0].ipAdmSeqId)},buttonCallBack2:function(){}};m.hisAlertMulti("information",h.alertData.alertTypeConf,"Discharge Clearance Successful! Do you want to print Discharge Slip?",i,r,{buttonClose:function(){}}),e.billDischClearn=!1,e.billDischClrnCncl=!1,e.billDischClrnCnclP=!1}else m.success("Success","Discharge Clearance Cancelled Successful!",!1,!1,A.time),e.billDischClearn=!1,e.billDischClrnCncl=!1,e.billDischClrnCnclP=!1})},buttonCallBack2:function(){}},n=t?"Are you sure you want to provide discharge clearance for the selected patient?":"Are you sure you want to cancel discharge clearance for the selected patient?";m.hisAlertMulti("information",h.alertData.alertTypeConf,n,a,r,{buttonClose:function(){}})},e.printDischargeClarncSlip=function(){var t={buttonText:h.alertData.yes,buttonText2:h.alertData.no},a={buttonCallBack1:function(){S.printDischargeSlip(e.selectBill[0].ipAdmSeqId)},buttonCallBack2:function(){}};m.hisAlertMulti("information",h.alertData.alertTypeConf,"Do you want to print Discharge Slip?",t,a,{buttonClose:function(){}})},e.searchResult(e.billWorkSrch)}function a(e,t,a,i,r,n,l,s,o,c,d,p,u,m){var g=this;d.loadModule("billing");var S=p.getLanguageToSet();d.changeLanguage(S),g.alertData={},u.loadAlerts(S).then(function(e){g.alertData=e}),g.userObj=JSON.parse(sessionStorage.userContextObj),g.concession={},g.concession.bill=1,g.billtype=!0,g.billWiseGridOptions=angular.copy(s),g.serviceWiseGridOptions=angular.copy(a);var v=5*Math.pow(1024,2);g.filesUploaded=[],g.uploadedfileNames=[],g.uploadingFile=!1,g.concessionRequestCombo=function(){r.concessionReqCombo().then(function(e){g.conReqCombo=e},function(e){})},g.concessionRequestCombo();var D,y=o.regSeqId;m.getPatientBanner(o,2).then(function(e){g.patientBannerGlobalData=e}),c.patientBannerDetail(y).then(function(e){g.patientDetails=e}),D=null==o.ipAdmSeqId?2:1,m.getPatientBanner(o,D).then(function(e){t.patientGlobalDtls=e}),c.patientBannerDetail(y).then(function(e){t.patientBannerDetails=e,t.patientRecordsDetail=t.patientBannerDetails.patientRecordsDetail,t.patientValue=t.patientBannerDetails.patientValue}),g.fileUploadCheck=function(e){if(g.uploadedfileNames.length>0&&g.uploadedfileNames.indexOf(e.name)>-1){g.removeDuplicate=function(){var t=g.uploadedfileNames.indexOf(e.name);v+=g.filesUploaded[t].filesize,g.filesUploaded.splice(t,1),g.uploadedfileNames.splice(t,1),g.fileUpload(e)},g.closeConfimation=function(){angular.element("input[type='file']").val(null)};var t={buttonText:g.alertData.yes,buttonText2:g.alertData.no},a={buttonCallBack1:g.removeDuplicate,buttonCallBack2:g.closeConfimation};i.confirmation(g.alertData.alertTypeInfo,g.alertData.alrSmeFileExistRepl,t,a)}else g.fileUpload(e)},g.fileUpload=function(e){if(null==e.name)return!1;var a=e.name;if(!/(\.pdf|\.xls|\.xlsx|\.jpg|\.jpeg|\.png)$/i.exec(a)){var n=g.alertData.incrtFileFrmt+"<br> "+g.alertData.vildFormat;return i.warning(g.alertData.alertTypeWarn,n),angular.element("input[type='file']").val(null),!1}if(e.size>v)return i.warning(g.alertData.alertTypeWarn,g.alertData.totalLimtExd),angular.element("input[type='file']").val(null),!1;var l=new FileReader;l.onload=function(a){var i=a.target.result,n=function(e,t){if(0==e)return"0 Bytes";var a=t||2,i=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,i)).toFixed(a))+" "+["Bytes","KB","MB"][i]}(e.size),l={billSeqId:o.billSeqId,fName:e.name,fsize:n,requestDocument:i};return g.uploadingFile=!0,r.FileUploadSave(l).then(function(a){var i={filesize:e.size,Size:n,Name:e.name,tName:g.trimFileName(e.name),id:a};g.filesUploaded.push(i),g.uploadedfileNames.push(e.name),angular.element("input[type='file']").val(null),g.uploadingFile=!1,t.$$phase||t.$digest()},function(e){angular.element("input[type='file']").val(null),g.uploadingFile=!1}),!0},l.readAsDataURL(e)},t.$on("myFile",function(e,t){g.fileUploadCheck(t)}),g.removeUploadedFile=function(e){for(var t=0;t<g.filesUploaded.length;t++)if(g.filesUploaded[t].id==e){v+=g.filesUploaded[t].filesize,g.filesUploaded.splice(t,1),g.uploadedfileNames.splice(t,1);break}},g.applicableChange=function(e){g.billWiseGridOptions.data=[],g.serviceWiseGridOptions.data=[],2==e?(g.billtype=!1,g.concession.reasonForConcession="",g.concession.remarks=""):(g.billtype=!0,g.concession.reasonForConcession="",g.concession.remarks=""),g.concession.concessiontype="",g.concessionTypeobj="",g.concession.cType=e,r.concessionTypeCombo(e).then(function(e){g.concessionTypeobj=angular.copy(e)})},g.applicableChange(1),g.concessionTypeChange=function(e){g.billWiseGridOptions.data=[],g.serviceWiseGridOptions.data=[];var t={concessionType:g.concession.cType,concessionSeqid:e.CODE,billSeqId:o.billSeqId};r.getServiceDetails(t).then(function(e){1==g.concession.cType?g.billWiseGridOptions.data=angular.copy(e):g.serviceWiseGridOptions.data=angular.copy(e)},function(e){var t=[];t.push({billNo:"No Records...",serviceCode:"No Records..."}),1==g.concession.cType?g.billWiseGridOptions.data=angular.copy(t):g.serviceWiseGridOptions.data=angular.copy(t)})},g.trimFileName=function(e){if(null!=e){var t=e.split("."),a=t[t.length-1];if(t[0].length>8)var i=t[0].slice(0,5)+"..."+a;else i=e;return i}},g.saveConcession=function(){var e=angular.copy(g.concession);if(!g.savesubmit)if(g.savesubmit=!0,1==g.concession.cType){if(null==(a=angular.copy(g.billWiseGridOptions.data))[0].concessionRequest||""==a[0].concessionRequest)return!1,i.warning(g.alertData.alertTypeWarn,g.alertData.plzEntrTheConsAmtPer),g.savesubmit=!1,!1;r.saveBillWiseConcession(e,a).then(function(e){g.savesubmit=!1;var t=e.data.HITService.message.concessionReqNo;if(null!=t){g.saveConcessionUploadedFiles(e.data.HITService.message);var a=g.alertData.reqForConsRisdId;a+=t,i.success(g.alertData.alertTypeSucss,a)}n.close(e)},function(e){i.failure(g.alertData.dataNotSvd),g.savesubmit=!1})}else{for(var t=0,a=angular.copy(g.serviceWiseGridOptions.data),l=0;l<a.length;l++){if(1==a[l].editmode&&(null==a[l].concessionRequest||""==a[l].concessionRequest))return!1,i.warning(g.alertData.alertTypeWarn,g.alertData.plzEntrTheConsAmtPer),g.savesubmit=!1,!1;if(1==a[l].editmode&&"Not Applicable"==a[l].concessionApplicability)return!1,i.warning(g.alertData.alertTypeWarn,"Concession not applicable!"),g.savesubmit=!1,!1}for(l=0;l<a.length;l++)1==a[l].editmode&&(t+=1);if(t<1)return!1,i.warning(g.alertData.alertTypeWarn,"No Rows Selected!"),g.savesubmit=!1,!1;r.saveServiceWiseConcession(e,a).then(function(e){g.savesubmit=!1;var t=e.data.HITService.message.concessionReqNo;if(null!=t){g.saveConcessionUploadedFiles(e.data.HITService.message);var a=g.alertData.reqForConsRisdId;a+=t,i.success(g.alertData.alertTypeSucss,a)}n.close(e)},function(e){i.failure(g.alertData.dataNotSvd),g.savesubmit=!1})}},g.concessionCompare=function(e,t){if(1==e.amountType&&null!=e.concessionRequest&&""!=e.concessionRequest&&parseFloat(e.concessionRequest)>0){if("bill"==t){if(parseFloat(e.concessionRequest)>parseFloat(e.billLimitPercent))return e.concessionRequest=e.billLimitPercent,!1}else if("service"==t&&parseFloat(e.concessionRequest)>parseFloat(e.serviceLimitPercent))return e.concessionRequest=e.serviceLimitPercent,!1}else if(2==e.amountType&&null!=e.concessionRequest&&""!=e.concessionRequest&&parseFloat(e.concessionRequest)>0){if("bill"==t)return parseFloat(e.concessionRequest)>parseFloat(e.billLimitAmount)&&(e.concessionRequest=e.billLimitAmount),parseFloat(e.billLimitAmount)>parseFloat(e.billAmount)&&parseFloat(e.concessionRequest)>parseFloat(e.billAmount)&&(e.concessionRequest=e.billAmount),!1;if("service"==t)return parseFloat(e.concessionRequest)>parseFloat(e.serviceLimitAmount)&&(e.concessionRequest=e.serviceLimitAmount),parseFloat(e.serviceLimitAmount)>parseFloat(e.totalAmount)&&parseFloat(e.concessionRequest)>parseFloat(e.totalAmount)&&(e.concessionRequest=e.totalAmount),!1}else null!=e.concessionRequest&&""!=e.concessionRequest&&0==parseFloat(e.concessionRequest)&&(e.concessionRequest="");return!0},g.concessionCompareChange=function(e){e.concessionRequest=""},g.checkValue=function(e,t){var a=e.concessionRequest;/^[0-9]\d{0,}(\.\d{0,2})?$/.test(a)||(e.concessionRequest="")},g.saveConcessionUploadedFiles=function(e){if(!(g.filesUploaded.length>0&&null!=e))return!0;for(var t=e.billSeqId,a=e.concessionReqSeqId,i=[],n=0;n<g.filesUploaded.length;n++)i.push(g.filesUploaded[n].id);r.linkUploadedFilestoConcession(t,a,i).then(function(e){},function(e){})}}t.$inject=["$scope","$filter","QueryService","uiGridConstants","hisTranslationsService","$state","PatientSearch","hisCalDefConstant","billWorkGridDefinition","BillWorkListGridColDef","GetBillWorkListData","PatientGlobal","hisAlertService","hisModalService","PrintService","angBillConcessionService","GenerateInvoiceService","hisTranslationsGlobalLang","hisGenericAlertService","opBillPrintService","RoleTaskService","hisAlertConstants","patientBillingService"],a.$inject=["$state","$scope","consServWiseGridDefinition","hisAlertService","angBillConcessionService","$uibModalInstance","$uibModalStack","consBillWiseGridDefinition","getbilldata","PatientBannerBilling","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","PatientBannerGlobal"],e.$inject=["$parse"],angular.module("napierContainerUi").controller("billWorkListCtrl",t).controller("ModalBillConcessionController",a).directive("fileModelCon",e),angular.module("napierContainerUi").controller("printBillWorkList",["returnObj","$uibModalInstance","selectedPrintType","QueryService","PrintService","$scope","taxType",function(e,t,a,i,r,n,l){n.pageName=2==l?"Tax Invoice":"Print Bill",n.taxType=l,n.cancel=function(){t.dismiss("cancel")},n.printParameterList=new Array,i.prepareParamList("pBillSeqId",e.billSeqId,n.printParameterList),"BillingInPatientFinalBillReceiptReport"==e.reportId&&i.prepareParamList("pFlagComp",e.pFlagComp,n.printParameterList),2==e.splitStaus?(i.prepareParamList("pFacility",angular.fromJson(sessionStorage.userContextObj).FACILITY_ISDEFAULT,n.printParameterList),i.prepareParamList("pPracticeId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID_DESC,n.printParameterList),i.prepareParamList("pBillPayerSeqId",e.BillPayerSeqId,n.printParameterList),n.printObject={},n.printObject.reportId=e.splitBillReportId):"CLAIM_FORM_TEMPLATE"==e.reportId?(n.printParameterList.splice(0,1),n.pageName="CLAIM FORM PRINT",i.prepareParamList("pRgSeqId",e.regSeqId,n.printParameterList),i.prepareParamList("pEnSeqId",e.encSeqId?e.encSeqId:-999,n.printParameterList),n.printObject={},n.printObject.reportId=e.reportId):(i.prepareParamList("isDuplicate",!1,n.printParameterList),i.prepareParamList("preparedBy",angular.fromJson(sessionStorage.userContextObj).LOGIN_NAME,n.printParameterList),n.printObject={},n.printObject.reportId=e.reportId),2==n.taxType&&(n.printParameterList=[],i.prepareParamList("pBillSeqId",e.billSeqId,n.printParameterList),n.printObject={},n.printObject.reportId=e.reportId),"BillingInPatientFinalCrBillReceiptReport"==e.reportId&&i.prepareParamList("pFlagComp","Y",n.printParameterList),n.printObject.destination="reportingServiceImpl",n.printObject.reportType={id:"PDF"==a?4:5,desc:a},n.printObject.paramsList=n.printParameterList,r.printReportFunction(n.printObject,n)}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p){var u=this;l.loadModule("billing"),u.alertObj={};var m=i.getLanguageToSet();l.changeLanguage(m),s.loadAlerts(m).then(function(e){u.alertObj=e,u.deleteRecordSave=[],u.alertObjBtn={buttonText:u.alertObj.ok},u.alertFunction={buttonCallBack1:function(){}},u.buttonClose={buttonClose:function(){}}}),e.gridOptions={enableHorizontalScrollbar:0,columnDefs:[{field:"MOVIN_DATE",displayName:"From Date"},{field:"MOVOUT_DATE",displayName:"To Date"},{field:"ALLOCATED_BED_CLASS_DESC",displayName:"Allocated Bed Class"},{field:"BILLING_BED_CLASS_DESC",displayName:"Billing Bed Class",cellTemplate:'<div class="input-holder ui-grid-cell-contents"><div ng-if="row.entity.editFlag"><select class="form-control grid-input" ng-model="row.entity.bedClass" ng-change="grid.appScope.chnBedCat.selectedBed(row,rowRenderIndex)" ng-options="item as item.DESCRIPTION for item in grid.appScope.chnBedCat.bedClassList"><option value="">{{"billing.select"|translate}}</option></select></div><div ng-if="!row.entity.editFlag"><span>{{row.entity.BILLING_BED_CLASS_DESC}}</span></div></div>'},{field:"ELIGABLE_BED_CLASS_DESC",displayName:"Eligible Bed Class"},{field:"REQUESTED_BED_CLASS_DESC",displayName:"Requested Bed Class"},{field:"actions",displayName:"Actions",cellTemplate:'<div class="ui-grid-cell-contents action-row"><i class="fa fa-pencil" ng-click="grid.appScope.chnBedCat.editBedClass(row,rowRenderIndex)"></i></div>'}]},u.patBedHistory=angular.copy(e.gridOptions),u.patBedHistory.onRegisterApi=function(t){e.createGridApi=t},u.init=function(){u.opBedDataList={1:u.opBedClassList=[]};var e=o.executeQueryURLReset();u.tariffClsListArr=new Array,o.prepareParamListWithParam("@pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,u.tariffClsListArr),o.executeQueryInput("SP_USP_BL_GET_TARIFF_CLASS",u.tariffClsListArr,u.opBedDataList,!0,!0,e,"popUp",{}).then(function(e){u.bedClassList=e[1]})},u.loadBedClass=function(e,t){let a=[],i={1:a=[]},r=o.executeQueryURLReset(),n=new Array;return o.prepareParamListWithParam("@PRACTICE_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,n),o.prepareParamListWithParam("@INC_SEQ_ID",e,n),o.prepareParamListWithParam("@PLAN_SEQ_ID",t,n),o.executeQueryInput("GET_PLAN_BED_CLASS_DETAILS",n,i,!0,!0,r,"popUp",{}).then(function(e){u.bedClassList=e[1]})},u.searchPatientIP=function(e){return d.getVisitBasedPatientDetails(1,e).then(function(e){if(e)return e})},u.searchPatient=function(t){if(t.length>0){return r.patientSearchService(t,"getPreAuthPatientServiceDetails").then(function(t){return e.patientDetailsSearch=t.data.HITService.message.approxBillsList[0]["com.napier.core.billgeneration.vo.ApproxBillVo"],null!=e.patientDetailsSearch?e.testVal=Array.isArray(e.patientDetailsSearch)?e.patientDetailsSearch:[e.patientDetailsSearch]:e.testVal=[],e.testVal.map(function(e){return e})})}},u.patientSearch=function(a){if(u.callClear(1),a.searchMR.ipAdmSeqId)a.searchIP={},a.searchIP.ipAdmSeqId=a.searchMR.ipAdmSeqId;else if(a.searchIP.IPADM_SEQ_ID)a.searchIP.ipAdmSeqId=a.searchIP.IPADM_SEQ_ID;else{if(""==a.searchIP)return t.warning("Warning","There is no admission against this MR no."),!1;a.searchIP.ipAdmSeqId=a.searchIP}n.getPatientBanner(a.searchIP,1).then(function(t){e.patientGlobalDtls=t,a.searchIP.IP_NO=t.ipNo,a.searchIP.RG_INT_MR_NO=t.mrNo,u.otherDetails.tariffCat=e.patientGlobalDtls.tarrifCategory,u.billStatus={1:u.billData=[]};var i=o.executeQueryURLReset();u.billArr=new Array,o.prepareParamListWithParam("pSubAccSeq",e.patientGlobalDtls.subAccSeqId,u.billArr),o.executeQueryInput("GET_BILL_STATUS_FOR_BED_CHANGE",u.billArr,u.billStatus,!0,!0,i,"popUp",{}).then(function(e){e[1][0].CLOSED_DATE&&u.editView()}),u.getAccSeqList=[];let r={1:u.getAccSeqList},n=o.executeQueryURLReset();u.getAccSeqListArr=[],o.prepareParamListWithParam("pRegSeqId",a.searchIP.RG_SEQ_ID,u.getAccSeqListArr),o.executeQueryInput("GET_ACCOUNT_AND_SUB_ACCOUNT_PHARMACY",u.getAccSeqListArr,r,!0,!0,n,"popUp",{}),e.patientGlobalDtls.userPermision=12,null!=e.patientGlobalDtls.mrNo?e.patientShow=!0:e.patientShow=!1,u.dischStatus(a.searchIP.ipAdmSeqId),""!=e.patientGlobalDtls.insuranceComp?u.fillPayer(a.searchIP.RG_INT_MR_NO):u.payer={name:"self",plan:"--",policy:"--",card:"--",validFrom:"--",validTo:"--"},u.bedHistory(a.searchIP.ipAdmSeqId),a.searchMR.ipAdmSeqId&&(a.searchIP="")})},u.editView=function(){let e={buttonText2:u.alertObj.ok},a={buttonCallBack2:function(){u.allowEdit=!1}};t.hisAlertMulti("information",u.alertObj.alertTypeInfo,"Bill is generated and hence not allowed to modify the Billing bed class",e,a,{buttonClose:function(){}})},u.dischStatus=function(e){u.dischData={1:u.dischDateTime=[]};var t=o.executeQueryURLReset();u.dischArr=new Array,o.prepareParamListWithParam("pAdmSeqId",e,u.dischArr),o.executeQueryInput("GET_CHANGE_CATEGORY_DISCHARGE_DATE_DTL",u.dischArr,u.dischData,!0,!0,t,"popUp",{}).then(function(e){null==e[1][0].DISCHARGE_DATE?(u.otherDetails.dischargeStatus="Not Discharged",u.otherDetails.dischargeDate=null):(u.otherDetails.dischargeStatus="Discharged",u.otherDetails.dischargeDate=moment(e[1][0].DISCHARGE_DATE).format("L"))})},u.fillPayer=function(t){d.getPayerBasedMrNo(t).then(function(t){u.payerArr=[];var a=t.find(t=>t.IN_PLC_SEQ_CD==e.patientGlobalDtls.insurancePlanSeqId);u.payer={name:a.COMP_NAME,plan:a.PLAN_NAME,policy:a.POLICY_NO,card:a.CARD_NUMBER,validFrom:moment(a.PI_FROM_DATE).format("DD/MM/YYYY"),validTo:moment(a.PI_TO_DATE).format("DD/MM/YYYY")},u.loadBedClass(a.INC_SEQ_ID,a.IN_PLC_SEQ_CD)})},u.bedHistory=function(e){u.bedDataList={1:u.bedCategory=[]};var t=o.executeQueryURLReset();u.bedClassArr=new Array,o.prepareParamListWithParam("pIpAdmnSeq",e,u.bedClassArr),o.executeQueryInput("CHANGE_BED_CATEGORY",u.bedClassArr,u.bedDataList,!0,!0,t,"popUp",{}).then(function(e){angular.forEach(e[1],function(e){e.fromDate=e.FROM_DATE,e.toDate=e.MOVOUT_DATE,e.MOVIN_DATE=moment(e.FROM_DATE).format("DD/MM/YYYY HH:MM"),e.MOVOUT_DATE=e.MOVOUT_DATE?moment(e.MOVOUT_DATE).format("DD/MM/YYYY HH:MM"):"--",u.patBedHistory.data.push(e)})})},u.editBedClass=function(e,t){if(!u.allowEdit)return!1;u.bedEdited=!0,e.entity.editFlag=!0,null==u.bedClassList.find(t=>t.CODE==e.entity.BILLING_BED_CLASS_CODE)&&u.bedClassList.unshift({CODE:e.entity.BILLING_BED_CLASS_CODE,DESCRIPTION:e.entity.BILLING_BED_CLASS_DESC})},u.selectedBed=function(e,t){e.entity.BILLING_BED_CLASS_CODE=e.entity.bedClass.CODE,e.entity.BILLING_BED_CLASS_DESC=e.entity.bedClass.DESCRIPTION},u.save=function(){var i=[];angular.forEach(u.patBedHistory.data,function(t){i.push({blBedSeqId:t.BL_BD_SEQ_ID?t.BL_BD_SEQ_ID:void 0,bedSeqId:t.BED_SEQ_ID,movInDate:t.fromDate,movOutDate:t.toDate,enSeqId:e.patientGlobalDtls.encounterSeqId,ipAdmnSeqId:t.IPADM_SEQ_ID,billBedCode:t.BILLING_BED_CLASS_CODE,billBedDesc:t.BILLING_BED_CLASS_DESC,allocBedCode:t.ALLOCATED_BED_CLASS_CODE,allocBedDesc:t.ALLOCATED_BED_CLASS_DESC,elligbleBedCode:t.ELIGABLE_BED_CLASS_CODE,elligbleBedDesc:t.ELIGABLE_BED_CLASS_DESC,reqBedCode:t.REQUESTED_BED_CLASS_CODE,reqBedDesc:t.REQUESTED_BED_CLASS_DESC})});var r={};r.url=c.HISIPINDENT.URL,r.requestData={operation:"saveBedCategory",messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.BedChangeCatList",bedChangeCategoryVOs:[{"com.napier.core.billgeneration.vo.BedChangeCategoryVO":i}]}},p.sendRestRequest(r).then(function(e){}),t.success("Success","Record saved successfully",!1,!1,a.time),u.callClear(2)},u.clear=function(e){if(u.bedEdited){let a={buttonText:u.alertObj.no,buttonText2:u.alertObj.yes},i={buttonCallBack1:function(){return!1},buttonCallBack2:function(){u.callClear(e)}},r={buttonClose:function(){}};t.hisAlertMulti("warning",u.alertObj.alertTypeInfo,"Are you sure want to clear the screen, unsaved data will not get updated",a,i,r)}else u.callClear(e)},u.callClear=function(t){u.bedEdited=!1,1!=t&&u.clearSrch(),u.otherDetails={},u.patBedHistory.data=[],u.payer={},e.patientGlobalDtls={},u.allowEdit=!0,u.init()},u.clearSrch=function(){u.searchMR="",u.searchIP=""},u.clear(),u.clearSrch()}e.$inject=["$scope","hisAlertService","hisAlertConstants","hisTranslationsGlobalLang","PatientSearch","PatientBannerGlobal","hisTranslationsService","hisGenericAlertService","QueryService","IPINDENTAPIS","PreAuthService","CallManager"],angular.module("napierContainerUi").controller("changeBedCategory",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u){var m=this;m.patientInput={},m.visitType=1,p.loadModule("billing"),m.format=angular.copy(i.uibDateOnly.format),m.clear=function(){m.data={fromCategory:{},toCategory:{fromDate:new Date,toDate:new Date}},m.fromDateOptions={minDate:new Date,maxDate:new Date},m.toDateOptions={minDate:new Date,maxDate:new Date}};var g=c.getLanguageToSet();p.changeLanguage(g),u.loadAlerts(g).then(function(t){e.alertObjectRes=t,e.alertData={buttonText:e.alertObjectRes.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}},function(e){}),m.patientSearch=function(e,a){if(e.length>1)return t.paitentAutoSearchWithStatus(e,a);m.showErrors=!1},m.getChangeCategoryHistory=function(){m.multipleComboForListL={1:m.categoryHistory=[]};var e=d.executeQueryURLReset();m.categoryHistoryList=new Array,d.prepareParamListWithParam("pAtregseqId",m.patientInput.admissionSeqid,m.categoryHistoryList),d.executeQueryInput("CHANGECATEGORY-002",m.categoryHistoryList,m.multipleComboForListL,!0,!0,e,"popUp",{}).then(function(e){m.changeCategoryHistoryGrid.data=[],m.changeCategoryHistoryGrid.data=m.categoryHistory})},m.getBillingBedClassData=function(e,t){m.multipleComboForListB={1:m.billingBedClassListAll=[]};var a=d.executeQueryURLReset();m.billingBedClassArr=new Array,d.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,m.billingBedClassArr),d.prepareParamListWithParam("pPatCatgSeqId",e,m.billingBedClassArr),d.prepareParamListWithParam("pStatus",1,m.billingBedClassArr),d.executeQueryInput("NHIS_ADT_M_021",m.billingBedClassArr,m.multipleComboForListB,!0,!0,a,"popUp",{}).then(function(e){e[1][0]&&t?m.billingToBedClassList=angular.copy(m.billingBedClassListAll):e[1][0]&&(m.billingBedClassList=angular.copy(m.billingBedClassListAll))})},m.getTariffClassData=function(e,t){var a={1:m.tariffClassListAll=[]},i=d.executeQueryURLReset(),r=new Array;d.prepareParamList(1,e,r),d.executeQueryInput("CHANGECATEGORY-008",r,a,!0,!0,i,"popUp",{}).then(function(e){e[1][0]&&t?m.toCatgoryList=angular.copy(m.tariffClassListAll):e[1][0]&&(m.tariffClassList=angular.copy(m.tariffClassListAll))})},m.getCurrentCategoryData=function(){m.multipleComboForList={1:m.currentCatgory=[]};var e=d.executeQueryURLReset();m.currentCatgoryList=new Array,d.prepareParamListWithParam("pAdtSeqId",m.patientInput.admissionSeqid,m.currentCatgoryList),d.executeQueryInput("CHANGECATEGORY-007",m.currentCatgoryList,m.multipleComboForList,!0,!0,e,"popUp",{}).then(function(e){null!=m.currentCatgory[0]&&null!=m.currentCatgory[0].PCATG_SEQ_ID&&(m.data.fromCategory=m.currentCatgory[0],m.data.fromCategory={category:m.currentCatgory[0].PCATG_SEQ_ID,bedClass:m.currentCatgory[0].BED_CATG_CODE,tariffCategory:m.currentCatgory[0].TARIFF_CATG_CODE,plan:m.currentCatgory[0].PLAN_SPONSOR_NAME},m.data.fromCategory.tariffCategory&&m.getTariffClassData(m.currentCatgory[0].PCATG_SEQ_ID),m.data.fromCategory.bedClass&&m.getBillingBedClassData(m.currentCatgory[0].PCATG_SEQ_ID))})},m.getPatientBannner=function(){a.getPatientBanner(m.patientInput,m.visitType).then(function(t){e.patientGlobalDtls=t,m.fromDateOptions.minDate=new Date(e.patientGlobalDtls.admissionDate),m.toDateOptions.minDate=new Date(e.patientGlobalDtls.admissionDate),m.data.toCategory.fromDate=new Date(e.patientGlobalDtls.admissionDate),e.patientGlobalDtls.userPermision=12,m.getChangeCategoryHistory(),m.getCurrentCategoryData()}),n.patientBannerDetail(m.patientInput.regSeqId).then(function(t){e.patientBannerDetails=t,e.patientRecordsDetail=e.patientBannerDetails.patientRecordsDetail}),o.getDocFile(m.patientInput.regSeqId,e);let t={1:m.getAccSeqList=[]},i=d.executeQueryURLReset();var r=[];d.prepareParamListWithParam("pRegSeqId",m.patientInput.regSeqId,r),d.executeQueryInput("GET_ACCOUNT_AND_SUB_ACCOUNT_PHARMACY",r,t,!0,!0,i,"popUp",{})},m.selectPatient=function(t,a,i,r){m.patientInput,m.multipleComboDataForListL={1:m.billCheck=[]};var n=d.executeQueryURLReset();m.billCheckList=new Array,d.prepareParamListWithParam("pIPNo",t.ipNo,m.billCheckList),d.executeQueryInput("SP_BILLGEN_CHECK",m.billCheckList,m.multipleComboDataForListL,!0,!0,n,"popUp",{}).then(function(a){if(null!=m.billCheck[0]&&null!=m.billCheck[0]&&null!=m.billCheck[0].CNT&&0==m.billCheck[0].CNT){m.patientInput=t,m.getPatientBannner();var i={1:m.patCategory=[]},r=d.executeQueryURLReset();d.executeQueryInput("NHIS_M_004",[],i,!0,!0,r,"popUp",{}).then(function(e){})}else m.billCheck=[],e.patientGlobalDtls=[],e.patientBannerDetails=[],m.getPatientBannner(),l.warning("warning","Bill is already generated for this IP patient")})},m.changeToCategory=function(){(delete m.data.toCategory.restData,delete m.data.toCategory.plan,delete m.data.toCategory.tariffCategory,delete m.data.toCategory.bedClass,m.data.toCategory.fromDate=new Date(e.patientGlobalDtls.admissionDate),m.fromDateOptions.minDate=new Date(e.patientGlobalDtls.admissionDate),m.toDateOptions.minDate=new Date(e.patientGlobalDtls.admissionDate),m.data.toCategory.toDate=new Date,m.toCatgoryList=[],m.billingToBedClassList=[],2==m.data.toCategory.category.CHECK_FOR||6==m.data.toCategory.category.CHECK_FOR)?s.open("Insurance Details",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/changeCategory/show.plans.modal.html",size:"lg",controller:"ShowPlansController",controllerAs:"spc",keyboard:!1,backdrop:"static",resolve:{objParam:m.patientInput.regSeqId}}).result.then(function(e){var t,a,i,r;m.data.toCategory.restData=e,m.data.toCategory.plan=e.INC_PLAN_NAME,t=e.IN_PLC_SEQ_CD,a={1:m.toCatgoryList=[]},i=d.executeQueryURLReset(),r=new Array,d.prepareParamListWithParam("pIncPlanSeqID",t,r),d.executeQueryInput("CHANGECATEGORY-010",r,a,!0,!0,i,"popUp",{}).then(function(e){null!=m.toCatgoryList[0]&&null!=m.toCatgoryList[0].TARIFF_SEQ_ID&&(m.data.toCategory.tariffCategory=m.toCatgoryList[0].TARIFF_SEQ_ID)})}):(m.getTariffClassData(m.data.toCategory.category.PCATG_SEQ_ID,!0),m.getBillingBedClassData(m.data.toCategory.category.PCATG_SEQ_ID,!0))},m.clear(),m.changeCategoryHistoryGrid={columnDefs:[{name:"FROM_DATE",displayName:"billing.from",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.FROM_DATE|date:"dd/MM/yyyy hh:mm a"}}</div>',headerCellFilter:"translate"},{name:"TO_DATE",displayName:"billing.to",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.TO_DATE|date:"dd/MM/yyyy hh:mm a"}}</div>',headerCellFilter:"translate"},{name:"PATDESC",displayName:"billing.patientCat",headerCellFilter:"translate"},{name:"TARRDESC",displayName:"billing.tariffcategory",headerCellFilter:"translate"},{name:"BEDDESC",displayName:"billing.BedClass",headerCellFilter:"translate"}]},m.oldServiceWiseGrid={columnDefs:[{name:"servicecode",displayName:"billing.serviceCode",headerCellFilter:"translate"},{name:"serviceName",headerCellFilter:"translate",displayName:"billing.serviceName"},{name:"serviceDate",headerCellFilter:"translate",displayName:"billing.serviceDate"},{name:"qty",headerCellFilter:"translate",displayName:"billing.quantity"},{name:"rate",headerCellFilter:"translate",displayName:"billing.rate"},{name:"hospitalShare",headerCellFilter:"translate",displayName:"billing.hospShare"},{name:"doctorShare",headerCellFilter:"translate",displayName:"billing.docShare"}]},m.newServiceWiseGrid={columnDefs:[{name:"servicecode",headerCellFilter:"translate",displayName:"billing.serviceCode"},{name:"serviceName",headerCellFilter:"translate",displayName:"billing.serviceName"},{name:"serviceDate",headerCellFilter:"translate",displayName:"billing.serviceDate"},{name:"qty",headerCellFilter:"translate",displayName:"billing.qty"},{name:"rate",headerCellFilter:"translate",displayName:"billing.rate"},{name:"hospitalShare",headerCellFilter:"translate",displayName:"billing.hospShare"},{name:"doctorShare",headerCellFilter:"translate",displayName:"billing.docShare"}]},m.saveCategory=function(){var e={"@class":"com.napier.core.scm.serviceposting.vo.ChangeCategoryHdVo",accSeqId:m.data.fromCategory.ACC_SEQ_ID,subAccSeqId:m.data.fromCategory.SUB_ACC_SEQ_ID,ipadmSeqId:m.patientInput.admissionSeqid,patCatgCode:m.data.fromCategory.category.PAT_CATG_CODE,patCatgSeqId:m.data.toCategory.category.PCATG_SEQ_ID,tariffCatgCode:m.data.toCategory.tariffCategory,bedCatgCode:m.data.toCategory.bedClass,planSeqId:m.data.toCategory.planSeqId,gnTranStatus:"1",isMedicineOnCash:m.data.fromCategory.IS_MEDICINE_ON_CASH,changeCatgLoc:2};r.saveChangeCategoryService(e).then(function(e){})},m.updateCategory=function(){var e={"@class":"com.napier.core.scm.serviceposting.vo.ChangeCategoryVo",patientId:_.toString(m.patientInput.regSeqId),patCatgCode:"3  ",tariffCatgCode:m.data.toCategory.tariffCategory,oldBedCatgCode:m.data.fromCategory.bedClass,newBedCatgCode:m.data.toCategory.bedClass,fromDate:m.data.toCategory.fromDate,toDate:moment(m.data.toCategory.toDate).format("YYYY-MM-DD")+"00:00:00.000 IST"};r.updateChangeCategoryService(e).then(function(e){})}}e.$inject=["$scope","PatientGlobal","PatientBannerGlobal","hisCalDefConstant","CancelBillService","PatientBannerBilling","hisAlertService","hisModalService","GetDocumentCommon","hisTranslationsGlobalLang","QueryService","hisTranslationsService","hisGenericAlertService"],angular.module("napierContainerUi").controller("changeCategoryCtrl",e)}(),function(){"use strict";function e(e,t,a,i){var r=this,n={1:r.billingBedClassList=[]},l=i.executeQueryURLReset(),s=new Array;i.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,s),i.prepareParamListWithParam("pRegSeqId",e,s),i.prepareParamListWithParam("pFacility",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,s),i.executeQueryInput("NHIS_RG_TR_002",s,n,!0,!0,l,"popUp",{}).then(function(e){e[1][0]&&(r.newServiceWiseGrid.data=r.billingBedClassList)}),r.defaultPayerCode=function(e,t){r.checkDefault=!0;for(var a=1;a<r.newServiceWiseGrid.data.length;a++)t!=a&&null!=r.newServiceWiseGrid.data[a].DEFTVALUE&&1==r.newServiceWiseGrid.data[a].DEFTVALUE&&(r.newServiceWiseGrid.data[a].DEFTVALUE=2)},r.close=function(){let e=_.find(r.newServiceWiseGrid.data,function(e){return 1==e.DEFTVALUE});a.close(e)},r.newServiceWiseGrid={columnDefs:[{name:"DEFTVALUE",displayName:"Default",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><span ><input type="radio" ng-model="row.entity.DEFTVALUE" value="1" ng-click="grid.appScope.spc.defaultPayerCode(row.entity,rowRenderIndex)" style="border:none"/></span></div>'},{name:"INC_PLAN_ID",headerCellFilter:"translate",displayName:"billing.planId"},{name:"INC_PLAN_NAME",headerCellFilter:"translate",displayName:"billing.planName"},{name:"IN_TYPE_NAME",headerCellFilter:"translate",displayName:"billing.Type"}]}}e.$inject=["objParam","$scope","$uibModalInstance","QueryService"],angular.module("napierContainerUi").controller("ShowPlansController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s){var o=this;i.loadModule("billing");var c=e.getLanguageToSet();i.changeLanguage(c),o.clear=function(){o.data={fromDate:new Date,toDate:new Date},o.payerText=!1,o.docText=!1,o.gridOptions.data=[]},o.getRoleTasks=function(){o.roleTask=l.rolePermission("T_BL_CLM_DENL_SUM_REPORT")},o.payerAutoSearch=function(e){var a="%"+e+"%",i={1:o.payerName=[]},r=t.executeQueryURLReset(),n=new Array;return t.prepareParamListWithParam("pCompCode",a,n),t.prepareParamListWithParam("pCompName",a,n),t.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n),t.executeQueryInput("GET_COPMANY_ACC_DTLS",n,i,!0,!0,r,"popUp",{}).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})},o.OPVMDoctorSearchTypeAhead=function(e){var a={1:o.OPVMDoctroSearch=[]},i=t.executeQueryURLReset(),r=new Array;return t.prepareParamListWithParam("pSpecializationId","",r),t.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r),t.prepareParamListWithParam("pDoctorId","",r),t.prepareParamListWithParam("pDoctorName",e,r),t.executeQueryInput("OP_DOCTOR_ADVANCE_SEARCH",r,a,!0,!0,i,"popUp",{}).then(function(e){return e[1][0]?o.OPVMDoctroSearch.map(function(e){return e}):[]})},o.Search=function(){var e={1:o.gridOptionsList=[]};o.gridOptions.data=[];var a=t.executeQueryURLReset(),i=new Array;t.prepareParamListWithParam("pFromDate",moment(o.data.fromDate).format("YYYY-MM-DD 00:00:00"),i),t.prepareParamListWithParam("pToDate",moment(o.data.toDate).format("YYYY-MM-DD 23:59:59"),i),t.prepareParamListWithParam("pSeqId",o.data.payerSeqId?o.data.payerSeqId.REF_SEQ_ID:o.data.doctorSeqId.DOCTID,i),t.executeQueryInput(o.data.payerSeqId?"PAYER_WISE_DENIAL_REPORT":"DOCTOR_WISE_DENIAL_REPORT",i,e,!0,!0,a,"popUp",o.gridOptions.data).then(function(e){e[1][0]&&(o.gridOptions.data=o.gridOptionsList)})},o.printSummaryList=function(){var e={pFromDate:moment(o.data.fromDate).format("YYYY-MM-DD 00:00:00"),pToDate:moment(o.data.toDate).format("YYYY-MM-DD 23:59:59"),pSeqId:o.data.payerSeqId?o.data.payerSeqId.REF_SEQ_ID:o.data.doctorSeqId.DOCTID,pDescription:o.data.payerSeqId?o.data.payerSeqId.INS_COMP_NAME:o.data.doctorSeqId.DOCTNAME,isPayer:!!o.data.payerSeqId,reportId:"DOCTOR_PAYER_WISE_DENIAL_REPORT_ID"};s.printReportModal("labelPrintController","lg","PDF",e)},o.gridOptions=angular.copy(a),o.format=angular.copy(r.uibDateOnly.format),delete n.ngModelOptions.timezone,o.toDateOptions={minDate:new Date,maxDate:new Date},o.fromDateOptions={maxDate:new Date},o.clear(),o.getRoleTasks()}e.$inject=["hisTranslationsGlobalLang","QueryService","claimsGridDef","hisTranslationsService","hisCalDefConstant","uibDatepickerConfig","RoleTaskService","PrintService"],angular.module("napierContainerUi").controller("ClaimsDenialSummaryReportController",e)}(),function(){"use strict";function e(e,t,i,r,n){var l=this;l.cheskSession=!1,l.getsummary=!1,null==sessionStorage.getItem("cashier")?l.concessionModal=n.open({animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/collection-summary/sections/counter.management.login.model.html",controller:"concessionModalCtrl",controllerAs:"cmc",backdrop:"static",keyboard:!1,size:"sm"}):l.cheskSession=!0,l.gridOptions=angular.copy(r),i.getTransactionSummary().then(function(e){var t=e.length;l.totalcount=t-1;var a=angular.copy(e);a.splice(-1);l.gridOptions.data=a;var i=e.length;l.total=e[i-1].total,l.totalDepositAmt=e[i-1].totalDepositAmt,l.totalBillAmt=e[i-1].totalBillAmt,l.totalDiscountAmt=e[i-1].totalDiscountAmt,l.totalDepositAdjusted=e[i-1].totalDepositAdjusted,l.totalReciveAmount=e[i-1].totalReciveAmount,l.totaldepositRefund=e[i-1].totaldepositRefund,l.totalRefund=e[i-1].totalRefund,l.totalBalance=e[i-1].totalBalance,l.toDate=l.gridOptions.data[0].date_time,l.fromDate=l.gridOptions.data[i-2].date_time},function(e){e&&(l.getsummary=!0)}),l.getDates=[];var s={1:l.getDates},o=t.executeQueryURLReset(),c=new Array;t.prepareParamList("1",angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,c),t.executeQueryInput("COUNTER_MANAGEMENT_MIN_MAX_TIME",c,s,!0,!0,o,"popUp",{}).then(function(e){}),l.generateSummary=function(){l.genSummaryModal=e.open("COLLECTION SUMMARY",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/collection-summary/sections/generateSummary.form.html",size:"lg",controller:a,controllerAs:"cs",resolve:{}})},l.printSummary=function(){l.requestData={},l.requestData.pUsrSqId=JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID,l.requestData.pFromDate=l.fromDate,l.requestData.pTodate=l.toDate;n.open({controller:"collectionSumPrintCntrl",templateUrl:"app/consumer/his17_1/common/his.print.screen.html",backdrop:"static",keyboard:!1,size:"lg",resolve:{selectedPrintType:function(){return"PDF"},ReqData:function(){return l.requestData}}});$("#indentModal").modal("hide")}}function t(e,t,a){var i=this;i.cashier={};var r=JSON.parse(sessionStorage.userContextObj);i.cashier.userSeqId=r.LOGIN_NAME,i.cashier.userEntityId=r.USER_ENTITY_ID,i.cashier.userSqId=r.USER_SEQ_ID,t.floatAmount(i.cashier.userSqId).then(function(e){i.cashier.floatamt=e[0].data;i.cashier.floatamt}),i.startSession=function(t){t=sessionStorage.setItem("cashier",angular.toJson(t));a.close(),"index.scrollSub.collectionSummary"==e.current.name&&e.reload()},i.checkValue=function(e){/^[0-9]+$/.test(e)||(i.cashier.floatamt="")}}function a(e,t,a,i,r){var n=this,l=JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID;JSON.parse(sessionStorage.cashier);n.amountDetails={},n.saveSummaryButton=!1,n.float=!1,n.check=!1,t.getTransactionSummary().then(function(e){var t=e.length;n.totalcount=t-1,n.fromDate=e[t-2].date_time,n.toDate=e[0].date_time}),n.colSumGridOptions=angular.copy(a),t.getCashHandOverCombo().then(function(e){n.cashHandOver=e}),t.cashierDropdown().then(function(e){n.cashierDropdown=e}),n.showHide=function(){JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID,JSON.parse(sessionStorage.cashier);n.amountDetails.cashHanded?("Cashier"==n.amountDetails.cashHanded.DESCRIPTION?n.check=!0:"Finance Department"==n.amountDetails.cashHanded.DESCRIPTION&&(null!=n.amountDetails.floatAmountHanded&&""!=n.amountDetails.floatAmountHanded||n.amountDetails.floatAmountHanded,n.check=!1),n.netAmountCal()):n.check=!1,n.netAmountCal()},n.print=function(){angular.element(document.querySelector(".shide")).hide(),angular.element(document.querySelector(".shide1")).hide(),window.print(),angular.element(document.querySelector(".shide")).show(),angular.element(document.querySelector(".shide1")).show()},n.saveSummary=function(a){n.saveSummaryButton=!0,t.getTransactionSummary().then(function(l){var s=[];angular.forEach(l,function(e,t){if(null!=e.transactionSeqId){var a={tranSeqId:e.transactionSeqId};s.push(a)}a={}});var o=JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID;if(null==a||null==a.floatAmountHanded||""==a.floatAmountHanded||null==a.cashHanded||""==a.cashHanded)return i.warning("Warning","Please Enter The Float Amount"),n.saveSummaryButton=!1,!1;if(2==a.cashHanded.CODE&&(null==a.cashier||""==a.cashier))return i.warning("Warning","Float Amount Handed To|Cashier"),n.saveSummaryButton=!1,!1;var c=angular.copy(n.colSumGridOptions.data),d={amount:a,userSeqId:o,transarry:s};t.saveSummaryList(c,d).then(function(t){r.dismissAll();var a=t[0];i.success("Success","Summary –"+a+" successfully generated"),n.saveSummaryButton=!1,e.reload()},function(e){e&&r.dismissAll()})})},t.getTransactionSummaryList(l).then(function(e){n.colSumGridOptions.data=angular.copy(e)}),n.floatAmtHandedTo=function(){n.amountDetails.floatAmountHanded,n.float=!1,n.netAmountCal()},n.netAmountCal=function(){if(null!=n.amountDetails.cashHanded)if("Finance Department"==n.amountDetails.cashHanded.DESCRIPTION){var e=JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID;JSON.parse(sessionStorage.cashier);t.getTransactionSummaryList(e).then(function(e){e.length;var t=null!=n.amountDetails.floatAmountHanded&&""!=n.amountDetails.floatAmountHanded?n.amountDetails.floatAmountHanded:0,a=parseFloat(e[0].cash)+parseFloat(e[1].cash)+parseFloat(t)-(parseFloat(e[2].cash)+parseFloat(e[3].cash));n.amountDetails.netcash=null!=a?parseFloat(parseFloat(a).toFixed(2)):a})}else if("Cashier"==n.amountDetails.cashHanded.DESCRIPTION){e=JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID,JSON.parse(sessionStorage.cashier);t.getTransactionSummaryList(e).then(function(e){e.length;var t=parseFloat(e[0].cash)+parseFloat(e[1].cash)-(parseFloat(e[2].cash)+parseFloat(e[3].cash));n.amountDetails.netcash=null!=t?parseFloat(parseFloat(t).toFixed(2)):t})}else n.amountDetails.netcash="";else n.amountDetails.netcash=""},n.checkValue=function(e){var t=angular.copy(n.colSumGridOptions.data),a=t.length,i=parseInt(t[a-2].cash);n.amountDetails.floatAmountHanded>i&&(n.amountDetails.floatAmountHanded=i);/^[0-9]+$/.test(e)||(n.amountDetails.floatAmountHanded="")}}function i(e,t,a,i,r,n){n.pageName="Collection Summary Print",n.cancel=function(){a.dismiss("cancel")},n.printTypeOptions=!1,n.printParameterList=new Array,r.prepareParamList("pUsrSqId",e.pUsrSqId,n.printParameterList),r.prepareParamList("pFromDate",e.pFromDate,n.printParameterList),r.prepareParamList("pTodate",e.pTodate,n.printParameterList),n.printObject={},n.printObject.reportId="CollectionSummaryReport",n.printObject.reportType={"@class":"com.napier.report.type.ReportType",id:4,desc:t},n.printObject.paramsList=n.printParameterList,n.printObject.destination="reportingServiceImpl",i.printReportFunction(n.printObject,n)}e.$inject=["hisModalService","QueryService","angCollectionSummaryService","transactionSummGridDef","$uibModal"],a.$inject=["$state","angCollectionSummaryService","colSummaryGridDef","hisAlertService","$uibModalStack"],t.$inject=["$state","angCollectionSummaryService","$uibModalInstance"],i.$inject=["ReqData","selectedPrintType","$uibModalInstance","PrintService","QueryService","$scope"],angular.module("napierContainerUi").controller("angCollectionSummaryController",e).controller("colSummaryCtrl",a).controller("concessionModalCtrl",t).controller("collectionSumPrintCntrl",i)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m){var g=this;n.loadModule("billing");var S=p.getLanguageToSet();n.changeLanguage(S),g.alertObj={},u.loadAlerts(S).then(function(e){g.alertObj=e,g.alertData={buttonText:g.alertObj.ok},g.alertFunction={buttonCallBack1:function(){}},g.buttonClose={buttonClose:function(){}}}),g.getRoleId=m.rolePermission("T_BL_COMP_SETTLEMENTS"),g.disableButton=!0,g.disblPrintBtnList=!0,g.disblPrintBtn=!0,g.disblPayerQueryBtn=!0,g.selectInvoice=null,g.prntObj={},g.CD=angular.copy(r),g.fromDateOptions={format:g.CD.dateOnly.format,maxDate:new Date},g.toDateOptions={format:g.CD.dateOnly.format,maxDate:new Date},g.changeToDate=function(e){g.toDateOptions.minDate=e},g.changeFromDate=function(e){g.fromDateOptions.maxDate=e},g.frmDate=new Date,g.toDate=new Date,g.cmpnyStlemntGrid=angular.copy(e),t.getGridColumnDefs(g.cmpnyStlemntGrid),g.cmpnyStlemntGrid.data=[],g.cmpnyStlemntGrid.onRegisterApi=function(e){g.gridApi=e,e.selection.on.rowSelectionChanged(o,function(e){e.isSelected;var t=g.gridApi.selection.getSelectedRows().length;if(g.selectInvoice=g.gridApi.selection.getSelectedRows(),t>0)for(var a=0;a<t;a++){if(null!=g.selectInvoice[a].COVER_LETTER_STATUS_CODE&&1!=g.selectInvoice[a].COVER_LETTER_STATUS_CODE){g.disableButton=!0,g.disblPrintBtn=!0,g.disblPayerQueryBtn=!0;break}a==t-1&&(g.disableButton=!1,1==t?(g.disblPrintBtn=!1,g.disblPayerQueryBtn=!1):(g.disblPrintBtn=!0,g.disblPayerQueryBtn=!0))}else g.disableButton=!0,g.disblPrintBtn=!0,g.disblPayerQueryBtn=!0}),e.selection.on.rowSelectionChangedBatch(o,function(e){var t=g.gridApi.selection.getSelectedRows().length;if(g.selectInvoice=g.gridApi.selection.getSelectedRows(),t>0){for(var a=0;a<t;a++){if(null!=g.selectInvoice[a].COVER_LETTER_STATUS_CODE&&1!=g.selectInvoice[a].COVER_LETTER_STATUS_CODE){g.disableButton=!0;break}a==t-1&&(g.disableButton=!1)}g.disblPayerQueryBtn=1!=t,g.disblPrintBtnList=!1}else g.disableButton=!0,g.disblPrintBtnList=!0,g.disblPayerQueryBtn=!0})},g.payerSearch=function(e){var t="%"+e+"%";g.payerName=[],g.multipleComboDataForList={1:g.payerName};var a=l.executeQueryURLReset();return g.payerNameList=new Array,l.prepareParamListWithParam("pCompCode",t,g.payerNameList),l.prepareParamListWithParam("pCompCode",t,g.payerNameList),l.prepareParamListWithParam("pCompName",t,g.payerNameList),l.prepareParamListWithParam("pCompName",t,g.payerNameList),l.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,g.payerNameList),l.executeQueryInput("GET_COPMANY_ACC_BILL_DTLS",g.payerNameList,g.multipleComboDataForList,!0,!0,a,"popUp",g.cmpnyStlemntGrid).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})},g.searchPatient=function(e){return c.paitentAutoSearchWithOutStatus(e)},g.getCompanyStlmntList=function(e){if(null!=g.payer&&null!=g.payer&&g.payer!=[]&&""!=g.payer&&null!=g.payer.INS_COMP_NAME){var t=null;null!=g.patientSrchM&&null!=g.patientSrchM&&""!=g.patientSrchM&&null==g.patientSrchM.mrNo?c.paitentAutoSearchWithOutStatus(g.patientSrchM).then(function(e){t=e[0]}):t=g.patientSrchM,g.cmpnyStl=[],g.multiplecmpnyStlForList={1:g.cmpnyStl};var i=l.executeQueryURLReset();g.cmpnyStlList=new Array,l.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,g.cmpnyStlList),l.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,g.cmpnyStlList),l.prepareParamListWithParam("pFromDate",s("date")(new Date(g.frmDate),"yyyy-MM-dd 00:00:00"),g.cmpnyStlList),l.prepareParamListWithParam("pToDate",s("date")(new Date(g.toDate),"yyyy-MM-dd 23:59:59"),g.cmpnyStlList),l.prepareParamListWithParam("pInvoiceStatus",-999,g.cmpnyStlList),l.prepareParamListWithParam("pInvoiceStatus",-999,g.cmpnyStlList),l.prepareParamListWithParam("pBillCategory",parseInt(g.billCatgry),g.cmpnyStlList),l.prepareParamListWithParam("pBillCategory",parseInt(g.billCatgry),g.cmpnyStlList),l.prepareParamListWithParam("pCompanyName",g.payer.INS_COMP_NAME,g.cmpnyStlList),l.prepareParamListWithParam("pCompanyName",g.payer.INS_COMP_NAME,g.cmpnyStlList),l.prepareParamListWithParam("pInvoiceNo",null==g.invoiceNo||null==g.invoiceNo?"":"%"+g.invoiceNo+"%",g.cmpnyStlList),l.prepareParamListWithParam("pInvoiceNo",null==g.invoiceNo||null==g.invoiceNo?"":"%"+g.invoiceNo+"%",g.cmpnyStlList),l.prepareParamListWithParam("pBillNo",null==g.billNo||null==g.billNo?"":"%"+g.billNo+"%",g.cmpnyStlList),l.prepareParamListWithParam("pBillNo",null==g.billNo||null==g.billNo?"":"%"+g.billNo+"%",g.cmpnyStlList),l.prepareParamListWithParam("pMrNo",null==t||null==t?"":t.mrNo,g.cmpnyStlList),l.prepareParamListWithParam("pMrNo",null==t||null==t?"":t.mrNo,g.cmpnyStlList),l.prepareParamListWithParam("pIpNo",null==g.ipNo||null==g.ipNo?"":g.ipNo,g.cmpnyStlList),l.prepareParamListWithParam("pIpNo",null==g.ipNo||null==g.ipNo?"":g.ipNo,g.cmpnyStlList),l.prepareParamListWithParam("pBillPayStatus",parseInt(g.billStatus),g.cmpnyStlList),l.executeQueryInput("BL_COMPANY_SETTLEMENT_001",g.cmpnyStlList,g.multiplecmpnyStlForList,!0,!0,i,"popUp",g.cmpnyStlemntGrid).then(function(e){g.prntObj={},g.prntObj.invoiceNo=g.invoiceNo,g.prntObj.billNo=g.billNo,g.prntObj.billCatgry=g.billCatgry,g.prntObj.billStatus=g.billStatus,g.prntObj.patientSrchM=g.patientSrchM,g.prntObj.toDate=g.toDate,g.prntObj.frmDate=g.frmDate;e[1],Array,e[1];if(g.cmpnyStl.length>0)g.cmpnyStlemntGrid.data=g.cmpnyStl,g.gridApi.selection.clearSelectedRows();else{g.cmpnyStlemntGrid.data=[],g.gridApi.selection.clearSelectedRows();var t={buttonText:g.alertObj.ok},i=g.alertObj.noRcrdFound;a.hisAlertMulti("information",g.alertObj.alertTypeInfo,i,t,{buttonCallBack1:function(){}},{buttonClose:function(){}},2e3)}})}else{var r={buttonText:g.alertObj.ok},n=g.alertObj.plzSlctPayrNme;a.hisAlertMulti("information",g.alertObj.alertTypeInfo,n,r,{buttonCallBack1:function(){}},{buttonClose:function(){}},2e3)}},g.cmpnyStlmnt=function(e){g.invoiceCheckDtls=[],g.multipleDataINVForList={1:g.invoiceCheckDtls};var t=l.executeQueryURLReset();g.invoiceCheckDtlsList=new Array;for(var r="",n=0;n<g.selectInvoice.length;n++){var s=",";n==g.selectInvoice.length-1&&(s=""),r=r+g.selectInvoice[n].INVC_DT_SEQ_ID+s}l.prepareParamListWithParam("pInvDtSeqIds",r,g.invoiceCheckDtlsList),l.executeQueryInput("SP_BL_GET_INVC_HD",g.invoiceCheckDtlsList,g.multipleDataINVForList,!0,!0,t,"popUp",g.cmpnyStlemntGrid).then(function(t){if(1==g.invoiceCheckDtls.length){g.scrollCheckDtls=[],g.multipleDataINVForList={1:g.scrollCheckDtls};var n=l.executeQueryURLReset();g.scrollCheckDtlsList=new Array;for(var s="",o=0;o<g.selectInvoice.length;o++){var c=",";o==g.selectInvoice.length-1&&(c=""),s=s+g.selectInvoice[o].INVC_DT_SEQ_ID+c}l.prepareParamListWithParam("pInvDtSeqIds",s,g.scrollCheckDtlsList),l.executeQueryInput("SP_BL_PENDING_SCROLL_BILLS",g.scrollCheckDtlsList,g.multipleDataINVForList,!0,!0,n,"popUp",g.cmpnyStlemntGrid).then(function(t){if(0==g.scrollCheckDtls.length){for(var n=!1,l=null,s=0;s<g.selectInvoice.length;s++)if(0==g.selectInvoice[s].OUTSTANDING_AMT||"Paid"==g.selectInvoice[s].BILL_PAY_STATUS){l=g.selectInvoice[s].BILL_NO,n=!0;break}if(n){var o=g.alertObj.theSlctBilStldUnchkBl+": <b>"+l+"</b>";a.hisAlertMulti("information",g.alertObj.alertTypeInfo,o,g.alertData,g.alertFunction,g.buttonClose)}else{var c=g.alertObj.headerCmnyInvceStlmPop;i.open(c,{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/companySettlements/sections/invoice.settlement.modal.html",size:e,controller:"invoiceStmntCtrl",controllerAs:"inStl",windowClass:"cmpny-stlmnt-main-modal",backdrop:"static",keyboard:!1,resolve:{selectedInvoice:function(){return g.selectInvoice},hdSeqId:function(){return g.invoiceCheckDtls},pInvDtSeqIds:function(){return r}}})}}else{for(var d="",p=0;p<g.scrollCheckDtls.length;p++){var u=",";p==g.scrollCheckDtls.length-1&&(u="."),d=d+g.scrollCheckDtls[p].BILL_NO+u}o=(o=g.alertObj.penScrlReqAvl)+": <b>"+d+"</b> "+g.alertObj.pzClsBefPrcAginStlm,a.hisAlertMulti("information",g.alertObj.alertTypeInfo,o,g.alertData,g.alertFunction,g.buttonClose)}})}else{var d=g.alertObj.pzSlctOneInvceRltdBil;a.hisAlertMulti("information",g.alertObj.alertTypeInfo,d,g.alertData,g.alertFunction,g.buttonClose)}})},g.printCover=function(e,t){o.printParameterList=new Array;for(var i=0;i<1;i++)if(e)l.prepareParamList("pBillSeqId",g.selectInvoice[i].BILL_SEQ_ID,o.printParameterList),l.prepareParamList("pCompSeqId",g.selectInvoice[i].COMPANY_SEQ_ID,o.printParameterList);else{l.prepareParamList("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,o.printParameterList),l.prepareParamList("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,o.printParameterList),l.prepareParamList("pFromDate",moment(g.prntObj.frmDate).format("YYYY-MM-DD"),o.printParameterList),l.prepareParamList("pToDate",moment(g.prntObj.toDate).format("YYYY-MM-DD"),o.printParameterList),l.prepareParamList("pInvoiceStatus",-999,o.printParameterList),l.prepareParamList("pInvoiceStatusText","ALL",o.printParameterList),l.prepareParamList("pBillCategory",null==g.prntObj.billCatgry||null==g.prntObj.billCatgry?-999:parseInt(g.prntObj.billCatgry),o.printParameterList),l.prepareParamList("pBillCategoryText",null==g.prntObj.billCatgry||null==g.prntObj.billCatgry||"-999"==g.prntObj.billCatgry?"ALL":"1"==g.prntObj.billCatgry?"IP":"OP",o.printParameterList),l.prepareParamList("pCompanyName",g.selectInvoice[i].COMPANY_NAME,o.printParameterList);var r="%"+g.prntObj.invoiceNo+"%";l.prepareParamList("pInvoiceNo",null!=g.prntObj.invoiceNo&&null!=g.prntObj.invoiceNo&&""!=g.prntObj.invoiceNo?r:"",o.printParameterList),l.prepareParamList("pBillNo",null!=g.prntObj.billNo&&null!=g.prntObj.billNo&&""!=g.prntObj.billNo?"%"+g.prntObj.billNo+"%":"",o.printParameterList),l.prepareParamList("pMrNo",null==g.prntObj.patientSrchM||null==g.prntObj.patientSrchM||""==g.prntObj.patientSrchM||null==g.prntObj.patientSrchM.mrNo?"":g.prntObj.patientSrchM.mrNo,o.printParameterList),l.prepareParamList("pIpNo","",o.printParameterList),l.prepareParamList("pBillPayStatus",null==g.prntObj.billStatus||null==g.prntObj.billStatus||"-999"==g.prntObj.billStatus?"":g.prntObj.billStatus,o.printParameterList),l.prepareParamList("pBillPayStatusText",null==g.prntObj.billStatus||null==g.prntObj.billStatus||"-999"==g.prntObj.billStatus?"":"1"==g.prntObj.billStatus?"Paid":"2"==g.prntObj.billStatus?"UnPaid":"Partially Paid",o.printParameterList)}var n={paramsList:o.printParameterList};if(n.reportId=e?"On_Account_Settlement_DotMatrixPrintReport":"CompanySettlementPdf_Generation_Report",e&&2==g.selectInvoice[0].INVOICE_STATUS_CODE){var s=g.alertObj.cmpnyStlmtNotDneSlctBil;a.hisAlertMulti("information",g.alertObj.alertTypeInfo,s,g.alertData,g.alertFunction,g.buttonClose)}else d.printReportModal("PrintTypeSelection","sm").then(function(e){d.printReportModal("printCmpnyStmlnt","lg",e,n)})},g.clearCoverData=function(e){g.prntObj={},g.cmpnyStlemntGrid.data=[],g.gridApi.selection.clearSelectedRows(),g.payer=null,g.billNo=null,g.invoiceNo=null,g.patientSrchM=null,g.patientSrchP=null,g.coverLtrStatus="-999",g.billStatus="-999",g.billCatgry="-999",g.frmDate=null,g.toDate=null,g.toDate=moment().add(0,"d").add(-9,"m"),g.frmDate=moment().add(0,"d").add(-10,"m")},g.payerQueryPopOpen=function(e){e.alertObj.headerCmnyInvceStlmPop,i.open("Payer Query",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/companySettlements/sections/payer.query.modal.html",size:"lg",controller:"payerQueryCtrl",controllerAs:"pqc",backdrop:"static",keyboard:!1,resolve:{selectInvoice:function(){return e.selectInvoice}}})}}e.$inject=["cmpnyStlGridDefinition","cmpnyService","hisAlertService","hisModalService","hisCalDefConstant","hisTranslationsService","QueryService","$filter","$scope","PatientGlobal","PrintService","hisTranslationsGlobalLang","hisGenericAlertService","RoleTaskService"],angular.module("napierContainerUi").controller("invoiceCompanySettlement",e),angular.module("napierContainerUi").controller("printCmpnyStmlnt",["returnObj","$uibModalInstance","selectedPrintType","PrintService","$scope",function(e,t,a,i,r){r.pageName="Company Settlement",r.cancel=function(){t.dismiss("cancel")},r.printObject={},r.printObject.reportId=e.reportId,r.printObject.destination="reportingServiceImpl",r.printObject.reportType={id:"PDF"==a?4:5,desc:a},r.printObject.paramsList=e.paramsList,i.printReportFunction(r.printObject,r)}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d){var p=this;p.flagDep=s,i.loadModule("billing");var u=c.getLanguageToSet();i.changeLanguage(u),p.alertObj={},d.loadAlerts(u).then(function(e){p.alertObj=e,p.alertData={buttonText:p.alertObj.ok},p.alertFunction={buttonCallBack1:function(){}},p.buttonClose={buttonClose:function(){}}});for(var m=0;m<r.length;m++)null==r[m].preAdjTotal&&(r[m].preAdjTotal=0),null==r[m].adjAmt&&(r[m].adjAmt=0),0==r[m].preAdjTotal&&(null!=r[m].BLANCE_AMT&&(r[m].remBal=angular.copy(r[m].BLANCE_AMT)),null!=r[m].REMAIN_AMOUNT&&(r[m].remBal=angular.copy(r[m].REMAIN_AMOUNT)));p.flagDep?(p.accDepGridOptions=angular.copy(e),t.getAccDepColumnDefs(p.accDepGridOptions),p.accDepGridOptions.data=[],p.accDepGridOptions.data=angular.copy(r)):(p.patDepGridOptions=angular.copy(e),t.getDepositColumnDef(p.patDepGridOptions),p.patDepGridOptions.data=[],p.patDepGridOptions.data=angular.copy(r)),p.changeAccAdj=function(e,t){var a=0;(null==e.entity.temBal||null==e.entity.temBal||""==e.entity.temBal||isNaN(e.entity.temBal))&&(e.entity.temBal=0),a=null==e.entity.adjAmt||null==e.entity.adjAmt||""==e.entity.adjAmt?0:parseFloat(e.entity.adjAmt);var i=0;null==o.passedAmt&&(o.passedAmt=0),null==o.depAdjAmt&&(o.depAdjAmt=0),null==o.onAccDep&&(o.onAccDep=0);var r,n=0;if(null!=e.entity.BLANCE_AMT?(i=parseFloat(e.entity.BLANCE_AMT),parseFloat(e.entity.BLANCE_AMT)<a&&(a=e.entity.adjAmt=angular.copy(parseFloat(e.entity.temBal))),n=parseFloat(o.passedAmt)+parseFloat(o.depAdjAmt)+parseFloat(o.onAccDep)):(i=parseFloat(e.entity.REMAIN_AMOUNT),parseFloat(e.entity.REMAIN_AMOUNT)<a&&(a=e.entity.adjAmt=angular.copy(parseFloat(e.entity.temBal))),n=parseFloat(o.passedAmt)+parseFloat(o.onAccDep)+parseFloat(o.depAdjAmt)),parseFloat(n)>parseFloat(o.OUTSTANDING_AMT)||parseFloat(n)==parseFloat(o.OUTSTANDING_AMT)){p.alertObj.onAcDepAdjAMtCntGratrThnDue;a=e.entity.adjAmt=0}var l=0;if(null!=o.accFlag&&1==o.accFlag){l=0;for(var s=0;s<o.adjAccObj.length;s++)if(o.adjAccObj[s].COL_REQ_SEQ_ID==e.entity.COL_REQ_SEQ_ID){l=angular.copy(parseFloat(o.adjAccObj[s].adjAmt));break}r=parseFloat(e.entity.temBal)+a-l}else if(null!=o.patDepFlag&&1==o.patDepFlag){for(s=0;s<o.adjObj.length;s++)if(o.adjObj[s].DEPOSIT_SEQ_ID==e.entity.DEPOSIT_SEQ_ID){l=angular.copy(parseFloat(o.adjObj[s].adjAmt));break}r=parseFloat(e.entity.temBal)+a-l}else r=parseFloat(e.entity.temBal)+a;e.entity.remBal=i-r,e.entity.remBal<0&&(e.entity.remBal=0),r>i&&(r=i,a=i-parseFloat(e.entity.temBal)>-1?e.entity.adjAmt=parseFloat(l)+(i-parseFloat(e.entity.temBal)):e.entity.adjAmt=0),e.entity.preAdjTotal=r},p.changedDep=function(e,t){var i=0,r=[],n=0,l="";null==o.depAdjAmt&&(o.depAdjAmt=0),null==o.onAccDep&&(o.onAccDep=0),null==e.ONACC_DEPOSIT_NO?(n=parseFloat(o.passedAmt)+parseFloat(o.depAdjAmt)+parseFloat(o.onAccDep),r=p.patDepGridOptions.data,l=p.alertObj.sumPasdAmtAdjAmtGrtDue):(n=parseFloat(o.passedAmt)+parseFloat(o.onAccDep)+parseFloat(o.depAdjAmt),r=p.accDepGridOptions.data,l=p.alertObj.sumPasdAmtAdjAmtGrtDue);for(var s=0;s<r.length;s++)null!=r[s].adjAmt&&null!=r[s].adjAmt&&""!=r[s].adjAmt||(r[s].adjAmt=0),i+=parseFloat(r[s].adjAmt);if(n+i>parseFloat(o.OUTSTANDING_AMT)){for(s=0;s<r.length;s++)if(null!=o.adjAccObj){for(var c=0;c<o.adjAccObj.length;c++)if(o.adjAccObj[c].COL_REQ_SEQ_ID==r[s].COL_REQ_SEQ_ID){r[s].adjAmt=angular.copy(parseFloat(o.adjAccObj[c].temBal)),r[s].preAdjTotal=angular.copy(parseFloat(o.adjAccObj[c].preAdjTotal)),r[s].remBal=angular.copy(parseFloat(o.adjAccObj[c].remBal));break}}else if(null!=o.adjObj){for(c=0;c<o.adjObj.length;c++)if(o.adjObj[c].DEPOSIT_SEQ_ID==r[s].DEPOSIT_SEQ_ID){r[s].adjAmt=angular.copy(parseFloat(o.adjObj[c].temBal)),r[s].preAdjTotal=angular.copy(parseFloat(o.adjObj[c].preAdjTotal)),r[s].remBal=angular.copy(parseFloat(o.adjObj[c].remBal));break}}else r[s].adjAmt=0,r[s].preAdjTotal=0,r[s].remBal=angular.copy(null==r[s].BLANCE_AMT?r[s].REMAIN_AMOUNT:r[s].BLANCE_AMT);a.hisAlertMulti("information",p.alertObj.alertTypeInfo,l,p.alertData,p.alertFunction,p.buttonClose)}},p.saveAccDep=function(){var e=0,t=[];t=s?p.accDepGridOptions.data:p.patDepGridOptions.data;for(var a=0;a<t.length;a++)e+=parseFloat(t[a].adjAmt);var i={accGridData:s?p.accDepGridOptions.data:p.patDepGridOptions.data,index:l,adjAmt:e};n.close(i)}}e.$inject=["cmpnyStlGridDefinition","invStlService","hisAlertService","hisTranslationsService","onAccDepData","$uibModalInstance","indexV","flagDep","invoiceData","hisTranslationsGlobalLang","hisGenericAlertService"],angular.module("napierContainerUi").controller("invoiceStmntAccDepCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v){var D=this;i.loadModule("billing");var y=p.getLanguageToSet();if(i.changeLanguage(y),D.alertObj={},u.loadAlerts(y).then(function(e){D.alertObj=e,D.alertData={buttonText:D.alertObj.ok},D.alertFunction={buttonCallBack1:function(){}},D.buttonClose={buttonClose:function(){}}}),D.enableDepButton=!0,D.rowIndexV=null,D.TDSAuto=null,D.accIndex=null,D.copAmt=0,D.stldAmt=0,D.copAmtDue=0,D.pasdAmtTotal=0,D.accDepTotal=0,D.TDSTotal=0,D.netAmtTotal=0,D.discAmtTotal=0,D.accDepGridData=[],D.depositGridData=[],D.billSeqId=null,D.stlmntGridOptions=angular.copy(e),S.getGridColumnDefs(D.stlmntGridOptions),D.stlmntGridOptions.onRegisterApi=function(e){D.grid=e,e.selection.on.rowSelectionChanged(n,function(e,t){e.isSelected;if(e.isSelected){D.enableDepButton=!0,e.entity.disabledPasdAmt=!0,e.entity.disableField=!0,D.selectRow=D.grid.selection.getSelectedRows();var a=_.findIndex(D.selectRow,function(t){return D.billSeqId=e.entity.BILL_SEQ_ID,t.BILL_SEQ_ID==e.entity.BILL_SEQ_ID});D.disableField=!1,D.calTapDscDep(D.selectRow[a],!1)}else D.disableField=!0,e.entity.disableField=!1,e.entity.disabledPasdAmt=!1,e.entity.passedAmt=0,e.entity.discAmt=0,e.entity.netAmt=0,e.entity.depAdjAmt=0,e.entity.deniedAmt=0,e.entity.onAccDep=0,e.entity.tds=0,D.calTotalAmtFields(D)})},D.setTotalValue=function(e,t){null!=e.entity.passedAmt&&null!=e.entity.passedAmt&&""!==e.entity.passedAmt||(e.entity.passedAmt=0),null!=e.entity.tds&&null!=e.entity.tds&&""!==e.entity.tds||(e.entity.tds=0),null!=e.entity.discAmt&&null!=e.entity.discAmt&&""!==e.entity.discAmt||(e.entity.discAmt=0),D.calTotalAmtFields(D)},D.calTotalAmtFields=function(e){e.pasdAmtTotal=0,e.accDepTotal=0,e.TDSTotal=0,e.netAmtTotal=0,e.discAmtTotal=0,e.deneidAmtTotal=0;for(var t=0;t<e.stlmntGridOptions.data.length;t++)null!=e.stlmntGridOptions.data[t].passedAmt&&null!=e.stlmntGridOptions.data[t].passedAmt&&""!=e.stlmntGridOptions.data[t].passedAmt&&(e.pasdAmtTotal=e.pasdAmtTotal+parseFloat(e.stlmntGridOptions.data[t].passedAmt)),null!=e.stlmntGridOptions.data[t].discAmt&&null!=e.stlmntGridOptions.data[t].discAmt&&""!=e.stlmntGridOptions.data[t].discAmt&&(e.discAmtTotal=e.discAmtTotal+parseFloat(e.stlmntGridOptions.data[t].discAmt)),null!=e.stlmntGridOptions.data[t].netAmt&&null!=e.stlmntGridOptions.data[t].netAmt&&""!=e.stlmntGridOptions.data[t].netAmt&&(e.netAmtTotal=e.netAmtTotal+parseFloat(e.stlmntGridOptions.data[t].netAmt)),null!=e.stlmntGridOptions.data[t].onAccDep&&null!=e.stlmntGridOptions.data[t].onAccDep&&""!=e.stlmntGridOptions.data[t].onAccDep&&(e.accDepTotal=e.accDepTotal+parseFloat(e.stlmntGridOptions.data[t].onAccDep)),null!=e.stlmntGridOptions.data[t].tds&&null!=e.stlmntGridOptions.data[t].tds&&""!=e.stlmntGridOptions.data[t].tds&&(e.TDSTotal=e.TDSTotal+parseFloat(e.stlmntGridOptions.data[t].tds)),null!=e.stlmntGridOptions.data[t].deniedAmt&&null!=e.stlmntGridOptions.data[t].deniedAmt&&""!=e.stlmntGridOptions.data[t].deniedAmt&&(e.deneidAmtTotal=e.deneidAmtTotal+parseFloat(e.stlmntGridOptions.data[t].deniedAmt))},D.calTapDscDep=function(e,t){S.getTPADiscounts(e).then(function(a){var i;if(null==e.tds||null==e.tds||""===e.tds?(i=0,e.tds=0):i=parseFloat(e.tds),null!=a.data.HITService.message&&null!=a.data.HITService.message.isTPAApplicable&&1==a.data.HITService.message.isTPAApplicable){var r=a.data.HITService.message;if(t){var n={buttonText:D.alertObj.yes,buttonText2:D.alertObj.no},l={buttonCallBack1:function(){e.passedAmt=r.netAmount,e.discAmt=r.tpaDiscountAmount,e.netAmt=r.netAmount-i,e.disabledPasdAmt=!0,D.calTotalAmtFields(D)},buttonCallBack2:function(){e.disabledPasdAmt=!1}},s={buttonClose:function(){e.disabledPasdAmt=!1}},o=D.alertObj.patElgFrErlyStml;v.hisAlertMulti("information",D.alertObj.alertTypeInfo,o,n,l,s)}else e.passedAmt=r.netAmount,e.discAmt=r.tpaDiscountAmount,e.netAmt=r.netAmount-i,e.depAdjAmt=0,e.onAccDep=0,D.calTotalAmtFields(D)}else if(!t){e.passedAmt=e.OUTSTANDING_AMT,e.discAmt=0,e.depAdjAmt=0,e.onAccDep=0,e.deniedAmt=0,e.disabledPasdAmt=!1,e.netAmt=e.OUTSTANDING_AMT-i,D.calTotalAmtFields(D);o=D.alertObj.elyPymntDisNotPayr;v.hisAlertMulti("information",D.alertObj.alertTypeInfo,o,D.alertData,D.alertFunction,D.buttonClose)}})},D.TDSAutoDisable=!0,D.fillAutoTax=function(e){for(var t=0;t<e.stlmntGridOptions.data.length;t++)parseFloat(e.stlmntGridOptions.data[t].passedAmt)>0&&(e.stlmntGridOptions.data[t].tds=parseFloat((parseFloat(e.stlmntGridOptions.data[t].passedAmt)/100*parseFloat(e.TDSAuto)).toFixed(2)),e.stlmntGridOptions.data[t].netAmt=parseFloat((parseFloat(e.stlmntGridOptions.data[t].passedAmt)-e.stlmntGridOptions.data[t].tds).toFixed(2)));e.calTotalAmtFields(e)},D.DisAutoTax=function(e){null==e.TDSAuto||null==e.TDSAuto||""===e.TDSAuto?e.TDSAutoDisable=!0:parseFloat(e.TDSAuto)>100?(e.TDSAuto=100,e.TDSAutoDisable=!1):e.TDSAutoDisable=!1},D.changeDisAmt=function(e,t){var a,i,r;a=null==e.entity.tds||null==e.entity.tds||""===e.entity.tds?0:parseFloat(e.entity.tds),null==e.entity.passedAmt||null==e.entity.passedAmt||""===e.entity.passedAmt?(i=0,e.entity.tds=i,a=0):i=parseFloat(e.entity.passedAmt),parseFloat(e.entity.tds)>parseFloat(e.entity.passedAmt)&&(a=e.entity.tds=parseFloat(e.entity.passedAmt)),(r=null==e.entity.discAmt||null==e.entity.discAmt||""===e.entity.discAmt?0:parseFloat(e.entity.discAmt))>parseFloat(e.entity.OUTSTANDING_AMT)-a&&(r=parseFloat(e.entity.OUTSTANDING_AMT)-a,e.entity.discAmt=r),i=e.entity.passedAmt=parseFloat(e.entity.OUTSTANDING_AMT)-r,e.entity.netAmt=parseFloat((i-a).toFixed(2)),D.deniedAmtCal(e,t)},D.deniedAmtCal=function(e,t){var a,i,r,n,l;null==e.entity.deniedAmt||null==e.entity.deniedAmt||""===e.entity.deniedAmt?i=0:(a=null!=e.entity.passedAmt&&null!=e.entity.passedAmt&&""!=e.entity.passedAmt?e.entity.passedAmt:0,r=null==e.entity.depAdjAmt||null==e.entity.depAdjAmt||""===e.entity.depAdjAmt?0:parseFloat(e.entity.depAdjAmt),n=null==e.entity.onAccDep||null==e.entity.onAccDep||""===e.entity.onAccDep?0:parseFloat(e.entity.onAccDep),l=null==e.entity.discAmt||null==e.entity.discAmt||""===e.entity.discAmt?0:parseFloat(e.entity.discAmt),i=parseFloat(e.entity.OUTSTANDING_AMT)-(parseFloat(a)+r+n+l)),e.entity.deniedAmt=i},D.passedAmtCal=function(e,t){var a,i,r,n,l;if(a=null==e.entity.tds||null==e.entity.tds||""===e.entity.tds?0:parseFloat(e.entity.tds),null==e.entity.passedAmt||null==e.entity.passedAmt||""===e.entity.passedAmt?(i=0,e.entity.tds=i,a=0):i=parseFloat(e.entity.passedAmt),l=null==e.entity.discAmt||null==e.entity.discAmt||""===e.entity.discAmt?0:parseFloat(e.entity.discAmt),parseFloat(e.entity.tds)>parseFloat(e.entity.passedAmt)&&(a=e.entity.tds=parseFloat(e.entity.passedAmt)),r=null==e.entity.depAdjAmt||null==e.entity.depAdjAmt||""===e.entity.depAdjAmt?0:parseFloat(e.entity.depAdjAmt),n=null==e.entity.onAccDep||null==e.entity.onAccDep||""===e.entity.onAccDep?0:parseFloat(e.entity.onAccDep),i+r+n+l>parseFloat(e.entity.OUTSTANDING_AMT)){i=i+r+n+l;var s="";s=0==r&&0==n?D.alertObj.pasdAmtCntGrtCorpAmt:D.alertObj.sumPasdAmtAdjAmtGrtDue;var o={buttonCallBack1:function(){e.entity.passedAmt=parseFloat(e.entity.OUTSTANDING_AMT)-(r+n+l),i=e.entity.passedAmt,e.entity.netAmt=parseFloat((i-a).toFixed(2)),e.entity.deniedAmt=0,D.deneidAmtTotal=0}};v.hisAlertMulti("information",D.alertObj.alertTypeInfo,s,D.alertData,o,D.buttonClose)}e.entity.netAmt=parseFloat((i-a).toFixed(2)),0==parseFloat(e.entity.SETTLED_AMT)&&parseFloat(e.entity.passedAmt)==parseFloat(e.entity.OUTSTANDING_AMT)&&D.calTapDscDep(e.entity,!0),D.deniedAmtCal(e,t)},D.EnableDeposit=function(e,t,a,i){var r=i+1;null!=D.prvoiusIndex&&(D.prvoiusIndex=D.prvoiusIndex,jQuery(".ui-grid-canvas>div:nth-child("+D.prvoiusIndex+")").removeClass("heighlightNewRecord")),D.prvoiusIndex=r,a.isSelected?(D.enableDepButton=!0,jQuery(".ui-grid-canvas>div:nth-child("+r+")").removeClass("heighlightNewRecord")):(jQuery(".ui-grid-canvas>div:nth-child("+r+")").addClass("heighlightNewRecord"),D.enableDepButton=!1,D.rowIndexV=i)},null!=l[0].INVOICE_NO){D.selectedInvoice=l,D.invoiceInfo=[],D.multipleDataForList={1:D.invoiceInfo};var f=r.executeQueryURLReset();D.invoiceInfoList=new Array,r.prepareParamListWithParam("pInvoiceHdSeqId",s[0].INVC_HD_SEQ_ID,D.invoiceInfoList),r.prepareParamListWithParam("pInvoiceDtSeqId",o,D.invoiceInfoList),r.executeQueryInput("SP_BL_INVOICE_002",D.invoiceInfoList,D.multipleDataForList,!0,!0,f,"popUp",D.stlmntGridOptions).then(function(e){for(var t=0;t<D.invoiceInfo.length;t++){D.invoiceInfo[t].payerName=D.invoiceInfo[t].RG_FIRST_NAME+" "+D.invoiceInfo[t].RG_MIDDLE_NAME+" "+D.invoiceInfo[t].RG_LAST_NAME;for(var a=0;a<D.selectedInvoice.length;a++)D.invoiceInfo[t].INVC_DT_SEQ_ID==D.selectedInvoice[a].INVC_DT_SEQ_ID&&(D.invoiceInfo[t].IP_NO=D.selectedInvoice[a].IP_NO,D.invoiceInfo[t].BILL_AMT=D.selectedInvoice[a].BILL_AMT);if(D.copAmt=D.copAmt+D.invoiceInfo[t].PAYER_AMOUNT,null==D.invoiceInfo[t].SETTLED_AMT&&(D.invoiceInfo[t].SETTLED_AMT=0),null!=D.invoiceInfo[t].SETTLED_AMT){var i=0;null!=D.invoiceInfo[t].TPA_DISCOUNT_AMT&&(i=Number(D.invoiceInfo[t].TPA_DISCOUNT_AMT));var n=0;null!=D.invoiceInfo[t].TAX_AMT&&(n=Number(D.invoiceInfo[t].TAX_AMT)),Number(D.invoiceInfo[t].SETTLED_AMT)>0?(D.invoiceInfo[t].OUTSTANDING_AMT=parseFloat((Number(D.invoiceInfo[t].PAYER_AMOUNT)-(Number(D.invoiceInfo[t].SETTLED_AMT)+i+n)).toFixed(2)),Number(D.invoiceInfo[t].OUTSTANDING_AMT)<0&&(D.invoiceInfo[t].OUTSTANDING_AMT=0)):(D.invoiceInfo[t].OUTSTANDING_AMT=parseFloat((Number(D.invoiceInfo[t].PAYER_AMOUNT)-Number(D.invoiceInfo[t].SETTLED_AMT)).toFixed(2)),Number(D.invoiceInfo[t].OUTSTANDING_AMT)<0&&(D.invoiceInfo[t].OUTSTANDING_AMT=0))}else D.invoiceInfo[t].OUTSTANDING_AMT=0;D.stldAmt=D.stldAmt+D.invoiceInfo[t].SETTLED_AMT,D.copAmtDue=parseFloat((D.copAmtDue+D.invoiceInfo[t].OUTSTANDING_AMT).toFixed(2)),D.invoiceInfo[t].passedAmt=0,D.invoiceInfo[t].discAmt=0,D.invoiceInfo[t].tds=0,D.invoiceInfo[t].netAmt=0,D.invoiceInfo[t].depAdjAmt=0,D.invoiceInfo[t].onAccDep=0}D.stlmntGridOptions.data=[],D.stlmntGridOptions.data=D.invoiceInfo,D.selectedRow={},D.stlmntGridOptions.isRowSelectable=function(e){return D.selectedRow=e.entity,!(null!=e.entity.SETTLED_AMT&&parseFloat(e.entity.SETTLED_AMT)>0)},D.grid.core.notifyDataChange(d.dataChange.OPTIONS),D.cmpnyBanr=[],D.onAccDep=[],D.multipleComboDataForList={1:D.cmpnyBanr,2:D.onAccDep};var l=r.executeQueryURLReset();D.cmpnyBanrList=new Array,r.prepareParamListWithParam("pCompSeqId",D.invoiceInfo[0].COMPANY_SEQ_ID,D.cmpnyBanrList),r.prepareParamListWithParam("pCompSeqId",D.invoiceInfo[0].COMPANY_SEQ_ID,D.cmpnyBanrList),r.prepareParamListWithParam("pPayerAccSeqId",-999,D.cmpnyBanrList),r.prepareParamListWithParam("pPayerAccSeqId",-999,D.cmpnyBanrList),r.executeQueryInput("ON_ACC_DESP_COMPANY_BANNER_NEW_001",D.cmpnyBanrList,D.multipleComboDataForList,!0,!1,l,"popUp",D.stlmntGridOptions),D.onAccDepList=new Array,r.prepareParamListWithParam("pCompSeqId",D.invoiceInfo[0].COMPANY_SEQ_ID,D.onAccDepList),r.prepareParamListWithParam("pCompSeqId",D.invoiceInfo[0].COMPANY_SEQ_ID,D.onAccDepList),r.prepareParamListWithParam("pOnAccDepositNo","",D.onAccDepList),r.prepareParamListWithParam("pOnAccDepositNo","",D.onAccDepList),r.executeQueryInput("BL_INV_ONACCT_LIST",D.onAccDepList,D.multipleComboDataForList,!0,!0,l,"popUp",D.stlmntGridOptions)})}D.addDenialReason=function(e,t){t=t;D.dnlReason=a.open("Reason for Denial",{templateUrl:"app/consumer/his17_1/billing/screens/companySettlements/sections/invoice.settlement.denialreason.html",size:"sm",scope:n,controller:function(){}}),n.denialReason=e.denialReason,D.dnlReason.result.then(function(e){D.stlmntGridOptions.data[t].denialReason=e})},n.addDnlReason=function(e){D.dnlReason.close(e)},D.openAccDep=function(e){for(var t=D.stlmntGridOptions.data[D.rowIndexV].adjAccObj,i=[],r=[],n=!1,l=0,s=0;s<D.stlmntGridOptions.data.length;s++)if(null!=D.stlmntGridOptions.data[s].adjAccObj&&D.stlmntGridOptions.data[s].adjAccObj.length>0){for(var o=0;o<D.stlmntGridOptions.data[s].adjAccObj.length;o++)l==D.stlmntGridOptions.data[s].adjAccObj.length-1?n=!0:(l=o,r.push(D.stlmntGridOptions.data[s].adjAccObj[o]),r[o].temBal=angular.copy(parseFloat(D.stlmntGridOptions.data[D.accIndex].adjAccObj[o].preAdjTotal)),i=angular.copy(r));if(i.length>0&&n)for(var c=0;c<i.length;c++)null!=i[c].preAdjTotal&&null!=i[c].preAdjTotal&&(i[c].preAdjTotal=angular.copy(parseFloat(D.stlmntGridOptions.data[D.accIndex].adjAccObj[c].preAdjTotal)),null!=D.accIndex&&D.accIndex!=D.rowIndexV&&(i[c].temBal=angular.copy(parseFloat(D.stlmntGridOptions.data[D.accIndex].adjAccObj[c].preAdjTotal))),null!=t&&null!=t[c].adjAmt&&(i[c].adjAmt=angular.copy(parseFloat(t[c].adjAmt))))}if(i.length>0)for(var d=0;d<D.onAccDep.length;d++)D.onAccDep[d].preAdjTotal=angular.copy(i[d].preAdjTotal),D.onAccDep[d].remBal=angular.copy(i[d].remBal),null!=t&&null!=t[d]&&null!=t[d].adjAmt&&null!=t[d].adjAmt?D.onAccDep[d].adjAmt=angular.copy(parseFloat(t[d].adjAmt)):D.onAccDep[d].adjAmt=0,D.onAccDep[d].temBal=angular.copy(i[d].temBal);D.alertObj.headerOnAccDepAdj;a.open("On A/C Deposit Adjustments",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/companySettlements/sections/invoice.settlement.accDeposit.modal.html",size:e,controller:"invoiceStmntAccDepCtrl",controllerAs:"accDep",resolve:{onAccDepData:function(){return D.onAccDep},indexV:function(){return D.rowIndexV},flagDep:function(){return!0},invoiceData:function(){return D.stlmntGridOptions.data[D.rowIndexV]}}}).result.then(function(e){D.accIndex=angular.copy(e.index),D.accDepGridData=angular.copy(e.accGridData),D.stlmntGridOptions.data[e.index].onAccDep=angular.copy(e.adjAmt),D.stlmntGridOptions.data[e.index].adjAccObj=angular.copy(e.accGridData),D.stlmntGridOptions.data[e.index].accFlag=!0,null!=D.stlmntGridOptions.data[e.index].deniedAmt&&null!=D.stlmntGridOptions.data[e.index].onAccDep&&(parseFloat(D.stlmntGridOptions.data[e.index].deniedAmt)>=parseFloat(D.stlmntGridOptions.data[e.index].onAccDep)?D.stlmntGridOptions.data[e.index].deniedAmt=parseFloat(D.stlmntGridOptions.data[e.index].deniedAmt)-parseFloat(D.stlmntGridOptions.data[e.index].onAccDep):D.stlmntGridOptions.data[e.index].deniedAmt=0),D.calTotalAmtFields(D)})},D.openPatDep=function(e){D.depositData=[],D.multipleDepDataForList={1:D.depositData};var t=r.executeQueryURLReset();D.depositDataList=new Array,r.prepareParamListWithParam("pAccSeqId",D.stlmntGridOptions.data[D.rowIndexV].ACC_SEQ_ID,D.depositDataList),r.executeQueryInput("BL_INV_DEP_ADJ_LIST",D.depositDataList,D.multipleDepDataForList,!0,!0,t,"popUp",D.stlmntGridOptions).then(function(t){for(var i=0;i<D.depositData.length;i++)D.depositData[i].BILL_SEQ_ID=D.invoiceInfo[D.rowIndexV].BILL_SEQ_ID;var r=D.stlmntGridOptions.data[D.rowIndexV].adjObj,n=[],l=[];for(i=0;i<D.depositData.length;i++){if(null!=D.getIndex)for(var s=0;s<D.stlmntGridOptions.data[D.getIndex].adjObj.length;s++)null!=D.depositData[i].DEPOSIT_SEQ_ID&&D.depositData[i].DEPOSIT_SEQ_ID==D.stlmntGridOptions.data[D.getIndex].adjObj[s].DEPOSIT_SEQ_ID&&(l.push(D.stlmntGridOptions.data[D.getIndex].adjObj[s]),l[s].temBal=angular.copy(parseFloat(D.stlmntGridOptions.data[D.getIndex].adjObj[s].preAdjTotal)),n=angular.copy(l));else for(var o=0;o<D.stlmntGridOptions.data.length;o++)if(null!=D.stlmntGridOptions.data[o].adjObj)for(var c=0;c<D.stlmntGridOptions.data[o].adjObj.length;c++){if(null!=D.depositData[i].DEPOSIT_SEQ_ID&&D.depositData[i].DEPOSIT_SEQ_ID==D.stlmntGridOptions.data[D.rowIndexV].adjObj[c].DEPOSIT_SEQ_ID)l.push(D.stlmntGridOptions.data[D.rowIndexV].adjObj[c]),l[l.length-1].temBal=angular.copy(parseFloat(D.stlmntGridOptions.data[D.rowIndexV].adjObj[c].preAdjTotal)),n=angular.copy(l)}if(n.length==D.depositData.length){!0;break}if(i==D.depositData.length-1){for(o=0;o<D.stlmntGridOptions.data.length;o++)if(null!=D.stlmntGridOptions.data[o].adjObj)for(c=0;c<D.stlmntGridOptions.data[o].adjObj.length;c++)if(i=c,null!=D.depositData[i].DEPOSIT_SEQ_ID&&D.depositData[i].DEPOSIT_SEQ_ID==D.stlmntGridOptions.data[o].adjObj[c].DEPOSIT_SEQ_ID){if(D.depositData.length==l.length)l[i].preAdjTotal=angular.copy(parseFloat(D.stlmntGridOptions.data[o].adjObj[c].preAdjTotal));else l.push(D.stlmntGridOptions.data[o].adjObj[c]),l[l.length-1].temBal=angular.copy(parseFloat(D.stlmntGridOptions.data[o].adjObj[c].preAdjTotal));n=angular.copy(l),i==D.depositData.length-1&&(D.flagBreak=!0)}if(1==D.flagBreak){!0;break}}}if(n.length>0)for(var d=0;d<D.depositData.length;d++)D.depositData[d].preAdjTotal=angular.copy(n[d].preAdjTotal),D.depositData[d].remBal=angular.copy(n[d].remBal),null!=r&&null!=r[d]&&null!=r[d].adjAmt&&null!=r[d].adjAmt?D.depositData[d].adjAmt=angular.copy(parseFloat(r[d].adjAmt)):D.depositData[d].adjAmt=0,D.depositData[d].temBal=angular.copy(n[d].preAdjTotal);var p=D.alertObj.headerPatDepAdj;a.open(p,{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/companySettlements/sections/invoice.settlement.accDeposit.modal.html",size:e,controller:"invoiceStmntAccDepCtrl",controllerAs:"accDep",resolve:{onAccDepData:function(){return D.depositData},indexV:function(){return D.rowIndexV},flagDep:function(){return!1},invoiceData:function(){return D.stlmntGridOptions.data[D.rowIndexV]}}}).result.then(function(e){D.getIndex=angular.copy(parseFloat(e.index)),D.stlmntGridOptions.data[e.index].depAdjAmt=angular.copy(e.adjAmt),D.stlmntGridOptions.data[e.index].adjObj=angular.copy(e.accGridData),D.stlmntGridOptions.data[e.index].patDepFlag=!0,null!=D.stlmntGridOptions.data[e.index].deniedAmt&&null!=D.stlmntGridOptions.data[e.index].depAdjAmt&&(parseFloat(D.stlmntGridOptions.data[e.index].deniedAmt)>=parseFloat(D.stlmntGridOptions.data[e.index].depAdjAmt)?D.stlmntGridOptions.data[e.index].deniedAmt=parseFloat(D.stlmntGridOptions.data[e.index].deniedAmt)-parseFloat(D.stlmntGridOptions.data[e.index].depAdjAmt):D.stlmntGridOptions.data[e.index].deniedAmt=0),D.calTotalAmtFields(D)})})},D.saveCmpnyStl=function(e){for(var a=!1,i=0;i<e.stlmntGridOptions.data.length;i++){if(e.stlmntGridOptions.data[i].deniedAmt&&e.stlmntGridOptions.data[i].deniedAmt>0&&!e.stlmntGridOptions.data[i].denialReason)return void v.information("Information","Denied Reason is Required");if(null!=e.stlmntGridOptions.data[i].depAdjAmt&&null!=e.stlmntGridOptions.data[i].depAdjAmt&&parseFloat(e.stlmntGridOptions.data[i].depAdjAmt)>0||null!=e.stlmntGridOptions.data[i].onAccDep&&null!=e.stlmntGridOptions.data[i].onAccDep&&parseFloat(e.stlmntGridOptions.data[i].onAccDep)>0||null!=e.stlmntGridOptions.data[i].netAmt&&null!=e.stlmntGridOptions.data[i].netAmt&&parseFloat(e.stlmntGridOptions.data[i].netAmt)>0){a=!0;break}i==e.stlmntGridOptions.data.length-1&&(a=!1)}if(a)c.saveCmpnyStlService(e).then(function(a){if(null!=a.data.HITService.message.invoiceSetlHdSeqId){var i={buttonText:e.alertObj.ok},r={buttonCallBack1:function(){t.close(!0)}},n={buttonClose:function(){t.close(!0)}},l=e.alertObj.savdSucesFuly;v.hisAlertMulti("success",e.alertObj.alertTypeSucss,l,i,r,n)}});else{var r=e.alertObj.plzEntAtlRcrdData;v.hisAlertMulti("information",e.alertObj.alertTypeInfo,r,e.alertData,e.alertFunction,e.buttonClose)}},D.checkQueryService=function(e,t){n.cancelChk=[],n.concsChk=[],n.writeOffChk=[],D.multipleChkDataForList={1:n.cancelChk,2:n.concsChk,3:n.writeOffChk};var a=r.executeQueryURLReset();return D.chkParamList=new Array,r.prepareParamListWithParam("pBillSeqId",e,D.chkParamList),r.executeQueryInput("BL_CANCEL_CHK",D.chkParamList,D.multipleChkDataForList,!0,!1,a,"popUp",n.billWorkGridOptions),t?t?(r.executeQueryInput("BL_CONCS_DUP_CHK1",D.chkParamList,D.multipleChkDataForList,!0,!1,a,"popUp",n.billWorkGridOptions),r.executeQueryInput("WRITEOFF_CHK",D.chkParamList,D.multipleChkDataForList,!0,!0,a,"popUp",n.billWorkGridOptions).then(function(e){return(e instanceof Array?e:[e]).map(function(e){return e})})):void 0:r.executeQueryInput("BL_CONCS_DUP_CHK1",D.chkParamList,D.multipleChkDataForList,!0,!0,a,"popUp",n.billWorkGridOptions).then(function(e){return(e instanceof Array?e:[e]).map(function(e){return e})})},D.printBill=function(e){n.selectBill=new Array,n.selectBill[0]=e;var t=n.selectBill[0].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"];let a="N";if(t instanceof Array){for(let e=0;e<t.length;e++)if(4!=t[e].payerType){a="Y";break}}else 4!=t.payerType&&(a="Y");var i={billSeqId:n.selectBill[0].billSeqId,pFlagComp:a,splitStaus:n.selectBill[0].splitStaus,BillPayerSeqId:t instanceof Array?t[t.length-1].billPayerSeqId:t.billPayerSeqId,splitBillReportId:"BILL_SPLIT_REPORT"};2==n.selectBill[0].billType?0==n.selectBill[0].billNo.indexOf("OPCS")||n.selectBill[0].billRefId.indexOf("OPCS")?i.reportId="OutPatient_CashBillGeneratedReports_ReportId":0==n.selectBill[0].billNo.indexOf("OPCR")?i.reportId="OutPatient_CreditBillGeneratedReports_ReportId":i.reportId="OutPatientConsultationBillReport":0==n.selectBill[0].billNo.indexOf("IPCS")||n.selectBill[0].billRefId.indexOf("IPCS")?i.reportId="BillingInPatientFinalBillReceiptReport":0==n.selectBill[0].billNo.indexOf("IPCR")&&(i.reportId="BillingInPatientFinalCrBillReceiptReport"),g.printReportModal("PrintTypeSelection","sm").then(function(e){g.printReportModal("printBillWorkList","lg",e,i)})},D.viewBillPopUp=function(e,t,i){a.open("Payer Bill View",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/billingWorkList/cancel/cancel.screen.html",size:"lg",controller:"cancelController",keyboard:!1,backdrop:"static",resolve:{billSelectedData:function(){return i},flag:function(){return e},serviceData:function(){return t[1]}}}).result.then(function(e){e&&(n.searchResult(n.billWorkSrch,!1),n.billCnclD=!1,n.billConcss=!1,n.billWrite=!1,n.billAuth=!1,n.billRefund=!1,n.billInovice=!1,n.billPayment=!1,n.billSplit=!1)})},D.viewBillDetails=function(e){D.billSeqId=D.invoiceInfo[0].BILL_SEQ_ID,D.checkQueryService(D.billSeqId,!1).then(function(t){n.serviceData=[],n.singleComboDataForList={1:n.serviceData};var a=r.executeQueryURLReset();n.serviceDataList=new Array,n.BillInformation={},n.BillInformation.frmDate="1970-02-14",n.BillInformation.toDate=new Date,n.BillInformation.billNo=D.selectedRow.BILL_NO,n.billWorkGridOptions={},n.billWorkGridOptions.data=new Array,m.getBillWorkList(n.BillInformation).then(function(t){if(null==t.data.HITService.message||null==t.data.HITService.message[0]||""==t.data.HITService.message[0]||null==t.data.HITService.message[0]){D.alertData.noRcrdFound;0}else{var i=t.data.HITService.message[0]["com.napier.core.billgeneration.vo.Bill"];n.billWorkGridOptions.data[0]=i,r.prepareParamListWithParam("pBillSeqId",D.billSeqId,n.serviceDataList),r.prepareParamListWithParam("pFlag","Y",n.serviceDataList),r.executeQueryInput("BL_BILL_SERVICE_DTLS",n.serviceDataList,n.singleComboDataForList,!0,!0,a,"popUp",n.billWorkGridOptions).then(function(t){if(null!=t[1]&&null!=t[1]&&""!=t[1]&&t[1]instanceof Array){D.alertData.headerViewBill,"billDetails"==e?D.viewBillPopUp(!1,t,n.billWorkGridOptions.data):"billPrint"==e&&D.printBill(i)}else{var a=D.alertData.NoDataAvlble;v.hisAlertMulti("information",D.alertData.alertTypeInfo,a,n.alertData,n.alertFunction,n.closefun)}})}})})}}e.$inject=["cmpnyStlGridDefinition","$uibModalInstance","hisModalService","hisTranslationsService","QueryService","$scope","selectedInvoice","hdSeqId","pInvDtSeqIds","cmpnyService","uiGridConstants","hisTranslationsGlobalLang","hisGenericAlertService","GetBillWorkListData","PrintService","invStlService","hisAlertService"],angular.module("napierContainerUi").controller("invoiceStmntCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c){var d=this;a.loadModule("billing");var p=n.getLanguageToSet();a.changeLanguage(p),d.alertObj={},l.loadAlerts(p).then(function(e){d.alertObj=e,d.alertData={buttonText:d.alertObj.ok},d.alertFunction={buttonCallBack1:function(){}},d.buttonClose={buttonClose:function(){}}}),d.popup1={opened:!1},d.format=t.dateOnly.format,d.open1=function(){d.popup1.opened=!0},d.fromDateOptions={maxDate:new Date,startingDay:1},d.openQueryGroup=!0,d.selectRecordDetls=s[0],d.capturedBy=angular.fromJson(sessionStorage.userContextObj).LOGIN_NAME,d.capturedDate=new Date,d.receivedModeList=[],d.multipleComboDataForList={1:d.receivedModeList};var u=i.executeQueryURLReset();d.receivedModeListArr=new Array,i.prepareParamList(1,"700800",d.receivedModeListArr),i.executeQueryInput("TRN003",d.receivedModeListArr,d.multipleComboDataForList,!0,!0,u,"popUp",{}),d.getQueryData=function(){d.queryDataList=[],d.multipleQueryDataForList={1:d.queryDataList};var e=i.executeQueryURLReset();d.queryDataListArr=new Array,i.prepareParamListWithParam("pInvoiceHdSeqId",d.selectRecordDetls.INVC_HD_SEQ_ID,d.queryDataListArr),i.executeQueryInput("GET_PAYER_QUERY_ON_INVOICE",d.queryDataListArr,d.multipleQueryDataForList,!0,!0,e,"popUp",{})},d.getQueryResponseData=function(e,t){d.queryResponseDataList=[],d.multipleQueryDataRForList={1:d.queryResponseDataList};var a=i.executeQueryURLReset();d.queryDataRListArr=new Array,i.prepareParamListWithParam("pQueryHeaderSeqId",e.PQH_SEQ_ID,d.queryDataRListArr),i.executeQueryInput("GET_PAYER_QUERY_RESPONSE_ON_INVOICE",d.queryDataRListArr,d.multipleQueryDataRForList,!0,!0,a,"popUp",{}).then(function(a){e.queryResponseDataList=[],e.queryResponseDataList=d.queryResponseDataList,null!=t&&(d.queryDataList[t].queryResponseDataList=[],d.queryDataList[t].queryResponseDataList=d.queryResponseDataList)})},d.getQueryData(),d.editQuery=function(e){d.updateValidtion()||(d.clear(),d.updateFlag=!0,d.queryData=e.QUERY,d.queryNumber=e.QUERY_NO,d.receivedDateTime=new Date(e.RECIVED_DATE_TIME),d.receivedMode=i.getObjectByAnyValue(d.receivedModeList,e.RECEIVED_MODE,"DT_CODE"),d.capturedBy=e.QUERY_CATURED_BY_DESC,d.capturedDate=e.QUERY_DATE_TIME,d.PQH_SEQ_ID=e.PQH_SEQ_ID,d.openQueryGroup=!0)},d.editQueryResponse=function(e,t,a){d.updateValidtion()||(d.clear(),d.updateFlagResponse=!0,d.responseNumber=e.RESPONSE_NO,d.itemData=t,d.queryDataShow=t.QUERY,d.queryResponse=e.RESPONSE,d.capturedByResponse=e.RESPONSE_CATURED_BY_DESC,d.capturedByResponseCode=e.RESPONSE_CATURED_BY,d.capturedDateResponse=new Date(e.RESPONSE_DATE_TIME),d.responseMode=i.getObjectByAnyValue(d.receivedModeList,e.RESPONSE_DELIVERY_MODE,"DT_CODE"),d.PQH_SEQ_ID=t.PQH_SEQ_ID,d.PQR_SEQ_ID=e.PQR_SEQ_ID,d.indexNo=a,d.openQueryGroup=!0)},d.addQueryResponse=function(e,t){d.updateValidtion()||(d.clear(),d.addResponse=!0,d.itemData=e,d.indexNo=t,d.queryDataShow=e.QUERY,d.capturedByResponse=angular.fromJson(sessionStorage.userContextObj).LOGIN_NAME,d.capturedDateResponse=new Date,d.PQH_SEQ_ID=e.PQH_SEQ_ID,d.openQueryGroup=!0)},d.updateValidtion=function(){if(d.updateFlag||d.updateFlagResponse){var t=d.alertObj.plzUpdteRcrd;return e.hisAlertMulti("information",d.alertObj.alertTypeInfo,t,d.alertData,d.alertFunction,d.buttonClose),!0}return!1},d.clear=function(){d.updateFlagResponse=!1,d.addResponse=!1,d.updateFlag=!1,d.queryData=void 0,d.queryNumber=void 0,d.receivedDateTime=void 0,d.receivedMode="",d.capturedBy=angular.fromJson(sessionStorage.userContextObj).LOGIN_NAME,d.capturedDate=new Date,d.PQH_SEQ_ID=void 0,d.PQR_SEQ_ID=void 0,d.responseNumber=void 0,d.itemData={},d.queryDataShow=void 0,d.queryResponse=void 0,d.capturedByResponse=void 0,d.capturedByResponseCode=void 0,d.capturedDateResponse=new Date,d.responseMode="",d.indexNo=void 0},d.savePayerQuery=function(){if(null!=d.queryData&&""!=d.queryData&&null!=d.receivedMode&&null!=d.receivedMode.DT_CODE&&null!=d.receivedDateTime&&""!=d.receivedDateTime){var t={};t.url=c.HISIPINDENT.URL,t.requestData={operation:"savePayerQuery",messageId:"",destination:"com.napier.core.invoicesettlement.service.external.InvoiceService",message:{"@class":"com.napier.core.invoicesettlement.vo.PayerQueryHeader",query:d.queryData,companySeqId:d.selectRecordDetls.COMPANY_SEQ_ID,invoiceHdSeqId:d.selectRecordDetls.INVC_HD_SEQ_ID,payerQuerySeqId:d.PQH_SEQ_ID,receivedMode:null!=d.receivedMode?d.receivedMode.DT_CODE:1,receivedDateTime:r("date")(new Date(d.receivedDateTime),"yyyy-MM-dd hh:mm:ss.s"),queryCapturedByDateTime:r("date")(new Date(d.capturedDate),"yyyy-MM-dd hh:mm:ss.s"),queryNumber:null==d.PQH_SEQ_ID?d.queryDataList.length+1:parseInt(d.queryNumber)}},o.sendRestRequest(t).then(function(t){if(null!=t.data.HITService.message&&null!=t.data.HITService.message.payerQuerySeqId){d.openQueryPrev=!0,d.buttonCloseQuery={buttonClose:function(){d.clear(),d.getQueryData()}};var a=d.updateFlag?d.alertObj.queryUpdatedSuccessfully:d.alertObj.querySavedSuccessfully;e.hisAlertMulti("success",d.alertObj.alertTypeSucss,a,!1,!1,d.buttonCloseQuery,2e3)}})}else{var a=d.alertObj.plzFilMandFild;e.hisAlertMulti("information",d.alertObj.alertTypeInfo,a,d.alertData,d.alertFunction,d.buttonClose)}},d.savePayerQueryResponse=function(){if(null!=d.queryResponse&&""!=d.queryResponse&&null!=d.responseMode&&null!=d.responseMode.DT_CODE){var t={};t.url=c.HISIPINDENT.URL,t.requestData={operation:"savePayerQueryResponse",messageId:"",destination:"com.napier.core.invoicesettlement.service.external.InvoiceService",message:{"@class":"com.napier.core.invoicesettlement.vo.PayerQueryResponses",response:d.queryResponse,payerQueryResponseSeqId:d.PQR_SEQ_ID,payerQuerySeqId:d.PQH_SEQ_ID,responseDeliveryMode:null!=d.responseMode?d.responseMode.DT_CODE:1,responseDateTime:r("date")(new Date(d.capturedDateResponse),"yyyy-MM-dd hh:mm:ss.s"),responseNumber:null==d.PQR_SEQ_ID?d.queryResponseDataList.length+1:parseInt(d.responseNumber),responseCapturedBy:null==d.PQR_SEQ_ID?void 0:d.RESPONSE_CATURED_BY}},o.sendRestRequest(t).then(function(t){if(null!=t.data.HITService.message&&null!=t.data.HITService.message.payerQueryResponseSeqId){d.openQueryPrev=!0,d.buttonCloseQuery={buttonClose:function(){d.getQueryResponseData(d.itemData,d.indexNo),d.getQueryData(),d.clear()}};var a=d.updateFlagResponse?d.alertObj.responseUpdatedSuccessfully:d.alertObj.responseAddedSuccessfully;e.hisAlertMulti("success",d.alertObj.alertTypeSucss,a,!1,!1,d.buttonCloseQuery,2e3)}})}else{var a=d.alertObj.plzFilMandFild;e.hisAlertMulti("information",d.alertObj.alertTypeInfo,a,d.alertData,d.alertFunction,d.buttonClose)}}}e.$inject=["hisAlertService","hisCalDefConstant","hisTranslationsService","QueryService","$filter","hisTranslationsGlobalLang","hisGenericAlertService","selectInvoice","CallManager","BILLING_APIS"],angular.module("napierContainerUi").controller("payerQueryCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C,I){o.loadModule("billing");var A=c.getLanguageToSet();o.changeLanguage(A),i.concessionTypeOptions=angular.copy(r),i.concessionTypeApproversRolesOptions=angular.copy(n),i.concessionTypeCreateNew1Options=angular.copy(t),i.concessionTypeCreateNew2Options=angular.copy(e),i.Hideservices=!0,i.Hideapply=!0,i.update=!1,i.isSave=!0,i.isUpdatedis=!1,i.updateData=[],i.editmodeCheckAll=!1,i.obj={};f.getTaskPermissionDetails("T_CONCESSION_MASTER").then(function(e){i.roleValue=e}),i.openNewScreen=function(e){i.obj.concessType="",i.obj.concessdescription="",i.obj.Status1=1,i.obj.ApplicableStatus=1,i.isUpdatedis=!1,i.isSave=!0,i.update=!1,i.ApplicableStatuschange(1),i.obj.maxlmt="",i.Hideapply=!0,e||i.ApprlRoles(),i.obj.searchValue="",i.concessionTypeCreateNew1Options.data="",i.concessionTypeCreateNew2Options.data="",i.obj.primaryType="",i.obj.secondaryType="";l.open("Concession Type",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/concessionType/sections/create.new.html",size:"lg",scope:i});i.selectedDataapprl=[]},i.ApplicableStatuschange=function(e){i.Hideservices=1==e},i.percentValidation=function(e){e.amtrpr=parseInt(e.amtrpr),1==e.amtrpr&&e.maxlmt>100&&(e.maxlmt=100)},i.appFilter=function(e){i.concessionTypeCreateNew2Options.data.filter(function(t){t.CONC_AMOUNT=e.maxlmt})},i.validatemaxlmt=function(e){e.entity.Maxlmt=parseInt(e.entity.Maxlmt),1==i.obj.amtrpr&&e.entity.Maxlmt>100&&(e.entity.Maxlmt="")},i.validatemaxlmtgrid=function(e){e.entity.CONC_AMOUNT=parseInt(e.entity.CONC_AMOUNT),isNaN(e.entity.CONC_AMOUNT)?p.warning("Warning","Enter Valid Data",!1,!1,D.time):1==i.obj.amtrpr&&(e.entity.CONC_AMOUNT=parseInt(e.entity.CONC_AMOUNT),e.entity.CONC_AMOUNT>100&&(e.entity.CONC_AMOUNT=100,p.warning("Warning","You can't enter a number grater than 100",!1,!1,D.time)))},i.validateMaxLimit=function(e){e.amtrpr=parseInt(e.amtrpr),1==e.amtrpr&&(e.maxlmt=parseInt(e.maxlmt),e.maxlmt=parseInt(e.maxlmt),e.maxlmt>100&&(p.warning("Warning","You can't enter a number grater than 100",!1,!1,D.time),i.obj.maxlmt=""))},i.listData=function(){null==i.concessiondescType&&(i.concessiondescType=""),i.concessionTypeOptions.data=[],i.gridListextsources=[],i.concessionType=[];var e={1:i.concessionType},t=""==i.concessiondescType?i.concessiondescType:"%"+i.concessiondescType+"%",a=i.status;3!=a&&null!=a||(a=-999);var r=S.executeQueryURLReset();i.concessionType=new Array,S.prepareParamListWithParam("pConcdesc",t,i.concessionType),S.prepareParamListWithParam("pStatus",a,i.concessionType),S.prepareParamListWithParam("pConcessionType",-999,i.concessionType),S.executeQueryInput("CONCESS_MASTER_001",i.concessionType,e,!0,!0,r,"popUp",i.concessionTypeOptions,{}).then(function(e){e[1].length>0&&(i.concessionTypeOptions.data=e[1])})},i.ApprlRoles=function(){i.concessionTypeApproversRolesOptions.data=[],i.ApprlRolesType=[];var e={1:i.ApprlRolesType},t=S.executeQueryURLReset();i.concessionType=new Array,S.prepareParamListWithParam("pPracticeId","Napier123",i.concessionType),S.executeQueryInput("CONCESS_MASTER_003",i.concessionType,e,!0,!0,t,"popUp",i.concessionTypeApproversRolesOptions,{}).then(function(e){e[1].length>0&&(i.concessionTypeApproversRolesOptions.data=e[1])})},i.getPrimaryservice=function(){i.primaryServices=[];var e={1:i.primaryServices},t=S.executeQueryURLReset();i.primaryserviceType=new Array,S.prepareParamListWithParam("pPracticeId","Napier123",i.primaryserviceType),S.executeQueryInput("SCM_SERV_001",i.primaryserviceType,e,!0,!0,t,"popUp",{}).then(function(e){e[1].length>0&&(i.primaryServices=e[1])})},i.getSecondaryservice=function(e){i.secondaryServices=[];var t={1:i.secondaryServices},a=S.executeQueryURLReset();i.secondaryServiceType=new Array,S.prepareParamListWithParam("pPracticeId","Napier123",i.secondaryServiceType),S.prepareParamListWithParam("pPriServTypeCode",e,i.secondaryServiceType),S.executeQueryInput("SCM_SERV_002",i.secondaryServiceType,t,!0,!0,a,"popUp",{}).then(function(e){e[1].length>0&&(i.secondaryServices=e[1])})},i.getSecondaryservice(),i.getServices=function(e){i.concessionTypeCreateNew1Options.data=[],i.concessionTypeCreateNew2Options.data=[],i.tempConcessionTypeCreateNew1=[],i.Hideapply=!1,i.service=[];var t={1:i.service},a=null==e.primaryType?-999:e.primaryType,r=null==e.secondaryType?-999:e.secondaryType,n=S.executeQueryURLReset();i.serviceType=new Array,S.prepareParamListWithParam("pPracticeId","Napier123",i.serviceType),S.prepareParamListWithParam("pFacilityId",1,i.serviceType),S.prepareParamListWithParam("pServCode","",i.serviceType),S.prepareParamListWithParam("pServName","",i.serviceType),S.prepareParamListWithParam("pPriServTypeCode",a,i.serviceType),S.prepareParamListWithParam("pSecServTypeCode",r,i.serviceType),S.prepareParamListWithParam("pServTypeCode",-999,i.serviceType),S.executeQueryInput("BL_SCM_SERVICE_LIST",i.serviceType,t,!0,!0,n,"popUp",{}).then(function(e){e[1].length>0&&(i.concessionTypeCreateNew1Options.data=e[1],i.tempConcessionTypeCreateNew1=i.concessionTypeCreateNew1Options.data)})},i.listData(),i.ApprlRoles(),i.getPrimaryservice(),i.filterLeftGrid=function(e){i.concessionTypeCreateNew1Options.data=I("filter")(i.tempConcessionTypeCreateNew1,e)},i.ClearData=function(){i.concessiondescType="",i.status=3,i.listData()},i.clearDataPopup=function(){i.obj.concessType="",i.obj.concessdescription="",i.ApprlRoles(),i.obj.ApplicableStatus=1,i.obj.maxlmt="",i.obj.searchValue="",i.concessionTypeCreateNew2Options.data="",i.concessionTypeCreateNew1Options.data="",i.obj.primaryType="",i.obj.secondaryType="",i.isUpdatedis=!1},i.approvalRolesselect=function(e){i.selectedarrovalDataRoles=[],e.editmode?i.selectedarrovalDataRoles=e:(e.editmode=!1,i.editmodeCheckAll=!1)},i.approvalRolesselectAll=function(e){e?i.concessionTypeApproversRolesOptions.data.filter(function(e){e.editmode=!0}):i.concessionTypeApproversRolesOptions.data.filter(function(e){e.editmode=!1})},i.concessionTypeCreateNew1Options.onRegisterApi=function(e){i.servicegrid1=e,e.selection.on.rowSelectionChanged(i,function(t){i.selectedDataList1=e.selection.getSelectedRows()}),e.selection.on.rowSelectionChangedBatch(i,function(t){i.selectedDataList1=e.selection.getSelectedRows()})},i.concessionTypeCreateNew2Options.onRegisterApi=function(e){i.servicegrid1=e,e.selection.on.rowSelectionChanged(i,function(t){i.selectedDataList2=e.selection.getSelectedRows()}),e.selection.on.rowSelectionChangedBatch(i,function(t){i.selectedDataList2=e.selection.getSelectedRows()})},i.MoveToRight=function(){if(0==i.selectedDataList1.length)p.warning("Warning","Service Not Selected",!1,!1,D.time);else{for(var e=0;e<i.selectedDataList1.length;e++){-1==i.concessionTypeCreateNew2Options.data.map(function(e){return e.SERV_SEQ_ID}).indexOf(i.selectedDataList1[e].SERV_SEQ_ID)&&i.concessionTypeCreateNew2Options.data.push(i.selectedDataList1[e]);for(var t=0;t<i.concessionTypeCreateNew1Options.data.length;t++)if(i.selectedDataList1[e].SERV_SEQ_ID==i.concessionTypeCreateNew1Options.data[t].SERV_SEQ_ID){i.concessionTypeCreateNew1Options.data.splice(t,1);break}}i.servicegrid1.selection.clearSelectedRows(),i.selectedDataList1=[]}},i.MoveToLeft=function(){if(0==i.selectedDataList2.length)p.warning("Warning","Service Not Selected",!1,!1,D.time);else{for(var e=0;e<i.selectedDataList2.length;e++){-1==i.concessionTypeCreateNew1Options.data.map(function(e){return e.SERV_SEQ_ID}).indexOf(i.selectedDataList2[e].SERV_SEQ_ID)&&i.concessionTypeCreateNew1Options.data.push(i.selectedDataList2[e]);for(var t=0;t<i.concessionTypeCreateNew2Options.data.length;t++)if(i.selectedDataList2[e].SERV_SEQ_ID==i.concessionTypeCreateNew2Options.data[t].SERV_SEQ_ID){i.concessionTypeCreateNew2Options.data.splice(t,1);break}}i.servicegrid2.selection.clearSelectedRows(),i.selectedDataList2=[]}},i.approvalRolesSelectcheck=function(e){i.selectedDataapprl=[],i.concessionTypeApproversRolesOptions.data.filter(function(e){1==e.editmode&&i.selectedDataapprl.push(e)})},i.addData=function(e){i.approvalRolesSelectcheck(i.concessionTypeApproversRolesOptions.data),i.jsonprepfconcessionDetail(e),i.jsonprepfconcessionFacilityLinkList(e),i.jsonprepfconcessionRole(i.selectedDataapprl);var t=i.concessionDetail1,r=i.concessionFacilityLinkList1,n=i.concessionRole1;i.amtcheck=!1,i.concessionTypeCreateNew2Options.data.length>0&&i.concessionTypeCreateNew2Options.data.filter(function(e){(""==e.CONC_AMOUNT||isNaN(e.CONC_AMOUNT)||null==e.CONC_AMOUNT)&&(i.amtcheck=!0,i.amtvalue=e.SERV_CODE)}),null==e.concessType||""==e.concessType?p.warning("Warning","Mandatory fields not filled ",!1,!1,D.time):null==i.obj.concessdescription||""==i.obj.concessdescription?p.warning("Warning","Mandatory fields not filled ",!1,!1,D.time):0==i.selectedDataapprl.length||null==i.selectedDataapprl.length?p.warning("Warning","Mandatory fields not filled",!1,!1,D.time):null!=i.obj.maxlmt&&""!=i.obj.maxlmt||!i.Hideservices?(null==i.obj.amtrpr||""==i.obj.amtrpr||isNaN(i.obj.amtrpr))&&i.Hideservices?p.warning("Warning","Enter Max Limit Type",!1,!1,D.time):0==i.concessionTypeCreateNew2Options.data.length&&2==e.ApplicableStatus?p.warning("Warning","Select Service",!1,!1,D.time):i.amtcheck?p.warning("Warning","Please Enter Max Limit for "+i.amtvalue+" service",!1,!1,D.time):i.update?a.update(e,t,r,n,i.updateData.CONC_SEQ_ID).then(function(e){var t=e;if(null==t.data.HITService.messageId)if(t.data.HITService.message.errorMessage){var a=t.data.HITService.message.errorMessage;p.warning("warning",a,!1,!1,D.time)}else p.failure("failure","Master Failed To Save",!1,!1,D.time);else t.data.HITService.hasOwnProperty("messageId")&&(p.success("SUCCESS","Master Saved successfully.",!1,!1,D.time),u.dismissAll(),i.listData())}):a.save(e,t,r,n).then(function(e){var t=e;if(null==t.data.HITService.messageId)if(null==t.data.HITService.message)p.failure("failure","Master Failed To Save",!1,!1,D.time);else if(t.data.HITService.message.errorMessage){var a=t.data.HITService.message.errorMessage;p.warning("warning",a,!1,!1,D.time)}else p.failure("failure","Master Failed To Save",!1,!1,D.time);else t.data.HITService.hasOwnProperty("messageId")&&(p.success("SUCCESS","Master Saved successfully.",!1,!1,D.time),u.dismissAll(),i.listData())}):p.warning("Warning","Enter Max Limit",!1,!1,D.time)},i.editClick=function(e){i.concessionTypeCreateNew2Options.data="",i.updateData=e,i.openNewScreen(!0),i.update=!0,i.isSave=!1,i.obj.Status1=e.GN_STATUS,i.isUpdatedis=!0,i.obj.concessType=e.CONC_NAME,i.obj.concessdescription=e.CONC_DESC,i.obj.Status1=e.GN_STATUS,i.ApplicableStatuschange(e.GN_CONC_TYPE),i.upRoles=[];var t={1:i.upRoles},a=JSON.parse(sessionStorage.userContextObj).FACILITY_ID_DESC,r=S.executeQueryURLReset();i.upRolesType=new Array,S.prepareParamListWithParam("pConcSeqId",e.CONC_SEQ_ID,i.upRolesType),S.prepareParamListWithParam("pPracticeId",a,i.upRolesType),S.executeQueryInput("CONCESS_MASTER_003",i.upRolesType,t,!0,!0,r,"popUp",{}).then(function(e){e[1].length>0&&(i.concessionTypeApproversRolesOptions.data=e[1],i.concessionTypeApproversRolesOptions.data.map(function(e){1==e.CHK?e.editmode=!0:e.editmode=!1}))}),i.resData=[],i.upConcessser=[];t={1:i.upConcessser},a=JSON.parse(sessionStorage.userContextObj).FACILITY_ID_DESC,r=S.executeQueryURLReset();i.upConcessserType=new Array,S.prepareParamListWithParam("pConcSeqId",e.CONC_SEQ_ID,i.upConcessserType),S.prepareParamListWithParam("pConcType",e.GN_CONC_TYPE,i.upConcessserType),S.executeQueryInput("CONCESS_MASTER_002",i.upConcessserType,t,!0,!0,r,"popUp",{}).then(function(e){e[1].length>0&&(i.concessionTypeCreateNew2Options.data=e[1],i.resData=e[1],1==e[1][0].GN_CONC_TYPE?(i.obj.maxlmt=e[1][0].CONC_AMOUNT,i.ApplicableStatuschange(e[1][0].GN_CONC_TYPE),i.obj.amtrpr=e[1][0].GN_AMT_TYPE,i.concessionTypeCreateNew2Options.data=[],i.concessionTypeCreateNew1Options.data=[]):(i.obj.ApplicableStatus=2,i.obj.amtrpr=e[1][0].GN_AMT_TYPE))})},i.jsonprepfconcessionDetail=function(e){i.concessionDetail=[];i.concessionTypeApproversRolesOptions.data;var t=i.concessionTypeCreateNew2Options.data,a={};if(i.concessionDetail1={},2==e.ApplicableStatus)for(var r=0;r<t.length;r++)i.updateData||(i.updateData.CONC_SEQ_ID=""),""!=(a={concessionHdSeqId:i.updateData.CONC_SEQ_ID,servSeqId:t[r].SERV_SEQ_ID,servCode:t[r].SERV_CODE,servName:t[r].SERV_NAME,concessionAmount:t[r].CONC_AMOUNT,gnAmtType:e.amtrpr,facilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID,practiceId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID_DESC,gnStatus:e.Status1,lastUpdatedOn:JSON.parse(sessionStorage.userContextObj).CURRENT_DATE}).concessionHdSeqId&&null!=a.concessionHdSeqId||delete a.concessionHdSeqId,""==a.actualRate&&delete a.actualRate,(""==a.concessionAmount||isNaN(a.concessionAmount))&&delete a.concessionAmount,i.concessionDetail.push(a);else i.updateData||(i.updateData.CONC_SEQ_ID=""),""!=(a={concessionHdSeqId:i.updateData.CONC_SEQ_ID,concessionAmount:parseInt(e.maxlmt),gnAmtType:e.amtrpr,facilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID,practiceId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID_DESC,gnStatus:e.Status1,lastUpdatedOn:JSON.parse(sessionStorage.userContextObj).CURRENT_DATE}).concessionHdSeqId&&null!=a.concessionHdSeqId||delete a.concessionHdSeqId,""==a.actualRate&&delete a.actualRate,(""==a.concessionAmount||isNaN(a.concessionAmount))&&delete a.concessionAmount,i.concessionDetail.push(a);i.concessionDetail1={"com.napier.core.service.vo.corebillingmasters.ConcessionMasterDetail":i.concessionDetail}},i.jsonprepfconcessionFacilityLinkList=function(e){i.concessionFacilityLinkList=[];var t;i.concessionFacilityLinkList1={},t={facilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID,gnStatus:e.Status1,lastUpdatedOn:JSON.parse(sessionStorage.userContextObj).CURRENT_DATE,practiceId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID_DESC},i.concessionFacilityLinkList.push(t),i.concessionFacilityLinkList1={"com.napier.core.service.vo.corebillingmasters.ConcessionMasterFacilityLink":i.concessionFacilityLinkList}},i.jsonprepfconcessionRole=function(e){i.concessionRole=[];var t={};i.concessionRole1={};for(var a=0;a<e.length;a++)t={roleSeqId:e[a].RL_SEQ_ID,roleId:e[a].RL_ID,roleName:e[a].RL_NAME,servName:e[a].SERV_NAME,chk:e[a].CHK,userSeqId:JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID,userName:JSON.parse(sessionStorage.userContextObj).LOGIN_NAME,facilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID,practiceId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID_DESC,gnStatus:e.Status1,lastUpdatedOn:JSON.parse(sessionStorage.userContextObj).CURRENT_DATE},i.concessionRole.push(t);i.concessionRole1={"com.napier.core.service.vo.corebillingmasters.ConcessionMasterRole":i.concessionRole}}}e.$inject=["concessionTypeCreateNew2Definition","concessionTypeCreateNew1Definition","concessionTypeService","$scope","concessionTypeDefinition","concessionTypeApproversRolesDefinition","hisModalService","$timeout","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","$uibModalStack","CallManager","BILLING_APIS","QueryService","$location","hisAlertConstants","RoleTaskService","taskPermissionService","$state","$filter"],angular.module("napierContainerUi").controller("concessionTypeController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v){p.loadModule("billing"),e.gridOptionsCopay=angular.copy(S),e.gridOptionsCopay.data=[],e.gridOptionsCopay.data[0]=[],function(){new Array;var t={1:e.storeList=[]},a=v.executeQueryURLReset(),i=new Array;v.prepareParamListWithParam("pFacility",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,i),v.prepareParamListWithParam("pAddType","001",i),v.prepareParamListWithParam("pFacType","006",i),v.executeQueryInput("GET_DEFAULT_COUNTRY",i,t,!0,!0,a,"popUp",{}).then(function(t){t[1][0]&&(e.defaultCountryCode=e.storeList[0].ADDR_LEVEL_CODE?e.storeList[0].ADDR_LEVEL_CODE:"in",$(".initCountry").intlTelInput("setCountry",e.defaultCountryCode))})}();var D=u.getLanguageToSet();p.changeLanguage(D),g.loadAlerts(D).then(function(t){e.alertObjectRes=t,e.alertData={buttonText:e.alertObjectRes.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}},function(e){}),e.loadCoPayCombo=function(){e.psgdwn_copay=[],e.deptdwn_copay=[],e.coPayQueryMap={1:e.deptdwn_copay,2:e.psgdwn_copay};var t=v.executeQueryURLReset(),a=new Array;v.executeQueryInput("SERVIC_EXCL_DEPARTMENT_DROPDOWN_NEW",a,e.coPayQueryMap,!0,!1,t,"popUp",{});var i=new Array;v.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,i),v.executeQueryInput("SCM_SERV_002_SCM_1",i,e.coPayQueryMap,!0,!0,t,"popUp",{}).then(function(e){})},e.loadCoPayCombo(),e.deptSpecicityService=[],e.OnChangeDept=function(t,a){a=a;e.deptSpecicityService[a]=[],e.specilityMap={1:e.deptSpecicityService[a]};var i=v.executeQueryURLReset(),r=new Array;v.prepareParamListWithParam("PDept_Code",t.CODE,r),v.prepareParamListWithParam("pPracticeid",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r),v.executeQueryInput("GET_DEPT_SPECIALITY_SERCH",r,e.specilityMap,!0,!0,i,"popUp",{}).then(function(t){t[1][0]&&e.gridOptionsCopay.data[a].speciality&&e.gridOptionsCopay.data[a].speciality.CODE&&(e.gridOptionsCopay.data[a].speciality=_.find(e.deptSpecicityService[a],function(t){return t.CODE==e.gridOptionsCopay.data[a].speciality.CODE}).CODE)})},e.serchCopayResult={},e.serchOptimSpeciSerch=function(t,a){e.copayserviceMap={1:e.optServSerch=[]};var i=v.executeQueryURLReset(),r=new Array;return v.prepareParamListWithParam("PSerrv_Name",t,r),v.executeQueryInput("SPECIALITY_SERVICE_SERCH",r,e.copayserviceMap,!0,!0,i,"popUp",{}).then(function(t){if(t[1])return e.optServSerch.map(function(t){return e.serchCopayResult=t,t})})},e.serchOptimSpeciSerch(""),e.setCopayService=function(t,a){e.gridOptionsCopay.data[a]=[],e.gridOptionsCopay.data[a].service={},e.gridOptionsCopay.data[a].primayServiceGroup={},e.gridOptionsCopay.data[a].department={},e.gridOptionsCopay.data[a].speciality={},e.gridOptionsCopay.data[a].primayServiceGroup.CODE=t.PRI_SERV_CODE,e.gridOptionsCopay.data[a].primayServiceGroup.DESCRIPTION=t.PRI_SERV_DESC,e.gridOptionsCopay.data[a].department.CODE=t.DEPT_CODE,e.gridOptionsCopay.data[a].department.DESCRIPTION=t.SEPT_DESC,e.gridOptionsCopay.data[a].speciality={CODE:t.SPL_CODE,DESCRIPTION:t.SPL_DESC},e.OnChangeDept(e.gridOptionsCopay.data[a].department,a),e.gridOptionsCopay.data[a].service.SERV_CODE=t.SERV_CODE,e.gridOptionsCopay.data[a].service.SERV_NAME=t.SERV_NAME,e.gridOptionsCopay.data[a].service.SERV_SEQ_ID=t.SERV_SEQ_ID},e.copayServiceGridList=function(t,a){if(e.gridOptionsCopay.data&&e.gridOptionsCopay.data.length>1)for(var i=!1,r=!1,n=!1,l=e.gridOptionsCopay.data,s=1;s<l.length;s++)if(l[s].primayServiceGroup&&t.primayServiceGroup&&l[s].primayServiceGroup.CODE==t.primayServiceGroup.CODE&&(i=!0),i&&(r=l[s].department==t.department||null!=t.department&&null!=l[s].department&&l[s].department.CODE==t.department.CODE),r&&(n=l[s].speciality==t.speciality||null!=t.speciality&&null!=l[s].speciality&&l[s].speciality.CODE==t.speciality.CODE||null==l[s].speciality&&null!=t.speciality),i){if(r&&n)return void m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,"Copay Alredy Exist",!1,!1,e.close,2e3)}else if(r&&n)return void m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,"Copay Alredy Exist",!1,!1,e.close,2e3);if(null!=t.copayment&&null!=t.primayServiceGroup){var o={primayServiceGroup:t.primayServiceGroup,isFirstRow:!0,isEditable:!0};null!=t.department&&(o.department=t.department),null!=t.speciality&&(o.speciality=t.speciality),null!=t.service&&(o.service=t.service),null!=t.copayment&&(o.copayment=t.copayment),null!=t.copaySeqId&&(o.copaySeqId=t.copaySeqId),e.deptSpecicityService[e.gridOptionsCopay.data.length]=e.deptSpecicityService[0],e.gridOptionsCopay.data.push(o),e.gridOptionsCopay.data[0]={isFirstRow:!1,isEditable:!1}}else m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,"Please enter the copay percentage",!1,!1,e.close,2e3)},e.setcopayGridEdit=function(t,a){e.gridOptionsCopay.data[a].isEditable=!1},e.copyData=[],e.delete=function(t,a){e.gridOptionsCopay.data.splice(e.gridOptionsCopay.data.indexOf(a),1),t.actions=2,e.copyData.push(t)},e.clear=function(){e.gridOptionsCopay.data[0]={isFirstRow:!1,isEditable:!1}},e.permissionList=l.rolePermission("TM_CREDIT_PAYER"),o.getList("CREDIT_PAYER_DROP_DOWEN",[{}]).then(function(t){var a=function(e){return e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]}(t);e.payercomboList=[],angular.forEach(a,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"];"003"!=i[0].data&&(e.payerObj={Code:i[0].data,Desc:i[1].data},e.payercomboList.push(e.payerObj)),d.id==e.payerObj.Code&&(e.selectedName=e.payerObj,e.modeChange(e.selectedName))})}),e.gridOptions={},e.gridOptionsService={},e.facilityMaster=[],e.deptMasterData=[],e.subdepartmentData=[],e.serviceCodeData=[],e.payerService=[],e.insurerServiceSearchData=[],e.insBatch=[],e.updateInsfacility=[],e.insUpdateServicedata=[],e.insuranceForm=!0,e.insuranceFormValidation=!1,e.addPlan=function(t,a){if(e.selectedName||e.modeChange(),!c.getJson().payerType||t&&!t.payerType)m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,"Please Update Payer Type",!1,!1,e.close,2e3);else if(null==t)s.go("index.masters.addInsurancePlan");else{if(2==t.status){var i=e.alertObjectRes.InActRcrdCanntBEdit;return void m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,i,!1,!1,e.close,2e3)}e.myjsonObj={insCompName:t.insCompName?t.insCompName:t.corpCompName,insCompId:t.insCompId?t.insCompId:t.corpCompId,payerType:t.payerType,companyId:t.companyId,planSeqId:t.insPlanCode?parseInt(t.insPlanCode):parseInt(t.corpPlanCode)},c.setJson(e.myjsonObj),s.go("index.masters.addInsurancePlan")}},e.facilityServices=function(){var i={};i.url=a.HISCOMBOFILLING.URL,i.requestData={operation:"ExecuteQuery",destination:"QueryService",voclass:"com.napier.core.service.vo.query.QueryData",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"FACILITY_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"practiceId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}]}]}]}]}},t.sendRestRequest(i).then(function(t){e.facilityresp=t.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"],e.facilityresp.length>0?e.facilityresp=e.facilityresp:e.facilityresp=[e.facilityresp];for(var a=0;a<e.facilityresp.length;a++)e.facilityMaster[a]={DESCRIPTION:e.facilityresp[a].columnList[0]["com.napier.core.service.vo.query.Column"][1].data,CODE:e.facilityresp[a].columnList[0]["com.napier.core.service.vo.query.Column"][0].data}},function(e){})},e.isInsurancePlanDetailsShow=!0,e.arrowRight='<i class="his-section-heading-icon pull-right fa fa-angle-double-right fa-2x" aria-hidden="true"></i>',e.arrowDown='<i class="his-section-heading-icon pull-right fa fa-angle-double-down fa-2x" aria-hidden="true"></i>',e.insuranceHide=!1,e.modeChange=function(t){e.payerCode=t?t.Code:void 0,e.insuranceHide=!0,e.corporateHide=!1,e.corporate=!1,e.insurerSearch1(),e.facilityServices(),e.departmentServicesDropDown(),e.insurerSearchData=[],e.selected=void 0;for(var a=0;a<e.insurerFinal1.length;a++)e.insurerSearchData.push(e.insurerFinal1[a].inCompName),e.insurerSearchData.push(e.insurerFinal1[a].inCompId)},e.insurer=!1,e.counter=0,e.insActive=!1,e.insInactive=!1,e.addInsurer=function(){delete e.insDisable,e.selectedName||e.modeChange(),e.insActive=!0,e.insurerServiceSearch(),e.isInsurancePlanDetailsShow=!1,e.isInsuranceDetailsShow=!0,e.isInsurancecontactDetailsShow=!0,e.isInsuranceServiceDetailsShow=!0,e.insurer=!0,e.corporate=!1,e.clear(),e.insurerModal.status="1",e.insfacError=!1,e.insfacErrorValue="",e.insError=!1,e.insErrorValue="",e.insidError=!1,e.insidErrorValue="",e.insemailError=!1,e.insemailErrorValue="",e.insnameError=!1,e.insnameErrorValue="",e.insmblError=!1,e.insmblErrorValue="",e.insaddError=!1,e.insaddErrorValue="",e.gridOptionsCopay.data=[],e.gridOptionsCopay.data[0]={isFirstRow:!1,isEditable:!1}},e.insUpdate=!1,e.serviceClick=[],e.serviceCorpClick=[],e.insurerModal={facility:[]},e.insurerResponse=[],e.insurerModals={facility:[]},e.abcd=[],e.facilityValid="facilityFalse",e.insurerValid="insurerFalse",e.insurerIdValid="insurerIdFalse",e.contactValid="contactFalse",e.phoneValid="phoneFalse",e.emailValid="emailFalse",e.faxValid="faxFalse",e.addressValid="faxFalse",e.status="statusFalse",e.clear=function(){e.corpActive=!0,delete e.remarks,e.insurerModal.creditLimit="",e.insurerModal.status="1",e.insurerModal={facility:[]},e.selectedName?e.insurerModal.payerType=e.selectedName.Code:e.insurerModal.payerType=e.payercomboList[0].Code,e.abcd=[],e.serviceClick=[],e.insFacilityVo=[],e.insFacility=[],e.serviceCorpClick=[],e.dataBatch1=[],e.dataBatch=[],e.dataSelected1=[],e.dataSelected=[],e.insServiceSearch=[],e.gridOptionsService.data=[],e.serviceClick=[]},e.addInscontactDetails={inContactPerson:null,mobileNo:null,resPhone1:null,emailId:null,faxNo:null,address1:null},e.addcont=!1,e.addNew=function(){e.addcont=!0},e.insFacility=[],e.insFacilityVo=[],e.dataSelected=[],e.insfacError=!1,e.insfacErrorValue="",e.insError=!1,e.insErrorValue="",e.insidError=!1,e.insidErrorValue="",e.insemailError=!1,e.insemailErrorValue="",e.insnameError=!1,e.insnameErrorValue="",e.insmblError=!1,e.insmblErrorValue="",e.insaddError=!1,e.insaddErrorValue="",e.saveInsurer=function(){var a;a=e.gridOptionsCopay.data.concat(e.copyData),e.copay_payer_serv=[];for(var i=1;i<a.length;i++)e.copay_payer_serv[i-1]={"@class":"com.napier.core.service.vo.emrmasters.CopaymentServiceLevel",copayment:parseInt(a[i].copayment),department:null!=a[i].department&&""!=a[i].department?a[i].department.CODE:void 0,primayServiceGroup:null!=a[i].primayServiceGroup&&""!=a[i].primayServiceGroup?a[i].primayServiceGroup.CODE:void 0,service:null!=a[i].service&&""!=a[i].service?a[i].service.SERV_SEQ_ID:void 0,speciality:null!=a[i].speciality&&""!=a[i].speciality?a[i].speciality.CODE:void 0,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,gnStatus:1,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,editedBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,copaySeqId:a[i].copaySeqId?a[i].copaySeqId:void 0};if(e.insUpdateServicedata.length>0&&0==e.allGridData.length){e.serviceClick=[];for(i=0;i<e.gridOptionsService.data.length;i++)e.serviceClick[i]={"@class":"com.napier.core.service.vo.emrmasters.PayerServiceLkVo",payerSerSeqId:e.gridOptionsService.data[i].payerSerSeqId,serSeqId:_.toString(e.gridOptionsService.data[i].servSeqCode),aliasCode:e.gridOptionsService.data[i].AliasCode,aliasName:e.gridOptionsService.data[i].AliasName,dept:e.gridOptionsService.data[i].dept,subDept:e.gridOptionsService.data[i].SubDepartment,servName:e.gridOptionsService.data[i].servName,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,gnStatus:e.gridOptionsService.data[i].gnStatus,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,payerType:2,insPhilHealthCodesVOList:[{InsPhilHealthCodesVOList:[{"com.napier.core.service.vo.masters.InsPhilHealthCodesVO":e.gridOptionsService.data[i].payerServiceCodeList?e.gridOptionsService.data[i].payerServiceCodeList:[]}]}]}}else{e.serviceClick=[];for(i=0;i<e.gridOptionsService.data.length;i++)e.serviceClick[i]={"@class":"com.napier.core.service.vo.emrmasters.PayerServiceLkVo",serSeqId:e.gridOptionsService.data[i].servSeqCode,aliasCode:e.gridOptionsService.data[i].AliasCode,aliasName:e.gridOptionsService.data[i].AliasName,dept:e.gridOptionsService.data[i].dept,subDept:e.gridOptionsService.data[i].SubDepartment,servName:e.gridOptionsService.data[i].servName,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,gnStatus:e.gridOptionsService.data[i].gnStatus,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,payerType:2,insPhilHealthCodesVOList:[{InsPhilHealthCodesVOList:[{"com.napier.core.service.vo.masters.InsPhilHealthCodesVO":e.gridOptionsService.data[i].payerServiceCodeList?e.gridOptionsService.data[i].payerServiceCodeList:[]}]}]},e.gridOptionsService.data[i].payerSerSeqId&&angular.extend(e.serviceCorpClick[i],{payerSerSeqId:e.gridOptionsService.data[i].payerSerSeqId})}for(i=0;i<e.insurerModal.facility.length;i++)if("1"==e.insurerModal.status?e.insFacilityVo[i]={"@class":"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo",createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilityId:e.insurerModal.facility[i].CODE}:e.insFacilityVo[i]={"@class":"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo",createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,gnStatus:2,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilityId:e.insurerModal.facility[i].CODE},e.updateInsfacility.length>0)for(var r=0;r<e.updateInsfacility.length;r++)e.insurerModal.facility[i].CODE==e.updateInsfacility[r].facilityId&&angular.extend(e.insFacilityVo[i],{payerFacSedId:e.updateInsfacility[r].payerFacSedId});if(e.abcd=[{facility:e.insurerModal.facility,inCompName:e.insurerModal.inCompName,inCompId:e.insurerModal.inCompId,inContactPerson:e.insurerModal.inContactPerson,mobileNo:e.insurerModal.mobileNo,resPhone1:e.insurerModal.resPhone1,emailId:e.insurerModal.emailId,faxNo:e.insurerModal.faxNo,address1:e.insurerModal.address1,status:e.insurerModal.status,payerType:e.insurerModal.payerType}],e.insurerModal.facility.length?(e.facilityValid="facilityTrue",e.insfacError=!1,e.insfacErrorValue=""):(e.facilityValid="facilityFalse",e.insfacError=!0,e.insfacErrorValue=e.alertObjectRes.PlzSlctFaclty),null!=e.abcd[0].inCompName&&null!=e.abcd[0].inCompName&&""!=e.abcd[0].inCompName?(e.insurerValid="insurerTrue",e.insError=!1,e.insErrorValue=""):(e.insurerValid="insurerFalse",e.insError=!0,e.insErrorValue=e.alertObjectRes.PlzEntrInsurName),null!=e.abcd[0].inCompId&&null!=e.abcd[0].inCompId&&""!=e.abcd[0].inCompId?(e.insurerIdValid="insurerIdTrue",e.insidError=!1,e.insidErrorValue=""):(e.insurerIdValid="insurerIdFalse",e.insidError=!0,e.insidErrorValue=e.alertObjectRes.PlzEntrInsurId),null!=e.abcd[0].inContactPerson&&null!=e.abcd[0].inContactPerson&&""!=e.abcd[0].inContactPerson?(e.contactValid="contactTrue",e.insnameError=!1,e.insnameErrorValue=""):(e.contactValid="contactFalse",e.insnameError=!0,e.insnameErrorValue=e.alertObjectRes.PlzEntrCnctPersName),null!=e.abcd[0].mobileNo&&null!=e.abcd[0].mobileNo&&""!=e.abcd[0].mobileNo?(e.phoneValid="phoneTrue",e.insmblError=!1,e.insmblErrorValue=""):(e.phoneValid="phoneFalse",e.insmblError=!0,e.insmblErrorValue=e.alertObjectRes.PlzEntrValdCnctNum),null!=e.abcd[0].address1&&null!=e.abcd[0].address1&&""!=e.abcd[0].address1?(e.addressValid="addressTrue",e.insaddError=!1,e.insaddErrorValue=""):(e.addressValid="addressFalse",e.insaddError=!0,e.insaddErrorValue=e.alertObjectRes.PlzEntrAddr),null!=e.abcd[0].emailId&&null!=e.abcd[0].emailId&&""!=e.abcd[0].emailId?(e.emailValid="emailTrue",e.insemailError=!1,e.insemailErrorValue=""):(e.emailValid="emailTrue",e.insemailError=!0,e.insemailErrorValue=e.alertObjectRes.PlzEntrValdEmailId),e.insSave=!1,"facilityTrue"==e.facilityValid&&"insurerTrue"==e.insurerValid&&"insurerIdTrue"==e.insurerIdValid&&"contactTrue"==e.contactValid&&"phoneTrue"==e.phoneValid&&"emailTrue"==e.emailValid&&"addressTrue"==e.addressValid?(e.insurerModals={facility:e.insurerModal.facility,inCompName:e.insurerModal.inCompName,inCompId:e.insurerModal.inCompId,inContactPerson:e.insurerModal.inContactPerson,mobileNo:e.insurerModal.mobileNo,resPhone1:e.insurerModal.resPhone1,emailId:e.insurerModal.emailId,faxNo:e.insurerModal.faxNo,address1:e.insurerModal.address1,status:e.insurerModal.status,incSeqId:e.insurerModal.incSeqId,remarks:e.insurerModal.remarks,creditLimit:e.insurerModal.creditLimit},e.insSave=!0):(e.facilityValid="facilityFalse",e.insurerValid="insurerFalse",e.insurerIdValid="insurerIdFalse",e.contactValid="contactFalse",e.phoneValid="phoneFalse",e.emailValid="emailFalse",e.faxValid="faxFalse",e.addressValid="faxFalse",e.insSave=!1),1==e.insSave)if(e.serviceClick.length){var n;if(null==e.insurerModals.incSeqId)(n={url:"HISServices/InsuranceCompanyMasterService"}).requestData={operation:"saveOrUpdateInsuranceCompanyMaster",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,inCompName:e.insurerModals.inCompName,taxType:e.insurerModal.taxType,payerTaxId:e.insurerModal.payerTaxId,payerType:e.insurerModal.payerType,inCompId:e.insurerModals.inCompId,inContactPerson:e.insurerModals.inContactPerson,remarks:e.insurerModals.remarks,creditLimit:e.insurerModal.creditLimit?parseInt(e.insurerModal.creditLimit):void 0,addressList1:{"@class":"com.napier.core.service.vo.emrmasters.AddressMasterGenericVo",emailId:e.insurerModals.emailId,mobileNo:e.insurerModals.mobileNo,resPhone1:e.insurerModals.resPhone1,faxNo:e.insurerModals.faxNo,address1:e.insurerModals.address1},payerServiceLkVo:[{"com.napier.core.service.vo.emrmasters.PayerServiceLkVo":e.serviceClick}],payerFacilityLkVo:[{"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo":e.insFacilityVo}],CopaymentServiceLevelList:[{"com.napier.core.service.vo.emrmasters.CopaymentServiceLevel":e.copay_payer_serv}],machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,status:e.insurerModals.status}};else(n={url:"HISServices/InsuranceCompanyMasterService"}).requestData={operation:"saveOrUpdateInsuranceCompanyMaster",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,incSeqId:e.insurerModals.incSeqId,inCompName:e.insurerModals.inCompName,taxType:e.insurerModal.taxType,payerTaxId:e.insurerModal.payerTaxId,payerType:e.insurerModal.payerType,inCompId:e.insurerModals.inCompId,inContactPerson:e.insurerModals.inContactPerson,remarks:e.insurerModals.remarks,creditLimit:e.insurerModal.creditLimit?parseInt(e.insurerModal.creditLimit):void 0,addressList1:{"@class":"com.napier.core.service.vo.emrmasters.AddressMasterGenericVo",emailId:e.insurerModals.emailId,mobileNo:e.insurerModals.mobileNo,resPhone1:e.insurerModals.resPhone1,faxNo:e.insurerModals.faxNo,address1:e.insurerModals.address1},payerServiceLkVo:[{"com.napier.core.service.vo.emrmasters.PayerServiceLkVo":e.serviceClick}],payerFacilityLkVo:[{"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo":e.insFacilityVo}],CopaymentServiceLevelList:[{"com.napier.core.service.vo.emrmasters.CopaymentServiceLevel":e.copay_payer_serv}],machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,status:e.insurerModals.status}};t.sendRestRequest(n).then(function(t){if(t.data.HITService.message.errorMessage){var a=t.data.HITService.message.errorMessage;m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(0!=t.data.HITService.message.length){if(!e.updateAliasNames){if(e.insDisable){a=e.alertObjectRes.rcdSucssUpdate;m.hisAlertMulti("success",e.alertObjectRes.alertTypeSucss,a,!1,!1,e.close,2e3),delete e.insurerModal.taxType,delete e.insurerModal.payerTaxId}else{a=e.alertObjectRes.RcdSucssAdded;m.hisAlertMulti("success",e.alertObjectRes.alertTypeSucss,a,!1,!1,e.close,2e3),delete e.insurerModal.taxType,delete e.insurerModal.payerTaxId}e.clear(),e.insurerSearch1(),e.insurer=!1,e.corporate=!1,delete e.insDisable,e.isInsurancePlanDetailsShow=!0}delete e.updateAliasNames}else{var a=e.alertObjectRes.SmthngWentWrng;m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}},function(e){})}else{var l=e.alertObjectRes.PlzSlctAtlstOneSrvc2Map;m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,l,!1,!1,e.close,2e3)}else{l=e.alertObjectRes.plzFilMandFild;m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,l,!1,!1,e.close,2e3)}},e.gridApi,e.updateInsfacility=[],e.updateInsurer=function(a){if(e.selectedName||e.modeChange(),e.insDisable=a.incSeqId,"1"==a.status){e.insurerModal.facility=[];var i={url:"HISServices/CorporateCompanyMasterService"};i.requestData={operation:"updateService",messageId:"",destination:"com.napier.core.master.service.external.CorporateCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.CorporateCompanyMasterVo",corpSeqId:a.incSeqId,payerServiceLkVo:[{"com.napier.core.service.vo.emrmasters.PayerServiceLkVo":[{"@class":"com.napier.core.service.vo.emrmasters.PayerServiceLkVo",gnStatus:"1",practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},t.sendRestRequest(i).then(function(t){if(e.updateInsService=t.data.HITService.message.corporateServiceListVo[0]["com.napier.core.service.vo.emrmasters.CorporateServiceListVo"],t.data.HITService.message.payerFacilityLkVo[0]["com.napier.core.service.vo.emrmasters.PayerFacilityLkVo"].length>0?e.updateInsfacility=t.data.HITService.message.payerFacilityLkVo[0]["com.napier.core.service.vo.emrmasters.PayerFacilityLkVo"]:e.updateInsfacility=[t.data.HITService.message.payerFacilityLkVo[0]["com.napier.core.service.vo.emrmasters.PayerFacilityLkVo"]],e.updateInsfacility)for(var a=0;a<e.updateInsfacility.length;a++)for(var i=0;i<e.facilityMaster.length;i++)e.facilityMaster[i].CODE==e.updateInsfacility[a].facilityId&&e.insurerModal.facility.push(e.facilityMaster[i]);if(e.insServiceSearch=[],e.updateInsService.length>0)for(a=0;a<e.updateInsService.length;a++)e.insServiceSearch[a]={deptDesc:e.updateInsService[a].DeptName,subDeptDesc:e.updateInsService[a].SubDeptName,dept:e.updateInsService[a].Department,SubDepartment:e.updateInsService[a].SubDepartment,servCode:e.updateInsService[a].ServiceCode,servName:e.updateInsService[a].ServiceName,AliasCode:e.updateInsService[a].AliasCode,AliasName:e.updateInsService[a].AliasName,payerSerSeqId:e.updateInsService[a].payerSerSeqId,gnStatus:e.updateInsService[a].gnStatus,servSeqCode:e.updateInsService[a].ServSeqId};else e.updateInsService&&(e.insServiceSearch[0]={deptDesc:e.updateInsService.DeptName,subDeptDesc:e.updateInsService.SubDeptName,dept:e.updateInsService.Department,SubDepartment:e.updateInsService.SubDepartment,servCode:e.updateInsService.ServiceCode,servName:e.updateInsService.ServiceName,AliasCode:e.updateInsService.AliasCode,AliasName:e.updateInsService.AliasName,payerSerSeqId:e.updateInsService.payerSerSeqId,gnStatus:e.updateInsService.gnStatus,servSeqCode:e.updateInsService.ServSeqId});e.gridOptionsService.data=e.insServiceSearch,e.insUpdateServicedata=angular.copy(e.insServiceSearch),e.insurerServiceSearchData=[];for(a=0;a<e.gridOptionsService.data.length;a++)e.insurerServiceSearchData.push(e.gridOptionsService.data[a].servName),e.insurerServiceSearchData.push(e.gridOptionsService.data[a].servCode),e.insurerServiceSearchData.push(e.gridOptionsService.data[a].AliasCode),e.insurerServiceSearchData.push(e.gridOptionsService.data[a].AliasName);t.data.HITService.message.copaymentServiceLevel[0].length>0&&t.data.HITService.message.copaymentServiceLevel[0]["com.napier.core.service.vo.emrmasters.CopaymentServiceLevel"].length,e.copaymentServiceLevel=t.data.HITService.message.copaymentServiceLevel[0]["com.napier.core.service.vo.emrmasters.CopaymentServiceLevel"],e.copaymentServiceLevel&&e.getCopayPayerData(e.copaymentServiceLevel)}),e.insurerModal.incSeqId=a.incSeqId,e.insurerModal.inCompId=a.inCompId,e.insurerModal.inCompName=a.inCompName,e.insurerModal.remarks=a.remarks,e.insurerModal.inContactPerson=a.inContactPerson,e.insurerModal.mobileNo=a.addressList1.mobileNo,e.insurerModal.taxType=a.taxType,e.insurerModal.payerTaxId=a.payerTaxId,e.insurerModal.resPhone1=a.addressList1.resPhone1,e.insurerModal.emailId=a.addressList1.emailId,e.insurerModal.faxNo=a.addressList1.faxNo,e.insurerModal.address1=a.addressList1.address1,e.insurerModal.status="1"==a.status?"1":"2",e.insurerModal.creditLimit=a.creditLimit,a.payerType?e.insurerModal.payerType=a.payerType:e.selectedName?e.insurerModal.payerType=e.selectedName.Code:e.insurerModal.payerType=e.payercomboList[0].Code,e.insurer=!0,e.isInsurancePlanDetailsShow=!1,e.isInsuranceDetailsShow=!0,e.isInsurancecontactDetailsShow=!0,e.isInsuranceServiceDetailsShow=!0}else{var r=e.alertObjectRes.InActRcrdCanntBEdit;m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,r,!1,!1,e.close,2e3),e.insurer=!1,e.isInsurancePlanDetailsShow=!0}},e.getCopayPayerData=function(t){if(t.length||(t=[t]),t.length>0&&null!=t[0]){e.gridOptionsCopay.data=[],e.gridOptionsCopay.data[0]={isFirstRow:!1,isEditable:!1};for(var a=0;a<t.length;a++){var i={};i.copaySeqId=t[a].copaySeqId;var r={};r.CODE=t[a].primayServiceGroup,r.DESCRIPTION=t[a].primayServiceGroupName,i.primayServiceGroup=r;var n={};null!=t[a].department&&null!=t[a].department&&(n.CODE=t[a].department.pad(3),n.DESCRIPTION=t[a].departmentName,i.department=n);var l={};null!=t[a].speciality&&null!=t[a].speciality&&(l.CODE=t[a].speciality,l.DESCRIPTION=t[a].specialityName,i.speciality=l,e.OnChangeDept(n,a+1));var s={};null!=t[a].service&&null!=t[a].service&&(s.SERV_SEQ_ID=t[a].service,s.SERV_NAME=t[a].serviceName,s.SERV_CODE=t[a].serviceCode,i.service=s),i.copayment=t[a].copayment,i.isFirstRow=!0,i.isEditable=!0,e.gridOptionsCopay.data.push(i)}}},e.insurerSearchModal=null,e.selected=null,e.insuranceFacilitySearch=function(){var a={url:"HISServices/InsuranceCompanyMasterService"};a.requestData={operation:"getSearchService",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",inCompId:e.selected?e.selected:"",payerType:e.selectedName?e.selectedName.Code:-999,payerFacilityLkVo:[{"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo":[{"@class":"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo",facilityId:e.insurerSearchModal.CODE}]}]}},t.sendRestRequest(a).then(function(t){e.insurerFinal1=[],t.data.HITService.message&&(e.insurerFinal1=t.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster"],e.insurerFinal1=Array.isArray(e.insurerFinal1)?e.insurerFinal1:[e.insurerFinal1]),e.gridOptions.data=angular.copy(e.insurerFinal1)},function(e){})},e.insurerSearch=function(){var a={url:"HISServices/InsuranceCompanyMasterService"};a.requestData={operation:"getSearchService",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",inCompId:e.selected?e.selected:"",payerType:e.selectedName?e.selectedName.Code:-999,payerFacilityLkVo:[{"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo":[{"@class":"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo",facilityId:e.insurerSearchModal?e.insurerSearchModal.CODE:""}]}]}},t.sendRestRequest(a).then(function(t){e.insurerFinal1=[],t.data.HITService.message&&t.data.HITService.message[0]&&t.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster"]?(e.insurerFinal1=t.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster"],e.insurerFinal1=Array.isArray(e.insurerFinal1)?e.insurerFinal1:[e.insurerFinal1],e.gridOptions.data=angular.copy(e.insurerFinal1)):e.gridOptions.data=[],e.selected=""})},e.insurerSearch1=function(){var a={url:"HISServices/InsuranceCompanyMasterService"};a.requestData={operation:"getSearchService",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",inCompId:e.selected?e.selected:"",payerType:e.selectedName?e.selectedName.Code:-999,payerFacilityLkVo:[{"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo":[{"@class":"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo",facilityId:""}]}]}},t.sendRestRequest(a).then(function(t){if(e.gridOptions.data=[],e.insurerFinal1=[],t.data.HITService.message&&t.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster"].length>0?e.insurerFinal1=t.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster"]:t.data.HITService.message&&(e.insurerFinal1=[t.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster"]]),e.insurerFinal1.length>0)e.gridOptions.data=angular.copy(e.insurerFinal1);else for(var a=0;a<1;a++){e.gridOptions.data.push({})}})},e.insFirstSearch=function(a){var i={url:"HISServices/InsuranceCompanyMasterService"};return i.requestData={operation:"getSearchService",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",inCompId:a,payerType:e.selectedName?e.selectedName.Code:-999,payerFacilityLkVo:[{"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo":[{"@class":"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo",facilityId:e.insurerSearchModal?e.insurerSearchModal.CODE:""}]}]}},t.sendRestRequest(i).then(function(t){if(e.insurerFinal1=[],e.insSearchVar=!1,t.data.HITService.message)return e.insurerFinal1=t.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster"],e.insurerFinal1=Array.isArray(e.insurerFinal1)?e.insurerFinal1:[e.insurerFinal1],e.insSearchVar=!1,e.insurerFinal1.map(function(e){return e});e.insSearchVar=!0,delete e.insurerSearchModal})},e.value_1=!0,e.value_2=!1,e.message="false",e.onChange=function(t){e.message=t};e.insPlanShow=!1,e.gridOptions={onRegisterApi:function(t){e.grid=t,t.selection.on.rowSelectionChanged(e,function(t,a){e.insCompName=t.entity.inCompName,e.insCompId=t.entity.incSeqId,1==t.entity.status?e.insPlanShow=!0:e.insPlanShow=!1,e.myjsonObj={insCompName:e.insCompName,insCompId:e.insCompId,payerType:t.entity.payerType,companyId:t.entity.inCompId},c.setJson(e.myjsonObj)})},enableHorizontalScrollbar:0,enableRowSelection:!0,enableRowHeaderSelection:!1,enableSelectAll:!1,enableFiltering:!1,enableSorting:!1,enableColumnMenus:!1,enableCellEditOnFocus:!1,rowTemplate:'<div  style="cursor:pointer" ng-class="{ \'grey\':row.isSelected == true }">  <div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>',gridFooterTemplate:'<div class="foot">Records Display:<span style="color:blue">{{grid.appScope.gridOptions.data.length}}</span></div>',columnDefs:[{field:"inCompName",displayName:"Payer Name",cellEditableCondition:!1,cellTooltip:function(e,t){return e.entity.inCompName},cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"    >{{row.entity.inCompName | limitTo: 22}}{{row.entity.inCompName.length > 22 ? "..." : ""}}</div>'},{field:"inCompId",displayName:"Payer Id",cellEditableCondition:!1},{field:"status",displayName:"Status",visible:!1,cellEditableCondition:!1,cellTemplate:'<div ng-class="{ \'grey\':grid.appScope.rowFormatter( row ) }" ng-show="row.entity.status">{{(row.entity.status=="1")?"Active":"InActive"}}</div>'},{field:"Plan",displayName:"Plan",cellEditableCondition:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a href style="" class="his-link" popover-trigger="click" popover-placement="right" uib-popover-template="\'myPopoverTemplate1.html\'" ng-click="grid.appScope.getPopoverContent1(row.entity.planName,row.entity,2)" popover-title="{{dynamicPopover.title}}"><span>{{(row.entity.planName.split("#").length>0) ? (row.entity.planName.split("#").length):" "}}</span><span>{{(row.entity.planName.split("#").length>0) ? "  Plans":" "}}</span></a></div>'},{field:"Action",displayName:"Actions",width:"30%",cellEditableCondition:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row"><div ng-class="{ \'grey\':grid.appScope.rowFormatter1( row ),disabledDiv:!grid.appScope.permissionList.TM_CREDIT_PAYER_U}" ng-show="row.entity.status"><span style="padding-left:5px;"  class="fa fa-pencil"  ng-click="grid.appScope.updateInsurer(row.entity)"></span><span style="padding-left:10px"><md-switch  ng-change="grid.appScope.activeClick(row)" ng-if="grid.appScope.permissionList.TM_CREDIT_PAYER_ACTV!=undefined" ng-true-value="1" ng-false-value="2" ng-model="row.entity.status" class=" md-primary actionSwitch wlabel" style="margin-top: -6%;!important" aria-label="Switch 1"><label>{{(row.entity.status==1)?"Active":"Inactive" }}</label></md-switch></span></div></div>'}]},e.gridOptions.multiSelect=!1,e.gridOptions.modifierKeysToMultiSelect=!1,e.gridOptions.noUnselect=!0,e.activeClick=function(a){var i={url:"HISServices/InsuranceCompanyMasterService"};i.requestData={operation:"saveOrUpdateInsuranceCompanyMaster",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,incSeqId:a.entity.incSeqId,inCompName:a.entity.inCompName,inCompId:a.entity.inCompId,inContactPerson:a.entity.inContactPerson,planName:a.entity.planName?a.entity.planName:null,modifiedBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,addressList1:{"@class":"com.napier.core.service.vo.emrmasters.AddressMasterGenericVo",emailId:a.entity.addressList1.emailId,mobileNo:a.entity.addressList1.mobileNo,resPhone1:a.entity.addressList1.resPhone1,faxNo:a.entity.addressList1.faxNo,address1:a.entity.addressList1.address1},payerServiceLkVo:[{"com.napier.core.service.vo.emrmasters.PayerServiceLkVo":e.serviceClick}],payerFacilityLkVo:[{"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo":e.insFacilityVo}],machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,status:a.entity.status}},t.sendRestRequest(i).then(function(t){e.statusData={},e.statusResponse=t.data.HITService.message})};e.gridOptionsService={onRegisterApi:function(t){e.grid=t,e.insAliasGrid=t},exporterCsvFilename:"Insurance_Service.csv",enableHorizontalScrollbar:0,enableFiltering:!1,enableSorting:!1,enableColumnMenus:!1,enableCellEditOnFocus:!1,rowTemplate:'<div style="cursor:pointer" ng-class="{ \'grey\':grid.appScope.rowFormatter1( row ) }">  <div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>',columnDefs:[{field:"deptDesc",displayName:"Department Name",width:"11%",cellEditableCondition:!1},{field:"subDeptDesc",displayName:"Sub-Department",width:"11%",cellEditableCondition:!1},{field:"servCode",displayName:"Service Code",width:"11%",cellEditableCondition:!1},{field:"servName",displayName:"Service Name",width:"21%",cellEditableCondition:!1},{field:"AliasName",displayName:"Alias Name",width:"13%",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="{ \'grey\':grid.appScope.rowFormatter1( row ) }" ng-if="!row.entity.editable">{{COL_FIELD}}</div><div ng-if="row.entity.editable"><input type="text" maxlength="750"   ng-required="true" ng-model="MODEL_COL_FIELD"</div>'},{field:"AliasCode",displayName:"Alias Code",width:"13%",cellTemplate:'<div class="ui-grid-cell-contents" ng-class="{ \'grey\':grid.appScope.rowFormatter1( row ) }" ng-if="!row.entity.editable">{{COL_FIELD}}</div><div ng-if="row.entity.editable"><input type="text" maxlength="750" ng-model="MODEL_COL_FIELD"</div>'},{field:"Action",displayName:"Actions",width:"25%",cellEditableCondition:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row" ng-class="{ \'grey\':grid.appScope.rowFormatter1( row ) }"><md-switch style="" ng-change="grid.appScope.activeClick1(row)" ng-model="row.entity.gnStatus" ng-true-value="1" ng-false-value="2" class=" md-primary actionSwitch wlabel" aria-label="Switch 1"></md-switch><div style="" ng-click="grid.appScope.updateInsAlias(row.entity,rowRenderIndex)"><span class="his-link">Payer Codes & Names</span></div></div>'}]},e.updateInsAlias=function(t,a){var i={result:t,indexAlias:a,roleTask:e.insDisable?e.permissionList.TM_CREDIT_PAYER_U:e.permissionList.TM_CREDIT_PAYER_SAV};r.open("Payer Codes & Names",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/corporate/partials/payerCodeName.html",size:"lg",controller:"payerCodeNameCtrl",controllerAs:"pcn",keyboard:!1,backdrop:"static",resolve:{objParam:function(){return i}}}).result.then(function(a){if(t.payerSerSeqId){if(null!=a&&a.PAYER_ALIAS_CODE){for(var i=0;i<e.gridOptionsService.data.length;i++)if(e.gridOptionsService.data[i].payerSerSeqId==a.payerSerSeqId){e.gridOptionsService.data[i].AliasCode=a.PAYER_ALIAS_CODE,e.gridOptionsService.data[i].AliasName=a.PAYER_ALIAS_NAME;break}e.updateAliasNames=!0,e.saveInsurer()}}else{var r=_.findIndex(e.gridOptionsService.data,function(e){return e.servSeqCode==t.servSeqCode});e.gridOptionsService.data[r].AliasCode=a.defaultPayerAlias.PAYER_ALIAS_CODE,e.gridOptionsService.data[r].AliasName=a.defaultPayerAlias.PAYER_ALIAS_NAME,e.gridOptionsService.data[r].payerServiceCodeList=a.payerServiceCodeList}})},e.insServiceSearch=[],e.corpServiceSearch=[],e.insurerServiceSearchModal={},e.insurerServiceSearch=function(){var a={url:"HISServices/InsuranceCompanyMasterService",requestData:{operation:"getServiceMappingSearchService",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceServiceVo",servCode:""}}};t.sendRestRequest(a).then(function(t){e.insServiceSearch=t.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceServiceVo"];for(var a=0;a<e.insServiceSearch.length;a++)e.insurerServiceSearchData.push(e.insServiceSearch[a].servName),e.insurerServiceSearchData.push(e.insServiceSearch[a].servCode)})},e.serviceIns=null,e.insurServiceSearch=function(t){for(null!=e.serviceIns&&null!=e.serviceIns&&""!=e.serviceIns||(e.allGridData.length>0?e.gridOptionsService.data=e.allGridData:e.insUpdateServicedata.length>0?e.gridOptionsService.data=angular.copy(e.insUpdateServicedata):e.gridOptionsService.data=angular.copy(e.insurerServiceSearchGrid));t;){var a=t.split(" ");e.gridOptionsService.data=n("filter")(e.gridOptionsService.data,a[0],void 0),a.shift(),t=0!==a.length?a.join(" "):""}},e.inssecondSearch=function(a){var i={url:"HISServices/InsuranceCompanyMasterService"};return i.requestData={operation:"getServiceMappingSearchService",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceServiceVo",servCode:a}},t.sendRestRequest(i).then(function(t){if(e.insServiceSearchVar=!1,t.data.HITService.message)return e.insServiceSearch=t.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceServiceVo"],e.insServiceSearch=Array.isArray(e.insServiceSearch)?e.insServiceSearch:[e.insServiceSearch],e.insServiceSearch.map(function(e){return e});e.insServiceSearchVar=!0,delete e.serviceIns},function(e){})};e.planText=" Plans",e.input="Line 1<br/>Line 2",e.insPlanHide=!1,e.getPopoverContent1=function(t,a,i){t=t.toString().split("#");e.htmlContent1=[];for(var r=0;r<t.length;r++)e.htmlContent1.push({insPlanCode:t[r].split(",")[0],insPlanName:t[r].split(",")[2],insCompName:a.inCompName,companyId:a.inCompId,insCompId:a.incSeqId,payerType:a.payerType,status:a.status})},e.planNameData=[],e.refreshData=function(){e.gridOptions.data=n("filter")(e.insurerFinal1,e.insurerSearchModal,void 0)},e.refreshDataInsService=function(){e.gridOptionsService.data=n("filter")(e.insServiceSearch,e.insurerServiceSearchModal.insuranceId,void 0)},e.insServData=[],e.insServCodeData=[],e.insServDataVo=[],e.insServCodeDataVo=[],e.serviceCodeResp=[],e.allGridData=[],e.departmentServices=[],e.departmentServiceData=[],e.insServiceClear=function(){e.insServCodeDataVo=[],e.insServiceModal=null,e.subdepartmentData=[],e.serviceCodeData=[],e.insServDataVo=[],e.serviceCodeVo=[],e.insServData=[],e.insServCodeData=[]},e.departmentServicesDropDown=function(){var i={};i.url=a.HISCOMBOFILLING.URL,i.requestData={operation:"ExecuteQuery",destination:"QueryService",voclass:"com.napier.core.service.vo.query.QueryData",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"SERVIC_EXCL_DEPARTMENT_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{}]}]}]}]}},t.sendRestRequest(i).then(function(t){e.departmentresp=t.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"];for(var a=0;a<e.departmentresp.length;a++)e.deptMasterData[a]={departmentName:e.departmentresp[a].columnList[0]["com.napier.core.service.vo.query.Column"][1].data,departmentId:e.departmentresp[a].columnList[0]["com.napier.core.service.vo.query.Column"][0].data}})},e.subDepartmentServices=function(){var i={};i.url=a.HISCOMBOFILLING.URL,i.requestData={operation:"ExecuteQuery",destination:"QueryService",voclass:"com.napier.core.service.vo.query.QueryData",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"PAYER_SERVIC_EXCL_SUBDEPARTMENTCODE_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pDepcode",value:angular.fromJson(e.insServiceModal).departmentId}]}]}]}]}},t.sendRestRequest(i).then(function(t){if(e.subdepartmentResp=t.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"],e.subdepartmentResp&&e.subdepartmentResp.length>0){e.subdepartmentData=[];for(var a=0;a<e.subdepartmentResp.length;a++)e.subdepartmentData[a]={DESCRIPTION:e.subdepartmentResp[a].columnList[0]["com.napier.core.service.vo.query.Column"][1].data,CODE:e.subdepartmentResp[a].columnList[0]["com.napier.core.service.vo.query.Column"][0].data}}else e.subdepartmentData=[],e.subdepartmentData[0]={DESCRIPTION:e.subdepartmentResp.columnList[0]["com.napier.core.service.vo.query.Column"][1].data,CODE:e.subdepartmentResp.columnList[0]["com.napier.core.service.vo.query.Column"][0].data}})},e.serviceCodes=function(){var i={};i.url=a.HISCOMBOFILLING.URL,i.requestData={operation:"getServiceNameAndCode",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",voclass:"com.napier.core.service.vo.query.QueryData",message:{"@class":"com.napier.core.service.vo.emrmasters.ServiceNameAndCodeVoList",serviceNameAndCodeVoList:[{"com.napier.core.service.vo.emrmasters.ServiceNameAndCodeVo":e.serviceCodeVo}]}},t.sendRestRequest(i).then(function(t){if(e.serviceCodeData=[],e.departmentServiceData=[],e.serviceCodeResp=t.data.HITService.message.serviceNameAndCodeVoList[0]["com.napier.core.service.vo.emrmasters.ServiceNameAndCodeVo"],e.serviceCodeResp&&e.serviceCodeResp.length>0)for(var a=0;a<e.serviceCodeResp.length;a++)e.departmentServiceData.push({deptDesc:e.serviceCodeResp[a].deptDesc,subDeptDesc:e.serviceCodeResp[a].subDeptDesc,servCode:e.serviceCodeResp[a].serviceCode,servSeqCode:e.serviceCodeResp[a].servSeqCode,servName:e.serviceCodeResp[a].serviceName,SubDepartmentName:e.serviceCodeResp[a].subDeptDesc,deptName:e.serviceCodeResp[a].deptDesc,dept:e.serviceCodeResp[a].deptCode,SubDepartment:e.serviceCodeResp[a].subDeptCode,gnStatus:1}),e.serviceCodeData.push({CODE:e.serviceCodeResp[a].serviceCode,DESCRIPTION:e.serviceCodeResp[a].serviceName,subDeptCode:e.serviceCodeResp[a].subDeptCode,subDeptDesc:e.serviceCodeResp[a].subDeptDesc,servSeqCode:e.serviceCodeResp[a].servSeqCode});else e.serviceCodeResp&&(e.departmentServiceData.push({deptDesc:e.serviceCodeResp.deptDesc,subDeptDesc:e.serviceCodeResp.subDeptDesc,servCode:e.serviceCodeResp.serviceCode,servSeqCode:e.serviceCodeResp.servSeqCode,servName:e.serviceCodeResp.serviceName,SubDepartmentName:e.serviceCodeResp.subDeptDesc,deptName:e.serviceCodeResp.deptDesc,dept:e.serviceCodeResp.deptCode,SubDepartment:e.serviceCodeResp.subDeptCode,gnStatus:1}),e.serviceCodeData.push({CODE:e.serviceCodeResp.serviceCode,DESCRIPTION:e.serviceCodeResp.serviceName,subDeptCode:e.serviceCodeResp.subDeptCode,subDeptDesc:e.serviceCodeResp.subDeptDesc,servSeqCode:e.serviceCodeResp.servSeqCode}))})},e.changeDepartment=function(i){if(!i)return e.departmentServiceData=[],void(e.serviceCodeData=[]);var r={};r.url=a.HISCOMBOFILLING.URL,r.requestData={operation:"getServiceNameAndCode",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",voclass:"com.napier.core.service.vo.query.QueryData",message:{"@class":"com.napier.core.service.vo.emrmasters.ServiceNameAndCodeVoList",serviceNameAndCodeVoList:[{"com.napier.core.service.vo.emrmasters.ServiceNameAndCodeVo":[{deptCode:angular.fromJson(i).departmentId}]}]}},t.sendRestRequest(r).then(function(t){if(e.departmentServiceData=[],e.serviceCodeData=[],e.departmentServices=t.data.HITService.message.serviceNameAndCodeVoList[0]["com.napier.core.service.vo.emrmasters.ServiceNameAndCodeVo"],e.departmentServices=Array.isArray(e.departmentServices)?e.departmentServices:[e.departmentServices],null!=e.departmentServices[0]&&e.departmentServices.length>0)for(var a=0;a<e.departmentServices.length;a++)e.departmentServiceData.push({deptDesc:e.departmentServices[a].deptDesc,subDeptDesc:e.departmentServices[a].subDeptDesc,servCode:e.departmentServices[a].serviceCode,servSeqCode:e.departmentServices[a].servSeqCode,servName:e.departmentServices[a].serviceName,SubDepartmentName:e.departmentServices[a].subDeptDesc,deptName:e.departmentServices[a].deptDesc,dept:e.departmentServices[a].deptCode,SubDepartment:e.departmentServices[a].subDeptCode,gnStatus:1}),e.serviceCodeData.push({CODE:e.departmentServices[a].serviceCode,DESCRIPTION:e.departmentServices[a].serviceName,subDeptCode:e.departmentServices[a].subDeptCode,subDeptDesc:e.departmentServices[a].subDeptDesc,servSeqCode:e.departmentServices[a].servSeqCode})}),e.subDepartmentServices()},e.serviceCodeVo=[],e.changeSubDpt=function(t){e.serviceCodeVo=[];for(var a=0;a<e.insServData.length;a++)e.serviceCodeVo[a]={subDeptCode:e.insServData[a].CODE};e.serviceCodes()},e.changeSubCode=function(t){e.insServCodeDataVo=e.insServCodeData},e.addInsuranceService=function(){if(e.serviceIns&&(e.serviceIns="",e.insurServiceSearch(e.serviceIns)),e.insServiceSearch=[],e.insServCodeDataVo.length>0)for(var t=0;t<e.insServCodeDataVo.length;t++)if(-1==_.findIndex(e.gridOptionsService.data,function(a){return a.servSeqCode==e.insServCodeDataVo[t].servSeqCode}))e.gridOptionsService.data.push({deptDesc:angular.fromJson(e.insServiceModal).departmentName,subDeptDesc:e.insServCodeDataVo[t].subDeptDesc,servSeqCode:e.insServCodeDataVo[t].servSeqCode,servCode:e.insServCodeDataVo[t].CODE,servName:e.insServCodeDataVo[t].DESCRIPTION,SubDepartmentName:e.insServCodeDataVo[t].subDeptDesc,deptName:angular.fromJson(e.insServiceModal).departmentName,dept:angular.fromJson(e.insServiceModal).departmentId,SubDepartment:e.insServCodeDataVo[t].subDeptCode,gnStatus:1});else{var a=e.alertObjectRes.ExtRcdCntBAdded;m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else for(t=0;t<e.departmentServiceData.length;t++)if(-1==_.findIndex(e.gridOptionsService.data,function(a){return a.servSeqCode==e.departmentServiceData[t].servSeqCode}))e.gridOptionsService.data.push({deptDesc:angular.fromJson(e.insServiceModal).departmentName,subDeptDesc:e.departmentServiceData[t].SubDepartmentName,servSeqCode:e.departmentServiceData[t].servSeqCode,servCode:e.departmentServiceData[t].servCode,servName:e.departmentServiceData[t].servName,SubDepartmentName:e.departmentServiceData[t].SubDepartmentName,deptName:e.departmentServiceData[t].deptName,dept:e.departmentServiceData[t].dept,SubDepartment:e.departmentServiceData[t].SubDepartment,gnStatus:e.departmentServiceData[t].gnStatus});else{a=e.alertObjectRes.ExtRcdCntBAdded;m.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}e.insurerServiceSearchGrid=angular.copy(e.gridOptionsService.data),e.insurerServiceSearchData=[];for(t=0;t<e.gridOptionsService.data.length;t++)e.insurerServiceSearchData.push(e.gridOptionsService.data[t].servName),e.insurerServiceSearchData.push(e.gridOptionsService.data[t].servCode),e.insurerServiceSearchData.push(e.gridOptionsService.data[t].AliasCode),e.insurerServiceSearchData.push(e.gridOptionsService.data[t].AliasName);e.insServiceClear()},e.serviceCoderesponse=[]}e.$inject=["$scope","CallManager","BILLING_APIS","uiGridConstants","hisModalService","$filter","RoleTaskService","$state","dropdownQueryService","myService","$stateParams","hisTranslationsService","hisTranslationsGlobalLang","hisAlertService","hisGenericAlertService","coPayGridDef2","QueryService"],angular.module("napierContainerUi").controller("BillingCorporateController",e),angular.module("napierContainerUi").factory("myService",function(){var e=null;return{getJson:function(){return e},setJson:function(t){e=t}}})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C){var I=this;e.gridOptionsCopay=angular.copy(C),e.gridOptionsCopay.data=[],e.gridOptionsCopay.data[0]=[],v.loadModule("billing");var A=D.getLanguageToSet();function E(t){e.inServiceNameGridDetl=[],e.multipleComboDataForinServiceNameList={1:e.inServiceNameGridDetl};var a=g.executeQueryURLReset();e.inServiceNameGridDetlsLIst=new Array,g.prepareParamList(1,t,e.inServiceNameGridDetlsLIst),g.executeQueryInput("SERVER_EXCL_NAME_123_DROPDOWN",e.inServiceNameGridDetlsLIst,e.multipleComboDataForinServiceNameList,!1,!0,a,"popUp",{}).then(function(t){e.exSubDeptList=e.inServiceNameGridDetl})}function h(t){e.inServiceNameGridDetl=[],e.multipleComboDataForinServiceNameList={1:e.inServiceNameGridDetl};var a=g.executeQueryURLReset();e.inServiceNameGridDetlsLIst=new Array,g.prepareParamList(1,t,e.inServiceNameGridDetlsLIst),g.prepareParamList(2,e.myreturnedData.corpCompId?e.myreturnedData.corpCompId.toString():e.myreturnedData.insCompId.toString(),e.inServiceNameGridDetlsLIst),g.executeQueryInput("SERVIC_INCL_NAME_001_DROPDOWN",e.inServiceNameGridDetlsLIst,e.multipleComboDataForinServiceNameList,!1,!0,a,"popUp",{}).then(function(t){e.inSubDeptList=e.inServiceNameGridDetl})}function b(e){return e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]}v.changeLanguage(A),y.loadAlerts(A).then(function(t){e.alertObjectRes=t,e.alertData={buttonText:e.alertObjectRes.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}},function(e){}),I.exMaterialList=[],I.materialList=[],I.permissionList=r.rolePermission("TM_CREDIT_PAYER"),e.Status="1",e.isAdvFilterShow=!0,e.BLdisc="1",e.serDisc="1",e.Nchar="1",e.esdisc="1",e.inPatDay="1",e.Surchg="1",e.SurPrint="1",e.Copay="1",e.IPlimit="1",I.options=!1,I.serviceExclusionOptions=!1,I.materialIncNameOptions=!1,I.materialIncCodeOptions=!1,e.AddInsuranceSIGrid=angular.copy(n),e.AddInsuranceSEGrid=angular.copy(l),e.AddInsuranceMCIGrid=angular.copy(s),e.AddInsuranceMCEGrid=angular.copy(o),e.AddInsuranceTCEGrid=angular.copy(c),e.AddInsuranceTCIGrid=angular.copy(d),e.AddInsuranceSEGrid.data=[],e.AddInsuranceSIGrid.data=[],e.AddInsuranceMCEGrid.data=[],e.AddInsuranceMCIGrid.data=[],e.cloneData={},e.AddInsuranceSIGrid.onRegisterApi=function(t){e.gridSI=t,t.selection.on.rowSelectionChanged(e,function(t){e.dataSelected1=e.gridSI.selection.getSelectedRows()})},e.flagVariable=!1,e.flagClick=function(t,a){t.entity.isFlagStatus=2,e.flagVariable=!e.flagVariable,1==e.flagVariable?t.entity.isFlagStatus=1:t.entity.isFlagStatus=2},e.multiFlag=function(t){if(e.dataSelected1=e.gridSI.selection.getSelectedRows(),e.dataSelected1.length==e.AddInsuranceSIGrid.data.length&&1==t?I.showFlag=!1:e.dataSelected1.length==e.AddInsuranceSIGrid.data.length&&2==t&&(I.showFlag=!0),1==t)for(var a=0;a<e.dataSelected1.length;a++)e.dataSelected1[a].isFlagStatus=1;else if(2==t)for(a=0;a<e.dataSelected1.length;a++)e.dataSelected1[a].isFlagStatus=2},e.isInsurancePlanDetailsShow=!0,e.isPlanAttributesShow=!1,e.isServiceInclusionsShow=!1,e.isMaterialConsumablesInclusionShow=!1,e.isMaterialConsumablesExclusionShow=!1,e.isTarfffClassInclusionShow=!1,e.isTarfffClassExclusionShow=!1,e.arrowRight='<i class="his-section-heading-icon pull-right fa fa-angle-double-right fa-2x" aria-hidden="true"></i>',e.arrowDown='<i class="his-section-heading-icon pull-right fa fa-angle-double-down fa-2x" aria-hidden="true"></i>',e.myreturnedData=m.getJson(),(e.updateSaveVariable=null!=e.myreturnedData)&&(e.updateSaveVariable=e.myreturnedData.planSeqId),e.loadCombos=function(){var t=[{paramName:"pComId",value:e.myreturnedData.corpCompId?e.myreturnedData.corpCompId.toString():e.myreturnedData.insCompId.toString()}],a=[{paramName:"pPayerType",value:e.myreturnedData.payerType}];p.getList("SERVIC_INCL_DEPARTMENT_DROPDOWN",t).then(function(t){var a=b(t);if(e.deptObj={Code:null,Desc:null},e.deptcomboList=[],a.length>0)angular.forEach(a,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"];e.deptObj={Code:i[0].data,Desc:i[1].data},e.deptcomboList.push(e.deptObj)});else{var i={Code:a.columnList[0]["com.napier.core.service.vo.query.Column"][0].data,Desc:a.columnList[0]["com.napier.core.service.vo.query.Column"][1].data};e.deptcomboList.push(i)}}),p.getList("SERVIC_EXCL_DEPARTMENT_DROPDOWN",[{}]).then(function(t){var a=b(t);if(e.deptcomboExtList=[],a.length>0)angular.forEach(a,function(t,a){if(t){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"],r={Code:i[0].data,Desc:i[1].data};e.deptcomboExtList.push(r)}});else{var i={Code:a.columnList[0]["com.napier.core.service.vo.query.Column"][0].data,Desc:a.columnList[0]["com.napier.core.service.vo.query.Column"][1].data};e.deptcomboExtList.push(i)}}),p.getList("INC_PLAN_AGREEMENT_DROP_DOWEN",[{}]).then(function(t){var a=b(t);a=Array.isArray(a)?a:[a];e.agreementObj={Code:null,Desc:null},e.agreementComboList=[],angular.forEach(a,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"];e.agreementObj={Code:i[0].data,Desc:i[1].data},e.agreementComboList.push(e.agreementObj)})}),p.getList("INC_PLAN_BENEFIETS_DROP_DOWEN",[{}]).then(function(t){var a=b(t);a=Array.isArray(a)?a:[a];e.benefitObj={Code:null,Desc:null},e.benefitComboList=[],angular.forEach(a,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"];e.benefitObj={Code:i[0].data,Desc:i[1].data},e.benefitComboList.push(e.benefitObj)})}),p.getList("TARIFF_CATG_DROP_DOWEN",[{}]).then(function(t){var a=b(t);a=Array.isArray(a)?a:[a];e.tariffObj={Code:null,Desc:null},e.tariffComboList=[],angular.forEach(a,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"];e.tariffObj={Code:i[0].data,Desc:i[1].data},e.tariffComboList.push(e.tariffObj)})}),p.getList("INC_PLAN_DROP_DOWEN",a).then(function(t){var a=b(t);a=Array.isArray(a)?a:[a];e.cloneObj={Code:null,Desc:null},e.cloneComboList=[],angular.forEach(a,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"];e.cloneObj={Code:i[0].data,Desc:i[1].data},e.cloneComboList.push(e.cloneObj)})}),p.getList("TARIFF_NAME_DROP_DOWEN",[{}]).then(function(t){var a=b(t);a=Array.isArray(a)?a:[a];e.tariffNameObj={},e.tariffNameComboList=[],angular.forEach(a,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"];e.tariffNameObj={DESCRIPTION:i[0].data,CODE:i[1].data,GN_STATUS:i[2].data},e.tariffNameComboList.push(e.tariffNameObj)})}),p.getList("PAYER_MATRIAL_NAME_DROPDOWN",[{}]).then(function(t){var a=b(t);a=Array.isArray(a)?a:[a];if(e.materialMainGroupObj={mtrGrpsedId:null,materialMainGroup:null},e.materialMainGroupComboList=[],a.length>0)angular.forEach(a,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"];e.materialMainGroupObj={mtrGrpsedId:i[0].data,materialMainGroup:i[1].data},e.materialMainGroupComboList.push(e.materialMainGroupObj)});else{var i={mtrGrpsedId:a.columnList[0]["com.napier.core.service.vo.query.Column"][0].data,materialMainGroup:a.columnList[0]["com.napier.core.service.vo.query.Column"][1].data};e.materialMainGroupComboList.push(i)}}),p.getList("TARIFF_NAME_DROP_DOWEN",[{}]).then(function(t){var a=b(t);a=Array.isArray(a)?a:[a];e.tariffNameExObj={CODE:null,DESCRIPTION:null,GN_STATUS:null},e.tariffNameExComboList=[],angular.forEach(a,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"];e.tariffNameExObj={DESCRIPTION:i[0].data,CODE:i[1].data,GN_STATUS:i[2].data},e.tariffNameExComboList.push(e.tariffNameExObj)})})},e.loadCombos(),I.loadCoPayCombo=function(){I.psgdwn_copay=[],I.deptdwn_copay=[],I.coPayQueryMap={1:I.deptdwn_copay,2:I.psgdwn_copay};var e=g.executeQueryURLReset(),t=new Array;g.executeQueryInput("SERVIC_EXCL_DEPARTMENT_DROPDOWN_NEW",t,I.coPayQueryMap,!0,!1,e,"popUp",{});var a=new Array;g.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,a),g.executeQueryInput("SCM_SERV_002_SCM_1",a,I.coPayQueryMap,!0,!0,e,"popUp",{}).then(function(e){})},I.loadCoPayCombo(),I.deptSpecicityService=[],I.OnChangeDept=function(t,a){I.deptSpecicityService[a]=[],I.specilityMap={1:I.deptSpecicityService[a]};var i=g.executeQueryURLReset(),r=new Array;g.prepareParamListWithParam("PDept_Code",t.CODE,r),g.prepareParamListWithParam("pPracticeid",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r),g.executeQueryInput("GET_DEPT_SPECIALITY_SERCH",r,I.specilityMap,!0,!0,i,"popUp",{}).then(function(t){t[1][0]&&e.gridOptionsCopay.data[a].speciality&&e.gridOptionsCopay.data[a].speciality.CODE&&(e.gridOptionsCopay.data[a].speciality=_.find(I.deptSpecicityService[a],function(t){return t.CODE==e.gridOptionsCopay.data[a].speciality.CODE}))})},I.serchCopayResult={},I.serchOptimSpeciSerch=function(e,t){I.optServSerch=[],I.copayserviceMap={1:I.optServSerch};var a=g.executeQueryURLReset(),i=new Array;return g.prepareParamListWithParam("PSerrv_Name",e,i),g.executeQueryInput("SPECIALITY_SERVICE_SERCH",i,I.copayserviceMap,!0,!0,a,"popUp",{}).then(function(e){if(e[1])return I.optServSerch.map(function(e){return I.serchCopayResult=e,e})})},I.serchOptimSpeciSerch(""),I.setCopayService=function(t,a){e.gridOptionsCopay.data[a]=[],e.gridOptionsCopay.data[a].service={},e.gridOptionsCopay.data[a].primayServiceGroup={},e.gridOptionsCopay.data[a].department={},e.gridOptionsCopay.data[a].speciality={},e.gridOptionsCopay.data[a].primayServiceGroup.CODE=t.PRI_SERV_CODE,e.gridOptionsCopay.data[a].primayServiceGroup.DESCRIPTION=t.PRI_SERV_DESC,e.gridOptionsCopay.data[a].department.CODE=t.DEPT_CODE,e.gridOptionsCopay.data[a].department.DESCRIPTION=t.SEPT_DESC,e.gridOptionsCopay.data[a].speciality.CODE=t.SPL_CODE,e.gridOptionsCopay.data[a].speciality.DESCRIPTION=t.SPL_DESC,I.OnChangeDept(e.gridOptionsCopay.data[a].department,a),e.gridOptionsCopay.data[a].service.SERV_CODE=t.SERV_CODE,e.gridOptionsCopay.data[a].service.SERV_NAME=t.SERV_NAME,e.gridOptionsCopay.data[a].service.SERV_SEQ_ID=t.SERV_SEQ_ID},I.copayServiceGridList=function(t,a){if(e.gridOptionsCopay.data&&e.gridOptionsCopay.data.length>1)for(var i=!1,r=!1,n=!1,l=e.gridOptionsCopay.data,s=1;s<l.length;s++)if(l[s].primayServiceGroup&&t.primayServiceGroup&&l[s].primayServiceGroup.CODE==t.primayServiceGroup.CODE&&(i=!0),i&&(r=l[s].department==t.department||null!=t.department&&null!=l[s].department&&l[s].department.CODE==t.department.CODE),r&&(n=l[s].speciality==t.speciality||null!=t.speciality&&null!=l[s].speciality&&l[s].speciality.CODE==t.speciality.CODE||null==l[s].speciality&&null!=t.speciality),i){if(r&&n)return void f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,"Copay Already Exist",!1,!1,e.close,2e3)}else if(r&&n)return void f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,"Copay Already Exist",!1,!1,e.close,2e3);if(null!=t.primayServiceGroup)if(null!=t.copayment){var o={primayServiceGroup:t.primayServiceGroup,isFirstRow:!0,isEditable:!0};null!=t.department&&(o.department=t.department),null!=t.speciality&&(o.speciality=t.speciality),null!=t.service&&(o.service=t.service),null!=t.copayment&&(o.copayment=t.copayment),null!=t.copaySeqId&&(o.copaySeqId=t.copaySeqId),t.maxCopay&&(o.maxCopay=t.maxCopay),I.deptSpecicityService[e.gridOptionsCopay.data.length]=I.deptSpecicityService[0],e.gridOptionsCopay.data.push(o),e.gridOptionsCopay.data[0]={isFirstRow:!1,isEditable:!1}}else f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,"Please enter the copay percentage",!1,!1,e.close,2e3);else f.warning("warning","Please select primary service group")},I.setcopayGridEdit=function(t,a){e.gridOptionsCopay.data[a].isEditable=!1},I.loadCopay=function(e){},I.loadCopay("002"==e.myreturnedData.payerType?e.myreturnedData.insCompId:e.myreturnedData.corpCompId?e.myreturnedData.corpCompId.toString():e.myreturnedData.insCompId.toString()),e.copyData=[],I.delete=function(t,a){e.gridOptionsCopay.data.splice(a,1),t.actions=2,t.copaySeqId&&e.copyData.push(t)},I.clear=function(){e.gridOptionsCopay.data[0]={isFirstRow:!1,isEditable:!1}},e.getsubdepts=function(t){delete I.exSubdept,delete I.exServiceName,e.ExDept=t,e.exSubDeptGridDetl=[],e.exSubDeptList=[],e.multipleComboDataForExSubDeptList={1:e.exSubDeptGridDetl};var a=g.executeQueryURLReset();e.exSubDeptGridDetlsLIst=new Array,g.prepareParamListWithParam("pDepcode",t,e.exSubDeptGridDetlsLIst),g.executeQueryInput("PAYER_SERVIC_EXCL_SUBDEPARTMENTCODE_DROPDOWN",e.exSubDeptGridDetlsLIst,e.multipleComboDataForExSubDeptList,!0,!0,a,"popUp").then(function(e){E(t)})},e.exSubDeptList=[],e.getserviceNames=function(t){if(delete I.exServiceName,e.exSubDeptIds=[],e.exSubDeptList=[],0!=t.length){for(var a=0;a<t.length;a++)e.exSubDeptIds.push(t[a].gQDataCode);e.abcd=e.exSubDeptIds.toString(),e.exServiceNameGridDetl=[],e.multipleComboDataForExServiceNameList={1:e.exServiceNameGridDetl};var i=g.executeQueryURLReset();e.exServiceNameGridDetlsLIst=new Array,g.prepareParamList(1,e.ExDept,e.exServiceNameGridDetlsLIst),g.prepareParamList(2,e.abcd,e.exServiceNameGridDetlsLIst),g.executeQueryInput("SERVER_EXCL_NAME_234_DROPDOWN",e.exServiceNameGridDetlsLIst,e.multipleComboDataForExServiceNameList,!0,!0,i,"popUp",e.AddInsuranceSEGrid).then(function(t){e.exSubDeptList=e.exServiceNameGridDetl})}else E(e.ExDept)},e.exServicelist=[],e.getExServiceList=function(t){e.exServicelist=[];for(var a=0;a<t.length;a++)e.exServicelist.push(t[a])},e.ExServiceAdd=function(){if(e.exSubDeptList.length>0&&0==e.exServicelist.length)if(e.AddInsuranceSIGrid.data.length>0||e.AddInsuranceSEGrid.data.length>0)for(var t=0;t<e.exSubDeptList.length;t++){if(-1==_.findIndex(e.AddInsuranceSIGrid.data,function(a){return a.SERV_SEQ_ID==e.exSubDeptList[t].SERV_SEQ_ID}))if(-1==_.findIndex(e.AddInsuranceSEGrid.data,function(a){return a.SERV_SEQ_ID==e.exSubDeptList[t].SERV_SEQ_ID}))e.AddInsuranceSEGrid.data.push(e.exSubDeptList[t]);else{var a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(-1!=_.findIndex(e.AddInsuranceSIGrid.data,function(a){return a.SERV_SEQ_ID==e.exSubDeptList[t].SERV_SEQ_ID&&2==a.GN_STATUS})){if(-1==_.findIndex(e.AddInsuranceSEGrid.data,function(a){return a.SERV_SEQ_ID==e.exSubDeptList[t].SERV_SEQ_ID}))e.AddInsuranceSEGrid.data.push(e.exSubDeptList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{a=e.alertObjectRes.RcdAldyExtInInclsn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else for(t=0;t<e.exSubDeptList.length;t++){if(-1==_.findIndex(e.AddInsuranceSEGrid.data,function(a){return a.SERV_SEQ_ID==e.exSubDeptList[t].SERV_SEQ_ID}))e.AddInsuranceSEGrid.data.push(e.exSubDeptList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{if(!(e.exServicelist.length>0)){a=e.alertObjectRes.noRcrdFound;return void f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}if(e.AddInsuranceSIGrid.data.length>0||e.AddInsuranceSEGrid.data.length>0)for(t=0;t<e.exServicelist.length;t++){if(-1==_.findIndex(e.AddInsuranceSIGrid.data,function(a){return a.SERV_SEQ_ID==e.exServicelist[t].SERV_SEQ_ID}))if(-1==_.findIndex(e.AddInsuranceSEGrid.data,function(a){return a.SERV_SEQ_ID==e.exServicelist[t].SERV_SEQ_ID}))e.AddInsuranceSEGrid.data.push(e.exServicelist[t]);else{var a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(-1!=_.findIndex(e.AddInsuranceSIGrid.data,function(a){return a.SERV_SEQ_ID==e.exServicelist[t].SERV_SEQ_ID&&2==a.GN_STATUS})){if(-1==_.findIndex(e.AddInsuranceSEGrid.data,function(a){return a.SERV_SEQ_ID==e.exServicelist[t].SERV_SEQ_ID}))e.AddInsuranceSEGrid.data.push(e.exServicelist[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{a=e.alertObjectRes.RcdAldyExtInInclsn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else for(t=0;t<e.exServicelist.length;t++){if(-1==_.findIndex(e.AddInsuranceSEGrid.data,function(a){return a.SERV_SEQ_ID==e.exServicelist[t].SERV_SEQ_ID}))e.AddInsuranceSEGrid.data.push(e.exServicelist[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}}delete I.exDept,delete I.exSubdept,delete I.exServiceName,e.exSubDeptList=[],e.exServicelist=[]},e.getINSubDept=function(t){delete I.subdept,delete I.insServiceName,e.deptIns=t,e.inSubDeptList=[],e.InServicelist=[],e.inSubDeptGridDetl=[],e.multipleComboDataForInSubDeptList={1:e.inSubDeptGridDetl};var a=g.executeQueryURLReset();e.inSubDeptGridDetlsLIst=new Array,g.prepareParamListWithParam("pDepcode",t,e.inSubDeptGridDetlsLIst),g.prepareParamListWithParam("pComId",e.myreturnedData.corpCompId?e.myreturnedData.corpCompId.toString():e.myreturnedData.insCompId.toString(),e.inSubDeptGridDetlsLIst),g.executeQueryInput("PAYER_SERVIC_INCL_SUBDEPARTMENTCODE_DROPDOWN",e.inSubDeptGridDetlsLIst,e.multipleComboDataForInSubDeptList,!1,!0,a,"popUp"),h(t)},e.inServiceNamecomboList=[],e.inSubDeptList=[],e.getINServiceNames=function(t){if(delete I.insServiceName,e.sunDeptIds=[],0!=t.length){for(var a=0;a<t.length;a++)e.sunDeptIds.push(t[a].gQDataCode);e.inServiceNameGridDetl=[],e.multipleComboDataForinServiceNameList={1:e.inServiceNameGridDetl};var i=g.executeQueryURLReset();e.inServiceNameGridDetlsLIst=new Array,g.prepareParamList(1,e.deptIns,e.inServiceNameGridDetlsLIst),g.prepareParamList(2,e.sunDeptIds.toString(),e.inServiceNameGridDetlsLIst),g.prepareParamList(3,e.myreturnedData.corpCompId?e.myreturnedData.corpCompId.toString():e.myreturnedData.insCompId.toString(),e.inServiceNameGridDetlsLIst),g.executeQueryInput("SERVIC_INCL_NAME_002_DROPDOWN",e.inServiceNameGridDetlsLIst,e.multipleComboDataForinServiceNameList,!0,!0,i,"popUp",e.AddInsuranceSIGrid).then(function(t){e.inSubDeptList=e.inServiceNameGridDetl})}else h(e.deptIns)},e.InServicelist=[],e.serviceNamesMethod=function(t){e.InServicelist=[];for(var a=0;a<t.length;a++)e.InServicelist.push(t[a])},e.InServiceAdd=function(){if(e.inSubDeptList.length>0&&0==e.InServicelist.length)if(e.AddInsuranceSEGrid.data.length>0||e.AddInsuranceSIGrid.data.length>0)for(var t=0;t<e.inSubDeptList.length;t++){if(-1==_.findIndex(e.AddInsuranceSEGrid.data,function(a){return a.SERV_SEQ_ID==e.inSubDeptList[t].SERV_SEQ_ID}))if(-1==_.findIndex(e.AddInsuranceSIGrid.data,function(a){return a.SERV_SEQ_ID==e.inSubDeptList[t].SERV_SEQ_ID}))e.inSubDeptList[t].SER_SEQ_ID=angular.copy(e.inSubDeptList[t].SERV_CODE),e.AddInsuranceSIGrid.data.push(e.inSubDeptList[t]);else{var a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(-1!=_.findIndex(e.AddInsuranceSEGrid.data,function(a){return a.SERV_SEQ_ID==e.inSubDeptList[t].SERV_SEQ_ID&&2==a.GN_STATUS})){if(-1==_.findIndex(e.AddInsuranceSIGrid.data,function(a){return a.SERV_SEQ_ID==e.inSubDeptList[t].SERV_SEQ_ID}))e.inSubDeptList[t].SER_SEQ_ID=angular.copy(e.inSubDeptList[t].SERV_CODE),e.AddInsuranceSIGrid.data.push(e.inSubDeptList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{a=e.alertObjectRes.RcdAldExtInExclusn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else for(t=0;t<e.inSubDeptList.length;t++){if(e.inSubDeptList[t].SER_SEQ_ID=angular.copy(e.inSubDeptList[t].SERV_CODE),-1==_.findIndex(e.AddInsuranceSIGrid.data,function(a){return a.SERV_SEQ_ID==e.inSubDeptList[t].SERV_SEQ_ID}))e.AddInsuranceSIGrid.data.push(e.inSubDeptList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{if(!(e.InServicelist.length>0)){a=e.alertObjectRes.noRcrdFound;return void f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}if(e.AddInsuranceSEGrid.data.length>0||e.AddInsuranceSIGrid.data.length>0)for(t=0;t<e.InServicelist.length;t++){if(-1==_.findIndex(e.AddInsuranceSEGrid.data,function(a){return a.SERV_SEQ_ID==e.InServicelist[t].SERV_SEQ_ID}))if(-1==_.findIndex(e.AddInsuranceSIGrid.data,function(a){return a.SERV_SEQ_ID==e.InServicelist[t].SERV_SEQ_ID}))e.InServicelist[t].SER_SEQ_ID=angular.copy(e.InServicelist[t].SERV_CODE),e.AddInsuranceSIGrid.data.push(e.InServicelist[t]);else{var a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(-1!=_.findIndex(e.AddInsuranceSEGrid.data,function(a){return a.SERV_SEQ_ID==e.InServicelist[t].SERV_SEQ_ID&&2==a.GN_STATUS})){if(-1==_.findIndex(e.AddInsuranceSIGrid.data,function(a){return a.SERV_SEQ_ID==e.InServicelist[t].SERV_SEQ_ID}))e.InServicelist[t].SER_SEQ_ID=angular.copy(e.InServicelist[t].SERV_CODE),e.AddInsuranceSIGrid.data.push(e.InServicelist[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{a=e.alertObjectRes.RcdAldExtInExclusn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else for(t=0;t<e.InServicelist.length;t++){if(e.InServicelist[t].SER_SEQ_ID=angular.copy(e.InServicelist[t].SERV_CODE),-1==_.findIndex(e.AddInsuranceSIGrid.data,function(a){return a.SERV_SEQ_ID==e.InServicelist[t].SERV_SEQ_ID}))e.AddInsuranceSIGrid.data.push(e.InServicelist[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}}delete I.dept,delete I.subdept,delete I.insServiceName,e.inSubDeptList=[],e.InServicelist=[]},e.exclusionTariffData=[],e.tariffInAdd=function(){if(e.exclusionTariffData=I.tariffName,e.exclusionTariffData.length>0)if(e.AddInsuranceTCEGrid.data.length>0||e.AddInsuranceTCIGrid.data.length>0)for(var t=0;t<e.exclusionTariffData.length;t++){if(-1==_.findIndex(e.AddInsuranceTCEGrid.data,function(a){return a.CODE==e.exclusionTariffData[t].CODE}))if(-1==_.findIndex(e.AddInsuranceTCIGrid.data,function(a){return a.CODE==e.exclusionTariffData[t].CODE}))e.AddInsuranceTCIGrid.data.push(e.exclusionTariffData[t]);else{var a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(-1!=_.findIndex(e.AddInsuranceTCEGrid.data,function(a){return a.CODE==e.exclusionTariffData[t].CODE&&2==a.GN_STATUS})){if(-1==_.findIndex(e.AddInsuranceTCIGrid.data,function(a){return a.CODE==e.exclusionTariffData[t].CODE}))e.AddInsuranceTCIGrid.data.push(e.exclusionTariffData[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{a=e.alertObjectRes.RcdAldExtInExclusn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else for(t=0;t<e.exclusionTariffData.length;t++){if(-1==_.findIndex(e.AddInsuranceTCIGrid.data,function(a){return a.CODE==e.exclusionTariffData[t].CODE}))e.AddInsuranceTCIGrid.data.push(e.exclusionTariffData[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}delete I.tariffName,delete I.tariffCode,e.tariffINFinalList=[],e.tariffInCodecomboList=[]},e.inclusionTariffData=[],e.tariffExAdd=function(){if(e.inclusionTariffData=I.tariffNameEx,e.inclusionTariffData.length>0)if(e.AddInsuranceTCIGrid.data.length>0||e.AddInsuranceTCEGrid.data.length>0)for(var t=0;t<e.inclusionTariffData.length;t++){if(-1==_.findIndex(e.AddInsuranceTCIGrid.data,function(a){return a.CODE==e.inclusionTariffData[t].CODE}))if(-1==_.findIndex(e.AddInsuranceTCEGrid.data,function(a){return a.CODE==e.inclusionTariffData[t].CODE}))e.AddInsuranceTCEGrid.data.push(e.inclusionTariffData[t]);else{var a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(-1!=_.findIndex(e.AddInsuranceTCIGrid.data,function(a){return a.CODE==e.inclusionTariffData[t].CODE&&2==a.GN_STATUS}))if(-1==_.findIndex(e.AddInsuranceTCEGrid.data,function(a){return a.CODE==e.inclusionTariffData[t].CODE}))e.AddInsuranceTCEGrid.data.push(e.inclusionTariffData[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else{a=e.alertObjectRes.RcdAldyExtInInclsn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else for(t=0;t<e.inclusionTariffData.length;t++)if(-1==_.findIndex(e.AddInsuranceTCEGrid.data,function(a){return a.CODE==e.inclusionTariffData[t].CODE}))e.AddInsuranceTCEGrid.data.push(e.inclusionTariffData[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}delete I.tariffNameEx,delete I.tariffCodeEx,e.tariffEXFinalList=[],e.tariffEXCodecomboList=[]};u.getGridData({servCode:""}).then(function(t){var a=t.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceServiceVo"];e.serviceExcIncCount=a.length}),e.getMaterialSubGroup=function(t){delete I.materialSubGroup,delete I.mtrLName,e.materialsMainId=t,I.materialSubList=[],e.mISubGridDetls=[],I.materialList=[],e.multipleComboDataForMISubList={1:e.mISubGridDetls};var a=g.executeQueryURLReset();e.mISubGridDetlsLIst=new Array,g.prepareParamListWithParam("pDepcode",e.materialsMainId,e.mISubGridDetlsLIst),g.executeQueryInput("PAYER_MATERIAL_SUBGRPCODE_DROPDOWN",e.mISubGridDetlsLIst,e.multipleComboDataForMISubList,!0,!0,a,"popUp").then(function(t){t[1]&&(I.materialSubList=e.mISubGridDetls)}),e.mIMGridDetls1=[],e.multipleComboDataForMIMList={1:e.mIMGridDetls1};var i=g.executeQueryURLReset();e.mIMGridDetlsLIst=new Array,g.prepareParamList(1,e.materialsMainId,e.mIMGridDetlsLIst),g.executeQueryInput("MATRIAL_NAME_001_DROPDOWN",e.mIMGridDetlsLIst,e.multipleComboDataForMIMList,!0,!0,i,"popUp",{}).then(function(t){I.materialList=angular.copy(e.mIMGridDetls1)})},e.getMaterialServiceName=function(t){if(I.materialList=[],delete I.mtrLName,e.MISubIds=[],0==t.length){e.mIMGridDetls1=[],e.multipleComboDataForMIMList={1:e.mIMGridDetls1};var a=g.executeQueryURLReset();return e.mIMGridDetlsLIst=new Array,g.prepareParamList(1,e.materialsMainId,e.mIMGridDetlsLIst),void g.executeQueryInput("MATRIAL_NAME_001_DROPDOWN",e.mIMGridDetlsLIst,e.multipleComboDataForMIMList,!0,!0,a,"popUp",{}).then(function(t){I.materialList=angular.copy(e.mIMGridDetls1)})}for(var i=0;i<t.length;i++)e.MISubIds.push(t[i].gQDataCode);e.MISubIds1=e.MISubIds.toString(),e.mIMaterialGridDetls=[],e.multipleComboDataForMIMaterialList={1:e.mIMaterialGridDetls};var r=g.executeQueryURLReset();e.mIMaterialGridDetlsLIst=new Array,g.prepareParamList(1,e.materialsMainId,e.mIMaterialGridDetlsLIst),g.prepareParamList(2,e.MISubIds1,e.mIMaterialGridDetlsLIst),g.executeQueryInput("MATRIAL_NAME_002_DROPDOWN",e.mIMaterialGridDetlsLIst,e.multipleComboDataForMIMaterialList,!0,!0,r,"popUp",e.AddInsuranceMCIGrid).then(function(t){I.materialList=e.mIMaterialGridDetls})},e.materialsFinalList=[],e.getMaterialsList=function(t){e.materialsFinalList=[];for(var a=0;a<t.length;a++)e.materialsFinalList.push(t[a])},e.materialIncData=[],e.materialIncAdd=function(){if(I.materialList.length>0&&0==e.materialsFinalList.length)if(e.AddInsuranceMCEGrid.data.length>0||e.AddInsuranceMCIGrid.data.length>0)for(var t=0;t<I.materialList.length;t++){if(-1==_.findIndex(e.AddInsuranceMCEGrid.data,function(e){return e.MATERIALCODE==I.materialList[t].MATERIALCODE}))if(-1==_.findIndex(e.AddInsuranceMCIGrid.data,function(e){return e.MATERIALCODE==I.materialList[t].MATERIALCODE}))e.AddInsuranceMCIGrid.data.push(I.materialList[t]);else{var a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(-1!=_.findIndex(e.AddInsuranceMCEGrid.data,function(e){return e.MATERIALCODE==I.materialList[t].MATERIALCODE&&2==e.GN_STATUS})){if(-1==_.findIndex(e.AddInsuranceMCIGrid.data,function(e){return e.MATERIALCODE==I.materialList[t].MATERIALCODE}))e.AddInsuranceMCIGrid.data.push(I.materialList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{a=e.alertObjectRes.RcdAldExtInExclusn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else for(t=0;t<I.materialList.length;t++){if(-1==_.findIndex(e.AddInsuranceMCIGrid.data,function(e){return e.MATERIALCODE==I.materialList[t].MATERIALCODE}))e.AddInsuranceMCIGrid.data.push(I.materialList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{if(!(e.materialsFinalList.length>0)){a=e.alertObjectRes.noRcrdFound;return void f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}if(e.AddInsuranceMCEGrid.data.length>0||e.AddInsuranceMCIGrid.data.length>0)for(t=0;t<e.materialsFinalList.length;t++){if(-1==_.findIndex(e.AddInsuranceMCEGrid.data,function(a){return a.MATERIALCODE==e.materialsFinalList[t].MATERIALCODE}))if(-1==_.findIndex(e.AddInsuranceMCIGrid.data,function(a){return a.MATERIALCODE==e.materialsFinalList[t].MATERIALCODE}))e.AddInsuranceMCIGrid.data.push(e.materialsFinalList[t]);else{var a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(-1!=_.findIndex(e.AddInsuranceMCEGrid.data,function(a){return a.MATERIALCODE==e.materialsFinalList[t].MATERIALCODE&&2==a.GN_STATUS})){if(-1==_.findIndex(e.AddInsuranceMCIGrid.data,function(a){return a.MATERIALCODE==e.materialsFinalList[t].MATERIALCODE}))e.AddInsuranceMCIGrid.data.push(e.materialsFinalList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{a=e.alertObjectRes.RcdAldExtInExclusn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else for(t=0;t<e.materialsFinalList.length;t++){if(-1==_.findIndex(e.AddInsuranceMCIGrid.data,function(a){return a.MATERIALCODE==e.materialsFinalList[t].MATERIALCODE}))e.AddInsuranceMCIGrid.data.push(e.materialsFinalList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}}delete I.materialMainGroup,delete I.materialSubGroup,delete I.mtrLName,e.materialsFinalList=[],I.materialList=[]},e.getExMaterialSubGroup=function(t){I.exMaterialSubList=[],I.exMaterialList=[],delete I.exMaterialSubGroup,delete I.exMtrLName,e.exMaterialsMainId=t,e.mExSubGridDetls=[],e.multipleComboDataForMEXSubList={1:e.mExSubGridDetls};var a=g.executeQueryURLReset();e.mExSubGridDetlsLIst=new Array,g.prepareParamListWithParam("pDepcode",e.exMaterialsMainId,e.mExSubGridDetlsLIst),g.executeQueryInput("PAYER_MATERIAL_SUBGRPCODE_DROPDOWN",e.mExSubGridDetlsLIst,e.multipleComboDataForMEXSubList,!0,!0,a,"popUp").then(function(t){I.exMaterialSubList=e.mExSubGridDetls}),e.meIMGridDetls1=[],e.multipleComboDataForMIMList={1:e.meIMGridDetls1};var i=g.executeQueryURLReset();e.mIMEGridDetlsLIst1=new Array,g.prepareParamList(1,e.exMaterialsMainId,e.mIMEGridDetlsLIst1),g.executeQueryInput("MATRIAL_NAME_001_DROPDOWN",e.mIMEGridDetlsLIst1,e.multipleComboDataForMIMList,!0,!0,i,"popUp",e.AddInsuranceMCEGrid).then(function(t){I.exMaterialList=angular.copy(e.meIMGridDetls1)})},e.getExMaterialServiceName=function(t){if(I.exMaterialList=[],e.MExSubIds1=[],delete I.exMtrLName,e.MExSubIds=[],0==t.length){e.mIMGridDetls1=[],e.multipleComboDataForMIMList={1:e.mIMGridDetls1};var a=g.executeQueryURLReset();return e.mIMGridDetlsLIst=new Array,g.prepareParamList(1,e.materialsMainId,e.mIMGridDetlsLIst),void g.executeQueryInput("MATRIAL_NAME_001_DROPDOWN",e.mIMGridDetlsLIst,e.multipleComboDataForMIMList,!0,!0,a,"popUp",{}).then(function(t){I.exMaterialList=angular.copy(e.mIMGridDetls1)})}for(var i=0;i<t.length;i++)e.MExSubIds.push(t[i].gQDataCode);e.MExSubIds1=e.MExSubIds.toString(),e.mExMaterialGridDetls=[],e.multipleComboDataForMExMaterialList={1:e.mExMaterialGridDetls};var r=g.executeQueryURLReset();e.mExMaterialGridDetlsLIst=new Array,g.prepareParamList(1,e.exMaterialsMainId,e.mExMaterialGridDetlsLIst),g.prepareParamList(2,e.MExSubIds1,e.mExMaterialGridDetlsLIst),g.executeQueryInput("MATRIAL_NAME_002_DROPDOWN",e.mExMaterialGridDetlsLIst,e.multipleComboDataForMExMaterialList,!0,!0,r,"popUp",e.AddInsuranceMCEGrid).then(function(t){I.exMaterialList=e.mExMaterialGridDetls})},e.exMaterialsFinalList=[],e.getExMaterialsList=function(t){e.exMaterialsFinalList=[];for(var a=0;a<t.length;a++)e.exMaterialsFinalList.push(t[a])},e.mEXMGidDetails=[],e.exMaterialIncAdd=function(){if(I.exMaterialList.length>0&&0==e.exMaterialsFinalList.length)if(e.AddInsuranceMCIGrid.data.length>0||e.AddInsuranceMCEGrid.data.length>0)for(var t=0;t<I.exMaterialList.length;t++){if(-1==_.findIndex(e.AddInsuranceMCIGrid.data,function(e){return e.MATERIALCODE==I.exMaterialList[t].MATERIALCODE}))if(-1==_.findIndex(e.AddInsuranceMCEGrid.data,function(e){return e.MATERIALCODE==I.exMaterialList[t].MATERIALCODE}))e.AddInsuranceMCEGrid.data.push(I.exMaterialList[t]);else{var a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(-1!=_.findIndex(e.AddInsuranceMCIGrid.data,function(e){return e.MATERIALCODE==I.exMaterialList[t].MATERIALCODE&&2==e.GN_STATUS})){if(-1==_.findIndex(e.AddInsuranceMCEGrid.data,function(e){return e.MATERIALCODE==I.exMaterialList[t].MATERIALCODE}))e.AddInsuranceMCEGrid.data.push(I.exMaterialList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{a=e.alertObjectRes.RcdAldyExtInInclsn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else for(t=0;t<I.exMaterialList.length;t++){if(-1==_.findIndex(e.AddInsuranceMCEGrid.data,function(e){return e.MATERIALCODE==I.exMaterialList[t].MATERIALCODE}))e.AddInsuranceMCEGrid.data.push(I.exMaterialList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{if(!(e.exMaterialsFinalList.length>0)){a=e.alertObjectRes.noRcrdFound;return void f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}if(e.AddInsuranceMCIGrid.data.length>0||e.AddInsuranceMCEGrid.data.length>0)for(t=0;t<e.exMaterialsFinalList.length;t++){if(-1==_.findIndex(e.AddInsuranceMCIGrid.data,function(a){return a.MATERIALCODE==e.exMaterialsFinalList[t].MATERIALCODE}))if(-1==_.findIndex(e.AddInsuranceMCEGrid.data,function(a){return a.MATERIALCODE==e.exMaterialsFinalList[t].MATERIALCODE}))e.AddInsuranceMCEGrid.data.push(e.exMaterialsFinalList[t]);else{var a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(-1!=_.findIndex(e.AddInsuranceMCIGrid.data,function(a){return a.MATERIALCODE==e.exMaterialsFinalList[t].MATERIALCODE&&2==a.GN_STATUS})){if(-1==_.findIndex(e.AddInsuranceMCEGrid.data,function(a){return a.MATERIALCODE==e.exMaterialsFinalList[t].MATERIALCODE}))e.AddInsuranceMCEGrid.data.push(e.exMaterialsFinalList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else{a=e.alertObjectRes.RcdAldyExtInInclsn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}else for(t=0;t<e.exMaterialsFinalList.length;t++){if(-1==_.findIndex(e.AddInsuranceMCEGrid.data,function(a){return a.MATERIALCODE==e.exMaterialsFinalList[t].MATERIALCODE}))e.AddInsuranceMCEGrid.data.push(e.exMaterialsFinalList[t]);else{a=e.alertObjectRes.RcdAldyExt;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}}}delete I.exMaterialMainGroup,delete I.exMaterialSubGroup,delete I.exMtrLName,e.exMaterialsFinalList=[],I.exMaterialList=[],e.mEXMGidDetails=[]},e.serviceEclList=[],e.serviceInclList=[],e.MaterialInclList=[],e.tariffClassInclList=[],e.materialExclList=[],e.tariffClassExclList=[],e.planCodeValid="planCodeFalse",e.planIdValid="planIdFalse",e.planNameValid="planNameFalse",e.agreementValid="agreementFalse",e.benefitValid="benefitFalse",e.categoryValid="benefitFalse",e.discValid="discFalse",e.noOfDaysValid="noOfDaysFalse",e.minDaysValid="minDaysFalse",e.maxDaysValid="maxDaysFalse",e.surValid="surFalse",e.printValid="printFalse",e.copayValid="copayFalse",e.limitValid="limitFalse",e.planCodeMsg="",e.planCodeError=!1,e.planIdMsg="",e.planIdError=!1,e.planNameMsg="",e.planNameError=!1,e.agreementMsg="",e.agreementError=!1,e.benefitMsg="",e.benefitError=!1,e.categoryMsg="",e.categoryError=!1,e.discMsg="",e.discError=!1,e.noOfDaysMsg="",e.noOfDaysError=!1,e.minDaysMsg="",e.minDaysError=!1,e.maxDaysMsg="",e.maxDaysError=!1,e.surMsg="",e.surError=!1,e.printMsg="",e.printError=!1,e.copayMsg="",e.copayError=!1,e.limitMsg="",e.limitError=!1,e.oneSection=!1,e.saveInsPlan=function(){if(2!=e.Status){if(e.serviceEclList=[],e.serviceInclList=[],e.MaterialInclList=[],e.tariffClassInclList=[],e.materialExclList=[],e.tariffClassExclList=[],e.copayServiceWiseList=[],e.AddInsuranceSEGrid.data.length>0)for(var t=0;t<e.AddInsuranceSEGrid.data.length;t++)e.serviceEclList[t]={"@class":"com.napier.core.service.vo.emrmasters.ServiceEclList",deptCode:e.AddInsuranceSEGrid.data[t].DEPARTMENTCODE,subDeptCode:e.AddInsuranceSEGrid.data[t].SUBDEPARTMENTCODE,exclServSeqId:e.AddInsuranceSEGrid.data[t].SERV_SEQ_ID,servSeqName:e.AddInsuranceSEGrid.data[t].SERVICENAME,aliasCode:"1",aliasName:"asass",facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,gnStatus:e.AddInsuranceSEGrid.data[t].GN_STATUS,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,iesSeqID:e.AddInsuranceSEGrid.data[t].iesSeqID?e.AddInsuranceSEGrid.data[t].iesSeqID:void 0};else e.serviceEclList[0]={"@class":"com.napier.core.service.vo.emrmasters.ServiceEclList",facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION};for(t=0;t<e.AddInsuranceSIGrid.data.length;t++)e.serviceInclList[t]={"@class":"com.napier.core.service.vo.emrmasters.ServiceInclList",deptCode:e.AddInsuranceSIGrid.data[t].DEPARTMENTCODE,subDeptId:e.AddInsuranceSIGrid.data[t].SUBDEPARTMENTCODE,inclServSeqId:e.AddInsuranceSIGrid.data[t].SERV_SEQ_ID,servSeqName:e.AddInsuranceSIGrid.data[t].SERV_NAME,aliasCode:e.AddInsuranceSIGrid.data[t].ALIAS_CODE,aliasName:e.AddInsuranceSIGrid.data[t].ALIAS_NAME,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,gnStatus:e.AddInsuranceSIGrid.data[t].GN_STATUS,isFlagStatus:e.AddInsuranceSIGrid.data[t].isFlagStatus?e.AddInsuranceSIGrid.data[t].isFlagStatus:2,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,iisSeqId:e.AddInsuranceSIGrid.data[t].iisSeqId?e.AddInsuranceSIGrid.data[t].iisSeqId:void 0};for(t=0;t<e.AddInsuranceMCIGrid.data.length;t++)e.MaterialInclList[t]={"@class":"com.napier.core.service.vo.emrmasters.MaterialInclList",mtrGrpsedId:e.AddInsuranceMCIGrid.data[t].MATERIALMAINGRPCODE,mtrSubGrpseqId:e.AddInsuranceMCIGrid.data[t].MATERIALSUBGRPCODE,mtrlCode:e.AddInsuranceMCIGrid.data[t].MATERIALCODE,mtrLName:e.AddInsuranceMCIGrid.data[t].MATERIALDESCRIPTION,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,gnStatus:e.AddInsuranceMCIGrid.data[t].GN_STATUS,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,iimSeqId:e.AddInsuranceMCIGrid.data[t].iimSeqId?e.AddInsuranceMCIGrid.data[t].iimSeqId:void 0};for(t=0;t<e.AddInsuranceTCIGrid.data.length;t++)e.tariffClassInclList[t]={"@class":"com.napier.core.service.vo.emrmasters.TariffClassInclList",tariffClsCode:e.AddInsuranceTCIGrid.data[t].CODE,tariffName:e.AddInsuranceTCIGrid.data[t].DESCRIPTION,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,gnStatus:e.AddInsuranceTCIGrid.data[t].GN_STATUS,tariffIimSeqId:142,tarfiffInclSeqId:e.AddInsuranceTCIGrid.data[t].tarfiffInclSeqId?e.AddInsuranceTCIGrid.data[t].tarfiffInclSeqId:void 0,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION};if(e.AddInsuranceMCEGrid.data.length>0)for(t=0;t<e.AddInsuranceMCEGrid.data.length;t++)e.materialExclList[t]={"@class":"com.napier.core.service.vo.emrmasters.MaterialExclList",mtrlSubCode:e.AddInsuranceMCEGrid.data[t].MATERIALSUBGRPCODE,mtrlMainCode:e.AddInsuranceMCEGrid.data[t].MATERIALMAINGRPCODE,mtrlCode:e.AddInsuranceMCEGrid.data[t].MATERIALCODE,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,mtrLName:e.AddInsuranceMCEGrid.data[t].MATERIALDESCRIPTION,gnStatus:e.AddInsuranceMCEGrid.data[t].GN_STATUS,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,iemSeqId:e.AddInsuranceMCEGrid.data[t].iemSeqId?e.AddInsuranceMCEGrid.data[t].iemSeqId:void 0};else e.materialExclList[0]={"@class":"com.napier.core.service.vo.emrmasters.MaterialExclList",facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION};if(e.AddInsuranceTCEGrid.data.length>0)for(t=0;t<e.AddInsuranceTCEGrid.data.length;t++)e.tariffClassExclList[t]={"@class":"com.napier.core.service.vo.emrmasters.TariffClassExclList",tariffClsCode:e.AddInsuranceTCEGrid.data[t].CODE,tariffName:e.AddInsuranceTCEGrid.data[t].DESCRIPTION,tariffIemSeqId:142,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,gnStatus:e.AddInsuranceTCEGrid.data[t].GN_STATUS,tarfiffExclSeqId:e.AddInsuranceTCEGrid.data[t].tarfiffExclSeqId?e.AddInsuranceTCEGrid.data[t].tarfiffExclSeqId:void 0,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION};else e.tariffClassExclList[0]={"@class":"com.napier.core.service.vo.emrmasters.TariffClassExclList",tariffIemSeqId:142,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION};if(e.gridOptionsCopay.data.length>1||e.copyData.length>0){var r;r=e.gridOptionsCopay.data.concat(e.copyData),e.copayServiceWiseList=[];for(t=1;t<r.length;t++){var n=0;r[t].primayServiceGroup&&r[t].speciality&&r[t].department&&r[t].service?n=4:r[t].primayServiceGroup&&r[t].speciality&&r[t].department?n=3:r[t].primayServiceGroup&&r[t].department?n=2:r[t].primayServiceGroup&&(n=1),e.copayServiceWiseList.push({"@class":"com.napier.core.service.vo.emrmasters.CopaymentServiceLevel",copayment:r[t].copayment,maxCopay:r[t].maxCopay&&parseFloat(r[t].maxCopay)>0?parseFloat(r[t].maxCopay):void 0,department:r[t].department?r[t].department.CODE:void 0,primayServiceGroup:r[t].primayServiceGroup?r[t].primayServiceGroup.CODE:void 0,service:r[t].service?r[t].service.SERV_SEQ_ID:void 0,speciality:r[t].speciality?r[t].speciality.CODE:void 0,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,gnStatus:r[t].actions?r[t].actions:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,copaySeqId:r[t].copaySeqId?r[t].copaySeqId:void 0,copayType:n>0?n:void 0})}}if(null!=e.insPlanCode&&null!=e.insPlanCode&&""!=e.insPlanCode?(e.planCodeValid="planCodeTrue",e.planCodeMsg="",e.planCodeError=!1):(e.planCodeValid="planCodeFalse",e.planCodeMsg=e.alertObjectRes.PlzEntrPlnCode,e.planCodeError=!0),null!=e.planID&&null!=e.planID&&""!=e.planID?(e.planIdValid="planIdTrue",e.planIdMsg="",e.planIdError=!1):(e.planIdValid="planIdFalse",e.planIdMsg=e.alertObjectRes.PlzEntrPlnId,e.planIdError=!0),null!=e.planName&&null!=e.planName&&""!=e.planName?(e.planNameValid="planNameTrue",e.planNameMsg="",e.planNameError=!1):(e.planNameValid="planNameFalse",e.planNameMsg=e.alertObjectRes.PlzEntrPlnName,e.planNameError=!0),null!=e.agreement&&null!=e.agreement&&""!=e.agreement?(e.agreementValid="agreementTrue",e.agreementMsg="",e.agreementError=!1):(e.agreementValid="agreementFalse",e.agreementMsg=e.alertObjectRes.PlzSlctAggr,e.agreementError=!0),null!=e.benefit&&null!=e.benefit&&""!=e.benefit?(e.benefitValid="benefitTrue",e.benefitMsg="",e.benefitError=!1):(e.benefitValid="benefitFalse",e.benefitMsg=e.alertObjectRes.PlzSlctBenft,e.benefitError=!0),null!=e.tariff&&null!=e.tariff&&""!=e.tariff?(e.categoryValid="categoryTrue",e.categoryMsg="",e.categoryError=!1):(e.categoryValid="categoryFalse",e.categoryMsg=e.alertObjectRes.PlzSlctCatg,e.categoryError=!0),1==e.cloneData.earlySettelementDiscount?(null!=e.cloneData.discountPercent&&null!=e.cloneData.discountPercent&&""!=e.cloneData.discountPercent?(e.discValid="discFalse",e.discMsg="",e.discError=!1):(e.discValid="discTrue",e.discMsg=e.alertObjectRes.EntrDisPer,e.discError=!0),null!=e.cloneData.noOfDays&&null!=e.cloneData.noOfDays&&""!=e.cloneData.noOfDays?(e.noOfDaysValid="noOfDaysFalse",e.noOfDaysMsg="",e.noOfDaysError=!1):(e.noOfDaysValid="noOfDaysTrue",e.noOfDaysMsg=e.alertObjectRes.PlzEntrNumDays,e.noOfDaysError=!0)):(e.noOfDaysError=!1,e.discError=!1),1==e.cloneData.inPatientDays?(null!=e.cloneData.minDays&&null!=e.cloneData.minDays&&""!=e.cloneData.minDays?(e.minDaysValid="minDaysFalse",e.minDaysMsg="",e.minDaysError=!1):(e.minDaysValid="minDaysTrue",e.minDaysMsg=e.alertObjectRes.PlzEntrMinDays,e.minDaysError=!0),null!=e.cloneData.maxDays&&null!=e.cloneData.maxDays&&""!=e.cloneData.maxDays?(e.maxDaysValid="maxDaysFalse",e.maxDaysMsg="",e.maxDaysError=!1):(e.maxDaysValid="maxDaysTrue",e.maxDaysMsg=e.alertObjectRes.PlzEntrMaxDays,e.maxDaysError=!0)):(e.maxDaysError=!1,e.minDaysError=!1),1==e.cloneData.surcharge?null!=e.cloneData.surchargePercent&&null!=e.cloneData.surchargePercent&&""!=e.cloneData.surchargePercent?(e.surValid="surFalse",e.surMsg="",e.surError=!1):(e.surValid="surTrue",e.surMsg=e.alertObjectRes.EntrSurPer,e.surError=!0):e.surError=!1,1==e.cloneData.surchargePrint?null!=e.cloneData.printCaption&&null!=e.cloneData.printCaption&&""!=e.cloneData.printCaption?(e.printValid="printFalse",e.printMsg="",e.printError=!1):(e.printValid="printTrue",e.printMsg=e.alertObjectRes.EntrPrntCaption,e.printError=!0):e.printError=!1,1==e.cloneData.ipLimit?null!=e.cloneData.limitAmount&&null!=e.cloneData.limitAmount&&""!=e.cloneData.limitAmount?(e.limitValid="limitFalse",e.limitMsg="",e.limitError=!1):(e.limitValid="limitTrue",e.limitMsg=e.alertObjectRes.EntrLmtAmt,e.limitError=!0):e.limitError=!1,"planCodeTrue"==e.planCodeValid&&"planIdTrue"==e.planIdValid&&"planNameTrue"==e.planNameValid&&"agreementTrue"==e.agreementValid&&"benefitTrue"==e.benefitValid&&"categoryTrue"==e.categoryValid&&(e.oneSection=!0),1!=e.oneSection||e.limitError||e.copayError||e.printError||e.surError||e.discError||e.noOfDaysError||e.maxDaysError||e.minDaysError){var l=e.alertObjectRes.plzFilMandFild;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,l,!1,!1,e.close,2e3)}else{0==e.AddInsuranceSIGrid.data.length&&(e.serviceInclList=[]),0==e.AddInsuranceTCIGrid.data.length&&(e.tariffClassInclList=[]),0==e.AddInsuranceMCIGrid.data.length&&(e.MaterialInclList=[]);var s={url:"HISServices/InsurancePlanMasterService"};s.requestData={operation:"saveInsurPlane",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",incId:"002"==e.myreturnedData.payerType?e.myreturnedData.insCompId:e.myreturnedData.corpCompId?e.myreturnedData.corpCompId.toString():e.myreturnedData.insCompId.toString(),incName:"002"==e.myreturnedData.payerType?e.myreturnedData.insCompName:e.myreturnedData.corpCompName?e.myreturnedData.corpCompName:e.myreturnedData.insCompName,inPlanCode:e.insPlanCode,inPlanId:e.planID,inPlanName:e.planName,inTypAgrement:e.agreement,inPlanBenf:e.benefit,cloneId:e.clone,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:void 0,remarks:e.remarks,incStatus:e.Status,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,tarrifSeqId:e.tariff,payerType:"002",attributesList:{"@class":"com.napier.core.service.vo.emrmasters.AttributesList",attSeqId:e.updateCheckVariable?e.cloneData.attSeqId:void 0,billLevelDiscount:e.cloneData.billLevelDiscount,serviceDiscount:e.cloneData.serviceDiscount,negotiableCharges:e.cloneData.negotiableCharges,earlySettelementDiscount:e.cloneData.earlySettelementDiscount,inPatientDays:e.cloneData.inPatientDays,surcharge:e.cloneData.surcharge,surchargePrint:e.cloneData.surchargePrint,discountPercent:e.cloneData.discountPercent?e.cloneData.discountPercent:void 0,noOfDays:e.cloneData.noOfDays?e.cloneData.noOfDays:void 0,minDays:e.cloneData.minDays?e.cloneData.minDays:void 0,maxDays:e.cloneData.maxDays?e.cloneData.maxDays:void 0,surchargePercent:e.cloneData.surchargePercent?e.cloneData.surchargePercent:void 0,copay:e.cloneData.copay,maxCopay:"1"==e.cloneData.copay&&e.cloneData.maxCopay&&parseFloat(e.cloneData.maxCopay)>0?parseFloat(e.cloneData.maxCopay):void 0,servLevelMaxCopay:"2"==e.cloneData.copay&&e.cloneData.maxCopay&&parseFloat(e.cloneData.maxCopay)>0?parseFloat(e.cloneData.maxCopay):void 0,deductableAmt:e.cloneData.deductibleAmount?parseFloat(e.cloneData.deductibleAmount):void 0,printCaption:e.cloneData.printCaption?e.cloneData.printCaption:void 0,ipLimit:e.cloneData.ipLimit,patientCopayPercentage:"1"==e.cloneData.copay&&e.cloneData.patientCopayPercentage?e.cloneData.patientCopayPercentage:void 0,limitAmount:e.cloneData.limitAmount?e.cloneData.limitAmount:void 0,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,gnStatus:e.Status,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION},serviceEclList:[{"com.napier.core.service.vo.emrmasters.ServiceEclList":e.serviceEclList}],serviceInclList:[{"com.napier.core.service.vo.emrmasters.ServiceInclList":e.serviceInclList}],materialInclList:[{"com.napier.core.service.vo.emrmasters.MaterialInclList":e.MaterialInclList}],tariffClassInclList:[{"com.napier.core.service.vo.emrmasters.TariffClassInclList":e.tariffClassInclList}],materialExclList:[{"com.napier.core.service.vo.emrmasters.MaterialExclList":e.materialExclList}],tariffClassExclList:[{"com.napier.core.service.vo.emrmasters.TariffClassExclList":e.tariffClassExclList}],copaymentServiceLevel:[{"com.napier.core.service.vo.emrmasters.CopaymentServiceLevel":e.copayServiceWiseList}]}},i.sendRestRequest(s).then(function(t){if(t.data.HITService.message.errorMessage){var i=t.data.HITService.message.errorMessage;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,i,!1,!1,e.close,2e3)}else if(e.updateCheckVariable&&t.data.HITService.message.inPlanName){i=e.alertObjectRes.PlnUpdateSucss;f.hisAlertMulti("success",e.alertObjectRes.alertTypeSucss,i,!1,!1,e.close,2e3),a(function(){e.payerScreen()},2e3)}else{if(!t.data.HITService.message.inPlanName){i=e.alertObjectRes.SmtngWntWrg;return void f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,i,!1,!1,e.close,2e3)}var i=e.alertObjectRes.PlnSaveSucss;f.hisAlertMulti("success",e.alertObjectRes.alertTypeSucss,i,!1,!1,e.close,2e3),a(function(){e.payerScreen()},2e3)}})}}else f.hisAlertMulti("information","Inactivated record can't be modified",l,!1,!1,e.close,2e3)},e.payerScreen=function(){S.go("index.masters.creditPayer",{id:e.myreturnedData.payerType})},e.$watch("clone",function(e,t){t&&(I.oldValue=angular.copy(t))},!0),e.planDisabled=!1,e.updatePlan=function(a,r){if(e.planDisabled=!0,e.cloneSeqId=a||void 0,e.planSeqId=e.myreturnedData.planSeqId,e.updateCheckVariable=e.planSeqId,e.cloneSeqId&&e.AddInsuranceSEGrid.data.length>0||e.AddInsuranceSIGrid.data.length>0||e.AddInsuranceMCEGrid.data.length>0||e.AddInsuranceMCIGrid.data.length>0||e.cloneData.surchargePercent||e.cloneData.discountPercent)e.cloneOptions={message:"Cloning will replace the already entered data on the screen with the data from the selected plan. Do you still want to continue?",buttons:{warning:{label:"No",callback:function(){e.clone=I.oldValue?angular.copy(I.oldValue):""}},success:{label:"Yes",callback:function(){if(!e.cloneSeqId)return e.cloneData={},delete e.cloneData.discountPercent,delete e.cloneData.noOfDays,delete e.cloneData.minDays,delete e.cloneData.maxDays,delete e.cloneData.surchargePercent,delete e.cloneData.printCaption,delete e.cloneData.patientCopayPercentage,delete e.cloneData.deductibleAmount,e.cloneData={billLevelDiscount:1,serviceDiscount:1,negotiableCharges:1,earlySettelementDiscount:1,inPatientDays:1,surcharge:1,surchargePrint:1,copay:1,ipLimit:1,discountPercent:"",noOfDays:"",minDays:"",maxDays:"",surchargePercent:"",printCaption:"",patientCopayPercentage:"",deductibleAmount:"",maxCopay:""},e.AddInsuranceSIGrid.data=[],e.AddInsuranceTCEGrid.data=[],e.AddInsuranceSEGrid.data=[],e.AddInsuranceMCEGrid.data=[],e.AddInsuranceMCIGrid.data=[],void(e.AddInsuranceTCIGrid.data=[]);var t={url:"HISServices/InsurancePlanMasterService"};t.requestData={operation:"getInsurancePlane",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",incPlanSeqId:e.cloneSeqId?e.cloneSeqId:e.planSeqId}},i.sendRestRequest(t).then(function(t){e.updatePlanResponse=t.data.HITService.message.insurancePlanDetails,e.updatePlanAttributes=t.data.HITService.message.attributesList,""!=t.data.HITService.message.serviceInclList[0]&&(e.updatePlanSIN=t.data.HITService.message.serviceInclList[0]["com.napier.core.service.vo.emrmasters.ServiceInclList"],e.updatePlanSIN=Array.isArray(e.updatePlanSIN)?e.updatePlanSIN:[e.updatePlanSIN]),""!=t.data.HITService.message.serviceEclList[0]&&(e.updatePlanSEC=t.data.HITService.message.serviceEclList[0]["com.napier.core.service.vo.emrmasters.ServiceEclList"],e.updatePlanSEC=Array.isArray(e.updatePlanSEC)?e.updatePlanSEC:[e.updatePlanSEC]),""!=t.data.HITService.message.materialInclList[0]&&(e.updatePlanMIN=t.data.HITService.message.materialInclList[0]["com.napier.core.service.vo.emrmasters.MaterialInclList"],e.updatePlanMIN=Array.isArray(e.updatePlanMIN)?e.updatePlanMIN:[e.updatePlanMIN]),""!=t.data.HITService.message.materialExclList[0]&&(e.updatePlanMEC=t.data.HITService.message.materialExclList[0]["com.napier.core.service.vo.emrmasters.MaterialExclList"],e.updatePlanMEC=Array.isArray(e.updatePlanMEC)?e.updatePlanMEC:[e.updatePlanMEC]),""!=t.data.HITService.message.tariffClassInclList[0]&&(e.updatePlanTIN=t.data.HITService.message.tariffClassInclList[0]["com.napier.core.service.vo.emrmasters.TariffClassInclList"],e.updatePlanTIN=Array.isArray(e.updatePlanTIN)?e.updatePlanTIN:[e.updatePlanTIN]),t.data.HITService.message.tariffClassExclList[0]&&(e.updatePlanTEC=t.data.HITService.message.tariffClassExclList[0]["com.napier.core.service.vo.emrmasters.TariffClassExclList"],e.updatePlanTEC=Array.isArray(e.updatePlanTEC)?e.updatePlanTEC:[e.updatePlanTEC]),t.data.HITService.message.copaymentServiceLevel.length>0&&t.data.HITService.message.copaymentServiceLevel[0]&&(e.updatePlanCopay=t.data.HITService.message.copaymentServiceLevel[0]["com.napier.core.service.vo.emrmasters.CopaymentServiceLevel"],e.updatePlanCopay=Array.isArray(e.updatePlanCopay)?e.updatePlanCopay:[e.updatePlanCopay]),e.updatePlanVariables(e.updatePlanResponse,e.updatePlanAttributes,e.updatePlanSIN,e.updatePlanSEC,e.updatePlanMIN,e.updatePlanMEC,e.updatePlanTIN,e.updatePlanTEC,r,e.updatePlanCopay)},function(e){})}}}},t.customDialog(e.cloneOptions);else{var n={url:"HISServices/InsurancePlanMasterService"};n.requestData={operation:"getInsurancePlane",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",incPlanSeqId:e.cloneSeqId?e.cloneSeqId:e.planSeqId}},i.sendRestRequest(n).then(function(t){e.cloneData={},delete e.cloneData.discountPercent,delete e.cloneData.noOfDays,delete e.cloneData.minDays,delete e.cloneData.maxDays,delete e.cloneData.surchargePercent,delete e.cloneData.printCaption,delete e.cloneData.patientCopayPercentage,delete e.cloneData.deductibleAmount,delete e.cloneData.discountPercent,delete e.cloneData.maxCopay,e.cloneData={billLevelDiscount:1,serviceDiscount:1,negotiableCharges:1,earlySettelementDiscount:1,inPatientDays:1,surcharge:1,surchargePrint:1,copay:1,ipLimit:1},e.AddInsuranceSIGrid.data=[],e.AddInsuranceTCEGrid.data=[],e.AddInsuranceSEGrid.data=[],e.AddInsuranceMCEGrid.data=[],e.AddInsuranceMCIGrid.data=[],e.AddInsuranceTCIGrid.data=[],e.updatePlanResponse=t.data.HITService.message.insurancePlanDetails,e.updatePlanAttributes=t.data.HITService.message.attributesList,""!=t.data.HITService.message.serviceInclList[0]&&(e.updatePlanSIN=t.data.HITService.message.serviceInclList[0]["com.napier.core.service.vo.emrmasters.ServiceInclList"],e.updatePlanSIN=Array.isArray(e.updatePlanSIN)?e.updatePlanSIN:[e.updatePlanSIN]),""!=t.data.HITService.message.serviceEclList[0]&&(e.updatePlanSEC=t.data.HITService.message.serviceEclList[0]["com.napier.core.service.vo.emrmasters.ServiceEclList"],e.updatePlanSEC=Array.isArray(e.updatePlanSEC)?e.updatePlanSEC:[e.updatePlanSEC]),""!=t.data.HITService.message.materialInclList[0]&&(e.updatePlanMIN=t.data.HITService.message.materialInclList[0]["com.napier.core.service.vo.emrmasters.MaterialInclList"],e.updatePlanMIN=Array.isArray(e.updatePlanMIN)?e.updatePlanMIN:[e.updatePlanMIN]),""!=t.data.HITService.message.materialExclList[0]&&(e.updatePlanMEC=t.data.HITService.message.materialExclList[0]["com.napier.core.service.vo.emrmasters.MaterialExclList"],e.updatePlanMEC=Array.isArray(e.updatePlanMEC)?e.updatePlanMEC:[e.updatePlanMEC]),""!=t.data.HITService.message.tariffClassInclList[0]&&(e.updatePlanTIN=t.data.HITService.message.tariffClassInclList[0]["com.napier.core.service.vo.emrmasters.TariffClassInclList"],e.updatePlanTIN=Array.isArray(e.updatePlanTIN)?e.updatePlanTIN:[e.updatePlanTIN]),t.data.HITService.message.tariffClassExclList[0]&&(e.updatePlanTEC=t.data.HITService.message.tariffClassExclList[0]["com.napier.core.service.vo.emrmasters.TariffClassExclList"],e.updatePlanTEC=Array.isArray(e.updatePlanTEC)?e.updatePlanTEC:[e.updatePlanTEC]),t.data.HITService.message.copaymentServiceLevel.length>0&&t.data.HITService.message.copaymentServiceLevel[0]&&(e.updatePlanCopay=t.data.HITService.message.copaymentServiceLevel[0]["com.napier.core.service.vo.emrmasters.CopaymentServiceLevel"],e.updatePlanCopay=Array.isArray(e.updatePlanCopay)?e.updatePlanCopay:[e.updatePlanCopay]),e.updatePlanVariables(e.updatePlanResponse,e.updatePlanAttributes,e.updatePlanSIN,e.updatePlanSEC,e.updatePlanMIN,e.updatePlanMEC,e.updatePlanTIN,e.updatePlanTEC,void 0,e.updatePlanCopay)},function(e){})}},e.attrValue=!1,e.updatePlanVariables=function(t,a,i,r,n,l,s,o,c,d){if(e.Status=1==t.gnStatus?"1":"2",e.insPlanCode=e.updateCheckVariable?t.inCmpPlanCode:e.insPlanCode,c||(e.planID=e.updateCheckVariable?t.inPlanId:e.planID,e.planName=e.updateCheckVariable?t.inPlanName:e.planName,e.agreement=e.updateCheckVariable?t.inPlanBenf:e.agreement,e.benefit=e.updateCheckVariable?t.inPlanBenf:e.benefit,e.tariff=e.updateCheckVariable?t.tarrifSeqId:e.tariff),e.cloneData=a,e.cloneData.deductibleAmount=a.deductableAmt,e.cloneData.billLevelMaxCopay=angular.copy(a.maxCopay),e.cloneData.maxCopay=1==a.copay?e.cloneData.maxCopay:e.cloneData.servLevelMaxCopay,e.clone=e.cloneSeqId?e.cloneSeqId:t.cloneId,e.remarks=t.remarks,e.attrValue=!0,null!=i){e.AddInsuranceSIGrid.data=[],e.serviceINCLength=i.length;for(var p=0;p<i.length;p++)e.AddInsuranceSIGrid.data.push({DEPARTMENTNAME:i[p].deptName,DEPARTMENTCODE:i[p].deptCode,SUBDEPARTMENTNAME:i[p].subDeptName,SUBDEPARTMENTCODE:i[p].subDeptId,SER_SEQ_ID:i[p].servCode,SERV_SEQ_ID:i[p].inclServSeqId,SERV_NAME:i[p].servSeqName,ALIAS_NAME:i[p].aliasName,ALIAS_CODE:i[p].aliasCode,GN_STATUS:i[p].gnStatus,isFlagStatus:i[p].isFlagStatus?i[p].isFlagStatus:2,iisSeqId:e.updateCheckVariable?i[p].iisSeqId:void 0})}if(null!=r){e.AddInsuranceSEGrid.data=[];for(p=0;p<r.length;p++)e.AddInsuranceSEGrid.data.push({DEPARTMENTDESCRIPTION:r[p].deptName,DEPARTMENTCODE:r[p].deptCode,SUBDEPARTMENTDESCRIPTION:r[p].subDeptName,SUBDEPARTMENTCODE:r[p].subDeptCode,SERVICECODE:r[p].servCode,SERV_SEQ_ID:r[p].exclServSeqId,SERVICENAME:r[p].servSeqName,ExaliasName:r[p].aliasName,ExaliasCode:r[p].aliasCode,GN_STATUS:r[p].gnStatus,iesSeqID:e.updateCheckVariable?r[p].iesSeqID:void 0})}if(null!=n){e.AddInsuranceMCIGrid.data=[];for(p=0;p<n.length;p++)e.AddInsuranceMCIGrid.data.push({MATERIALMAINGRPDESCRIPTION:n[p].mtrGrpName,MATERIALMAINGRPCODE:n[p].mtrGrpsedId,MATERIALSUBGRPDESCRIPTION:n[p].mtrSubGrpName,MATERIALSUBGRPCODE:n[p].mtrSubGrpseqId,MATERIALDESCRIPTION:n[p].mtrLName,MATERIALCODE:n[p].mtrlCode,GN_STATUS:n[p].gnStatus,iimSeqId:e.updateCheckVariable?n[p].iimSeqId:void 0})}if(null!=l){e.AddInsuranceMCEGrid.data=[];for(p=0;p<l.length;p++)e.AddInsuranceMCEGrid.data.push({MATERIALMAINGRPDESCRIPTION:l[p].mtrGrpName,MATERIALMAINGRPCODE:l[p].mtrlMainCode,MATERIALSUBGRPDESCRIPTION:l[p].mtrSubGrpName,MATERIALSUBGRPCODE:l[p].mtrlSubCode,MATERIALDESCRIPTION:l[p].mtrLName,MATERIALCODE:l[p].mtrlCode,GN_STATUS:l[p].gnStatus,iemSeqId:e.updateCheckVariable?l[p].iemSeqId:void 0})}if(null!=s){e.AddInsuranceTCIGrid.data=[];for(p=0;p<s.length;p++)e.AddInsuranceTCIGrid.data.push({DESCRIPTION:s[p].tariffName,CODE:s[p].tariffClsCode,GN_STATUS:s[p].gnStatus,tarfiffInclSeqId:e.updateCheckVariable?s[p].tarfiffInclSeqId:void 0})}if(null!=o){e.AddInsuranceTCEGrid.data=[];for(p=0;p<o.length;p++)e.AddInsuranceTCEGrid.data.push({DESCRIPTION:o[p].tariffName,CODE:o[p].tariffClsCode,GN_STATUS:o[p].gnStatus,tarfiffExclSeqId:e.updateCheckVariable?o[p].tarfiffExclSeqId:void 0})}null!=d&&I.tariffCopayData()},e.checkMsg=null,e.getSearchSubDeptData=[],e.getSearchSubDept=function(t){e.searchDept=t,e.searchSubDeptGridDetl=[],e.multipleComboDataForSearchSubDeptList={1:e.searchSubDeptGridDetl};var a=g.executeQueryURLReset();e.searchDeptGridDetlsLIst=new Array,g.prepareParamListWithParam("pDepcode",e.searchDept.Code,e.searchDeptGridDetlsLIst),g.prepareParamListWithParam("pComId",e.myreturnedData.corpCompId?e.myreturnedData.corpCompId.toString():e.myreturnedData.insCompId.toString(),e.searchDeptGridDetlsLIst),g.executeQueryInput("PAYER_SERVIC_INCL_SUBDEPARTMENTCODE_DROPDOWN",e.searchDeptGridDetlsLIst,e.multipleComboDataForSearchSubDeptList,!0,!0,a,"popUp").then(function(t){e.getSearchSubDeptData=e.searchSubDeptGridDetl})},e.inclusionSearch=function(){var t={url:"HISServices/InsurancePlanMasterService"};t.requestData={operation:"getInsurServIncl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",serviceInclList:[{"com.napier.core.service.vo.emrmasters.ServiceInclList":[{"@class":"com.napier.core.service.vo.emrmasters.ServiceInclList",deptCode:I.searchDept?I.searchDept.Code.toString():"",subDeptId:I.searchSubDept?I.searchSubDept:-999,servCode:I.searchSerCode?I.searchSerCode:"",servSeqName:I.searchServiceName?I.searchServiceName:"",spSeqId:-999,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(t).then(function(t){if(""!=t.data.HITService.message.serviceInclList){e.searchINSGridData=t.data.HITService.message.serviceInclList[0]["com.napier.core.service.vo.emrmasters.ServiceInclList"],e.searchINSGridData=Array.isArray(e.searchINSGridData)?e.searchINSGridData:[e.searchINSGridData],e.AddInsuranceSIGrid.data=[];for(var a=0;a<e.searchINSGridData.length;a++)e.AddInsuranceSIGrid.data[a]={DEPARTMENTNAME:e.searchINSGridData[a].deptName,DEPARTMENTCODE:e.searchINSGridData[a].deptCode,SUBDEPARTMENTNAME:e.searchINSGridData[a].subDeptName,SUBDEPARTMENTCODE:e.searchINSGridData[a].subDeptId,SER_SEQ_ID:e.searchINSGridData[a].servCode,SERV_SEQ_ID:e.searchINSGridData[a].inclServSeqId,SERV_NAME:e.searchINSGridData[a].servSeqName,ALIAS_NAME:e.searchINSGridData[a].aliasName,ALIAS_CODE:e.searchINSGridData[a].aliasCode,iisSeqId:e.searchINSGridData[a].iisSeqId,GN_STATUS:e.searchINSGridData[a].gnStatus}}else{var i=e.alertObjectRes.noDataFnd;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,i,!1,!1,e.close,2e3)}})},e.getSearchExSubDept=function(t){e.searchExSubdept=t,e.searchExSubDeptGridDetl=[],e.multipleComboDataSearchExSubDeptGridDetlLIst={1:e.searchExSubDeptGridDetl};var a=g.executeQueryURLReset();e.searchExSubDeptGridDetlLIst=new Array,g.prepareParamListWithParam("pDepcode",e.searchExSubdept.Code,e.searchExSubDeptGridDetlLIst),g.executeQueryInput("PAYER_SERVIC_EXCL_SUBDEPARTMENTCODE_DROPDOWN",e.searchExSubDeptGridDetlLIst,e.multipleComboDataSearchExSubDeptGridDetlLIst,!0,!0,a,"popUp").then(function(e){})},e.exclusionSearch=function(){var t={url:"HISServices/InsurancePlanMasterService"};t.requestData={operation:"getInsurServExcl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",serviceEclList:[{"com.napier.core.service.vo.emrmasters.ServiceEclList":[{"@class":"com.napier.core.service.vo.emrmasters.ServiceEclList",deptCode:e.searchExSubdept?e.searchExSubdept.Code:"",subDeptCode:I.searchExSubDept?I.searchExSubDept:-999,servSeqName:I.searchExServiceName?I.searchExServiceName:"",spSeqId:-999,servCode:I.searchExSerCode?I.searchExSerCode:"",incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(t).then(function(t){if(""!=t.data.HITService.message.serviceEclList){e.searchEXCGridData=t.data.HITService.message.serviceEclList[0]["com.napier.core.service.vo.emrmasters.ServiceEclList"],e.searchEXCGridData=Array.isArray(e.searchEXCGridData)?e.searchEXCGridData:[e.searchEXCGridData],e.AddInsuranceSEGrid.data=[];for(var a=0;a<e.searchEXCGridData.length;a++)e.AddInsuranceSEGrid.data[a]={DEPARTMENTDESCRIPTION:e.searchEXCGridData[a].deptName,DEPARTMENTCODE:e.searchEXCGridData[a].deptCode,SUBDEPARTMENTDESCRIPTION:e.searchEXCGridData[a].subDeptName,SUBDEPARTMENTCODE:e.searchEXCGridData[a].subDeptCode,SERVICECODE:e.searchEXCGridData[a].servCode,SERV_SEQ_ID:e.searchEXCGridData[a].exclServSeqId,SERVICENAME:e.searchEXCGridData[a].servSeqName,ExaliasName:e.searchEXCGridData[a].aliasName,ExaliasCode:e.searchEXCGridData[a].aliasCode,iesSeqID:e.searchEXCGridData[a].iesSeqID,GN_STATUS:e.searchEXCGridData[a].gnStatus}}else{var i=e.alertObjectRes.noDataFnd;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,i,!1,!1,e.close,2e3)}})},e.searchMaterialSubList=[],e.searchExMaterialSubList=[],e.getSearchMaterialSubGroup=function(t){e.searchMaterialsMain=t,e.searchMISubGridDetls=[],e.multipleComboDataForSearchMISubList={1:e.searchMISubGridDetls};var a=g.executeQueryURLReset();e.searchMISubGridDetlsLIst=new Array,g.prepareParamList(1,e.searchMaterialsMain.mtrGrpsedId,e.searchMISubGridDetlsLIst),g.executeQueryInput("PAYER_MATERIAL_SUBGRPCODE_DROPDOWN",e.searchMISubGridDetlsLIst,e.multipleComboDataForSearchMISubList,!0,!0,a,"popUp").then(function(t){e.searchMaterialSubList=e.searchMISubGridDetls,e.searchExMaterialSubList=e.searchMISubGridDetls})},e.materialINSearch=function(){var t={url:"HISServices/InsurancePlanMasterService"};t.requestData={operation:"getInsurMateConsIncl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",materialInclList:[{"com.napier.core.service.vo.emrmasters.MaterialInclList":[{"@class":"com.napier.core.service.vo.emrmasters.MaterialInclList",mtrGrpsedId:e.searchMaterialsMain?e.searchMaterialsMain.mtrGrpsedId:-999,mtrSubGrpseqId:I.searchmaterialSubGroup?I.searchmaterialSubGroup:-999,mtrLName:I.searchINMaterialName?I.searchINMaterialName:"",mtrlCode:I.searchINMaterialCode?I.searchINMaterialCode:void 0,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,spSeqId:-999,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(t).then(function(t){if(""!=t.data.HITService.message.materialInclList){e.searchMCIGridData=t.data.HITService.message.materialInclList[0]["com.napier.core.service.vo.emrmasters.MaterialInclList"],e.searchMCIGridData=Array.isArray(e.searchMCIGridData)?e.searchMCIGridData:[e.searchMCIGridData],e.AddInsuranceMCIGrid.data=[];for(var a=0;a<e.searchMCIGridData.length;a++)e.AddInsuranceMCIGrid.data[a]={MATERIALMAINGRPDESCRIPTION:e.searchMCIGridData[a].mtrGrpName,MATERIALMAINGRPCODE:e.searchMCIGridData[a].mtrGrpsedId,MATERIALSUBGRPDESCRIPTION:e.searchMCIGridData[a].mtrSubGrpName,MATERIALSUBGRPCODE:e.searchMCIGridData[a].mtrSubGrpseqId,MATERIALCODE:e.searchMCIGridData[a].mtrlCode,MATERIALDESCRIPTION:e.searchMCIGridData[a].mtrLName,iimSeqId:e.searchMCIGridData[a].iimSeqId,GN_STATUS:e.searchMCIGridData[a].gnStatus}}else{var i=e.alertObjectRes.noDataFnd;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,i,!1,!1,e.close,2e3)}})},e.materialEXSearch=function(){var t={url:"HISServices/InsurancePlanMasterService"};t.requestData={operation:"getInsurMateConsExcl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",materialExclList:[{"com.napier.core.service.vo.emrmasters.MaterialExclList":[{"@class":"com.napier.core.service.vo.emrmasters.MaterialExclList",mtrlMainCode:e.searchMaterialsMain?e.searchMaterialsMain.mtrGrpsedId:-999,mtrlSubCode:I.searchExmaterialSubGroup?I.searchExmaterialSubGroup:-999,mtrLName:I.searchExMaterialName?I.searchExMaterialName:"",mtrlCode:I.searchExMaterialCode?I.searchExMaterialCode:void 0,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,spSeqId:-999,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(t).then(function(t){if(""!=t.data.HITService.message.materialExclList){e.searchMEXGridData=t.data.HITService.message.materialExclList[0]["com.napier.core.service.vo.emrmasters.MaterialExclList"],e.searchMEXGridData=Array.isArray(e.searchMEXGridData)?e.searchMEXGridData:[e.searchMEXGridData],e.AddInsuranceMCEGrid.data=[];for(var a=0;a<e.searchMEXGridData.length;a++)e.AddInsuranceMCEGrid.data[a]={MATERIALMAINGRPDESCRIPTION:e.searchMEXGridData[a].mtrGrpName,MATERIALMAINGRPCODE:e.searchMEXGridData[a].mtrGrpsedId,MATERIALSUBGRPDESCRIPTION:e.searchMEXGridData[a].mtrSubGrpName,MATERIALSUBGRPCODE:e.searchMEXGridData[a].mtrSubGrpseqId,MATERIALCODE:e.searchMEXGridData[a].mtrlCode,MATERIALDESCRIPTION:e.searchMEXGridData[a].mtrLName,iemSeqId:e.searchMEXGridData[a].iemSeqId,GN_STATUS:e.searchMEXGridData[a].gnStatus}}else{var i=e.alertObjectRes.noDataFnd;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,i,!1,!1,e.close,2e3)}})},e.tariffINSearch=function(){var t={url:"HISServices/InsurancePlanMasterService"};t.requestData={operation:"getInsurTarfClassIncl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",tariffClassInclList:[{"com.napier.core.service.vo.emrmasters.TariffClassInclList":[{"@class":"com.napier.core.service.vo.emrmasters.TariffClassInclList",tariffName:I.searchTariffName?I.searchTariffName:"",spSeqId:-999,tariffClsCode:I.searchTariffCode?I.searchTariffCode:void 0,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999}]}]}},i.sendRestRequest(t).then(function(t){if(""!=t.data.HITService.message.tariffClassInclList){e.searchTCIGridData=t.data.HITService.message.tariffClassInclList[0]["com.napier.core.service.vo.emrmasters.TariffClassInclList"],e.searchTCIGridData=Array.isArray(e.searchTCIGridData)?e.searchTCIGridData:[e.searchTCIGridData],e.AddInsuranceTCIGrid.data=[];for(var a=0;a<e.searchTCIGridData.length;a++)e.AddInsuranceTCIGrid.data[a]={DESCRIPTION:e.searchTCIGridData[a].tariffName,CODE:e.searchTCIGridData[a].tariffClsCode,tarfiffInclSeqId:e.searchTCIGridData[a].tarfiffInclSeqId,GN_STATUS:e.searchTCIGridData[a].gnStatus}}else{var i=e.alertObjectRes.noDataFnd;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,i,!1,!1,e.close,2e3)}})},e.tariffExSearch=function(){var t={url:"HISServices/InsurancePlanMasterService"};t.requestData={operation:"getInsurTarfClassExcl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",tariffClassExclList:[{"com.napier.core.service.vo.emrmasters.TariffClassExclList":[{"@class":"com.napier.core.service.vo.emrmasters.TariffClassExclList",tariffName:I.searchExTariffName?I.searchExTariffName:"",tariffClsCode:I.searchExTariffCode?I.searchExTariffCode:void 0,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,spSeqId:-999}]}]}},i.sendRestRequest(t).then(function(t){if(""!=t.data.HITService.message.tariffClassExclList){e.searchTEXGridData=t.data.HITService.message.tariffClassExclList[0]["com.napier.core.service.vo.emrmasters.TariffClassExclList"],e.searchTEXGridData=Array.isArray(e.searchTEXGridData)?e.searchTEXGridData:[e.searchTEXGridData],e.AddInsuranceTCEGrid.data=[];for(var a=0;a<e.searchTEXGridData.length;a++)e.AddInsuranceTCEGrid.data[a]={DESCRIPTION:e.searchTEXGridData[a].tariffName,CODE:e.searchTEXGridData[a].tariffClsCode,tarfiffExclSeqId:e.searchTEXGridData[a].tarfiffExclSeqId,GN_STATUS:e.searchTEXGridData[a].gnStatus}}else{var i=e.alertObjectRes.noDataFnd;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,i,!1,!1,e.close,2e3)}})},I.serviceINCSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurServIncl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",serviceInclList:[{"com.napier.core.service.vo.emrmasters.ServiceInclList":[{"@class":"com.napier.core.service.vo.emrmasters.ServiceInclList",deptCode:I.searchDept?I.searchDept.Code.toString():"",subDeptId:I.searchSubDept?I.searchSubDept:-999,servCode:I.searchSerCode?I.searchSerCode:"",servSeqName:t,spSeqId:-999,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.serviceInclList[0])return e.searchINSGridsData=t.data.HITService.message.serviceInclList[0]["com.napier.core.service.vo.emrmasters.ServiceInclList"],e.searchINSGridsData=Array.isArray(e.searchINSGridsData)?e.searchINSGridsData:[e.searchINSGridsData],I.incServiceNameShow=!1,e.searchINSGridsData.map(function(e){return e});I.incServiceNameShow=!0})},I.serviceINCCodeSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurServIncl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",serviceInclList:[{"com.napier.core.service.vo.emrmasters.ServiceInclList":[{"@class":"com.napier.core.service.vo.emrmasters.ServiceInclList",deptCode:I.searchDept?I.searchDept.Code.toString():"",subDeptId:I.searchSubDept?I.searchSubDept:-999,servCode:t,servSeqName:I.searchServiceName?I.searchServiceName:"",spSeqId:-999,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.serviceInclList[0])return e.searchINSGridCodeData=t.data.HITService.message.serviceInclList[0]["com.napier.core.service.vo.emrmasters.ServiceInclList"],e.searchINSGridCodeData=Array.isArray(e.searchINSGridCodeData)?e.searchINSGridCodeData:[e.searchINSGridCodeData],I.incServiceCodeShow=!1,e.searchINSGridCodeData.map(function(e){return e});I.incServiceCodeShow=!0})},I.serviceINSClear=function(){if(delete I.searchDept,delete I.searchSubDept,delete I.searchSerCode,e.getSearchSubDeptData=[],delete I.searchServiceName,e.updatePlanSIN.length>0&&null!=e.updatePlanSIN[0]){e.AddInsuranceSIGrid.data=[];for(var t=0;t<e.updatePlanSIN.length;t++)e.AddInsuranceSIGrid.data.push({DEPARTMENTNAME:e.updatePlanSIN[t].deptName,DEPARTMENTCODE:e.updatePlanSIN[t].deptCode,SUBDEPARTMENTNAME:e.updatePlanSIN[t].subDeptName,SUBDEPARTMENTCODE:e.updatePlanSIN[t].subDeptId,SER_SEQ_ID:e.updatePlanSIN[t].servCode,SERV_SEQ_ID:e.updatePlanSIN[t].inclServSeqId,SERV_NAME:e.updatePlanSIN[t].servSeqName,ALIAS_NAME:e.updatePlanSIN[t].aliasName,ALIAS_CODE:e.updatePlanSIN[t].aliasCode,GN_STATUS:e.updatePlanSIN[t].gnStatus,iisSeqId:e.updatePlanSIN[t].iisSeqId})}},I.serviceEXCSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurServExcl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",serviceEclList:[{"com.napier.core.service.vo.emrmasters.ServiceEclList":[{"@class":"com.napier.core.service.vo.emrmasters.ServiceEclList",deptCode:e.searchExSubdept?e.searchExSubdept.Code:"",subDeptCode:I.searchExSubDept?I.searchExSubDept:-999,servSeqName:t,spSeqId:-999,servCode:I.searchExSerCode?I.searchExSerCode:"",incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.serviceEclList[0])return e.searchEXCNameData=t.data.HITService.message.serviceEclList[0]["com.napier.core.service.vo.emrmasters.ServiceEclList"],e.searchEXCNameData=Array.isArray(e.searchEXCNameData)?e.searchEXCNameData:[e.searchEXCNameData],I.exServiceNameShow=!1,e.searchEXCNameData.map(function(e){return e});I.exServiceNameShow=!0})},I.serviceEXCCodeSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurServExcl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",serviceEclList:[{"com.napier.core.service.vo.emrmasters.ServiceEclList":[{"@class":"com.napier.core.service.vo.emrmasters.ServiceEclList",deptCode:e.searchExSubdept?e.searchExSubdept.Code:"",subDeptCode:I.searchExSubDept?I.searchExSubDept:-999,servSeqName:I.searchExServiceName?I.searchExServiceName:"",spSeqId:-999,servCode:t,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.serviceEclList[0])return e.searchEXCCodeData=t.data.HITService.message.serviceEclList[0]["com.napier.core.service.vo.emrmasters.ServiceEclList"],e.searchEXCCodeData=Array.isArray(e.searchEXCCodeData)?e.searchEXCCodeData:[e.searchEXCCodeData],I.exServiceCodeShow=!1,e.searchEXCCodeData.map(function(e){return e});I.exServiceCodeShow=!0})},I.serviceEXCClear=function(){if(delete I.searchExDept,delete I.searchExSubDept,e.searchExSubDeptGridDetl=[],delete I.searchExServiceName,delete I.searchExSerCode,e.updatePlanSEC.length>0&&null!=e.updatePlanSEC[0]){e.AddInsuranceSEGrid.data=[];for(var t=0;t<e.updatePlanSEC.length;t++)e.AddInsuranceSEGrid.data.push({DEPARTMENTDESCRIPTION:e.updatePlanSEC[t].deptName,DEPARTMENTCODE:e.updatePlanSEC[t].deptCode,SUBDEPARTMENTDESCRIPTION:e.updatePlanSEC[t].subDeptName,SUBDEPARTMENTCODE:e.updatePlanSEC[t].subDeptCode,SERVICECODE:e.updatePlanSEC[t].servCode,SERV_SEQ_ID:e.updatePlanSEC[t].exclServSeqId,SERVICENAME:e.updatePlanSEC[t].servSeqName,ExaliasName:e.updatePlanSEC[t].aliasName,ExaliasCode:e.updatePlanSEC[t].aliasCode,GN_STATUS:e.updatePlanSEC[t].gnStatus,iesSeqID:e.updatePlanSEC[t].iesSeqID})}},I.materialIncNameSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurMateConsIncl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",materialInclList:[{"com.napier.core.service.vo.emrmasters.MaterialInclList":[{"@class":"com.napier.core.service.vo.emrmasters.MaterialInclList",mtrGrpsedId:e.searchMaterialsMain?e.searchMaterialsMain.mtrGrpsedId:-999,mtrSubGrpseqId:I.searchmaterialSubGroup?I.searchmaterialSubGroup:-999,mtrLName:t,mtrlCode:I.searchINMaterialCode?I.searchINMaterialCode:-999,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,spSeqId:-999,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.materialInclList[0])return e.searchMCINameData=t.data.HITService.message.materialInclList[0]["com.napier.core.service.vo.emrmasters.MaterialInclList"],e.searchMCINameData=Array.isArray(e.searchMCINameData)?e.searchMCINameData:[e.searchMCINameData],I.incMaterialNameShow=!1,e.searchMCINameData.map(function(e){return e});I.incMaterialNameShow=!0},function(e){})},I.materialIncCodeSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurMateConsIncl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",materialInclList:[{"com.napier.core.service.vo.emrmasters.MaterialInclList":[{"@class":"com.napier.core.service.vo.emrmasters.MaterialInclList",mtrGrpsedId:e.searchMaterialsMain?e.searchMaterialsMain.mtrGrpsedId:-999,mtrSubGrpseqId:I.searchmaterialSubGroup?I.searchmaterialSubGroup:-999,mtrLName:I.searchINMaterialName?I.searchINMaterialName:"",mtrlCode:t,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,spSeqId:-999,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.materialInclList[0])return e.searchMCICodeData=t.data.HITService.message.materialInclList[0]["com.napier.core.service.vo.emrmasters.MaterialInclList"],e.searchMCICodeData=Array.isArray(e.searchMCICodeData)?e.searchMCICodeData:[e.searchMCICodeData],I.incMaterialCodeShow=!1,e.searchMCICodeData.map(function(e){return e});I.incMaterialCodeShow=!0})},I.materialNameClear=function(){if(delete I.searchMaterialMainGroup,delete I.searchmaterialSubGroup,e.searchMaterialSubList=[],delete I.searchINMaterialName,delete I.searchINMaterialCode,e.updatePlanMIN.length>0&&null!=e.updatePlanMIN[0]){e.AddInsuranceMCIGrid.data=[];for(var t=0;t<e.updatePlanMIN.length;t++)e.AddInsuranceMCIGrid.data.push({MATERIALMAINGRPDESCRIPTION:e.updatePlanMIN[t].mtrGrpName,MATERIALMAINGRPCODE:e.updatePlanMIN[t].mtrGrpsedId,MATERIALSUBGRPDESCRIPTION:e.updatePlanMIN[t].mtrSubGrpName,MATERIALSUBGRPCODE:e.updatePlanMIN[t].mtrSubGrpseqId,MATERIALDESCRIPTION:e.updatePlanMIN[t].mtrLName,MATERIALCODE:e.updatePlanMIN[t].mtrlCode,GN_STATUS:e.updatePlanMIN[t].gnStatus,iimSeqId:e.updatePlanMIN[t].iimSeqId})}},I.materialNameSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurMateConsExcl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",materialExclList:[{"com.napier.core.service.vo.emrmasters.MaterialExclList":[{"@class":"com.napier.core.service.vo.emrmasters.MaterialExclList",mtrlMainCode:e.searchMaterialsMain?e.searchMaterialsMain.mtrGrpsedId:-999,mtrlSubCode:I.searchExmaterialSubGroup?I.searchExmaterialSubGroup:-999,mtrLName:t,mtrlCode:I.searchExMaterialCode?I.searchExMaterialCode:-999,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,spSeqId:-999,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.materialExclList[0])return e.searchMENameData=t.data.HITService.message.materialExclList[0]["com.napier.core.service.vo.emrmasters.MaterialExclList"],e.searchMENameData=Array.isArray(e.searchMENameData)?e.searchMENameData:[e.searchMENameData],I.excMaterialNameShow=!1,e.searchMENameData.map(function(e){return e});I.excMaterialNameShow=!0})},I.materialCodeSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurMateConsExcl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",materialExclList:[{"com.napier.core.service.vo.emrmasters.MaterialExclList":[{"@class":"com.napier.core.service.vo.emrmasters.MaterialExclList",mtrlMainCode:e.searchMaterialsMain?e.searchMaterialsMain.mtrGrpsedId:-999,mtrlSubCode:I.searchExmaterialSubGroup?I.searchExmaterialSubGroup:-999,mtrLName:I.searchExMaterialName?I.searchExMaterialName:"",mtrlCode:t,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,gnStatus:1,spSeqId:-999,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.materialExclList[0])return e.searchMECodeData=t.data.HITService.message.materialExclList[0]["com.napier.core.service.vo.emrmasters.MaterialExclList"],e.searchMECodeData=Array.isArray(e.searchMECodeData)?e.searchMECodeData:[e.searchMECodeData],I.excMaterialCodeShow=!1,e.searchMECodeData.map(function(e){return e});I.excMaterialCodeShow=!0},function(e){})},I.materialCodeClear=function(){if(delete I.searchExMaterialName,delete I.searchExMaterialCode,delete I.searchExmaterialSubGroup,e.searchExMaterialSubList=[],delete I.searchExMaterialMainGroup,e.updatePlanMEC.length>0&&null!=e.updatePlanMEC[0]){e.AddInsuranceMCEGrid.data=[];for(var t=0;t<e.updatePlanMEC.length;t++)e.AddInsuranceMCEGrid.data.push({MATERIALMAINGRPDESCRIPTION:e.updatePlanMEC[t].mtrGrpName,MATERIALMAINGRPCODE:e.updatePlanMEC[t].mtrlMainCode,MATERIALSUBGRPDESCRIPTION:e.updatePlanMEC[t].mtrSubGrpName,MATERIALSUBGRPCODE:e.updatePlanMEC[t].mtrlSubCode,MATERIALDESCRIPTION:e.updatePlanMEC[t].mtrLName,MATERIALCODE:e.updatePlanMEC[t].mtrlCode,GN_STATUS:e.updatePlanMEC[t].gnStatus,iemSeqId:e.updatePlanMEC[t].iemSeqId})}},I.tariffINNameSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurTarfClassIncl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",tariffClassInclList:[{"com.napier.core.service.vo.emrmasters.TariffClassInclList":[{"@class":"com.napier.core.service.vo.emrmasters.TariffClassInclList",tariffName:t,spSeqId:-999,tariffCode:I.searchTariffCode?I.searchTariffCode:-999,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.tariffClassInclList[0])return e.searchTCINameData=t.data.HITService.message.tariffClassInclList[0]["com.napier.core.service.vo.emrmasters.TariffClassInclList"],e.searchTCINameData=Array.isArray(e.searchTCINameData)?e.searchTCINameData:[e.searchTCINameData],I.incTariffNameShow=!1,e.searchTCINameData.map(function(e){return e});I.incTariffNameShow=!0},function(e){})},I.tariffINCodeSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurTarfClassIncl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",tariffClassInclList:[{"com.napier.core.service.vo.emrmasters.TariffClassInclList":[{"@class":"com.napier.core.service.vo.emrmasters.TariffClassInclList",tariffName:I.searchTariffName?I.searchTariffName:"",spSeqId:-999,tariffClsCode:t,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.tariffClassInclList[0])return e.searchTCICodeData=t.data.HITService.message.tariffClassInclList[0]["com.napier.core.service.vo.emrmasters.TariffClassInclList"],e.searchTCICodeData=Array.isArray(e.searchTCICodeData)?e.searchTCICodeData:[e.searchTCICodeData],I.incTariffCodeShow=!1,e.searchTCICodeData.map(function(e){return e});I.incTariffCodeShow=!0})},I.tariffINClear=function(){if(delete I.searchTariffCode,delete I.searchTariffName,I.incTariffCodeShow=!1,e.updatePlanTIN.length>0&&null!=e.updatePlanTIN[0]){e.AddInsuranceTCIGrid.data=[];for(var t=0;t<e.updatePlanTIN.length;t++)e.AddInsuranceTCIGrid.data.push({DESCRIPTION:e.updatePlanTIN[t].tariffName,CODE:e.updatePlanTIN[t].tariffClsCode,GN_STATUS:e.updatePlanTIN[t].gnStatus,tarfiffInclSeqId:e.updatePlanTIN[t].tarfiffInclSeqId})}},I.tariffExNameSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurTarfClassExcl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",tariffClassExclList:[{"com.napier.core.service.vo.emrmasters.TariffClassExclList":[{"@class":"com.napier.core.service.vo.emrmasters.TariffClassExclList",tariffName:t,tariffCode:I.searchExTariffCode?I.searchExTariffCode:-999,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,spSeqId:-999}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.tariffClassExclList[0])return e.searchTEXNameData=t.data.HITService.message.tariffClassExclList[0]["com.napier.core.service.vo.emrmasters.TariffClassExclList"],e.searchTEXNameData=Array.isArray(e.searchTEXNameData)?e.searchTEXNameData:[e.searchTEXNameData],I.excTariffNameShow=!1,e.searchTEXNameData.map(function(e){return e});I.excTariffNameShow=!0},function(e){})},I.tariffExCodeSearch=function(t){var a={url:"HISServices/InsurancePlanMasterService"};return a.requestData={operation:"getInsurTarfClassExcl",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",payerType:"002",tariffClassExclList:[{"com.napier.core.service.vo.emrmasters.TariffClassExclList":[{"@class":"com.napier.core.service.vo.emrmasters.TariffClassExclList",tariffName:I.searchExTariffName?I.searchExTariffName:"",tariffClsCode:t,incPlanSeqId:e.myreturnedData.planSeqId?e.myreturnedData.planSeqId:-999,spSeqId:-999}]}]}},i.sendRestRequest(a).then(function(t){if(""!=t.data.HITService.message.tariffClassExclList[0])return e.searchTEXCodeData=t.data.HITService.message.tariffClassExclList[0]["com.napier.core.service.vo.emrmasters.TariffClassExclList"],e.searchTEXCodeData=Array.isArray(e.searchTEXCodeData)?e.searchTEXCodeData:[e.searchTEXCodeData],I.excTariffCodeShow=!1,e.searchTEXCodeData.map(function(e){return e});I.excTariffCodeShow=!0},function(e){})},I.tariffEXClear=function(){if(delete I.searchExTariffCode,delete I.searchExTariffName,e.updatePlanTEC.length>0&&null!=e.updatePlanTEC[0]){e.AddInsuranceTCEGrid.data=[];for(var t=0;t<e.updatePlanTEC.length;t++)e.AddInsuranceTCEGrid.data.push({DESCRIPTION:e.updatePlanTEC[t].tariffName,CODE:e.updatePlanTEC[t].tariffClsCode,GN_STATUS:e.updatePlanTEC[t].gnStatus,tarfiffExclSeqId:e.updatePlanTEC[t].tarfiffExclSeqId})}},Number.prototype.pad=function(e){for(var t=String(this);t.length<(e||2);)t="0"+t;return t},I.tariffCopayData=function(){if(e.updatePlanCopay.length>0&&null!=e.updatePlanCopay[0]){e.gridOptionsCopay.data=[],e.gridOptionsCopay.data[0]={isFirstRow:!1,isEditable:!1};for(var t=0;t<e.updatePlanCopay.length;t++){var a={};a.copaySeqId=e.updatePlanCopay[t].copaySeqId;var i={};i.CODE=e.updatePlanCopay[t].primayServiceGroup,i.DESCRIPTION=e.updatePlanCopay[t].primayServiceGroupName,a.primayServiceGroup=i;var r={};null!=e.updatePlanCopay[t].department&&null!=e.updatePlanCopay[t].department&&(r.CODE=e.updatePlanCopay[t].department.pad(3),r.DESCRIPTION=e.updatePlanCopay[t].departmentName,a.department=r);var n={};null!=e.updatePlanCopay[t].speciality&&null!=e.updatePlanCopay[t].speciality&&(n.CODE=e.updatePlanCopay[t].speciality,n.DESCRIPTION=e.updatePlanCopay[t].specialityName,a.speciality=n,I.OnChangeDept(r,t+1));var l={};null!=e.updatePlanCopay[t].service&&null!=e.updatePlanCopay[t].service&&(l.SERV_SEQ_ID=e.updatePlanCopay[t].service,l.SERV_NAME=e.updatePlanCopay[t].serviceName,l.SERV_CODE=e.updatePlanCopay[t].serviceCode,a.service=l),a.copayment=e.updatePlanCopay[t].copayment,a.maxCopay=e.updatePlanCopay[t].maxCopay,a.isFirstRow=!0,a.isEditable=!0,e.gridOptionsCopay.data.push(a)}}},I.activeServiceInclusions=function(t){if(1==t.GN_STATUS&&e.AddInsuranceSEGrid.data.length>0&&-1!=_.findIndex(e.AddInsuranceSEGrid.data,function(e){return e.SERV_SEQ_ID==t.SERV_SEQ_ID&&1==e.GN_STATUS})){var a=e.alertObjectRes.RcdAldActvInExclusn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3);var r=_.findIndex(e.AddInsuranceSIGrid.data,function(e){return e.SERV_SEQ_ID==t.SERV_SEQ_ID});e.AddInsuranceSIGrid.data[r].GN_STATUS=2}if(1==t.GN_STATUS){var n={url:"HISServices/InsuranceCheckPlans"};return n.requestData={operation:"activAndInactiveService",messageId:"",destination:"com.napier.core.master.service.external.InsurancePlanMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanMaster",CompId:e.myreturnedData.corpCompId?e.myreturnedData.corpCompId.toString():e.myreturnedData.insCompId.toString(),SerSeqId:t.SERV_SEQ_ID.toString()}},i.sendRestRequest(n).then(function(a){var i=_.findIndex(e.AddInsuranceSIGrid.data,function(e){return e.SERV_SEQ_ID==t.SERV_SEQ_ID});if(a.data.HITService.message&&2==a.data.HITService.message.incStatus){var r=e.alertObjectRes.RcdAlrdyInactInCmpnyLevl;return f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,r,!1,!1,e.close,2e3),void(e.AddInsuranceSIGrid.data[i].GN_STATUS=angular.copy(a.data.HITService.message.incStatus))}},function(e){})}},I.activeServiceExclusions=function(t){if(1==t.GN_STATUS&&e.AddInsuranceSIGrid.data.length>0&&-1!=_.findIndex(e.AddInsuranceSIGrid.data,function(e){return e.SERV_SEQ_ID==t.SERV_SEQ_ID&&1==e.GN_STATUS})){var a=e.alertObjectRes.RcdAldyActvInInclsn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3);var i=_.findIndex(e.AddInsuranceSEGrid.data,function(e){return e.SERV_SEQ_ID==t.SERV_SEQ_ID});e.AddInsuranceSEGrid.data[i].GN_STATUS=2}},I.activeMaterialInclusions=function(t){if(1==t.GN_STATUS&&e.AddInsuranceMCEGrid.data.length>0&&-1!=_.findIndex(e.AddInsuranceMCEGrid.data,function(e){return e.MATERIALCODE==t.MATERIALCODE&&1==e.GN_STATUS})){var a=e.alertObjectRes.RcdAldActvInExclusn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3);var i=_.findIndex(e.AddInsuranceMCIGrid.data,function(e){return e.MATERIALCODE==t.MATERIALCODE});e.AddInsuranceMCIGrid.data[i].GN_STATUS=2}},I.activeMaterialExclusions=function(t){if(1==t.GN_STATUS&&e.AddInsuranceMCIGrid.data.length>0&&-1!=_.findIndex(e.AddInsuranceMCIGrid.data,function(e){return e.MATERIALCODE==t.MATERIALCODE&&1==e.GN_STATUS})){var a=e.alertObjectRes.RcdAldyActvInInclsn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3);var i=_.findIndex(e.AddInsuranceMCEGrid.data,function(e){return e.MATERIALCODE==t.MATERIALCODE});e.AddInsuranceMCEGrid.data[i].GN_STATUS=2}},I.activeTariffInclusions=function(t){if(1==t.GN_STATUS&&e.AddInsuranceTCEGrid.data.length>0&&-1!=_.findIndex(e.AddInsuranceTCEGrid.data,function(e){return e.CODE==t.CODE&&1==e.GN_STATUS})){var a=e.alertObjectRes.RcdAldActvInExclusn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3);var i=_.findIndex(e.AddInsuranceTCIGrid.data,function(e){return e.CODE==t.CODE});e.AddInsuranceTCIGrid.data[i].GN_STATUS=2}},I.changeSettlement=function(){delete e.cloneData.noOfDays,delete e.cloneData.discountPercent},I.inPatientChange=function(){delete e.cloneData.minDays,delete e.cloneData.maxDays},I.activeTariffExclusions=function(t){if(1==t.GN_STATUS&&e.AddInsuranceTCIGrid.data.length>0&&-1!=_.findIndex(e.AddInsuranceTCIGrid.data,function(e){return e.CODE==t.CODE&&1==e.GN_STATUS})){var a=e.alertObjectRes.RcdAldyActvInInclsn;f.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3);var i=_.findIndex(e.AddInsuranceTCEGrid.data,function(e){return e.CODE==t.CODE});e.AddInsuranceTCEGrid.data[i].GN_STATUS=2}},null!=e.myreturnedData.planSeqId&&null!=e.myreturnedData.planSeqId&&""!=e.myreturnedData.planSeqId&&e.updatePlan()}e.$inject=["$scope","$ngBootbox","$timeout","CallManager","RoleTaskService","AddInsuranceSIGrid","AddInsuranceSEGrid","AddInsuranceMCIGrid","AddInsuranceMCEGrid","AddInsuranceTCEGrid","AddInsuranceTCIGrid","dropdownQueryService","InclusionExclusionService","myService","QueryService","$state","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","coPayGridDef"],angular.module("napierContainerUi").controller("BillingAddInsuranceController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d){r.loadModule("billing");var p=this,u=n.getLanguageToSet();if(r.changeLanguage(u),p.objParam=o,p.alertObjectRes={},l.loadAlerts(u).then(function(e){p.alertObjectRes=e,p.alertData={buttonText:p.alertObjectRes.ok},p.alertFunction={buttonCallBack1:function(){}},p.close={buttonClose:function(){}}},function(e){}),p.payerCodeNameGrid={columnDefs:[{name:"DEFTVALUE",displayName:"Default",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="rowRenderIndex!=0"><input type="radio" ng-model="row.entity.DEFTVALUE" value="1" ng-click="grid.appScope.pcn.defaultPayerCode(row.entity,rowRenderIndex)" style="border:none"/></span></div>'},{name:"PAYER_ALIAS_CODE",displayName:"Payer Service Code",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="rowRenderIndex==0"><input type="text" ng-model="row.entity.PAYER_ALIAS_CODE" /></span><span ng-if="rowRenderIndex!=0">{{row.entity.PAYER_ALIAS_CODE}}</span></div>'},{name:"PAYER_ALIAS_NAME",displayName:"Payer Service Name",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="rowRenderIndex==0"><input type="text" ng-model="row.entity.PAYER_ALIAS_NAME" /></span><span ng-if="rowRenderIndex!=0">{{row.entity.PAYER_ALIAS_NAME}}</span></div>'},{name:"action",displayName:"Actions",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><button ng-if="rowRenderIndex==0" class="his-btn his-btn-success" ng-disabled="row.entity.PAYER_ALIAS_CODE==undefined||row.entity.PAYER_ALIAS_CODE===\'\'||row.entity.PAYER_ALIAS_NAME==undefined||row.entity.PAYER_ALIAS_NAME===\'\'" ng-click="grid.appScope.pcn.addRecord(row.entity,rowRenderIndex)">{{row.entity.update?"Update":"Add"}}</button><span ng-if="rowRenderIndex!=0" class="fa fa-pencil"  ng-click="grid.appScope.pcn.editRecord(row.entity,rowRenderIndex)"></span><span ng-if="rowRenderIndex!=0" class="fa fa-trash"  ng-click="grid.appScope.pcn.deleteRecord(row.entity,rowRenderIndex)"></span></div>'}]},p.payerCodeNameGrid.data=[],p.deleteRecordData=[],p.payerCodeNameGrid.data.push({}),p.objParam.result.payerSerSeqId){p.payerCodeNameData=[],p.coPayQueryMap={1:p.payerCodeNameData};var m=a.executeQueryURLReset(),g=new Array;a.prepareParamListWithParam("pPayerSerSeqId",p.objParam.result.payerSerSeqId?p.objParam.result.payerSerSeqId:-999,g),a.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,g),a.executeQueryInput("PAYER_CODE_NAME_DETAILS",g,p.coPayQueryMap,!0,!0,m,"popUp",{}).then(function(e){p.payerCodeNameData.length>0&&(p.payerCodeNameGrid.data=p.payerCodeNameData,p.payerCodeNameGrid.data.unshift({}))})}else if(p.objParam.result.payerServiceCodeList)for(var S=0;S<p.objParam.result.payerServiceCodeList.length;S++){var v=p.objParam.result.payerServiceCodeList[S];p.payerCodeNameGrid.data.push({PAYER_ALIAS_CODE:v.payerAliasCode,PAYER_ALIAS_NAME:v.payerAliasName,DEFTVALUE:v.defaultSelection})}p.addRecord=function(e,t){for(var a=angular.copy(e),i=1;i<p.payerCodeNameGrid.data.length;i++)if(!p.payerCodeNameGrid.data[i].update&&(p.payerCodeNameGrid.data[i].PAYER_ALIAS_CODE==e.PAYER_ALIAS_CODE||p.payerCodeNameGrid.data[i].PAYER_ALIAS_NAME==e.PAYER_ALIAS_NAME))return s.information("Information","Same Payer Code Or Name Already Exist."),!1;e.update?(e.update=void 0,p.payerCodeNameGrid.data[e.idNo]=a):p.payerCodeNameGrid.data.push(a),p.payerCodeNameGrid.data[0]={}},p.editRecord=function(e,t){e.update=!0,e.idNo=t;var a=angular.copy(e);p.payerCodeNameGrid.data[0]=a},p.deleteRecord=function(e,t){e.update?s.information("Information","Please Update Record."):(e.PA_ML_SER_SEQ_ID&&p.deleteRecordData.push(e),p.payerCodeNameGrid.data.splice(t,1))},p.defaultPayerCode=function(e,t){for(var a=1;a<p.payerCodeNameGrid.data.length;a++)t!=a&&null!=p.payerCodeNameGrid.data[a].DEFTVALUE&&1==p.payerCodeNameGrid.data[a].DEFTVALUE&&(p.payerCodeNameGrid.data[a].DEFTVALUE=2)},p.savePayerCodeName=function(){if(p.payerCodeNameGrid.data.length>1){var e=[],a={},i=!1;if(2==p.payerCodeNameGrid.data.length&&(p.payerCodeNameGrid.data[1].DEFTVALUE=1),angular.forEach(p.payerCodeNameGrid.data,function(t,r){0!=r&&(e.push({philHealthCodeSequenceId:t.PA_ML_SER_SEQ_ID,payerAliasCode:t.PAYER_ALIAS_CODE,payerAliasName:t.PAYER_ALIAS_NAME,defaultSelection:null!=t.DEFTVALUE&&""!==t.DEFTVALUE?parseInt(t.DEFTVALUE):2,payerServiceSequenceId:p.objParam.result.payerSerSeqId,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION}),null!=t.DEFTVALUE&&1==t.DEFTVALUE&&(i=!0,(a=t).payerSerSeqId=p.objParam.result.payerSerSeqId))}),!i)return void s.information("information","please select any  Record as default");if(angular.forEach(p.deleteRecordData,function(t,a){e.push({philHealthCodeSequenceId:t.PA_ML_SER_SEQ_ID,payerAliasCode:t.PAYER_ALIAS_CODE,payerAliasName:t.PAYER_ALIAS_NAME,defaultSelection:null!=t.DEFTVALUE&&""!==t.DEFTVALUE?parseInt(t.DEFTVALUE):2,payerServiceSequenceId:p.objParam.result.payerSerSeqId,gnStatus:2,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION})}),p.objParam.result.payerSerSeqId){var r={};r.url=c.HISIPINDENT.URL,r.requestData={operation:"saveOrUpdate",messageId:"",destination:"com.napier.core.master.service.external.InsPhilHealthCodesService",message:{"@class":"com.napier.core.service.vo.masters.InsPhilHealthCodesVOList",InsPhilHealthCodesVOList:[{"com.napier.core.service.vo.masters.InsPhilHealthCodesVO":e}]}},t.sendRestRequest(r).then(function(e){null!=e.data.HITService&&null!=e.data.HITService.message&&null==e.data.HITService.message.errorCode&&(s.success("Success","Saved Payer Code And Name!"),d.close(a))})}else{let t={defaultPayerAlias:a,payerServiceCodeList:e};d.close(t)}}}}e.$inject=["$scope","CallManager","QueryService","$state","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","objParam","IPINDENTAPIS","$uibModalInstance"],angular.module("napierContainerUi").controller("payerCodeNameCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u){var m=this;n.loadModule("billing");var g=l.getLanguageToSet();n.changeLanguage(g),m.alertData={},s.loadAlerts(g).then(function(e){m.alertData=e,d.alertData={buttonText:m.alertData.ok},d.alertFunction={buttonCallBack1:function(){}},d.buttonClose={buttonClose:function(){}}}),m.getRoleId=u.rolePermission("T_BL_CONVERING_LETTER_GEN"),m.disableButton=!0,m.disablePrint=!0,m.disablePrintList=!0,m.selectInvoice=null,m.prntObj={},m.CD=angular.copy(r),m.fromDateOptions={format:m.CD.dateOnly.format,maxDate:new Date},m.toDateOptions={format:m.CD.dateOnly.format,maxDate:new Date},m.changeToDate=function(e){m.toDateOptions.minDate=e},m.changeFromDate=function(e){m.fromDateOptions.maxDate=e},m.frmDate=new Date,m.toDate=new Date,m.coverLetterGrid=angular.copy(e),a.getGridColumnDefs(m.coverLetterGrid),m.coverLetterGrid.data=[],m.coverLetterGrid.onRegisterApi=function(e){m.gridApi=e,e.selection.on.rowSelectionChanged(d,function(e){var t=m.gridApi.selection.getSelectedRows().length;if(m.selectInvoice=m.gridApi.selection.getSelectedRows(),m.disablePrintList=!0,t>0)for(var a=0;a<t;a++){if(1!=m.selectInvoice[a].COVER_LETTER_STATUS_CODE){m.disableButton=!0,m.disablePrint=1!=t;break}a==t-1&&(m.disableButton=!1,m.disablePrint=!0)}else m.disableButton=!0,m.disablePrint=!0}),e.selection.on.rowSelectionChangedBatch(d,function(e){var t=m.gridApi.selection.getSelectedRows().length;if(m.selectInvoice=m.gridApi.selection.getSelectedRows(),t>0)for(var a=0;a<t;a++){if(1!=m.selectInvoice[a].COVER_LETTER_STATUS_CODE){m.disableButton=!0,m.disablePrint=!0,m.disablePrintList=!1;break}a==t-1&&(m.disableButton=!1,m.disablePrint=!0,m.disablePrintList=!0)}else m.disableButton=!0,m.disablePrint=!0,m.disablePrintList=!0})},m.gridOptions2=angular.copy(t),m.payerSearch=function(e){var t="%"+e+"%";m.payerName=[],m.multipleComboDataForList={1:m.payerName};var a=o.executeQueryURLReset();return m.payerNameList=new Array,o.prepareParamListWithParam("pCompCode",t,m.payerNameList),o.prepareParamListWithParam("pCompCode",t,m.payerNameList),o.prepareParamListWithParam("pCompName",t,m.payerNameList),o.prepareParamListWithParam("pCompName",t,m.payerNameList),o.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,m.payerNameList),o.executeQueryInput("GET_COPMANY_ACC_BILL_DTLS",m.payerNameList,m.multipleComboDataForList,!0,!0,a,"popUp",m.coverLetterGrid).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})},m.getCoveringLetterData=function(e){if(null!=e.payer&&null!=e.payer&&e.payer!=[]&&""!=e.payer&&null!=e.payer.INS_COMP_NAME){e.prntObj={},e.prntObj.coverLtrStatus=angular.copy(e.coverLtrStatus),e.prntObj.billCatgry=angular.copy(e.billCatgry),e.prntObj.invoiceNo=angular.copy(e.invoiceNo),e.prntObj.frmDate=angular.copy(e.frmDate),e.prntObj.toDate=angular.copy(e.toDate),e.coverData=[],e.multipleCoverDataForList={1:e.coverData};var t=o.executeQueryURLReset();e.coverDataList=new Array,o.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,e.coverDataList),o.prepareParamList(2,angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,e.coverDataList),o.prepareParamList(3,c("date")(new Date(e.frmDate),"yyyy-MM-dd"),e.coverDataList),o.prepareParamList(4,c("date")(new Date(e.toDate),"yyyy-MM-dd"),e.coverDataList),o.prepareParamList(5,parseInt(e.coverLtrStatus),e.coverDataList),o.prepareParamList(6,parseInt(e.coverLtrStatus),e.coverDataList),o.prepareParamList(7,parseInt(e.billCatgry),e.coverDataList),o.prepareParamList(8,parseInt(e.billCatgry),e.coverDataList),o.prepareParamList(9,e.payer.INS_COMP_NAME,e.coverDataList),o.prepareParamList(10,e.payer.INS_COMP_NAME,e.coverDataList),o.prepareParamList(11,null==e.invoiceNo||null==e.invoiceNo?"":"%"+e.invoiceNo+"%",e.coverDataList),o.prepareParamList(12,null==e.invoiceNo||null==e.invoiceNo?"":"%"+e.invoiceNo+"%",e.coverDataList),o.executeQueryInput("BL_COVERING_LETTER_GEN_001",e.coverDataList,e.multipleCoverDataForList,!0,!0,t,"popUp",e.coverLetterGrid).then(function(t){t[1],Array,t[1];if(e.coverData.length>0)e.coverLetterGrid.data=e.coverData,e.gridApi.selection.clearSelectedRows();else{e.coverLetterGrid.data=[],e.gridApi.selection.clearSelectedRows();var a=e.alertData.noRcrdFound;i.hisAlertMulti("information",e.alertData.alertTypeInfo,a,d.alertData,d.alertFunction,d.buttonClose,2e3)}})}else{var a={buttonText:e.alertData.ok},r=e.alertData.plzSlctPayrNme;i.hisAlertMulti("information",e.alertData.alertTypeInfo,r,a,{buttonCallBack1:function(){}},{buttonClose:function(){}},2e3)}},m.generateCover=function(e){a.generateCoverLetter(e).then(function(t){if(null!=t.data.HITService&&null!=t.data.HITService.message&&null!=t.data.HITService.message.clHdSeqId){var a={buttonText:e.alertData.ok},r={buttonCallBack1:function(){e.getCoveringLetterData(e)}},n={buttonClose:function(){e.getCoveringLetterData(e)}},l=e.alertData.sucsFulGen;i.hisAlertMulti("success",e.alertData.alertTypeSucss,l,a,r,n)}})},m.printCover=function(e,t){d.printParameterList=new Array;for(var a=0;a<1;a++){o.prepareParamList("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,d.printParameterList),o.prepareParamList("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,d.printParameterList),o.prepareParamList("pFromDate",moment(t.prntObj.frmDate).format("YYYY-MM-DD"),d.printParameterList),o.prepareParamList("pToDate",moment(t.prntObj.toDate).format("YYYY-MM-DD"),d.printParameterList),e&&o.prepareParamList("pCoverLetterSeqId",t.selectInvoice[a].CL_HD_SEQ_ID,d.printParameterList),o.prepareParamList("pCoverLetterStatus",e?t.selectInvoice[a].COVER_LETTER_STATUS_CODE:null==t.prntObj.coverLtrStatus||null==t.prntObj.coverLtrStatus?-999:parseInt(t.prntObj.coverLtrStatus),d.printParameterList),o.prepareParamList("pCoverLetterStatusText",e?t.selectInvoice[a].COVER_LETTER_STATUS_DESC:null==t.prntObj.coverLtrStatus||null==t.prntObj.coverLtrStatus||"-999"==t.prntObj.coverLtrStatus?"ALL":"1"==t.prntObj.coverLtrStatus?"Not Generated":"2"==t.prntObj.coverLtrStatus?"Original Generated":"Duplicate (No.) Generated",d.printParameterList),o.prepareParamList("pBillCategory",e?t.selectInvoice[a].GN_BILL_TYPE:null==t.prntObj.billCatgry||null==t.prntObj.billCatgry?-999:parseInt(t.prntObj.billCatgry),d.printParameterList),o.prepareParamList("pBillCategoryText",e?t.selectInvoice[a].DESCRIPTION:null==t.billCatgry||null==t.prntObj.billCatgry||"-999"==t.prntObj.billCatgry?"ALL":"1"==t.prntObj.billCatgry?"IP":"OP",d.printParameterList),o.prepareParamList("pCompanyName",t.selectInvoice[a].COMPANY_NAME,d.printParameterList);var i="%"+t.selectInvoice[a].INVOICE_NO+"%";o.prepareParamList("pInvoiceNo",e?i:null==t.prntObj.invoiceNo||null==t.prntObj.invoiceNo||""==t.prntObj.invoiceNo?"":"%"+t.prntObj.invoiceNo+"%",d.printParameterList)}var r={paramsList:d.printParameterList};r.reportId=e?"CreditCompanyCoveringLetterForIPReport":"CoveringLetter_Generation_Report",p.printReportModal("PrintTypeSelection","sm").then(function(e){p.printReportModal("printCoverLetter","lg",e,r)})},m.clearCoverData=function(e){e.prntObj={},e.coverLetterGrid.data=[],e.gridApi.selection.clearSelectedRows(),e.payer=null,e.invoiceNo=null,e.frmDate=null,e.toDate=null,e.coverLtrStatus="-999",e.billCatgry="-999",e.frmDate=moment().add(0,"d").add(-10,"m"),e.toDate=moment().add(0,"d").add(-9,"m")}}e.$inject=["coveringGridDefinition","coveringModalGridDefinition","coveringService","hisAlertService","hisCalDefConstant","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","QueryService","$filter","$scope","PrintService","RoleTaskService"],angular.module("napierContainerUi").controller("coveringLetterGenController",e),angular.module("napierContainerUi").controller("printCoverLetter",["returnObj","$uibModalInstance","selectedPrintType","PrintService","$scope",function(e,t,a,i,r){r.pageName="Covering Letter Generation",r.cancel=function(){t.dismiss("cancel")},r.printObject={},r.printObject.reportId=e.reportId,r.printObject.destination="reportingServiceImpl",r.printObject.reportType={id:"PDF"==a?4:5,desc:a},r.printObject.paramsList=e.paramsList,i.printReportFunction(r.printObject,r)}])}(),function(){"use strict";angular.module("napierContainerUi").controller("creditLettersTrackingCtrl",["$scope","QueryService","BILLING_APIS","CallManager","hisAlertService","hisAlertConstants","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService",function(e,t,a,i,r,n,l,s,o){var c=this;l.loadModule("billing");var d=s.getLanguageToSet();l.changeLanguage(d),c.alertObj={},o.loadAlerts(d).then(function(e){c.alertObj=e,c.alertData={buttonText:c.alertObj.ok},c.alertFunction={buttonCallBack1:function(){}},c.closefun={buttonClose:function(){}}}),c.gridOptions={enableHorizontalScrollbar:0,expandableRowTemplate:"app/consumer/his17_1/billing/screens/creditLettersTracking/credit.letter.tracking.sub.grid.html",columnDefs:[{field:"invoiceDate",displayName:"billing.invoiceDate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.invoiceDate.$| date:"dd/MM/yyyy"}}</div>',headerCellFilter:"translate"},{field:"invoiceNumber",displayName:"billing.invoiceNumber",headerCellFilter:"translate"},{field:"invoiceAmount",displayName:"billing.invoiceAmount",headerCellFilter:"translate"},{field:"settleAmount",displayName:"billing.settleAmt",headerCellFilter:"translate"},{field:"dueAmount",displayName:"billing.dueAmt",headerCellFilter:"translate"}]},c.subGridOptions={columnDefs:[{field:"billNumber",displayName:"billing.billNo",headerCellFilter:"translate",width:"120"},{field:"billDate",displayName:"billing.billDate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.billDate.$| date:"dd/MM/yyyy"}}</div>',headerCellFilter:"translate",width:"120"},{field:"billAmount",displayName:"billing.billAmt",headerCellFilter:"translate",width:"120"},{field:"discountAmount",displayName:"billing.discAmt",headerCellFilter:"translate",width:"150"},{field:"concessionAmount",displayName:"billing.concssionAmt",headerCellFilter:"translate",width:"150"},{field:"mrNumber",displayName:"billing.uhid",headerCellFilter:"translate",width:"120"},{field:"patientName",displayName:"billing.patientName",headerCellFilter:"translate",width:"150"},{field:"patientShare",displayName:"billing.patientShare",headerCellFilter:"translate",width:"120"},{field:"payerShare",displayName:"billing.payerShare",headerCellFilter:"translate",width:"120"},{field:"patientSetlAmount",displayName:"billing.patientSettlementAmt",headerCellFilter:"translate",width:"180"},{field:"payerSetlAmount",displayName:"billing.payerSettlementAmt",headerCellFilter:"translate",width:"180"},{field:"patientDueAmount",displayName:"billing.patientDueAmt",headerCellFilter:"translate",width:"150"},{field:"payerDueAmount",displayName:"billing.payerDueAmt",headerCellFilter:"translate",width:"140"}]},c.gridOptions.onRegisterApi=function(e){c.gridApi=e},c.gridOptions.data=[],c.payerSearch=function(e){var a="%"+e+"%";c.payerName=[],c.multipleComboDataForList={1:c.payerName};var i=t.executeQueryURLReset();return c.payerNameList=new Array,t.prepareParamListWithParam("pCompCode",a,c.payerNameList),t.prepareParamListWithParam("pCompCode",a,c.payerNameList),t.prepareParamListWithParam("pCompName",a,c.payerNameList),t.prepareParamListWithParam("pCompName",a,c.payerNameList),t.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,c.payerNameList),t.executeQueryInput("GET_COPMANY_ACC_BILL_DTLS",c.payerNameList,c.multipleComboDataForList,!0,!0,i,"popUp",{}).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})},c.selectPayer=function(e){},c.searchDetails=function(){if(null!=c.payer&&null!=c.payer&&""!==c.payer&&null!=c.payer.INS_SEQ_ID){var e={};e.url=a.HISDEPOSITSEARCH.URL,e.requestData={operation:"getCreditLettersTracking",destination:"com.napier.core.invoicesettlement.service.external.InvoiceService",message:{"@class":"com.napier.core.invoicesettlement.vo.CreditLettersTrackingHeader",payerSeqId:c.payer.INS_SEQ_ID}},i.sendRestRequest(e).then(function(e){if(c.gridOptions.data=[],null!=e.data.HITService.message&&null!=e.data.HITService.message[0]&&null!=e.data.HITService.message[0]["com.napier.core.invoicesettlement.vo.CreditLettersTrackingHeader"]){let t=e.data.HITService.message[0]["com.napier.core.invoicesettlement.vo.CreditLettersTrackingHeader"];t=t instanceof Array?t:[t];for(let e=0;e<t.length;e++){let a=[];null!=t[e].creditLettersTrackingDetailsList[0]&&null!=t[e].creditLettersTrackingDetailsList[0]["com.napier.core.invoicesettlement.vo.CreditLettersTrackingDetails"]&&(a=(a=t[e].creditLettersTrackingDetailsList[0]["com.napier.core.invoicesettlement.vo.CreditLettersTrackingDetails"])instanceof Array?a:[a]),t[e].creditLettersTrackingDetailsList=angular.copy(c.subGridOptions),t[e].creditLettersTrackingDetailsList.data=[],t[e].creditLettersTrackingDetailsList.data=angular.copy(a)}c.gridOptions.data=t}else c.gridOptions.data=[],r.information("Information","No Record(s) Found",!1,!1,n.time)})}else r.information("Information","Please Select Payer",!1,!1,n.time)},c.clear=function(){c.gridOptions.data=[],c.payer=void 0}}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s){var o=this;o.cloneObj={};var c={1:o.payerList=[]},d=r.executeQueryURLReset(),p=new Array;r.prepareParamListWithParam("pFACILITY_ID",l.facilityId,p),r.executeQueryInput("CLONE_PAYER_DROP_DOWN_LIST",p,c,!0,!0,d,"popUp",{}).then(function(e){}),o.changePayerGetPlan=function(e){if(o.planData=void 0,null!=e&&null!=e&&""!==e){let t={1:o.planList=[]},a=r.executeQueryURLReset(),i=new Array;r.prepareParamListWithParam("pINC_SEQ_ID",e,i),r.prepareParamListWithParam("pFACILITY_ID",l.facilityId,i),r.executeQueryInput("PALN_AUTO_COMPLETE",i,t,!0,!0,a,"popUp",{}).then(function(e){})}},o.clonePlan=function(){s.close(o.cloneObj)}}e.$inject=["hisAlertService","hisGenericAlertService","hisTranslationsService","hisTranslationsGlobalLang","QueryService","hisAlertConstants","cpData","$uibModalInstance"],angular.module("napierContainerUi").controller("creditCloneCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y){var f=this;d.loadModule("billing");var C=p.getLanguageToSet();function I(){f.packageCoverType="1",f.packageCoverTypePlan="1",f.tariffDeleteExclList=[],f.tariffDeleteInclList=[],f.planDeleteExclList=[],f.planDeleteInclList=[],f.dignosisDeleteInclList=[],f.dignosisDeleteExclList=[],f.copyData=[],f.defaultData=[],f.discountData=[],f.treeViewDataRemove=[],f.spliceList=[],f.planTreeViewDataRemove=[],f.tempPlanServiceData=[],f.planServiceExclListRemove=[],f.planServiceInclListRemove=[],f.treeViewData=[],f.planTreeViewData=[],f.deptdwn_copay=[],f.plansList=[],f.savedPlansList=[],f.plansChildList=[],f.deptSpecicityIpService=[],f.deptSpecicityOpService=[],f.deptSpecicityDefaultService=[],f.deptSpecicityDiscountService=[],f.deptSpecicityOpCoInsuranceService=[],f.deptSpecicityIpCoInsuranceService=[],f.deptdwn_ip=[],f.deptdwn_discount=[],f.deptdwn_ipCoinsurance=[],f.deptdwn_opCoinsurance=[],f.deptdwn_op=[],f.deptdwn_default=[];var i,r,l;f.typeHead=!1,f.disableFieldsForTPA=!1,f.headerData={level:1},f.planHeaderData={level:1},f.patDetails={},f.fromDateOptions={minDate:new Date},f.toDateOptions={minDate:new Date},f.planFromDateOptions={minDate:new Date,maxDate:new Date},f.planToDateOptions={minDate:new Date,maxDate:new Date},f.inclGridOptions=angular.copy(t),f.exclGridOptions=angular.copy(a),f.servicesGridOptions=angular.copy(c),f.treeViewData=[],f.planInclGridOptions=angular.copy(t),f.diagnosisExclGridOptions=angular.copy(S),f.diagnosisInclGridOptions=angular.copy(S),f.diagnosisExclGridOptions.data[0]={type:2},f.diagnosisInclGridOptions.data[0]={type:1},f.planExclGridOptions=angular.copy(a),f.planServicesGridOptions=angular.copy(c),f.planServicesGridOptions.data=[{inclusion:1,isRequired:1,level:1,apprIsAmtPercNl:1,applicability:1}],f.planServicesGridOptions.columnDefs[5].visible=!0,f.planServicesGridOptions.columnDefs[6].visible=!0,f.planServicesGridOptions.columnDefs[7].visible=!0,f.ipCoPayGridOptions=angular.copy(g),f.opCoPayGridOptions=angular.copy(g),f.defaultAuthGridOptions=angular.copy(g),f.discountGridOptions=angular.copy(g),f.opCoInsuranceGridOptions=angular.copy(g),f.ipCoInsuranceGridOptions=angular.copy(g),f.ipCoPayGridOptions.columnDefs[7].visible=!0,f.defaultAuthGridOptions.columnDefs[4].visible=!0,f.defaultAuthGridOptions.columnDefs[5].visible=!0,f.defaultAuthGridOptions.columnDefs[6].visible=!0,f.opCoPayGridOptions.columnDefs[7].visible=!0,f.discountGridOptions.columnDefs[8].visible=!0,f.opCoInsuranceGridOptions.columnDefs[9].visible=!0,f.ipCoInsuranceGridOptions.columnDefs[9].visible=!0,f.defaultAuthGridOptions.data[0]={type:1},f.opCoPayGridOptions.data[0]={type:3},f.ipCoPayGridOptions.data[0]={type:2},f.discountGridOptions.data[0]={type:4},f.opCoInsuranceGridOptions.data[0]={type:5},f.ipCoInsuranceGridOptions.data[0]={type:6},f.planTreeViewData=[],f.dataClear(),i={1:e.storeList=[],2:f.facilityList=[],3:f.othersList=[],4:f.tariffList=[],5:f.primaryServiceList=[],6:f.insuranceList=[{INC_COMP_ID:"1",INC_SEQ_ID:"1",INC_COMP_NAME:"SELF"}],7:f.tpaList=[{INC_COMP_ID:"1",INC_SEQ_ID:"1",INC_COMP_NAME:"SELF"}],8:f.childInsuranceList=[{INC_COMP_ID:"1",INC_SEQ_ID:"1",INC_COMP_NAME:"SELF"}],9:f.applicabilityList=[],10:f.taxTypeList=[]},r=u.executeQueryURLReset(),l=new Array,u.prepareParamListWithParam("practiceId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,l),u.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,l),u.prepareParamListWithParam("pInsurance",1,l),u.prepareParamListWithParam("pTpa",1,l),u.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,l),u.prepareParamListWithParam("pFacility",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,l),u.prepareParamListWithParam("pFACILITY_ID",f.data.facilityId?f.data.facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,l),u.prepareParamListWithParam("pAddType","001",l),u.prepareParamListWithParam("pFacType","006",l),u.prepareParamListWithParam("pMasterSqId","800021",l),u.executeQueryInput("GET_DEFAULT_COUNTRY",l,i,!0,!1,r,"popUp"),u.executeQueryInput("FACILITY_DROPDOWN",l,i,!0,!1,r,"popUp"),u.executeQueryInput("CREDIT_PAYER_DROP_DOWEN",[],i,!0,!1,r,"popUp"),u.executeQueryInput("TARIFF_CATG_DROP_DOWEN",[],i,!0,!1,r,"popUp"),u.executeQueryInput("BL_GET_PSG_SEARCH_SP",l,i,!0,!1,r,"popUp"),u.executeQueryInput("GET_INSURANCE_DETAILS_CREDIT",l,i,!0,!1,r,"popUp"),u.executeQueryInput("GET_TPA_DETAILS_CREDIT",l,i,!0,!1,r,"popUp"),u.executeQueryInput("CLONE_PAYER_DROP_DOWN_LIST",l,i,!0,!1,r,"popUp"),u.executeQueryInput("TRN003",l,i,!0,!1,r,"popUp"),u.executeQueryInput("SCM_TAX_MASTER_DROP_DOWN_001",[],i,!0,!0,r,"popUp",{}).then(function(t){var a,i,r;t[1]&&(f.defaultCountryCode=e.storeList[0].ADDR_LEVEL_CODE?e.storeList[0].ADDR_LEVEL_CODE:"in",$(".initCountry").intlTelInput("setCountry",f.defaultCountryCode),f.data.facilityId=_.find(f.facilityList,function(e){return e.CODE==(f.checkFlag?parseInt(f.checkFlag):angular.fromJson(sessionStorage.userContextObj).FACILITY_ID)}).CODE,f.checkFlag=void 0,f.data.insurance=f.insuranceList[0].INC_SEQ_ID,f.data.tpa=f.insuranceList[0].INC_SEQ_ID,f.data.tpa=f.insuranceList[0].INC_SEQ_ID,f.data.tariff=f.tariffList[0].CODE,a={1:f.payersParentList=[]},i=u.executeQueryURLReset(),r=new Array,u.prepareParamListWithParam("pFACILITY_ID",f.data.facilityId,r),u.executeQueryInput("CLONE_PAYER_DROP_DOWN_LIST",r,a,!0,!0,i,"popUp",{}))}),n.loadCombos("getNationality").then(function(e){angular.isArray(e)&&(f.NationalityCombo=e)}),n.getCityStateCountrydata("getCityByCode").then(function(e){angular.isArray(e)&&(f.CitiesListCombo=e),f.getDefaultOptionsSelf(),f.Defaultlocation()}),n.getCityStateCountrydata("getStateByCountryCode").then(function(e){angular.isArray(e)&&(f.StateListCombo=e)}),n.getCityStateCountrydata("getCountryByCode").then(function(e){angular.isArray(e)&&(f.CountryListCombo=e)}),f.permissionList=D.rolePermission("TM_CREDIT_PAYER")}function A(e,t,a,i,r){if(null==t.srivceTreeList)t.srivceTreeList=[],t.srivceTreeList.push({cisSeqId:r[a].CIS_SEQ_ID,primServGroup:{DESCRIPTION:r[a].PSG_DESC,CODE:r[a].PSG_CODE,IS_MATERIAL:r[a].IS_MATERIAL},payerSerSeqId:r[a].PAYER_SER_SEQ_ID,department:{DESCRIPTION:r[a].DEPT_DESC,CODE:r[a].DEPT_CODE},speciality:{DESCRIPTION:r[a].SPL_DESC,CODE:r[a].SPL_CODE},servCode:r[a].SERV_CODE,servName:{SERV_CODE:r[a].SERV_CODE,SERV_NAME:r[a].SERV_NAME,SERV_SEQ_ID:r[a].SER_SEQ_ID},inclusion:r[a].IS_INCL_OR_EXCL,isRequired:r[a].IS_APPROVAL_REQUIRED,level:r[a].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:r[a].IS_AMT_NL_PERC?r[a].IS_AMT_NL_PERC.toString():void 0,applicability:r[a].APPLICABILITY_TYPE,approvedQty:r[a].QTY,approvedAmount:r[a].INCL_AMOUNT,gnStatus:1}),t.srivceTreeList[0][r[a].BED_CLASS_CODE]=r[a].BED_CLASS_AMT,t.srivceTreeList[0]["sbclSeqId"+r[a].BED_CLASS_CODE]=r[a].SBCL_SEQ_ID;else for(let e=0;e<t.srivceTreeList.length;e++){if(r[a].CIS_SEQ_ID&&t.srivceTreeList[e].cisSeqId==r[a].CIS_SEQ_ID){t.srivceTreeList[e][r[a].BED_CLASS_CODE]=r[a].BED_CLASS_AMT,t.srivceTreeList[e]["sbclSeqId"+r[a].BED_CLASS_CODE]=r[a].SBCL_SEQ_ID;break}if(e==t.srivceTreeList.length-1){t.srivceTreeList.push({primServGroup:{DESCRIPTION:r[a].PSG_DESC,CODE:r[a].PSG_CODE,IS_MATERIAL:r[a].IS_MATERIAL},payerSerSeqId:r[a].PAYER_SER_SEQ_ID,department:{DESCRIPTION:r[a].DEPT_DESC,CODE:r[a].DEPT_CODE},speciality:{DESCRIPTION:r[a].SPL_DESC,CODE:r[a].SPL_CODE},servCode:r[a].SERV_CODE,servName:{SERV_CODE:r[a].SERV_CODE,SERV_NAME:r[a].SERV_NAME,SERV_SEQ_ID:r[a].SER_SEQ_ID},inclusion:r[a].IS_INCL_OR_EXCL,isRequired:r[a].IS_APPROVAL_REQUIRED,level:r[a].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:r[a].IS_AMT_NL_PERC?r[a].IS_AMT_NL_PERC.toString():void 0,applicability:r[a].APPLICABILITY_TYPE,approvedQty:r[a].QTY,approvedAmount:r[a].INCL_AMOUNT,cisSeqId:r[a].CIS_SEQ_ID?r[a].CIS_SEQ_ID:void 0,gnStatus:1}),t.srivceTreeList[e+1][r[a].BED_CLASS_CODE]=r[a].BED_CLASS_AMT,t.srivceTreeList[e+1]["sbclSeqId"+r[a].BED_CLASS_CODE]=r[a].SBCL_SEQ_ID;break}}}function E(e){if(e.specltyTreeList)for(let t=0;t<e.specltyTreeList.length;t++)e.specltyTreeList[t].gnStatus=2,h(e.specltyTreeList[t])}function h(e){if(e.srivceTreeList)for(let t=0;t<e.srivceTreeList.length;t++)e.srivceTreeList[t].gnStatus=2}function b(e,t){parseFloat(t.entity.approvedAmount)>parseFloat(100)&&(t.entity.approvedAmount=100);for(let a=1;f.planInclGridOptions.data.length>a;a++){let i=f.planInclGridOptions.data[a].bedClassName.CODE;parseFloat(e)>parseFloat(100)?t.entity[i]=100:t.entity[i]=e}}d.changeLanguage(C),f.format=angular.copy(m.uibDateOnly.format),delete y.ngModelOptions.timezone,s.loadAlerts(C).then(function(t){e.alertObjectRes=t,e.alertData={buttonText:e.alertObjectRes.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}},function(e){}),f.dataClear=function(){f.typeHead=!1,f.data={status:1,payerCategory:f.catFlag?f.catFlag:1,fromDate:new Date,toDate:"",planFromDate:new Date,planToDate:"",payerTypeInsurer:2,payerTypeTpa:2,payerTypeOther:2,taxType:"",childPlan:[]},f.planClear()},f.planClear=function(){f.data.planDetails={defaultAuth:"1",opCopayLevel:"1",ipCopayLevel:"1",coInsurance:"1",discountLevel:"1",coInsuranceOp:"1",coInsuranceIp:"1"},f.planInclGridOptions.data=[{}],f.planExclGridOptions.data=[{}],f.planServicesGridOptions=angular.copy(c),f.planServicesGridOptions.columnDefs[5].visible=!0,f.planServicesGridOptions.columnDefs[6].visible=!0,f.planServicesGridOptions.columnDefs[7].visible=!0,f.discountGridOptions.data=[{type:4}],f.ipCoPayGridOptions.data=[{type:2}],f.opCoPayGridOptions.data=[{type:3}],f.diagnosisInclGridOptions.data=[{type:1}],f.diagnosisExclGridOptions.data=[{type:2}],f.ipCoInsuranceGridOptions.data=[{type:6}],f.opCoInsuranceGridOptions.data=[{type:5}],f.planTreeViewData=[],f.planExclGridOptions.data=[{}],f.planInclGridOptions.data=[{}]},f.getDefaultPlanDetails=function(e){var t=e;if(f.planClear(),f.data.plans||e){var a={1:f.primaryServicePlanList=[],2:f.diagnosisList=[],3:f.discountList=[],4:f.pocketList=[],5:f.defaultList=[],6:f.planServiceList=[]},i=u.executeQueryURLReset(),r=new Array;u.prepareParamListWithParam("pPLAN_SEQ_ID",e?f.data.clonePlan.INC_PLAN_SEQ_ID:f.data.plans.INC_PLAN_SEQ_ID,r),u.prepareParamListWithParam("pIncSeqId",e?f.data.clonePlan.INC_SEQ_ID:f.data.plans.INC_SEQ_ID,r),u.prepareParamListWithParam("pPlanSeqId",e?f.data.clonePlan.INC_PLAN_SEQ_ID:f.data.plans.INC_PLAN_SEQ_ID,r),u.prepareParamListWithParam("pINC_PLAN_SEQ_ID",e?f.data.clonePlan.INC_PLAN_SEQ_ID:f.data.plans.INC_PLAN_SEQ_ID,r),u.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r),u.prepareParamListWithParam("pFACILITY_ID",f.data.facilityId,r),u.prepareParamListWithParam("pPAT_TYPE",-999,r),u.prepareParamListWithParam("pIS_COPAY_OR_COINSURANCE",-999,r),u.prepareParamListWithParam("pPRACTICE_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r),u.prepareParamListWithParam("pPRACTICEID",f.data.facilityId,r),u.prepareParamListWithParam("pFACILITY_ID",f.data.facilityId,r),u.executeQueryInput("BL_GET_PLAN_PSG_SEARCH_SP",r,a,!0,!1,i,"popUp"),u.executeQueryInput("GET_PLAN_DIAGNOSIS_DETAILS",r,a,!0,!1,i,"popUp"),u.executeQueryInput("GET_PLAN_DISCOUNT_DETAILS",r,a,!0,!1,i,"popUp"),u.executeQueryInput("GET_PLAN_OUTPOCKET_DETAILS",r,a,!0,!1,i,"popUp"),u.executeQueryInput("GET_PLAN_DEFALUT_PREAUTH_DETAILS",r,a,!0,!1,i,"popUp"),u.executeQueryInput("BL_GET_CREDIT_PLAN_SERVICE_DTLS",r,a,!0,!0,i,"popUp",{}).then(function(e){if(e[1]){f.data.planDetails={defaultAuth:f.data.plans.IS_PRE_AUTH_BILL_OR_SERVICE_LEVEL,defaultAuthValue:f.data.plans.DEFAULT_AUTH_VALUE,duration:f.data.plans.PRE_AUTH_DURATION,durationType:f.data.plans.PRE_AUTH_DURATION_TYPE?_.find(f.applicabilityList,function(e){return e.DT_CODE==f.data.plans.PRE_AUTH_DURATION_TYPE}).DT_CODE:void 0,ipCopayLevel:f.data.plans.COPAY_IP,ipCopayValue:f.data.plans.COPAY_PERCENTAGE_IP,opCopayLevel:f.data.plans.COPAY,opCopayValue:f.data.plans.PATIENT_COPAY_PERCENTAGE,coInsuranceIp:1,coInsuranceOp:1,coInsuranceIpValue:f.data.plans.COINSURANCE_VALUE_IP,coInsuranceOpValue:f.data.plans.COINSURANCE_VALUE_OP,opDeductable:f.data.plans.DEDUCTABLE_AMT,ipDeductable:f.data.plans.IP_DEDUCTABLE_AMOUNT,opMaxCopay:f.data.plans.OP_MAX_OUT_OF_POCKET,ipMaxCopay:f.data.plans.IP_MAX_OUT_OF_POCKET,discountLevel:f.data.plans.BILL_LEVEL_DISCOUNT,discountValue:f.data.plans.DISCOUNT_PERCENT};for(var a=0;a<f.diagnosisList.length;a++){let e={pidsSeqId:f.diagnosisList[a].PIDS_SEQ_ID?f.diagnosisList[a].PIDS_SEQ_ID:void 0,status:f.diagnosisList[a].GN_STATUS,diagnosisName:{ICDCODE:f.diagnosisList[a].DIAG_CODE,DESCRIPTION:f.diagnosisList[a].DIAG_NAME},diagnosisCode:f.diagnosisList[a].DIAG_CODE,type:f.diagnosisList[a].IS_INCL_OR_EXCL};1==f.diagnosisList[a].IS_INCL_OR_EXCL?f.diagnosisInclGridOptions.data.push(e):f.diagnosisExclGridOptions.data.push(e)}for(a=0;a<f.discountList.length;a++){let e={discSeqId:!t&&f.discountList[a].DISC_SEQ_ID?f.discountList[a].DISC_SEQ_ID:void 0,status:f.discountList[a].GN_STATUS,primayServiceGroup:_.find(f.primaryServiceList,function(e){return e.CODE==f.discountList[a].PRI_SERV_SEQ_ID}),department:{CODE:f.discountList[a].DEPT_CODE,DESCRIPTION:f.discountList[a].DEPT_DESC},speciality:{DESCRIPTION:f.discountList[a].SPL_DESC,CODE:f.discountList[a].SEPL_CODE},servName:{SERV_CODE:f.discountList[a].SERV_CODE,SERV_NAME:f.discountList[a].SERV_DESC,SERV_SEQ_ID:f.discountList[a].SERV_SEQ_ID},discount:f.discountList[a].DISCOUNT_VALUE,serviceHierarcyLevel:f.discountList[a].SERVICE_HIERARCHY_LEVEL?f.discountList[a].SERVICE_HIERARCHY_LEVEL:1,type:4};f.discountGridOptions.data.push(e),f.changePrimaryGroup(e,a+1,!0)}f.planServicesGridOptions.data=[{inclusion:1,isRequired:1,level:1,apprIsAmtPercNl:1,applicability:1}];for(a=0;a<f.pocketList.length;a++){let e={copaySeqId:!t&&f.pocketList[a].COPAY_SEQ_ID?f.pocketList[a].COPAY_SEQ_ID:void 0,status:f.pocketList[a].GN_STATUS,primayServiceGroup:_.find(f.primaryServiceList,function(e){return e.CODE==f.pocketList[a].PRI_SERV_SEQ_ID}),department:{CODE:f.pocketList[a].DEPT_CODE,DESCRIPTION:f.pocketList[a].DEPT_DESC},speciality:{DESCRIPTION:f.pocketList[a].SPL_DESC,CODE:f.pocketList[a].SEPL_CODE},servName:{SERV_CODE:f.pocketList[a].SERV_CODE,SERV_NAME:f.pocketList[a].SERV_DESC,SERV_SEQ_ID:f.pocketList[a].SERV_SEQ_ID},serviceHierarcyLevel:f.pocketList[a].SERVICE_HIERARCHY_LEVEL?f.pocketList[a].SERVICE_HIERARCHY_LEVEL:1,copayment:1==f.pocketList[a].IS_COPAY_OR_COINSURANCE?f.pocketList[a].VALUE:void 0,coInsurance:2==f.pocketList[a].IS_COPAY_OR_COINSURANCE?f.pocketList[a].VALUE:void 0,type:1==f.pocketList[a].IS_COPAY_OR_COINSURANCE&&1==f.pocketList[a].PAT_TYPE?2:1==f.pocketList[a].IS_COPAY_OR_COINSURANCE&&2==f.pocketList[a].PAT_TYPE?3:2==f.pocketList[a].IS_COPAY_OR_COINSURANCE&&2==f.pocketList[a].PAT_TYPE?5:6};if(2==e.type){f.ipCoPayGridOptions.data.push(e);var i=f.opCoInsuranceGridOptions.data.length-1}else if(3==e.type){f.opCoPayGridOptions.data.push(e);i=f.opCoPayGridOptions.data.length-1}else if(5==e.type){f.opCoInsuranceGridOptions.data.push(e);i=f.opCoInsuranceGridOptions.data.length-1}else if(6==e.type){f.ipCoInsuranceGridOptions.data.push(e);i=f.ipCoInsuranceGridOptions.data.length-1}i>0&&f.changePrimaryGroup(e,i,!0)}f.defaultAuthGridOptions.data=[{type:1}];for(a=0;a<f.defaultList.length;a++){let e={pdpaSeqId:!t&&f.defaultList[a].PDPA_SEQ_ID?f.defaultList[a].PDPA_SEQ_ID:void 0,status:f.defaultList[a].GN_STATUS,approvedAmount:f.defaultList[a].AMOUNT,durationType:f.defaultList[a].DURATION_TYPE,duration:f.defaultList[a].DURATION,quantity:f.defaultList[a].QTY,apprIsAmtPercNl:f.defaultList[a].IS_AMT_PERC_NL_CODE?f.defaultList[a].IS_AMT_PERC_NL_CODE.toString():void 0,type:1,primayServiceGroup:_.find(f.primaryServiceList,function(e){return e.CODE==f.defaultList[a].PRI_SERV_CODE}),serviceHierarcyLevel:f.defaultList[a].SERVICE_HIERARCHY_LEVEL?f.defaultList[a].SERVICE_HIERARCHY_LEVEL:1,department:{CODE:f.defaultList[a].DEPT_CODE,DESCRIPTION:f.defaultList[a].DEPT_DESC},speciality:{DESCRIPTION:f.defaultList[a].SPL_DESC,CODE:f.defaultList[a].SPL_CODE},servName:{SERV_CODE:f.defaultList[a].SERV_CODE,SERV_NAME:f.defaultList[a].SERV_NAME,SERV_SEQ_ID:f.defaultList[a].SERV_SEQ_ID}};f.defaultAuthGridOptions.data.push(e),f.changePrimaryGroup(e,a+1,!0)}f.planTreeViewData=[];for(let e=0;e<f.planServiceList.length;e++)if(f.planServiceList[e].IS_MATERIAL=2==f.planServiceList[e].IS_MATERIAL?"Y":"N",f.planServiceList[e].CIS_SEQ_ID=t?void 0:f.planServiceList[e].CIS_SEQ_ID,f.planServiceList[e].IS_APPROVAL_REQUIRED=f.planServiceList[e].APPROVAL_REQUIRED?f.planServiceList[e].APPROVAL_REQUIRED:void 0,1==f.planServiceList[e].SERVICE_HIERARCHY_LEVEL)if(0==f.planTreeViewData.length)f.planTreeViewData.push({cisSeqId:f.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:f.planServiceList[e].PSG_DESC,CODE:f.planServiceList[e].PSG_CODE,IS_MATERIAL:f.planServiceList[e].IS_MATERIAL},payerSerSeqId:t?void 0:f.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.planServiceList[e].DEPT_DESC,CODE:f.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:f.planServiceList[e].SPL_DESC,CODE:f.planServiceList[e].SPL_CODE},servCode:f.planServiceList[e].SERV_CODE,servName:{SERV_CODE:f.planServiceList[e].SERV_CODE,SERV_NAME:f.planServiceList[e].SERV_NAME,SERV_SEQ_ID:f.planServiceList[e].SERV_SEQ_ID},inclusion:f.planServiceList[e].IS_INCL_OR_EXCL,isRequired:f.planServiceList[e].IS_APPROVAL_REQUIRED,level:f.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:f.planServiceList[e].IS_AMT_NL_PERC?f.planServiceList[e].IS_AMT_NL_PERC.toString():void 0,applicability:f.planServiceList[e].APPLICABILITY_TYPE,approvedQty:f.planServiceList[e].QTY,approvedAmount:f.planServiceList[e].INCL_AMOUNT,gnStatus:1}),f.planTreeViewData[0][f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].BED_CLASS_AMT,f.planTreeViewData[0]["sbclSeqId"+f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].SBCL_SEQ_ID;else for(let a=0;a<f.planTreeViewData.length;a++){if(f.planTreeViewData[a].cisSeqId==f.planServiceList[e].CIS_SEQ_ID){f.planTreeViewData[a][f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].BED_CLASS_AMT,f.planTreeViewData[a]["sbclSeqId"+f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].SBCL_SEQ_ID;break}if(a==f.planTreeViewData.length-1){f.planTreeViewData.push({cisSeqId:f.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:f.planServiceList[e].PSG_DESC,CODE:f.planServiceList[e].PSG_CODE,IS_MATERIAL:f.planServiceList[e].IS_MATERIAL},payerSerSeqId:t?void 0:f.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.planServiceList[e].DEPT_DESC,CODE:f.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:f.planServiceList[e].SPL_DESC,CODE:f.planServiceList[e].SPL_CODE},servCode:f.planServiceList[e].SERV_CODE,servName:{SERV_CODE:f.planServiceList[e].SERV_CODE,SERV_NAME:f.planServiceList[e].SERV_NAME,SERV_SEQ_ID:f.planServiceList[e].SERV_SEQ_ID},inclusion:f.planServiceList[e].IS_INCL_OR_EXCL,isRequired:f.planServiceList[e].IS_APPROVAL_REQUIRED,level:f.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:f.planServiceList[e].IS_AMT_NL_PERC?f.planServiceList[e].IS_AMT_NL_PERC.toString():void 0,applicability:f.planServiceList[e].APPLICABILITY_TYPE,approvedQty:f.planServiceList[e].QTY,approvedAmount:f.planServiceList[e].INCL_AMOUNT,gnStatus:1}),f.planTreeViewData[a+1][f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].BED_CLASS_AMT,f.planTreeViewData[a+1]["sbclSeqId"+f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].SBCL_SEQ_ID;break}}else if(2==f.planServiceList[e].SERVICE_HIERARCHY_LEVEL){for(let a=0;a<f.planTreeViewData.length;a++)if(f.planTreeViewData[a].primServGroup.CODE==f.planServiceList[e].PSG_CODE)if(null==f.planTreeViewData[a].departTreeList)f.planTreeViewData[a].departTreeList=[],f.planTreeViewData[a].departTreeList.push({cisSeqId:f.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:f.planServiceList[e].PSG_DESC,CODE:f.planServiceList[e].PSG_CODE,IS_MATERIAL:f.planServiceList[e].IS_MATERIAL},payerSerSeqId:t?void 0:f.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.planServiceList[e].DEPT_DESC,CODE:f.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:f.planServiceList[e].SPL_DESC,CODE:f.planServiceList[e].SPL_CODE},servCode:f.planServiceList[e].SERV_CODE,servName:{SERV_CODE:f.planServiceList[e].SERV_CODE,SERV_NAME:f.planServiceList[e].SERV_NAME,SERV_SEQ_ID:f.planServiceList[e].SERV_SEQ_ID},inclusion:f.planServiceList[e].IS_INCL_OR_EXCL,isRequired:f.planServiceList[e].IS_APPROVAL_REQUIRED,level:f.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:f.planServiceList[e].IS_AMT_NL_PERC?f.planServiceList[e].IS_AMT_NL_PERC.toString():void 0,applicability:f.planServiceList[e].APPLICABILITY_TYPE,approvedQty:f.planServiceList[e].QTY,approvedAmount:f.planServiceList[e].INCL_AMOUNT,gnStatus:1}),f.planTreeViewData[a].departTreeList[0][f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].BED_CLASS_AMT,f.planTreeViewData[a].departTreeList[0]["sbclSeqId"+f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].SBCL_SEQ_ID;else for(let i=0;i<f.planTreeViewData[a].departTreeList.length;i++){if(f.planTreeViewData[a].departTreeList[i].cisSeqId==f.planServiceList[e].CIS_SEQ_ID){f.planTreeViewData[a].departTreeList[i][f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].BED_CLASS_AMT,f.planTreeViewData[a].departTreeList[i]["sbclSeqId"+f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].SBCL_SEQ_ID;break}if(i==f.planTreeViewData[a].departTreeList.length-1){f.planTreeViewData[a].departTreeList.push({cisSeqId:f.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:f.planServiceList[e].PSG_DESC,CODE:f.planServiceList[e].PSG_CODE,IS_MATERIAL:f.planServiceList[e].IS_MATERIAL},payerSerSeqId:t?void 0:f.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.planServiceList[e].DEPT_DESC,CODE:f.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:f.planServiceList[e].SPL_DESC,CODE:f.planServiceList[e].SPL_CODE},servCode:f.planServiceList[e].SERV_CODE,servName:{SERV_CODE:f.planServiceList[e].SERV_CODE,SERV_NAME:f.planServiceList[e].SERV_NAME,SERV_SEQ_ID:f.planServiceList[e].SERV_SEQ_ID},inclusion:f.planServiceList[e].IS_INCL_OR_EXCL,isRequired:f.planServiceList[e].IS_APPROVAL_REQUIRED,level:f.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:f.planServiceList[e].IS_AMT_NL_PERC?f.planServiceList[e].IS_AMT_NL_PERC.toString():void 0,applicability:f.planServiceList[e].APPLICABILITY_TYPE,approvedQty:f.planServiceList[e].QTY,approvedAmount:f.planServiceList[e].INCL_AMOUNT,gnStatus:1}),f.planTreeViewData[a].departTreeList[i+1][f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].BED_CLASS_AMT,f.planTreeViewData[a].departTreeList[i+1]["sbclSeqId"+f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].SBCL_SEQ_ID;break}}}else if(3==f.planServiceList[e].SERVICE_HIERARCHY_LEVEL){for(let a=0;a<f.planTreeViewData.length;a++)if(f.planTreeViewData[a].primServGroup.CODE==f.planServiceList[e].PSG_CODE&&f.planTreeViewData[a].departTreeList)for(let i=0;i<f.planTreeViewData[a].departTreeList.length;i++)if(f.planTreeViewData[a].departTreeList[i].department.CODE==f.planServiceList[e].DEPT_CODE)if(null==f.planTreeViewData[a].departTreeList[i].specltyTreeList)f.planTreeViewData[a].departTreeList[i].specltyTreeList=[],f.planTreeViewData[a].departTreeList[i].specltyTreeList.push({cisSeqId:f.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:f.planServiceList[e].PSG_DESC,CODE:f.planServiceList[e].PSG_CODE,IS_MATERIAL:f.planServiceList[e].IS_MATERIAL},payerSerSeqId:t?void 0:f.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.planServiceList[e].DEPT_DESC,CODE:f.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:f.planServiceList[e].SPL_DESC,CODE:f.planServiceList[e].SPL_CODE},servCode:f.planServiceList[e].SERV_CODE,servName:{SERV_CODE:f.planServiceList[e].SERV_CODE,SERV_NAME:f.planServiceList[e].SERV_NAME,SERV_SEQ_ID:f.planServiceList[e].SERV_SEQ_ID},inclusion:f.planServiceList[e].IS_INCL_OR_EXCL,isRequired:f.planServiceList[e].IS_APPROVAL_REQUIRED,level:f.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:f.planServiceList[e].IS_AMT_NL_PERC?f.planServiceList[e].IS_AMT_NL_PERC.toString():void 0,applicability:f.planServiceList[e].APPLICABILITY_TYPE,approvedQty:f.planServiceList[e].QTY,approvedAmount:f.planServiceList[e].INCL_AMOUNT,gnStatus:1}),f.planTreeViewData[a].departTreeList[i].specltyTreeList[0][f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].BED_CLASS_AMT,f.planTreeViewData[a].departTreeList[i].specltyTreeList[0]["sbclSeqId"+f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].SBCL_SEQ_ID;else for(let r=0;r<f.planTreeViewData[a].departTreeList[i].specltyTreeList.length;r++){if(f.planTreeViewData[a].departTreeList[i].specltyTreeList[r].cisSeqId==f.planServiceList[e].CIS_SEQ_ID){f.planTreeViewData[a].departTreeList[i].specltyTreeList[r][f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].BED_CLASS_AMT,f.planTreeViewData[a].departTreeList[i].specltyTreeList[r]["sbclSeqId"+f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].SBCL_SEQ_ID;break}if(r==f.planTreeViewData[a].departTreeList[i].specltyTreeList.length-1){f.planTreeViewData[a].departTreeList[i].specltyTreeList.push({cisSeqId:f.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:f.planServiceList[e].PSG_DESC,CODE:f.planServiceList[e].PSG_CODE,IS_MATERIAL:f.planServiceList[e].IS_MATERIAL},payerSerSeqId:t?void 0:f.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.planServiceList[e].DEPT_DESC,CODE:f.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:f.planServiceList[e].SPL_DESC,CODE:f.planServiceList[e].SPL_CODE},servCode:f.planServiceList[e].SERV_CODE,servName:{SERV_CODE:f.planServiceList[e].SERV_CODE,SERV_NAME:f.planServiceList[e].SERV_NAME,SERV_SEQ_ID:f.planServiceList[e].SERV_SEQ_ID},inclusion:f.planServiceList[e].IS_INCL_OR_EXCL,isRequired:f.planServiceList[e].IS_APPROVAL_REQUIRED,level:f.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:f.planServiceList[e].IS_AMT_NL_PERC?f.planServiceList[e].IS_AMT_NL_PERC.toString():void 0,applicability:f.planServiceList[e].APPLICABILITY_TYPE,approvedQty:f.planServiceList[e].QTY,approvedAmount:f.planServiceList[e].INCL_AMOUNT,gnStatus:1}),f.planTreeViewData[a].departTreeList[i].specltyTreeList[r+1][f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].BED_CLASS_AMT,f.planTreeViewData[a].departTreeList[i].specltyTreeList[r+1]["sbclSeqId"+f.planServiceList[e].BED_CLASS_CODE]=f.planServiceList[e].SBCL_SEQ_ID;break}}}else if(4==f.planServiceList[e].SERVICE_HIERARCHY_LEVEL)for(let a=0;a<f.planTreeViewData.length;a++)if(f.planTreeViewData[a].primServGroup.CODE==f.planServiceList[e].PSG_CODE&&f.planTreeViewData[a].departTreeList)for(let i=0;i<f.planTreeViewData[a].departTreeList.length;i++)if(f.planTreeViewData[a].departTreeList[i].department.CODE==f.planServiceList[e].DEPT_CODE&&f.planTreeViewData[a].departTreeList[i].specltyTreeList)for(let r=0;r<f.planTreeViewData[a].departTreeList[i].specltyTreeList.length;r++)f.planTreeViewData[a].departTreeList[i].specltyTreeList[r].speciality.CODE==f.planServiceList[e].SPL_CODE&&(f.planTreeViewData[a].departTreeList[i].specltyTreeList[r].payerSerSeqId=t?void 0:f.planTreeViewData[a].departTreeList[i].specltyTreeList[r].PAYER_SER_SEQ_ID,A(f,f.planTreeViewData[a].departTreeList[i].specltyTreeList[r],e,a,f.planServiceList));f.tempPlanServiceData=angular.copy(f.planTreeViewData);var r={1:f.getTariffList=[]},n=u.executeQueryURLReset(),l=new Array;u.prepareParamListWithParam("pFACILITY_ID",f.data.facilityId,l),u.prepareParamListWithParam("pINC_SEQ_ID",f.data.plans.INC_SEQ_ID,l),u.prepareParamListWithParam("pINC_PLAN_SEQ_ID",f.data.plans.INC_PLAN_SEQ_ID,l),u.prepareParamListWithParam("pIS_INCL_OR_EXCL",f.data.plans.IS_BED_CLASS_INCL_OR_EXCL,l),u.executeQueryInput("BL_GET_CREDIT_PAYER_AND_PLAN_BED_CLASS_DTLS",l,r,!0,!0,n,"popUp",{}).then(function(e){if(e[1][0]){for(var a=[],i=0;i<f.getTariffList.length;i++)a.push({tariffSeqId:!t&&f.getTariffList[i].TARFIFF_INCL_SEQ_ID?f.getTariffList[i].TARFIFF_INCL_SEQ_ID:!t&&f.getTariffList[i].TARFIFF_EXCL_SEQ_ID?f.getTariffList[i].TARFIFF_EXCL_SEQ_ID:void 0,status:f.getTariffList[i].GN_STATUS,bedClassName:{CODE:f.getTariffList[i].BC_CODE,DESCRIPTION:f.getTariffList[i].BC_DESC},bedClassCode:f.getTariffList[i].BC_CODE,type:f.data.bedClassInclusion});if(1==f.data.plans.IS_BED_CLASS_INCL_OR_EXCL){f.planInclGridOptions.data=_.concat(f.planInclGridOptions.data,a);for(i=1;i<f.planInclGridOptions.data.length;i++)f.addRmovColumnCoverGrid(f.planInclGridOptions.data[i])}else f.planExclGridOptions.data=_.concat(f.planExclGridOptions.data,a)}})}})}},f.OnChangeDept=function(t){e.specilityMap={1:f.specialityList=[]};var a,i=u.executeQueryURLReset(),r=new Array;u.prepareParamListWithParam("pPSG_CODE",t.primServGroup?t.primServGroup.CODE:-999,r),u.prepareParamListWithParam("pDEPT_CODE",t.department?t.department.CODE:-999,r),u.prepareParamListWithParam("pMetMainCatSeqId",t.department?t.department.CODE:-999,r),u.prepareParamListWithParam("pPRACTICEID",f.data.facilityId,r),u.prepareParamListWithParam("pIsMaterial",t.primServGroup&&"Y"==t.primServGroup.IS_MATERIAL?2:1,r),u.prepareParamListWithParam("pIncSeqId",f.data.plans?f.data.plans.INC_SEQ_ID:-999,r),a=3==e.activeFirst?t.primServGroup&&"Y"==t.primServGroup.IS_MATERIAL?"FETCH_MAT_SUB_GROUP":"BL_GET_SPECIALITY_SEARCH_SP":"BL_GET_PLAN_SPECIALITY_SEARCH_SP",u.executeQueryInput(a,r,e.specilityMap,!0,!0,i,"popUp",{})},f.onStateEdited=function(e){f.patDetails.city=""},f.onCountryEdited=function(e){f.patDetails.city="",f.patDetails.state=""},f.patDetails=function(e){f.patDetails.city="",f.patDetails.state=""},f.tariffAutoSuggest=function(t,a){var i={1:f.optServSerch=[]},r=u.executeQueryURLReset(),n=new Array;return u.prepareParamListWithParam("pPRACTICE_ID",f.data.facilityId,n),u.prepareParamListWithParam("pINC_SEQ_ID",f.data.plans?f.data.plans.INC_SEQ_ID:-999,n),u.prepareParamListWithParam("pIncOrExc",2==e.activeFirst?void 0:f.data.bedClassInclusion,n),u.prepareParamListWithParam("pIS_PAYER",2==e.activeFirst?1:f.data.plans?2:1,n),u.prepareParamListWithParam("pDESCRIPTION",t,n),u.executeQueryInput("TARIFF_NAME_DROP_DOWEN_NEW",n,i,!0,!0,r,"popUp",{}).then(function(e){if(e[1])return f.optServSerch.map(function(e){return e})})},f.changePrimaryServGroup=function(t){e.specilityMap={1:f.departmentList=[]};var a,i=u.executeQueryURLReset(),r=new Array;u.prepareParamListWithParam("pMetSubCatSeqId",t.primServGroup?t.primServGroup.CODE:-999,r),u.prepareParamListWithParam("pPSG_CODE",t.primServGroup?t.primServGroup.CODE:-999,r),u.prepareParamListWithParam("pPRACTICEID",f.data.facilityId,r),u.prepareParamListWithParam("pIsMaterial",t.primServGroup&&"Y"==t.primServGroup.IS_MATERIAL?"2":"1",r),u.prepareParamListWithParam("pIncSeqId",f.data.plans?f.data.plans.INC_SEQ_ID:-999,r),a=3==e.activeFirst?t.primServGroup&&"Y"==t.primServGroup.IS_MATERIAL?"FETCH_MAT_GROUP":"BL_GET_DEPARTMENT_SEARCH_SP":"BL_GET_PLAN_DEPARTMENT_SEARCH_SP",u.executeQueryInput(a,r,e.specilityMap,!0,!0,i,"popUp",{})},f.payerAutoSearch=function(e){var t={1:f.payerList=[]},a=u.executeQueryURLReset(),i=new Array;return u.prepareParamListWithParam("pPAYER_CATEGORY",f.data.payerCategory,i),u.prepareParamListWithParam("pFACILITY_ID",f.data.facilityId,i),u.prepareParamListWithParam("pCompId",e,i),u.executeQueryInput("COMAPNY_DETAILS_AUTO_COMPLETE",i,t,!0,!0,a,"popUp",{}).then(function(e){if(e[1])return f.payerList.map(function(e){return e})})},f.getPlansList=function(e){var t={1:f.plansList=[]},a=u.executeQueryURLReset(),i=new Array;u.prepareParamListWithParam("pINC_SEQ_ID",f.data.payerName.INC_SEQ_ID,i),u.prepareParamListWithParam("pFACILITY_ID",f.data.facilityId,i),u.executeQueryInput("PALN_AUTO_COMPLETE",i,t,!0,!0,a,"popUp",{}).then(function(e){if(e[1][0]){if(f.plansList.length>0&&(f.spliceList=f.plansList),f.updateSeqId&&f.plansList.length>0)for(var t=0;t<f.plansList.length;t++)f.plansList[t].INC_PLAN_SEQ_ID==f.updateSeqId&&setTimeout(function(){f.data.plans=f.plansList[t],f.updateSeqId=void 0},2e3);f.data.payerName.INC_SEQ_ID&&f.plansList.length>0&&setTimeout(function(){f.childPlanSelection()},2e3),f.savedPlansList=angular.copy(f.plansList)}})},f.getPlansChildList=function(e){if(f.data.parentPayer.INC_SEQ_ID){f.data.tariff=_.find(f.tariffList,function(e){return e.CODE==f.data.parentPayer.TARIFF_CATG_CODE}).CODE;var t={1:f.plansChildList=[]},a=u.executeQueryURLReset(),i=new Array;u.prepareParamListWithParam("pINC_SEQ_ID",f.data.parentPayer.INC_SEQ_ID,i),u.prepareParamListWithParam("pFACILITY_ID",f.data.facilityId,i),u.executeQueryInput("PALN_AUTO_COMPLETE",i,t,!0,!0,a,"popUp",{})}},f.serchOptimSpeciSerch=function(t,a,i){e.copayserviceMap={1:e.optServSerch=[]};var r,n=u.executeQueryURLReset(),l=new Array;return u.prepareParamListWithParam("pPSG_CODE",null!=a.primServGroup&&null!==a.primServGroup&&""!==a.primServGroup?null!=a.primServGroup.CODE?a.primServGroup.CODE:a.primServGroup:-999,l),u.prepareParamListWithParam("pDEPT_CODE",null!=a.department&&null!==a.department&&""!==a.department?null!=a.department.CODE?a.department.CODE:a.department:-999,l),u.prepareParamListWithParam("pSPECL_CODE",null!=a.speciality&&null!=a.speciality&&""!==a.speciality?null!=a.speciality.CODE?a.speciality.CODE:a.speciality:-999,l),u.prepareParamListWithParam("pSERV_NAME",t,l),u.prepareParamListWithParam("pMaterialCat",null!=a.primServGroup&&null!==a.primServGroup&&""!==a.primServGroup?null!=a.primServGroup.CODE?a.primServGroup.CODE:a.primServGroup:-999,l),u.prepareParamListWithParam("pMaterialGroup",null!=a.department&&null!==a.department&&""!==a.department?null!=a.department.CODE?a.department.CODE:a.department:-999,l),u.prepareParamListWithParam("pMaterialSubGroup",null!=a.speciality&&null!=a.speciality&&""!==a.speciality?null!=a.speciality.CODE?a.speciality.CODE:a.speciality:-999,l),u.prepareParamListWithParam("pMatCodeName",t,l),u.prepareParamListWithParam("pPRACTICEID",f.data.facilityId,l),u.prepareParamListWithParam("pIsMaterial",a.primServGroup&&"Y"==a.primServGroup.IS_MATERIAL?"2":"1",l),u.prepareParamListWithParam("pIncSeqId",f.data.plans?f.data.plans.INC_SEQ_ID:-999,l),r=3==e.activeFirst?"Y"==a.primServGroup.IS_MATERIAL?"PACKAGE_MATERIAL_DETAILS":"BL_GET_SERVICE_SEARCH_SP":"BL_GET_PLAN_SERVICE_SEARCH_SP",u.executeQueryInput(r,l,e.copayserviceMap,!0,!0,n,"popUp",{}).then(function(t){if(t[1])return e.optServSerch.map(function(e){return e})})},f.addInclusionBedClass=function(t,a){if(1==a){if(4==e.activeFirst)var i=angular.copy(f.planInclGridOptions.data);else i=angular.copy(f.inclGridOptions.data);for(var r=1;r<i.length;r++)if(i[r].bedClassCode==t.bedClassCode&&!i[r].editGrid){var n=e.alertObjectRes.RcdAldyExt;return void l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,n,!1,!1,e.close,2e3)}f.editIndex?i[f.editIndex]=angular.copy(t):i.push(t),i[0]={},4==e.activeFirst?(f.addRmovColumnCoverGrid(t),f.planInclGridOptions.data=angular.copy(i)):f.inclGridOptions.data=angular.copy(i)}else if(2==a){if(4==e.activeFirst)var s=angular.copy(f.planExclGridOptions.data);else s=angular.copy(f.exclGridOptions.data);for(r=1;r<s.length;r++)if(s[r].bedClassCode==t.bedClassCode&&!s[r].editGrid){n=e.alertObjectRes.RcdAldyExt;return void l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,n,!1,!1,e.close,2e3)}f.editIndex?s[f.editIndex]=angular.copy(t):s.push(t),s[0]={},4==e.activeFirst?f.planExclGridOptions.data=angular.copy(s):f.exclGridOptions.data=angular.copy(s)}delete f.editIndex},f.addDiagnosisClass=function(t,a){var i;i=2==t.type?f.diagnosisExclGridOptions.data:f.diagnosisInclGridOptions.data;for(var r=1;r<i.length;r++)if(i[r].diagnosisCode==t.diagnosisCode&&!i[r].editGrid){var n=e.alertObjectRes.RcdAldyExt;return void l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,n,!1,!1,e.close,2e3)}f.editDiagIndex?i[f.editDiagIndex]=angular.copy(t):i.push(t),i[0]={type:t.type},delete f.editDiagIndex,2==t.type?f.diagnosisExclGridOptions.data=i:f.diagnosisInclGridOptions.data=i},f.editGridDiagonisList=function(e,t,a){var i;f.editDiagIndex=t,i=2==e.type?f.diagnosisExclGridOptions.data:f.diagnosisInclGridOptions.data;for(var r=1;r<i.length;r++)i[r].editGrid=t==r;i[0]=e(2==e.type)?f.diagnosisExclGridOptions.data=i:f.diagnosisInclGridOptions.data=i},f.deleteDigGrid=function(e,t,a){var i={buttonCallBack1:function(){},buttonCallBack2:function(){1==a?(f.diagnosisInclGridOptions.data.splice(t,1),e.pidsSeqId&&(e.status=2,f.dignosisDeleteInclList.push(e))):2==a&&(f.diagnosisInclGridOptions.data.splice(t,1),e.pidsSeqId&&(e.status=2,f.dignosisDeleteInclList.push(e)))},buttonClose:function(){}};l.hisAlertMulti("warning","Warning","Do You Want To Delete?",{buttonText:"No",buttonText2:"Yes"},i,i)},f.saveCreditPayer=function(){var t=_.concat(f.inclGridOptions.data,f.tariffDeleteInclList),a=[];if(2==f.data.payerCategory)for(var i=[],r=0;r<f.spliceList.length;r++)if(f.plansList.length>0&&f.spliceList[r].PARENT_PLAN_SEQ_ID){if(-1==_.findIndex(f.plansList,function(e){return e.PARENT_PLAN_SEQ_ID==f.spliceList[r].PARENT_PLAN_SEQ_ID})&&f.spliceList[r].PARENT_PLAN_SEQ_ID){-1==_.findIndex(i,function(e){return e==f.spliceList[r].INC_PLAN_SEQ_ID})&&i.push(f.spliceList[r].INC_PLAN_SEQ_ID)}}else if(f.spliceList[r].PARENT_PLAN_SEQ_ID){-1==_.findIndex(i,function(e){return e==f.spliceList[r].INC_PLAN_SEQ_ID})&&i.push(f.spliceList[r].INC_PLAN_SEQ_ID)}if(t.length>1)for(r=1;r<t.length;r++)a.push({"@class":"com.napier.core.service.vo.emrmasters.TariffClassInclList",tariffClsCode:t[r].bedClassCode,tariffName:t[r].bedClassName.DESCRIPTION,tarfiffInclSeqId:t[r].tariffSeqId,facilityId:f.data.facilityId,gnStatus:t[r].status?t[r].status:1,tariffIimSeqId:142,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,isPayerOrPlan:1});var n=_.concat(f.exclGridOptions.data,f.tariffDeleteExclList),s=[];if(n.length>1)for(r=1;r<n.length;r++)s.push({"@class":"com.napier.core.service.vo.emrmasters.TariffClassExclList",tariffClsCode:n[r].bedClassCode,tariffName:n[r].bedClassName.DESCRIPTION,tarfiffExclSeqId:n[r].tariffSeqId,facilityId:f.data.facilityId,gnStatus:n[r].status?n[r].status:1,tariffIemSeqId:142,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,isPayerOrPlan:1});if(f.treeViewDataRemove.length>0&&(f.treeViewData=_.concat(f.treeViewData,f.treeViewDataRemove)),f.treeViewData.length>0){var c=[];for(r=0;r<f.treeViewData.length;r++)if(c.push(f.treeViewData[r]),f.treeViewData[r].departTreeList)for(var d=0;d<f.treeViewData[r].departTreeList.length;d++)if(f.treeViewData[r].departTreeList[d].gnStatus=2==f.treeViewData[r].gnStatus?2:f.treeViewData[r].departTreeList[d].gnStatus,c.push(f.treeViewData[r].departTreeList[d]),f.treeViewData[r].departTreeList[d].specltyTreeList)for(var p=0;p<f.treeViewData[r].departTreeList[d].specltyTreeList.length;p++)if(f.treeViewData[r].departTreeList[d].specltyTreeList[p].gnStatus=2==f.treeViewData[r].departTreeList[d].gnStatus?2:f.treeViewData[r].departTreeList[d].specltyTreeList[p].gnStatus,c.push(f.treeViewData[r].departTreeList[d].specltyTreeList[p]),f.treeViewData[r].departTreeList[d].specltyTreeList[p].srivceTreeList)for(var u=0;u<f.treeViewData[r].departTreeList[d].specltyTreeList[p].srivceTreeList.length;u++)f.treeViewData[r].departTreeList[d].specltyTreeList[p].srivceTreeList[u].gnStatus=2==f.treeViewData[r].departTreeList[d].specltyTreeList[p].gnStatus?2:f.treeViewData[r].departTreeList[d].specltyTreeList[p].srivceTreeList[u].gnStatus,c.push(f.treeViewData[r].departTreeList[d].specltyTreeList[p].srivceTreeList[u]);var m=[];for(r=0;r<c.length;r++)m.push({"@class":"com.napier.core.service.vo.emrmasters.PayerServiceLkVo",serSeqId:c[r].servName?c[r].servName.SERV_SEQ_ID:void 0,dept:c[r].department?c[r].department.CODE:void 0,subDept:c[r].department?c[r].department.CODE:void 0,servName:c[r].servName?c[r].servName.SERV_NAME:void 0,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,payerSerSeqId:c[r].payerSerSeqId?c[r].payerSerSeqId:void 0,gnStatus:c[r].gnStatus?c[r].gnStatus:1,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,payerType:2,psgCode:c[r].primServGroup.CODE,isApprovalRequired:c[r].isRequired,serviceHierarchyLevel:c[r].level,isMaterial:"Y"==c[r].primServGroup.IS_MATERIAL?2:1,deptCode:c[r].department?c[r].department.CODE:void 0,specialityCode:c[r].speciality?c[r].speciality.CODE:void 0,isInclOrExcl:c[r].inclusion,facilityId:f.data.facilityId,insPhilHealthCodesVOList:[{"com.napier.core.service.vo.masters.InsPhilHealthCodesVO":[]}]})}if(f.savedPlansList.length>0&&f.data.plans&&f.data.plans.INC_SEQ_ID)for(let e=0;e<f.savedPlansList.length;e++)if(f.savedPlansList[e].INC_PLAN_ID==f.data.plans.INC_PLAN_ID){f.data.plans=f.savedPlansList[e];break}if(f.data.planName||f.data.plans&&f.data.plans.INC_SEQ_ID){var g=_.concat(f.planInclGridOptions.data,f.planDeleteInclList),S=[];if(g.length>1)for(r=1;r<g.length;r++)S.push({"@class":"com.napier.core.service.vo.emrmasters.TariffClassInclList",tariffClsCode:g[r].bedClassCode,tariffName:g[r].bedClassName.DESCRIPTION,tarfiffInclSeqId:g[r].tariffSeqId,facilityId:f.data.facilityId,gnStatus:g[r].status?g[r].status:1,tariffIimSeqId:142,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,isPayerOrPlan:2});var v=_.concat(f.exclGridOptions.data,f.planDeleteExclList),D=[];if(v.length>1)for(r=1;r<v.length;r++)D.push({"@class":"com.napier.core.service.vo.emrmasters.TariffClassExclList",tariffClsCode:v[r].bedClassCode,tariffName:v[r].bedClassName.DESCRIPTION,tarfiffExclSeqId:v[r].tariffSeqId,facilityId:f.data.facilityId,gnStatus:v[r].status?v[r].status:1,tariffIemSeqId:142,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,isPayerOrPlan:2});if(f.planTreeViewDataRemove.length>0&&(f.planTreeViewData=_.concat(f.planTreeViewData,f.planTreeViewDataRemove)),f.planTreeViewData.length>0){let e=[];var y=[],C=[],A=[],E=[],h=[];for(r=0;r<f.planTreeViewData.length;r++)if(y.push(f.planTreeViewData[r]),f.planTreeViewData[r].departTreeList){for(d=0;d<f.planTreeViewData[r].departTreeList.length;d++)if(f.planTreeViewData[r].departTreeList[d].gnStatus=2==f.planTreeViewData[r].gnStatus?2:f.planTreeViewData[r].departTreeList[d].gnStatus,y.push(f.planTreeViewData[r].departTreeList[d]),f.planTreeViewData[r].departTreeList[d].specltyTreeList)for(p=0;p<f.planTreeViewData[r].departTreeList[d].specltyTreeList.length;p++)if(f.planTreeViewData[r].departTreeList[d].specltyTreeList[p].gnStatus=2==f.planTreeViewData[r].departTreeList[d].gnStatus?2:f.planTreeViewData[r].departTreeList[d].specltyTreeList[p].gnStatus,y.push(f.planTreeViewData[r].departTreeList[d].specltyTreeList[p]),f.planTreeViewData[r].departTreeList[d].specltyTreeList[p].srivceTreeList){for(u=0;u<f.planTreeViewData[r].departTreeList[d].specltyTreeList[p].srivceTreeList.length;u++)f.planTreeViewData[r].departTreeList[d].specltyTreeList[p].srivceTreeList[u].gnStatus=2==f.planTreeViewData[r].departTreeList[d].specltyTreeList[p].gnStatus?2:f.planTreeViewData[r].departTreeList[d].specltyTreeList[p].srivceTreeList[u].gnStatus,y.push(f.planTreeViewData[r].departTreeList[d].specltyTreeList[p].srivceTreeList[u]);break}}else if(f.planTreeViewData[r].specltyTreeList){for(p=0;p<f.planTreeViewData[r].specltyTreeList.length;p++)if(f.planTreeViewData[r].specltyTreeList[p].gnStatus=2==f.planTreeViewData[r].gnStatus?2:f.planTreeViewData[r].specltyTreeList[p].gnStatus,y.push(f.planTreeViewData[r].specltyTreeList[p]),f.planTreeViewData[r].specltyTreeList[p].srivceTreeList){for(u=0;u<f.planTreeViewData[r].specltyTreeList[p].srivceTreeList.length;u++)f.planTreeViewData[r].specltyTreeList[p].srivceTreeList[u].gnStatus=2==f.planTreeViewData[r].specltyTreeList[p].gnStatus?2:f.planTreeViewData[r].specltyTreeList[p].srivceTreeList[u].gnStatus,y.push(f.planTreeViewData[r].specltyTreeList[p].srivceTreeList[u]);break}}else if(f.planTreeViewData[r].srivceTreeList){for(u=0;u<f.planTreeViewData[r].srivceTreeList.length;u++)f.planTreeViewData[r].srivceTreeList[u].gnStatus=2==f.planTreeViewData[r].gnStatus?2:f.planTreeViewData[r].srivceTreeList[u].gnStatus,y.push(f.planTreeViewData[r].srivceTreeList[u]);break}for(r=0;r<f.tempPlanServiceData.length;r++)if(e.push(f.tempPlanServiceData[r]),f.tempPlanServiceData[r].departTreeList)for(d=0;d<f.tempPlanServiceData[r].departTreeList.length;d++)if(e.push(f.tempPlanServiceData[r].departTreeList[d]),f.tempPlanServiceData[r].departTreeList[d].specltyTreeList)for(p=0;p<f.tempPlanServiceData[r].departTreeList[d].specltyTreeList.length;p++)if(e.push(f.tempPlanServiceData[r].departTreeList[d].specltyTreeList[p]),f.tempPlanServiceData[r].departTreeList[d].specltyTreeList[p].srivceTreeList){e=_.concat(e,f.tempPlanServiceData[r].departTreeList[d].specltyTreeList[p].srivceTreeList);break}let t=[];for(let a=0;a<y.length;a++)for(let i=0;i<e.length;i++)if(y[a].level===e[i].level&&y[a].cisSeqId===e[i].cisSeqId&&y[a].inclusion!==e[i].inclusion){let r=angular.copy(y[i]);r.gnStatus=2,r.inclusion=e[a].inclusion,t.push(r)}t.length>0&&(y=_.concat(y,t));for(r=0;r<y.length;r++){let e={"@class":2==y[r].inclusion?"Y"==y[r].primServGroup.IS_MATERIAL?"com.napier.core.service.vo.emrmasters.MaterialExclList":"com.napier.core.service.vo.emrmasters.ServiceEclList":"Y"==y[r].primServGroup.IS_MATERIAL?"com.napier.core.service.vo.emrmasters.MaterialInclList":"com.napier.core.service.vo.emrmasters.ServiceInclList",exclServSeqId:"Y"!=y[r].primServGroup.IS_MATERIAL&&2==y[r].inclusion&&y[r].servName?y[r].servName.SERV_SEQ_ID:void 0,inclServSeqId:"Y"!=y[r].primServGroup.IS_MATERIAL&&1==y[r].inclusion&&y[r].servName?y[r].servName.SERV_SEQ_ID:void 0,iisSeqId:1==y[r].inclusion&&"Y"!=y[r].primServGroup.IS_MATERIAL&&y[r].cisSeqId?y[r].cisSeqId:void 0,iesSeqID:2==y[r].inclusion&&"Y"!=y[r].primServGroup.IS_MATERIAL&&y[r].cisSeqId?y[r].cisSeqId:void 0,iimSeqId:1==y[r].inclusion&&"Y"==y[r].primServGroup.IS_MATERIAL&&y[r].cisSeqId?y[r].cisSeqId:void 0,iemSeqId:2==y[r].inclusion&&"Y"==y[r].primServGroup.IS_MATERIAL&&y[r].cisSeqId?y[r].cisSeqId:void 0,aliasCode:"Y"!=y[r].primServGroup.IS_MATERIAL?"":void 0,aliasName:"Y"!=y[r].primServGroup.IS_MATERIAL?"":void 0,facilityId:f.data.facilityId,gnStatus:y[r].gnStatus?y[r].gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,psgCode:"Y"!=y[r].primServGroup.IS_MATERIAL?y[r].primServGroup.CODE:void 0,approvalRequired:y[r].isRequired,serviceHierarchyLevel:"Y"!=y[r].primServGroup.IS_MATERIAL?y[r].level:void 0,subDeptId:"Y"!=y[r].primServGroup.IS_MATERIAL&&1==y[r].inclusion&&y[r].department?y[r].department.CODE:void 0,subDeptCode:"Y"!=y[r].primServGroup.IS_MATERIAL&&2==y[r].inclusion&&y[r].department?y[r].department.CODE:void 0,deptCode:"Y"!=y[r].primServGroup.IS_MATERIAL&&y[r].department?y[r].department.CODE:void 0,specialityCode:"Y"!=y[r].primServGroup.IS_MATERIAL&&y[r].speciality?y[r].speciality.CODE:void 0,applicabilityType:y[r].applicability,isAmtNlPerc:1==y[r].inclusion?y[r].apprIsAmtPercNl:void 0,inclAmount:"N"==y[r].primServGroup.IS_MATERIAL&&1==y[r].inclusion?y[r].approvedAmount:void 0,qty:1==y[r].inclusion?y[r].approvedQty:void 0,mtrAmount:"Y"==y[r].primServGroup.IS_MATERIAL&&1==y[r].inclusion?y[r].approvedAmount:void 0,mtrSubGrpseqId:"Y"==y[r].primServGroup.IS_MATERIAL&&y[r].speciality?y[r].speciality.CODE:void 0,mtrGrpsedId:"Y"==y[r].primServGroup.IS_MATERIAL&&y[r].department?y[r].department.CODE:void 0,attrType:"Y"==y[r].primServGroup.IS_MATERIAL?y[r].primServGroup.CODE:void 0,mtrlCode:"Y"==y[r].primServGroup.IS_MATERIAL&&y[r].servName?y[r].servName.SERV_SEQ_ID:void 0,mtrlHierarchyLevel:"Y"==y[r].primServGroup.IS_MATERIAL?y[r].level:void 0,insurancePayerInclMatBedClassLinkVoList:[{"com.napier.core.service.vo.emrmasters.InsurancePayerInclMatBedClassLinkVo":f.getBedClassListPrepare(y[r],y[r].gnStatus)}]};2==y[r].inclusion?"Y"==y[r].primServGroup.IS_MATERIAL?h.push(e):C.push(e):"Y"==y[r].primServGroup.IS_MATERIAL?E.push(e):A.push(e)}}if(f.copyData.length>0)var b=f.copyData;else b=[];if(f.opCoPayGridOptions.data.length>1){let e=angular.copy(f.opCoPayGridOptions.data);e.splice(0,1),b=_.concat(b,e)}if(f.ipCoPayGridOptions.data.length>1){let e=angular.copy(f.ipCoPayGridOptions.data);e.splice(0,1),b=_.concat(b,e)}if(f.opCoInsuranceGridOptions.data.length>1){let e=angular.copy(f.opCoInsuranceGridOptions.data);e.splice(0,1),b=_.concat(b,e)}if(f.ipCoInsuranceGridOptions.data.length>1){let e=angular.copy(f.ipCoInsuranceGridOptions.data);e.splice(0,1),b=_.concat(b,e)}var T=[];for(r=0;r<b.length;r++){var L={copaySeqId:b[r].copaySeqId?b[r].copaySeqId:void 0,department:b[r].department?b[r].department.CODE:void 0,primayServiceGroup:b[r].primayServiceGroup?b[r].primayServiceGroup.CODE:void 0,service:b[r].service?b[r].service.SERV_SEQ_ID:b[r].servName?b[r].servName.SERV_SEQ_ID:void 0,speciality:b[r].speciality?b[r].speciality.CODE:void 0,copayType:2,facilityId:f.data.facilityId,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnStatus:b[r].status?b[r].status:1,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,isMaterial:b[r].primayServiceGroup&&"Y"==b[r].primayServiceGroup.IS_MATERIAL?2:1,serHierarchyLevel:b[r].serviceHierarcyLevel,createdOn:new Date,editedBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,editedOn:new Date,patType:2==b[r].type||6==b[r].type?1:2,isCopayOrCoinsurance:b[r].copayment?1:2,isPercOrAmount:2,copayment:b[r].copayment?b[r].copayment:b[r].coInsurance};T.push(L)}if(f.diagnosisInclGridOptions.data.length>1)(P=angular.copy(f.diagnosisInclGridOptions.data)).splice(0,1);else var P=[];if(f.diagnosisExclGridOptions.data.length>1)(O=angular.copy(f.diagnosisExclGridOptions.data)).splice(0,1);else var O=[];if(P.length>0||O.length>0||f.dignosisDeleteInclList.length>0)var R=_.concat(P,O,f.dignosisDeleteInclList);else R=[];var N=[];for(r=0;r<R.length;r++)N.push({"@class":"com.napier.core.service.vo.emrmasters.InsurancePlanInclDiagnosisLinkVo",pidsSeqId:R[r].pidsSeqId,diagCode:R[r].diagnosisCode,diagName:R[r].diagnosisName.DESCRIPTION,isInclOrExcl:R[r].type,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,createdOn:new Date,editedBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,editedOn:new Date,facilityId:f.data.facilityId,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnStatus:R[r].status?R[r].status:1,lastUpdatedOn:new Date});if(f.defaultAuthGridOptions.data.length>1){var w=angular.copy(f.defaultAuthGridOptions.data);w.splice(0,1),f.defaultData=_.concat(f.defaultData,w)}var F=[];for(r=0;r<f.defaultData.length;r++)F.push({pdpaSeqId:f.defaultData[r].pdpaSeqId,duration:f.defaultData[r].duration,durationType:f.defaultData[r].durationType,psgCode:f.defaultData[r].primayServiceGroup.CODE,seplCode:f.defaultData[r].speciality?f.defaultData[r].speciality.CODE:void 0,deptCode:f.defaultData[r].department?f.defaultData[r].department.CODE:void 0,servSeqId:f.defaultData[r].service?f.defaultData[r].service.SERV_SEQ_ID:f.defaultData[r].servName?f.defaultData[r].servName.SERV_SEQ_ID:void 0,serviceHierarchyLevel:f.defaultData[r].serviceHierarcyLevel,isMaterial:"Y"==f.defaultData[r].primayServiceGroup.IS_MATERIAL?2:1,applicabilityType:1,serInclType:f.defaultData[r].apprIsAmtPercNl?f.defaultData[r].apprIsAmtPercNl:1,qty:f.defaultData[r].quantity,amount:f.defaultData[r].approvedAmount,gnStatus:f.defaultData[r].status?f.defaultData[r].status:1,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,createdOn:new Date,editedBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,editedOn:new Date,facilityId:f.data.facilityId,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,lastUpdatedOn:new Date});var M=[];if(f.discountGridOptions.data.length>1){let e=angular.copy(f.discountGridOptions.data);e.splice(0,1);var G=_.concat(f.discountData,e)}else if(f.discountData.length>0)G=f.discountData;else G=[];for(r=0;r<G.length;r++)M.push({discSeqId:G[r].discSeqId?G[r].discSeqId:void 0,discountType:1,discountValue:G[r].discount,priServSeqId:G[r].primayServiceGroup.CODE,deptCode:G[r].department?G[r].department.CODE:void 0,seplCode:G[r].speciality?G[r].speciality.CODE:void 0,servSeqId:G[r].service?G[r].service.SERV_SEQ_ID:G[r].servName?G[r].servName.SERV_SEQ_ID:void 0,serviceHierarchyLevel:G[r].serviceHierarcyLevel,isMaterial:"Y"==G[r].primayServiceGroup.IS_MATERIAL?2:1,gnStatus:G[r].status?G[r].status:1,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,createdOn:new Date,editedBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,editedOn:new Date,facilityId:f.data.facilityId});A=f.hierarchyLevelAddYFlag(A),E=f.matHierarchyLevelAddYFlag(E);var x=[{inPlanCode:_.isObjectLike(f.data.plans)?f.data.plans.INC_PLAN_ID:f.data.planCode,inPlanId:_.isObjectLike(f.data.plans)?f.data.plans.INC_PLAN_ID:f.data.planCode,inPlanName:_.isObjectLike(f.data.plans)?f.data.plans.INC_PLAN_NAME:f.data.planName,incPlanSeqId:_.isObjectLike(f.data.plans)?f.data.plans.INC_PLAN_SEQ_ID:void 0,inTypAgrement:1,inPlanBenf:1,incStatus:"1",practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilityId:f.data.facilityId,tarrifSeqId:f.data.tariff,effectiveFrom:f.data.planFromDate,parentPlanSeqId:2==f.data.payerCategory?f.data.plans.PARENT_PLAN_SEQ_ID?f.data.plans.PARENT_PLAN_SEQ_ID:f.data.plans.INC_PLAN_SEQ_ID:void 0,effectiveTo:f.data.planToDate,payerType:"002",attributesList:{"@class":"com.napier.core.service.vo.emrmasters.AttributesList",attSeqId:f.data.plans?f.data.plans.ATT_SEQ_ID:void 0,isPreAuthBillOrServiceLevel:f.data.planDetails.defaultAuth,defaultAuthValue:1==f.data.planDetails.defaultAuth?f.data.planDetails.defaultAuthValue:void 0,preAuthDuration:1==f.data.planDetails.defaultAuth?f.data.planDetails.duration:void 0,preAuthDurationType:1==f.data.planDetails.defaultAuth?null==f.data.planDetails||null==f.data.planDetails.durationType||null==f.data.planDetails.durationType||""===f.data.planDetails.durationType||f.data.planDetails.durationType instanceof Object?void 0:f.data.planDetails.durationType:void 0,isBedClassInclOrExcl:f.planInclGridOptions.data.length>1?1:2,billLevelDiscount:f.data.planDetails.discountLevel,discountPercent:1==f.data.planDetails.discountLevel?f.data.planDetails.discountValue:void 0,copay:f.data.planDetails.opCopayLevel,patientCopayPercentage:1==f.data.planDetails.opCopayLevel&&null!=f.data.planDetails.opCopayValue&&null!=f.data.planDetails.opCopayValue&&""!==f.data.planDetails.opCopayValue?parseFloat(f.data.planDetails.opCopayValue):void 0,copayIp:f.data.planDetails.ipCopayLevel,copayPercentageIp:1==f.data.planDetails.ipCopayLevel&&null!=f.data.planDetails.ipCopayValue&&null!=f.data.planDetails.ipCopayValue&&""!==f.data.planDetails.ipCopayValue?parseFloat(f.data.planDetails.ipCopayValue):void 0,isCoinsuranceBillOrServiceLevelOp:f.data.planDetails.coInsuranceOp,coinsuranceValueOp:1==f.data.planDetails.coInsuranceOp&&null!=f.data.planDetails.coInsuranceOpValue&&null!=f.data.planDetails.coInsuranceOpValue&&""!==f.data.planDetails.coInsuranceOpValue?parseFloat(f.data.planDetails.coInsuranceOpValue):void 0,isCoinsuranceBillOrServiceLevelIp:f.data.planDetails.coInsuranceIp,coinsuranceValueIp:1==f.data.planDetails.coInsuranceIp&&null!=f.data.planDetails.coInsuranceIpValue&&null!=f.data.planDetails.coInsuranceIpValue&&""!==f.data.planDetails.coInsuranceIpValue?parseFloat(f.data.planDetails.coInsuranceIpValue):void 0,deductableAmt:null!=f.data.planDetails.opDeductable&&null!=f.data.planDetails.opDeductable&&""!==f.data.planDetails.opDeductable?parseFloat(f.data.planDetails.opDeductable):void 0,ipDeductableAmount:null!=f.data.planDetails.ipDeductable&&null!=f.data.planDetails.ipDeductable&&""!==f.data.planDetails.ipDeductable?parseFloat(f.data.planDetails.ipDeductable):void 0,opMaxOutOfPocket:null!=f.data.planDetails.opMaxCopay&&null!=f.data.planDetails.opMaxCopay&&""!==f.data.planDetails.opMaxCopay?parseFloat(f.data.planDetails.opMaxCopay):void 0,ipMaxOutOfPocket:null!=f.data.planDetails.ipMaxCopay&&null!=f.data.planDetails.ipMaxCopay&&""!==f.data.planDetails.ipMaxCopay?parseFloat(f.data.planDetails.ipMaxCopay):void 0,facilityId:f.data.facilityId,gnStatus:"1",practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION},serviceEclList:[{"com.napier.core.service.vo.emrmasters.ServiceEclList":C}],serviceInclList:[{"com.napier.core.service.vo.emrmasters.ServiceInclList":A}],materialInclList:[{"com.napier.core.service.vo.emrmasters.MaterialInclList":E}],tariffClassInclList:[{"com.napier.core.service.vo.emrmasters.TariffClassInclList":S}],materialExclList:[{"com.napier.core.service.vo.emrmasters.MaterialExclList":h}],tariffClassExclList:[{"com.napier.core.service.vo.emrmasters.TariffClassExclList":D}],copaymentServiceLevel:[{"com.napier.core.service.vo.emrmasters.CopaymentServiceLevel":T}],insurancePlanInclDiagnosisLinkListVo:[{"com.napier.core.service.vo.emrmasters.InsurancePlanInclDiagnosisLinkVo":N}],insurancePalnPreAuthLinkVo:[{"com.napier.core.service.vo.emrmasters.InsurancePalnPreAuthLinkVo":F}],insurancePlanDiscountLinkVoList:[{"com.napier.core.service.vo.emrmasters.InsurancePlanDiscountLinkVo":M}]}]}else x=[];var q={"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,incSeqId:f.data.payerName.INC_SEQ_ID?f.data.payerName.INC_SEQ_ID:void 0,inCompName:f.data.payerName.INC_SEQ_ID?f.data.payerName.INC_COMP_NAME:f.data.payerName,taxType:f.data.taxType?f.data.taxType.TAX_CODE:void 0,payerTaxId:f.data.taxType?f.data.taxType.TAX_CODE:void 0,payerType:"002",inCompId:f.data.payerCode,inContactPerson:f.data.contactPerson,planLists:2==f.data.payerCategory&&i.length>0&&f.data.payerName.INC_SEQ_ID?_.toString(i):void 0,remarks:f.data.remarks,creditLimit:f.data.creditLimit,payerCategory:parseInt(f.data.payerCategory),isInsurnace:f.data.payerTypeInsurer,insuranceType:1==f.data.payerTypeInsurer&&1===f.data.insurance&&f.data.payerName.INC_SEQ_ID?f.data.payerName.INC_SEQ_ID:1===f.data.insurance?void 0:f.data.insurance,isTpa:f.data.payerTypeTpa,tpaType:1===f.data.payerTypeTpa&&1===f.data.tpa&&f.data.payerName.INC_SEQ_ID?f.data.payerName.INC_SEQ_ID:1===f.data.tpa?void 0:f.data.tpa,others:f.data.payerTypeOther,othersType:1==f.data.payerTypeOther&&f.data.other?f.data.other:void 0,tariffCatgCode:f.data.tariff,facilityId:f.data.facilityId,parentIncSeqId:2==f.data.payerCategory&&f.data.parentPayer?f.data.parentPayer.INC_SEQ_ID:void 0,billTo:2==f.data.payerCategory?f.data.billingTo.INC_SEQ_ID:void 0,billToAddress:2==f.data.payerCategory?f.data.childAdress:void 0,claimTo:2==f.data.payerCategory?f.data.claimAutherization.INC_SEQ_ID:void 0,claimToAddress:2==f.data.payerCategory?f.data.childAdressClaim:void 0,isBedClassInclOrExcl:f.inclGridOptions.data.length>1?1:f.exclGridOptions.data.length>1?2:void 0,effectiveFromDate:moment(f.data.fromDate).format("YYYY-MM-DD 00:00:00.258"),effectiveToDate:moment(f.data.toDate).format("YYYY-MM-DD 23:59:59.258"),addressList1:{"@class":"com.napier.core.service.vo.emrmasters.AddressMasterGenericVo",emailId:f.data.email,mobileNo:f.data.contactNumber,faxNo:f.data.faxNumber,address1:f.data.address,resPhone1:f.data.alternateContactNumber},patientAddress:[{"com.napier.core.service.vo.emrmasters.AddressMasterGenericVo":[{parentType:"008",address1:f.data.address,address2:f.patDetails.addressline2,emailId:f.data.email,facilityId:f.data.facilityId,mobileNo:f.data.contactNumber,pinOrZip:f.patDetails.zipcode,levelMappingVoList:[{"com.napier.core.service.vo.emrmasters.LevelMappingVo":[{level:1,levelDescription:null!=f.patDetails.country?f.patDetails.country.addrDescription:"",levelValue:null!=f.patDetails.country?f.patDetails.country.addrCode:void 0},{level:2,levelDescription:null!=f.patDetails.state?f.patDetails.state.addrDescription:"",levelValue:null!=f.patDetails.state?f.patDetails.state.addrCode:void 0},{level:3},{level:4,levelDescription:null!=f.patDetails.city?f.patDetails.city.addrDescription:"",levelValue:null!=f.patDetails.city?f.patDetails.city.addrCode:void 0},{level:5,levelDescription:f.data.alternateContactNumber,levelValue:f.data.alternateContactNumber},{level:6},{level:7,levelDescription:f.data.contactNumber,levelValue:f.data.contactNumber},{level:8},{level:9,levelDescription:f.data.email,levelValue:f.data.email},{level:10}]}]}]}],payerServiceLkVo:[{"com.napier.core.service.vo.emrmasters.PayerServiceLkVo":m}],payerFacilityLkVo:[{"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo":[{"@class":"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo",createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,gnStatus:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilityId:f.data.facilityId,payerFacSedId:f.data.payerFactSeqId}]}],machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,status:f.data.status,tariffClassInclList:[{"com.napier.core.service.vo.emrmasters.TariffClassInclList":a}],tariffClassExclList:[{"com.napier.core.service.vo.emrmasters.TariffClassExclList":s}],insurancePlanMasterList:[{"com.napier.core.service.vo.emrmasters.InsurancePlanMaster":x}]};o.payerSaveService(q).then(function(t){if(t.data.HITService.message)t.data.HITService.message&&t.data.HITService.message.errorCode?l.failure("Failure",t.data.HITService.message.errorMessage):t.data.HITService.message&&t.data.HITService.message.incSeqId&&(l.hisAlertMulti("success",e.alertObjectRes.alertTypeSucss,a,!1,!1,e.close,2e3),f.data.planName?(f.data.payerName.INC_SEQ_ID?(f.getPlansList(),f.updatePayerDetails()):(f.treeViewData=[],f.payerAutoSearch(f.data.payerName).then(function(){f.data.payerName=f.payerList[0],f.getPlansList(),f.updatePayerDetails()})),f.updateSeqId=t.data.HITService.message.insurancePlanMasterList[0]["com.napier.core.service.vo.emrmasters.InsurancePlanMaster"].incSeqId.planSeqId,f.data.planName="",f.data.planCode="",e.showCreatePlan=!1):I());else{var a=e.alertObjectRes.SmtngWntWrg;l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,a,!1,!1,e.close,2e3)}})},f.editGridList=function(t,a,i){if(f.editIndex=a,1==i){if(4==e.activeFirst)var r=angular.copy(f.planInclGridOptions.data);else r=angular.copy(f.inclGridOptions.data);for(var n=1;n<r.length;n++)r[n].editGrid=a==n;r[0]=t,4==e.activeFirst?f.planInclGridOptions.data=angular.copy(r):f.inclGridOptions.data=angular.copy(r)}else if(2==i){if(4==e.activeFirst)var l=angular.copy(f.planExclGridOptions.data);else l=angular.copy(f.exclGridOptions.data);for(n=1;n<l.length;n++)l[n].editGrid=a==n;l[0]=t,4==e.activeFirst?f.planExclGridOptions.data=angular.copy(l):f.exclGridOptions.data=angular.copy(l)}},f.deleteGrid=function(t,a,i){var r={buttonCallBack1:function(){},buttonCallBack2:function(){4!=e.activeFirst?(1==i?(f.inclGridOptions.data.splice(a,1),t.tariffSeqId&&(t.status=2,f.tariffDeleteInclList.push(t))):2==i&&(f.exclGridOptions.data.splice(a,1),t.tariffSeqId&&(t.status=2,f.tariffDeleteExclList.push(t))),t.tariffSeqId&&o.deleteBedClass({bedClassSeqId:t.tariffSeqId,bedClassType:f.data.bedClassInclusion}).then(function(e){})):1==i?(f.planInclGridOptions.data.splice(a,1),t.tariffSeqId&&(t.status=2,f.planDeleteInclList.push(t)),f.addRmovColumnCoverGrid(t,!0)):2==i&&(f.planExclGridOptions.data.splice(a,1),t.tariffSeqId&&(t.status=2,f.planDeleteExclList.push(t)))},buttonClose:function(){}};l.hisAlertMulti("warning","Warning","Do You Want To Delete?",{buttonText:"No",buttonText2:"Yes"},r,r)},f.addRecord=function(t){if(t.level||(t.level=1),4==e.activeFirst){var a=angular.copy(f.planServicesGridOptions.data);if(3!=t.apprIsAmtPercNl)for(var i=0;i<a.length;i++)for(let e=1;f.planInclGridOptions.data.length>e;e++){let t=f.planInclGridOptions.data[e].bedClassName.CODE;if(1==a[i].inclusion&&3!=a[i].apprIsAmtPercNl&&(""==a[i][t]||null==a[i][t]))return l.information("Information","Please Enter Bed Class Amount"),!1}}else a=angular.copy(f.servicesGridOptions.data);for(i=1;i<a.length;i++)if(1==t.level){if(a[i].primServGroup.CODE==t.primServGroup.CODE){var r=e.alertObjectRes.RcdAldyExt;return void l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,r,!1,!1,e.close,2e3)}}else if(2==t.level){if(a[i].department.CODE==t.department.CODE){r=e.alertObjectRes.RcdAldyExt;return void l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,r,!1,!1,e.close,2e3)}}else if(3==t.level){if(a[i].speciality.CODE==t.speciality.CODE){r=e.alertObjectRes.RcdAldyExt;return void l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,r,!1,!1,e.close,2e3)}}else if(4==t.level&&a[i].servName.SERV_SEQ_ID==t.servName.SERV_SEQ_ID){r=e.alertObjectRes.RcdAldyExt;return void l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,r,!1,!1,e.close,2e3)}4==e.activeFirst?t.inclusion=parseInt(f.packageCoverTypePlan):t.inclusion=parseInt(f.packageCoverType),a.push(angular.copy(t)),a[0]={primServGroup:1!=t.level&&null!=t.primServGroup&&null!=t.primServGroup&&""!==t.primServGroup?(t.primServGroup.CODE,t.primServGroup):void 0,department:2!=t.level&&null!=t.department&&null!=t.department&&""!==t.department?(t.department.CODE,t.department):void 0,speciality:3!=t.level&&null!=t.speciality&&null!=t.speciality&&""!==t.speciality?(t.speciality.CODE,t.speciality):void 0,level:t.level?t.level:1,isRequired:1,inclusion:4==e.activeFirst?parseInt(f.packageCoverTypePlan):parseInt(f.packageCoverType),applicability:1,apprIsAmtPercNl:1},4==e.activeFirst?f.planServicesGridOptions.data=angular.copy(a):f.servicesGridOptions.data=angular.copy(a)},f.getBedClassListPrepare=function(e,t,a){let i=[];for(let a=1;a<f.planInclGridOptions.data.length;a++){var r=f.planInclGridOptions.data[a];i.push({"@class":"com.napier.core.service.vo.emrmasters.InsurancePayerInclMatBedClassLinkVo",bcSeqId:r.bedClassName.CODE,sbclSeqId:"Y"==e.primServGroup.IS_MATERIAL?void 0:e["sbclSeqId"+f.planInclGridOptions.data[a].bedClassCode]?e["sbclSeqId"+f.planInclGridOptions.data[a].bedClassCode]:void 0,mbclSeqId:"Y"==e.primServGroup.IS_MATERIAL&&e["sbclSeqId"+f.planInclGridOptions.data[a].bedClassCode]?e["sbclSeqId"+f.planInclGridOptions.data[a].bedClassCode]:void 0,qty:e.approvedQty,amount:e[r.bedClassName.CODE]&&3!=parseInt(e.amtNlPer)?parseFloat(e[r.bedClassName.CODE+""]):void 0,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,mtrlInclType:e.inclusion,gnStatus:t||1,facilityId:f.data.facilityId,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,createdOn:new Date}),e.materialFlag&&(i.materialSeqId=e.srchObj.SERV_SEQ_ID)}return i},f.addToTreeView=function(){if(4==e.activeFirst)for(var t=angular.copy(f.planTreeViewData),a=f.planHeaderData,i=angular.copy(f.planServicesGridOptions.data),r=1;r<i.length;r++){if(2!=i[r].inclusion&&(!i[r].applicability||3!=i[r].apprIsAmtPercNl&&!i[r].approvedAmount||!i[r].apprIsAmtPercNl||3!=i[r].apprIsAmtPercNl&&!i[r].approvedQty))return void l.information("Information","Please Enter Mandatory Fields");if(2!=i[r].inclusion&&3!=i[r].apprIsAmtPercNl)for(let e=1;f.planInclGridOptions.data.length>e;e++){let t=f.planInclGridOptions.data[e].bedClassName.CODE;if(""==i[r][t]||null==i[r][t])return l.information("Information","Please Enter Bed Class Amount"),!1}}else t=angular.copy(f.treeViewData),i=angular.copy(f.servicesGridOptions.data),a=f.headerData;if(t.length>0){for(r=0;r<t.length;r++){if(!a.level||1==a.level){let e=!1;for(var n=1;n<i.length;n++)if(t[r].primServGroup.CODE==i[n].primServGroup.CODE)Object.keys(i[n]).forEach(function(e,a){"departTreeList"!==i[n][e]&&i[n][e]&&(t[r][e]=i[n][e])});else{-1==_.findIndex(t,function(e){return e.primServGroup.CODE==i[n].primServGroup.CODE})&&(t.push(i[n]),e=!0)}if(e)break}if(2==a.level&&t[r].primServGroup.CODE==(i[1]&&i[1].primServGroup.CODE)){let e=angular.copy(i);e.splice(0,1),t[r].departTreeList=angular.copy(e)}if(3==a.level&&t[r].primServGroup.CODE==(i[1]&&i[1].primServGroup.CODE)){let e=angular.copy(i);e.splice(0,1);for(n=0;n<t[r].departTreeList.length;n++)t[r].departTreeList[n].department.CODE==i[1].department.CODE&&(t[r].departTreeList[n].specltyTreeList=angular.copy(e))}if(4==a.level&&t[r].primServGroup.CODE==(i[1]&&i[1].primServGroup.CODE)){let e=angular.copy(i);e.splice(0,1);for(n=0;n<t[r].departTreeList.length;n++)if(t[r].departTreeList[n].department.CODE==i[1].department.CODE)for(var s=0;s<t[r].departTreeList[n].specltyTreeList.length;s++)t[r].departTreeList[n].specltyTreeList[s].speciality.CODE==i[1].speciality.CODE&&(t[r].departTreeList[n].specltyTreeList[s].srivceTreeList=angular.copy(e))}}(i=[])[0]=angular.copy({primServGroup:4==a.level?a.primServGroup:f.primaryServiceList[0],department:4==a.level?a.department:void 0,speciality:4==a.level?a.speciality:void 0,level:1,isRequired:1,inclusion:1})}else{let e=i;e.splice(0,1),t=e,(i=[])[0]={primServGroup:4==a.level?f.primaryServiceList[0]:a.primServGroup,department:4==a.level?a.department:void 0,speciality:4==a.level?a.speciality:void 0,level:1,isRequired:1,inclusion:1}}4==e.activeFirst?(f.planTreeViewData=angular.copy(t),f.planHeaderData=a,f.planServicesGridOptions.data=angular.copy(i)):(f.treeViewData=angular.copy(t),f.servicesGridOptions.data=angular.copy(i),f.headerData=a)},f.addActiveToggle=function(e){angular.element(e.currentTarget).toggleClass("caret-down"),angular.element(angular.element(e.currentTarget).parent().children()[2]).toggleClass("active")},f.addPriServiceGrup=function(){if(!f.disableFieldsForTPA){if(4==e.activeFirst){var t=angular.copy(f.planTreeViewData),a=f.planHeaderData,i=angular.copy(f.planServicesGridOptions);null!=t[0]&&(f.packageCoverTypePlan=t[0].inclusion+"")}else{t=angular.copy(f.treeViewData),i=angular.copy(f.servicesGridOptions),a=f.headerData;null!=t[0]&&(f.packageCoverType=t[0].inclusion+"")}if(i.columnDefs[0].visible=!0,i.columnDefs[1].visible=!1,i.columnDefs[2].visible=!1,i.columnDefs[3].visible=!1,i.columnDefs[4].visible=!1,i.data=[],i.data[0]={primServGroup:f.primaryServiceList[0],level:1,isRequired:1,inclusion:4==e.activeFirst?parseInt(f.packageCoverTypePlan):parseInt(f.packageCoverType)},i.data=_.concat(i.data,t),a.level=1,4==e.activeFirst){f.planTreeViewData=angular.copy(t),f.planHeaderData=a,f.planServicesGridOptions=angular.copy(i);for(var r=1;r<f.planServicesGridOptions.data.length;r++)f.planServicesGridOptions.data[r].applicability=f.planServicesGridOptions.data[r].applicability?_.find(f.applicabilityList,function(e){return e.DT_CODE==f.planServicesGridOptions.data[r].applicability}).DT_CODE:void 0}else f.treeViewData=angular.copy(t),f.servicesGridOptions=angular.copy(i),f.headerData=a}},f.addDepartment=function(t,a){if(!f.disableFieldsForTPA){if(4==e.activeFirst){var i=angular.copy(f.planTreeViewData),r=f.planHeaderData,n=angular.copy(f.planServicesGridOptions);null!=i[0]&&(f.packageCoverTypePlan=f.setInclusioValue(t))}else{i=angular.copy(f.treeViewData),n=angular.copy(f.servicesGridOptions),r=f.headerData;null!=i[0]&&(f.packageCoverType=f.setInclusioValue(t))}n.columnDefs[0].visible=!1,n.columnDefs[1].visible=!0,n.columnDefs[2].visible=!1,n.columnDefs[3].visible=!1,n.columnDefs[4].visible=!1,"Y"==t.primServGroup.IS_MATERIAL?n.columnDefs[1].displayName="billing.material.group":n.columnDefs[1].displayName="billing.department",n.data=[],n.data[0]=angular.copy({primServGroup:t.primServGroup,level:2,isRequired:1,inclusion:4==e.activeFirst?parseInt(f.packageCoverTypePlan):parseInt(f.packageCoverType)}),t.departTreeList&&(n.data=angular.copy(_.concat(n.data,t.departTreeList))),f.changePrimaryServGroup(t),(r=angular.copy(t)).level=2,4==e.activeFirst?(f.planTreeViewData=angular.copy(i),f.planHeaderData=r,f.planServicesGridOptions=angular.copy(n)):(f.treeViewData=angular.copy(i),f.servicesGridOptions=angular.copy(n),f.headerData=r)}},f.addSpecialty=function(t,a,i,r){if(!f.disableFieldsForTPA){if(4==e.activeFirst){var n=angular.copy(f.planTreeViewData),l=f.planHeaderData,s=angular.copy(f.planServicesGridOptions);null!=n[0]&&(f.packageCoverTypePlan=f.setInclusioValue(t))}else{n=angular.copy(f.treeViewData),s=angular.copy(f.servicesGridOptions),l=f.headerData;null!=n[0]&&(f.packageCoverType=f.setInclusioValue(t))}s.columnDefs[0].visible=!1,s.columnDefs[1].visible=!1,s.columnDefs[2].visible=!0,s.columnDefs[3].visible=!1,s.columnDefs[4].visible=!1,"Y"==t.primServGroup.IS_MATERIAL?s.columnDefs[2].displayName="billing.material.subgroup":s.columnDefs[2].displayName="billing.speciality",s.data=[],s.data[0]=angular.copy({primServGroup:t.primServGroup,department:t.department,level:3,isRequired:1,inclusion:4==e.activeFirst?parseInt(f.packageCoverTypePlan):parseInt(f.packageCoverType)}),null!=t.specltyTreeList&&t.specltyTreeList.length>0&&(s.data=angular.copy(_.concat(s.data,t.specltyTreeList))),f.OnChangeDept(t),(l=angular.copy(t)).level=3,4==e.activeFirst?(f.planTreeViewData=angular.copy(n),f.planHeaderData=l,f.planServicesGridOptions=angular.copy(s)):(f.treeViewData=angular.copy(n),f.servicesGridOptions=angular.copy(s),f.headerData=l)}},f.getNOKArea_Location=function(e){f.patDetails.NOKAreaCode&&(f.patDetails.NOKAreaCode="",f.patDetails.NOKlocationMaster2=!1);let t=[];f.getDetails3={1:t};let a=e+" (Add New)";t.push({AREA_DESC:a});let i=u.executeQueryURLReset();return f.aList=new Array,u.prepareParamListWithParam("pAreaDesc",e+"%",f.aList),u.executeQueryInput("ADDRES2_DTLS_LOC_MASTER",f.aList,f.getDetails3,!0,!0,i,"popUp",{}).then(function(e){for(let e=0;e<t.length;e++)t[e].loc_name=t[e].AREA_DESC,t[e].CITY_DESC&&(t[e].loc_name=t[e].AREA_DESC+","+t[e].CITY_DESC);f.locationList=angular.copy(t)}),f.locationList},f.Defaultlocation=function(){null==f.patDetails.addressline2||""==f.patDetails.addressline2?(f.data.address2Flag=!1,f.patDetails.locationMaster2=!1,f.getDefaultOptionsSelf(),f.checkInvalidMasterAddressData=!0):0!=f.data.address2Flag&&(f.data.address2Flag=!0)},f.getDefaultOptionsSelf=function(e){f.getDefaultOptions().then(function(t){try{if(null!=t[1][0].ADDR_LEVEL4)for(let e=0;e<f.CitiesListCombo.length;e++)f.CitiesListCombo[e].addrDescription==t[1][0].ADDR_LEVEL4&&(f.patDetails.city=f.CitiesListCombo[e],f.getStateByCity(f.patDetails.city));else null!=t[1][0].ADDR_LEVEL1&&(f.patDetails.country=f.CountryListCombo[_.findKey(f.CountryListCombo,{addrDescription:t[1][0].ADDR_LEVEL1})],f.getPhoneByCountry(f.patDetails.country,e));for(let e=0;e<f.NationalityCombo.length;e++)f.NationalityCombo[e].description==t[1][0].NATIONALITY&&(f.patDetails.nationality=f.NationalityCombo[e]),f.nationalityDefaultCheck=t[1][0].NATIONALITY}catch(e){}})},f.getLocatinByArea=function(e){if(null!=f.patDetails.addressline2&&null==f.patDetails.addressline2.AREA_CODE?f.data.address2Flag=!0:null!=f.patDetails.addressline2&&null!=f.patDetails.addressline2.AREA_CODE&&(f.data.address2Flag=!1),null!=e.AREA_DESC&&(f.patDetails.locationMaster2=!0,f.checkInvalidMasterAddressData=!0),null==e.CITY_CODE){f.patDetails.addressline2="";var t=e.AREA_DESC.split(" (")[0];f.patDetails.addressline2=t,i.open("ADD LOCATION",{animation:!0,templateUrl:"app/consumer/his17_2/masters/locationMaster/screens/section/location-master.html",controller:"locationmasterController",controllerAs:"locMastCtrl",size:"sm",resolve:{items:function(){return f.patDetails.addressline2}}}).result.then(function(e){if(e){var t=e.data.HITService.message.isSaveorUpdate;if(t){f.data.address2Flag=t,n.getCityStateCountrydata("getCityByCode").then(function(e){angular.isArray(e)&&(f.CitiesListCombo=e)}),n.getCityStateCountrydata("getStateByCountryCode").then(function(e){angular.isArray(e)&&(f.StateListCombo=e)}),n.getCityStateCountrydata("getCountryByCode").then(function(e){angular.isArray(e)&&(f.CountryListCombo=e)});var a=e.data.HITService.message.addrLevelDtlList[0]["com.napier.registration.vo.AddressLevelDtlVo"];if(a){if(f.patDetails.locationMaster2=!0,a.areaDesc)if(f.patDetails.addressline2=a.areaDesc,a.areaCode)f.patDetails.areaCode=a.areaCode;else{let e=[];f.getDetails3={1:e};let t=u.executeQueryURLReset();f.aList=new Array,u.prepareParamListWithParam("pAreaDesc",a.areaDesc+"%",f.aList),u.executeQueryInput("ADDRES2_DTLS_LOC_MASTER",f.aList,f.getDetails3,!0,!0,t,"popUp",{}).then(function(e){let t=e[1][0].AREA_CODE;f.patDetails.areaCode=t})}a.pinCode&&(f.patDetails.zipcode=a.pinCode),a.cityDesc&&a.cityCode?(f.CitiesListCombo&&f.CitiesListCombo[parseInt(_.findKey(f.CitiesListCombo,{addrCode:a.cityCode}))]?f.patDetails.city=f.CitiesListCombo[parseInt(_.findKey(f.CitiesListCombo,{addrCode:a.cityCode}))]:(f.patDetails.city={},f.patDetails.city.addrCode=a.cityCode,f.patDetails.city.addrDescription=a.cityDesc),f.getStateByCity(f.patDetails.city)):a.cityDesc&&!a.cityCode?(f.patDetails.city={},f.patDetails.city.addrDescription=a.cityDesc,f.patDetails.state={},a.stateDesc&&a.stateCode?(f.patDetails.state.addrCode=a.stateCode,f.patDetails.state.addrDescription=a.stateDesc,f.getCountryByState(f.patDetails.state)):a.stateDesc&&!a.stateCode&&(f.patDetails.state={},f.patDetails.state.addrDescription=a.stateDesc,f.patDetails.country={},a.countryCode&&(f.patDetails.country.addrCode=a.countryCode),f.patDetails.country.addrDescription=a.countryDesc)):a.stateDesc&&!a.cityDesc?(f.patDetails.city="",f.patDetails.state={},a.stateDesc&&a.stateCode?(f.patDetails.state.addrCode=a.stateCode,f.patDetails.state.addrDescription=a.stateDesc,f.getCountryByState(f.patDetails.state)):a.stateDesc&&!a.stateCode&&(f.patDetails.state={},f.patDetails.state.addrDescription=a.stateDesc,f.patDetails.country={},a.countryCode&&(f.patDetails.country.addrCode=a.countryCode),f.patDetails.country.addrDescription=a.countryDesc)):a.countryDesc&&!a.stateDesc&&(f.patDetails.city="",f.patDetails.state="",f.patDetails.country={},a.countryCode&&(f.patDetails.country.addrCode=a.countryCode),f.patDetails.country.addrDescription=a.countryDesc)}}}})}else f.data.address2Flag=!1,f.patDetails.addressline2=e.AREA_DESC,f.patDetails.areaCode=e.AREA_CODE,f.patDetails.zipcode=e.PIN,f.CitiesListCombo&&f.CitiesListCombo[parseInt(_.findKey(f.CitiesListCombo,{addrCode:e.CITY_CODE}))]?f.patDetails.city=f.CitiesListCombo[parseInt(_.findKey(f.CitiesListCombo,{addrCode:e.CITY_CODE}))]:(f.patDetails.city={},f.patDetails.city.addrCode=e.CITY_CODE,f.patDetails.city.addrDescription=e.CITY_DESC),f.getStateByCity(f.patDetails.city)},f.getStateByCity=function(e){e&&e.addrCode&&n.getCityStateCountrydata("getStateByCountryCode",e.addrCode).then(function(e){angular.isArray(e)&&1==e.length&&(f.patDetails.state=e[0],f.getCountryByState(f.patDetails.state))})},f.getCountryByState=function(e){if(e&&e.addrCode){n.getCityStateCountrydata("getCountryByCode",e.addrCode?e.addrCode:e).then(function(e){if(angular.isArray(e)){if(f.patDetails.country){if(f.patDetails.country.addrCode)var t=f.patDetails.country.addrCode;e[0]&&e[0].addrCode&&e[0].addrCode!=t&&!0}1==e.length&&(f.patDetails.country=e[0],f.getPhoneCodeByCountry(e[0]))}})}},f.getPhoneByCountry=function(e,t){e&&e.addrCode&&r.getQueryResponseData("GET_PHONE_CODE_ON_COUNTRY",e.addrCode).then(function(e){try{e[1]&&e[1][0]&&$(".initCountry").intlTelInput("setCountry",e[1][0].ADDR_LEVEL_CODE),t||(f.data.contactNumber=""),f.data.alternateContactNumber=""}catch(e){}})},f.getPhoneCodeByCountry=function(t){"N"!=e.phoneFlag&&t&&r.getQueryResponseData("GET_PHONE_CODE_ON_COUNTRY",t.addrCode).then(function(e){try{e[1]&&e[1][0]&&$(".initCountry").intlTelInput("setCountry",e[1][0].ADDR_LEVEL_CODE)}catch(e){}})},f.getDefaultOptions=function(){f.storeList=new Array,f.workList={1:f.storeList};var e=u.executeQueryURLReset(),t=new Array;return u.prepareParamListWithParam("pFacility",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,t),u.prepareParamListWithParam("pAddType","001",t),u.prepareParamListWithParam("pFacType","006",t),u.executeQueryInput("GET_DEFAULT_COUNTRY",t,f.workList,!0,!0,e,"popUp",{})},f.getArea_Location=function(e){f.data.address2Flag=!0,f.patDetails.areaCode&&(f.patDetails.areaCode="",f.patDetails.locationMaster2=!1);var t=[];f.getDetails3={1:t};var a=e+" (Add New)";t.push({AREA_DESC:a});var i=u.executeQueryURLReset();return f.aList=new Array,u.prepareParamListWithParam("pAreaDesc",e+"%",f.aList),u.executeQueryInput("ADDRES2_DTLS_LOC_MASTER",f.aList,f.getDetails3,!0,!0,i,"popUp",{}).then(function(e){for(let e=0;e<t.length;e++)t[e].loc_name=t[e].AREA_DESC,t[e].CITY_DESC&&(t[e].loc_name=t[e].AREA_DESC+","+t[e].CITY_DESC);f.locationList=angular.copy(t)}),f.locationList},f.dataSetup=function(){},f.updatePayerDetails=function(){var t={1:f.updateGridServiceDetails=[],2:f.updateDetails=[]},a=u.executeQueryURLReset(),i=new Array;u.prepareParamListWithParam("pFACILITY_ID",f.data.facilityId,i),u.prepareParamListWithParam("pINC_SEQ_ID",f.data.payerName.INC_SEQ_ID,i),u.executeQueryInput("BL_GET_CREDIT_PAYER_SERVICE_DTLS",i,t,!0,!1,a,"popUp"),u.executeQueryInput("BL_GET_CREDIT_PAYER_DTLS",i,t,!0,!0,a,"popUp",{}).then(function(t){if(t[1]){let n=angular.copy(f.data);if(f.dataClear(),f.data.facilityId=n.facilityId,f.data.payerCode=n.payerCode,f.data.payerName=n.payerName,f.data.insurance=f.insuranceList[0].INC_SEQ_ID,f.data.tpa=f.insuranceList[0].INC_SEQ_ID,f.data.claimAutherization=f.insuranceList[0].INC_SEQ_ID,f.data.tpa=f.insuranceList[0].INC_SEQ_ID,f.data.tariff=f.tariffList[0].CODE,f.treeViewData=[],f.exclGridOptions.data=[],f.exclGridOptions.data[0]={},f.inclGridOptions.data=[],f.inclGridOptions.data[0]={},f.updateDetails.length>0){if(f.data.payerCategory=_.toString(f.updateDetails[0].PAYER_CATEGORY),f.data.payerTypeInsurer=f.updateDetails[0].IS_INSURNACE,f.data.payerTypeTpa=f.updateDetails[0].IS_TPA,f.data.payerTypeOther=f.updateDetails[0].OTHERS,f.data.status=f.updateDetails[0].GN_STATUS,f.data.fromDate=new Date(f.updateDetails[0].EFFECTIVE_FROM_DATE),f.data.toDate=new Date(f.updateDetails[0].EFFECTIVE_TO_DATE),f.data.tariff=f.updateDetails[0].TARIFF_CATG_CODE,f.data.contactPerson=f.updateDetails[0].INC_CONTACT_PERSN,f.data.alternateContactNumber=f.updateDetails[0].CORP_ALT_CONTACT_NUMBER,f.data.contactNumber=f.updateDetails[0].CORP_CONTACT_NUMBER,f.data.email=f.updateDetails[0].EMAIL_ID,f.data.bedClassInclusion=f.updateDetails[0].IS_BED_CLASS_INCL_OR_EXCL,f.data.payerTypeInsurer=f.updateDetails[0].IS_INSURNACE,f.data.creditLimit=f.updateDetails[0].CREDIT_LIMIT,f.data.other=1==f.updateDetails[0].OTHERS&&f.updateDetails[0].OTHERS_TYPE?_.find(f.othersList,function(e){return e.CODE==f.updateDetails[0].OTHERS_TYPE}).CODE:void 0,f.data.taxCode=f.updateDetails[0].PAYER_TAX_ID,f.data.insurance=f.updateDetails[0].INSURANCE_TYPE?1!==f.updateDetails[0].INSURANCE_TYPE?f.updateDetails[0].INSURANCE_TYPE:f.updateDetails[0].INSURANCE_TYPE.toString():f.insuranceList[0].INC_SEQ_ID,f.data.tpa=f.updateDetails[0].TPA_TYPE?1!==f.updateDetails[0].TPA_TYPE?f.updateDetails[0].TPA_TYPE:f.updateDetails[0].TPA_TYPE.toString():f.insuranceList[0].INC_SEQ_ID,f.data.parentPayer=f.updateDetails[0].PARENT_INC_SEQ_ID?_.find(f.payersParentList,function(e){return e.INC_SEQ_ID==f.updateDetails[0].PARENT_INC_SEQ_ID}):void 0,1==f.data.payerTypeTpa&&2==f.data.payerTypeInsurer&&2==f.data.payerTypeOther&&(f.disableFieldsForTPA=!0),f.data.parentPayer&&f.getPlansChildList(),f.updateDetails[0].BILL_TO&&(f.data.billingTo=_.find(f.childInsuranceList,function(e){return e.INC_SEQ_ID==f.updateDetails[0].BILL_TO}),f.data.childAdress=f.data.billingTo?f.data.billingTo.ADDRESS:void 0),f.updateDetails[0].CLAIM_TO&&(f.data.claimAutherization=_.find(f.childInsuranceList,function(e){return e.INC_SEQ_ID==f.updateDetails[0].CLAIM_TO}),f.data.childAdressClaim=f.data.claimAutherization?f.data.claimAutherization.ADDRESS:void 0),f.data.taxType=_.find(f.taxTypeList,function(e){return e.TAX_CODE==f.updateDetails[0].TAX_TYPE}),f.data.taxType&&(e.taxType=!0),f.data.remarks=f.updateDetails[0].REMARKS,f.data.payerFactSeqId=f.updateDetails[0].PAYER_FAC_SEQ_ID,f.data.faxNumber=f.updateDetails[0].CORP_FAX_NUMBER,f.data.address=f.updateDetails[0].ADDRESS1,f.patDetails={addressline2:f.updateDetails[0].ADDRESS2,city:f.updateDetails[0].CITY,state:f.updateDetails[0].STATE,country:f.updateDetails[0].COUNTRY,zipcode:f.updateDetails[0].ZIP},f.updateDetails[0].ADDRESS2)f.getArea_Location(f.patDetails.addressline2),setTimeout(function(){if(f.locationList&&f.locationList.length>0){t[1];f.updateDetails[0].ADDRESS2=f.locationList[1],f.getLocatinByArea(f.updateDetails[0].ADDRESS2)}},2e3);else{let e=_.find(f.CitiesListCombo,function(e){return e.addrDescription==f.patDetails.city});f.patDetails.city=e;let t=_.find(f.StateListCombo,function(e){return e.addrDescription==f.patDetails.city}),a=_.find(f.CountryListCombo,function(e){return e.addrDescription==f.patDetails.country});f.getStateByCity(e),f.getCountryByState(t),f.getPhoneByCountry(a,!0)}moment(moment().format("YYYY-MM-DD")).isAfter(moment(f.data.fromDate).format("YYYY-MM-DD"))&&(f.fromDateOptions.minDate=new Date(f.data.fromDate),f.toDateOptions.minDate=new Date(f.data.fromDate),f.planToDateOptions.minDate=f.data.fromDate,f.planFromDateOptions.minDate=f.data.fromDate),f.planToDateOptions.maxDate=new Date(f.data.toDate),f.planFromDateOptions.maxDate=new Date(f.data.toDate);for(let e=0;e<f.updateGridServiceDetails.length;e++)if(f.updateGridServiceDetails[e].IS_MATERIAL=2==f.updateGridServiceDetails[e].IS_MATERIAL?"Y":"N",1==f.updateGridServiceDetails[e].SERVICE_HIERARCHY_LEVEL){if(0==f.treeViewData.length)f.treeViewData.push({primServGroup:{DESCRIPTION:f.updateGridServiceDetails[e].PSG_DESC,CODE:f.updateGridServiceDetails[e].PSG_CODE,IS_MATERIAL:f.updateGridServiceDetails[e].IS_MATERIAL},payerSerSeqId:f.updateGridServiceDetails[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.updateGridServiceDetails[e].DEPT_DESC,CODE:f.updateGridServiceDetails[e].DEPT_CODE},speciality:{DESCRIPTION:f.updateGridServiceDetails[e].SPL_DESC,CODE:f.updateGridServiceDetails[e].SPL_CODE},servCode:f.updateGridServiceDetails[e].SERV_CODE,servName:{SERV_CODE:f.updateGridServiceDetails[e].SERV_CODE,SERV_NAME:f.updateGridServiceDetails[e].SERV_NAME,SERV_SEQ_ID:f.updateGridServiceDetails[e].SERV_SEQ_ID},inclusion:f.updateGridServiceDetails[e].IS_INCL_OR_EXCL,isRequired:f.updateGridServiceDetails[e].IS_APPROVAL_REQUIRED,level:f.updateGridServiceDetails[e].SERVICE_HIERARCHY_LEVEL,gnStatus:1});else for(let t=0;t<f.treeViewData.length;t++)if(t==f.treeViewData.length-1){f.treeViewData.push({primServGroup:{DESCRIPTION:f.updateGridServiceDetails[e].PSG_DESC,CODE:f.updateGridServiceDetails[e].PSG_CODE,IS_MATERIAL:f.updateGridServiceDetails[e].IS_MATERIAL},payerSerSeqId:f.updateGridServiceDetails[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.updateGridServiceDetails[e].DEPT_DESC,CODE:f.updateGridServiceDetails[e].DEPT_CODE},speciality:{DESCRIPTION:f.updateGridServiceDetails[e].SPL_DESC,CODE:f.updateGridServiceDetails[e].SPL_CODE},servCode:f.updateGridServiceDetails[e].SERV_CODE,servName:{SERV_CODE:f.updateGridServiceDetails[e].SERV_CODE,SERV_NAME:f.updateGridServiceDetails[e].SERV_NAME,SERV_SEQ_ID:f.updateGridServiceDetails[e].SERV_SEQ_ID},inclusion:f.updateGridServiceDetails[e].IS_INCL_OR_EXCL,isRequired:f.updateGridServiceDetails[e].IS_APPROVAL_REQUIRED,level:f.updateGridServiceDetails[e].SERVICE_HIERARCHY_LEVEL,gnStatus:1});break}}else if(2==f.updateGridServiceDetails[e].SERVICE_HIERARCHY_LEVEL){for(let t=0;t<f.treeViewData.length;t++)if(f.treeViewData[t].primServGroup.CODE==f.updateGridServiceDetails[e].PSG_CODE)if(null==f.treeViewData[t].departTreeList)f.treeViewData[t].departTreeList=[],f.treeViewData[t].departTreeList.push({primServGroup:{DESCRIPTION:f.updateGridServiceDetails[e].PSG_DESC,CODE:f.updateGridServiceDetails[e].PSG_CODE,IS_MATERIAL:f.updateGridServiceDetails[e].IS_MATERIAL},payerSerSeqId:f.updateGridServiceDetails[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.updateGridServiceDetails[e].DEPT_DESC,CODE:f.updateGridServiceDetails[e].DEPT_CODE},speciality:{DESCRIPTION:f.updateGridServiceDetails[e].SPL_DESC,CODE:f.updateGridServiceDetails[e].SPL_CODE},servCode:f.updateGridServiceDetails[e].SERV_CODE,servName:{SERV_CODE:f.updateGridServiceDetails[e].SERV_CODE,SERV_NAME:f.updateGridServiceDetails[e].SERV_NAME,SERV_SEQ_ID:f.updateGridServiceDetails[e].SERV_SEQ_ID},inclusion:f.updateGridServiceDetails[e].IS_INCL_OR_EXCL,isRequired:f.updateGridServiceDetails[e].IS_APPROVAL_REQUIRED,level:f.updateGridServiceDetails[e].SERVICE_HIERARCHY_LEVEL,gnStatus:1});else for(let a=0;a<f.treeViewData[t].departTreeList.length;a++)if(a==f.treeViewData[t].departTreeList.length-1){f.treeViewData[t].departTreeList.push({primServGroup:{DESCRIPTION:f.updateGridServiceDetails[e].PSG_DESC,CODE:f.updateGridServiceDetails[e].PSG_CODE,IS_MATERIAL:f.updateGridServiceDetails[e].IS_MATERIAL},payerSerSeqId:f.updateGridServiceDetails[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.updateGridServiceDetails[e].DEPT_DESC,CODE:f.updateGridServiceDetails[e].DEPT_CODE},speciality:{DESCRIPTION:f.updateGridServiceDetails[e].SPL_DESC,CODE:f.updateGridServiceDetails[e].SPL_CODE},servCode:f.updateGridServiceDetails[e].SERV_CODE,servName:{SERV_CODE:f.updateGridServiceDetails[e].SERV_CODE,SERV_NAME:f.updateGridServiceDetails[e].SERV_NAME,SERV_SEQ_ID:f.updateGridServiceDetails[e].SERV_SEQ_ID},inclusion:f.updateGridServiceDetails[e].IS_INCL_OR_EXCL,isRequired:f.updateGridServiceDetails[e].IS_APPROVAL_REQUIRED,level:f.updateGridServiceDetails[e].SERVICE_HIERARCHY_LEVEL,gnStatus:1});break}}else if(3==f.updateGridServiceDetails[e].SERVICE_HIERARCHY_LEVEL){for(let t=0;t<f.treeViewData.length;t++)if(f.treeViewData[t].primServGroup.CODE==f.updateGridServiceDetails[e].PSG_CODE&&f.treeViewData[t].departTreeList)for(let a=0;a<f.treeViewData[t].departTreeList.length;a++)if(f.treeViewData[t].departTreeList[a].department.CODE==f.updateGridServiceDetails[e].DEPT_CODE)if(null==f.treeViewData[t].departTreeList[a].specltyTreeList)f.treeViewData[t].departTreeList[a].specltyTreeList=[],f.treeViewData[t].departTreeList[a].specltyTreeList.push({primServGroup:{DESCRIPTION:f.updateGridServiceDetails[e].PSG_DESC,CODE:f.updateGridServiceDetails[e].PSG_CODE,IS_MATERIAL:f.updateGridServiceDetails[e].IS_MATERIAL},payerSerSeqId:f.updateGridServiceDetails[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.updateGridServiceDetails[e].DEPT_DESC,CODE:f.updateGridServiceDetails[e].DEPT_CODE},speciality:{DESCRIPTION:f.updateGridServiceDetails[e].SPL_DESC,CODE:f.updateGridServiceDetails[e].SPL_CODE},servCode:f.updateGridServiceDetails[e].SERV_CODE,servName:{SERV_CODE:f.updateGridServiceDetails[e].SERV_CODE,SERV_NAME:f.updateGridServiceDetails[e].SERV_NAME,SERV_SEQ_ID:f.updateGridServiceDetails[e].SERV_SEQ_ID},inclusion:f.updateGridServiceDetails[e].IS_INCL_OR_EXCL,isRequired:f.updateGridServiceDetails[e].IS_APPROVAL_REQUIRED,level:f.updateGridServiceDetails[e].SERVICE_HIERARCHY_LEVEL,gnStatus:1});else for(let i=0;i<f.treeViewData[t].departTreeList[a].specltyTreeList.length;i++)if(i==f.treeViewData[t].departTreeList[a].specltyTreeList.length-1){f.treeViewData[t].departTreeList[a].specltyTreeList.push({primServGroup:{DESCRIPTION:f.updateGridServiceDetails[e].PSG_DESC,CODE:f.updateGridServiceDetails[e].PSG_CODE,IS_MATERIAL:1==f.updateGridServiceDetails[e].IS_MATERIAL?"N":"Y"},payerSerSeqId:f.updateGridServiceDetails[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:f.updateGridServiceDetails[e].DEPT_DESC,CODE:f.updateGridServiceDetails[e].DEPT_CODE},speciality:{DESCRIPTION:f.updateGridServiceDetails[e].SPL_DESC,CODE:f.updateGridServiceDetails[e].SPL_CODE},servCode:f.updateGridServiceDetails[e].SERV_CODE,servName:{SERV_CODE:f.updateGridServiceDetails[e].SERV_CODE,SERV_NAME:f.updateGridServiceDetails[e].SERV_NAME,SERV_SEQ_ID:f.updateGridServiceDetails[e].SERV_SEQ_ID},inclusion:f.updateGridServiceDetails[e].IS_INCL_OR_EXCL,isRequired:f.updateGridServiceDetails[e].IS_APPROVAL_REQUIRED,level:f.updateGridServiceDetails[e].SERVICE_HIERARCHY_LEVEL,gnStatus:1});break}}else if(4==f.updateGridServiceDetails[e].SERVICE_HIERARCHY_LEVEL)for(let t=0;t<f.treeViewData.length;t++)if(f.treeViewData[t].primServGroup.CODE==f.updateGridServiceDetails[e].PSG_CODE&&f.treeViewData[t].departTreeList)for(let a=0;a<f.treeViewData[t].departTreeList.length;a++)if(f.treeViewData[t].departTreeList[a].department.CODE==f.updateGridServiceDetails[e].DEPT_CODE)for(let i=0;i<f.treeViewData[t].departTreeList[a].specltyTreeList.length;i++)f.treeViewData[t].departTreeList[a].specltyTreeList[i].speciality.CODE==f.updateGridServiceDetails[e].SPL_CODE&&A(f,f.treeViewData[t].departTreeList[a].specltyTreeList[i],e,t,f.updateGridServiceDetails);if(f.getPlansList(),f.updateDetails[0].IS_BED_CLASS_INCL_OR_EXCL){var a={1:f.getTariffList=[]},i=u.executeQueryURLReset(),r=new Array;u.prepareParamListWithParam("pFACILITY_ID",f.data.facilityId,r),u.prepareParamListWithParam("pINC_SEQ_ID",f.data.payerName.INC_SEQ_ID,r),u.prepareParamListWithParam("pINC_PLAN_SEQ_ID",-999,r),u.prepareParamListWithParam("pIS_INCL_OR_EXCL",f.updateDetails[0].IS_BED_CLASS_INCL_OR_EXCL,r),u.executeQueryInput("BL_GET_CREDIT_PAYER_AND_PLAN_BED_CLASS_DTLS",r,a,!0,!0,i,"popUp",{}).then(function(e){if(e[1][0]){for(var t=[],a=0;a<f.getTariffList.length;a++)t.push({tariffSeqId:f.getTariffList[a].TARFIFF_INCL_SEQ_ID?f.getTariffList[a].TARFIFF_INCL_SEQ_ID:f.getTariffList[a].TARFIFF_EXCL_SEQ_ID,status:f.getTariffList[a].GN_STATUS,bedClassName:{CODE:f.getTariffList[a].BC_CODE,DESCRIPTION:f.getTariffList[a].BC_DESC},bedClassCode:f.getTariffList[a].BC_CODE});1==f.updateDetails[0].IS_BED_CLASS_INCL_OR_EXCL?f.inclGridOptions.data=_.concat(f.inclGridOptions.data,t):f.exclGridOptions.data=_.concat(f.exclGridOptions.data,t)}})}}}})},f.addService=function(t){if(!f.disableFieldsForTPA){if(4==e.activeFirst){var a=angular.copy(f.planTreeViewData),i=f.planHeaderData,r=angular.copy(f.planServicesGridOptions);null!=a[0]&&(f.packageCoverTypePlan=f.setInclusioValue(t))}else{a=angular.copy(f.treeViewData),r=angular.copy(f.servicesGridOptions),i=f.headerData;null!=a[0]&&(f.packageCoverType=f.setInclusioValue(t))}r.columnDefs[0].visible=!1,r.columnDefs[1].visible=!1,r.columnDefs[2].visible=!1,r.columnDefs[3].visible=!0,r.columnDefs[4].visible=!0,"Y"==t.primServGroup.IS_MATERIAL?(r.columnDefs[3].displayName="billing.materialCode",r.columnDefs[4].displayName="billing.materialName"):(r.columnDefs[3].displayName="billing.serviceCode",r.columnDefs[4].displayName="billing.service"),r.data=[],r.data[0]=angular.copy({primServGroup:t.primServGroup,department:t.department,speciality:t.speciality,level:4,isRequired:1,inclusion:1}),null!=t.srivceTreeList&&t.srivceTreeList.length>0&&(r.data=angular.copy(_.concat(r.data,t.srivceTreeList))),f.OnChangeDept(t),(i=angular.copy(t)).level=4,4==e.activeFirst?(f.planTreeViewData=angular.copy(a),f.planHeaderData=i,f.planServicesGridOptions=angular.copy(r)):(f.treeViewData=angular.copy(a),f.servicesGridOptions=angular.copy(r),f.headerData=i)}},f.removeIncExcRcrd=function(t,a){var i={buttonCallBack1:function(){},buttonCallBack2:function(){if(4==e.activeFirst)var i=angular.copy(f.planTreeViewData),r=angular.copy(f.planServicesGridOptions.data);else i=angular.copy(f.treeViewData),r=angular.copy(f.servicesGridOptions.data);4==e.activeFirst?void 0===t.payerSerSeqId&&void 0===t.cisSeqId||(t.gnStatus=2,1==t.level?function(e){if(e.departTreeList)for(let t=0;t<e.departTreeList.length;t++)e.departTreeList[t].gnStatus=2,E(e.departTreeList[t])}(t):2==t.level?E(t):3==t.level&&h(t),f.planTreeViewDataRemove.push(angular.copy(t))):void 0!==t.payerSerSeqId&&(t.gnStatus=2,f.treeViewDataRemove.push(angular.copy(t))),r.splice(a,1);for(var n=0;n<i.length;n++)if(1==t.level)t.primServGroup.CODE==i[n].primServGroup.CODE&&i.splice(n,1);else if(t.primServGroup.CODE==i[n].primServGroup.CODE&&i[n].departTreeList)for(var l=0;l<i[n].departTreeList.length;l++)if(i[n].departTreeList[l].department.CODE==t.department.CODE&&2==t.level)i[n].departTreeList.splice(l,1);else if(i[n].departTreeList[l].department.CODE==t.department.CODE&&i[n].departTreeList[l].specltyTreeList)for(var s=0;s<i[n].departTreeList[l].specltyTreeList.length;s++)if(i[n].departTreeList[l].specltyTreeList[s].speciality.CODE==t.speciality.CODE&&3==t.level)i[n].departTreeList[l].specltyTreeList.splice(s,1);else if(i[n].departTreeList[l].specltyTreeList[s].speciality.CODE==t.speciality.CODE&&4==t.level&&i[n].departTreeList[l].specltyTreeList[s].srivceTreeList)for(var o=0;o<i[n].departTreeList[l].specltyTreeList[s].srivceTreeList.length;o++)i[n].departTreeList[l].specltyTreeList[s].srivceTreeList[o].servName.SERV_SEQ_ID==t.servName.SERV_SEQ_ID&&i[n].departTreeList[l].specltyTreeList[s].srivceTreeList.splice(o,1);4==e.activeFirst?(f.planTreeViewData=angular.copy(i),f.planServicesGridOptions.data=angular.copy(r)):(f.treeViewData=angular.copy(i),f.servicesGridOptions.data=angular.copy(r))},buttonClose:function(){}};l.hisAlertMulti("warning","Warning","Do You Want To Delete?",{buttonText:"No",buttonText2:"Yes"},i,i)},f.changePrimaryGroup=function(e,t,a){let i=angular.copy(e);if(1==e.type)var r=angular.copy(f.defaultAuthGridOptions);else if(2==e.type)r=angular.copy(f.ipCoPayGridOptions);else if(3==e.type)r=angular.copy(f.opCoPayGridOptions);else if(4==e.type)r=angular.copy(f.discountGridOptions);if(5==e.type)r=angular.copy(f.opCoInsuranceGridOptions);if(6==e.type)r=angular.copy(f.ipCoInsuranceGridOptions);if(r.data[t]&&(1==e.type?f.deptSpecicityDefaultService[t]=[]:2==e.type?f.deptSpecicityIpService[t]=[]:3==e.type?f.deptSpecicityOpService[t]=[]:4==e.type?f.deptSpecicityDiscountService[t]=[]:5==e.type?f.deptSpecicityOpCoInsuranceService[t]=[]:6==e.type&&(f.deptSpecicityIpCoInsuranceService[t]=[]),r.data[t].department={},r.data[t].speciality={},delete r.data[t].service),i.primayServiceGroup){if(1==e.type)var n={1:f.deptdwn_default[t]=[]};else if(2==e.type)n={1:f.deptdwn_ip[t]=[]};else if(3==e.type)n={1:f.deptdwn_op[t]=[]};else if(4==e.type)n={1:f.deptdwn_discount[t]=[]};else if(5==e.type)n={1:f.deptdwn_opCoinsurance[t]=[]};else if(6==e.type)n={1:f.deptdwn_ipCoinsurance[t]=[]};if(a)(i.servName&&i.servName.SERV_CODE||i.servName&&i.servName.SERV_SEQ_ID)&&angular.extend(r.data[t],{service:i.servName}),i.department&&i.department.CODE&&(r.data[t].department=i.department),i.speciality&&i.speciality.CODE&&(r.data[t].speciality=i.speciality),1==e.type?f.defaultAuthGridOptions=angular.copy(r):2==e.type?f.ipCoPayGridOptions=angular.copy(r):4==e.type&&(f.discountGridOptions=angular.copy(r));else{let a=u.executeQueryURLReset(),s=new Array;if(u.prepareParamListWithParam("pMetSubCatSeqId",e.primayServiceGroup?e.primayServiceGroup.CODE:-999,s),u.prepareParamListWithParam("pPSG_CODE",e.primayServiceGroup?e.primayServiceGroup.CODE:-999,s),u.prepareParamListWithParam("pPRACTICEID",f.data.facilityId,s),e.primayServiceGroup&&"Y"==e.primayServiceGroup.IS_MATERIAL)var l="FETCH_MAT_GROUP";else l="BL_GET_DEPARTMENT_SEARCH_SP";u.executeQueryInput(l,s,n,!0,!0,a,"popUp",{}).then(function(a){a[1][0]&&(i.servName&&i.servName.SERV_CODE&&angular.extend(r.data[t],{service:i.servName}),i.department&&i.department.CODE&&(r.data[t].department=_.find(1==i.type?f.deptdwn_default[t]:2==i.type?f.deptdwn_ip[t]:3==i.type?f.deptdwn_op[t]:4==i.type?f.deptdwn_discount[t]:5==i.type?f.deptdwn_opCoinsurance[t]:f.deptdwn_ipCoinsurance[t],function(e){return e.CODE==i.department.CODE}),f.OnChangeCopayDept(i,t)),i.speciality&&i.speciality.CODE&&(r.data[t].speciality=i.speciality)),1==e.type?f.defaultAuthGridOptions=angular.copy(r):2==e.type?f.ipCoPayGridOptions=angular.copy(r):3==e.type?f.opCoPayGridOptions=angular.copy(r):4==e.type?f.discountGridOptions=angular.copy(r):5==e.type?f.opCoInsuranceGridOptions=angular.copy(r):6==e.type&&(f.ipCoInsuranceGridOptions=angular.copy(r))})}}},f.OnChangeCopayDept=function(e,t){if(1==e.type)var a=angular.copy(f.defaultAuthGridOptions);else if(2==e.type)a=angular.copy(f.ipCoPayGridOptions);else if(3==e.type)a=angular.copy(f.opCoPayGridOptions);else if(4==e.type)a=angular.copy(f.discountGridOptions);else if(5==e.type)a=angular.copy(f.opCoInsuranceGridOptions);else if(6==e.type)a=angular.copy(f.ipCoInsuranceGridOptions);t=t;var i=angular.copy(e);if(i.department&&i.department.CODE){a.data[t]&&(a.data[t].speciality={},a.data[t].service=""),1==i.type?f.specilityMap={1:f.deptSpecicityDefaultService[t]=[]}:2==i.type?f.specilityMap={1:f.deptSpecicityIpService[t]=[]}:3==i.type?f.specilityMap={1:f.deptSpecicityOpService[t]=[]}:4==i.type?f.specilityMap={1:f.deptSpecicityDiscountService[t]=[]}:5==i.type?f.specilityMap={1:f.deptSpecicityOpCoInsuranceService[t]=[]}:6==i.type&&(f.specilityMap={1:f.deptSpecicityIpCoInsuranceService[t]=[]});var r=u.executeQueryURLReset(),n=new Array;if(u.prepareParamListWithParam("pPSG_CODE",i.primayServiceGroup?i.primayServiceGroup.CODE:-999,n),u.prepareParamListWithParam("pDEPT_CODE",i.department?i.department.CODE:-999,n),u.prepareParamListWithParam("pMetMainCatSeqId",i.department?i.department.CODE:-999,n),u.prepareParamListWithParam("pPRACTICEID",f.data.facilityId,n),i.primayServiceGroup&&"Y"==i.primayServiceGroup.IS_MATERIAL)var l="FETCH_MAT_SUB_GROUP";else l="BL_GET_SPECIALITY_SEARCH_SP";u.executeQueryInput(l,n,f.specilityMap,!0,!0,r,"popUp",{}).then(function(e){e[1][0]&&(i.speciality&&i.speciality.CODE&&(a.data[t].speciality=_.find(1==i.type?f.deptSpecicityDefaultService[t]:2==i.type?f.deptSpecicityIpService[t]:3==i.type?f.deptSpecicityOpService[t]:4==i.type?f.deptSpecicityDiscountService[t]:5==i.type?f.deptSpecicityOpCoInsuranceService[t]:f.deptSpecicityIpCoInsuranceService[t],function(e){return e.CODE==i.speciality.CODE})),i.service&&i.service.SERV_SEQ_ID&&(a.data[t].service=i.service)),1==i.type?f.defaultAuthGridOptions=angular.copy(a):2==i.type?f.ipCoPayGridOptions=angular.copy(a):3==i.type?f.opCoPayGridOptions=angular.copy(a):4==i.type?f.discountGridOptions=angular.copy(a):5==i.type?f.opCoInsuranceGridOptions=angular.copy(a):6==i.type&&(f.ipCoInsuranceGridOptions=angular.copy(a))})}},f.changeSpeciality=function(e,t){1==e.type?delete f.defaultAuthGridOptions.data[t].service:2==e.type?delete f.ipCoPayGridOptions.data[t].service:3==e.type?delete f.opCoPayGridOptions.data[t].service:4==e.type?delete f.discountGridOptions.data[t].service:5==e.type?delete f.opCoInsuranceGridOptions.data[t].service:delete f.ipCoInsuranceGridOptions.data[t].service},f.serchOptimCopaySpeciSerch=function(e,t,a){f.optServSerch=[],f.copayserviceMap={1:f.optServSerch};var i=u.executeQueryURLReset(),r=new Array;if(u.prepareParamListWithParam("pPSG_CODE",null!=t.primayServiceGroup&&null!==t.primayServiceGroup&&""!==t.primayServiceGroup?null!=t.primayServiceGroup.CODE?t.primayServiceGroup.CODE:t.primayServiceGroup:-999,r),u.prepareParamListWithParam("pDEPT_CODE",null!=t.department&&null!==t.department&&""!==t.department&&null!=t.department.CODE?t.department.CODE:-999,r),u.prepareParamListWithParam("pSPECL_CODE",null!=t.speciality&&null!=t.speciality&&""!==t.speciality&&null!=t.speciality.CODE?t.speciality.CODE:-999,r),u.prepareParamListWithParam("pSERV_NAME",e,r),u.prepareParamListWithParam("pMaterialCat",null!=t.primayServiceGroup&&null!==t.primayServiceGroup&&""!==t.primayServiceGroup?null!=t.primayServiceGroup.CODE?t.primayServiceGroup.CODE:t.primayServiceGroup:-999,r),u.prepareParamListWithParam("pMaterialGroup",null!=t.department&&null!==t.department&&""!==t.department&&null!=t.department.CODE?t.department.CODE:-999,r),u.prepareParamListWithParam("pMaterialSubGroup",null!=t.speciality&&null!=t.speciality&&""!==t.speciality&&null!=t.speciality.CODE?t.speciality.CODE:-999,r),u.prepareParamListWithParam("pMatCodeName",e,r),u.prepareParamListWithParam("pPRACTICEID",f.data.facilityId,r),t.primayServiceGroup&&"Y"==t.primayServiceGroup.IS_MATERIAL)var n="PACKAGE_MATERIAL_DETAILS";else n="BL_GET_SERVICE_SEARCH_SP";return u.executeQueryInput(n,r,f.copayserviceMap,!0,!0,i,"popUp",{}).then(function(e){if(e[1])return f.optServSerch.map(function(e){return f.serchCopayResult=e,e})})},f.setCopayService=function(e,t){var a;1==e.type?a=angular.copy(f.defaultAuthGridOptions):2==e.type?a=angular.copy(f.ipCoPayGridOptions):3==e.type?a=angular.copy(f.opCoPayGridOptions):4==e.type?a=angular.copy(f.discountGridOptions):5==e.type?a=angular.copy(f.opCoInsuranceGridOptions):6==e.type&&(a=angular.copy(f.ipCoInsuranceGridOptions)),a.data[t]={type:e.type,copaySeqId:e.copaySeqId,serviceHierarcyLevel:e.serviceHierarcyLevel,copayment:e.copayment,discSeqId:e.discSeqId,discount:e.discount,pdpaSeqId:e.pdpaSeqId,status:status.status,approvedAmount:e.approvedAmount,durationType:e.durationType,duration:e.duration,quantity:e.quantity,apprIsAmtPercNl:e.apprIsAmtPercNl},a.data[t].service={},a.data[t].primayServiceGroup={},a.data[t].department={},a.data[t].speciality={},a.data[t].primayServiceGroup.CODE=e.service.PRI_SERV_CODE,a.data[t].primayServiceGroup.DESCRIPTION=e.service.PRI_SERV_DESC,a.data[t].department.CODE=e.service.DEPT_CODE,a.data[t].department.DESCRIPTION=e.service.SEPT_DESC,a.data[t].speciality.CODE=e.service.SPL_CODE,a.data[t].speciality.DESCRIPTION=e.service.SPL_DESC,a.data[t].service={SERV_CODE:e.service.SERV_CODE,SERV_NAME:e.service.SERV_NAME,SERV_SEQ_ID:e.service.SERV_SEQ_ID};var i=a.data[t];f.changePrimaryGroup(i,t),1==e.type?f.defaultAuthGridOptions=angular.copy(a):2==e.type?f.ipCoPayGridOptions=angular.copy(a):3==e.type?f.opCoPayGridOptions=angular.copy(a):4==e.type?f.discountGridOptions=angular.copy(a):5==e.type?f.opCoInsuranceGridOptions=angular.copy(a):6==e.type&&(f.ipCoInsuranceGridOptions=angular.copy(a))},f.copayServiceGridList=function(t,a){if(null!=t.primayServiceGroup)if(null==t.copayment&&3==t.type||null==t.copayment&&2==t.type)l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,"Please enter the copay percentage",!1,!1,e.close,2e3);else if(null!=t.discount||4!=t.type){var i;if(null==t.primayServiceGroup&&null==t.primayServiceGroup.CODE||(t.serviceHierarcyLevel=1),null!=t.primayServiceGroup&&null!=t.primayServiceGroup.CODE&&null!=t.department.CODE&&(t.serviceHierarcyLevel=2),null!=t.primayServiceGroup&&null!=t.primayServiceGroup.CODE&&null!=t.department&&null!=t.department.CODE&&null!=t.speciality&&null!=t.speciality.CODE&&(t.serviceHierarcyLevel=3),null!=t.primayServiceGroup&&null!=t.primayServiceGroup.CODE&&null!=t.department&&null!=t.department.CODE&&null!=t.speciality&&null!=t.speciality.CODE&&null!=t.service&&null!=t.service.SERV_SEQ_ID&&(t.serviceHierarcyLevel=4),1==t.type?i=angular.copy(f.defaultAuthGridOptions):2==t.type?i=angular.copy(f.ipCoPayGridOptions):3==t.type?i=angular.copy(f.opCoPayGridOptions):4==t.type?i=angular.copy(f.discountGridOptions):5==t.type?i=angular.copy(f.opCoInsuranceGridOptions):6==t.type&&(i=angular.copy(f.ipCoInsuranceGridOptions)),i.data&&i.data.length>1){var r=!1,n=!1,s=!1,o=i.data;if(4!=t.type){for(var c=1;c<o.length;c++)if(!o[c].primayServiceGroup||!t.primayServiceGroup||o[c].primayServiceGroup.CODE!=t.primayServiceGroup.CODE||(o[c].service&&o[c].service.SERV_SEQ_ID)!=(t.service&&t.service.SERV_SEQ_ID)&&(o[c].servName&&o[c].servName.SERV_SEQ_ID)!=(t.service&&t.service.SERV_SEQ_ID)||o[c].isEditable||(r=!0),r&&(n=o[c].department==t.department||null!=t.department&&null!=o[c].department&&o[c].department.CODE==t.department.CODE),n&&(s=o[c].speciality==t.speciality||null!=t.speciality&&null!=o[c].speciality&&o[c].speciality.CODE==t.speciality.CODE||null==o[c].speciality&&null!=t.speciality),r){if(n&&s)return void l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,"Copay Already Exist",!1,!1,e.close,2e3)}else if(n&&s)return void l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,"Copay Already Exist",!1,!1,e.close,2e3)}else if(null!=t.service&&""!=t.service&&(t.service.CODE=t.service.SERV_SEQ_ID),f.gridValidationForAddition(t,0,t.serviceHierarcyLevel)&&!f.editId)return delete f.editId,void l.warning("Warning","Not allowed to add record under same hierarchy",!1,!1,v.time)}var d=angular.copy(t);if(f.editId)var p=f.editId;else p=i.data.length;1==t.type?(f.deptdwn_default[p]=f.deptdwn_default[0],f.deptSpecicityDefaultService[p]=f.deptSpecicityDefaultService[0]):2==t.type?(f.deptdwn_ip[p]=f.deptdwn_ip[0],f.deptSpecicityIpService[p]=f.deptSpecicityIpService[0]):3==t.type?(f.deptdwn_op[p]=f.deptdwn_op[0],f.deptSpecicityOpService[p]=f.deptSpecicityOpService[0]):4==t.type?(f.deptdwn_discount[p]=f.deptdwn_discount[0],f.deptSpecicityDiscountService[p]=f.deptSpecicityDiscountService[0]):5==t.type?(f.deptdwn_opCoinsurance[p]=f.deptdwn_opCoinsurance[0],f.deptSpecicityOpCoInsuranceService[p]=f.deptSpecicityOpCoInsuranceService[0]):6==t.type&&(f.deptdwn_ipCoinsurance[p]=f.deptdwn_ipCoinsurance[0],f.deptSpecicityIpCoInsuranceService[p]=f.deptSpecicityIpCoInsuranceService[0]),f.editId?(i.data[f.editId]=angular.copy(d),delete f.editId):i.data.push(d),1==t.type?(f.defaultAuthGridOptions=angular.copy(i),f.deptdwn_default[0]=[],f.deptSpecicityDefaultService[0]=[],f.defaultAuthGridOptions.data[0]={type:1,duration:""}):2==t.type?(f.ipCoPayGridOptions=angular.copy(i),f.deptdwn_ip[0]=[],f.deptSpecicityIpService[0]=[],f.ipCoPayGridOptions.data[0]={type:2}):3==t.type?(f.opCoPayGridOptions=angular.copy(i),f.deptdwn_op[0]=[],f.deptSpecicityOpService[0]=[],f.opCoPayGridOptions.data[0]={type:3}):4==t.type?(f.discountGridOptions=angular.copy(i),f.deptdwn_discount[0]=[],f.deptSpecicityDiscountService[0]=[],f.discountGridOptions.data[0]={type:4}):5==t.type?(f.opCoInsuranceGridOptions=angular.copy(i),f.deptdwn_opCoinsurance[0]=[],f.deptSpecicityOpCoInsuranceService[0]=[],f.opCoInsuranceGridOptions.data[0]={type:5}):6==t.type&&(f.ipCoInsuranceGridOptions=angular.copy(i),f.deptdwn_ipCoinsurance[0]=[],f.deptSpecicityIpCoInsuranceService[0]=[],f.ipCoInsuranceGridOptions.data[0]={type:6})}else l.hisAlertMulti("warning",e.alertObjectRes.alertTypeWarn,"Please enter the Discount",!1,!1,e.close,2e3);else l.warning("warning","Please select primary service group")},f.setcopayGridEdit=function(e,t){var a;f.editId=t,1==e.type?a=angular.copy(f.defaultAuthGridOptions):2==e.type?a=angular.copy(f.ipCoPayGridOptions):3==e.type?a=angular.copy(f.opCoPayGridOptions):4==e.type?a=angular.copy(f.discountGridOptions):5==e.type?a=angular.copy(f.opCoInsuranceGridOptions):6==e.type&&(a=angular.copy(f.ipCoInsuranceGridOptions));for(var i=0;i<a.data.length;i++)a.data[i].isEditable=t==i;null!=e.servName&&(e.servName.SER_SEQ_ID||e.servName.SERV_SEQ_ID)&&(e.service=angular.copy(e.servName)),a.data[0]=angular.copy(e),1==e.type?(f.defaultAuthGridOptions=angular.copy(a),f.deptdwn_default[t]&&f.deptdwn_default[t].length>0?(f.deptdwn_default[0]=angular.copy(f.deptdwn_default[t]),f.deptSpecicityDefaultService[0]=angular.copy(f.deptSpecicityDefaultService[t])):f.fetchDepartmentList(e,t)):2==e.type?(f.ipCoPayGridOptions=angular.copy(a),f.deptdwn_ip[t]&&f.deptdwn_ip[t].length>0?(f.deptdwn_ip[0]=angular.copy(f.deptdwn_ip[t]),f.deptSpecicityIpService[0]=angular.copy(f.deptSpecicityIpService[t])):f.fetchDepartmentList(e,t)):3==e.type?(f.opCoPayGridOptions=angular.copy(a),f.deptdwn_op[0]=angular.copy(f.deptdwn_op[t]),f.deptSpecicityOpService[0]=angular.copy(f.deptSpecicityOpService[t])):4==e.type?(f.discountGridOptions=angular.copy(a),f.deptdwn_discount[t]&&f.deptdwn_discount[t].length>0?(f.deptdwn_discount[0]=angular.copy(f.deptdwn_discount[t]),f.deptSpecicityDiscountService[0]=angular.copy(f.deptSpecicityDiscountService[t])):f.fetchDepartmentList(e,t)):5==e.type?(f.opCoInsuranceGridOptions=angular.copy(a),f.deptdwn_opCoinsurance[0]=angular.copy(f.deptdwn_opCoinsurance[t]),f.deptSpecicityOpCoInsuranceService[0]=angular.copy(f.deptSpecicityOpCoInsuranceService[t])):6==e.type&&(f.ipCoInsuranceGridOptions=angular.copy(a),f.deptdwn_ipCoinsurance[0]=angular.copy(f.deptdwn_ipCoinsurance[t]),f.deptSpecicityIpCoinusuracService[0]=angular.copy(f.deptSpecicityDiscountService[t]))},f.deleteCopy=function(e,t){var a={buttonCallBack1:function(){},buttonCallBack2:function(){1==e.type?(f.defaultAuthGridOptions.data.splice(t,1),e.status=2,e.pdpaSeqId&&f.defaultData.push(e)):2==e.type?f.ipCoPayGridOptions.data.splice(t,1):3==e.type?f.opCoPayGridOptions.data.splice(t,1):4==e.type?(f.discountGridOptions.data.splice(t,1),e.status=2,e.discSeqId&&f.discountData.push(e)):5==e.type?f.opCoInsuranceGridOptions.data.splice(t,1):6==e.type&&f.ipCoInsuranceGridOptions.data.splice(t,1),4==e.type&&1==e.type||(e.status=2,e.copaySeqId&&f.copyData.push(e))},buttonClose:function(){}};l.hisAlertMulti("warning","Warning","Do You Want To Delete?",{buttonText:"No",buttonText2:"Yes"},a,a)},f.changeBedAmt=function(e,t,a){if(null!=e&&null!=e&&""!==e)return 2==t.apprIsAmtPercNl&&b(e,a),2==t.apprIsAmtPercNl&&parseFloat(e)>parseFloat(100)?100:0==e?void 0:e;2==t.apprIsAmtPercNl&&b(e,a)},f.addRmovColumnCoverGrid=function(e,t){var a={name:e.bedClassName.CODE+"",displayName:e.bedClassName.DESCRIPTION,cellTemplate:'<div class="ui-grid-cell-contents action-row" ng-if="row.entity.inclusion==1"><div class="" ng-if="row.entity.apprIsAmtPercNl!=3"><input type="text" class="form-control"  ng-model="MODEL_COL_FIELD" ng-change="MODEL_COL_FIELD=grid.appScope.cp.changeBedAmt(MODEL_COL_FIELD,row.entity,row)" numbers-with-decimal></div><span ng-if="row.entity.apprIsAmtPercNl==3">N/L</span></div><div ng-if="row.entity.inclusion==2" class="ui-grid-cell-contents">{{MODEL_COL_FIELD=undefined}}--</div>'};if(t){for(var i=0;i<f.planServicesGridOptions.columnDefs.length;i++)if(f.planServicesGridOptions.columnDefs[i].name==e.bedClassName.CODE){f.planServicesGridOptions.columnDefs.splice(i,1);break}}else f.planServicesGridOptions.columnDefs.splice(f.planServicesGridOptions.columnDefs.length-1,0,a)};var T={1:"primayServiceGroup",2:"department",3:"speciality",4:"service"};f.gridValidationForAddition=function(e,t,a){for(var i=!1,r=f.discountGridOptions.data,n=1;n<r.length&&n!=t;n++){for(var l=[],s=r[n].serviceHierarcyLevel,o=1;o<=s;o++){if(i=f.validate(e,r[n],T[o]),l.push(i),i&&1==a||i&&1==s)return!0;i=!1}var c=l.filter(function(e){return!0===e}).length;if(l.length==c||i&&a<s&&c-1==l.length-1||a<s&&c>=2)return!0}return i},f.validate=function(e,t,a){return null!=e[a]&&e[a].CODE==t[a].CODE},f.autoSearchOnDiagnosis=function(t,a){e.diagnosisList=[],e.multipleComboDataForList={1:e.diagnosisList};var i=u.executeQueryURLReset();let r=new Array;return u.prepareParamListWithParam("TYPE",1,r),u.prepareParamListWithParam("DIAG_CODE",2==a?t:"",r),u.prepareParamListWithParam("DIAG_DESC",1==a?t:"",r),u.executeQueryInput("USP_GET_DIAGNOSIS_DTLS",r,e.multipleComboDataForList,!0,!0,i,"popUp",{}).then(function(t){return e.diagnosisList.map(function(e){return e})})},f.clear=function(e){f.catFlag=e,I()},f.clonePlan=function(){i.open("CLONE PLAN",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/creditPayerMaster/credit.payer.clone.html",controller:"creditCloneCtrl",controllerAs:"clc",size:"md",resolve:{cpData:function(){return f.data}}}).result.then(function(e){if(f.data.clonePlan=e.planData,null==f.plansList)f.plansList=[];else for(let t=0;t<f.plansList.length;t++)if(f.plansList[t].INC_PLAN_SEQ_ID==e.planData.INC_PLAN_SEQ_ID)return!1;f.plansList.push(e.planData),f.data.plans=f.plansList[f.plansList.length-1],f.getDefaultPlanDetails(!0)})},I(),f.changeFacility=function(e){f.checkFlag=e,I()},f.childPlansChange=function(){if(f.planClear(),f.data.childPlan.length>0){if(f.data.payerName.INC_SEQ_ID&&f.spliceList.length>0)for(var e=0;e<f.spliceList.length;e++)for(var t=0;t<f.data.childPlan.length;t++)if(f.spliceList[e].PARENT_PLAN_SEQ_ID&&f.spliceList[e].PARENT_PLAN_SEQ_ID==f.data.childPlan[t].INC_PLAN_SEQ_ID){-1==_.findIndex(f.plansList,function(t){return t.INC_PLAN_SEQ_ID==f.spliceList[e].INC_PLAN_SEQ_ID})&&f.plansList.push(f.spliceList[e])}else{let e=_.findIndex(f.plansList,function(e){return e.INC_PLAN_SEQ_ID==f.data.childPlan[t].INC_PLAN_SEQ_ID});if(-1!=e){if(-1!=_.findIndex(f.plansList,function(e){return e.PARENT_PLAN_SEQ_ID==f.data.childPlan[t].INC_PLAN_SEQ_ID}))if(f.plansList[e].PARENT_PLAN_SEQ_ID){-1==_.findIndex(f.data.childPlan,function(t){return t.INC_PLAN_SEQ_ID==f.plansList[e].PARENT_PLAN_SEQ_ID})&&f.plansList.splice(e,1)}else{-1==_.findIndex(f.data.childPlan,function(t){return t.INC_PLAN_SEQ_ID==f.plansList[e].INC_PLAN_SEQ_ID})&&f.plansList.splice(e,1)}break}if(-1==_.findIndex(f.plansList,function(e){return e.PARENT_PLAN_SEQ_ID==f.data.childPlan[t].INC_PLAN_SEQ_ID})){f.plansList.push(f.data.childPlan[t]);break}}else f.plansList=f.data.childPlan;f.data.plans=f.plansList[0],f.getDefaultPlanDetails()}else{if(f.plansList.length>0&&f.data.payerName.INC_SEQ_ID)for(e=0;e<f.plansList.length;e++)for(t=0;t<f.plansChildList.length;t++)if(f.plansList[e].PARENT_PLAN_SEQ_ID&&f.plansList[e].PARENT_PLAN_SEQ_ID!=f.plansChildList[t].INC_PLAN_SEQ_ID){let t=_.findIndex(f.spliceList,function(t){return t==f.plansList[e].PARENT_PLAN_SEQ_ID});-1==t?f.spliceList.push(f.plansList[e].PARENT_PLAN_SEQ_ID):f.spliceList.splice(t,1)}f.plansList=[],f.data.plans=void 0}for(e=0;e<f.plansList.length;e++)if(f.plansList[e].PARENT_PLAN_SEQ_ID){if(-1==_.findIndex(f.data.childPlan,function(t){return t.INC_PLAN_SEQ_ID==f.plansList[e].PARENT_PLAN_SEQ_ID})){_.findIndex(f.data.childPlan,function(t){return t.INC_PLAN_SEQ_ID==f.plansList[e].PARENT_PLAN_SEQ_ID});f.plansList.splice(e,1)}}else{-1==_.findIndex(f.data.childPlan,function(t){return t.INC_PLAN_SEQ_ID==f.plansList[e].INC_PLAN_SEQ_ID})&&f.plansList.splice(e,1)}},f.validateGrid=function(e,t){1==t&&e.entity.approvedAmount&&parseFloat(e.entity.approvedAmount)>parseFloat(100)?e.entity.approvedAmount=100:2==t&&e.entity.copayment&&parseFloat(e.entity.copayment)>parseFloat(100)?e.entity.copayment=100:3==t&&e.entity.discount&&parseFloat(e.entity.discount)>parseFloat(100)?e.entity.discount=100:4==t&&e.entity.coInsurance&&parseFloat(e.entity.coInsurance)>parseFloat(100)?e.entity.coInsurance=100:5==t&&parseFloat(f.data.planDetails.coInsuranceOpValue)>parseFloat(100)?f.data.planDetails.coInsuranceOpValue=100:6==t&&parseFloat(f.data.planDetails.coInsuranceIpValue)>parseFloat(100)&&(f.data.planDetails.coInsuranceIpValue=100)},f.insurancePayer=function(e){1==e&&2==f.data.payerTypeInsurer?f.data.insurance=f.insuranceList[0].INC_SEQ_ID:2==e&&2==f.data.payerTypeTpa?f.data.tpa=f.insuranceList[0].INC_SEQ_ID:3==e&&2==f.data.payerTypeTpa&&(f.data.other=""),1==f.data.payerTypeTpa&&2==f.data.payerTypeInsurer&&2==f.data.payerTypeOther?(f.disableFieldsForTPA=!0,2==f.data.payerCategory&&(f.data.billingTo={},f.data.claimAutherization={})):f.disableFieldsForTPA=!1},f.hierarchyLevelAddYFlag=function(e){var t="",a=0,i=0;return angular.forEach(e,function(r,n){if(0!=i&&t!=r.psgCode&&(a=r.serviceHierarchyLevel),t=r.psgCode,0==i&&(a=r.serviceHierarchyLevel),t==r.psgCode&&1==r.serviceHierarchyLevel&&(r.inclusionApply="Y"),t==r.psgCode&&2==r.serviceHierarchyLevel){let t=n-1;a!=r.serviceHierarchyLevel&&(e[t].serviceHierarchyLevel<=r.serviceHierarchyLevel&&-1!=t&&delete e[t].inclusionApply,a=r.serviceHierarchyLevel),r.inclusionApply="Y"}if(t==r.psgCode&&3==r.serviceHierarchyLevel){let t=n-1;a!=r.serviceHierarchyLevel&&(e[t].serviceHierarchyLevel<=r.serviceHierarchyLevel&&-1!=t&&delete e[t].inclusionApply,a=r.serviceHierarchyLevel),r.inclusionApply="Y"}if(t==r.psgCode&&4==r.serviceHierarchyLevel){let t=n-1;a!=r.serviceHierarchyLevel&&(-1!=t&&delete e[t].inclusionApply,a=r.serviceHierarchyLevel),r.inclusionApply="Y"}i++}),e},f.matHierarchyLevelAddYFlag=function(e){var t="",a=0,i=0;return angular.forEach(e,function(r,n){if(0!=i&&t!=r.mtrlPriCode&&(a=r.mtrlHierarchyLevel),t=r.mtrlPriCode,0==i&&(a=r.mtrlHierarchyLevel),t==r.mtrlPriCode&&1==r.mtrlHierarchyLevel&&(r.inclusionApply="Y"),t==r.mtrlPriCode&&2==r.mtrlHierarchyLevel){let t=n-1;a!=r.mtrlHierarchyLevel&&(e[t].mtrlHierarchyLevel<=r.mtrlHierarchyLevel&&-1!=t&&delete e[t].inclusionApply,a=r.mtrlHierarchyLevel),r.inclusionApply="Y"}if(t==r.mtrlPriCode&&3==r.mtrlHierarchyLevel){let t=n-1;a!=r.mtrlHierarchyLevel&&(e[t].mtrlHierarchyLevel<=r.mtrlHierarchyLevel&&-1!=t&&delete e[t].inclusionApply,a=r.mtrlHierarchyLevel),r.inclusionApply="Y"}if(t==r.mtrlPriCode&&4==r.mtrlHierarchyLevel){let t=n-1;a!=r.mtrlHierarchyLevel&&(-1!=t&&delete e[t].inclusionApply,a=r.mtrlHierarchyLevel),r.inclusionApply="Y"}i++}),e},f.childPlanSelection=function(){for(let e=0;e<f.plansChildList.length;e++)for(let t=0;t<f.plansList.length;t++)if(f.plansList[t].INC_PLAN_ID==f.plansChildList[e].INC_PLAN_ID){f.data.childPlan.push(f.plansChildList[e]);break}},this.changeCoverType=function(t){let a=4==e.activeFirst?f.planServicesGridOptions.data.length:f.servicesGridOptions.data.length;for(let i=0;i<a;i++)4==e.activeFirst?f.planServicesGridOptions.data[i].inclusion=parseInt(t):f.servicesGridOptions.data[i].inclusion=parseInt(t)},f.fetchDepartmentList=function(e,t){if(1==e.type)var a={1:f.deptdwn_default[t]=[]};else if(2==e.type)a={1:f.deptdwn_ip[t]=[]};else if(4==e.type)a={1:f.deptdwn_discount[t]=[]};let i=u.executeQueryURLReset(),r=new Array;if(u.prepareParamListWithParam("pMetSubCatSeqId",e.primayServiceGroup?e.primayServiceGroup.CODE:-999,r),u.prepareParamListWithParam("pPSG_CODE",e.primayServiceGroup?e.primayServiceGroup.CODE:-999,r),u.prepareParamListWithParam("pPRACTICEID",f.data.facilityId,r),e.primayServiceGroup&&"Y"==e.primayServiceGroup.IS_MATERIAL)var n="FETCH_MAT_GROUP";else n="BL_GET_DEPARTMENT_SEARCH_SP";u.executeQueryInput(n,r,a,!0,!0,i,"popUp",{}).then(function(a){if(a){1==e.type?(f.deptdwn_default[0]=angular.copy(f.deptdwn_default[t]),f.specilityMap={1:f.deptSpecicityDefaultService[t]=[]}):2==e.type?(f.deptdwn_ip[0]=angular.copy(f.deptdwn_ip[t]),f.specilityMap={1:f.deptSpecicityIpService[t]=[]}):4==e.type&&(f.deptdwn_discount[0]=angular.copy(f.deptdwn_discount[t]),f.specilityMap={1:f.deptSpecicityDiscountService[t]=[]});var i=u.executeQueryURLReset(),r=new Array;if(u.prepareParamListWithParam("pPSG_CODE",e.primayServiceGroup?e.primayServiceGroup.CODE:-999,r),u.prepareParamListWithParam("pDEPT_CODE",e.department?e.department.CODE:-999,r),u.prepareParamListWithParam("pMetMainCatSeqId",e.department?e.department.CODE:-999,r),u.prepareParamListWithParam("pPRACTICEID",f.data.facilityId,r),e.primayServiceGroup&&"Y"==e.primayServiceGroup.IS_MATERIAL)var n="FETCH_MAT_SUB_GROUP";else n="BL_GET_SPECIALITY_SEARCH_SP";u.executeQueryInput(n,r,f.specilityMap,!0,!0,i,"popUp",{}).then(function(a){a&&(1==e.type?f.deptSpecicityDefaultService[0]=angular.copy(f.deptSpecicityDefaultService[t]):2==e.type?f.deptSpecicityIpService[0]=angular.copy(f.deptSpecicityIpService[t]):4==e.type&&(f.deptSpecicityDiscountService[0]=angular.copy(f.deptSpecicityDiscountService[t])))})}})},f.setInclusioValue=function(e){return 1==e.level?e.departTreeList&&e.departTreeList.length>0?e.departTreeList[0].inclusion?e.departTreeList[0].inclusion+"":e.inclusion?e.inclusion+"":"1":"1":2==e.level?e.specltyTreeList&&e.specltyTreeList.length>0?e.specltyTreeList[0].inclusion?e.specltyTreeList[0].inclusion+"":e.inclusion?e.inclusion+"":"1":"1":3==e.level?e.srivceTreeList&&e.srivceTreeList.length>0?e.srivceTreeList[0].inclusion?e.srivceTreeList[0].inclusion+"":e.inclusion?e.inclusion+"":"1":"1":void 0},f.clearApprovedAmount=function(e){e.entity.approvedAmount=void 0,e.entity.quantity=void 0}}e.$inject=["$scope","inclusionGridConstants","bedClassGridConstants","hisModalService","hisConfigurationService","patPermanentRegistrationService","hisAlertService","hisGenericAlertService","creditPayerService","creditServiceGridConstants","hisTranslationsService","hisTranslationsGlobalLang","QueryService","hisCalDefConstant","coPayGridConstants","diagnosisGridConstants","hisAlertConstants","RoleTaskService","uibDatepickerConfig"],angular.module("napierContainerUi").controller("creditPayerMasterCtrl",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("demandNoteWorklistGridDefn",{enableHorizontalScrollbar:2,enableCellEditOnFocus:!1,enableRowSelection:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,multiSelect:!0,enableFiltering:!1,enableSorting:!1,columnDefs:[{name:"floorDescription",displayName:"Floor Description",pinnedLeft:!0,width:120},{name:"demandNoteNumber",displayName:"Demand Note No",pinnedLeft:!0,width:120},{name:"demandNotedate.$",displayName:"Demand Date",width:120,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.demandNotedate.$ | date :"dd-MM-yyyy hh:mm a"}}</div>'},{name:"ipNumber",displayName:"IP Number",width:80},{name:"firstName",displayName:"Patient Name",width:160},{name:"totalServiceAmount",displayName:"Total Service Amount",width:120},{name:"totalDepositAmount",displayName:"Total Deposit Amount",width:120},{name:"secu",displayName:"Security Deposit",width:120},{name:"cred",displayName:"Credit Pre Auth Amount",width:120},{name:"demandNoteAmount",displayName:"Demand Note Amount",width:120},{name:"demandNoteStatusDescription",displayName:"Status",width:120}]})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p){var u=this;c.loadModule("billing");var m=d.getLanguageToSet();function g(){u.floorWise="0",u.demNoteDateObj={fromDate:new Date,toDate:new Date},u.demNoteObj={patientName:"",patientIpNo:"",floorWiseCode:""},u.demandNoteStatus=-999,u.demandNotegridOptions.columnDefs[0].visible=!1,u.format=e.comDateformat.dateOnlySlash.format,u.frmDateOptions={maxDate:new Date},u.toDateOptions={minDate:new Date},u.demandNotegridOptions.data=[]}c.changeLanguage(m),e.contextInfo=JSON.parse(sessionStorage.getItem("userContextObj")),u.demandNotegridOptions=angular.copy(a),e.comDateformat=angular.copy(p),e.popup1={opened:!1},e.popup2={opened:!1},e.open1=function(){e.popup1.opened=!0},e.open2=function(){e.popup2.opened=!0},function(){e.florlist=[],e.floorList={1:e.florlist};var t=r.executeQueryURLReset(),a=new Array;r.prepareParamListWithParam("pPracticeId",e.contextInfo.CLIENT_REF_ID,a),r.executeQueryInput("DEMAND_NOTE_FLOOR_SEARCH001",a,e.floorList,!0,!0,t,"popUp",{}).then(function(t){e.floorList=t[1]})}(),g(),u.chgFromDt=function(e){u.toDateOptions={minDate:e}},u.loadDemandNoteWorklist=function(){if(u.demandNotegridOptions.data=[],"1"==u.floorWise){var e="getFloorWiseDemandNotes";delete u.demNoteObj.demandNoteStatus,u.demandNotegridOptions.columnDefs[0].visible=!0}if("0"==u.floorWise){u.demNoteObj.demandNoteStatus=u.demandNoteStatus;e="getDemandNotes"}if(""==u.demNoteDateObj.fromDate||""==u.demNoteDateObj.toDate||null==u.demNoteDateObj.fromDate||null==u.demNoteDateObj.toDate)n.warning("Warning","Date range is required",!1,!1,l.time);else if(moment(u.demNoteDateObj.fromDate)>moment(u.demNoteDateObj.toDate))n.warning("Warning","To Date greater than From Date",!1,!1,l.time);else{let t=moment(u.demNoteDateObj.fromDate).format("YYYY-MM-DD");u.demNoteObj.fromDate=t+"T00:00:00.000Z";let a=moment(u.demNoteDateObj.toDate).format("YYYY-MM-DD");u.demNoteObj.toDate=a+"T23:59:59.000Z",u.demnotePatName&&(u.demNoteObj.patientName="%"+u.demnotePatName+"%"),u.demNoteObj["@class"]="com.napier.core.demandnote.vo.DemandNoteInput",i.getGridData(u.demNoteObj,e).then(function(e){if(""==e.data.HITService.message.demandNoteDataList[0])n.warning("Warning","No Records Found",!1,!1,l.time),u.demandNotegridOptions.data=[];else{var t=e.data.HITService.message.demandNoteDataList[0]["com.napier.core.demandnote.vo.DemandNoteData"],a=Array.isArray(t)?t:[t];u.demandNotegridOptions.data=a}})}},e.openNew=function(e){t.open("Deposit New",{animation:!0,templateUrl:"app/consumer/his17_1/common/deposit-requests/add.deposit.request.modal.html",size:e})},u.clear=function(){g()},u.demandNotegridOptions.onRegisterApi=function(e){u.gridApiselectPat=e,e.selection.on.rowSelectionChanged(u,function(e){e.isSelected})},u.demNotePost=function(){u.rowsSelected=u.gridApiselectPat.selection.getSelectedRows(),0!=u.rowsSelected.length?angular.forEach(u.rowsSelected,function(e,t){if("Unposted"==e.demandNoteStatusDescription){var a={"@class":"com.napier.core.demandnote.vo.DemandNoteList",demandNoteList:[{"com.napier.core.demandnote.vo.DemandNote":[{demandNoteSeqId:e.demandNoteSeqId,floorCode:e.floorCode}]}]};i.postDemandNote(a).then(function(e){n.success("Success","Post Successfully.",!1,!1,l.time),u.loadDemandNoteWorklist()})}"Posted"==e.demandNoteStatusDescription&&n.warning("Warning","Please select valid Unposted Record",!1,!1,l.time)}):n.warning("Warning","Record must be select",!1,!1,l.time)},u.viewPrint=function(){if(u.rowsSelected=u.gridApiselectPat.selection.getSelectedRows(),0!=u.rowsSelected.length)if(u.rowsSelected[0].demandNoteNumber){o.demdnotNO=u.rowsSelected[0].demandNoteNumber;s.printReportModal("demandNotePrintCtrl","lg","PDF")}else n.warning("Warning","Please select valid patient.",!1,!1,l.time);else n.warning("Warning","Record must be select.",!1,!1,l.time)}}e.$inject=["$scope","hisModalService","demandNoteWorklistGridDefn","demandNoteService","QueryService","hisAlertService","hisAlertConstants","PrintService","$rootScope","hisTranslationsService","hisTranslationsGlobalLang","hisCalDefConstant"],angular.module("napierContainerUi").controller("demandNoteCntr",e)}(),angular.module("napierContainerUi").controller("demandNotePrintCtrl",["$uibModalInstance","selectedPrintType","QueryService","PrintService","$rootScope","$scope",function(e,t,a,i,r,n){n.pageName="Print",n.cancel=function(){e.dismiss("cancel")},n.printParameterList=new Array,a.prepareParamList("pDemandnoteNo",r.demdnotNO,n.printParameterList),n.printObject={},n.printObject.reportId="DemandNoteReportId",n.printObject.reportType={id:"PDF"==t?4:5,desc:t},n.printObject.paramsList=n.printParameterList,n.printObject.destination="reportingServiceImpl",i.printReportFunction(n.printObject,n)}]),function(){"use strict";function e(e,t){this.getGridData=function(a,i){var r={};return r.url=e.HISDEPOSITSEARCH.URL,r.requestData={operation:i,destination:"com.napier.core.demandnote.service.external.DemandNoteService",message:a},t.sendRestRequest(r)},this.postDemandNote=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"updateDemandNote",destination:"com.napier.core.demandnote.service.external.DemandNoteService",message:a},t.sendRestRequest(i)},this.cancleInvoice=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"cancelInvoice",destination:"com.napier.core.invoicesettlement.service.external.InvoiceService",message:a},t.sendRestRequest(i)}}e.$inject=["BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("demandNoteService",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p){s.loadModule("billing"),s.changeLanguage("en");var u=this;function m(){u.fromDateOptionsSearch={minDate:new Date},u.clear();var e={1:u.tariffCatList=[],2:u.depTariffCatList=[]},t=n.executeQueryURLReset(),a=new Array,i=new Array;n.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,i),n.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,a),n.executeQueryInput("PARENT_TARIFF_DROP_DOWN",i,e,!0,!1,t,"popUp"),n.executeQueryInput("DEP_TARIFF_DROP_DOWN",a,e,!0,!0,t,"popUp"),function(){var e={1:u.dependencyList=[]},t=n.executeQueryURLReset(),a=new Array;n.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a),n.prepareParamListWithParam("pParentTariff",-999,a),n.prepareParamListWithParam("pParentPriServ",-999,a),n.prepareParamListWithParam("pParentPatType",-999,a),n.prepareParamListWithParam("pParentBedType",-999,a),n.prepareParamListWithParam("pTarrif",-999,a),n.prepareParamListWithParam("pPriServ",-999,a),n.prepareParamListWithParam("pPatType",-999,a),n.prepareParamListWithParam("pBedType",-999,a),n.executeQueryInput("GET_DEPENDENCY_LIST",a,e,!0,!0,t,"popUp",u.gridOptions).then(function(e){e[1][0]&&(u.gridOptions.data=angular.copy(u.dependencyList))})}()}u.format=angular.copy(i.uibDateOnly.format),u.gridOptions=angular.copy(e),u.gridOptions.data=[],delete r.ngModelOptions.timezone,u.getDependentPatientTypeList=function(){var e={1:u.dependentPatientTypeList=[]},t=n.executeQueryURLReset(),a=new Array;n.prepareParamListWithParam("pTariffCode",u.data.TARRIF_CATG_CODE,a),n.prepareParamListWithParam("pPrimeryServCode",u.data.PRI_SERV_TYPE_CODE?u.data.PRI_SERV_TYPE_CODE:-999,a),n.executeQueryInput("DEP_PATIENT_TYPE_DROP_DOWN",a,e,!0,!0,t,"popUp").then(function(e){e[1][0]&&u.editData&&(u.data=u.editData)})},u.roleTask=p.rolePermission("T_BL_M_TARIFF_DEPENDENCY"),u.getDependentBedList=function(){var e={1:u.dependentBedList=[]},t=n.executeQueryURLReset(),a=new Array;n.prepareParamListWithParam("pPrimeryServCode",u.data.PRI_SERV_TYPE_CODE?u.data.PRI_SERV_TYPE_CODE:-999,a),n.prepareParamListWithParam("pPatType",u.data.PATIENT_TYPE?u.data.PATIENT_TYPE:-999,a),n.prepareParamListWithParam("pTariffCode",u.data.TARRIF_CATG_CODE?u.data.TARRIF_CATG_CODE:-999,a),n.executeQueryInput("DEP_BED_CLASS_DROP_DOWN",a,e,!0,!0,t,"popUp").then(function(e){e[1][0]&&u.editData&&(u.data=u.editData)})},u.getDependentServiceList=function(){var e={1:u.dependentServiceList=[]},t=n.executeQueryURLReset(),a=(new Array,new Array);n.prepareParamListWithParam("pTariffCode",u.data.TARRIF_CATG_CODE,a),n.executeQueryInput("DEP_PRIMARY_DROP_DOWN",a,e,!0,!0,t,"popUp").then(function(e){e[1][0]&&u.editData&&(u.data=u.editData)})},u.getParentPatientTypeList=function(){var e={1:u.patientTypeList=[]},t=n.executeQueryURLReset(),a=new Array;n.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a),n.prepareParamListWithParam("pTariffCode",u.data.PARENT_TARRIF_CATG_CODE,a),n.prepareParamListWithParam("pPrimeryServCode",u.data.PARENT_PRI_SERV_TYPE_CODE?u.data.PARENT_PRI_SERV_TYPE_CODE:-999,a),n.executeQueryInput("PARENT_PAT_TYPE_DROP_DOWN",a,e,!0,!0,t,"popUp").then(function(e){e[1][0]&&u.editData&&(u.data=u.editData)})},u.getParentBedList=function(){var e={1:u.bedClassList=[]},t=n.executeQueryURLReset(),a=new Array;n.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a),n.prepareParamListWithParam("pPrimeryServCode",u.data.PARENT_PRI_SERV_TYPE_CODE?u.data.PARENT_PRI_SERV_TYPE_CODE:-999,a),n.prepareParamListWithParam("pPatType",u.data.PARENT_PATIENT_TYPE?u.data.PARENT_PATIENT_TYPE:-999,a),n.prepareParamListWithParam("pTariffCode",u.data.PARENT_TARRIF_CATG_CODE?u.data.PARENT_TARRIF_CATG_CODE:-999,a),n.executeQueryInput("PARENT_BED_CLASS_DROP_DOWN",a,e,!0,!0,t,"popUp").then(function(e){e[1][0]&&u.editData&&(u.data=u.editData)})},u.getParentServiceList=function(){var e={1:u.primaryServiceList=[]},t=n.executeQueryURLReset(),a=new Array;n.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a),n.prepareParamListWithParam("pTariffCode",u.data.PARENT_TARRIF_CATG_CODE,a),n.executeQueryInput("PARENT_PRIMERY_DROP_DOWN",a,e,!0,!0,t,"popUp").then(function(e){e[1][0]&&u.editData&&(u.data=u.editData)})},u.clear=function(){delete u.editData,u.data={EFFETIVE_FROM:new Date,Percentage_Increase_Decrease:"1"},u.fromDateOptionsSearch={minDate:new Date}},u.saveDependency=function(e){if(!e){if(u.data.TARRIF_CATG_CODE==u.data.PARENT_TARRIF_CATG_CODE&&u.data.PRI_SERV_TYPE_CODE==u.data.PARENT_PRI_SERV_TYPE_CODE&&u.data.PATIENT_TYPE==u.data.PARENT_PATIENT_TYPE&&u.data.BED_CLASS_ID==u.data.PARENT_BED_CLASS_ID)return void o.information("Information","Please Select different Scenario");if(u.data.TARRIF_CATG_CODE==u.data.PARENT_TARRIF_CATG_CODE&&u.data.PRI_SERV_TYPE_CODE==u.data.PARENT_PRI_SERV_TYPE_CODE&&u.data.PATIENT_TYPE==u.data.PARENT_PATIENT_TYPE&&!u.data.BED_CLASS_ID)return void o.information("Information","Please Select different Scenario");if(u.data.TARRIF_CATG_CODE==u.data.PARENT_TARRIF_CATG_CODE&&u.data.PRI_SERV_TYPE_CODE==u.data.PARENT_PRI_SERV_TYPE_CODE&&!u.data.PATIENT_TYPE&&!u.data.BED_CLASS_ID)return void o.information("Information","Please Select different Scenario");if(u.data.TARRIF_CATG_CODE==u.data.PARENT_TARRIF_CATG_CODE&&!u.data.PRI_SERV_TYPE_CODE&&!u.data.PATIENT_TYPE&&!u.data.BED_CLASS_ID)return void o.information("Information","Please Select different Scenario");if(u.data.PRI_SERV_TYPE_CODE&&!u.data.PARENT_PRI_SERV_TYPE_CODE)return void o.information("Information","Please Select Parent Primary Service");if(u.data.PATIENT_TYPE&&!u.data.PARENT_PATIENT_TYPE)return void o.information("Information","Please Select Parent Patient Type");if(u.data.BED_CLASS_ID&&!u.data.PARENT_BED_CLASS_ID)return void o.information("Information","Please Select Parent Bed Class");if(10003!=u.data.PRI_SERV_TYPE_CODE&&10004!=u.data.PRI_SERV_TYPE_CODE&&10018!=u.data.PRI_SERV_TYPE_CODE&&10023!=u.data.PRI_SERV_TYPE_CODE){if(u.data.PRI_SERV_TYPE_CODE!=u.data.PARENT_PRI_SERV_TYPE_CODE)return void o.information("Information","Please Select Same Primary Service")}else if(10024!=u.data.PARENT_PRI_SERV_TYPE_CODE)return void o.information("Information","Please Select Parent Primary Service as a Surgery")}if(!e&&u.dependencyList.length>0)for(var t=0;t<u.dependencyList.length;t++)if(!u.dependencyList[t].isEditable&&10024!=u.data.PARENT_PRI_SERV_TYPE_CODE&&u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE){if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.dependencyList[t].TARRIF_CATG_CODE&&u.dependencyList[t].PRI_SERV_TYPE_CODE&&u.dependencyList[t].PATIENT_TYPE&&u.dependencyList[t].BED_CLASS_ID&&!u.data.BED_CLASS_ID)return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.dependencyList[t].TARRIF_CATG_CODE&&u.dependencyList[t].PATIENT_TYPE&&u.dependencyList[t].BED_CLASS_ID&&!u.data.BED_CLASS_ID)return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.dependencyList[t].TARRIF_CATG_CODE&&u.dependencyList[t].PRI_SERV_TYPE_CODE&&u.dependencyList[t].PATIENT_TYPE&&u.data.BED_CLASS_ID)return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.dependencyList[t].TARRIF_CATG_CODE&&u.dependencyList[t].PRI_SERV_TYPE_CODE&&!u.data.PRI_SERV_TYPE_CODE)return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.dependencyList[t].TARRIF_CATG_CODE&&u.dependencyList[t].PRI_SERV_TYPE_CODE&&!u.dependencyList[t].PATIENT_TYPE&&(u.data.PATIENT_TYPE||u.data.BED_CLASS_ID))return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.data.PRI_SERV_TYPE_CODE&&u.data.PRI_SERV_TYPE_CODE==u.dependencyList[t].PRI_SERV_TYPE_CODE&&u.data.PATIENT_TYPE&&u.data.PATIENT_TYPE==u.dependencyList[t].PATIENT_TYPE&&u.data.BED_CLASS_ID&&u.data.BED_CLASS_ID==u.dependencyList[t].BED_CLASS_ID)return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.data.PRI_SERV_TYPE_CODE&&u.data.PRI_SERV_TYPE_CODE==u.dependencyList[t].PRI_SERV_TYPE_CODE&&u.data.PATIENT_TYPE&&u.data.PATIENT_TYPE==u.dependencyList[t].PATIENT_TYPE&&!u.data.BED_CLASS_ID&&!u.dependencyList[t].BED_CLASS_ID)return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.data.PRI_SERV_TYPE_CODE&&u.data.PRI_SERV_TYPE_CODE==u.dependencyList[t].PRI_SERV_TYPE_CODE&&u.data.PATIENT_TYPE&&u.data.PATIENT_TYPE==u.dependencyList[t].PATIENT_TYPE&&!u.data.BED_CLASS_ID&&u.dependencyList[t].BED_CLASS_ID)return void o.information("Information","Dependency already defined");if(!(u.data.TARRIF_CATG_CODE!=u.dependencyList[t].TARRIF_CATG_CODE||!u.data.PRI_SERV_TYPE_CODE||u.data.PRI_SERV_TYPE_CODE!=u.dependencyList[t].PRI_SERV_TYPE_CODE||u.dependencyList[t].BED_CLASS_ID||u.dependencyList[t].PATIENT_TYPE||u.data.BED_CLASS_ID||u.data.PATIENT_TYPE))return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.data.PRI_SERV_TYPE_CODE&&u.data.PRI_SERV_TYPE_CODE==u.dependencyList[t].PRI_SERV_TYPE_CODE&&u.dependencyList[t].PATIENT_TYPE&&!u.data.PATIENT_TYPE)return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.data.PRI_SERV_TYPE_CODE&&u.data.PRI_SERV_TYPE_CODE==u.dependencyList[t].PRI_SERV_TYPE_CODE&&!u.dependencyList[t].BED_CLASS_ID&&!u.dependencyList[t].PATIENT_TYPE&&!u.data.BED_CLASS_ID&&u.data.PATIENT_TYPE)return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.data.PRI_SERV_TYPE_CODE&&u.data.PRI_SERV_TYPE_CODE==u.dependencyList[t].PRI_SERV_TYPE_CODE&&!u.dependencyList[t].BED_CLASS_ID&&!u.dependencyList[t].PATIENT_TYPE&&u.data.BED_CLASS_ID&&!u.data.PATIENT_TYPE)return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.data.PRI_SERV_TYPE_CODE&&u.data.PRI_SERV_TYPE_CODE==u.dependencyList[t].PRI_SERV_TYPE_CODE&&!u.dependencyList[t].BED_CLASS_ID&&!u.dependencyList[t].PATIENT_TYPE&&u.data.BED_CLASS_ID&&u.data.PATIENT_TYPE)return void o.information("Information","Dependency already defined");if(!(u.data.TARRIF_CATG_CODE!=u.dependencyList[t].TARRIF_CATG_CODE||!u.data.PATIENT_TYPE||u.data.PATIENT_TYPE!=u.dependencyList[t].PATIENT_TYPE||u.dependencyList[t].BED_CLASS_ID||u.dependencyList[t].PRI_SERV_TYPE_CODE||u.data.BED_CLASS_ID||u.data.PRI_SERV_TYPE_CODE))return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&u.data.BED_CLASS_ID&&u.data.BED_CLASS_ID==u.dependencyList[t].BED_CLASS_ID)return void o.information("Information","Dependency already defined");if(u.data.TARRIF_CATG_CODE==u.dependencyList[t].TARRIF_CATG_CODE&&!u.dependencyList[t].BED_CLASS_ID&&!u.dependencyList[t].PATIENT_TYPE&&!u.dependencyList[t].PRI_SERV_TYPE_CODE&&10024!=u.data.PARENT_PRI_SERV_TYPE_CODE)return void o.information("Information","Dependency already defined")}var a={depSeqId:(e=e?angular.copy(e):angular.copy(u.data)).TARIFF_PRICE_DEPID?e.TARIFF_PRICE_DEPID:void 0,tariffCategory:e.TARRIF_CATG_CODE,priServGroup:e.PRI_SERV_TYPE_CODE?e.PRI_SERV_TYPE_CODE:void 0,patientType:e.PATIENT_TYPE?e.PATIENT_TYPE:void 0,bedClass:e.BED_CLASS_ID?e.BED_CLASS_ID:void 0,parentTariffCategory:e.PARENT_TARRIF_CATG_CODE,parentPriServGroup:e.PARENT_PRI_SERV_TYPE_CODE?e.PARENT_PRI_SERV_TYPE_CODE:void 0,parentPatientType:e.PARENT_PATIENT_TYPE?e.PARENT_PATIENT_TYPE:void 0,parentBedClass:e.PARENT_BED_CLASS_ID?e.PARENT_BED_CLASS_ID:void 0,definePer:parseInt(e.PERCENTAGE),effectiveFrom:moment(e.EFFETIVE_FROM).format("YYYY-MM-DD 00:00:00.000"),roundOf:e.ROUNDOFF?e.ROUNDOFF:void 0,defineIncDesc:parseInt(e.Percentage_Increase_Decrease),gnStatus:e.GN_STATUS?e.GN_STATUS:1};c.saveDependencyService([a]).then(function(e){if(e.data.HITService.message&&e.data.HITService.message.errorCode)o.failure("Failure",e.data.HITService.message.errorMessage);else if(e.data.HITService.message&&e.data.HITService.message.dependencyVosList.length>0&&e.data.HITService.message.dependencyVosList[0]["com.napier.core.service.vo.DependencyVo"]){var t={1:u.depetServiceList=[]},a=n.executeQueryURLReset(),i=new Array;n.prepareParamListWithParam("@FACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,i),n.prepareParamListWithParam("@PRACTICE_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,i),n.prepareParamListWithParam("@TARIFF_PRICE_DEPID",e.data.HITService.message.dependencyVosList[0]["com.napier.core.service.vo.DependencyVo"].depSeqId,i),n.executeQueryInput("DEPENDENT_DATA_INSERT",i,t,!0,!0,a,"popUp",{}).then(function(e){if(e[1][0]){if(1!=u.depetServiceList[0].CNT)return void o.information("Information","Dependency already defined");u.activeCheck||(o.success("Success",u.data.TARIFF_PRICE_DEPID?"Record Updated Successfully":"Record Saved Successfully"),m(),delete u.activeCheck)}})}else o.information("Information","Something went wrong")})},u.editGrid=function(e,t){delete u.data,u.data=angular.copy(e),u.editData=angular.copy(e);t=_.findIndex(u.gridOptions.data,function(t){return t.TARIFF_PRICE_DEPID==e.TARIFF_PRICE_DEPID});for(var a=0;a<u.gridOptions.data.length;a++)a==t?(u.gridOptions.data[a].isEditable=!0,u.dependencyList[a].isEditable=!0):(u.gridOptions.data[a].isEditable=!1,u.dependencyList[a].isEditable=!1);u.data.EFFETIVE_FROM=angular.copy(new Date(e.EFFETIVE_FROM)),u.fromDateOptionsSearch.minDate=new Date(u.data.EFFETIVE_FROM),u.data.Percentage_Increase_Decrease=angular.copy(_.toString(e.Percentage_Increase_Decrease)),u.editData.EFFETIVE_FROM=angular.copy(new Date(e.EFFETIVE_FROM)),u.editData.Percentage_Increase_Decrease=angular.copy(_.toString(e.Percentage_Increase_Decrease)),u.getDependentServiceList(),u.getParentServiceList(),u.getDependentPatientTypeList(),u.getDependentBedList(),u.getParentPatientTypeList(),u.getParentBedList()},u.quickSearchGrid=function(){u.gridOptions.data=d("filter")(u.dependencyList,{DEPENDENT:u.quickSearch},void 0)},u.checkActive=function(e){1==e?(u.data.PRI_SERV_TYPE_CODE=angular.copy(""),u.data.BED_CLASS_ID=angular.copy(""),u.data.PATIENT_TYPE=angular.copy("")):2==e?(u.data.BED_CLASS_ID=angular.copy(""),u.data.PATIENT_TYPE=angular.copy("")):3==e?u.data.BED_CLASS_ID=angular.copy(""):4==e?(u.data.PARENT_PRI_SERV_TYPE_CODE=angular.copy(""),u.data.PARENT_PATIENT_TYPE=angular.copy(""),u.data.PARENT_BED_CLASS_ID=angular.copy("")):5==e?(u.data.PARENT_PATIENT_TYPE=angular.copy(""),u.data.PARENT_BED_CLASS_ID=angular.copy("")):6==e&&(u.data.PARENT_BED_CLASS_ID=angular.copy(""))},m()}e.$inject=["dependencyGridDefinition","$scope","$state","hisCalDefConstant","uibDatepickerConfig","QueryService","hisTranslationsGlobalLang","hisTranslationsService","hisAlertService","dependencyService","$filter","RoleTaskService"],angular.module("napierContainerUi").controller("dependencyController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m){var g=this;c.loadModule("billing");var S=d.getLanguageToSet();c.changeLanguage(S),p.loadAlerts(S).then(function(e){t.myObj=e,t.close={buttonClose:function(){}}}),g._=_,g.facilityComboObj=[],g.servicetypeComboObj=[],g.applicableComboObj=[],g.gridDataArray=[],g.tariffComboObj=[],g.deptComboObj=[],g.subDeptComboObj=[],g.oneAtATime=!1,g.oneAtATime=!1,g.status1=!0,g.status2=!1,g.serviceSelected=!1,g.departmentChanged=!1,g.editmode=!1,g.typeStatus=1,g.autoCompleteName=[],g.autoCompleteServiceName=[],g.autoCompleteServiceCode=[],g.CheckActivemapping=!0,g.isApplyToAllDisable=!0,g.tariffCategoryForRCV=[];var v=[],D=[],y=[];function f(){g.depositAmount="",g.isApplyToAllDisable=!0}g.show=function(){g.facility="",g.dept="",g.deptComboObj=[],g.subDept="",g.subDeptComboObj=[],g.serviveName="",g.serviceNamesComboObj=[],g.tariffclass="",g.tariffClassObj=[],g.depositName="",g.description="",g.servicetype="",g.availableto="",g.tariff="",g.clone="",g.serviceSearch&&(g.serviceSearch.dept="",g.serviceSearch.subDept="",g.serviceSearch.serviceName="",g.serviceSearch.serviceCode="",g.serviceSearch.tariff=""),g.formGridOptions.data=[],g.status1=!1,g.status2=!0,g.isEditMode=!1,g.operation.isUpdate=!1,g.operation.name="Save",g.remarks="",g.servicetype="",g.serviceTypeChange(g.servicetype),f()},g.gridOptions=angular.copy(r),g.formGridOptions=angular.copy(n),g.formGridOptions.onRegisterApi=function(e){g.grid1Api=e,g.grid1Api.grid.registerRowsProcessor(g.singleFilter,200)},g.serviceGridSearch=function(){g.grid1Api.grid.refresh()},g.roleTask=m.rolePermission("T_BL_M_DEP_TYPE"),g.cloneFromChange=function(e){e?l.cloneFromToShowGrid(e,g.facility,g.tariff.CODE,g.tariffclass,g.typeStatus,g.availableto).then(function(e){_.uniqBy(e,function(e){return[e.ServiceSeqId,e.TariffClass.name].join()});0==g.formGridOptions.data.length?g.formGridOptions.data=e:a.show({template:'<div style="height: 202px;width: 300px;text-align: center;background-color: #f8AE19;color: white;border: 1px solid #D4741B;border-radius: 3px;font-family:sans serif"><i class="fa fa-close" style="float:right"></i><i class="fa fa-exclamation fa-4x" style="text-align:center"></i><h3>WARNING</h3><p>Cloning will replace the already entered data on the screen with the data from the selected record. Do you still want to continue?</p><div align="center"><button type="button" class="btn btn-default" ng-click="ctrl.confirmAction(res)">Yes</button> <button type="button" class="btn btn-default" ng-click="ctrl.closepopup()">No</button></div></div>',parent:angular.element(document.body),controller:function(){this.parent=g,this.confirmAction=function(){g.formGridOptions.data=[],g.formGridOptions.data=e,a.hide()},this.closepopup=function(){a.hide()}},controllerAs:"ctrl",clickOutsideToClose:!0,fullscreen:g.customFullscreen})}):g.formGridOptions.data=[]},g.confirmAction=function(e){},g.singleFilter=function(e){if(g.rowCount=e.length,g.serviceSearch){if(g.serviceSearch.dept){var t=new RegExp(g.serviceSearch.dept,"gi");e.forEach(function(e){var a=!1;["DEPARTMENT_CODE"].forEach(function(i){e.entity[i].toString().match(t)&&(a=!0)}),a||(e.visible=!1)})}if(g.serviceSearch.subDept){t=new RegExp(g.serviceSearch.subDept,"gi");e.forEach(function(e){var a=!1;["SUB_DEPT_CODE"].forEach(function(i){e.entity[i].toString().match(t)&&(a=!0)}),a||(e.visible=!1)})}if(g.serviceSearch.serviceCode){t=new RegExp(g.serviceSearch.serviceCode,"gi");e.forEach(function(e){var a=!1;["ServiceCode"].forEach(function(i){e.entity[i].toString().match(t)&&(a=!0)}),a||(e.visible=!1)})}if(g.serviceSearch.serviceName){t=new RegExp(g.serviceSearch.serviceName,"gi");e.forEach(function(e){var a=!1;["ServiceName"].forEach(function(i){e.entity[i].toString().match(t)&&(a=!0)}),a||(e.visible=!1)})}if(g.serviceSearch.tariff){t=new RegExp(g.serviceSearch.tariff,"gi");e.forEach(function(e){var a=!1;["TariffClass"].forEach(function(i){e.entity[i].id.toString().match(t)&&(a=!0)}),a||(e.visible=!1)})}e.forEach(function(e){e.visible||g.rowCount--})}return e},g.CD=angular.copy(s),g.operation={},g.operation.isUpdate=!1,g.operation.name="Save",g.applyToAllDepositAmmounts=function(e){angular.isArray(g.formGridOptions.data)&&g.formGridOptions.data.length>0&&g.formGridOptions.data[0].actionsFlag&&angular.forEach(g.formGridOptions.data,function(t,a){t.DepositAmount=e})},g.editDepositRecord=function(e){e.entity.editable=!e.entity.editable,g.grid1Api.core.notifyDataChange(o.dataChange.EDIT)},g.depositRecordDesable=function(e){e.entity.editable=!1},g.submitDepositForm=function(i){i.operation.isUpdate?function(a){a.amount=!1;var i=0;if(angular.forEach(a.formGridOptions.data,function(e,t){0==e.DepositAmount&&e.actStatus&&++i>0&&(a.amount=!0)}),a.facility_error=!1,a.assign_error=!1,a.TariffClass_error=!1,a.applicable_error=!1,a.type_error=!1,a.amount){var r=t.myObj.plzEnrDepstAmt;return void u.hisAlertMulti("warning",t.myObj.alertTypeWarn,r,!1,!1,t.close,2500)}if(!a.facility)return void(a.facility_error=!0);if(!a.servicetype)return void(a.type_error=!0);if(!a.availableto)return void(a.applicable_error=!0);l.editDepositMastersForm(a).then(function(a){if(Object.keys(a).length>0&&!a.hasOwnProperty("errorCode")){var i=t.myObj.rcdSucssUpdate;u.hisAlertMulti("success",t.myObj.alertTypeSucss,i,!1,!1,t.close,1500),e.reload()}})}(i):function(i){i.amount=!1;var r=0,n=0;if(angular.forEach(i.gridOptions.data,function(e,t){e.depositName&&i.depositName.toString().toUpperCase()===e.depositName.toString().toUpperCase()&&n++}),n>0){var s=t.myObj.depositNmeAlrdyExt;return void u.hisAlertMulti("warning",t.myObj.alertTypeWarn,s,!1,!1,t.close,2e3)}if(angular.forEach(i.formGridOptions.data,function(e,t){0==e.DepositAmount&&e.actStatus&&++r>0&&(i.amount=!0)}),i.applicable_error=!1,i.type_error=!1,i.facility_error=!1,i.depositName_error=!1,i.assign_error=!1,i.gridEmpty_error=!1,i.TariffClass_error=!1,i.amount){var s=t.myObj.plzEnrDepstAmt;return void u.hisAlertMulti("warning",t.myObj.alertTypeWarn,s,!1,!1,t.close,2500)}if(!i.facility)return void(i.facility_error=!0);if(!i.depositName)return void(i.depositName_error=!0);if(!i.servicetype)return void(i.type_error=!0);if(!i.availableto)return void(i.applicable_error=!0);if(2==i.servicetype&&0==i.formGridOptions.data.length)return void a.show({template:'<div style="height: 202px;width: 300px;text-align: center;background-color: #f8AE19;color: white;border: 1px solid #D4741B;border-radius: 3px;font-family:sans serif"><i class="fa fa-close" style="float:right"></i><i class="fa fa-exclamation fa-4x" style="text-align:center"></i><h3>WARNING</h3><p>Please Add Deposit Details</p><div align="center"><button type="button" class="btn btn-default" ng-click="ctrl.closepopup()">Ok</button></div></div>',parent:angular.element(document.body),controller:function(){this.parent=i,this.closepopup=function(){a.hide()}},controllerAs:"ctrl",clickOutsideToClose:!0,fullscreen:i.customFullscreen});l.saveDepositMastersForm(i).then(function(a){if(Object.keys(a).length>0&&!a.hasOwnProperty("errorCode")){var i=t.myObj.savdSucesFuly;u.hisAlertMulti("success",t.myObj.alertTypeSucss,i,!1,!1,t.close,1500),e.reload()}})}(i)},g.serviceTypeChange=function(e){2==e?(g.serviceSelected=!0,g.facilityChange(g.facility)):g.serviceSelected=!1},l.comboBoxFetch("MQ_FACILITY_USER_PERMITED",JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID).then(function(e){g.facilityComboObj=e}),l.comboBoxFetch("TRN003",41002).then(function(e){g.servicetypeComboObj=e}),l.comboBoxFetch("TRN003",41003).then(function(e){g.applicableComboObj=e}),g.applicableChange=function(e){e?(g.cloneComboObj=[],l.comboBoxFetch("MQ_TARIFF_CAT",g.facility,e,!0).then(function(e){g.tariffComboObj=e})):g.tariffComboObj=[]},g.facilityChange=function(e){e&&(g.facility_error=!1,g.changedFacility=e,g.formGridOptions.data=[],g.deptComboObj=[],g.serviceNamesComboObj=[],g.subDeptComboObj=[],g.subDept="",g.serviveName="",l.comboBoxFetch("MQ_DEPT",e).then(function(e){g.deptComboObj=e}),l.comboBoxFetch("MQ_BED_CLASS",e).then(function(e){g.tariffClassObj=e}),l.comboBoxFetch("MQ_SERVICES_COMBO",g.changedFacility,"",-999).then(function(e){g.serviceNamesComboObj=e}))},g.deptChange=function(e){g.subDeptComboObj=[],g.changedDept=e,g.departmentChanged=!0,e&&(g.departmentChanged=!0,l.comboBoxFetch("MQ_SUB_DEPT",e).then(function(e){g.subDeptComboObj=e}))},g.serNameSelection=function(){g.departmentChanged&&(g.subDeptValues=g.subDept.toString(),l.comboBoxFetch("MQ_SERVICES_COMBO",g.changedFacility,g.changedDept,g.subDeptValues).then(function(e){g.serviceNamesComboObj=e}))},g.tariffCategoryChange=function(){l.comboBoxFetch("MQ_TARIFF_CAT_FROM_CLONE",g.changedFacility,g.tariff.CODE,g.availableto).then(function(e){g.cloneComboObj=e}),l.comboBoxFetch("MQ_TARIFF_CAT",g.facility,g.tariff.CODE).then(function(e){g.tariffCategoryForRCV=e})};var C=function(e){return e.filter(function(e,t){for(var a=0;a<this.length;a++)if(this[a].id==e.id)return a==t;return!1},e)};g.addDetailsToGrid=function(){f(),g.serviceGridSearch(),g.serviceSearch={},g.applicable_error=!1,g.assign_error=!1,g.facility_error=!1,g.TariffClass_error=!1,g.depositName_error=!1,g.availableto?g.tariff?g.facility?g.tariffclass&&0!=g.tariffclass.length?(g.subDept&&(g.subDeptValues=g.subDept.toString()),g.serviveName&&(g.serviveNameList=g.serviveName.toString()),l.addDetailsToServiceGrid(g.tariff,g.changedFacility,g.changedDept,g.subDeptValues,g.serviveNameList,g.tariffclass,g.typeStatus).then(function(e){if(0!=g.formGridOptions.data.length){for(var a=g.formGridOptions.data,i=0,r=a.length;i<r;i++)for(var n=0,l=e.length;n<l;n++)a[i].ServiceSeqId==e[n].ServiceSeqId&&a[i].TariffClass.id==e[n].TariffClass.id&&(e.splice(n,1),l=e.length);if(0==e.length){var s=t.myObj.recdErrorMsg;u.hisAlertMulti("warning",t.myObj.alertTypeWarn,s,!1,!1,t.close,3e3)}else angular.forEach(e,function(e,t){g.formGridOptions.data.push(e),v.push({name:e.Department,id:e.DEPARTMENT_CODE}),D.push({name:e.SubDepartment,id:e.SUB_DEPT_CODE}),y.push(e.TariffClass),-1==g.autoCompleteServiceCode.indexOf(e.ServiceCode)&&g.autoCompleteServiceCode.push(e.ServiceCode),-1==g.autoCompleteServiceName.indexOf(e.ServiceName)&&g.autoCompleteServiceName.push(e.ServiceName)}),g.deportmentServiceCombo=C(v),g.subDeportmentServiceCombo=C(D),g.tariffClassServiceCombo=C(y)}else g.formGridOptions.data=e})):g.TariffClass_error=!0:g.facility_error=!0:g.assign_error=!0:g.applicable_error=!0},l.getGridData().then(function(e){g.refresh=!0,g.gridOptions.data=e,i(function(){g.gridOptions.enableHorizontalScrollbar=0,g.refresh=!1},2),g.autoCompleteName=[],angular.forEach(e,function(e,t){-1==g.autoCompleteName.indexOf(e.depositName)&&g.autoCompleteName.push(e.depositName)})}),g.searchDepositDetails=function(e){if(!e){var a=t.myObj.PlzSlctCritra;u.hisAlertMulti("warning",t.myObj.alertTypeWarn,a,!1,!1,t.close,2e3)}l.getGridData(e).then(function(e){g.gridOptions.data=e})},g.activeInactive=function(e){l.getActiveInactive(e).then(function(t){e.gnStatus=t.gnStatus,e.gnStatusDesc=t.gnStatusDesc})},g.blurDepositMasters=function(){g.isEditMode=!0},g.editDepositMasters=function(e){f(),g.applicable_error=!1,g.type_error=!1,g.facility_error=!1,g.depositName_error=!1,g.assign_error=!1,g.TariffClass_error=!1,g.serviceSearch&&(g.serviceSearch.dept="",g.serviceSearch.subDept="",g.serviceSearch.serviceName="",g.serviceSearch.serviceCode="",g.serviceSearch.tariff=""),g.status1=!1,g.isEditMode=!0,g.status2=!0,g.code=e.code,g.operation.name="Update",g.operation.isUpdate=!0,g.remarks=e.remarks,g.facility=e.facilityList[0]["com.napier.core.service.vo.deposits.DepositTypeFacilityLinkVo"].facilityId,2==e.gnApplicableTo?(g.facilityChange(g.facility),g.serviceSelected=!0,l.getEditServiceGridData(e.code).then(function(e){g.autoCompleteServiceName=[],g.autoCompleteServiceCode=[],v=[],D=[],y=[],_.forEach(e,function(e,t){v.push({name:e.Department,id:e.DEPARTMENT_CODE}),D.push({name:e.SubDepartment,id:e.SUB_DEPT_CODE}),y.push(e.TariffClass),g.tariff={},g.tariff.CODE=e.TariffCategoryCode,g.tariff.DESCRIPTION=e.TariffCategoryName,g.tariffCatName=e.TariffCategoryName,-1==g.autoCompleteServiceCode.indexOf(e.ServiceCode)&&g.autoCompleteServiceCode.push(e.ServiceCode),-1==g.autoCompleteServiceName.indexOf(e.ServiceName)&&g.autoCompleteServiceName.push(e.ServiceName)}),g.tariffCategoryChange(),g.deportmentServiceCombo=C(v),g.subDeportmentServiceCombo=C(D),g.tariffClassServiceCombo=C(y),g.refresh=!1,g.formGridOptions.data=e,i(function(){g.formGridOptions.enableHorizontalScrollbar=0},1)})):g.serviceSelected=!1,g.depositName=e.depositName,g.description=e.description,g.servicetype=e.gnApplicableTo,g.availableto=e.gnFlow,g.typeStatus=e.gnStatus},g.serviceGridActiveInactive=function(e){g.CheckActivemapping?e.actStatus?(e.gnStatus="1",e.gnStatusDesc="Active"):(e.gnStatus="2",e.gnStatusDesc="Inactive"):(e.actStatus=!1,e.gnStatus="2",e.gnStatusDesc="Inactive")},l.options=!0,g.SetStatusformapping=function(e){angular.forEach(g.formGridOptions.data,function(t,a){1==e?(t.gnStatus="1",t.gnStatusDesc="Active",t.actStatus=!0,g.CheckActivemapping=!0):(t.gnStatus="2",t.gnStatusDesc="Inactive",t.actStatus=!1,g.CheckActivemapping=!1)})},g.enableApplyToAll=function(){0!=g.depositAmount.toString().length?g.isApplyToAllDisable=!1:g.isApplyToAllDisable=!0}}e.$inject=["$state","$scope","$mdDialog","$timeout","depositMastersGridDef","depositMastersFormGridDef","angdepositMastersService","hisCalDefConstant","uiGridConstants","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","RoleTaskService"],angular.module("napierContainerUi").controller("angdepositMastersController",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("depositRequestWorklistGridDefn",{enableHorizontalScrollbar:2,enableCellEditOnFocus:!1,enableRowSelection:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,multiSelect:!1,enableFiltering:!1,enableSorting:!1,columnDefs:[{displayName:"",name:"checkedRadio",width:30,cellTemplate:'<div class="ui-grid-cell-contents"><center><input type="radio" style="border:none;" ng-click="grid.appScope.clkpatient(row.entity)" value="1" ng-model="depPat" name="depPati"></center></div>',pinnedLeft:!0},{field:"depositAgainst",displayName:"",cellTemplate:'<div class="ui-grid-cell-contents"><div class=\'{{COL_FIELD == "3" || COL_FIELD == "1" ? "manual-deposit-status" : (COL_FIELD == "2" ? "auto-generated-status" : "")}}\'> </div></div>',width:10,pinnedLeft:!0},{name:"depositNo",displayName:"Deposit Request No",width:120,pinnedLeft:!0},{name:"ipNo",displayName:"IP No.",width:120},{name:"mrNo",displayName:"MR No.",width:120},{name:"patientName",displayName:"Patient Name",width:200},{name:"depositAmount",displayName:"Amount to Deposit",width:120},{name:"deptranDate.$",displayName:"Request Date Time",width:120,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.deptranDate.$ | date :"dd-MM-yyyy hh:mm a"}}</div>'},{name:"adjustAmount",displayName:"Adjusted Amount",width:120},{name:"depositAvailableAmt",displayName:"Available Deposit",width:120},{name:"depositAgainstDesc",displayName:"Deposit Against",width:120},{name:"gnDepositStatusDesc",displayName:"Status",width:120},{name:"depositTypeDesc",displayName:"Deposit Type",width:120}]}).constant("depReqGeneralPatSearchGridDefn",{enableCellEditOnFocus:!1,enableHorizontalScrollbar:2,enableRowSelection:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,multiSelect:!1,enableFiltering:!1,enableSorting:!1,columnDefs:[{name:"PAT_FIRST_NAME",displayName:"Patient Name",pinnedLeft:!0},{name:"INT_MR_NO",displayName:"MR No."},{name:"AGE",displayName:"Age"},{name:"SEX_DESC",displayName:"Gender"},{name:"DOB",displayName:"Date Of Birth",type:"date",cellFilter:"date:'dd-MM-yyyy'"},{name:"MOBILE_NO",displayName:"Mobile No."}]})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c){var d=this;o.loadModule("billing");var p=c.getLanguageToSet();function u(){d.isEdit=!0,d.isView=!0,d.isCancel=!0,d.isWriteBack=!0,d.isRefReq=!0,e.selectedRec=[]}o.changeLanguage(p),e.contextInfo=JSON.parse(sessionStorage.getItem("userContextObj")),e.depositWorklistGridOptions=angular.copy(a),e.popup1={opened:!1},e.popup2={opened:!1},e.open1=function(){e.popup1.opened=!0},e.open2=function(){e.popup2.opened=!0},e.comDateformat=angular.copy(s),e.chgFromDt=function(t){e.toDateOptions={minDate:t}},function(){e.staList=[],e.statusList={1:e.staList};var t=r.executeQueryURLReset(),a=new Array;r.prepareParamListWithParam("pMasterSqId",41004,a),r.prepareParamListWithParam("pMasterDesc","",a),r.prepareParamListWithParam("pDetailCode",-999,a),r.prepareParamListWithParam("pDetailDesc","",a),r.executeQueryInput("DEPOSIT_STATUS_TRN003",a,e.statusList,!0,!0,t,"popUp",{}).then(function(t){e.statusList=t[1]})}(),function(){e.depsitype=[],e.depsitypeList={1:e.depsitype};var t=r.executeQueryURLReset(),a=new Array;r.prepareParamListWithParam("pPracticeId",e.contextInfo.CLIENT_REF_ID,a),r.prepareParamListWithParam("pStatus",-999,a),r.prepareParamListWithParam("pDepositTypeName","",a),r.prepareParamListWithParam("pFlow",-999,a),r.prepareParamListWithParam("pApplicableTo",-999,a),r.prepareParamListWithParam("pFacilityId",e.contextInfo.FACILITY_ID,a),r.executeQueryInput("ANSC_DEPOSIT_TYPE_001",a,e.depsitypeList,!0,!0,t,"popUp",{}).then(function(t){e.depsitypeList=t[1]})}(),e.init=function(){u(),e.depRequestSearch={fromDate:new Date,toDate:new Date,depositTypeCode:"",gnDepositStatus:"",depositNo:"",mrNo:"",ipNo:"",patFirstName:""},d.isEditEnable=!0,d.format=e.comDateformat.dateOnlySlash.format,e.frmDateOptions={maxDate:new Date},e.toDateOptions={minDate:new Date},e.depositWorklistGridOptions.data=[]},e.init(),e.clearDepoReqsearch=function(){e.init()},e.getDepoReqWorklist=function(){e.depositWorklistGridOptions.data=[],null!=e.depRequestSearch.depositTypeCode&&""!=e.depRequestSearch.depositTypeCode||(e.depRequestSearch.depositTypeCode=-999),null!=e.depRequestSearch.gnDepositStatus&&""!=e.depRequestSearch.gnDepositStatus||(e.depRequestSearch.gnDepositStatus=-999),null==e.depRequestSearch.fromDate||null==e.depRequestSearch.fromDate||null==e.depRequestSearch.toDate||null==e.depRequestSearch.toDate?n.warning("Warning","Date Range should not empty",!1,!1,l.time):moment(e.depRequestSearch.fromDate)>moment(e.depRequestSearch.toDate)?n.warning("Warning","To Date greater than From Date",!1,!1,l.time):(""!=e.depRequestSearch.patFirstName&&(e.depRequestSearch.patMiddleName=e.depRequestSearch.patFirstName,e.depRequestSearch.patLastName=e.depRequestSearch.patFirstName),e.depRequestSearch["@class"]="com.napier.core.service.vo.deposits.DepositsVo",e.depRequestSearch.practiceId=e.contextInfo.CLIENT_REF_ID,e.depRequestSearch.facilityId=e.contextInfo.FACILITY_ID,i.getGridData(e.depRequestSearch).then(function(t){if(""==t.data.HITService.message.deposits[0])n.warning("Warning","No Records Found",!1,!1,l.time),e.depositWorklistGridOptions.data=[];else{var a=t.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"],i=Array.isArray(a)?a:[a];e.depositWorklistGridOptions.data=i}u()}))},e.depositWorklistGridOptions.onRegisterApi=function(e){d.gridApiselectPat=e,e.selection.on.rowSelectionChanged(d,function(e){e.isSelected;d.isEditEnable=!1})},e.addNewpopUp=function(a){t.open("Deposit New",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/depositRequests/partials/add.deposit.request.modal.html",size:a,controller:"addDepoReqModalCtrl",controllerAs:"depReqCtrl"}).result.then(function(){e.getDepoReqWorklist()})},e.clkEditView=function(a,i,r){if(d.rowsSelected=e.selectedRec,0!=d.rowsSelected.length)if(d.rowsSelected[0].depositNo){var s={editedPat:d.rowsSelected[0],pageMode:r};if("Refund Request"==d.rowsSelected[0].gnDepositStatusDesc)e.clkRefReq(a,i,r);else if("Write back"==d.rowsSelected[0].gnDepositStatusDesc||"Cancelled"==d.rowsSelected[0].gnDepositStatusDesc)e.clkCancelWriteBack(a,i,r);else{t.open(i,{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/depositRequests/partials/edit.deposit.request.modal.html",size:a,controller:"editDepoReqModalCtrl",controllerAs:"editdepReqCtrl",resolve:{patObj:s}}).result.then(function(){e.getDepoReqWorklist()})}}else n.warning("Warning","Patient must be Deposit No",!1,!1,l.time);else n.warning("Warning","Please select record",!1,!1,l.time)},e.clkCancelWriteBack=function(a,i,r){if(d.rowsSelected=e.selectedRec,0!=d.rowsSelected.length)if(d.rowsSelected[0].depositNo){var s={editedPat:d.rowsSelected[0],pageMode:r};t.open(i,{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/depositRequests/partials/cancel.writeback.deposit.request.modal.html",size:a,controller:"cancelWritebackDepoReqModalCtrl",controllerAs:"canwbdepReqCtrl",resolve:{patObj:s}}).result.then(function(){e.getDepoReqWorklist()})}else n.warning("Warning","Patient must be Deposit No",!1,!1,l.time);else n.warning("Warning","Please select record",!1,!1,l.time)},e.clkSkipDep=function(a,i,r){if(d.rowsSelected=e.selectedRec,0!=d.rowsSelected.length)if(d.rowsSelected[0].depositNo){var s={editedPat:d.rowsSelected[0],pageMode:r};t.open(i,{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/depositRequests/partials/skipdep.deposit.request.modal.html",size:a,controller:"skipDepDepoReqModalCtrl",controllerAs:"skipdepCtrl",resolve:{patObj:s}}).result.then(function(){e.getDepoReqWorklist()})}else n.warning("Warning","Patient must be Deposit No",!1,!1,l.time);else n.warning("Warning","Please select record",!1,!1,l.time)},e.clkRefReq=function(a,i,r){if(d.rowsSelected=e.selectedRec,0!=d.rowsSelected.length)if(d.rowsSelected[0].depositNo){var s={editedPat:d.rowsSelected[0],pageMode:r};t.open(i,{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/depositRequests/partials/refreq.deposit.request.modal.html",size:a,controller:"refreqDepoReqModalCtrl",controllerAs:"refreqCtrl",resolve:{patObj:s}}).result.then(function(){e.getDepoReqWorklist()})}else n.warning("Warning","Patient must be Deposit No",!1,!1,l.time);else n.warning("Warning","Please select record",!1,!1,l.time)},e.clkpatient=function(t){e.selectedRec=[t],2!=t.gnDepositStatus&&4!=t.gnDepositStatus&&3!=t.gnDepositStatus&&12!=t.gnDepositStatus&&11!=t.gnDepositStatus&&10!=t.gnDepositStatus&&5!=t.gnDepositStatus&&9!=t.gnDepositStatus||(d.isView=!1,d.isEdit=!0,d.isCancel=!0,d.isWriteBack=!0,d.isRefReq=!0),7!=t.gnDepositStatus&&8!=t.gnDepositStatus||(d.isWriteBack=!1,d.isRefReq=!1,d.isView=!1,d.isEdit=!0,d.isCancel=!0),6==t.gnDepositStatus&&(d.isWriteBack=!0,d.isRefReq=!0,d.isView=!1,d.isEdit=!1,"General"==t.depositAgainstDesc||"Interim Demand Note"==t.depositAgainstDesc?d.isCancel=!1:d.isCancel=!0)}}e.$inject=["$scope","hisModalService","depositRequestWorklistGridDefn","depositRequestService","QueryService","hisAlertService","hisAlertConstants","hisCalDefConstant","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("depositRequestsController",e)}(),function(){"use strict";function e(e,t){this.getGridData=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"getDepositSearchList",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)},this.getDepositAmount=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"getDepositsByAccountId",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)},this.saveDepositReq=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"generateDepositRequest",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)},this.updateDepositReq=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"updateDepositRequest",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)},this.cancelDepositReq=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"cancelDepositRequest",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)},this.skipDepositReq=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"skipDepositRequest",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)},this.writeBackDepositReq=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"writeBackDepositRequest",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)},this.refreqDepositReq=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"refundDepositRequest",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)},this.getdepositbyId=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"getDepositById",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)},this.getGeneralPatSearchData=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"patientSearch",destination:"com.napier.his.appointment_management.service.external.AppointmentsManagementService",message:a},t.sendRestRequest(i)}}e.$inject=["BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("depositRequestService",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m){var g=this;c.loadModule("billing");var S,v=d.getLanguageToSet();c.changeLanguage(v),g.contextInfo=JSON.parse(sessionStorage.getItem("userContextObj")),g.isApprBtn=!1,g.isdisApprBtn=!1,g.editDepoReqObj=o.editedPat,g.newreqObj={},g.showPatientBanner=!1,function(){g.depsitype=[],g.depsitypeList={1:g.depsitype};var e=r.executeQueryURLReset(),t=new Array;r.prepareParamListWithParam("pPracticeId",g.contextInfo.CLIENT_REF_ID,t),r.prepareParamListWithParam("pStatus",-999,t),r.prepareParamListWithParam("pDepositTypeName","",t),r.prepareParamListWithParam("pFlow",-999,t),r.prepareParamListWithParam("pApplicableTo",-999,t),r.prepareParamListWithParam("pFacilityId",g.contextInfo.FACILITY_ID,t),r.executeQueryInput("ANSC_DEPOSIT_TYPE_001",t,g.depsitypeList,!0,!0,e,"popUp",{}).then(function(e){g.depsitypeList=e[1]})}(),S={"@class":"com.napier.core.service.vo.deposits.DepositsVo",depositAgainst:g.editDepoReqObj.depositAgainst,depositSeqId:g.editDepoReqObj.depositSeqId,gnDepositStatus:g.editDepoReqObj.gnDepositStatus,gnTranStatus:1,isBillDepositAdj:g.editDepoReqObj.isBillDepositAdj,refSeqId:g.editDepoReqObj.refSeqId},n.getdepositbyId(S).then(function(e){if(""!==e.data.HITService.message){var t=e.data.HITService.message.depositTypeCode;g.editDepoReqObj.depositTypeCode=t;var a=e.data.HITService.message.depositAmount;g.newreqObj.depositAmount=a,e.data.HITService.message.depositReason&&(g.editDepoReqObj.reason=e.data.HITService.message.depositReason)}}),"appr"==o.pageMode&&(g.isApprBtn=!0),"disappr"==o.pageMode&&(g.isdisApprBtn=!0),g.isoutDepositdisabled=!0,g.isDemandNoteNodisabled=!0,function(t){var r;g.showPatientBanner=!0,g.selectedadmitpat=t;let l={regSeqId:g.selectedadmitpat[0].RG_SEQ_ID,ipAdmSeqId:g.selectedadmitpat[0].IPADM_SEQ_ID};r=null==l.admissionSeqid?"2":"1",a.getPatientBanner(l,r).then(function(t){var a,i;e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=1,e.accSeqId=t.accSeqId,e.regSeqId=l.regSeqId,e.subAccSeqId=t.subAccSeqId,a=e.accSeqId,i={"@class":"com.napier.core.service.vo.deposits.DepositsVo",accSeqId:a},n.getDepositAmount(i).then(function(e){""!==e.data.HITService.message.deposits[0]&&e.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"].depositTypeCode})}),i.patientBannerDetail(l.regSeqId).then(function(t){e.patientBannerDetails=t,e.refSeqId=e.patientBannerDetails.patientReferral.refSeqId})}([{RG_SEQ_ID:o.editedPat.rgSeqId,IPADM_SEQ_ID:o.editedPat.ipAdmnSeqId}]),g.apprSave=function(){var e={"@class":"com.napier.core.service.vo.deposits.DepositRefundVo",approvedAmount:g.editDepoReqObj.depRefundAmount,approvedBy:g.contextInfo.USER_SEQ_ID,facilityId:g.contextInfo.FACILITY_ID,depositNo:g.editDepoReqObj.depositNo,depositSeqId:g.editDepoReqObj.depositSeqId,practiceId:g.contextInfo.CLIENT_REF_ID,depRefundAmount:g.editDepoReqObj.depRefundAmount,depRefundBy:g.contextInfo.USER_SEQ_ID,depRefundSeqId:g.editDepoReqObj.depRefundSeqId,patientId:g.editDepoReqObj.patientId,reason:g.editDepoReqObj.remarks,reasonSeqId:g.editDepoReqObj.reasonSeqId,remarks:g.editDepoReqObj.remarks,sbaRefNo:g.editDepoReqObj.sbaRefNo,tranType:7};p.refApprove(e).then(function(e){if(""!==e.data.HITService.message.depositSeqId){l.success("Success","Approve Sucessfully",!1,!1,s.time);var a=e.data.HITService.message,i={buttonCallBack1:function(){g.apprPrint(a)},buttonCallBack2:function(){t.close()}};l.hisAlertMulti("information","Information","Do you want Print?",{buttonText:"Yes",buttonText2:"No"},i)}})},g.disApprSave=function(){var e={"@class":"com.napier.core.service.vo.deposits.DepositRefundVo",approvedAmount:g.editDepoReqObj.depRefundAmount,approvedBy:g.contextInfo.USER_SEQ_ID,facilityId:g.contextInfo.FACILITY_ID,depositNo:g.editDepoReqObj.depositNo,depositSeqId:g.editDepoReqObj.depositSeqId,practiceId:g.contextInfo.CLIENT_REF_ID,depRefundAmount:g.editDepoReqObj.depRefundAmount,depRefundBy:g.contextInfo.USER_SEQ_ID,depRefundSeqId:g.editDepoReqObj.depRefundSeqId,patientId:g.editDepoReqObj.patientId,reason:g.editDepoReqObj.reason,reasonSeqId:g.editDepoReqObj.reasonSeqId,remarks:g.editDepoReqObj.remarks,sbaRefNo:g.editDepoReqObj.sbaRefNo,tranType:7};p.refDisapprove(e).then(function(e){""!==e.data.HITService.message.depositSeqId&&l.success("Success","Disapprove Sucessfully",!1,!1,s.time)})},g.apprPrint=function(e){if(e.depRefundSeqId){t.close(),m.bilingrefundprntRefSeqId=e.depRefundSeqId;u.printReportModal("billingrefundApprovPrntCtrl","lg","PDF")}else l.warning("Warning","Must have deposit sequence id.",!1,!1,s.time)}}e.$inject=["$scope","$uibModalInstance","PatientBannerGlobal","PatientBannerBilling","QueryService","depositRequestService","hisAlertService","hisAlertConstants","patObj","hisTranslationsService","hisTranslationsGlobalLang","refundWorklistService","PrintService","$rootScope"],angular.module("napierContainerUi").controller("apprdisapprModalCtrl",e)}(),angular.module("napierContainerUi").controller("billingrefundApprovPrntCtrl",["$uibModalInstance","selectedPrintType","QueryService","PrintService","$rootScope","$scope",function(e,t,a,i,r,n){n.pageName="Print",n.cancel=function(){e.dismiss("cancel")},n.printParameterList=new Array,a.prepareParamList("pDepositrefundseqId",r.bilingrefundprntRefSeqId,n.printParameterList),n.printObject={},n.printObject.reportId="BillingInPatientDepositRefundReport",n.printObject.reportType={id:"PDF"==t?4:5,desc:t},n.printObject.paramsList=n.printParameterList,n.printObject.destination="reportingServiceImpl",i.printReportFunction(n.printObject,n)}]),function(){"use strict";angular.module("napierContainerUi").constant("refundWorklistGridDefn",{enableHorizontalScrollbar:2,enableCellEditOnFocus:!1,enableRowSelection:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,multiSelect:!1,enableFiltering:!1,enableSorting:!1,columnDefs:[{displayName:"",name:"checkedRadio",width:30,cellTemplate:'<div class="ui-grid-cell-contents"><center><input type="radio" style="border:none;" ng-click="grid.appScope.refundCtrl.clkRefundPatient(row.entity)" value="1" ng-model="deprefPat" name="deprefPat"></center></div>',pinnedLeft:!0},{name:"patientId",displayName:"Patient Id"},{name:"patientName",displayName:"Patient Name"},{name:"depositNo",displayName:"Deposit No."},{name:"depRefundAmount",displayName:"Amount To Refund"},{name:"depositAgainstDesc",displayName:"Deposit Against"},{name:"gnRefundStatusDesc",displayName:"Approval Status"}]})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d){var p=this;a.loadModule("billing");var u=i.getLanguageToSet();function m(){p.pName="",p.searchObj={fromDate:new Date,toDate:new Date,patFirstName:"",gnRefundStatus:0,patMiddleName:"",patLastName:"",depositNo:"",patientId:"",refNo:"",tranType:0},p.format=e.comDateformat.dateOnlySlash.format,p.frmDateOptions={maxDate:new Date},p.toDateOptions={minDate:new Date},p.refundWorklistgridOptions.data=[],e.getSelectedRecord=[],p.isApprove=!0,p.isDisapprove=!0}a.changeLanguage(u),p.contextInfo=JSON.parse(sessionStorage.getItem("userContextObj")),p.refundWorklistgridOptions=angular.copy(l),e.popup1={opened:!1},e.popup2={opened:!1},e.open1=function(){e.popup1.opened=!0},e.open2=function(){e.popup2.opened=!0},e.comDateformat=angular.copy(d),function(){e.staList=[],p.approvalStatusList={1:e.staList};var t=n.executeQueryURLReset(),a=new Array;n.prepareParamListWithParam("pMasterSqId",41007,a),n.prepareParamListWithParam("pMasterDesc","",a),n.prepareParamListWithParam("pDetailCode",-999,a),n.prepareParamListWithParam("pDetailDesc","",a),n.executeQueryInput("DEPOSIT_STATUS_TRN003",a,p.approvalStatusList,!0,!0,t,"popUp",{}).then(function(e){p.approvalStatusList=e[1]})}(),m(),p.chgFromDt=function(e){p.toDateOptions={minDate:e}},p.patientSearchModalpopUp=function(e,a){t.open("PATIENT SEARCH",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/depositRequests/partials/depreq.patient.search.modal.html",size:a,controller:"generalDepreqpatientSearchCtrl",controllerAs:"GenSearchCtrl"}).result.then(function(e){p.searchpatientid=e[0].INT_MR_NO,e[0].RG_SEQ_ID=e[0].PAT_SEQ_ID,p.pName=e[0].PAT_FIRST_NAME,p.searchObj.patMiddleName=e[0].PAT_MIDDLE_NAME,p.searchObj.patLastName=e[0].PAT_LAST_NAME})},p.typegeneralpatSearch=function(e){if(e.length>2){var t={"@class":"com.napier.his.appointment_management.vo.PatientSearchVO",search:e};return r.getGeneralPatSearchData(t).then(function(e){var t=e.data.HITService.message[0];if(t){var a=t["com.napier.his.appointment_management.vo.PatientSearchVO"];return(a instanceof Array?a:[a]).map(function(e){return e})}})}},p.onSelectgeneralpatSearch=function(e,t,a){t.RG_SEQ_ID=t.rgSeqId,p.pName=t.patientName,p.searchpatientid=t.patientId},p.clkSearch=function(){p.refundWorklistgridOptions.data=[],null==p.searchObj.fromDate||null==p.searchObj.fromDate||null==p.searchObj.toDate||null==p.searchObj.toDate?c.warning("Warning","Date Range should not empty",!1,!1,o.time):moment(p.searchObj.fromDate)>moment(p.searchObj.toDate)?c.warning("Warning","To Date greater than From Date",!1,!1,o.time):(""===p.pName&&void 0===p.pName||(p.searchObj.patFirstName="%"+p.pName+"%",p.searchObj.patMiddleName="%"+p.pName+"%",p.searchObj.patLastName="%"+p.pName+"%"),p.searchObj["@class"]="com.napier.core.service.vo.deposits.DepositRefundVo",p.searchObj.facilityId=p.contextInfo.FACILITY_ID,p.searchObj.practiceId=p.contextInfo.CLIENT_REF_ID,s.getGridData(p.searchObj).then(function(e){if(""==e.data.HITService.message.depositRefundsVo[0])c.warning("Warning","No Records Found",!1,!1,o.time),p.refundWorklistgridOptions.data=[];else{var t=e.data.HITService.message.depositRefundsVo[0]["com.napier.core.service.vo.deposits.DepositRefundVo"],a=Array.isArray(t)?t:[t];p.refundWorklistgridOptions.data=a}}))},p.clear=function(){p.searchpatientid="",m()},p.clkApproveDisapprove=function(a,i,r){if(p.rowsSelected=e.getSelectedRecord,0!=p.rowsSelected.length){var n={editedPat:p.rowsSelected[0],pageMode:r};t.open(i,{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/depostRefundWorklist/approval.disapproval.modal.html",size:a,controller:"apprdisapprModalCtrl",controllerAs:"apprdisApprCtrl",resolve:{patObj:n}}).result.then(function(){p.clkSearch()})}else c.warning("Warning","Please select record",!1,!1,o.time)},p.clkRefundPatient=function(t){"Pending"==t.gnRefundStatusDesc?(e.getSelectedRecord=[t],p.isApprove=!1,p.isDisapprove=!1):(p.isApprove=!0,p.isDisapprove=!0)}}e.$inject=["$scope","hisModalService","hisTranslationsService","hisTranslationsGlobalLang","depositRequestService","QueryService","refundWorklistGridDefn","refundWorklistService","hisAlertConstants","hisAlertService","hisCalDefConstant"],angular.module("napierContainerUi").controller("refundWorklistCntrl",e)}(),function(){"use strict";function e(e,t){this.getGridData=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"getRefundList",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)},this.refApprove=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"refundApprove",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)},this.refDisapprove=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"refundDisApprove",destination:"com.napier.core.deposits.service.external.DepositsService",message:a},t.sendRestRequest(i)}}e.$inject=["BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("refundWorklistService",e)}(),function(){"use strict";angular.module("napierContainerUi").service("PatientSearch",["CallManager","IPINDENTAPIS",function(e,t){this.patientSearchService=function(a,i){var r={},n=a;return r.url=t.HISIPINDENT.URL,r.requestData={operation:i,messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillVo",mrNo:n}},e.sendRestRequest(r)},this.patientCodeSearchService=function(a,i){var r={},n=a;return r.url=t.HISIPINDENT.URL,r.requestData={operation:i,messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillVo",StrIcdCode:n}},e.sendRestRequest(r)},this.diagnosisDtlsService=function(){var a={};return a.url=t.HISIPINDENTOPERATIONS.URL,a.requestData={operation:"getdiagnosisDtls",messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillVo"}},e.sendRestRequest(a)}}])}(),(app=angular.module("napierContainerUi")).constant("gridDefination",{serviceSearchGridOptions:{enableHorizontalScrollbar:0,enableRowSelection:!0,enableSelectAll:!0,enableVerticalScrollbar:0,paginationCurrentPage:1,paginationPageSize:10,saveSelection:!0,columnDefs:[{name:"serviceCode",displayName:"billing.serviceCode",headerCellFilter:"translate"},{name:"serviceName",displayName:"billing.serviceName",headerCellFilter:"translate"}]},packageDetlOtions:{enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!0,multiSelect:!1,enableSelectAll:!0,enableVerticalScrollbar:0,paginationCurrentPage:1,paginationPageSize:10,columnDefs:[{name:"strPackCode",displayName:"billing.packageCode",headerCellFilter:"translate"},{name:"primaryServiceTypeAliasName",displayName:"billing.package.name",headerCellFilter:"translate"},{name:"cptCode",displayName:"billing.cpt.code",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><span uib-tooltip="{{row.entity.cptCode}}" tooltip-placement="left">{{row.entity.cptCode}}</span></div>'},{name:"limitAmt",displayName:"billing.packageCost",headerCellFilter:"translate"},{name:"remarks",displayName:"billing.remarks",headerCellFilter:"translate"},{name:"primaryServiceTypeCode",visible:!1},{name:"approxBillDtSeqId",visible:!1},{name:"facilityId",visible:!1},{name:"practiceId",visible:!1},{name:"gnTranStatus",visible:!1},{name:"Action",displayName:"billing.action",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents actionsDurgs" style="text-align:center;"><span ng-click="grid.appScope.edit || grid.appScope.editPackage(row,rowRenderIndex)" style="padding-right: 10px;padding-left: 10px;"><i class="fa fa-pencil" aria-hidden="true"></i></span>|<span ng-click = "grid.appScope.deleteRecord || grid.appScope.deletePackage(row, rowRenderIndex)" style="padding: 10px;" ng-class="{disActionDel:grid.appScope.deleteRecord}"><i class="fa fa-trash-o" aria-hidden="true"></i></span></div>'},{name:"identification",displayName:"identification",visible:!1}]},serviceDetailsGridOtions:{enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!0,multiSelect:!1,enableSelectAll:!0,enableVerticalScrollbar:0,columnDefs:[{name:"serviceSeqId",displayName:"Service Sequence ID",enableCellEdit:!1,visible:!1},{name:"serviceCode",displayName:"billing.serviceCode",headerCellFilter:"translate",enableCellEdit:!1},{name:"serviceName",displayName:"billing.serviceName",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span uib-tooltip="{{row.entity.serviceName}}" tooltip-placement="left">{{row.entity.serviceName}}</span></div>'},{name:"serviceRate",displayName:"billing.servicePrice",headerCellFilter:"translate",enableCellEdit:!1},{name:"serviceDiscountAmt",displayName:"billing.discount",headerCellFilter:"translate",enableCellEdit:!1},{name:"serviceQty",displayName:"billing.quantity",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-if="!row.entity.editable">{{COL_FIELD}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable"><input type="text" numbers-only ng-model="MODEL_COL_FIELD" min="1" my-maxlength="6"></div>'},{name:"chargeableAmt",displayName:"billing.amt",headerCellFilter:"translate",enableCellEdit:!1},{name:"serviceTax",displayName:"billing.taxAplicable",headerCellFilter:"translate",enableCellEdit:!1},{name:"expcServDate",visible:!1},{name:"facilityId",visible:!1},{name:"practiceId",visible:!1},{name:"gnTranStatus",visible:!1},{name:"Action",displayName:"billing.action",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents actionsDurgs" style="text-align:center;"><span ng-if="!grid.appScope.update1" ng-click="grid.appScope.editService(row,rowRenderIndex,grid,col)" style="padding-right: 10px;padding-left: 10px;"><i class="{{grid.appScope.getTemplate(row.entity,grid.appScope.editStart,grid,col,row)}}" aria-hidden="true"></i></span>|<span ng-click = "grid.appScope.deleteRecord || grid.appScope.deleteService(row, rowRenderIndex)" style="padding: 10px;" ng-class="{disActionDel:grid.appScope.deleteRecord}"><i class="fa fa-trash-o" aria-hidden="true"></i></span></div>'},{name:"approxPackBillSeqId",visible:!1},{name:"identification",displayName:"identification",visible:!1}]},durgCnsmblesGridOtions:{enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!0,enableSelectAll:!1,multiSelect:!1,enableVerticalScrollbar:0,paginationCurrentPage:1,paginationPageSize:10,columnDefs:[{name:"materialName",displayName:"billing.name",headerCellFilter:"translate"},{name:"price",displayName:"billing.price",headerCellFilter:"translate"},{name:"quantaty",displayName:"billing.quantity",headerCellFilter:"translate"},{name:"totalPrice",displayName:"billing.totalPrice",headerCellFilter:"translate"},{name:"expcMtrlDate",visible:!1},{name:"approxBillDtSeqId",visible:!1},{name:"gnTranStatus",visible:!1},{name:"Action",displayName:"billing.action",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents actionsDurgs" style="text-align:center;"><span ng-click="grid.appScope.edit || grid.appScope.editRecord(row,rowRenderIndex)" style="padding-right: 10px;padding-left: 10px;"><i class="fa fa-pencil" aria-hidden="true"></i></span>|<span ng-click = "grid.appScope.deleteRecord || grid.appScope.deleteAddRecord(row, rowRenderIndex)" style="padding: 10px;" ng-class="{disActionDel:grid.appScope.deleteRecord}"><i class="fa fa-trash-o" aria-hidden="true"></i></span></div>'},{name:"identification",displayName:"identification",visible:!1}]}}),function(){"use strict";angular.module("napierContainerUi").controller("BillingEstimateController",["$scope","CommonForServiceData","ServiceGet","$uibModal","$uibModalStack","PatientBannerGlobal","PatientBannerBilling","QueryService","PatientSearch","$filter","$element","SaveServices","$location","$state","$stateParams","GetEstimateQuery","hisTranslationsService","hisTranslationsGlobalLang","gridDefApproval","hisGenericAlertService","hisAlertService","hisCalDefConstant","PreAuthSaveServices","hisModalService","CallManager","dropdownQueryService","otComService","estimateBillService","patPermanentRegistrationService","$log","PreAuthService","$timeout","uploadFileService",function(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C,I,A,E,h,b,T,L,P,O,R,N,w){v.loadModule("billing");var F=D.getLanguageToSet();v.changeLanguage(F),v.loadModule("ot");var M=this;M.alertObj={},f.loadAlerts(F).then(function(e){M.alertObj=e,M.deleteRecordSave=[],M.alertObjBtn={buttonText:M.alertObj.ok},M.alertFunction={buttonCallBack1:function(){}},M.buttonClose={buttonClose:function(){}}}),M.servGridDefLoad=function(){M.estimate=!0,a.serviceGridData(M,"etb",!1),M.preAuthDetailsGridOtions.columnDefs[6].visible=!1,M.preAuthDetailsGridOtions.columnDefs[5].visible=!0,M.preAuthDetailsGridOtions.columnDefs[8].visible=!0,M.preAuthDetailsGridOtions.columnDefs[0].visible=!0,M.preAuthDetailsGridOtions.onRegisterApi=function(t){e.serviceGrid=t}},e.activeFirst=1,M.tabChange=function(t){return"reg"!=e.patType||e.regSeqId?"1"!=M.patientType||!angular.isUndefinedOrNull(M.admn.bedClass)&&""!=M.admn.bedClass?void(e.activeFirst=t):(C.warning("Warning","Please select bed class"),!1):(C.warning("Warning","Please select a patient before adding service"),!1)},M.srchData={},e.estSearchGridOptions=angular.copy(a.estSearchGridOptions),e.estSearchGridOptions.onRegisterApi=function(t){e.estSearchGridOptions=t},e.estSearchGridOptions.data=[],e.updatePayerListDisable=!0,M.estimateFlow=!1,e.format="dd-MM-yyyy",M.gridOptionsDiag=angular.copy(a.gridOptions),M.gridOptionsProc=angular.copy(a.gridOptions),M.gridOptionsDiag.data=[],M.deleteDiag=[],M.deleteProc=[],e.updatePayerListDisable=!0,M.search={},M.diagnosis={},M.diagnosis.type="1",M.procedure={},M.procedure.type="1",M.payer={},M.PatPayerData={},M.payerArr=[],M.patientType="1",M.gnFlow=1,M.payer.payerName="";M.admn={},M.admn.DOB="1",M.clinic={},e.patVisit="OP",e.patientDetailsSearch={},e.reg=1,e.estimateCost=0,e.discounts=0,e.netAmount=0,e.regSeqId=null;e.estimateDta=JSON.parse(g.id),e.enableView=e.estimateDta[1],M.title="ESTIMATE BILL -NEW",e.enableView||M.servGridDefLoad();M.fillPatDetails=function(t){var a=t.approxBillHdSeqId,i=t.mrNo;e.patRegList={1:e.patDtls=[],2:e.diagDtls=[],3:e.procDtls=[],4:e.servDtls=[],5:e.mtlDtls=[]};var r=s.executeQueryURLReset();e.etbDtlsList=new Array,s.prepareParamListWithParam("pBilHdSeqId",a,e.etbDtlsList),s.prepareParamListWithParam("pEstimateHdSeqId",a,e.etbDtlsList),s.prepareParamListWithParam("pIs_extimate_or_preauth",1,e.etbDtlsList),s.executeQueryInput("GET_UNREG_PAT_BIL_DTLS",e.etbDtlsList,e.patRegList,!0,!1,r,"popUp",{}).then(function(e){}),s.executeQueryInput("GET_EST_DIAG_DTLS",e.etbDtlsList,e.patRegList,!0,!1,r,"popUp",{}).then(function(e){}),s.executeQueryInput("GET_EST_PROC_DTLS",e.etbDtlsList,e.patRegList,!0,!1,r,"popUp",{}).then(function(e){}),s.executeQueryInput("GET_ESTIMATE_SERVICE_DETAILS",e.etbDtlsList,e.patRegList,!0,!1,r,"popUp",{}).then(function(e){}),s.executeQueryInput("GET_EST_MATERIAL_DTLS",e.etbDtlsList,e.patRegList,!0,!0,r,"popUp",{}).then(function(t){M.srchClear(),M.approxBillHdSeqId=a,e.patDetails=t[1][0],e.patType=2==e.patDetails.PATIENT_TYPE?"nonReg":"reg",e.patDetails.regSeqId=e.patDetails.REG_SEQ_ID,e.patDetails.ipAdmSeqId=e.patDetails.IPADM_SEQ_ID?e.patDetails.IPADM_SEQ_ID:void 0,"reg"==e.patType&&e.searchPatientResult(e.patDetails),M.srchData.estNo=e.patDetails.APPROX_BILL_NO,M.admn.firstName=e.patDetails.PAT_FIRST_NAME,M.admn.lastName=e.patDetails.PAT_LAST_NAME,M.admn.mobileNo=e.patDetails.REG_MOBILE,M.admn.age=e.patDetails.RG_TMP_AGE,M.admn.email=e.patDetails.EMAIL,M.payer.payerSelf=2==e.patDetails.PAYER_TYPE?1:2,2==M.payer.payerSelf&&(M.payer.incSeqId=e.patDetails.INC_SEQ_ID,M.payer.INC_PLAN_SEQ_ID=e.patDetails.INC_PLAN_SEQ_ID,M.loadBedClass(M.payer,M.payer).then(function(t){M.admn.bedClass=M.bedClassList.find(t=>t.CODE==e.patDetails.BC_SEQ_ID),M.admn.presentBed=M.bedClassList.find(t=>t.CODE==e.patDetails.BC_SEQ_ID)})),M.tariff.TARIFFCATG=1==M.payer.payerSelf?e.selfTariff[0].TARIFFCATG:e.patDetails.TARIFF_SEQ_ID,M.tariff.PCATG_SEQ_ID=1==M.payer.payerSelf?e.selfTariff[0].PCATG_SEQ_ID:e.patDetails.PCATG_SEQ_ID,M.admn.address=e.patDetails.ADDRESS,M.admn.fromDate=new Date(e.patDetails.RG_TMP_DOB),M.patChange(e.patDetails.GN_FLOW),M.clinic.date=e.patDetails.EXP_ADM_DATE?new Date(e.patDetails.EXP_ADM_DATE):void 0,M.clinic.cheifComp=e.patDetails.CHIEF_COMPLAINTS,M.clinic.lenStay=e.patDetails.LOS_TYPE?e.patDetails.LOS_TYPE:void 0,M.clinic.stay=e.patDetails.EST_LOS?e.patDetails.EST_LOS:void 0,M.clinic.reason=e.patDetails.REASON_FOR_ADMISSION?e.patDetails.REASON_FOR_ADMISSION:void 0,M.admn.title=e.patDetails.RG_TITLE,M.admn.gender=e.patDetails.RG_TMP_SEX,1==M.payer.payerSelf&&(M.admn.bedClass=M.bedClassList.find(t=>t.CODE==e.patDetails.BC_SEQ_ID),M.admn.presentBed=M.bedClassList.find(t=>t.CODE==e.patDetails.BC_SEQ_ID)),R.getPayerBasedMrNo(i).then(function(e){M.payerArr=[],angular.forEach(e,function(e,t){B(e,3),M.tempPayerArr=M.payerArr})}),2==M.payer.payerSelf&&(M.payer.policyNumber=e.patDetails.POLICY_NO,M.payer.cardNumber=e.patDetails.CARD_NUMBER,M.payer.validFrom=moment(e.patDetails.PLAN_VALID_FROM).format("DD/MM/YYYY"),M.payer.validTo=moment(e.patDetails.PLAN_VALID_TO).format("DD/MM/YYYY"),M.payer.patCatgCode=e.patDetails.PCATG_SEQ_ID,M.payer.payerName=e.patDetails.INC_COMP_NAME,M.payer.planName=e.patDetails.INC_PLAN_NAME,M.payer.payerseqid=e.patDetails.INC_SEQ_ID,M.payer.planseqid=e.patDetails.INC_PLAN_SEQ_ID,M.payer.tariffSeqId=e.patDetails.TARIFF_SEQ_ID);var r=t[2];M.diagGridFill(r);var n=t[3];M.procGridFill(n);var l=t[4];M.serviceGridFill(l);var s=t[5];M.mtrGridFill(s)})};let G=0;M.serviceGridFill=function(t){angular.forEach(t,function(t){var a={rowNum:G+1,approxBillDtSeqId:t.APPROX_BILL_DT_SEQ_ID,specialty:t.SPL_CODE&&t.SPL_DESC?{CODE:t.SPL_CODE,DESCRIPTION:t.SPL_DESC}:void 0,department:t.DEPT_CODE&&t.DEPT_DESC?{CODE:t.DEPT_CODE,DESCRIPTION:t.DEPT_DESC}:void 0,priServGroup:{CODE:t.PRI_SERV_CODE?t.PRI_SERV_CODE:void 0,DESCRIPTION:t.PRI_SERV_DESC?t.PRI_SERV_DESC:void 0,IS_MATERIAL:"N"},service:t.SERV_SEQ_ID?{DEPT_CODE:t.DEPT_CODE?t.DEPT_CODE:void 0,PRI_SERV_CODE:t.PRI_SERV_CODE?t.PRI_SERV_CODE:void 0,PRI_SERV_DESC:t.PRI_SERV_DESC?t.PRI_SERV_DESC:void 0,DEPT_DESC:t.DEPT_DESC?t.DEPT_DESC:void 0,SERV_NAME:t.SERV_NAME?t.SERV_NAME:void 0,SERV_SEQ_ID:t.SERV_SEQ_ID}:void 0,serviceAmt:t.SERVICE_RATE?t.SERVICE_RATE:0,valueAmt:t.CHARGEABLE_AMT?t.CHARGEABLE_AMT:0,qty:t.SERV_QTY?t.SERV_QTY:void 0,status:t.IS_ORDER_FROM,inclStatus:t.IS_APPROVAL_REQUIRED};G+=1,t.CHARGEABLE_AMT=t.CHARGEABLE_AMT?t.CHARGEABLE_AMT:0,e.netAmount=e.netAmount+t.CHARGEABLE_AMT,M.preAuthDetailsGridOtions.data.push(a)})},M.mtrGridFill=function(t){angular.forEach(t,function(t){var a={rowNum:G+1,approxBillDtSeqId:t.APPROX_BILL_DT_SEQ_ID,department:t.MAT_GROUP_CODE?{CODE:t.MAT_GROUP_CODE,DESCRIPTION:t.MAT_GROUP_DESC,METERIAL_CATID:t.MAT_CATG_CODE}:void 0,priServGroup:{CODE:t.MAT_CATG_CODE?t.MAT_CATG_CODE:void 0,DESCRIPTION:t.MAT_CATG_DESC?t.MAT_CATG_DESC:void 0,IS_MATERIAL:"Y"},service:t.MTRL_SEQ_ID?{MRP:0!=t.MTRL_QTY?parseFloat((t.MTRL_RATE/t.MTRL_QTY).toFixed(2)):t.MTRL_RATE,SERV_NAME:t.MTRL_NAME?t.MTRL_NAME:void 0,SERV_SEQ_ID:t.MTRL_SEQ_ID}:void 0,specialty:t.MAT_SUB_GROUP_CODE?{CODE:t.MAT_SUB_GROUP_CODE,DESCRIPTION:t.MAT_SUB_GROUP_DESC?t.MAT_SUB_GROUP_DESC:void 0,MTRL_MAIN_GRP_CODE:t.MAT_GROUP_CODE?t.MAT_GROUP_CODE:void 0}:void 0,valueAmt:t.MTRL_RATE?t.MTRL_RATE:0,serviceAmt:0!=t.MTRL_QTY?parseFloat((t.MTRL_RATE/t.MTRL_QTY).toFixed(2)):t.MTRL_RATE,qty:t.MTRL_QTY?t.MTRL_QTY:1,status:t.IS_ORDER_FROM,inclStatus:t.IS_APPROVAL_REQUIRED};G+=1,t.MTRL_RATE=t.MTRL_RATE?t.MTRL_RATE:0,e.netAmount=e.netAmount+t.MTRL_RATE,M.preAuthDetailsGridOtions.data.push(a)})},M.diagGridFill=function(e){angular.forEach(e,function(e){e.ICDCODE=e.STANDARD_CODE,e.DESCRIPTION=e.STANDARD_NAME,e.HOSP_CODE&&(e.HOSP_DIAG_CODE=e.HOSP_CODE,e.HOSP_DIAG_DESC=e.HOSP_NAME),M.selectOnSuggestedDiagnosis(e,!0)})},M.procGridFill=function(e){angular.forEach(e,function(e){e.CODE=e.STANDARD_CODE,e.DESCRIPTION=e.STANDARD_NAME,e.HOSP_CODE&&(e.SUR_CODE=e.HOSP_CODE,e.SUR_NAME=e.HOSP_NAME),M.selectOnSuggestedProcedure(e,!0)})},M.fetchBeforeEstimate=function(){var t={1:M.getDiagDetails=[],2:M.getProcDetails=[],3:M.getServDetails=[]},a="IP"==e.patVisit?1:2,i=s.executeQueryURLReset(),r=new Array;s.prepareParamListWithParam("pEnSeqId",e.patientGlobalDtls.encounterSeqId,r),s.prepareParamListWithParam("pIpAdmSeqId",e.patientGlobalDtls.encounterSeqId,r),s.prepareParamListWithParam("PAT_TYPE",a,r),s.prepareParamListWithParam("PLAN_SEQ_ID",M.payer.planName?M.payer.planseqid:-999,r),s.prepareParamListWithParam("@pIpAdmSeqId",e.patientGlobalDtls.encounterSeqId,r),s.prepareParamListWithParam("@PAT_TYPE",a,r),s.prepareParamListWithParam("@PLAN_SEQ_ID",M.payer.planName?M.payer.planseqid:-999,r),s.prepareParamListWithParam("@BED_CLASS",M.admn.bedClass?M.admn.bedClass.CODE:-999,r),s.prepareParamListWithParam("@FACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,r),s.prepareParamListWithParam("@Practice_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r),s.executeQueryInput("GET_DIAGNOSIS_DETAILS_ESTIMATE",r,t,!0,!1,i,"popUp",{}).then(function(e){}),s.executeQueryInput("FETCH_PROCEDURE_DETAILS",r,t,!0,!1,i,"popUp",{}).then(function(e){}),s.executeQueryInput("PREAUTH_VISIT_IP_BASED_SERVICES",r,t,!0,!0,i,"popUp",{}).then(function(t){M.clinic.date=e.patientGlobalDtls.admissionDate,M.diagGridFill(t[1]),M.procGridFill(t[2]);var a=t[3];M.initialFetchServices(a)})},M.initialFetchServices=function(t){M.servGridDefLoad(),M.preAuthDetailsGridOtions.data=M.preAuthDetailsGridOtions.data.slice(0,1),e.netAmount=0;var a=0;angular.forEach(t,function(t){if("N"==t.IS_MATERIAL){var i={rowNum:a+1,specialty:t.SPCLCODE&&t.SPCLDESC?{CODE:t.SPCLCODE,DESCRIPTION:t.SPCLDESC}:void 0,department:t.DEPTCODE&&t.DEPTDESC?{CODE:t.DEPTCODE,DESCRIPTION:t.DEPTDESC}:void 0,priServGroup:{CODE:t.PSRVGRPCODE?t.PSRVGRPCODE:void 0,DESCRIPTION:t.PSRVGRP?t.PSRVGRP:void 0,IS_MATERIAL:"N"},service:t.SERV_SEQ_ID?{DEPTCODE:t.DEPTCODE?t.DEPTCODE:void 0,PSRVGRPCODE:t.PSRVGRPCODE?t.PSRVGRPCODE:void 0,PSRVGRP:t.PSRVGRP?t.PSRVGRP:void 0,DEPT_DESC:t.DEPT_DESC?t.DEPT_DESC:void 0,SERV_NAME:t.SERV_NAME?t.SERV_NAME:void 0,SERV_SEQ_ID:t.SERV_SEQ_ID}:void 0,serviceAmt:t.SERVICE_RATE?t.SERVICE_RATE:void 0,valueAmt:t.TOTALAMOUNT?t.TOTALAMOUNT:void 0,qty:t.QTY?t.QTY:1,status:t.IS_SERVICE_FROM,inclStatus:t.SERV_APPRV_STATUS};a+=1,e.netAmount=t.TOTALAMOUNT>0?e.netAmount+t.TOTALAMOUNT:e.netAmount,M.preAuthDetailsGridOtions.data.push(i)}if("Y"==t.IS_MATERIAL){i={rowNum:a+1,specialty:t.SPCLCODE&&t.SPCLDESC?{CODE:t.SPCLCODE,DESCRIPTION:t.SPCLDESC}:void 0,department:t.DEPTCODE&&t.DEPTDESC?{CODE:t.DEPTCODE,DESCRIPTION:t.DEPTDESC}:void 0,priServGroup:{CODE:t.PSRVGRPCODE?t.PSRVGRPCODE:void 0,DESCRIPTION:t.PSRVGRP?t.PSRVGRP:void 0,IS_MATERIAL:"Y"},service:t.SERV_SEQ_ID?{DEPTCODE:t.DEPTCODE?t.DEPTCODE:void 0,PSRVGRPCODE:t.PSRVGRPCODE?t.PSRVGRPCODE:void 0,PSRVGRP:t.PSRVGRP?t.PSRVGRP:void 0,DEPT_DESC:t.DEPT_DESC?t.DEPT_DESC:void 0,SERV_NAME:t.SERV_NAME?t.SERV_NAME:void 0,SERV_SEQ_ID:t.SERV_SEQ_ID}:void 0,serviceAmt:t.SERVICE_RATE?t.SERVICE_RATE:void 0,valueAmt:t.TOTALAMOUNT?t.TOTALAMOUNT:void 0,qty:t.QTY?t.QTY:1,status:t.IS_SERVICE_FROM,inclStatus:t.SERV_APPRV_STATUS};a+=1,e.netAmount=e.netAmount+t.TOTALAMOUNT,M.preAuthDetailsGridOtions.data.push(i)}}),angular.copy(M.preAuthDetailsGridOtions.data),angular.copy(e.netAmount)},M.srchChange=function(t){if(!(e.patientBannerDetails.patientRecordsDetail||M.admn.firstName||M.admn.lastName||M.admn.fromDate||M.admn.mobileNo||M.admn.email||M.admn.address||M.clinic.cheifComp||M.clinic.reason||M.clinic.date||M.clinic.stay||M.gridOptionsDiag.data.length>0||M.gridOptionsProc.data.length>0||M.preAuthDetailsGridOtions.data.length>1))return!1;{let a={buttonText:M.alertObj.no,buttonText2:M.alertObj.yes},i={buttonCallBack1:function(){"reg"!=t&&"nonReg"!=t||(e.patType="reg"==t?"nonReg":"reg",M.visitSearch=""),"OP"!=t&&"IP"!=t||(e.patVisit="OP"==t?"IP":"OP",M.srchPatient="")},buttonCallBack2:function(){M.srchPatient="",M.srchData.estNo="",M.visitSearch="",M.clear()}},r={buttonClose:function(){}};C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"All captured data will be lost. Do you want to continue?",a,i,r)}},M.openEstimatePopup=function(){N(function(){M.searchClr()},100),E.open("Search Estimation",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/estimateBill/estsearch.modal.popup.html",size:"lg",scope:e}).result.then(function(e){},function(){})},M.searchEstByNo=function(e){M.clear(),M.searchEst(e,1)},M.searchEst=function(t,i){if(t.fromDate-t.toDate>0)return C.warning("Warning","Please enter valid date"),!1;e.estSearchGridOptions=angular.copy(a.estSearchGridOptions),e.estSearchGridOptions.onRegisterApi=function(t){e.estSearchGridOptions=t};var r={url:"HISServices/ApproximateBillService"};r.requestData={operation:"getEstimateBillList",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillVo",mrNo:t.UHID?t.UHID:void 0,patientName:t.patientName?t.patientName:void 0,approxBillNo:t.estNo?t.estNo:void 0,mobileNo:t.mobileNo?t.mobileNo:void 0,approxBillFromDate:t.fromDate?new Date(t.fromDate.setHours(0,0)):void 0,approxBillToDate:t.toDate?new Date(t.toDate.setHours(23,59)):void 0}},h.sendRestRequest(r).then(function(t){if(""!=t.data.HITService.message.approxBillsList[0]&&null!=t.data.HITService.message.approxBillsList[0]){var a=t.data.HITService.message.approxBillsList[0]["com.napier.core.billgeneration.vo.ApproxBillVo"];e.estSearchGridOptions.data=[],Array.isArray(a)?angular.forEach(a,function(t){e.estSearchGridOptions.data.push(t)}):e.estSearchGridOptions.data.push(a)}else C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"No Record Found",M.alertObjBtn,M.alertFunction,M.buttonClose),e.estSearchGridOptions.data=[];1==i&&M.fillPatDetails(a)})},M.advSearchRowClick=function(t){$("input[name=rdUserList]").attr("checked",!0),e.updatePayerListDisable=!1,M.rowsSelected=t.entity},M.selectedEst=function(){M.clear(),M.rowsSelected=Array.isArray(M.rowsSelected)?M.rowsSelected:[M.rowsSelected],M.fillPatDetails(M.rowsSelected[0]),r.dismissAll()},M.searchClr=function(){M.search={},M.search.fromDate="",M.search.toDate="",e.estSearchGridOptions=angular.copy(a.estSearchGridOptions),e.estSearchGridOptions.onRegisterApi=function(t){e.estSearchGridOptions=t},e.estSearchGridOptions.data=[],e.updatePayerListDisable=!0},M.loadExpectedlengthCombo=function(){b.getList("TRN003",[{ident:"0",value:"802"},{ident:"1",value:"802"}]).then(function(e){M.ExpectedlengthcomboList=[];var t=T.getQryComboList(e);angular.forEach(t,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={DT_CODE:a[0].data,DETAIL_DESC:a[1].data};M.ExpectedlengthcomboList.push(i),M.elengthUnit=M.ExpectedlengthcomboList[0].DT_CODE})})},M.changeAmount=function(e,t){var a=""==M.preAuthDetailsGridOtions.data[t].qty?1:M.preAuthDetailsGridOtions.data[t].qty;M.preAuthDetailsGridOtions.data[t].qty=a;var i=M.preAuthDetailsGridOtions.data[t].serviceAmt?M.preAuthDetailsGridOtions.data[t].serviceAmt:0,r=parseFloat(parseFloat(i.toString().slice(0,11)).toFixed(2));M.preAuthDetailsGridOtions.data[t].valueAmt=parseFloat((a*r).toFixed(2))},e.generatePreAuth=function(t){if("1"!=e.reg||null!=e.patientDetailsSearch&&null!=e.patientDetailsSearch.mrNo){M.estimate=!1;var a=angular.copy(M.preAuthDetailsGridOtions.data);M.preAuthDetailsGridOtions.columnDefs[6].visible=!0,M.preAuthDetailsGridOtions.columnDefs[5].visible=!1,M.preAuthDetailsGridOtions.columnDefs[8].visible=!1,M.preAuthDetailsGridOtions.data=angular.copy(a),M.generatePreAuthFlag=!0;var i={};if(!(M.preAuthDetailsGridOtions.data.length>1))return;i.serviceDetails=M.preAuthDetailsGridOtions.data;e.patientDetailsSearch.mrNo,i.serviceDetails}else C.hisAlertMulti("information",M.alertObj.alertTypeInfo,M.alertObj.plzFilMandFild,M.alertObjBtn,M.alertFunction,M.buttonClose),null!=e.patientDetailsSearch&&null!=e.patientDetailsSearch.mrNo||(e.showError=!0),null==e.expectedDate&&(e.showErrorDate=!0),null!=e.bedClassName&&null!=e.bedClassName&&null!=e.bedClassName.gQDataCode||(e.showErrorBed=!0),null!=e.patientDetailsSearch&&null!=e.patientDetailsSearch.ICDCodeValue||(e.showErrorICD=!0),null==e.patientDetailsSearch.LOS&&(e.showErrorLOS=!0),null!=e.dignsisModel&&0!=e.dignsisModel.length||(e.showErrorDig=!0)},e.dateOptions={minDate:new Date},e.open1=function(){e.popup1.opened=!0},e.popup1={opened:!1},e.open2=function(){e.popup2.opened=!0},e.popup2={opened:!1},e.open3=function(){e.popup3.opened=!0},e.popup3={opened:!1},e.open4=function(){e.popup4.opened=!0},e.popup4={opened:!1},M.searchPatientByMR=function(t){if(t.length>0){var a=t;return"getPreAuthPatientServiceDetails",o.patientSearchService(a,"getPreAuthPatientServiceDetails").then(function(t){return e.patientDetailsSearch.result=t.data.HITService.message.approxBillsList[0]["com.napier.core.billgeneration.vo.ApproxBillVo"],null!=e.patientDetailsSearch.result?e.testVal=Array.isArray(e.patientDetailsSearch.result)?e.patientDetailsSearch.result:[e.patientDetailsSearch.result]:e.testVal=[],e.testVal.map(function(e){return e})})}},M.searchPatient=function(e,t){var a="OP"==e?2:1;return R.getVisitBasedPatientDetails(a,t).then(function(t){if(t){if("OP"==e)return t;if("IP"==e)return t}})},e.searchPatientResult=function(t){if(!t)return!1;M.visitSearch?(M.clear(),M.estimateFlow=!0,M.patientType="IP"==e.patVisit?1:2,M.patChange(M.patientType),e.regSeqId=t.regSeqId,e.netAmount=0,e.netAmountGrand=0,e.visitStatus=e.visitStatus?e.visitStatus:1,M.preAuthDetailsGridOtions.data=[{}],n.getPatientBanner(t,e.visitStatus).then(function(a){e.patientGlobalDtls=a,a.bedClassCode&&(M.admn.bedClass=M.bedClassList.find(e=>e.CODE==a.bedClassCode),M.admn.presentBed=M.bedClassList.find(e=>e.CODE==a.bedClassCode)),M.getAccSeqList=[];let i={1:M.getAccSeqList},r=s.executeQueryURLReset();M.getAccSeqListArr=[],s.prepareParamListWithParam("pRegSeqId",t.regSeqId,M.getAccSeqListArr),s.executeQueryInput("GET_ACCOUNT_AND_SUB_ACCOUNT_PHARMACY",M.getAccSeqListArr,i,!0,!0,r,"popUp",{}),e.patientGlobalDtls.userPermision=12,null!=e.patientGlobalDtls.mrNo?e.patientShow=!0:e.patientShow=!1,M.fetchBeforeEstimate()}),l.patientBannerDetail(t.regSeqId).then(function(t){e.patientBannerDetails=t,e.patientRecordsDetail=e.patientBannerDetails.patientRecordsDetail,e.patientValue=e.patientBannerDetails.patientValue})):(e.regSeqId=t.regSeqId,M.srchPatient&&(t.ipAdmSeqId=void 0),e.visitStatus=e.visitStatus?e.visitStatus:1,n.getPatientBanner(t,e.visitStatus).then(function(a){e.patientGlobalDtls=a,M.getAccSeqList=[];let i={1:M.getAccSeqList},r=s.executeQueryURLReset();M.getAccSeqListArr=[],s.prepareParamListWithParam("pRegSeqId",t.regSeqId,M.getAccSeqListArr),s.executeQueryInput("GET_ACCOUNT_AND_SUB_ACCOUNT_PHARMACY",M.getAccSeqListArr,i,!0,!0,r,"popUp",{}),e.patientGlobalDtls.userPermision=12,null!=e.patientGlobalDtls.mrNo?e.patientShow=!0:e.patientShow=!1,R.getPayerBasedMrNo(t.mrNo).then(function(e){M.payerArr=[],angular.forEach(e,function(e,t){B(e,4)})})}),l.patientBannerDetail(t.regSeqId).then(function(t){e.patientBannerDetails=t,e.patientRecordsDetail=e.patientBannerDetails.patientRecordsDetail,e.patientValue=e.patientBannerDetails.patientValue}))},M.srchVisit=function(t){var a={1:M.getPatDetails=[]};M.payer={},e.visitStatus="IP"==e.patVisit?1:2,t.VISIT_NO&&(t=t.VISIT_NO);var i=s.executeQueryURLReset(),r=new Array;s.prepareParamListWithParam("@PAT_TYPE",e.visitStatus,r),s.prepareParamListWithParam("@VISIT_NO",t,r),s.prepareParamListWithParam("@FACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,r),s.executeQueryInput("GET_PATIENT_DTLS_BASED_ON_VISIT",r,a,!0,!0,i,"popUp",{}).then(function(a){a[1]&&(e.regSeqId=a[1][0].RG_SEQ_ID,e.epSeqId=a[1][0].EP_SEQ_ID,a[1][0].regSeqId=a[1][0].RG_SEQ_ID,a[1][0].ipAdmSeqId=a[1][0].IPADM_SEQ_ID?a[1][0].IPADM_SEQ_ID:null,e.searchPatientResult(a[1][0]),M.VisitorIPbasedgetpayerfn(e.visitStatus,t))})};let x=!0;function q(t){if(null!=t.data.HITService.message&&null!=t.data.HITService.message.approxBillVos){t.data.HITService.message.approxBillVos[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxHdSeqId;var a=t.data.HITService.message.approxBillVos[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxBillNo,i={buttonText:M.alertObj.ok},r={buttonCallBack1:function(){M.clear(),M.srchClear()}},n={buttonClose:r.buttonCallBack1()};if(e.Update)l=a+" "+M.alertObj.updatedSucsfuly;else var l=a+" "+M.alertObj.savdSucesFuly;C.hisAlertMulti("success",M.alertObj.alertTypeSucss,l,i,r,n,2e3)}else if(t.data.HITService.message.errorCode)return void C.hisAlertMulti("information",M.alertObj.alertTypeInfo,t.data.HITService.message.errorMessage,M.alertObjBtn,M.alertFunction,M.buttonClose)}M.changePriServ=function(e,a,i,r){x&&(M.preAuthDetailsGridOtions.data[0].valueAmt="",M.preAuthDetailsGridOtions.data[0].qty="",M.preAuthDetailsGridOtions.data[0].serviceAmt=""),x=!0,t.getDepartment(M,e,a,i,r),M.clearFirstRow()},M.changeDept=function(e,a,i,r,n){t.getSpeciltyData(M,e,a.priServGroup,a,i,n),M.clearFirstRow()},M.serviceSearch=function(e,a){return M.clearFirstRow(),t.getServiceList(a,e,M.gnFlow)},M.changeSpecialty=function(e,t){t.service&&(t.service=void 0,M.preAuthDetailsGridOtions.data[0].valueAmt="",M.preAuthDetailsGridOtions.data[0].qty="",M.preAuthDetailsGridOtions.data[0].serviceAmt="")},e.netAmountGrand=0,M.clearFirstRow=function(){M.preAuthDetailsGridOtions.data[0].service||M.preAuthDetailsGridOtions.data[0].valueAmt?M.preAuthDetailsGridOtions.data[0].service||(M.preAuthDetailsGridOtions.data[0].serviceAmt=""):(M.preAuthDetailsGridOtions.data[0].valueAmt="",M.preAuthDetailsGridOtions.data[0].qty="",M.preAuthDetailsGridOtions.data[0].serviceAmt="")},M.addRowGrid=function(a){let i={};return"nonReg"!=e.patType||M.admn.firstName&&M.admn.gender&&M.admn.fromDate&&M.admn.age&&M.admn.mobileNo?"reg"!=e.patType||e.regSeqId?void(a.entity.priServGroup?!a.entity.service||a.entity.qty?a.entity.service&&a.entity.qty<=0?C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Please Enter Quantity greater than Zero",M.alertObjBtn,M.alertFunction,M.buttonClose):a.entity.valueAmt?!M.generatePreAuthFlag||a.entity.qty?a.entity.service&&a.entity.service.SERV_SEQ_ID&&(a.entity.department&&!a.entity.department.CODE||a.entity.specialty&&!a.entity.specialty.CODE||a.entity.priServGroup&&!a.entity.priServGroup.CODE)?C.information("information","Required Primary Service,Department,Speciality"):M.inclusionStatus(a.entity).then(function(r){a.entity.valueAmt=a.entity.valueAmt.toString().replace(/^0+/,""),a.entity.valueAmt.length>12&&(a.entity.valueAmt=parseFloat(parseFloat(a.entity.valueAmt.slice(0,12)).toFixed(2))),a.entity.valueAmt=parseFloat(a.entity.valueAmt),i.inclStatus=r[1][0].INCLUSION_STATUS,i.priServGroup=a.entity.priServGroup,i.department=a.entity.department,i.specialty=a.entity.specialty,i.service=a.entity.service,i.serviceAmt=a.entity.serviceAmt?a.entity.serviceAmt:void 0,i.approxBillDtSeqId=a.entity.approxBillDtSeqId;var n=a.entity.qty?a.entity.qty:0,l=a.entity.serviceAmt?parseFloat(a.entity.serviceAmt):a.entity.valueAmt;if(a.entity.serviceAmt?i.valueAmt=parseFloat((l*n).toFixed(2)):i.valueAmt=a.entity.valueAmt,i.isAmtNlPercFlag=a.entity.isAmtNlPercFlag,i.qty=a.entity.qty,i.status=a.entity.status?a.entity.status:1,null!=i.priServGroup||null!=i.department||null!=i.specialty||null!=i.service&&""!=i.service){{if(a.entity.valueAmt&&parseFloat(a.entity.valueAmt)<=0&&3!=a.entity.isAmtNlPercFlag)return void C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Amount or Qty Can't be zero value",M.alertObjBtn,M.alertFunction,M.buttonClose);let r=!0;if(3!=i.isAmtNlPercFlag?r=null!=i.valueAmt&&""!==i.valueAmt||null!=i.qty&&""!==i.valueAmt:3==i.isAmtNlPercFlag&&(r=!0),r&&!a.entity.editable){if(t.validDuplicate(M,i)){var s=M.preAuthDetailsGridOtions.data.length-1;M.preAuthDetailsGridOtions.data[0].rowNum=0,i.rowNum=M.preAuthDetailsGridOtions.data[s].rowNum+1,M.preAuthDetailsGridOtions.data.push(i),M.preAuthDetailsGridOtions.data[0]=[],M.clearRecordFirst(a),e.netAmount=e.netAmount+parseFloat(i.valueAmt),e.netAmount.toString().length>12&&(e.netAmount=parseFloat(parseFloat(e.netAmount.toString().slice(0,12)).toFixed(2))),M.generatePreAuthFlag&&(e.netAmount=t.calPreAuthAmt(M.preAuthDetailsGridOtions.data)),e.netAmountGrand=angular.copy(e.netAmount)}else C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Already Same Record Exist(s), Kindly Update The Value.",M.alertObjBtn,M.alertFunction,M.buttonClose)}else if(a.entity.editable){s=M.preAuthDetailsGridOtions.data.length-1;M.preAuthDetailsGridOtions.data[0].rowNum=0,i.rowNum=M.preAuthDetailsGridOtions.data[s].rowNum+1,M.preAuthDetailsGridOtions.data[a.entity.recordIndex].valueAmt=M.preAuthDetailsGridOtions.data[a.entity.recordIndex].valueAmt?M.preAuthDetailsGridOtions.data[a.entity.recordIndex].valueAmt:0,e.netAmount=e.netAmount-M.preAuthDetailsGridOtions.data[a.entity.recordIndex].valueAmt,M.preAuthDetailsGridOtions.data[a.entity.recordIndex]=i,e.netAmount=e.netAmount+parseFloat(i.valueAmt),e.netAmount.toString().length>12&&(e.netAmount=parseFloat(parseFloat(e.netAmount.toString().slice(0,12)).toFixed(2))),M.preAuthDetailsGridOtions.data[a.entity.recordIndex].deleteDisble=!1,M.preAuthDetailsGridOtions.data[0]=[],M.clearRecordFirst(a),M.generatePreAuthFlag&&(e.netAmount=t.calPreAuthAmt(M.preAuthDetailsGridOtions.data))}else C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Please Enter Amount or Qty.",M.alertObjBtn,M.alertFunction,M.buttonClose)}e.netAmountGrand=e.netAmount}else C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Please Select Any Group or Service With Amount or Qty.",M.alertObjBtn,M.alertFunction,M.buttonClose)}):C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Please Enter Quantity",M.alertObjBtn,M.alertFunction,M.buttonClose):C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Please Enter Amount",M.alertObjBtn,M.alertFunction,M.buttonClose):C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Please Enter Quantity.",M.alertObjBtn,M.alertFunction,M.buttonClose):C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Please select service or Primary Group.",M.alertObjBtn,M.alertFunction,M.buttonClose)):(C.warning("Warning","Please select a patient before adding a service"),!1):(C.warning("Warning","Please fill mandatory details before adding a service"),!1)},M.inclusionStatus=function(t){e.dataForList={1:e.inclList=[]};var a=s.executeQueryURLReset();return e.inclArray=new Array,s.prepareParamListWithParam("IS_MATERAIL",t.priServGroup.IS_MATERIAL,e.inclArray),s.prepareParamListWithParam("PLAN_SEQ_ID",M.payer.planseqid?M.payer.planseqid:-999,e.inclArray),s.prepareParamListWithParam("PSG_CODE",t.priServGroup.CODE,e.inclArray),s.prepareParamListWithParam("DEPT_CODE",t.department?t.department.CODE:-999,e.inclArray),s.prepareParamListWithParam("SERV_SEQ_ID",t.service?t.service.SERV_SEQ_ID:-999,e.inclArray),s.prepareParamListWithParam("SPEL_CODE",t.specialty?t.specialty.CODE:-999,e.inclArray),s.executeQueryInput("GET_SERVICE_INCLUSION_STATUS",e.inclArray,e.dataForList,!0,!0,a,"popUp",!0)},M.amountOrPercBlur=function(e){2==e.isAmtNlPercFlag&&null!=e.valueAmt&&null!=e.valueAmt&&""!=e.valueAmt&&parseFloat(e.valueAmt)>parseFloat(100)&&(e.valueAmt=100)},M.editGridData=function(e,t){e.entity.rowNum&&(t=M.preAuthDetailsGridOtions.data.findIndex(t=>t.rowNum==e.entity.rowNum)),x=!1,null!=M.prevoisIndex&&M.prevoisIndex!=t&&null!=M.preAuthDetailsGridOtions.data[M.prevoisIndex]&&(M.preAuthDetailsGridOtions.data[M.prevoisIndex].deleteDisble=!1);let a={};e.entity.deleteDisble=!0,M.prevoisIndex=t,a.priServGroup=s.getObjectByAnyValue(M.priServGroupList,e.entity.priServGroup.CODE,"CODE"),a.department=e.entity.department,a.specialty=e.entity.specialty,a.service=e.entity.service,a.serviceAmt=e.entity.serviceAmt,a.valueAmt=e.entity.valueAmt,a.status=e.entity.status,a.isAmtNlPercFlag=M.generatePreAuthFlag?e.entity.isAmtNlPercFlag?e.entity.isAmtNlPercFlag:1:void 0,a.qty=e.entity.qty,a.rowNum=t,a.approxBillDtSeqId=e.entity.approxBillDtSeqId,M.preAuthDetailsGridOtions.data[0]=a,M.preAuthDetailsGridOtions.data[0].editable=!0,M.preAuthDetailsGridOtions.data[0].recordIndex=t,M.toggleText="UPDATE",M.changePriServ(e.entity.priServGroup,M.preAuthDetailsGridOtions.data[0],e.entity,!0)},M.onSelected=function(e,a){e.MRP&&(a.specialty=void 0,a.department=void 0),t.getDropDownBasedService(e,a,M);var i={pServId:e.SERV_SEQ_ID,ptarifSeqId:M.payer.tariffSeqId?M.payer.tariffSeqId:M.tariff.TARIFFCATG,pBedSeqId:M.admn.bedClass?M.admn.bedClass.CODE:-999,pPriority:1,pSplCode:M.preAuthDetailsGridOtions.data[0].specialty?M.preAuthDetailsGridOtions.data[0].specialty.CODE:-999};e.SPL_CODE&&(i.pSplCode=e.SPL_CODE),M.priServGroup=a.priServGroup,M.department=a.department,M.specialty=a.specialty,t.getServiceRate(e,i,a,M)},M.clearRecordFirst=function(e){null!=e&&e.entity.editable&&(M.preAuthDetailsGridOtions.data[e.entity.recordIndex].deleteDisble=!1,e.entity.editable=!1,M.toggleText=""),M.preAuthDetailsGridOtions.data[0]=[],M.preAuthDetailsGridOtions.data[0].isAmtNlPercFlag="1",M.preAuthDetailsGridOtions.data[0].valueAmt="",M.preAuthDetailsGridOtions.data[0].qty="",M.preAuthDetailsGridOtions.data[0].serviceAmt="",M.speciltyList=[],M.deptList=[]},M.deleteDiagProcRecord=function(e,t){M.deleteSet=e.entity;let a={buttonText:M.alertObj.no,buttonText2:M.alertObj.yes},i={buttonCallBack1:function(){},buttonCallBack2:function(){var e=M.gridOptionsDiag.data.splice(t,1);e[0].STATUS=2,M.deleteDiag.push(e[0])}},r={buttonCallBack1:function(){},buttonCallBack2:function(){var e=M.gridOptionsProc.data.splice(t,1);e[0].STATUS=2,M.deleteProc.push(e[0])}},n={buttonClose:function(){}};e.entity.ICDCODE&&C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Do You Want To Delete The Record",a,i,n),e.entity.CODE&&C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Do You Want To Delete The Record",a,r,n)},M.deleteRecord=function(a,i){M.deleteSet=a.entity;let r={buttonText:M.alertObj.no,buttonText2:M.alertObj.yes},n={buttonCallBack1:function(){},buttonCallBack2:function(){if(a.entity.approxBillDtSeqId){var r=M.deleteSet;r.gnTranStatus=2,M.deleteRecordSave.push(r)}i=M.preAuthDetailsGridOtions.data.findIndex(e=>e.rowNum==a.entity.rowNum),M.preAuthDetailsGridOtions.data.splice(i,1),M.deleteSet.valueAmt=null==M.deleteSet.valueAmt?0:M.deleteSet.valueAmt,e.netAmount=e.netAmount.toFixed(2)-M.deleteSet.valueAmt.toFixed(2),M.generatePreAuthFlag&&(e.netAmount=t.calPreAuthAmt(M.preAuthDetailsGridOtions.data)),e.netAmountGrand=e.netAmount}};C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Do You Want To Delete The Record",r,n,{buttonClose:function(){}})},M.getPreAuth=function(e){M.preAuthValue=2==e?t.calPreAuthAmt(M.preAuthDetailsGridOtions.data):0},e.saveEstimateBill=function(t){if(!("nonReg"!=e.patType||t.admn.firstName&&t.admn.gender&&t.clinic.cheifComp&&t.admn.fromDate&&t.admn.age&&t.admn.mobileNo))return C.warning("Warning","Please fill mandatory details before saving"),!1;if(1==t.gnFlow&&!t.admn.bedClass||0==t.gridOptionsDiag.data.length)return C.warning("Warning","Please fill Clinical details before saving"),!1;e.drugObject=[];var a=t.preAuthDetailsGridOtions.data;if(e.servicePackageCom=[],a.length>1){for(var i=1;i<a.length;i++){if(!a[i].gnTranStatus&&a[i].service&&a[i].service.SERV_SEQ_ID){if(!a[i].priServGroup)return void C.information("Information","Required Primary Service");if(a[i].department&&!a[i].department.CODE||a[i].specialty&&!a[i].specialty.CODE||a[i].priServGroup&&!a[i].priServGroup.CODE)return void C.information("Information","Required Primary Service,Department,Speciality")}if(a[i].service&&a[i].service.SERV_SEQ_ID)var r=4;else if(a[i].specialty&&a[i].priServGroup&&a[i].department&&a[i].priServGroup.CODE&&a[i].department.CODE&&a[i].specialty.CODE)r=3;else if(a[i].priServGroup&&a[i].department&&a[i].priServGroup.CODE&&a[i].department.CODE)r=2;else if(a[i].priServGroup&&a[i].priServGroup.CODE)r=1;"N"==a[i].priServGroup.IS_MATERIAL?e.servicePackageCom.push({serviceCode:a[i].service?a[i].service.SERV_CODE:void 0,serviceSeqId:a[i].service?a[i].service.SERV_SEQ_ID:void 0,serviceName:a[i].service?a[i].service.SERV_NAME:void 0,serviceRate:a[i].serviceAmt?parseFloat(a[i].serviceAmt):void 0,serviceQty:a[i].qty?parseInt(a[i].qty):void 0,serviceTax:0,primaryServCode:a[i].priServGroup.CODE,deptCode:a[i].department?a[i].department.CODE:void 0,specilityCode:a[i].specialty?a[i].specialty.CODE:void 0,serviceDiscountAmt:0,chargeableAmt:a[i].valueAmt,expcServDate:"9999-12-31 23:59:59.000",gnTranStatus:a[i].gnTranStatus?a[i].gnTranStatus:1,isAmtPercNl:t.generatePreAuthFlag?a[i].isAmtNlPercFlag?a[i].isAmtNlPercFlag:1:void 0,hierarchyLevel:r,isOrderFrom:a[i].status,isApprovalRequired:a[i].inclStatus?a[i].inclStatus:4}):"Y"==a[i].priServGroup.IS_MATERIAL&&e.drugObject.push({materialName:a[i].service?a[i].service.SERV_NAME:void 0,materialCode:a[i].service?a[i].service.SERV_SEQ_ID:void 0,price:a[i].serviceAmt?parseFloat(a[i].serviceAmt):void 0,quantaty:a[i].qty?parseInt(a[i].qty):0,totalPrice:a[i].valueAmt,expcMtrlDate:"9999-12-31 23:59:59.000",gnTranStatus:a[i].gnTranStatus?a[i].gnTranStatus:1,materialCategory:a[i].priServGroup.CODE,materialGroup:a[i].department?a[i].department.CODE:void 0,materialSubGroup:a[i].specialty?a[i].specialty.CODE:void 0,hierarchyLevel:r,isOrderFrom:a[i].status,isApprovalRequired:a[i].inclStatus?a[i].inclStatus:4})}e.packageData=[],e.dignsisModelSave=[],e.procedureModelSave=[];var n,l=moment(t.admn.fromDate).format("YYYY-MM-DD")?moment(t.admn.fromDate).format("YYYY-MM-DD"):"";(t.srchPatient||t.visitSearch)&&(t.admn.title=e.patientRecordsDetail.title.code,t.admn.firstName=e.patientRecordsDetail.firstName,t.admn.mobileNo=e.patientRecordsDetail.mobileNo,t.admn.age=e.patientRecordsDetail.age,t.admn.gender=e.patientRecordsDetail.sex.code,l=moment(e.patientRecordsDetail.dateOfBirth).format("YYYY-MM-DD"),n=t.visitSearch&&"IP"==e.patVisit?e.patientGlobalDtls.ipNo:e.patientGlobalDtls.visitNo),t.obj={approxBillHdSeqId:t.approxBillHdSeqId?t.approxBillHdSeqId:void 0,regSeqId:e.regSeqId?e.regSeqId:void 0,visitOrIpNo:n,accountSeqId:e.patientGlobalDtls?e.patientGlobalDtls.accSeqId:void 0,subAccSeqId:e.patientGlobalDtls?e.patientGlobalDtls.subAccSeqId:void 0,patientType:"nonReg"==e.patType?2:1,bedClassSeqId:1==t.gnFlow&&t.admn.bedClass?t.admn.bedClass.CODE:void 0,titleCode:t.admn.title,emailId:t.admn.email,address:t.admn.address,patientFirstName:t.admn.firstName,patientLastName:t.admn.lastName,mobileNo:t.admn.mobileNo,dob:l+" 00:00:00.00",strPatientAge:t.admn.age,patientcategorySeqId:t.tariff?t.tariff.PCATG_SEQ_ID:void 0,strPatientGender:t.admn.gender,tariffSeqId:t.payer.tariffSeqId?t.payer.tariffSeqId:t.tariff.TARIFFCATG,gnTranStatus:1,gnFlow:t.gnFlow,incSeqId:t.payer.payerName?t.payer.payerseqid:void 0,incPlanSeqId:t.payer.planseqid?t.payer.planseqid:void 0,policyNumber:t.payer.policyNumber?t.payer.policyNumber:void 0,cardNumber:t.payer.cardNumber?t.payer.cardNumber:void 0,planValidFromDate:t.payer.savevalidFrom?moment(t.payer.savevalidFrom).format("YYYY-MM-DD")+" "+moment(t.payer.savevalidFrom).format("H:M:S")+".00":void 0,planValidToDate:t.payer.savevalidTo?moment(t.payer.savevalidTo).format("YYYY-MM-DD")+" "+moment(t.payer.savevalidTo).format("H:M:S")+".00":void 0,reasonForAdmission:1==t.gnFlow?t.clinic.reason:void 0,estLos:1==t.gnFlow&&""!=t.clinic.stay?t.clinic.stay:void 0,losType:1==t.gnFlow&&""!=t.clinic.lenStay?t.clinic.lenStay:void 0,payerType:t.payer.payerName?4:2,chiefComplaints:t.clinic.cheifComp,expAdmDate:t.clinic.date?moment(t.clinic.date).format("YYYY-MM-DD")+" "+moment(t.clinic.date).format("H:M:S")+".00":void 0,approxBillDate:moment().format("YYYY-MM-DD")+" "+moment().format("H:M:S")+".00",grossAmt:parseFloat(e.netAmount),discountAmt:e.discounts},t.gridOptionsDiag.data=t.gridOptionsDiag.data.concat(t.deleteDiag),t.gridOptionsProc.data=t.gridOptionsProc.data.concat(t.deleteProc),angular.forEach(t.gridOptionsDiag.data,function(a){t.diagObj={diagSeqId:a.APPROX_DIAG_SEQ_ID?a.APPROX_DIAG_SEQ_ID:void 0,StrDiagnosisCode:a.ICDCODE,StrDiagnosisName:a.DESCRIPTION,gnTranStatus:a.STATUS?a.STATUS:1,createdBy:JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID},e.dignsisModelSave.push(t.diagObj)}),angular.forEach(t.gridOptionsProc.data,function(a){t.procObj={approxProcSeqId:a.APPROX_PROC_SEQ_ID?a.APPROX_PROC_SEQ_ID:void 0,procCode:a.CODE,procName:a.DESCRIPTION,gnTranStatus:2==a.STATUS?a.STATUS:1,isEstimateOrPreauth:1,createdBy:JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID},e.procedureModelSave.push(t.procObj)}),p.saveEstimateAllDetails(t.obj,e.servicePackageCom,e.drugObject,e.dignsisModelSave,e.procedureModelSave).then(function(a){null==a.data.HITService.message||null==a.data.HITService.message.approxBillPackageDtlsVos&&null==a.data.HITService.message.approxBillServiceDtlsVos&&null==a.data.HITService.message.approxBillVos&&null==a.data.HITService.message.diagonsisVos&&null==a.data.HITService.message.materialVos||(t.obj.approxHdSeqId=a.data.HITService.message.approxBillVos[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxHdSeqId,t.generatePreAuthFlag?A.savePreAuthForReg(t.obj,e.servicePackageCom,e.drugObject,e.dignsisModelSave,[],[]).then(function(e){q(e)}):q(a))})}else C.information("Information","Please fill service details")},M.isChangedVal=function(t){null!=t&&""!=t?null!=e.netAmountGrand&&parseFloat(t)<parseFloat(e.netAmountGrand)&&(e.netAmount=angular.copy(e.netAmountGrand)):null!=e.netAmountGrand?e.netAmount=e.netAmountGrand:e.netAmount=0},M.clear=function(t){1==t&&M.srchClear(),M.estimateFlow=!1,G=0,e.activeFirst=1,M.approxBillHdSeqId="",sessionStorage.removeItem("newCurrentPatientInfo"),M.PatPayerData={},e.patBanShow=!1,e.regSeqId=void 0,e.patDetails={},M.isBillOrServiceFlag=2,M.preAuthDetailsGridOtions.data=[],[],e.patientGlobalDtls={},e.patientBannerDetails={},M.clearRecordFirst(),M.filesUploaded=[],M.tempPayerArr=[],e.netAmount=0,e.netAmountGrand=0,e.remarks=void 0,e.estimateSct=void 0,e.patientDetailsSearch={},M.uploadedfileNames=[],M.uploadingFile=!1,M.patientType="1",M.patChange(M.patientType),M.admn={},M.admn.DOB="1",M.diagnosis={},M.diagnosis.type="1",M.procedure={},M.procedure.type="1",M.clinic={},M.gridOptionsDiag.data=[],M.gridOptionsProc.data=[],M.etbFiles=[],M.deleteFiles=[],M.numOffiles=0,M.totalFileSize=0,M.payer={},M.bedClassList=M.opBedClassList,0,M.payerArr=[],M.srchData={},M.savepayerinfo=[]},M.srchClear=function(){M.clear(),M.srchData.estNo="",M.srchPatient="",M.visitSearch="",e.patType="reg",e.patVisit="OP"},M.resetGrid=function(){if(M.srchPatient)M.servGridDefLoad(),e.netAmount=0;else if(null==e.patDetails.APPROX_BILL_HD_SEQ_ID)M.fetchBeforeEstimate();else{M.servGridDefLoad(),M.preAuthDetailsGridOtions.data=M.preAuthDetailsGridOtions.data.slice(0,1),e.recalculatedServices={1:e.recalServices=[],2:e.recalMtrls=[]};var t=s.executeQueryURLReset();e.recalServicesArr=new Array,s.prepareParamListWithParam("pEstimateHdSeqId",e.patDetails.APPROX_BILL_HD_SEQ_ID,e.recalServicesArr),s.prepareParamListWithParam("pFacility_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,e.recalServicesArr),s.prepareParamListWithParam("pPractice_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,e.recalServicesArr),s.prepareParamListWithParam("pPlan_Seq_Id",M.payer.planseqid?M.payer.planseqid:-999,e.recalServicesArr),s.prepareParamListWithParam("pBED_CLASS",M.admn.bedClass?M.admn.bedClass.CODE:-999,e.recalServicesArr),s.prepareParamListWithParam("pEN_SEQ_ID",e.patientGlobalDtls.encounterSeqId?e.patientGlobalDtls.encounterSeqId:-999,e.recalServicesArr),s.executeQueryInput("GET_BL_GET_APPROX_BILL_SERVICE_DTLS",e.recalServicesArr,e.recalculatedServices,!0,!1,t,"popUp",!0),s.executeQueryInput("GET_BL_GET_APPROX_BILL_MATERIALS_DTLS",e.recalServicesArr,e.recalculatedServices,!0,!0,t,"popUp",!0).then(function(t){e.netAmount=0,M.serviceGridFill(t[1]),M.mtrGridFill(t[2])})}},M.autoSearchOnDiagnosis=function(t,a){if(t&&(t.length>0&&1==a||t.length>1&&2==a)){e.diagnosisList=[],e.multipleComboDataForList={1:e.diagnosisList};var i=s.executeQueryURLReset();return e.diagnosisArray=new Array,s.prepareParamListWithParam("TYPE",M.diagnosis.type,e.diagnosisArray),s.prepareParamListWithParam("DIAG_CODE",1==a?t:"",e.diagnosisArray),s.prepareParamListWithParam("DIAG_DESC",2==a?t:"",e.diagnosisArray),s.executeQueryInput("USP_GET_DIAGNOSIS_DTLS",e.diagnosisArray,e.multipleComboDataForList,!0,!0,i,"popUp",!0).then(function(e){return e[1].map(function(e){return 1==M.diagnosis.type?(e.SEARCH_NAME=e.DESCRIPTION,e.SEARCH_CODE=e.ICDCODE):(e.SEARCH_NAME=e.HOSP_DIAG_DESC,e.SEARCH_CODE=e.HOSP_DIAG_CODE),e})})}},M.selectOnSuggestedDiagnosis=function(e,t){if(M.checkReg()){var a=e;a.selectDiag=t,L.setDiagProc(a).then(function(e){M.gridOptionsDiag.data[0]&&M.gridOptionsDiag.data.find(t=>t.ICDCODE==e.ICDCODE)?C.warning("Warning","Diagnosis Already Exists"):M.gridOptionsDiag.data.push(e)}),M.diagnosis.desc="",M.diagnosis.code=""}},M.openDiagnosis=function(e){M.checkReg()&&E.open("Diagnosis Search",{animation:!0,templateUrl:"app/consumer/his17_1/operationtheater/screens/surgeryRequestNew/templates/diagnoses.model.html",size:"lg",controller:"diagnosisModalController",resolve:{diagnosis:function(){return e},selectedDiagnosisList:function(){return[]},isMultiSelect:function(){return!1}}}).result.then(function(t){t.selectDiag=e.type,L.setDiagProc(t).then(function(e){M.gridOptionsDiag.data[0]&&M.gridOptionsDiag.data.find(t=>t.ICDCODE==e.ICDCODE)?C.warning("Warning","Diagnosis Already Exists"):M.gridOptionsDiag.data.push(e)})},function(){})},M.autoSearchOnProcedure=function(t,a){if(t&&(t.length>0&&1==a||t.length>1&&2==a)){var i=t.toString();i.length>0&&2==a&&(i="%"+i+"%"),e.procedureList=[],e.multipleComboDataForList={1:e.procedureList};var r=s.executeQueryURLReset();return e.procedureArray=new Array,s.prepareParamListWithParam("TYPE",M.procedure.type,e.procedureArray),s.prepareParamListWithParam("PROC_CODE",1==a?i:"",e.procedureArray),s.prepareParamListWithParam("PROC_DESC",2==a?i:"",e.procedureArray),s.executeQueryInput("USP_GET_PROCEDURE_DTLS",e.procedureArray,e.multipleComboDataForList,!0,!0,r,"popUp",!0).then(function(e){return e[1].map(function(e){return 1==M.procedure.type?(e.SEARCH_NAME=e.DESCRIPTION,e.SEARCH_CODE=e.CODE):(e.SEARCH_NAME=e.SUR_NAME,e.SEARCH_CODE=e.SUR_CODE),e})})}},M.selectOnSuggestedProcedure=function(e,t){if(M.checkReg()){var a=e;a.selectProc=t,L.setDiagProc(a).then(function(e){M.gridOptionsProc.data[0]&&M.gridOptionsProc.data.find(t=>t.CODE==e.CODE)?C.warning("Warning","Procedure Already Exists"):M.gridOptionsProc.data.push(e)}),M.procedure.desc="",M.procedure.code=""}},M.openProcedure=function(e){M.checkReg()&&E.open("PROCEDURE SEARCH",{animation:!0,templateUrl:"app/consumer/his17_1/operationtheater/screens/surgeryRequestNew/templates/procedure.model.html",size:"lg",controller:"procedureModalController",resolve:{procedure:function(){return e}}}).result.then(function(t){t.selectProc=e.type,L.setDiagProc(t).then(function(e){M.gridOptionsProc.data[0]&&M.gridOptionsProc.data.find(t=>t.ICD9==e.ICD9)?C.warning("Warning","Procedure Already Exists"):M.gridOptionsProc.data.push(e)})},function(){})},M.patChange=function(t){if(e.activeFirst=1,M.preAuthDetailsGridOtions.data.length>1){let a={buttonText:M.alertObj.no,buttonText2:M.alertObj.yes},i={buttonCallBack1:function(){M.patientType="2"==t?"1":"2"},buttonCallBack2:function(){M.clearClinic(t),e.activeFirst=1,M.resetGrid()}},r={buttonClose:function(){}};C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Unsaved data will be lost. Do you want to continue?",a,i,r)}else M.clearClinic(t)},M.clearClinic=function(e){M.admn.bedClass="",M.patChange.type=2==e,M.patientType=e,M.gnFlow=e,M.clinic.reason="",M.clinic.date="",M.clinic.stay="",M.clinic.lenStay=""},M.bedChange=function(e){if(!(M.preAuthDetailsGridOtions.data.length>1))return!1;{let t={buttonText:M.alertObj.no,buttonText2:M.alertObj.yes},a={buttonCallBack1:function(){return M.admn.bedClass=M.admn.presentBed,!1},buttonCallBack2:function(){M.resetGrid(),M.admn.presentBed=e}},i={buttonClose:function(){}};C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Unsaved data will be lost. Do you want to continue?",t,a,i)}},M.ageToDate=function(e){parseInt(e)>150&&(C.warning("Warning","Age should be less than 151"),M.admn.fromDate="",M.admn.age="");var t=moment().subtract(e,"y");M.admn.fromDate=t.toDate(),M.admn.DOB="2"},M.dateToAge=function(e){var t=moment(e);if(moment().diff(t)<0)return M.admn.fromDate=null,M.admn.age=null,!1;var a="",i=moment().diff(t,"years");t.add(i,"years");var r=moment().diff(t,"months");t.add(r,"months");var n=moment().diff(t,"days");i>0&&(a=i+"y "),r>=0&&(a=a+""+r+"m "),n>=0&&(a=a+""+n+"d"),""==a&&(a="0y 0m 0d"),M.admn.age=a,M.admn.DOB="1"},M.etbFiles=[],M.deleteFiles=[],M.numOffiles=0,M.totalFileSize=0,M.open=function(e){E.open("UPLOAD FILES",{animation:!0,templateUrl:"app/consumer/his17_2/ADT/screens/patientAdmission/sections/upload.files.modal.html",size:e,controller:"uploadFileController",controllerAs:"upfileCtrl",backdrop:"static",resolve:{addedFiles:function(){return M.etbFiles},totalFileSize:function(){return M.totalFileSize},regSeqId:function(){return M.rgSeqId}}}).result.then(function(e){M.numOffiles=M.numOffiles+e.noffiles,angular.forEach(e.files,function(e){e.fileName=e.name,M.etbFiles.push(e)}),M.totalFileSize=e.filsTotalSize,angular.forEach(e.seqIds,function(e){e.fileName=e.name,M.deleteFiles.push(e)}),O.log("modal selected Row: "+e)},function(){O.info("Modal dismissed at: "+new Date)})},M.dynamicPopoverForUploadFile={templateUrl:"myPopoverTemplateInAdm.html"},M.viewUploadedFile=function(e){M.adtAdmPatPopOverCls=!1;w.viewUploadedFileFun(e).then(function(e){if(!angular.isUndefined(e.data.HITService.message.napierDocumentList[0]["com.napier.core.service.vo.uploadfile.NapierDocument"])){var t=e.data.HITService.message.napierDocumentList[0]["com.napier.core.service.vo.uploadfile.NapierDocument"].uploadDocumnt[0],a=e.data.HITService.message.napierDocumentList[0]["com.napier.core.service.vo.uploadfile.NapierDocument"].docExtension,i=t.replace("dataimage/jpegbase64","").replace("dataapplication/pdfbase64","").replace("dataapplication/vndopenxmlformatsofficedocumentwordprocessingmldocumentbase6\n4","").replace("dataimage/pngbase64","").replace("\n","");i=i.slice(0,-2);var r=a.toLowerCase();if("pdf"==r||"jpg"==r||"png"==r||"gif"==r||"jpeg"==r||"tif"==r||"tiff"==r||"bmp"==r)V(i,r);else if("xls"==r){var n=(s="data:application/vnd.ms-excel,")+i;window.open(n,"_self")}else if("xlsx"==r){var l=(s="data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")+";base64,"+i;window.open(l,"_self")}else if("docx"==r||"doc"==r){var s="data:application/octet-stream;base64,";downloadWithName(s+i,"download.docx")}}})};var V=function(e,t){E.open("",{animation:!0,templateUrl:"app/consumer/his17_2/ADT/screens/patientAdmission/sections/upload.image.view.modal.html",size:"lg",controller:"viewUploadsCtrl",controllerAs:"viewCtrl",resolve:{imgUrl:function(){return e},extF:function(){return t}}})};function B(e,t){let a={};2==t||1==t||4==t||3==t?(a.CARD_NUMBER=e.CARD_NUMBER,a.POLICY_NO=e.POLICY_NO,a.COMP_NAME=e.COMP_NAME,a.INC_SEQ_ID=e.INC_SEQ_ID,a.PLAN_NAME=e.PLAN_NAME,a.IN_PLC_SEQ_CD=e.IN_PLC_SEQ_CD,a.PI_FROM_DATE=moment(e.PI_FROM_DATE,"DD/MM/YYYY").toDate(),a.PI_TO_DATE=moment(e.PI_TO_DATE,"DD/MM/YYYY").toDate(),M.payerArr.push(a),a={}):5==t&&(a.CARD_NUMBER=e.cardNumber,a.POLICY_NO=e.policyNumber,a.COMP_NAME=e.payerName,a.INC_SEQ_ID=e.payerseqid,a.PLAN_NAME=e.planName,a.IN_PLC_SEQ_CD=e.planseqid,a.patCatgCode=e.patCatgCode,a.PI_FROM_DATE=moment(e.validFrom,"DD/MM/YYYY").toDate(),a.PI_TO_DATE=moment(e.validTo,"DD/MM/YYYY").toDate(),M.payerArr.push(a),a={})}M.deleteFile=function(e,t){var a=_.findIndex(t,function(t){return t.name==e.name});_.findIndex(M.etbFiles,function(t){t.name==e.name&&M.etbFiles.splice(a,1)}),w.deleteFileORRetriveFileFun("removeDocumentList",t[a],angular.fromJson(sessionStorage.userContextObj)).then(function(t){angular.isUndefined(t.data.HITService.message.napierDocumentList[0]["com.napier.core.service.vo.uploadfile.NapierDocument"])||C.success("Success",e.name+" file deleted successfully ")}),M.deleteFiles.splice(a,1),M.numOffiles=M.numOffiles-1},M.checkReg=function(){return"nonReg"!=e.patType||M.admn.firstName&&M.admn.gender&&M.admn.title&&M.admn.fromDate&&M.admn.age&&M.admn.mobileNo?!("reg"==e.patType&&!e.regSeqId)||(C.warning("Warning","Please select a patient before selecting Diagnosis or Procedure"),!1):(C.warning("Warning","Please fill patient details before filling clinical details"),!1)},M.mobileChk=function(e){if(null==e)return C.warning("Warning","Please enter valid mobile number"),!1},M.cheifComp=function(){var t={mrno:e.patientDetailsSearch.mrNo,epSeqId:e.epSeqId};sessionStorage.setItem("newCurrentPatientInfo",angular.toJson(t)),E.open("Cheif Complaints",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/estimateBill/estimate.chiefcomplaints.html",size:"lg",controller:"patientAssessmentDCCrtl",resolve:{}}).result.then(function(e){},function(){})},M.openPayerpopup=function(){0!=M.tempPayerArr.length&&(M.payerArr=M.tempPayerArr);let t=!0;if(M.payer.payerseqid&&M.payer.planseqid&&M.payer.policyNumber){for(let e=0;e<M.payerArr.length;e++)M.payerArr[e].INC_SEQ_ID==M.payer.payerseqid&&M.payerArr[e].IN_PLC_SEQ_CD==M.payer.planseqid&&M.payerArr[e].POLICY_NO==M.payer.policyNumber?(t=!1,M.payerArr[e].select=!0):M.payerArr[e].select=!1;1==t&&B(M.payer,5)}M.savepayerinfo.push({payerType:3,regSeqId:e.regSeqId,patientType:e.visitStatus,gnStatus:1,insTypeSeqCd:1,piInPriority:1,isNewPayer:!0}),E.open("Payer Search",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_new_screen/pre_auth_payer_search.html",size:"lg",controller:"PreAuthorizationPayerModalController",controllerAs:"prePay",resolve:{payer:function(){return M.payerArr},patientdata:function(){return M.savepayerinfo[0]}}}).result.then(function(t){if(M.preAuthDetailsGridOtions.data.length>1){let a={buttonText:M.alertObj.no,buttonText2:M.alertObj.yes},i={buttonCallBack1:function(){},buttonCallBack2:function(){t&&t.length>0&&(M.payer.payerName=t[0].prePay.payer,M.payer.planName=t[0].prePay.plan,M.payer.policyNumber=t[0].prePay.policyno,M.payer.cardNumber=t[0].prePay.cardno,M.payer.validFrom=t[0].prePay.viewfromDate,M.payer.validTo=t[0].prePay.viewtoDate,M.payer.savevalidFrom=t[0].prePay.fromDate,M.payer.savevalidTo=t[0].prePay.toDate,M.payer.patCatgCode=t[0].prePay.payerobj.patCatgCode,M.payer.payerseqid=t[0].prePay.payerobj.incSeqId,M.payer.planseqid=t[0].prePay.planobj.INC_PLAN_SEQ_ID,M.payer.tariffSeqId=t[0].prePay.tariffId?t[0].prePay.tariffId:t[0].prePay.planobj.TARIFF_SEQ_ID,M.resetGrid(),M.bedClassList=[],e.activeFirst=1,M.loadBedClass(t[0].prePay.payerobj,t[0].prePay.planobj))}},r={buttonClose:function(){}};C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Unsaved data will be lost. Do you want to continue?",a,i,r)}else M.payer.payerName=t[0].prePay.payer,M.payer.planName=t[0].prePay.plan,M.payer.policyNumber=t[0].prePay.policyno,M.payer.cardNumber=t[0].prePay.cardno,M.payer.validFrom=t[0].prePay.viewfromDate,M.payer.validTo=t[0].prePay.viewtoDate,M.payer.savevalidFrom=t[0].prePay.fromDate,M.payer.savevalidTo=t[0].prePay.toDate,M.payer.patCatgCode=t[0].prePay.payerobj.patCatgCode,M.payer.payerseqid=t[0].prePay.payerobj.incSeqId,M.payer.planseqid=t[0].prePay.planobj.INC_PLAN_SEQ_ID,M.payer.tariffSeqId=t[0].prePay.tariffId?t[0].prePay.tariffId:t[0].prePay.planobj.TARIFF_SEQ_ID,M.loadBedClass(t[0].prePay.payerobj,t[0].prePay.planobj)},function(){})},M.VisitorIPbasedgetpayerfn=function(e,t){return R.getVisitorIPBasedPayerDetails(e,t).then(function(t){if(t[0].COMP_NAME){M.payer.payerName=t[0].COMP_NAME,M.payer.planName=t[0].PLAN_NAME,M.payer.policyNumber=t[0].POLICY_NO,M.payer.cardNumber=t[0].CARD_NUMBER,M.payer.validFrom=moment(t[0].PI_FROM_DATE).format("DD/MM/YYYY"),M.payer.validTo=moment(t[0].PI_TO_DATE).format("DD/MM/YYYY"),M.payer.payerseqid=t[0].INC_SEQ_ID,M.payer.planseqid=t[0].IN_PLC_SEQ_CD,M.payer.tariffSeqId=t[0].TARIFF_CATG_CODE,M.PatPayerData=t,angular.forEach(M.PatPayerData,function(t,a){B(t,e)});var a={},i={};a.incSeqId=t[0].INC_SEQ_ID,i.INC_PLAN_SEQ_ID=t[0].IN_PLC_SEQ_CD,M.loadBedClass(a,i)}})},M.loadBedClass=function(e,t){let a=[],i={1:a=[]},r=s.executeQueryURLReset(),n=new Array;return s.prepareParamListWithParam("@PRACTICE_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,n),s.prepareParamListWithParam("@INC_SEQ_ID",e.incSeqId,n),s.prepareParamListWithParam("@PLAN_SEQ_ID",t.INC_PLAN_SEQ_ID,n),s.executeQueryInput("GET_PLAN_BED_CLASS_DETAILS",n,i,!0,!0,r,"popUp",{}).then(function(e){M.bedClassList=e[1]})},M.removePayer=function(){if(null==M.payer.payerName)return C.warning("Warning","Please select a payer"),!1;if(M.preAuthDetailsGridOtions.data.length>1){let t={buttonText:M.alertObj.no,buttonText2:M.alertObj.yes},a={buttonCallBack1:function(){},buttonCallBack2:function(){M.payer={},M.bedClassList=M.opBedClassList,M.admn.bedClass="",e.activeFirst=1,M.resetGrid()}},i={buttonClose:function(){}};C.hisAlertMulti("information",M.alertObj.alertTypeInfo,"Unsaved data will be lost. Do you want to continue?",t,a,i)}else M.payer={},M.bedClassList=M.opBedClassList,M.admn.bedClass="",e.activeFirst=1,M.bedClassList=M.opBedClassList},M.genPreAuth=function(){var t={mrno:e.patientGlobalDtls.mrNo,visitType:M.gnFlow,APPROX_BILL_HD_SEQ_ID:M.approxBillHdSeqId};sessionStorage.setItem("estPatInfo",angular.toJson(t)),m.go("index.billingSub.preAuthNew")},function(){M.clear(1),M.selfTariffList={1:M.selfTariff=[]};var t=s.executeQueryURLReset();M.emptyDefaultArr=new Array,s.executeQueryInput("PACKAGE_TARIFF_CATEGORY_SELF",M.emptyDefaultArr,M.selfTariffList,!0,!0,t,"popUp",{}).then(function(t){e.selfTariff=t[1],M.tariff=e.selfTariff[0]}),P.loadCombos("getGender").then(function(e){angular.isArray(e)&&(M.GenderCombo=e)}),P.loadCombos("getTitle").then(function(e){angular.isArray(e)&&(M.titleCombo=e)}),M.typeSearch=function(e){if(e.length>2){var t=[{ident:"1",value:e},{ident:"2",value:e},{ident:"3",value:e},{ident:"4",value:e},{ident:"5",value:e},{ident:"6",value:e},{ident:"7",value:e},{ident:"8",value:e},{ident:"9",value:e},{ident:"10",value:e}];return b.getList("ADT_IP_SEARCH",t).then(function(e){M.typeSearchList=[];var t=T.getQryComboList(e);return angular.forEach(t,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={PATIENT_NAME:a[0].data,IP_NO:a[1].data,RG_INT_MR_NO:a[2].data,AGE:a[3].data,DOB:a[4].data,RG_MOBILE_NO:a[5].data,GENDER:a[6].data,IPADM_SEQ_ID:a[7].data,ADMISSION_STATUS:a[8].data,RG_SEQ_ID:a[9].data};M.typeSearchList.push(i)}),(M.typeSearchList instanceof Array?M.typeSearchList:[M.typeSearchList]).map(function(e){return e})})}},M.loadExpectedlengthCombo(),M.opBedDataList={1:M.opBedClassList=[]};var a=s.executeQueryURLReset();M.tariffClsListArr=new Array,s.prepareParamListWithParam("@pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,M.tariffClsListArr),s.executeQueryInput("SP_USP_BL_GET_TARIFF_CLASS",M.tariffClsListArr,M.opBedDataList,!0,!0,a,"popUp",{}).then(function(e){M.bedClassList=e[1]})}()}])}(),(app=angular.module("napierContainerUi")).controller("searchCtrl",["$scope","$uibModalInstance","bedClassId","regSeqId","serviceSearch","gridDefination","QueryService","SearchServices","hisAlertService","hisTranslationsService","hisTranslationsGlobalLang",function(e,t,a,i,r,n,l,s,o,c,d){var p=this;c.loadModule("billing");var u=d.getLanguageToSet();c.changeLanguage(u),e.serviceDetailsGridOptionsS=n.serviceSearchGridOptions,p.priServiceType=[],p.multipleComboDataForList={1:p.priServiceType};var m=l.executeQueryURLReset();p.priServiceTypeList=new Array,l.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,p.priServiceTypeList),l.executeQueryInput("EST_BILL_SERV_001",p.priServiceTypeList,p.multipleComboDataForList,!0,!0,m,"popUp"),p.secSrvceType=function(e){p.secServName=[],p.multipleComboDataForList={1:p.secServName};var t=l.executeQueryURLReset();p.secServNameList=new Array,l.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,p.secServNameList),l.prepareParamList(2,e.gQDataCode,p.secServNameList),l.executeQueryInput("EST_BILL_SERV_002",p.secServNameList,p.multipleComboDataForList,!0,!0,t,"popUp")},p.serviceType=function(e){p.servName=[],p.multipleComboDataForList={1:p.servName};var t=l.executeQueryURLReset();p.servNameList=new Array,l.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,p.servNameList),l.prepareParamList(2,e.gQDataCode,p.servNameList),l.executeQueryInput("SCM_SERV_003",p.servNameList,p.multipleComboDataForList,!0,!0,t,"popUp")},p.serchService=function(t){var n;n=1==t?null:r,s.searchServiceSelection(p.service,a,i,n).then(function(t){if(null==t.data.HITService.message||null==t.data.HITService.message.approxBillServiceDtlsVoList){o.hisAlertMulti("information","Information","No record found",{buttonText:"OK"},{buttonCallBack1:function(){}}),e.gridApiServiceDetls.selection.clearSelectedRows(),e.serviceDetailsGridOptionsS.data=[],e.bigTotalItems=0}else p.servicesResult=t.data.HITService.message.approxBillServiceDtlsVoList[0]["com.napier.core.billgeneration.vo.ApproxBillServiceDtlsVo"],p.servicesResult instanceof Array?(e.serviceDetailsGridOptionsS.data=[],e.serviceDetailsGridOptionsS.data=p.servicesResult,e.serviceDetailsGridOptionsS.paginationCurrentPage=1,e.maxSize=5,p.servicesResult.length>6&&(e.serviceDetailsGridOptionsS.enableVerticalScrollbar=1),e.bigTotalItems=10*Math.ceil(p.servicesResult.length/e.serviceDetailsGridOptionsS.paginationPageSize)):(e.serviceDetailsGridOptionsS.data=[],e.serviceDetailsGridOptionsS.data.push(p.servicesResult)),e.gridApiServiceDetls.selection.clearSelectedRows()})},p.reset=function(){p.service=null,e.gridApiServiceDetls.selection.clearSelectedRows(),e.serviceDetailsGridOptionsS.data=[],e.bigTotalItems=0,e.serviceDetailsGridOptionsS.enableVerticalScrollbar=0},p.serchService(!1),e.selectService,e.selectBatchSelection,e.selectedData=[];var g=0;e.lastSelectedRow={},e.serviceDetailsGridOptionsS.onRegisterApi=function(t){e.gridApiServiceDetls=t,t.selection.on.rowSelectionChanged(e,function(t){t.isSelected;e.lastSelectedRow=t.entity,e.selectService=e.gridApiServiceDetls.selection.getSelectedRows();for(var a=0;a<e.selectService.length;a++)if(g>0)for(var i=0;i<g&&e.selectService[a].serviceSeqId!=e.selectedData[i].serviceSeqId;i++)i==g-1&&e.selectedData.push(e.selectService[a]);else e.selectedData.push(e.selectService[a]);if(!t.isSelected){var r=_.findIndex(e.selectedData,function(t){return t.serviceSeqId==e.lastSelectedRow.serviceSeqId});e.selectedData.splice(r,1)}g=e.selectedData.length,e.countRowsRadio=e.gridApiServiceDetls.selection.getSelectedRows().length}),t.selection.on.rowSelectionChangedBatch(e,function(t){t.length;e.selectBatchSelection=e.gridApiServiceDetls.selection.getSelectedRows();for(var a=0;a<e.selectBatchSelection.length;a++)if(g>0)for(var i=0;i<g&&e.selectBatchSelection[a].serviceSeqId!=e.selectedData[i].serviceSeqId;i++)i==g-1&&e.selectedData.push(e.selectBatchSelection[a]);else e.selectedData.push(e.selectBatchSelection[a]);g=e.selectedData.length})},p.acceptSearchService=function(){if(null!=e.selectBatchSelection&&e.selectBatchSelection.length>0)t.close(e.selectBatchSelection);else if(null==e.selectService||null==e.selectService){o.hisAlertMulti("information","Information","Please Select Any Service",{buttonText:"OK"},{buttonCallBack1:function(){}})}else t.close(e.selectedData)},e.cancel=function(){t.dismiss("cancel")}}]),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u){r.loadModule("billing");var m=n.getLanguageToSet();if(r.changeLanguage(m),e.alertObj={},d.loadAlerts(m).then(function(t){e.alertObj=t,e.alertData={buttonText:e.alertObj.ok},e.alertFunction={buttonCallBack1:function(){}},e.buttonClose={buttonClose:function(){}}}),e.estimateResponse=[],e.roleTask=u.rolePermission("T_BL_APPROX_BILL"),e.estimateListDtl=function(t,r,n){var l={url:"HISServices/ApproximateBillService"};l.requestData={operation:"getEstimateBillList",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillVo",mrNo:null==t||null==t?null:null==t.mrNo?t:t.mrNo,approxBillFromDate:null!=r?i("date")(r,"yyyy-MM-dd")+" 00:00:00.000":e.dontNeed,approxBillToDate:null!=n?i("date")(n,"yyyy-MM-dd")+" 11:59:59.000":e.dontNeed}},a.sendRestRequest(l).then(function(t){""!=t.data.HITService.message.approxBillsList[0]&&null!=t.data.HITService.message.approxBillsList[0]?(e.estimateResponse=t.data.HITService.message.approxBillsList[0]["com.napier.core.billgeneration.vo.ApproxBillVo"],e.gridOptions.data=[],e.estimateResponse instanceof Array?e.gridOptions.data=e.estimateResponse:e.gridOptions.data.push(e.estimateResponse)):(p.hisAlertMulti("information",e.alertObj.alertTypeInfo,e.alertObj.noRcrdFound,e.alertData,e.alertFunction,e.buttonClose),e.gridOptions.data=[])})},e.estimateSearch=function(){null!==e.ptId&&""!==e.ptId||void 0!==e.fromDate&&""!==e.fromDate&&null!==e.fromDate||void 0!==e.toDate&&""!==e.toDate&&null!==e.toDate?null==e.fromDate||null==e.fromDate||null!==e.toDate&&void 0!==e.toDate?null==e.toDate||null!==e.fromDate&&void 0!==e.fromDate?e.estimateListDtl(e.ptId,e.fromDate,e.toDate):p.hisAlertMulti("information",e.alertObj.alertTypeInfo,e.alertObj.plzSlctFromDate,e.alertData,e.alertFunction,e.buttonClose):p.hisAlertMulti("information",e.alertObj.alertTypeInfo,e.alertObj.plzSlctToDate,e.alertData,e.alertFunction,e.buttonClose):p.hisAlertMulti("information",e.alertObj.alertTypeInfo,e.alertObj.plzSlctPatIdDate,e.alertData,e.alertFunction,e.buttonClose)},e.ptIdResponse=[],e.patientModal={},e.ptId=null,e.estimateClear=function(){e.patientModal=null,e.ptId=null,e.fromDate=null,e.toDate=null,e.mbl_Num=null},e.searchPatient=function(a){if(a.length>0){var i=a;return t.patientSearchService(i,"getEstimatePatientServiceDetails").then(function(t){return e.patientResult=t.data.HITService.message.approxBillsList[0]["com.napier.core.billgeneration.vo.ApproxBillVo"],null!=e.patientResult?e.testVal=Array.isArray(e.patientResult)?e.patientResult:[e.patientResult]:e.testVal=[],e.testVal.map(function(e){return e})})}},e.ptIdSearch=function(t){if(null!=t&&null!=t){var i={url:"HISServices/ApproximateBillService"};i.requestData={operation:"getEstimateBillList",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillVo",mrNo:null==t.mrNo?t:t.mrNo}},a.sendRestRequest(i).then(function(t){var a=t.data.HITService.message.approxBillsList[0]["com.napier.core.billgeneration.vo.ApproxBillVo"];null!=a&&a instanceof Array?(e.ptIdResponse=[],e.ptIdResponse=t.data.HITService.message.approxBillsList[0]["com.napier.core.billgeneration.vo.ApproxBillVo"]):null==a?(e.ptIdResponse=[],e.patientModal.ptName=null,e.patientModal.estmtBillNum=null,e.patientModal.mbl_Num=null):(e.ptIdResponse=[],e.ptIdResponse.push(a)),0!=e.ptIdResponse.length&&(e.ptIdResponse.length>1?(e.patientModal={ptName:e.ptIdResponse[0].patientName,mbl_Num:e.ptIdResponse[0].mobileNo},e.ptId=e.ptIdResponse[0].mrNo):(e.patientModal={ptName:e.ptIdResponse[0].patientName,estmtBillNum:e.ptIdResponse[0].approxBillNo,fromDate:e.ptIdResponse[0].estimateBillDate,toDate:e.ptIdResponse[0].estimateBillDate,mbl_Num:e.ptIdResponse[0].mobileNo},e.ptId=e.ptIdResponse[0].mrNo))})}},"id"==s.id)return!1;e.ptd={},"undefined"==s.id?(e.fromDate=new Date,e.toDate=new Date,e.ptd=null,e.estimateListDtl(e.ptd,e.fromDate,e.toDate)):""!==s.id&&(e.ptd.mrNo=s.id,e.ptIdSearch(s.id),e.estimateListDtl(e.ptd,e.fromDate,e.toDate)),e.fromDateOptions={maxDate:new Date,startingDay:1},e.toDateOptions={maxDate:new Date,startingDay:1},e.toDateChange=function(){e.toDate=new Date,e.toDateOptions.minDate=e.fromDate},e.sessionFormat=angular.copy(c),e.format=e.sessionFormat.uibDateOnly.format,e.altInputFormats=["M!/d!/yyyy"],e.expectedDateService=function(){e.popup2.opened=!0},e.toDateCAL=function(){e.popup1.opened=!0},e.popup2={opened:!1},e.popup1={opened:!1},e.disableButton=!0,e.clear=function(){e.ptId="",e.patientModal.ptName="",e.patientModal.estmtBillNum="",e.patientModal.mbl_Num="",e.fromDate=null,e.toDate=null,e.gridOptions.data.length=" "},e.gridOptions={enableCellEdit:!1,multiSelect:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:!0,paginationCurrentPage:1,paginationPageSize:10,enableCellEditOnFocus:!1,enableRowSelection:!1,enableSelectAll:!1,enableFiltering:!1,onRegisterApi:function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){var a=e.gridApi.selection.getSelectedRows().length;e.estimateData=e.gridApi.selection.getSelectedRows(),a>0?e.disableButton=!1:(e.disableButton=!0,e.disableClone=!0)})},columnDefs:[{field:"approxBillNo",displayName:"Estimate Bill Number",width:"15%",height:"15%"},{field:"estimateBillDate",displayName:"Estimate Bill Date",width:"13%",height:"15%",sort:{direction:"desc"},cellTemplate:'<div class="ui-grid-cell-contents action-row">{{row.entity.estimateBillDate|date:"dd/MM/yyyy"}}</div>'},{field:"mrNo",displayName:"Patient Id",width:"12%",height:"14%"},{field:"patientName",displayName:"Patient Name",width:"15%",height:"15%"},{field:"mobileNo",displayName:"Mobile No.",width:"10%",height:"15%"},{field:"diagnosis",displayName:" Diagnosis",width:"17%",height:"15%",cellTemplate:'<div class="ui-grid-cell-contents action-row"><span uib-tooltip="{{row.entity.diagnosis}}" tooltip-placement="bottom" tooltip-enable="{{row.entity.diagnosis.length > 25}}">{{row.entity.diagnosis | limitTo:25}}{{row.entity.diagnosis.length > 25 ? "..." : " "}}</span></div>'},{field:"preAuthGenerated",displayName:"Pre-Auth Generated ",width:"20%",height:"15%"}]},e.estimateNewScreen=function(e){l.go("index.billingSub.EstimateBillNew",{id:1})},e.editEstimateBill=function(t){e.disableButton||(e.estimateData.push(t),l.go("index.billingSub.EstimateBillNew",{id:JSON.stringify(e.estimateData)}))},e.estimateClone=function(t){l.go("index.billingSub.EstimateBillClone",{id:JSON.stringify(e.estimateData)})},e.estBillPrint=function(){var t={pApBillSeqId:e.estimateData[0].approxBillHdSeqId,reportId:"ApproximateBillReport"};o.printReportModal("PrintTypeSelection","sm").then(function(e){o.printReportModal("printEstBillController","lg",e,t)})}}e.$inject=["$scope","PatientSearch","CallManager","$filter","hisTranslationsService","hisTranslationsGlobalLang","$state","$stateParams","PrintService","hisCalDefConstant","hisGenericAlertService","hisAlertService","RoleTaskService"],angular.module("napierContainerUi").controller("estimateBillList",e),angular.module("napierContainerUi").controller("printEstBillController",["returnObj","$uibModalInstance","selectedPrintType","QueryService","PrintService","$sce","$rootScope","$scope","CallManager","IPINDENTAPIS","APIS","$window",function(e,t,a,i,r,n,l,s,o,c,d,p){s.pageName="ESTIMATE",s.cancel=function(){t.dismiss("cancel")},s.printParameterList=new Array,i.prepareParamList("pApBillSeqId",e.pApBillSeqId,s.printParameterList),s.printObject={},s.printObject.reportId=e.reportId,s.printObject.reportType={id:"PDF"==a?4:5,desc:a},s.printObject.paramsList=s.printParameterList,s.printObject.destination="reportingServiceImpl",r.printReportFunction(s.printObject,s)}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u){r.loadModule("billing");var m=n.getLanguageToSet();r.changeLanguage(m),t.groupDiscountOptions=angular.copy(e),t.groupDiscountnewOptions=angular.copy(a),t.openNewScreen=function(){i.open("Group Discount New",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/groupDiscount/sections/groupDiscount.new.html",size:"lg",scope:t})}}e.$inject=["groupDiscountDefinition","$scope","groupDiscountnewDefinition","hisModalService","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","CallManager","BILLING_APIS","QueryService","$location","RoleTaskService"],angular.module("napierContainerUi").controller("groupDiscountController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o){var c=this;c.data={},e.labCostGrid=angular.copy(a),r.getSearchGridQuery("HSC_VISITLOCATION_DROPDOWN_001","").then(function(t){var a=[];try{for(var i=0;i<t[1].length;i++)t[1][i].SL_No=i+1,a.push(t[1][i]);e.department=a}catch(e){}}),c.data.fromDate=new Date,c.data.toDate=new Date,c.data.deptType="",e.deptTypeMandatory=!1,e.dateOptions={maxDate:new Date,showWeeks:!1},e.toDateOptions={maxDate:new Date,showWeeks:!1},e.open1=function(t){e.popup1.opened=!0,e.popup2.opened=!1,c.data.toDate=new Date},e.open2=function(t){e.popup2.opened=!0,e.popup1.opened=!1,e.toDateOptions.minDate=c.data.fromDate},e.popup1={opened:!1},e.popup2={opened:!1};var d={pageNumber:1,pageSize:8,sort:null};e.labCostGrid.onRegisterApi=function(t){t.pagination.on.paginationChanged(e,function(e,t){d.pageNumber=e,d.pageSize=t})},c.searchGridData=function(t){if(""!==c.data.fromDate&&""!==c.data.toDate&&""!==c.data.deptType){var a=-999;"In Patient"===c.data.patientType?a=17:"Out Patient"===c.data.patientType&&(a=1),e.labcostData={FromDate:c.data.fromDate.toISOString().slice(0,10)+" 00:00:00",ToDate:c.data.toDate.toISOString().slice(0,10)+" 23:59:59",VisitDepartment:c.data.deptType.DESCRIPTION?c.data.deptType.DESCRIPTION:"HSC",PatType:a},e.deptTypeMandatory=!1,r.getSearchGridQuery(t,e.labcostData).then(function(t){for(var a=[],i=0;i<t[1].length;i++)t[1][i].SL_No=i+1,null===t[1][i].COST&&(t[1][i].COST=0),a.push(t[1][i]);e.labCostGrid.data=a,e.bigTotalItems=10*Math.ceil(a.length/e.labCostGrid.paginationPageSize)})}else e.deptTypeMandatory=!0},e.bigTotalItems=0,c.clearFormData=function(){c.data={},e.labCostGrid.data=[],e.bigTotalItems=0,c.data.fromDate=new Date,c.data.toDate=new Date,c.data.deptType="",e.deptTypeMandatory=!1},c.generatePDFprint=function(t){if(0!=e.labCostGrid.data.length){var a={pFromDate:c.data.fromDate.toISOString().slice(0,10)+" 00:00:00",pToDate:c.data.toDate.toISOString().slice(0,10)+" 23:59:59",pDeptType:c.data.deptType.DESCRIPTION?c.data.deptType.DESCRIPTION:"",pPatientType:c.data.patientType?c.data.patientType:"Both",reportId:t};n.printReportModal("printLabCostCtrl","lg","PDF",a)}},c.generateExcelPrint=function(t){if(0!=e.labCostGrid.data.length){var a={pFromDate:c.data.fromDate.toISOString().slice(0,10)+" 00:00:00",pToDate:c.data.toDate.toISOString().slice(0,10)+" 23:59:59",pDeptType:c.data.deptType.DESCRIPTION?c.data.deptType.DESCRIPTION:"",pPatientType:c.data.patientType?c.data.patientType:"Both",reportId:t};l.generateExcel(t,a).then(function(e){try{var t="napier-his-web/NapierReportServlet?reportName="+(e.data.HITService.message.reportName+""),a=location.host;s.open("http://"+a+"/"+t)}catch(e){}})}},c.getTableHeight=function(){var t;return e.labCostGrid.data.length>=10?(t=400,t+="px"):0===e.labCostGrid.data.length?t="200px !important":(t=30*e.labCostGrid.data.length+30+70,t+="px"),{height:t}},c.checkPrintPermission=function(){return!!o.loadRoleTaskService("T_BL_LAB_COST_ANALYSIS").T_BL_LAB_COST_ANALYSIS_P}}function t(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){s.pageName="Report",s.cancel=function(){u.dismissAll()},s.printParameterList=[],i.prepareParamList("pFromDate",e.pFromDate,s.printParameterList),i.prepareParamList("pToDate",e.pToDate,s.printParameterList),i.prepareParamList("pDeptType",e.pDeptType,s.printParameterList),i.prepareParamList("pPatientType",e.pPatientType,s.printParameterList),s.printObject={},s.printObject.reportId=e.reportId,s.printObject.destination="reportingServiceImpl",s.printObject.reportType={"@class":"com.napier.report.type.ReportType",id:"PDF"==a?4:5,desc:a},s.printObject.paramsList=s.printParameterList,r.printReportFunction(s.printObject,s)}e.$inject=["$scope","$uibModal","LabCostAnalysisReportGridColumnData","CallManager","billLisitngService","PrintService","ExcelService","$window","adtDailyReportComboQueryservice"],t.$inject=["returnObj","$uibModalInstance","selectedPrintType","QueryService","PrintServiceCustome","$sce","$rootScope","$scope","CallManager","IPINDENTAPIS","APIS","$window","$uibModalStack","hisAlertService","PrintService"],angular.module("napierContainerUi").controller("labCostAnalysisPrintController",e).controller("printLabCostCtrl",t)}(),function(){"use strict";angular.module("napierContainerUi").constant("billingMergeBillGridDefn",{enableHorizontalScrollbar:2,enableCellEditOnFocus:!1,enableRowSelection:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,multiSelect:!1,enableFiltering:!1,enableSorting:!1,columnDefs:[{field:"serviceVo.servCode",displayName:"Service Code"},{field:"serviceVo.servName",displayName:"Service Name"},{field:"quantity",displayName:"Quantity"},{field:"actualRate",displayName:"Rate"},{field:"chargeableAmt",displayName:"Charge"},{field:"chargeableAmt",displayName:"Amount"}]}).constant("billSearchGridDefn",{enableCellEditOnFocus:!1,enableRowSelection:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,multiSelect:!1,enableFiltering:!1,enableSorting:!1,columnDefs:[{field:"BILL_NO",displayName:"Bill No."},{field:"BILL_DATE",displayName:"Bill Date/Time"},{field:"CUSTOMER_ID",displayName:"MR No."},{field:"RG_FIRST_NAME",displayName:"Patient Name"},{field:"TOTAL_AMOUNT",displayName:"Bill Amount"},{field:"CONSESSION_AMT",displayName:"Concession Amount"},{field:"SETTLED_AMT",displayName:"Settled Amount"},{field:"DUE_AMOUNT",displayName:"Due Amount"},{field:"PAY_STATUS_DESC",displayName:"Payment Status"}]})}(),function(){"use strict";function e(e,t){this.mergeBillsData=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"mergeBillView",destination:"com.napier.core.billgeneration.service.external.BillGenerationService",message:a},t.sendRestRequest(i)},this.saveMergeBillsData=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"mergeBill",destination:"com.napier.core.billgeneration.service.external.BillGenerationService",message:a},t.sendRestRequest(i)}}e.$inject=["BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("billingMergeBillService",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p){var u=this;s.loadModule("billing");var m=o.getLanguageToSet();function g(e,t,a,i){u.billDetails=[],u.billDetails1List={1:u.billDetails};var r=c.executeQueryURLReset(),n=new Array;return c.prepareParamListWithParam("pIPNo",e,n),c.prepareParamListWithParam("pAdmSeqID",t,n),c.prepareParamListWithParam("pSubAccSeqId",a,n),c.prepareParamListWithParam("pCurrDate",moment(new Date).format("YYYY-MM-DD HH:mm:ss"),n),c.executeQueryInput("BL_M_COMMON_001",n,u.billDetails1List,!0,!0,r,"popUp",{}).then(function(e){if("IP"==i){var t=e[1]instanceof Array?e[1]:[e[1]];u.primaryObj.TARIFF_CATG_CODE=t[0].TARIFF_CATG_CODE,u.primaryObj.TARIF_DISC=t[0].TARIF_DISC,u.primaryObj.ipno=t[0].IP_NO,u.primaryObj.PCATG_SDESC=t[0].PCATG_SDESC,u.primaryObj.PCATG_SEQ_ID=t[0].PCATG_SEQ_ID}if("OP"==i){t=e[1]instanceof Array?e[1]:[e[1]];u.secondaryObj.TARIFF_CATG_CODE=t[0].TARIFF_CATG_CODE,u.secondaryObj.TARIF_DISC=t[0].TARIF_DISC,u.secondaryObj.ipno=t[0].IP_NO,u.secondaryObj.PCATG_SDESC=t[0].PCATG_SDESC,u.secondaryObj.PCATG_SEQ_ID=t[0].PCATG_SEQ_ID}})}function S(e,t){u.mainbillDetails=[],u.billmainDetailsList={1:u.mainbillDetails};var a=c.executeQueryURLReset(),i=new Array;return c.prepareParamListWithParam("pPracticeId",u.contextInfo.CLIENT_REF_ID,i),c.prepareParamListWithParam("pFacilityId",u.contextInfo.FACILITY_ID,i),c.prepareParamListWithParam("pBllNo",e,i),c.prepareParamListWithParam("pBillSeqId",t,i),c.executeQueryInput("MAIN_BILL_DETAILS",i,u.billmainDetailsList,!0,!0,a,"popUp",{}).then(function(e){})}s.changeLanguage(m),u.serviceGridOptions=angular.copy(n),u.serviceGridOptions.data=[],u.contextInfo=JSON.parse(sessionStorage.getItem("userContextObj")),u.primaryObj={},u.secondaryObj={},u.detailsObj={},u.payerList=[],u.isSave=!0,u.isMerge=!1,u.billSearchModal=function(e,t){var i={ptype:e};a.open("Bill Search",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/mergeBills/partials/bill.search.modal.html",size:t,controller:"mergeBillSrchModalCtrl",controllerAs:"billSearchCtrl",resolve:{patObj:i}}).result.then(function(t){3==t[0].PAY_STATUS_CODE||1==t[0].PAY_STATUS_CODE?d.warning("Warning","Invoice already generated for the selected bill. Can't cancel the Bill.",!1,!1,p.time):("IP"==e&&(u.primaryObj=t[0],g(u.primaryObj.RG_SEQ_ID,u.primaryObj.IPADM_SEQ_ID,u.primaryObj.SUB_ACC_SEQ_ID,e),function(e,t){u.payerDetails=[],u.billPayerDetailsList={1:u.payerDetails};var a=c.executeQueryURLReset(),i=new Array;c.prepareParamListWithParam("pPracticeId",u.contextInfo.CLIENT_REF_ID,i),c.prepareParamListWithParam("pFacilityId",u.contextInfo.FACILITY_ID,i),c.prepareParamListWithParam("pBllNo",e,i),c.prepareParamListWithParam("pBillSeqId",t,i),c.executeQueryInput("BILLING_PAYER_DETAILS",i,u.billPayerDetailsList,!0,!0,a,"popUp",{}).then(function(e){})}(u.primaryObj.BILL_NO,u.primaryObj.BILL_SEQ_ID),S(u.primaryObj.BILL_NO,u.primaryObj.BILL_SEQ_ID)),"OP"==e&&(u.secondaryObj=t[0],g(u.primaryObj.RG_SEQ_ID,u.primaryObj.IPADM_SEQ_ID,u.primaryObj.SUB_ACC_SEQ_ID,e),S(u.primaryObj.BILL_NO,u.primaryObj.BILL_SEQ_ID)))})},u.clkMergeBills=function(){if(null!=u.primaryObj.BILL_SEQ_ID&&null!=u.secondaryObj.BILL_SEQ_ID)if(u.primaryObj.TARIFF_CATG_CODE==u.secondaryObj.TARIFF_CATG_CODE){var e={"@class":"com.napier.core.billgeneration.vo.BillingList",billingList:[{"com.napier.core.billgeneration.vo.Bill":[{billSeqId:u.primaryObj.BILL_SEQ_ID,billType:u.primaryObj.GN_BILL_TYPE,isBillClearedCheck:!1,isCompanySponsor:0,isDaPosted:0,isEdit:0,isPrimaryBill:!0,isSeniorCitizen:0,reviceBillPreAuthzFlag:!1,serviceLevlConsession:!1},{billSeqId:u.secondaryObj.BILL_SEQ_ID,billType:u.secondaryObj.GN_BILL_TYPE,isBillClearedCheck:!1,isCompanySponsor:0,isDaPosted:0,isEdit:0,isPrimaryBill:!1,isSeniorCitizen:0,reviceBillPreAuthzFlag:!1,serviceLevlConsession:!1}]}]};l.mergeBillsData(e).then(function(e){if(e.data.HITService.message.bill.billSeqId){u.isSave=!1;var t=e.data.HITService.message;if(u.detailsObj=t.bill,u.detailsObj.billPayerDtList[0]){var a=u.detailsObj.billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"],i=a instanceof Array?a:[a];u.payerList=i}if(t.servicePostingDetailsList[0]){var r=t.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"],n=r instanceof Array?r:[r];u.serviceGridOptions.data=n}}})}else d.warning("Warning","Tariff Category should be same.",!1,!1,p.time);else d.warning("Warning","Please Select Primary Bill and Secondary Bill.",!1,!1,p.time)},u.saveMergebills=function(){var e={"@class":"com.napier.core.billgeneration.vo.BillingList",billingList:[{"com.napier.core.billgeneration.vo.Bill":[{billSeqId:u.primaryObj.BILL_SEQ_ID,billType:u.primaryObj.GN_BILL_TYPE,isBillClearedCheck:!1,isCompanySponsor:0,isDaPosted:0,isEdit:0,isPrimaryBill:!0,isSeniorCitizen:0,reviceBillPreAuthzFlag:!1,serviceLevlConsession:!1},{billSeqId:u.secondaryObj.BILL_SEQ_ID,billType:u.secondaryObj.GN_BILL_TYPE,isBillClearedCheck:!1,isCompanySponsor:0,isDaPosted:0,isEdit:0,isPrimaryBill:!1,isSeniorCitizen:0,reviceBillPreAuthzFlag:!1,serviceLevlConsession:!1}]}]};l.saveMergeBillsData(e).then(function(e){e.data.HITService.message.billingList[0]&&(d.success("Success","Save Successfully",!1,!1,p.time),u.isSave=!0,u.isMerge=!0)})},i.viewCancelBill=function(e,t){null!=t.BILL_SEQ_ID?i.checkQueryService(t.BILL_SEQ_ID,!1).then(function(r){if(!e||0==parseInt(r[0][1][0].CNT)&&0==parseInt(r[0][2][0].CNT)){i.serviceData=[],i.singleComboDataForList={1:i.serviceData};var n=c.executeQueryURLReset();i.serviceDataList=new Array;let r="";c.prepareParamListWithParam("pBillSeqId",t.BILL_SEQ_ID,i.serviceDataList),c.prepareParamListWithParam("pFlag",r,i.serviceDataList),c.executeQueryInput("BL_BILL_SERVICE_DTLS",i.serviceDataList,i.singleComboDataForList,!0,!0,n,"popUp",{}).then(function(i){if(null!=i[1]&&null!=i[1]&&""!=i[1]&&i[1]instanceof Array){var n={flagComp:r,flag:e},l=t;l.regSeqId=t.RG_SEQ_ID,l.ipAdmSeqId=t.IPADM_SEQ_ID,l.billSeqId=t.BILL_SEQ_ID;a.open("View Bill",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/billingWorkList/cancel/cancel.screen.html",size:"lg",controller:"cancelController",keyboard:!1,backdrop:"static",resolve:{billSelectedData:function(){return[l]},flag:function(){return n},serviceData:function(){return i[1]}}})}else d.warning("Warning","No Data Available",!1,!1,p.time)})}}):d.warning("Warning","Please select Bill.",!1,!1,p.time)},i.checkQueryService=function(e,t){i.cancelChk=[],i.concsChk=[],i.writeOffChk=[],u.multipleChkDataForList={1:i.cancelChk,2:i.concsChk,3:i.writeOffChk};var a=c.executeQueryURLReset();if(u.chkParamList=new Array,c.prepareParamListWithParam("pBillSeqId",e,u.chkParamList),c.executeQueryInput("BL_CANCEL_CHK",u.chkParamList,u.multipleChkDataForList,!0,!1,a,"popUp",{}),!t)return c.executeQueryInput("BL_CONCS_DUP_CHK1",u.chkParamList,u.multipleChkDataForList,!0,!0,a,"popUp",{}).then(function(e){return(e instanceof Array?e:[e]).map(function(e){return e})})}}e.$inject=["$log","$uibModal","hisModalService","$scope","hisCalDefConstant","billingMergeBillGridDefn","billingMergeBillService","hisTranslationsService","hisTranslationsGlobalLang","QueryService","hisAlertService","hisAlertConstants"],angular.module("napierContainerUi").controller("billinMergeBillCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v){t.openNew=function(){S.open("NEW",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/misGroupMaster/sections/misGroupMasterNew.html",size:"md",scope:t})},t.gridOptions={columnDefs:[{field:"Name",displayName:"Name"},{field:"Code",displayName:"Code"},{field:"Print Seq",displayName:"Print Seq"},{field:"Status",displayName:"Status"}]},t.gridOptions.onRegisterApi=function(e){t.gridApi=e}}e.$inject=["$state","$scope","$filter","QueryService","$uibModalStack","$mdDialog","$timeout","hisCalDefConstant","uiGridConstants","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","RoleTaskService","hisAlertConstants","hisModalService","$uibModal"],angular.module("napierContainerUi").controller("misGroupMasterCtrl",e)}(),function(){"use strict";t.$inject=["$scope","QueryService","hisModalService","hisTranslationsService","$filter","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","hisCalDefConstant","newTariffRateGridConstant","newTariffRateServiceGrid","GetGridDataService","SaveObjPreServiceTariff","saveCallServiceTariff","TariffRateValidCalService","exportUiGridService","uibDatepickerConfig","uiGridExporterService","RoleTaskService"];var e=angular.module("napierContainerUi");function t(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y){var f=this;f.changeGridStatus=function(e){f.isFirstOpen=e},i.loadModule("billing");var C=n.getLanguageToSet();i.changeLanguage(C),f.alertObj={},l.loadAlerts(C).then(function(e){f.alertObj=e,f.alertData={buttonText:f.alertObj.ok},f.alertFunction={buttonCallBack1:function(){}},f.closefun={buttonClose:function(){}}}),f.srchObj={},delete v.ngModelOptions.timezone,f.CD=angular.copy(o),f.format=angular.copy(o.uibDateOnly.format),f.dateOptions={minDate:new Date},f.updObj={},f.roleTask=y.rolePermission("T_BL_M_TARIFF_RATE"),f.groupWiseGrid=angular.copy(c),f.serviceItmsWiseGrid=angular.copy(c),d.newTariffRateGetColDef(f.groupWiseGrid),d.serviceWiseGridColDef(f.serviceItmsWiseGrid),f.groupWiseGrid.data=[],f.serviceItmsWiseGrid.data=[],f.editFlagActive=!1,f.groupWiseGrid.onRegisterApi=function(e){f.gridApiGroup=e},f.serviceItmsWiseGrid.onRegisterApi=function(e){f.gridApiItem=e},f.tariffCatList=[],f.departList=[],f.tariffClsList=[],f.specialityList=[],f.primServGrupList=[],f.prtList=[],f.multipleChkDataForList={1:f.tariffCatList,2:f.prtList,3:f.departList,4:f.tariffClsList,5:f.specialityList,6:f.primServGrupList};var I=t.executeQueryURLReset();f.tariffCatListArr=new Array,t.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,f.tariffCatListArr),t.executeQueryInput("TARIFF_CARG",f.tariffCatListArr,f.multipleChkDataForList,!0,!1,I,"popUp",{}),f.prtListArr=new Array,t.prepareParamListWithParam("pMasterSqId",18005,f.prtListArr),t.executeQueryInput("TRN003",f.prtListArr,f.multipleChkDataForList,!0,!1,I,"popUp",{}),f.departListArr=new Array,t.executeQueryInput("RATECARD_DEPT_DROP_DOWN",f.departListArr,f.multipleChkDataForList,!0,!1,I,"popUp",{}),f.tariffClsListArr=new Array,t.prepareParamListWithParam("@pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,f.tariffClsListArr),t.executeQueryInput("SP_USP_BL_GET_TARIFF_CLASS",f.tariffClsListArr,f.multipleChkDataForList,!0,!1,I,"popUp",{}),f.specialityListArr=new Array,t.executeQueryInput("NHIS_M_052",f.specialityListArr,f.multipleChkDataForList,!0,!1,I,"popUp",{}),f.priServGrpListArr=new Array,t.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,f.priServGrpListArr),t.executeQueryInput("SCM_SERV_002_SCM_1",f.priServGrpListArr,f.multipleChkDataForList,!0,!0,I,"popUp",{}),f.getServiceListData=function(a,i){e.searchTerm="",delete f.autoserviceWiseData,f.serviceItmsWiseGrid.data=[],i?f.serviceNextPrev=[]:f.serviceList=[],f.multipleList={1:i?f.serviceNextPrev:f.serviceList};var r=t.executeQueryURLReset();f.serviceListArr=new Array,t.prepareParamListWithParam("@pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,f.serviceListArr),t.prepareParamListWithParam("@pPriServCode",null!=a&&null!=a.primarySrvGrp&&null!=a.primarySrvGrp.CODE?a.primarySrvGrp.CODE:-999,f.serviceListArr),t.prepareParamListWithParam("@pSpecialityCode",null!=a&&null!=a.speciality&&null!=a.speciality.CODE?a.speciality.CODE:-999,f.serviceListArr),t.prepareParamListWithParam("@pDeptCode",null!=a&&null!=a.department&&null!=a.department.DEPARTMENTCODE?a.department.DEPARTMENTCODE:-999,f.serviceListArr),t.prepareParamListWithParam("@pPatientType",null!=a&&null!=a.patientType&&a.patientType.length>0?p.getSplitDataValue(a.patientType,"DT_CODE"):p.getSplitDataValue(f.prtList,"DT_CODE"),f.serviceListArr),t.prepareParamListWithParam("@pServName","",f.serviceListArr),t.prepareParamListWithParam("@pTempSeqNo",i&&null!=a&&null!=a.seqNoVal?a.seqNoVal:-999,f.serviceListArr),t.executeQueryInput("SERVICE_ITEM_LIST_TARIFF_RATE",f.serviceListArr,f.multipleList,!0,!0,r,"popUp",{}).then(function(e){i&&null!=f.serviceNextPrev[0]&&(f.srchObj.serviceItem=f.serviceNextPrev[0])})},f.getTariffHistory=function(e){if(e.flagHistory)a.open("HISTORY - "+e.SERV_NAME,{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/newTariffRates/tariffHistory/tariff.history.screen.html",size:"lg",controller:"tariffHistoryController",controllerAs:"trf",resolve:{data:angular.extend(e,f)}});else s.information("Information","No History Avaiable")},f.dataCheck=function(e){if(f.editFlagActive){e=!e;let t={buttonText:f.alertObj.yes,buttonText2:f.alertObj.no},a={buttonCallBack1:function(){f.editFlagActive=!1,f.groupWiseGrid.data=[],f.serviceItmsWiseGrid.data=[],e=!e}},i={buttonClose:function(){}},r="Do You Want To Continue?";s.hisAlertMulti("information",f.alertObj.alertTypeInfo,r,t,a,i)}else f.groupWiseGrid.data=[],f.serviceItmsWiseGrid.data=[]},e.fieldValidation=function(e,t,a,i,r){null!=i&&""!=i?(null!=a&&""!=a&&parseFloat(i)<=parseFloat(a)&&(1==r?e.entity.MIN_VALUE=i:e.entity.FUTURE_MIN_VALUE=i),null!=t&&""!=t&&parseFloat(i)>=parseFloat(t)&&(1==r?e.entity.MAX_VALUE=i:e.entity.FUTURE_MAX_VALUE=i)):1==r?null!=e.entity.MIN_VALUE&&""!=e.entity.MIN_VALUE&&null!=e.entity.MAX_VALUE&&""!=e.entity.MAX_VALUE&&parseFloat(e.entity.MIN_VALUE)>parseFloat(e.entity.MAX_VALUE)&&(e.entity.MIN_VALUE=e.entity.MAX_VALUE):null!=e.entity.FUTURE_MIN_VALUE&&""!=e.entity.FUTURE_MIN_VALUE&&null!=e.entity.FUTURE_MAX_VALUE&&""!=e.entity.FUTURE_MAX_VALUE&&parseFloat(e.entity.FUTURE_MIN_VALUE)>parseFloat(e.entity.FUTURE_MAX_VALUE)&&(e.entity.FUTURE_MIN_VALUE=e.entity.FUTURE_MAX_VALUE)},f.minAndMaxPopUp=function(e,t){var i=[];i.push(e),f.srchObj.serviceItem=e.entity.SERV_SEQ_ID,i.push(f.srchObj),i.push(f),a.open("",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/newTariffRates/sections/tariff.rates.modal.screen.html",size:"lg",controller:"rateChangeController",controllerAs:"rateRage",resolve:{items:function(){return i}}}).result.then(function(e){p.getMaxMinData(e,f.groupWiseGrid,t)})},f.getPrevNextService=function(e,t){let a=!1;for(let t=0;t<f.serviceList.length;t++){if(e==f.serviceList[t].SEQ_NUMBER){f.srchObj.serviceItem=f.serviceList[t];break}t==f.serviceList.length-1&&(a=!0)}if(a)if(t){let e=f.serviceList.length;f.srchObj.serviceItem=f.serviceList[e-1]}else f.srchObj.serviceItem=f.serviceList[0]},f.prevService=function(e){if(null!=e.serviceItem.SEQ_NUMBER){let t=e.serviceItem.SEQ_NUMBER-1;f.getPrevNextService(t,!0)}},f.nextService=function(e){if(null!=e.serviceItem.SEQ_NUMBER){let t=e.serviceItem.SEQ_NUMBER+1;f.getPrevNextService(t)}},f.getServiceGirdData=function(){f.srchObj.doctor="",f.serviceItmsWiseGrid.data=[],f.groupWiseGrid.data=[],null==f.srchObj.assignTariffCat||null==f.srchObj.assignTariffCat||null==f.srchObj.primarySrvGrp||null==f.srchObj.primarySrvGrp?s.information("Information","Please Select Mandatory Fields"):null!=f.srchObj&&null!=f.srchObj.assignTariffCat&&null!=f.srchObj.assignTariffCat.CODE&&(f.serviceItemFlag?null!=f.srchObj.serviceItem&&null!=f.srchObj.serviceItem.SERV_SEQ_ID?p.getTariffDataServiceWise(f.srchObj,f):s.information("Information","Please Select Any Service"):p.getTariffDataServiceWise(f.srchObj,f))},f.export=function(){if(f.serviceItemFlag?f.serviceItmsWiseGrid.data.length:f.groupWiseGrid.data.length){let e;if(f.exportGrid=[],f.exportGridData=[],f.serviceItemFlag){f.exportGrid=d.exportGridForServiceWise(f.exportGrid),10008==f.srchObj.primarySrvGrp.CODE?(f.exportGrid[4].name=1==f.srchObj.is_slot?"DOCT_NAME":"SPL_NAME",f.exportGrid[4].displayName=1==f.srchObj.is_slot?"By Doctor/Speciality":"By Speciality"):(f.exportGrid[4].name="SLOT",f.exportGrid[4].displayName="Fixed Slot"),e=f.gridApiItem;for(let e=0;e<f.serviceItmsWiseGrid.data.length;e++){1==f.srchObj.is_slot&&(f.serviceItmsWiseGrid.data[e].DOCT_NAME=f.serviceItmsWiseGrid.data[e].DOCT_NAME+"/"+f.serviceItmsWiseGrid.data[e].SPL_NAME),f.exportGridData[e]=[];for(let t=0;t<f.exportGrid.length;t++)null!=f.serviceItmsWiseGrid.data[e][f.exportGrid[t].name]&&null==f.serviceItmsWiseGrid.data[e][f.exportGrid[t].name].VALUE&&null==f.serviceItmsWiseGrid.data[e][f.exportGrid[t].name].FUTURE_VALUE?null==f.serviceItmsWiseGrid.data[e][f.exportGrid[t].name].SERV_SEQ_ID?f.exportGridData[e].push({value:f.serviceItmsWiseGrid.data[e][f.exportGrid[t].name]}):f.exportGridData[e].push({value:void 0}):14!=t&&15!=t&&null!=f.serviceItmsWiseGrid.data[e][f.exportGrid[t].name]&&null!=f.serviceItmsWiseGrid.data[e][f.exportGrid[t].name].VALUE?f.exportGridData[e].push({value:f.serviceItmsWiseGrid.data[e][f.exportGrid[t].name].VALUE}):14==t&&15==t&&null!=f.serviceItmsWiseGrid.data[e][f.exportGrid[t].name]&&null!=f.serviceItmsWiseGrid.data[e][f.exportGrid[t].name].FUTURE_VALUE?f.exportGridData[e].push({value:f.serviceItmsWiseGrid.data[e][f.exportGrid[t].name].FUTURE_VALUE}):"TARIFF_CATEGORY"==f.exportGrid[t].name?f.exportGridData[e].push({value:f.srchObj.assignTariffCat.DESCRIPTION}):"PRI_SERV_DESC"==f.exportGrid[t].name?f.exportGridData[e].push({value:f.srchObj.primarySrvGrp.DESCRIPTION}):f.exportGridData[e].push({value:void 0})}}else{f.exportGrid=D.getColumnHeaders(f.gridApiGroup.grid,"visible"),f.exportGrid.splice(0,0,{name:"SERV_SEQ_ID",displayName:"Service Code",width:"*",align:"left"}),f.exportGrid.splice(0,0,{name:"PRI_SERV_DESC",displayName:"Primary Service Group",width:"*",align:"left"}),f.exportGrid.splice(0,0,{name:"TARIFF_CATEGORY",displayName:"Tariff Category",width:"*",align:"left"}),e=f.gridApiGroup;for(let e=0;e<f.groupWiseGrid.data.length;e++){f.exportGridData[e]=[];for(let t=0;t<f.exportGrid.length;t++)if(null!=f.groupWiseGrid.data[e][f.exportGrid[t].name]&&null==f.groupWiseGrid.data[e][f.exportGrid[t].name].VALUE&&null==f.groupWiseGrid.data[e][f.exportGrid[t].name].FUTURE_VALUE)f.exportGridData[e].push({value:f.groupWiseGrid.data[e][f.exportGrid[t].name]});else if(null!=f.groupWiseGrid.data[e][f.exportGrid[t].name]&&null!=f.groupWiseGrid.data[e][f.exportGrid[t].name].VALUE)f.exportGridData[e].push({value:f.groupWiseGrid.data[e][f.exportGrid[t].name].VALUE});else if(null!=f.groupWiseGrid.data[e][f.exportGrid[t].name]&&null!=f.groupWiseGrid.data[e][f.exportGrid[t].name].FUTURE_VALUE)f.exportGridData[e].push({value:f.groupWiseGrid.data[e][f.exportGrid[t].name].FUTURE_VALUE});else if("TARIFF_CATEGORY"==f.exportGrid[t].name)f.exportGridData[e].push({value:f.srchObj.assignTariffCat.DESCRIPTION});else{if("PRI_SERV_DESC"!=f.exportGrid[t].name){"OP"==f.groupWiseGrid.data[e].PAT_TYPE_DESC&&(f.exportGridData[e].push({value:f.groupWiseGrid.data[e].VALUE}),f.exportGridData[e].push({value:f.groupWiseGrid.data[e].DOCT_SHARE_VALUE}),f.exportGridData[e].push({value:f.groupWiseGrid.data[e].FUTURE_VALUE}),f.exportGridData[e].push({value:f.groupWiseGrid.data[e].FUTURE_EFFECTIVE_FROM}));for(let t=0;t<f.groupWiseGrid.category.length;t++)if(null!=f.groupWiseGrid.data[e][f.groupWiseGrid.category[t].name]){let a=f.groupWiseGrid.data[e][f.groupWiseGrid.category[t].name];for(let t=0;t<f.groupWiseGrid.columnDefs.length;t++){let i=f.groupWiseGrid.columnDefs[t].name;if(null!=a[i]&&a[i].BED_CLASS_CODE){let t=a[i];f.exportGridData[e].push({value:t.VALUE}),f.exportGridData[e].push({value:t.DOCT_SHARE_VALUE}),f.exportGridData[e].push({value:t.FUTURE_VALUE}),f.exportGridData[e].push({value:t.FUTURE_EFFECTIVE_FROM});break}}break}break}f.exportGridData[e].push({value:f.srchObj.primarySrvGrp.DESCRIPTION})}}}S.exportToExcel("sheet 1",e,"visible","all",f.exportGrid,f.exportGridData,f.srchObj.assignTariffCat.DESCRIPTION)}else s.information("Information","No Data Avaiable For Export.")},f.fetchDocVal=function(e,t,a,i){for(let r=0;r<e.groupWiseGrid.category.length;r++){if(null!=e.groupWiseGrid.data[t][e.groupWiseGrid.category[r].name]){let n=e.groupWiseGrid.data[t][e.groupWiseGrid.category[r].name];if(null!=n&&null!=n.VALUE){if("editFlag"!=i)return 1==n.SERV_PRIORITY&&n.BED_CLASS_CODE==a.BED_CLASS_CODE&&(i?e.changeFutureDate(n,e,t):g.docShareApply(e.groupWiseGrid.data,t,n,e),!0);n.editFlag=!0,a.editFlag=!0,a.docFlag=!0,n.docFlag=!0}for(let r=0;r<e.groupWiseGrid.columnDefs.length;r++){let l=e.groupWiseGrid.columnDefs[r].name;if(null!=n[l]&&null!=n[l].BED_CLASS_CODE)if("editFlag"==i)n[l].editFlag=!0,n[l].editFlag=!0,n[l].docFlag=!0;else if(1==n[l].SERV_PRIORITY&&n[l].BED_CLASS_CODE==a.BED_CLASS_CODE)return i?e.changeFutureDate(n[l],e,t):g.docShareApply(e.groupWiseGrid.data,t,n[l],e),!0}}if(r==e.groupWiseGrid.category.length-1)return!1}},f.changeDocShareItem=function(e,t,a,i){null!=e.DOCT_SHARE_VALUE&&""!=e.DOCT_SHARE_VALUE&&("1"==e.DOCT_SHARE_TYPE?i?e.DOCT_SHARE_VALUE=parseFloat(e.DOCT_SHARE_VALUE)/parseFloat(e.VALUE)*100:parseFloat(e.DOCT_SHARE_VALUE)>parseFloat(100)&&(e.DOCT_SHARE_VALUE=100):"2"==e.DOCT_SHARE_TYPE&&(i?e.DOCT_SHARE_VALUE=parseFloat(e.VALUE)*parseFloat(e.DOCT_SHARE_VALUE)/100:parseFloat(e.DOCT_SHARE_VALUE)>parseFloat(e.VALUE)&&(e.DOCT_SHARE_VALUE=parseFloat(e.VALUE))))},f.doctValid=function(e){null!=e.DOCT_SHARE_VALUE&&""!=e.DOCT_SHARE_VALUE||(e.DOCT_SHARE_VALUE=0)},f.changeDocShare=function(e,t,a){if(1==e.SERV_PRIORITY){if(null!=e.DOCT_SHARE_VALUE&&""!=e.DOCT_SHARE_VALUE){"1"==e.DOCT_SHARE_TYPE?parseFloat(e.DOCT_SHARE_VALUE)>parseFloat(100)&&(e.DOCT_SHARE_VALUE=100):"2"==e.DOCT_SHARE_TYPE&&parseFloat(e.DOCT_SHARE_VALUE)>parseFloat(e.VALUE)&&(e.DOCT_SHARE_VALUE=parseFloat(e.VALUE));t.fetchDocVal(t,a,e)}}else if(2==e.SERV_PRIORITY||3==e.SERV_PRIORITY)if(null==e.BED_CLASS_DESC){t.fetchDocVal(t,a-1,e)||t.fetchDocVal(t,a-2,e)}else{t.fetchDocVal(t,a-1,e)||t.fetchDocVal(t,a-2,e)}},f.changeDocShareType=function(e,t,a){null!=e.DOCT_SHARE_VALUE&&""!=e.DOCT_SHARE_VALUE&&("2"==e.DOCT_SHARE_TYPE?e.DOCT_SHARE_VALUE=parseFloat(e.VALUE)*parseFloat(e.DOCT_SHARE_VALUE)/100:e.DOCT_SHARE_VALUE=parseFloat(e.DOCT_SHARE_VALUE)/parseFloat(e.VALUE)*100),t.changeDocShare(e,t,a)},f.changeValue=function(e,t,a){t.changeDocShare(e,t,a)},f.changeFutureDate=function(e,t,a){null!=e.FUTURE_VALUE&&""!=e.FUTURE_VALUE&&null!=e.FUTURE_EFFECTIVE_FROM&&""!=e.FUTURE_EFFECTIVE_FROM&&g.changeFutureDate(t.groupWiseGrid.data,a,e,t)},f.changeFutureValue=function(e,t,a){if(2==e.SERV_PRIORITY)if(null==e.BED_CLASS_DESC){t.fetchDocVal(t,a-1,e,!0)||t.fetchDocVal(t,a-2,e,!0)}else{t.fetchDocVal(t,a-1,e,!0)||t.fetchDocVal(t,a-2,e,!0)}else if(3==e.SERV_PRIORITY)if(null==e.BED_CLASS_DESC){t.fetchDocVal(t,a-1,e,!0)||t.fetchDocVal(t,a-2,e,!0)}else{t.fetchDocVal(t,a-1,e,!0)||t.fetchDocVal(t,a-2,e,!0)}else{t.fetchDocVal(t,a-1,e,!0)}},f.editRecord=function(e,t){f.fetchDocVal(f,t,e,"editFlag")},f.updateGridData=function(){null!=f.roundOffValue||null!=f.updObj.updateVal&&""!=f.updObj.updateVal?null==f.updObj.updateVal||""==f.updObj.updateVal||null!=f.updObj.effectiveDate&&""!=f.updObj.effectiveDate?g.updateDataOnClick(f):s.information("Information","Please Enter Date"):s.information("Information","Please Enter Any Value")},f.saveTariffService=function(){let e;e=f.serviceItemFlag?f.serviceItmsWiseGrid.data:f.groupWiseGrid.data;let t=u.createSaveObjForServiceWise(e,f.srchObj,f.serviceItemFlag,f.groupWiseGrid);t?m.saveTariffForServiceWise(t,f).then(function(e){if(!e)return f.flagSave=!0,void s.information("Information","Please Enter Valid Data");if(null!=e.data.HITService.message&&null!=e.data.HITService.message.tariffInfluencerVoList&&null!=e.data.HITService.message.tariffInfluencerVoList[0]&&""!=e.data.HITService.message.tariffInfluencerVoList[0]){f.flagSave=!1,p.updateDependencyTariff(f.srchObj),f.editFlagActive=!1;let e={buttonText:f.alertObj.ok},t={buttonCallBack1:function(){p.getTariffDataServiceWise(f.srchObj,f)}},a={buttonClose:function(){p.getTariffDataServiceWise(f.srchObj,f)}};f.srchObj.doctor="",delete f.autoCompletedFlag;let i="Saved Successfully";s.hisAlertMulti("success",f.alertObj.alertTypeSucss,i,e,t,a,2e3)}}):s.information("Information","Please Enter Effective Date")},f.saveNextTariffService=function(){f.nextService(f.srchObj),f.saveTariffService()},f.saveValidtion=function(){f.editFlagActive=!0,f.flagSave=g.getSaveValid(f)},f.getServiceListData(),f.autoCompletedSearchGrid=function(){f.srchObj.doctor?f.autoCompletedFlag=!0:delete f.autoCompletedFlag,f.autoserviceWiseData&&f.autoserviceWiseData.length>0&&(f.serviceItmsWiseGrid.data=r("filter")(f.autoserviceWiseData,{DOCT_NAME:"1"==f.srchObj.is_slot?_.split(f.srchObj.doctor,"-")[0]:void 0,SPL_NAME:"1"==f.srchObj.is_slot?_.split(f.srchObj.doctor,"-")[1]:f.srchObj.doctor},void 0))},f.getAutoDoctorNames=function(e){if("1"==f.srchObj.is_slot){var a={1:f.getServiceListSearch=[]},i=t.executeQueryURLReset(),n=new Array;return t.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,n),t.prepareParamListWithParam("pIpAdmSeqId",-999,n),t.prepareParamListWithParam("pDoctor",e,n),t.executeQueryInput("DV003_NEW",n,a,!0,!0,i,"popUp",{}).then(function(e){return e[1].length>0?f.getServiceListSearch.map(function(e){return e.FLAG=e.DOCTORNAME+"-"+e.FLAG,e}):[]})}return f.getServiceListSearch=r("filter")(f.specialityList,{DESCRIPTION:e},void 0),f.getServiceListSearch.map(function(e){return e.FLAG=e.DESCRIPTION,e})}}e.controller("newTariffRatesController",t),e.directive("fileread",["TariffRateValidCalService","hisAlertService","uibDatepickerConfig","$filter",function(e,t,a,i){return{scope:{opts:"="},link:function(i,r,n){r.on("change",function(n){var l=new FileReader;l.onload=function(n){i.$apply(function(){var l=n.target.result,s=XLSX.read(l,{type:"binary",bookVBA:!0,sheetStubs:!0}),o=XLSX.utils.sheet_to_json(s.Sheets[s.SheetNames[0]],{header:1})[0];delete a.ngModelOptions.timezone;l=XLSX.utils.sheet_to_json(s.Sheets[s.SheetNames[0]]);for(var c=0;c<l.length;c++)if(l[c]["Effective From"]&&"-"!=l[c]["Effective From"]){let e=moment(l[c]["Effective From"],"DD/MM/YYYY");l[c]["Effective From"]=new Date(e)}null==i.opts.srchObj.assignTariffCat||null==i.opts.srchObj.assignTariffCat||""==i.opts.srchObj.assignTariffCat||null==i.opts.srchObj.primarySrvGrp||null==i.opts.srchObj.primarySrvGrp||""==i.opts.srchObj.primarySrvGrp?t.information("Information","Please Select Mandatory Fields"):l[0][o[0]]!=i.opts.srchObj.assignTariffCat.DESCRIPTION||l[0][o[1]]!=i.opts.srchObj.primarySrvGrp.DESCRIPTION?t.information("Information","Please Select Same Tariff Category And Primary Service Group"):i.opts.serviceItemFlag?e.getExcelDataGrid(i.opts,l,o):e.getExcelDataGrid(i.opts,l,o,!0),r.val(null)})},l.readAsBinaryString(n.target.files[0])})}}}])}(),angular.module("napierContainerUi").controller("rateChangeController",rateChangeController),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f){d.loadModule("billing");var C=p.getLanguageToSet();d.changeLanguage(C),a.alertObj={},u.loadAlerts(C).then(function(e){a.alertObj=e}),a.onaccrefund={},a.obj={},a.obj2={},a.proc={},a.compChangeFlag=!1,a.flag=!1,a.viewObj={},a.onaccrefund={},a.onaccrefund.frmDate=new Date,a.onaccrefund.toDate=new Date,a.payment={},a.cancelVar=!0,a.refundVar=!0,a.viewVar=!0,a.flag1=!1,a.cancelRe=!1,a.session=JSON.parse(sessionStorage.getItem("userContextObj")),a.ref={},a.ref.reqBy=a.session.USER_SEQ_ID,a.formats=["dd-MMMM-yyyy","dd/MM/yyyy","dd.MM.yyyy","shortDate"],a.format=a.formats[1],a.altInputFormats=["M!/d!/yyyy"],a.onAccountDepositsOptions=angular.copy(S),a.searchRegisteredCompanyNames=function(e){a.cancelRe=!0,a.refundVar=!0,a.viewVar=!0;var t="%"+e+"%";a.companyName=[],a.multipleComboDataForList={1:a.companyName};var i=r.executeQueryURLReset();return a.companyNameList=new Array,r.prepareParamListWithParam("pCompCode",t,a.companyNameList),r.prepareParamListWithParam("pCompName",t,a.companyNameList),r.prepareParamListWithParam("pCompCode",t,a.companyNameList),r.prepareParamListWithParam("pCompName",t,a.companyNameList),r.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a.companyNameList),r.executeQueryInput("SCM_EMER_NOT_ALLOW_SERV_01",a.companyNameList,a.multipleComboDataForList,!0,!0,i,"popUp",{}).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})},a.showGridData=function(e){if(""==e.payStatus&&(a.onaccrefund.payStatus=void 0),a.obj=angular.copy(a.onaccrefund),""==a.onaccrefund.companyName&&(a.onaccrefund.payerId=void 0),a.obj.frmDate=e.frmDate,a.obj.toDate=e.toDate,null==a.obj.frmDate&&0==a.flag){var t=a.alertObj.plzSlctFromDate;m.warning("warning",t,!1,!1,D.time)}else if(null==a.obj.toDate&&0==a.flag){t=a.alertObj.plzSlctToDate;m.warning("warning",t,!1,!1,D.time)}else if(new Date(a.obj.frmDate)>new Date(a.obj.toDate)||new Date(a.obj.frmDate)>new Date||new Date(a.obj.toDate)>new Date){t=a.alertObj.plzSlctDate;m.warning("warning",t,!1,!1,D.time)}else v.showGridDataService(a.obj).then(function(e){var t=e;if(0==t.length)if(t.errorMessage){var i=t.errorMessage;m.failure("Failure",i,!1,!1,D.time)}else{var r=a.alertObj.noRcrdFound;m.warning("warning",r,!1,!1,D.time)}a.onAccountDepositsOptions.data=t})},a.onAccountDepositsOptions.onRegisterApi=function(e){a.gridApi=e,e.selection.on.rowSelectionChanged(a,function(e){a.selectBill=a.gridApi.selection.getSelectedRows(),1==a.selectBill.length?(a.viewObj.payerName=a.selectBill[0].payerName,a.viewObj.dAmtNo=a.selectBill[0].onaccdepNo,a.viewObj.dAmt=a.selectBill[0].depositedAmt,a.viewObj.payStatus=a.selectBill[0].payModeDesc,a.viewObj.remark=a.selectBill[0].remarks,a.viewObj.onaccdepSeqId=a.selectBill[0].onaccdepSeqId,a.viewObj.payerSeqId=a.selectBill[0].payerSeqId,a.viewObj.payerAccSeqId=a.selectBill[0].payerAccSeqId,a.viewObj.payModeDesc=a.selectBill[0].payModeDesc,a.viewObj.onaccDepositStatus=a.selectBill[0].onaccDepositStatus,a.viewObj.balAmt=a.selectBill[0].balAmt,a.viewObj.adjustedAmt=a.selectBill[0].adjustedAmt,a.ref.payStatus=a.selectBill[0].onaccDepositStatusDesc,a.viewObj.cancelReason=a.selectBill[0].cancelReason,a.ref.dAmt=a.selectBill[0].depositedAmt,a.ref.onAccDepositNo=a.selectBill[0].onaccdepNo,a.ref.onAccountDepositNo=a.selectBill[0].onaccdepSeqId,a.ref.avAm=a.selectBill[0].adjustedAmt,a.viewVar=!1,2==a.viewObj.onaccDepositStatus?a.cancelRe=!0:a.cancelRe=!1,1==a.viewObj.onaccDepositStatus?a.viewObj.dAmt==a.viewObj.adjustedAmt&&0==a.viewObj.balAmt?a.cancelVar=!0:a.cancelVar=!1:8==a.viewObj.onaccDepositStatus&&0!=a.viewObj.balAmt?(a.refundVar=!1,a.cancelVar=!0):"Paid"==a.ref.payStatus?a.refundVar=!1:(a.refundVar=!0,a.cancelVar=!0)):(a.viewVar=!0,a.cancelVar=!0,a.refundVar=!0,a.cancelRe=!1)})},a.openNew=function(e){a.new="new"==e?1:"view"==e?2:3;var t=e;1==a.new?(a.proc={},a.cmpnyBanr=[]):(a.viewObj.payerSeqId=a.selectBill[0].payerSeqId,a.viewObj.payerAccSeqId=a.selectBill[0].payerAccSeqId,a.getCompanyBanner(a.viewObj.payerSeqId,a.viewObj.payerAccSeqId));y.open(t.toUpperCase()+"_ON_ACCOUNT_DEPOSIT",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/onAccountDeposit/sections/newOnAccDep.html",size:"lg",scope:a})},a.viewObj={},a.cmpnyBanr=[],a.searchComName=function(e){var t="%"+e+"%";a.companyName1=[],a.multipleComboDataForList1={1:a.companyName1};var i=r.executeQueryURLReset();return a.companyNameList1=new Array,r.prepareParamListWithParam("pCompCode",t,a.companyNameList1),r.prepareParamListWithParam("pCompName",t,a.companyNameList1),r.prepareParamListWithParam("pCompCode",t,a.companyNameList1),r.prepareParamListWithParam("pCompName",t,a.companyNameList1),r.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a.companyNameList1),r.executeQueryInput("SCM_EMER_NOT_ALLOW_SERV_01",a.companyNameList1,a.multipleComboDataForList1,!0,!0,i,"popUp",{}).then(function(e){var t=e[1]instanceof Array?e[1]:[e[1]];return a.resu=t,t.map(function(e){return e})})},a.onaccSelect=function(e){a.onaccrefund.payerId=e.companyName.INS_SEQ_ID},a.getAvaiAmount=function(e){a.companyInput2=e.companyName.INS_SEQ_ID,a.companyInput3=e.companyName.PAYER_ACC_SEQ_ID,a.flag1=!1,a.companyName2=[],a.multipleComboDataForList2={1:a.companyName2};var t=r.executeQueryURLReset();return a.companyNameList2=new Array,r.prepareParamListWithParam("pCompSeqId",a.companyInput2,a.companyNameList2),r.prepareParamListWithParam("pFacilityID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a.companyNameList2),r.executeQueryInput("ON_ACC_DESP_AVL_AMT",a.companyNameList2,a.multipleComboDataForList2,!0,!0,t,"popUp",{}).then(function(e){var t=e[1]instanceof Array?e[1]:[e[1]];a.proc.avAm=t[0].AVAILABLE_BAL,a.viewObj.payerSeqId=a.companyInput2,a.viewObj.payerAccSeqId=a.companyInput3,a.getCompanyBanner(a.companyInput2,a.companyInput3)})},a.saveAmount=function(e){if(a.obj2=angular.copy(a.proc),a.obj2.frmDate=new Date,a.obj2.toDate=new Date,a.flag=!0,a.flag4=!0,null==a.obj2.companyName||""==a.obj2.companyName){var t=a.alertObj.plsEnterComName;m.warning("warning",t,!1,!1,D.time)}else if(null==a.obj2.dAmt){t=a.alertObj.plzEnrDepstAmt;m.warning("warning",t,!1,!1,D.time)}else if(null==a.obj2.payStatus){t=a.alertObj.selectPayMode;m.warning("warning",t,!1,!1,D.time)}else v.saveAmountService(a.obj2).then(function(e){var t=e;if(0==t.length)if(t.errorMessage){var i=t.errorMessage;m.failure("Failure",i,!1,!1,D.time)}else{var r=a.alertObj.saveFail;m.warning("warning",r,!1,!1,D.time)}else if(t.data.HITService.hasOwnProperty("messageId")){a.flag4=!1;r=a.alertObj.sucsFulGen;m.success("success",r+" "+t.data.HITService.message.onaccdepNo,!1,!1,D.time),a.showGridData(a.obj2),a.proc={},a.cmpnyBanr=[],0==a.flag1&&n.dismissAll()}})},a.cancelAmount=function(e){a.remark1=e,v.cancelAmountService(a.viewObj,a.remark1).then(function(e){var t=e;if(0==t.length)if(t.errorMessage){var i=t.errorMessage;m.failure("Failure",i,!1,!1,D.time)}else{var r=a.alertObj.noRcrdFound;m.warning("warning",r,!1,!1,D.time)}else if(t.data.HITService.hasOwnProperty("messageId")){r=a.alertObj.sucsfulyCncld;m.success("success",r,!1,!1,D.time),a.viewObj.frmDate=new Date,a.viewObj.toDate=new Date,a.showGridData(a.viewObj),a.viewObj={},a.cmpnyBanr=[],a.cancelVar=!0,n.dismissAll()}}),a.cmpnyBanr=[]},a.cancel=function(){a.viewObj={},a.cmpnyBanr=[],n.dismissAll()},a.clearData=function(e){a.proc={},a.cmpnyBanr=[]},a.clearData1=function(e){a.onaccrefund={},a.onaccrefund.frmDate=new Date,a.onaccrefund.toDate=new Date,a.onAccountDepositsOptions.data=[],a.viewVar=!0},a.saveAndNew=function(e){a.flag1=!0,a.saveAmount(e),0==a.flag4&&a.clearData(e)},a.expectedDateService=function(){a.popup2.opened=!0},a.fromDateOptions={maxDate:new Date,startingDay:1},a.popup2={opened:!1},a.fromDateChange=function(e){a.toDateOptions.maxDate=new Date,a.toDateOptions.minDate=e.frmDate},a.toDateChange=function(e){a.fromDateOptions.maxDate=e.toDate},a.toDateCAL=function(){a.popup1.opened=!0},a.popup1={opened:!1},s(function(){a.popup1.opened=!1},600),a.toDateOptions={minDate:new Date,startingDay:1},a.paymentDropdown=function(){a.getSelectedPmtMode=[];let e={1:a.getSelectedPmtMode},t=r.executeQueryURLReset(),i=new Array;r.prepareParamListWithParam("pMasterSqId","21008",i),r.executeQueryInput("NH_GN_M_MASTER_DT_COMBO",i,e,!0,!0,t,"popUp",{})},a.paymentDropdown(),a.getCompanyBanner=function(e,t){a.compChangeFlag=!0;e=a.viewObj.payerSeqId,a.viewObj.payerAccSeqId;a.cmpnyBanr=[];let i={1:a.cmpnyBanr},n=r.executeQueryURLReset(),l=new Array;r.prepareParamListWithParam("pCompSeqId",e,l),r.prepareParamListWithParam("pCompSeqId",e,l),r.prepareParamListWithParam("pPayerAccSeqId",-999,l),r.prepareParamListWithParam("pPayerAccSeqId",-999,l),r.executeQueryInput("ON_ACC_DESP_COMPANY_BANNER_NEW_001",l,i,!0,!0,n,"popUp",{})},a.cmpnyBanr=[],a.compChange=function(e){1==a.compChangeFlag&&e.companyName!=a.cmpnyBanr[0].INS_COMP_NAME&&(a.cmpnyBanr=[],a.proc={})},a.openOnRefundRequest=function(){a.ref.reqrefundAmt=void 0,a.ref.reasonRefund=void 0,a.cmpnyBanr=[],a.viewObj.payerSeqId=a.selectBill[0].payerSeqId,a.viewObj.payerAccSeqId=a.selectBill[0].payerAccSeqId,a.getCompanyBanner(a.viewObj.payerSeqId,a.viewObj.payerAccSeqId);y.open("NEW_ON_ACCOUNT_REFUND_REQUEST",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/onAccountDeposit/sections/refund.request.html",size:"lg",scope:a})},a.saveRefundRequest=function(t){if(a.reqobj=angular.copy(a.ref),null==a.reqobj.reqrefundAmt||null==a.reqobj.reqrefundAmt||""===a.reqobj.reqrefundAmt){var i=a.alertObj.enterRefAmt;m.warning("warning",i,!1,!1,D.time)}else v.saveRefundRequestService(a.reqobj).then(function(t){var i=t;if(0==i.length)if(i.errorMessage){var r=i.errorMessage;m.failure("Failure",r,!1,!1,D.time)}else{var l=a.alertObj.noRcrdFound;m.warning("warning",l,!1,!1,D.time)}else if(i.data.HITService.hasOwnProperty("messageId")){l=a.alertObj.refReqSaveSucc;m.success("success",l,!1,!1,D.time);i.onaccdepSeqId=a.viewObj.onaccdepSeqId;var s={buttonCallBack1:function(){e.printCoverService(i)},buttonCallBack2:function(){n.dismissAll()}};a.viewObj.frmDate=new Date,a.viewObj.toDate=new Date,a.reqobj={},a.ref={},a.cmpnyBanr=[],a.refundVar=!0,m.hisAlertMulti("information",a.alertObj.alertTypeInfo,a.alertObj.printask,{buttonText:"Yes",buttonText2:"No"},s),n.dismissAll()}})},a.changeOnReqAmt=function(e){null!=e.reqrefundAmt&&null!=e.reqrefundAmt&&""!==e.reqrefundAmt&&parseFloat(e.reqrefundAmt)>parseFloat(a.viewObj.balAmt)&&(e.reqrefundAmt=a.viewObj.balAmt),a.clearDeposit=function(e){e.reqrefundAmt="",e.reasonRefund=void 0}}}e.$inject=["onAccountDepositRefundService","$state","$scope","$filter","QueryService","$uibModalStack","$mdDialog","$timeout","hisCalDefConstant","uiGridConstants","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","RoleTaskService","onaccountDepositsDefinition","onAccountDepositsService","hisAlertConstants","hisModalService","$uibModal"],angular.module("napierContainerUi").controller("onAccountDepositsController",e)}(),(app=angular.module("app",["ui.grid"])).controller("MainCtrl",["$scope",function(e){e.gridOptions={columnDefs:[{field:"companyId",displayName:"Company Id"},{field:"companyName",displayName:"Company Name / Id"},{field:"onAcDepositReqNo",displayName:"On Account Deposit Request No"},{field:"depositAmt",displayName:"Deposit Amount"},{field:"paymentStatus",displayName:"Payment Status"}]},e.gridOptions.onRegisterApi=function(t){e.gridApi=t}}]),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C){u.loadModule("billing");var I=m.getLanguageToSet();u.changeLanguage(I),n.alertObj={},g.loadAlerts(I).then(function(e){n.alertObj=e}),n.onaccrefund={},n.obj={},n.proc={},n.obj1={},n.gridRowSelected=!0,n.flag=!1,n.onaccountDepositsRefundOptions=angular.copy(D),n.session=JSON.parse(sessionStorage.getItem("userContextObj")),n.proc.reqBy=n.session.USER_SEQ_ID,n.onaccrefund.frmDate=new Date,n.onaccrefund.toDate=new Date,n.disblPrintBtn=!0,n.disblProceedBtn=!0,n.formats=["dd-MMMM-yyyy","dd/MM/yyyy","dd.MM.yyyy","shortDate"],n.format=n.formats[1],n.altInputFormats=["M!/d!/yyyy"],n.searchRegisteredCompanyNames=function(e){var t="%"+e+"%";n.companyName=[],n.multipleComboDataForList={1:n.companyName};var a=s.executeQueryURLReset();return n.companyNameList=new Array,s.prepareParamListWithParam("pCompCode",t,n.companyNameList),s.prepareParamListWithParam("pCompName",t,n.companyNameList),s.prepareParamListWithParam("pCompCode",t,n.companyNameList),s.prepareParamListWithParam("pCompName",t,n.companyNameList),s.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n.companyNameList),s.executeQueryInput("SCM_EMER_NOT_ALLOW_SERV_01",n.companyNameList,n.multipleComboDataForList,!0,!0,a,"popUp",n.onaccountDepositsRefundOptions).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})},n.onaccountDepositsRefundOptions.onRegisterApi=function(e){n.gridApi=e,e.selection.on.rowSelectionChanged(n,function(e){n.selectRefund=n.gridApi.selection.getSelectedRows(),n.disblProceedBtn=!0,1==n.selectRefund.length?(n.proc.dno=n.selectRefund[0].onaccdepNo,n.proc.dAmt=n.selectRefund[0].depositedAmt,n.proc.rAmt=n.selectRefund[0].refundReqAmt,n.proc.appRefundAmt=n.selectRefund[0].appRefundAmt,n.proc.availableAmt=n.selectRefund[0].availableAmt,n.proc.deprefundSeqId=n.selectRefund[0].deprefundSeqId,n.proc.onaccdepSeqId=n.selectRefund[0].onaccdepSeqId,n.onaccrefund.onaccdepSeqId=n.selectRefund[0].onaccdepSeqId,n.proc.payerAccSeqId=n.selectRefund[0].payerAccSeqId,n.proc.cid=n.selectRefund[0].companyId,n.proc.cmpnyName=n.selectRefund[0].companyName,n.gridRowSelected=!1,n.proc.pseqid=n.selectRefund[0].payerSeqId,n.proc.rReq=n.selectRefund[0].reasonRefund,n.getCompanyBanner(n.proc.pseqid,n.proc.payerAccSeqId),n.proc.status=n.selectRefund[0].refundReqStatusDesc,"Pending"==n.proc.status&&(n.disblProceedBtn=!1),n.disblPrintBtn=!1):n.disblPrintBtn=!0})},n.showGridData=function(e){n.obj=angular.copy(n.onaccrefund),n.obj.ccode=void 0,n.obj.cname=void 0,""==n.onaccrefund.companyName&&(n.obj.payerId=void 0),null!=n.obj.companyName&&(n.obj.cname=n.obj.companyName.INS_COMP_NAME,n.obj.ccode=n.obj.companyName.INS_COMP_CODE),null==n.obj.frmDate&&0==n.flag?S.warning("Warning",n.alertObj.plzSlctFromDate,!1,!1,f.time):null==n.obj.toDate&&0==n.flag?S.warning("warning",n.alertObj.plzSlctToDate,!1,!1,f.time):new Date(n.obj.frmDate)>new Date(n.obj.toDate)||new Date(n.obj.frmDate)>new Date||new Date(n.obj.toDate)>new Date?S.warning("Warning",n.alertObj.plzSlctDate,!1,!1,f.time):y.showGridDataService(n.obj).then(function(e){var t=e;if(0==t.length&&S.warning("Warning",n.alertObj.noRcrdFound,!1,!1,f.time),null==t)if(t.errorMessage){var a=t.errorMessage;S.failure("Failure",a,!1,!1,f.time)}else S.failure("Failure",n.alertObj.nogridrecords,!1,!1,f.time);else n.onaccountDepositsRefundOptions.data=t})},n.printCover=function(e){y.printCoverService(n.onaccrefund)},n.proceedAccountRefund=function(){n.proc.refApp=void 0,n.proc.remark=void 0;C.open("On Account Deposit Approval-Disapproval",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/onAccountDepositRefund/sections/refund.proceed.html",size:"lg",scope:n})},n.saveRefundProceed=function(e){"1"==n.proc.approval&&(n.obj1.refApp=void 0),"0"==n.proc.approval&&(n.obj1.reasonDis=void 0,n.obj1.reasonDis=""),n.obj1=angular.copy(n.proc),null!=n.obj1.refApp&&null!=n.obj1.refApp&&""!==n.obj1.refApp||"0"!=n.obj1.approval?null!=n.obj1.reasonDis&&null!=n.obj1.reasonDis&&""!==n.obj1.reasonDis||"1"!=n.obj1.approval?y.saveRefundProceedService(n.obj1).then(function(e){var a=e;if(null==a.data.HITService.messageId)if(a.data.HITService.message.errorMessage){var i=a.data.HITService.message.errorMessage;S.failure("Failure",i,!1,!1,f.time)}else S.failure("Failure",n.alertObj.failrefundrequest,!1,!1,f.time);else a.data.HITService.hasOwnProperty("messageId")&&(S.success("Success",n.alertObj.successrefundrequest,!1,!1,f.time),n.onaccrefund.frmDate=new Date,n.onaccrefund.toDate=new Date,n.showGridData(n.onaccrefund),n.obj1={},n.proc={},n.cmpnyBanr=[],t.dismissAll())}):S.warning("Warning",n.alertObj.enterrejectionReason,!1,!1,f.time):S.warning("Warning",n.alertObj.enterrefundamount,!1,!1,f.time)},n.clearDetails=function(e){n.onaccrefund={},n.onaccrefund.frmDate=new Date,n.onaccrefund.toDate=new Date,n.onaccountDepositsRefundOptions.data=[]},n.clearRefundReq=function(e){n.proc.refApp="",n.proc.reasonDis="",n.proc.remark=""},n.getCompanyBanner=function(e,t){e=e;n.cmpnyBanr=[];let a={1:n.cmpnyBanr},i=s.executeQueryURLReset(),r=new Array;s.prepareParamListWithParam("pCompSeqId",e,r),s.prepareParamListWithParam("pCompSeqId",e,r),s.prepareParamListWithParam("pPayerAccSeqId",-999,r),s.prepareParamListWithParam("pPayerAccSeqId",-999,r),s.executeQueryInput("ON_ACC_DESP_COMPANY_BANNER_NEW_001",r,a,!0,!0,i,"popUp",{})},n.expectedDateService=function(){n.popup2.opened=!0},n.fromDateOptions={maxDate:new Date,startingDay:1},n.fromDateChange=function(e){n.toDateOptions.maxDate=new Date,n.toDateOptions.minDate=e.frmDate},n.popup2={opened:!1},n.toDateChange=function(e){n.fromDateOptions.maxDate=e.toDate},n.toDateCAL=function(){n.popup1.opened=!0},n.popup1={opened:!1},c(function(){n.popup1.opened=!1},600),n.toDateOptions={minDate:new Date,startingDay:1},n.changeStatus=function(e){n.proc.refApp=void 0,n.proc.reasonDis="",n.proc.reasonDis=void 0},n.changeOnAprvAmt=function(e){null!=e.refApp&&null!=e.refApp&&""!==e.refApp&&parseFloat(e.refApp)>parseFloat(e.rAmt)&&(e.refApp=e.rAmt)}}e.$inject=["$state","$uibModalStack","PrintService","$q","CallManager","$scope","$filter","QueryService","$mdDialog","$timeout","hisCalDefConstant","uiGridConstants","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","RoleTaskService","onaccountDepositRefundDefinition","onAccountDepositRefundService","hisAlertConstants","hisModalService"],angular.module("napierContainerUi").controller("onAccountDepositRefundController",e),angular.module("napierContainerUi").controller("acountRefPrint",["returnObj","$uibModalInstance","selectedPrintType","PrintService","$scope",function(e,t,a,i,r){r.pageName="On Account Deposit Refund",r.cancel=function(){t.dismiss("cancel")},r.printObject={},r.printObject.reportId=e.reportId,r.printObject.destination="reportingServiceImpl",r.printObject.reportType={id:"PDF"==a?4:5,desc:a},r.printObject.paramsList=e.paramsList,i.printReportFunction(r.printObject,r)}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u){a.loadModule("billing");var m=i.getLanguageToSet();if(a.changeLanguage(m),e.alertData={},r.loadAlerts(m).then(function(t){e.myObj=t,e.alertData={buttonText:e.myObj.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}}),"HSC"===sessionStorage.productCustomization){e.packageChecklistScreen=!0,e.packageCheckListGrid=angular.copy(d);for(var g=[],S=1;S<=10;S++)10==S?g.push({checkListItemPriority:S,hideShowRow:!0}):g.push({checkListItemPriority:S,hideShowRow:!1});e.packageCheckListGrid.data=g}e.srvcInc_isZero=!1,e.matInc_isZero=!1,e.isBedClassDisabled=!1,e.isMaterialBedClassDisabled=!1,e.showBedClassError=!1,e.showMatBedError=!1,e.isBedClassValuesFilled=!1,e.isTotalDaysValid=!0,e.pc_isValid=!0,e.si_isValid=!0,e.mt_isValid=!0,e.example14model=[],e.materialBedModel=[],e.serviceIncl=0,e.materialIncl=0;e.pc_vDFrom=new Date,e.mtVdFrm=new Date,e.si_VDFrom=new Date,e.dateDiff=1e4,e.CFP_chk=!1,e.servAdd=!1,e.mtrlAdd=!1;var v=new Date;new Date(v.getFullYear(),v.getMonth(),v.getDate());e.bedClassList=[],e.example14settings={scrollableHeight:"200px",scrollable:!0,enableSearch:!0},e.packageCheckListGridVoModel=[],e.getPName=function(t,a,i){if(i||(e.packageName="",e.clearArrayBlock(),e.clearPackageDaysFields(),e.clearServiceInclusionFields(),e.clearMaterialInclusionFields(),e.clearAddSrvcExclusionFields(),e.clearAddMatExclusionFields()),e.packageSelect=!0,e.packCat=t,e.packType=a,t){e.packNameTest=[],e.multipleComboDataForChangeList={1:e.packNameTest};var r=o.executeQueryURLReset();e.packageNameList=new Array,o.prepareParamList(1,a.gQDataCode?a.gQDataCode:"",e.packageNameList),o.prepareParamList(2,a.gQDataCode?a.gQDataCode:"",e.packageNameList),o.prepareParamList(3,t.gQDataCode?t.gQDataCode:"",e.packageNameList),o.prepareParamList(4,t.gQDataCode?t.gQDataCode:"",e.packageNameList),o.executeQueryInput("PACK_SEARCH",e.packageNameList,e.multipleComboDataForChangeList,!0,!0,r,"popUp")}},e.getSearchView=function(t){e.clearArrayBlock(),e.clearPackageDaysFields(),e.clearServiceInclusionFields(),e.clearMaterialInclusionFields(),e.clearAddSrvcExclusionFields(),e.clearAddMatExclusionFields(),1==e.showIpElements&&(e.isBedClassDisabled=!0),e.isOpen=!0,e.packNameSeqId=[{paramName:"pServSeqId",value:t}],e.bedClassDaysInfo=[],e.packageDetailsInfo=[],e.packageInclusionServiceInfo=[],e.packageExclusionServiceInfo=[],e.packageInclusionMaterialInfo=[],e.packageExclusionMaterialInfo=[],e.multipleGridDataForPackageSearch={1:e.bedClassDaysInfo,2:e.packageDetailsInfo,3:e.packageInclusionServiceInfo,4:e.packageExclusionServiceInfo,5:e.packageInclusionMaterialInfo,6:e.packageExclusionMaterialInfo};var a=o.executeQueryURLReset();return o.executeQueryInput("BED_CLASSDAYS",e.packNameSeqId,e.multipleGridDataForPackageSearch,!0,!1,a,"popUp",{}),o.executeQueryInput("PACK_DETAILS",e.packNameSeqId,e.multipleGridDataForPackageSearch,!0,!1,a,"popUp",{}),o.executeQueryInput("PACK_INCL_SERV",e.packNameSeqId,e.multipleGridDataForPackageSearch,!0,!1,a,"popUp",{}),o.executeQueryInput("PACK_EXCL_SERV",e.packNameSeqId,e.multipleGridDataForPackageSearch,!0,!1,a,"popUp",{}),o.executeQueryInput("PACK_INCL_MTRL",e.packNameSeqId,e.multipleGridDataForPackageSearch,!0,!1,a,"popUp",{}),o.executeQueryInput("PACK_EXCL_MTRL",e.packNameSeqId,e.multipleGridDataForPackageSearch,!0,!0,a,"popUp",{}).then(function(t){0!=e.bedClassDaysInfo&&(e.icu_days=e.bedClassDaysInfo[0].ICU_DAYS,e.regular_days=e.bedClassDaysInfo[0].REGULAR_DAYS,e.preProc_days=e.bedClassDaysInfo[0].PRE_PROC_DAYS,e.tot=e.bedClassDaysInfo[0].TOTAL_DAYS,e.pkgDays=e.bedClassDaysInfo[0].TOTAL_DAYS,e.packDays=e.bedClassDaysInfo[0].data,e.endays=e.bedClassDaysInfo[0].SUBDESCRITPION),e.facilitySeqId=e.packageDetailsInfo[0].PACK_FACLITY_ID,e.facility=e.packageDetailsInfo[0].FACILITY,e.defDeptCode=e.packageDetailsInfo[0].DEF_DEPT_CODE,e.depart=e.packageDetailsInfo[0].DESCRIPTION,e.subDeptSeqId=e.packageDetailsInfo[0].PACK_SUBDEPT_CODE,e.subDepart=e.packageDetailsInfo[0].SUBDESCRITPION,e.packageType1=e.packageDetailsInfo[0].PACKAGE_TYPE,e.packType1=e.packageDetailsInfo[0].PACKAGE_TYPE_DESC,e.packCat1=e.packageDetailsInfo[0].PACKAGECATEGORY,e.servName=e.packageDetailsInfo[0].SERV_NAME,e.aliasName=e.packageDetailsInfo[0].ALIASNAME,e.fDate=e.packageDetailsInfo[0].SERV_FROM_DATE,e.tDate=e.packageDetailsInfo[0].SERV_TO_DATE,e.prepareServInclusionGridData(e.packageInclusionServiceInfo),e.prepareServExclusionGridData(e.packageExclusionServiceInfo),e.prepareMtrlInclusionGridData(e.packageInclusionMaterialInfo),e.prepareMtrlExclusionGridData(e.packageExclusionMaterialInfo)}),!1},e.servcChange=function(t){e.sample=_.find(e.inServiceNameResp,function(e){return e.columnList[0]["com.napier.core.service.vo.query.Column"][0].data==t}),e.SubGr=_.find(e.inSubDept_srvcInclusion_Resp,function(t){return t.columnList[0]["com.napier.core.service.vo.query.Column"][1].data==e.sample.columnList[0]["com.napier.core.service.vo.query.Column"][2].data}),e.si_subDept=e.SubGr.columnList[0]["com.napier.core.service.vo.query.Column"][0].data.toString()},e.ServcExclChange=function(t){e.sample1=_.find(e.inServiceNameResp,function(e){return e.columnList[0]["com.napier.core.service.vo.query.Column"][0].data==t}),e.SubGr1=_.find(e.inSubDept_srvcInclusion_Resp,function(t){return t.columnList[0]["com.napier.core.service.vo.query.Column"][1].data==e.sample1.columnList[0]["com.napier.core.service.vo.query.Column"][2].data}),e.se_subDept=e.SubGr1.columnList[0]["com.napier.core.service.vo.query.Column"][0].data.toString()},e.mtrlChange=function(t){e.Matsample=_.find(e.inMaterialNameResp,function(e){return e.columnList[0]["com.napier.core.service.vo.query.Column"][0].data==t}),e.MatSubGr=_.find(e.inMaterialSubGroupResp,function(t){return t.columnList[0]["com.napier.core.service.vo.query.Column"][1].data==e.Matsample.columnList[0]["com.napier.core.service.vo.query.Column"][2].data}),e.mtSubGrp=e.MatSubGr.columnList[0]["com.napier.core.service.vo.query.Column"][0].data.toString()},e.mtrlExclChange=function(t){e.Matsample1=_.find(e.inMaterialNameResp,function(e){return e.columnList[0]["com.napier.core.service.vo.query.Column"][0].data==t}),e.MatSubGr1=_.find(e.inMaterialSubGroupResp,function(t){return t.columnList[0]["com.napier.core.service.vo.query.Column"][1].data==e.Matsample1.columnList[0]["com.napier.core.service.vo.query.Column"][2].data}),e.mtEx_SubGrp=e.MatSubGr1.columnList[0]["com.napier.core.service.vo.query.Column"][0].data.toString()},e.permissionsObj=p.rolePermission("T_BL_M_PACKAGE_CREATION"),null==e.permissionsObj.T_BL_M_PACKAGE_CREATION_N?e.permission=!0:e.permission=!1,e.prepareDataForBedPlotting=function(e,t,a,i,r,n){for(var l=[],s=0;s<e.length;s++)for(var o=0;o<t.length;o++)if(e[s]==t[o].bedCode){var c;c={bedName:t[o].bedName,bedCode:e[s],bedAmount:r[s],limit:0},n[e[s]]=r[s],a[s]=c,l.push({bedName:t[o].bedName,bedCode:e[s]})}return l},e.prepareServInclusionGridData=function(t){e.sendSave_ServiceInclusion_Array=[],e.bedValue=[],e.bedArray=[],e.gridOptions.data=[];for(var a=null,i=0;i<t.length;i++){if(t[0].BEDNAME){var r=t[0].BEDNAME;e.bedNameStr=null!=r.indexOf?r.split(","):r}if(t[0].BC_CODE){var n=t[0].BC_CODE;e.bedCode=null!=n.indexOf?n.split(","):n}if(e.si_saveBedClassArray=[],0==t[i].INCL_AMOUNT&&0==t[i].QTY)var l="N/L";else l=0;var s=t[i].FROM_DATE?t[i].FROM_DATE.split("-"):"",o=t[i].TO_DATE?t[i].TO_DATE.split("-"):"";if(e.srvIncObj={serialNumber:i+1,CISSEQID:t[i].CIS_SEQ_ID,serviceId:t[i].INCL_SERV_SEQ_ID,servName:t[i].SERV_NAME,departmentId:t[i].DEPT_CODE,departmentName:t[i].DepartmentName,sub_department_ID:t[i].SUB_DEPT_ID,sub_department:t[i].SubDepartmentCode,no_limit:l,qty:t[i].QTY,amount:t[i].INCL_AMOUNT,BEDSEQID:t[i].BEDSEQID.split(","),fromDate:""==s?"":s[0]+"-"+s[1]+"-"+s[2].substring(0,2),toDate:""==o?"":o[0]+"-"+o[1]+"-"+o[2].substring(0,2)},0!=e.srvIncObj.qty){if(e.bedValue=null==t[i].LIMIT.indexOf?t[i].LIMIT:t[i].LIMIT.split(","),e.bedClassName=null==t[i].BEDNAME.indexOf?t[i].BEDNAME:t[i].BEDNAME.split(","),n){for(var c=0;c<e.bedCode.length;c++)e.si_saveBedClassObj={bedClassSeqId:e.bedCode[c],limit:e.bedValue[c],inclusionType:1,amount:0},e.si_saveBedClassArray.push(e.si_saveBedClassObj);0==i&&(a=e.prepareDataForBedPlotting(e.bedClassName,e.bedClassList,e.bedArray,"quantity",e.bedValue,e.srvIncObj),e.changeBedClass(a))}}else if(e.srvIncObj.amount){if(e.bedClassName=null==t[i].BEDNAME.indexOf?t[i].BEDNAME:t[i].BEDNAME.split(","),e.bedValue=null==t[i].AMOUNT.indexOf?t[i].AMOUNT:t[i].AMOUNT.split(","),n){for(c=0;c<e.bedCode.length;c++)e.si_saveBedClassObj={bedClassSeqId:e.bedCode[c],limit:0,inclusionType:1,amount:e.bedValue[c]},e.si_saveBedClassArray.push(e.si_saveBedClassObj);0==i&&(a=e.prepareDataForBedPlotting(e.bedClassName,e.bedClassList,e.bedArray,"amount",e.bedValue,e.srvIncObj),e.changeBedClass(a))}}else if(null!=e.bedNameStr&&""!=e.bedNameStr&&(e.bedValue=e.bedNameStr,e.bedValue.fill("N/L"),e.bedClassName=null==t[i].BEDNAME.indexOf?t[i].BEDNAME:t[i].BEDNAME.split(","),n)){for(c=0;c<e.bedCode.length;c++)e.si_saveBedClassObj={bedClassSeqId:e.bedCode[c],limit:0,inclusionType:1,amount:0},e.si_saveBedClassArray.push(e.si_saveBedClassObj);0==i&&(a=e.prepareDataForBedPlotting(e.bedClassName,e.bedClassList,e.bedArray,"",e.bedValue,e.srvIncObj),e.changeBedClass(a))}e.srvIncObj.bedValue=e.bedValue,e.gridOptions.data.push(e.srvIncObj),e.addRow_ServiceInclusion_Array.push(e.srvIncObj),r&&e.bedCreationAndAssignmentOfValues(r,e.gridOptions,e.srvIncObj,e.bedValue,n,"serviceIncl"),e.incTemp=[],e.incTemp.push(e.srvIncObj);for(var d=0;d<e.incTemp.length;d++)e.saveSrvInclusionObj={"@class":"com.napier.core.masters.vo.CompositeIncludeServiceVo",inclServSeqId:e.incTemp[d].serviceId,isPost:2,isPre:2,isPrint:2,servName:e.incTemp[d].servName,deptCode:e.incTemp[d].departmentId,subDeptSeqId:e.incTemp[d].sub_department_ID,amount:e.incTemp[d].amount,qty:e.incTemp[d].qty,fromDate:e.incTemp[d].fromDate+"T00:00:00.001Z",toDate:e.incTemp[d].toDate+"T00:00:00.001Z",bedClassWiseLimitsListVo:[{"com.napier.core.masters.vo.BedClassLimitVo":e.si_saveBedClassArray}]},e.sendSave_ServiceInclusion_Array.push(e.saveSrvInclusionObj)}},e.prepareServExclusionGridData=function(t){e.save_srvcEx_Array=[],e.gridOptions_IP_srvExc.data=[];for(var a=0;a<t.length;a++){e.servExGridObj={serialNumber:a+1,CESSEQID:t[a].CES_SEQ_ID,service_IP_ex_ID:t[a].EXCL_SERV_SEQ_ID,service_IP_ex:t[a].SERV_NAME,department_ID:t[a].DEPT_CODE,department:t[a].DepartmentName,sub_department_ID:t[a].SUB_DEPT_CODE,sub_department:t[a].SubDepartmentCode},e.gridOptions_IP_srvExc.data.push(e.servExGridObj),e.sampleIp_srvExc_Array.push(e.servExGridObj),e.srvTemp=[],e.srvTemp.push(e.servExGridObj);for(a=0;a<e.srvTemp.length;a++)e.save_srvcEx_Obj={exclServSeqId:e.srvTemp[a].service_IP_ex_ID,deptCode:e.srvTemp[a].department_ID,subDeptSeqId:e.srvTemp[a].sub_department_ID},e.save_srvcEx_Array.push(e.save_srvcEx_Obj)}},e.prepareMtrlInclusionGridData=function(t){e.sendSave_MaterialInclusion_Array=[],e.gridOptions_2.data=[];for(var a=0;a<t.length;a++){if(t[0].BEDNAME)var i=t[0].BEDNAME;if(t[0].BEDNAME)var r=null==t[0].BEDNAME.indexOf?t[0].BEDNAME:t[0].BEDNAME.split(",");var n=t[0].BC_CODE;if(t[0].BC_CODE)var l=null==t[0].BC_CODE.indexOf?t[0].BC_CODE:t[0].BC_CODE.split(",");if(e.mi_saveBedClassArray=[],0!=t[a].QTY||0!=t[a].MTR_AMOUNT&&""!=t[a].MTR_AMOUNT)s=0;else var s="N/L";var o=t[a].FROM_DATE?t[a].FROM_DATE.split("-"):"",c=t[a].TO_DATE?t[a].TO_DATE.split("-"):"";if(e.matIncObj={serialNumber:a+1,CIMSEQID:t[a].CIM_SEQ_ID,materialNameId:t[a].MTRL_CODE,materialName:t[a].MaterialName,materialGroupID:t[a].MTR_GRPSEQ_ID,materialGroup:t[a].MaterialMainGroupName,materialSubGroupID:t[a].MTR_SUB_GRPSEQ_ID,materialSubGroup:t[a].MaterialSubGroupName,qty:t[a].QTY,mtrlNoLimit:s,amount:t[a].MTR_AMOUNT,BEDSEQID:null==t[a].BEDSEQID.indexOf?t[a].BEDSEQID:t[a].BEDSEQID.split(","),frDate:o[0]+"-"+o[1]+"-"+o[2].substring(0,2),toDate:c[0]+"-"+c[1]+"-"+c[2].substring(0,2)},0!=e.matIncObj.qty){if(e.bedValue=null==t[a].LIMIT.indexOf?t[a].LIMIT:t[a].LIMIT.split(","),e.bedCode=null==t[a].BC_CODE.indexOf?t[a].BC_CODE:t[a].BC_CODE.split(","),l){for(var d=0;d<l.length;d++)e.mi_saveBedClassObj={bedClassSeqId:l[d],materialSeqId:t[a].MTRL_CODE,limit:e.bedValue[d],inclusionType:1,amount:0},e.mi_saveBedClassArray.push(e.mi_saveBedClassObj);0==a&&e.prepareDataForBedPlotting(e.bedClassName,e.bedClassList,e.bedArray,"amount",e.bedValue,e.matIncObj)}}else if(e.matIncObj.amount){if(e.bedValue=null==t[a].AMOUNT.indexOf?t[a].AMOUNT:t[a].AMOUNT.split(","),e.bedCode=null==t[a].BC_CODE.indexOf?t[a].BC_CODE:t[a].BC_CODE.split(","),l){for(d=0;d<l.length;d++)e.mi_saveBedClassObj={bedClassSeqId:l[d],materialSeqId:t[a].MTRL_CODE,limit:0,inclusionType:1,amount:e.bedValue[d]},e.mi_saveBedClassArray.push(e.mi_saveBedClassObj);0==a&&e.prepareDataForBedPlotting(e.bedClassName,e.bedClassList,e.bedArray,"amount",e.bedValue,e.matIncObj)}}else if(null!=r&&""!=r&&(e.bedValue=r,e.bedValue.fill("N/L"),e.bedCode=null==t[a].BC_CODE.indexOf?t[a].BC_CODE:t[a].BC_CODE.split(","),l)){for(d=0;d<l.length;d++)e.mi_saveBedClassObj={bedClassSeqId:l[d],materialSeqId:t[a].MTRL_CODE,limit:0,inclusionType:1,amount:0},e.mi_saveBedClassArray.push(e.mi_saveBedClassObj);0==a&&e.prepareDataForBedPlotting(e.bedClassName,e.bedClassList,e.bedArray,"amount",e.bedValue,e.bedCode,e.matIncObj)}e.matIncObj.bedValue=e.bedValue,e.gridOptions_2.data.push(e.matIncObj),e.addRow_MaterialInclusion_Array.push(e.matIncObj),i&&e.bedCreationAndAssignmentOfValues(i,e.gridOptions_2,e.matIncObj,e.bedValue,n,"materialIncl"),e.mtrlTemp=[],e.mtrlTemp.push(e.matIncObj);for(var p=0;p<e.mtrlTemp.length;p++)e.saveMat_Obj={"@class":"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo",isPost:2,isPre:2,mtrlCode:e.mtrlTemp[p].materialNameId,mtrlGrpSeqId:e.mtrlTemp[p].materialGroupID,mtrlGrpSubSeqId:e.mtrlTemp[p].materialSubGroupID,frDate:e.mtrlTemp[p].frDate+"T00:00:00.001Z",toDate:e.mtrlTemp[p].toDate+"T00:00:00.001Z",amount:e.mtrlTemp[p].amount,qty:e.mtrlTemp[p].qty,mtrlPackBedClassLimitVoList:[{"com.napier.core.masters.vo.MtrlPackBedClassLimitVo":e.mi_saveBedClassArray}]},e.sendSave_MaterialInclusion_Array.push(e.saveMat_Obj)}},e.prepareMtrlExclusionGridData=function(t){e.save_matEx_Array=[],e.gridOptions_IP_mat_ex.data=[];for(var a=0;a<t.length;a++){e.servExGridObj={serialNumber:a+1,CEMSEQID:t[a].CEM_SEQ_ID,materialName_ID:t[a].MTRL_CODE,materialName:t[a].MaterialName,materialGroup_ID:t[a].MTRL_MAIN_CODE,materialGroup:t[a].MaterialMainGroupName,materialSubGroup_ID:t[a].MTRL_SUB_CODE,materialSubGroup:t[a].MaterialSubGroupName},e.gridOptions_IP_mat_ex.data.push(e.servExGridObj),e.sampleIp_matExc_Array.push(e.servExGridObj),e.matexcTemp=[],e.matexcTemp.push(e.servExGridObj);for(var i=0;i<e.matexcTemp.length;i++)e.save_matEx_Obj={mtrlCode:e.matexcTemp[i].materialName_ID,mtrlMainCode:e.matexcTemp[i].materialGroup_ID,mtrlSubCode:e.matexcTemp[i].materialSubGroup_ID},e.save_matEx_Array.push(e.save_matEx_Obj)}for(var r=e.gridOptions.columnDefs,n=[],l=0;l<r.length&&"fromDate"!=r[l].field;l++)l>5&&n.push(r[l].field);e.bedclases=[];for(a=0;a<n.length;a++)e.bedclases[a]=_.find(e.bedClassList,function(e){return e.bedName==n[a]});e.materialBedModel=e.bedclases,e.example14model=e.bedclases},e.bedCreationAndAssignmentOfValues=function(t,a,i,r,n,l){"serviceIncl"==l?e.serviceIncl=e.serviceIncl+1:"materialIncl"==l&&(e.materialIncl=e.materialIncl+1);var s=null!=t.indexOf?t.split(","):t;e.bedDetailsList=[];for(var o=null!=n.indexOf?n.split(","):n,c=[],d=0;d<s.length;d++)-1==c.indexOf(s[d])&&c.push(s[d]);s=c;for(var p=0;p<s.length;p++){e.bedclassObj={field:s[p],displayName:s[p],enableSorting:!0,enableCellEdit:!0,width:100},i[s[p]]=r[p],1!=e.serviceIncl&&1!=e.materialIncl||a.columnDefs.splice(6,0,e.bedclassObj),{gQDataCode:parseInt(o[p]),gQDataName:s[p],gQDataSequence:""}}},e.getBedClassArray=function(t){for(var a={},i=0;i<t.length;i++)a={bedName:t[i].columnList[0]["com.napier.core.service.vo.query.Column"][1].data,bedCode:t[i].columnList[0]["com.napier.core.service.vo.query.Column"][0].data},e.bedClassList.push(a)},e.resetServiceInclusionGrid=function(){return e.gridDefinationColumDef=[{field:"departmentName",displayName:"billing.department",headerCellFilter:"translate",width:"15%",cellTemplate:e.tmpl1,cellEditableCondition:!1,cellClass:"cellToolTip",enableSorting:!0},{field:"sub_department",displayName:"billing.subDepartment",headerCellFilter:"translate",width:"15%",cellEditableCondition:!1,cellTemplate:e.tmpl1,cellClass:"cellToolTip",enableSorting:!0},{field:"servName",displayName:"billing.service",headerCellFilter:"translate",width:"15%",cellEditableCondition:!1,cellTemplate:e.tmpl1,cellClass:"cellToolTip",enableSorting:!0},{field:"no_limit",displayName:"billing.noLimit",headerCellFilter:"translate",width:"5%",cellEditableCondition:!1,cellClass:"cellToolTip"},{field:"amount",displayName:"billing.amt",headerCellFilter:"translate",width:"10%",cellEditableCondition:!1,cellClass:"cellToolTip",cellTemplate:e.tmpl1},{field:"qty",displayName:"billing.quantity",headerCellFilter:"translate",width:"10%",cellEditableCondition:!1,cellTemplate:e.tmpl1,cellClass:"cellToolTip"},{field:"fromDate",displayName:"billing.validfrom",headerCellFilter:"translate",width:"10%",cellEditableCondition:!1,cellTemplate:e.tmpl1,cellClass:"cellToolTip"},{field:"toDate",displayName:"billing.validto",headerCellFilter:"translate",width:"10%",cellEditableCondition:!1,cellTemplate:e.tmpl1,cellClass:"cellToolTip"},{field:"Action",displayName:"billing.actions",headerCellFilter:"translate",width:"10%",cellEditableCondition:!1,cellClass:"cellToolTip",cellTemplate:'<div><span style="padding-left:10px"  data-toggle="modal" data-target="#opServiceInclusion" class="glyphicon glyphicon-trash glyf" ng-click="grid.appScope.deleteRowPC(row)"> </span></div>'},{field:"deptCode",displayName:"deptCode",cellEditableCondition:!1,cellTemplate:e.tmpl1,cellClass:"cellToolTip",enableSorting:!0,visible:!1},{field:"subDeptSeqId",displayName:"subDeptSeqId",cellEditableCondition:!1,cellTemplate:e.tmpl1,cellClass:"cellToolTip",enableSorting:!0,visible:!1},{field:"inclServSeqId",displayName:"inclServSeqId",visible:!1},{field:"cimSeqId",displayName:"cimSeqId",cellEditableCondition:!1,cellTemplate:e.tmpl1,cellClass:"cellToolTip",enableSorting:!0,visible:!1}],e.gridDefinationColumDef},e.serviceInclusionColumns=e.resetServiceInclusionGrid(),e.resetMaterialInclusionGrid=function(){return e.gridDefinationColumDefMat=[{field:"materialGroup",displayName:"billing.material.group",headerCellFilter:"translate",cellEditableCondition:!1,width:"15%",cellClass:"cellToolTip",enableSorting:!0},{field:"materialSubGroup",displayName:"billing.material.subgroup",headerCellFilter:"translate",cellEditableCondition:!1,width:"15%",cellClass:"cellToolTip",enableSorting:!0},{field:"materialName",displayName:"billing.materialName",headerCellFilter:"translate",cellEditableCondition:!1,width:"15%",cellClass:"cellToolTip",enableSorting:!0},{field:"mtrlNoLimit",displayName:"billing.noLimit",headerCellFilter:"translate",cellEditableCondition:!1,width:"5%",cellClass:"cellToolTip",enableSorting:!0},{field:"amount",displayName:"billing.amt",headerCellFilter:"translate",cellEditableCondition:!1,width:"10%",cellClass:"cellToolTip",enableSorting:!0},{field:"qty",displayName:"billing.quantity",headerCellFilter:"translate",cellEditableCondition:!1,width:"10%",cellClass:"cellToolTip",enableSorting:!0},{field:"frDate",displayName:"billing.validfrom",headerCellFilter:"translate",cellEditableCondition:!1,width:"10%",cellClass:"cellToolTip",enableSorting:!0},{field:"toDate",displayName:"billing.validto",headerCellFilter:"translate",cellEditableCondition:!1,width:"10%",cellClass:"cellToolTip",enableSorting:!0},{field:"Action",displayName:"billing.actions",headerCellFilter:"translate",cellEditableCondition:!1,cellTemplate:'<div><span style="padding-left:10px" data-toggle="modal" data-target="#opMaterialInclusion" class="glyphicon glyphicon-trash glyf" ng-click="grid.appScope.deleteRowMCI(row)"> </span></div>',width:"10%",cellClass:"cellToolTip",enableSorting:!0},{field:"cimSeqId",displayName:"cimSeqId",cellEditableCondition:!1,cellTemplate:e.tmpl1,cellClass:"cellToolTip",enableSorting:!0,visible:!1},{field:"mtrlCode",displayName:"mtrlCode",cellEditableCondition:!1,cellTemplate:e.tmpl1,cellClass:"cellToolTip",enableSorting:!0,visible:!1},{field:"mtrlGrpSeqId",displayName:"mtrlGrpSeqId",visible:!1},{field:"mtrlGrpSubSeqId",displayName:"mtrlGrpSubSeqId",visible:!1}],e.gridDefinationColumDefMat},e.MaterialInclusionColumnDefsArray=e.resetMaterialInclusionGrid(),e.getModelByCode=function(e,t,a){if(!(null!=e&&null!=e&&e.length>0&&null!=t&&null!=t&&""!=t))return null;for(var i=0;i<e.length;i++)if(a){if(e[i].bedCode.toString().trim()==t.toString().trim())return e[i]}else if(e[i].bedCode.toString().trim()==t.toString().trim())return e[i]},e.changeBedClass=function(t){e.serviceInclusionColumns=e.resetServiceInclusionGrid(),e.plottingGridDefinition(t,e.serviceInclusionColumns);for(var a=[],i=0;i<t.length;i++)a.push(e.getModelByCode(e.bedClassList,t[i].bedCode,!1));e.example14model=a,e.gridOptions.columnDefs=e.serviceInclusionColumns,e.MaterialInclusionColumnDefsArray=e.resetMaterialInclusionGrid(),e.plottingGridDefinition(t,e.MaterialInclusionColumnDefsArray),e.materialBedModel=a,e.gridOptions_2.columnDefs=e.MaterialInclusionColumnDefsArray},e.changeBedClassMat=function(e){},e.example2settings={displayProp:"id"},e.pd=function(t){e.pkgDays=t,e.pkgDays!=e.tot?e.isTotalDaysValid=!1:e.isTotalDaysValid=!0},e.totalDays=function(t,a,i,r){e.pkgDays=parseInt(r),e.icu_days=null==t||" "==t||null==t?0:parseInt(t),e.regular_days=null==a||" "==a||null==a?0:parseInt(a),e.preProc_days=null==i||" "==i||null==i?0:parseInt(i),e.tot=e.icu_days+e.regular_days+e.preProc_days,e.tot===e.pkgDays&&e.tot&&e.pkgDays?e.isTotalDaysValid=!0:e.isTotalDaysValid=!1},e.showIpElements=!1,e.dupBool=!1,e.dupFlag=!1,e.srvCount=0,e.isActive=!1,e.pc_aliasName="",e.facObj={facName:null,facCode:null},e.facArray=[],e.faciData=[],e.plottingGridDefinition=function(t,a){for(var i=0;i<t.length;i++){var r={name:t[i].bedCode.toString(),displayName:t[i].bedName,field:t[i].bedCode.toString(),cellTemplate:e.bedTemp,enableCellEdit:!0,width:100,type:"number"};a.splice(6,0,r)}},e.removeColumnsFromGrid=function(t){for(var a=0;a<t.length;a++)a>5&&"Actions"!=t[a].displayName&&"validFrom"!=t[a].displayName&&"validTo"!=t[a].displayName&&(delete e.gridOptions_2.columnDefs[a],delete e.gridOptions.columnDefs[a])},e.addColumnsToGrid=function(t,a){for(var i=0;i<e.bedCode.length;i++)for(var r=0;r<a.length;r++)t[i]==a[r].bedCode&&(e.example14model.push(a[r]),e.materialBedModel.push(a[r]))},e.changePackageCategory=function(){if(e.createPackageType=$("#pkgCategory option:selected").text(),"IP"==e.createPackageType)e.clearArrayBlock(),e.clearPackageDaysFields(),e.showIpElements=!0,e.showBedClassError=!1,e.showMatBedError=!1,e.CFP_chk?(e.example14model=[],e.materialBedModel=[],e.addColumnsToGrid(e.bedCode,e.bedClassList)):(e.example14model=e.bedClassList,e.materialBedModel=e.bedClassList),e.serviceInclusionColumns=e.resetServiceInclusionGrid(),e.plottingGridDefinition(e.example14model,e.serviceInclusionColumns),e.gridOptions.columnDefs=e.serviceInclusionColumns,e.MaterialInclusionColumnDefsArray=e.resetMaterialInclusionGrid(),e.plottingGridDefinition(e.materialBedModel,e.MaterialInclusionColumnDefsArray),e.gridOptions_2.columnDefs=e.MaterialInclusionColumnDefsArray;else if("OP"==e.createPackageType){if(e.showIpElements=!1,e.clearArrayBlock(),null!=e.example14model&&e.example14model.length)for(var t=0;t<e.ip_bedClass_resp.length;t++)e.serviceInclusionColumns.splice(6,1);if(null!=e.materialBedModel&&e.materialBedModel.length)for(t=0;t<e.ip_bedClass_resp.length;t++)e.MaterialInclusionColumnDefsArray.splice(6,1);e.gridOptions.columnDefs=e.serviceInclusionColumns,e.gridOptions_2.columnDefs=e.MaterialInclusionColumnDefsArray}},e.loadServices=function(){var t={};t.url=s.HISCOMBOFILLING.URL,t.requestData={operation:"ExecuteQuery",destination:"QueryService",voclass:"com.napier.core.service.vo.query.QueryData",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"FACILITY_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"practiceId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}]}]}]}]}},l.sendRestRequest(t).then(function(t){e.faciRes=t,e.faciRes.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.faciData=e.faciRes.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.faciData.push(e.faciRes.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"])})},e.invokeDept=function(t){if(e.invokeServiceName(),e.inDeptResp=[],e.deptParm=t,t>0){var a={};a.url=s.HISCOMBOFILLING.URL,a.requestData={operation:"ExecuteQuery",destination:"QueryService",voclass:"com.napier.core.service.vo.query.QueryData",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"DEPARTMENT_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pFacId",value:e.deptParm}]}]}]}]}},l.sendRestRequest(a).then(function(t){e.dptResp=t.data,e.dptResp.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inDeptResp=e.dptResp.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inDeptResp.push(e.dptResp.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]),e.$emit("departments_loaded")})}},e.invokeSubDept=function(t){if(e.inSubDeptResp=[],e.subDeptParm=t,t>0){var a={};a.url=s.HISCOMBOFILLING.URL,a.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"SUBDEPARTMENT_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pDeptCode",value:e.subDeptParm}]}]}]}]}},l.sendRestRequest(a).then(function(t){e.subDeptRes=t.data,e.subDeptRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inSubDeptResp=e.subDeptRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inSubDeptResp.push(e.subDeptRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]),e.$emit("sub_departments_loaded")})}},e.invokePackageType=function(t){e.inPackageTypeResponses=[],e.packageTypeParm=t;var a={};a.url=s.HISCOMBOFILLING.URL,a.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"PATTYPE_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"practiceId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}]}]}]}]}},l.sendRestRequest(a).then(function(t){e.packageTypeRes=t.data,e.packageTypeRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inPackageTypeResponses=e.packageTypeRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inPackageTypeResponses.push(e.packageTypeRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"])})},e.invokePackageCat=function(t){e.changePackageCategory(),e.invokePackageName(t),e.packageTypeId=t,e.inPackageCatResponse=[];var a={};a.url=s.HISCOMBOFILLING.URL,a.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"PACKCAT_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"practiceId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}]}]}]}]}},l.sendRestRequest(a).then(function(t){e.packageCatRes=t.data,e.packageCatRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inPackageCatResponse=e.packageCatRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inPackageCatResponse.push(e.packageCatRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"])})},e.invokePackageName=function(t){e.autoCompleteArray=[],e.packageTypeCode=parseInt(t),e.inPackageNameResponse=[],e.packageNameArray=[];var a={};a.url=s.HISCOMBOFILLING.URL,a.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"PACKNAME_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pType",value:e.packageTypeCode}]}]}]}]}},l.sendRestRequest(a).then(function(t){e.packageNameRes=t.data,e.packageNameRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inPackageNameResponse=e.packageNameRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inPackageNameResponse.push(e.packageNameRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]);for(var a=0;a<e.inPackageNameResponse.length;a++)null!=e.inPackageNameResponse[a].columnList[0]["com.napier.core.service.vo.query.Column"][2]?e.autoCompleteArray.push(e.inPackageNameResponse[a].columnList[0]["com.napier.core.service.vo.query.Column"][2].data):e.autoCompleteArray.push(e.inPackageNameResponse[a].columnList[0]["com.napier.core.service.vo.query.Column"][1].data)})},e.invokeSubDept_Service_inclusion=function(t){if(e.inSubDept_srvcInclusion_Resp=[],e.srvcInclusion_subDeptParm=t,e.invokeServiceName(),t>0){var a={};a.url=s.HISCOMBOFILLING.URL,a.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"SUBDEPARTMENT_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pDeptCode",value:e.srvcInclusion_subDeptParm}]}]}]}]}},l.sendRestRequest(a).then(function(t){e.srvcInclusion_subDeptRes=t.data,e.srvcInclusion_subDeptRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inSubDept_srvcInclusion_Resp=e.srvcInclusion_subDeptRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inSubDept_srvcInclusion_Resp.push(e.srvcInclusion_subDeptRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]),e.$emit("srv_inc_sub_departments_loaded")})}},e.invokeServiceName=function(t){e.si_serviceNameParms=t,e.inServiceNameResp=[];var a={};a.url=s.HISCOMBOFILLING.URL,a.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"SERVNAME_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pDeptCode",value:e.srvcInclusion_subDeptParm},{paramName:"pSubDeptCode",value:e.si_serviceNameParms},{paramName:"pSubDeptCode",value:e.si_serviceNameParms}]}]}]}]}},l.sendRestRequest(a).then(function(t){e.serviceNameResponse=t.data,""!=e.serviceNameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]?(e.serviceNameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inServiceNameResp=e.serviceNameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inServiceNameResp.push(e.serviceNameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]),e.$emit("srv_inc_service_name_loaded"),e.servAdd=!1):e.servAdd=!0})},e.invokeLimitValue=function(t){e.limitValue=t},e.loadMaterialGroup=function(){var t={};t.url=s.HISCOMBOFILLING.URL,t.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"MATRLGRP_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"practiceId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}]}]}]}]}},l.sendRestRequest(t).then(function(t){e.materialGroupResponse=t.data,e.materialGroupResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inMaterialGroupResp=e.materialGroupResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inMaterialGroupResp.push(e.materialGroupResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"])})},e.invokeMaterialSubGroup=function(t){if(e.invokeMaterialName(t),e.matSubGroupParams=t,e.matSubGroupParams>0){e.inMaterialSubGroupResp=[];var a={};a.url=s.HISCOMBOFILLING.URL,a.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"MATRLSUBGRP_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pDeptCode",value:e.matSubGroupParams}]}]}]}]}}}l.sendRestRequest(a).then(function(t){e.materialSubGroupResponse=t.data,e.materialSubGroupResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inMaterialSubGroupResp=e.materialSubGroupResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inMaterialSubGroupResp.push(e.materialSubGroupResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"])})},e.invokeMaterialName=function(t){e.inMaterialNameResp=[];var a={};a.url=s.HISCOMBOFILLING.URL,a.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"MATRIALNAME_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pDepcode",value:t},{paramName:"pSubcode",value:e.matNameParm},{paramName:"pSubcode",value:e.matNameParm}]}]}]}]}},l.sendRestRequest(a).then(function(t){e.materialNameResponse=t.data,""!=e.materialNameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]?(e.materialNameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inMaterialNameResp=e.materialNameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inMaterialNameResp.push(e.materialNameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]),e.mtrlAdd=!1):e.mtrlAdd=!0})},e.invokeSubDept_Service_exclusion=function(t){if(e.invoke_serviceExclusion_service(),e.subDeptParm_ex=t,e.inSubDept_srvcExclusion_Resp=[],e.subDeptParm_ex>0){var a={};a.url=s.HISCOMBOFILLING.URL,a.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"SUBDEPARTMENT_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pDeptCode",value:e.subDeptParm_ex}]}]}]}]}},l.sendRestRequest(a).then(function(t){e.srvcExclusion_subDeptRes=t.data,e.srvcExclusion_subDeptRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inSubDept_srvcExclusion_Resp=e.srvcExclusion_subDeptRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inSubDept_srvcExclusion_Resp.push(e.srvcExclusion_subDeptRes.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"])})}},e.invoke_serviceExclusion_service=function(t){e.srvExclusion_serviceNameParms=t,e.inExclusion_ServiceNameResp=[];var a={};a.url=s.HISCOMBOFILLING.URL,a.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"SERVNAME_DROPDOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pDeptCode",value:e.subDeptParm_ex},{paramName:"pSubDeptCode",value:e.srvExclusion_serviceNameParms},{paramName:"pSubDeptCode",value:e.srvExclusion_serviceNameParms}]}]}]}]}},l.sendRestRequest(a).then(function(t){e.serviceExclusion_NameResponse=t.data,""!=e.serviceNameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]?(e.serviceExclusion_NameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.inExclusion_ServiceNameResp=e.serviceExclusion_NameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.inExclusion_ServiceNameResp.push(e.serviceExclusion_NameResponse.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]),e.$emit("srv_inc_service_name_loaded"),e.servAdd=!1):e.servAdd=!0})},e.invokeBedClass=function(){e.ip_bedClass_resp=[];var t={};t.url=s.HISCOMBOFILLING.URL,t.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"BED_CLASS",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"practiceId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}]}]}]}]}},l.sendRestRequest(t).then(function(t){e.ip_bedClass_response=t.data,e.ip_bedClass_response.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].constructor===Array?e.ip_bedClass_resp=e.ip_bedClass_response.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]:e.ip_bedClass_resp.push(e.ip_bedClass_response.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]),e.getBedClassArray(e.ip_bedClass_resp)})},e.fromDateOptions={minDate:new Date,startingDay:1},e.ToDateOptions={minDate:new Date,startingDay:1},e.servFromDateOptions={minDate:new Date},e.servToDateOptions={minDate:new Date},e.mtrlToDateOptions={minDate:new Date},e.format=angular.copy(u.uibDateOnly.format),e.months=[];!function(){var t;for(t=1;t<=99;t++)e.months.push(t)}(),e.weeks=[];!function(){var t;for(t=1;t<=52;t++)e.weeks.push(t)}(),e.days=[];!function(){var t;for(t=1;t<=31;t++)e.days.push(t)}(),e.addRow_ServiceInclusion_Array=[],e.sendSave_ServiceInclusion_Array=[],e.addValuesToDynamicColumns=function(t,a){for(var i=6;i<t.columnDefs.length&&"fromDate"!=t.columnDefs[i].field;i++)"NoLimit"==e.serviceLimitType?(a[t.columnDefs[i].field]="N/L",a.bedClassEnabling=!1):"Quantity"==e.serviceLimitType&&(a[t.columnDefs[i].field]=e.Quantity,a.bedClassEnabling=!1)},e.addRowPackage=function(a,i,r,l,s,o,c,d){if(void 0!==a&&""!==a&&void 0!==o&&""!==o&&void 0!==e.pc_dept&&""!==e.pc_dept&&void 0!==e.pc_sub_dept&&""!==e.pc_sub_dept&&void 0!==e.pc_pckgType&&""!==e.pc_pckgType&&void 0!==e.pc_pckgCtg&&""!==e.pc_pckgCtg&&void 0!==e.pc_pckgName&&""!==e.pc_pckgName&&void 0!==e.si_serviceLimit&&""!==e.si_serviceLimit)if("Amount"==e.si_serviceLimit&&null!=e.serviceAmount_Value&&""!==e.serviceAmount_Value||"Quantity"==e.si_serviceLimit&&null!=e.serviceAmount_QuantityValue&&""!==e.serviceAmount_QuantityValue||"NoLimit"==e.si_serviceLimit){if(e.si_dept=a,e.si_subDept=i,e.si_services=r,e.deptNameText=$("#serviceInclusion_dept option:selected").text(),e.onsubmit=!1,e.faci=!1,void 0!==e.si_subDept&&""!==e.si_subDept&&(e.subDeptNameText=$("#serviceInclusion_subDept option:selected").text(),"Select"!=e.subDeptNameText&&""!=e.subDeptNameText||(e.subDeptNameText="--")),null!=e.si_subDept&&""!=e.si_subDept||(e.subDeptNameText="--",e.si_subDept="0"),null!=e.si_services&&""!=e.si_services?(e.serviceNameText=$("#service option:selected").text(),"Select"!=e.serviceNameText&&""!=e.serviceNameText||(e.serviceNameText="--")):(e.serviceNameText="--",e.si_services="0"),void 0!==l?(e.serviceLimitType=l,"Amount"==e.serviceLimitType?e.Amount=s:e.Amount="0","NoLimit"==e.serviceLimitType?e.noLimit="N/L":e.noLimit="0","Quantity"==e.serviceLimitType?e.Quantity=d:e.Quantity="0"):(e.Amount="0",e.noLimit="0",e.Quantity="0"),e.service_validFrom=null!=o?t("date")(o,"yyyy-MM-dd"):"",null==c&&""==c&&" "==c||(e.service_validTo=t("date")(c,"yyyy-MM-dd"),e.service_validToGrd=t("date")(c,"yyyy-MM-dd")),null!=c&&""!=c&&" "!=c||(e.service_validTo="9999-12-31",e.service_validToGrd="--"),e.newobjPC={departmentName:e.deptNameText,departmentId:a,sub_department:e.subDeptNameText,sub_department_ID:e.si_subDept,servName:e.serviceNameText,serviceId:e.si_services,no_limit:e.noLimit,no_limit_id:l,amount:e.Amount,amount_ID:s,qty:e.Quantity,quantity_Id:d,fromDate:e.service_validFrom,fromDate_ID:o,toDate:e.service_validToGrd,toDate_ID:c,si_bedClassArray:e.example14model,bedClassEnabling:!0},1==e.showIpElements&&e.addValuesToDynamicColumns(e.gridOptions,e.newobjPC),e.si_saveBedClassArray=[],1==e.showIpElements)if(e.example14model.length>0){e.showBedClassError=!1;for(var p=0;p<e.example14model.length;p++)e.si_saveBedClassObj={bedClassSeqId:e.example14model[p].bedCode,limit:"0",inclusionType:1,amount:"0"},"Quantity"==e.serviceLimitType&&(e.si_saveBedClassObj.limit=e.Quantity),e.si_saveBedClassArray.push(e.si_saveBedClassObj)}else e.showBedClassError=!0;for(p=0;p<e.addRow_ServiceInclusion_Array.length;p++)if(e.dupBool=!1,e.si_services==e.addRow_ServiceInclusion_Array[p].serviceId&&e.si_dept==e.addRow_ServiceInclusion_Array[p].departmentId&&e.si_subDept==e.addRow_ServiceInclusion_Array[p].sub_department_ID){var u=e.myObj.dataAlrdyexist;return n.hisAlertMulti("warning",e.myObj.alertTypeWarn,u,e.alertData,e.alertFunction,e.close),void(e.dupBool=!0)}if("Amount"==e.si_serviceLimit&&0==parseInt(e.serviceAmount_Value))return void(e.srvcInc_isZero=!0);if("Quantity"==e.si_serviceLimit&&0==parseInt(e.serviceAmount_QuantityValue))return void(e.srvcInc_isZero=!0);if(e.srvcInc_isZero=!1,0==e.dupBool&&1==e.si_isValid&&0==e.srvcInc_isZero&&0==e.showBedClassError){e.newobjPC.service=e.serviceNameText,e.addRow_ServiceInclusion_Array.push(e.newobjPC),e.gridOptions.data=e.addRow_ServiceInclusion_Array,e.incTemp=[],e.incTemp.push(e.newobjPC);for(p=0;p<e.incTemp.length;p++)e.saveSrvInclusionObj={"@class":"com.napier.core.masters.vo.CompositeIncludeServiceVo",inclServSeqId:e.incTemp[p].serviceId,isPost:2,isPre:2,isPrint:2,servName:"--"==e.incTemp[p].servName?"":e.incTemp[p].servName,deptCode:e.incTemp[p].departmentId,subDeptSeqId:e.incTemp[p].sub_department_ID,amount:e.incTemp[p].amount,qty:e.incTemp[p].qty,fromDate:e.incTemp[p].fromDate+"T00:00:00.001Z",toDate:("--"==e.incTemp[p].toDate?"9999-12-31":e.incTemp[p].toDate)+"T00:00:00.001Z",bedClassWiseLimitsListVo:[{"com.napier.core.masters.vo.BedClassLimitVo":e.si_saveBedClassArray}]},e.sendSave_ServiceInclusion_Array.push(e.saveSrvInclusionObj);e.clearServiceInclusionFields(),1==e.showIpElements&&(e.isBedClassDisabled=!0)}}else{u=e.myObj.plzSlctMandFild;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,u,e.alertData,e.alertFunction,e.close)}else if(null==e.si_dept||""==e.si_dept||null==e.si_VDFrom||""==e.si_VDFrom||null!=e.pc_dept||""!=e.pc_dept||null!=e.pc_sub_dept||""!=e.pc_sub_dept||null!=e.pc_pckgType||""!=e.pc_pckgType||0!=e.addRow_ServiceInclusion_Array.length){e.onsubmit=!0,e.faci=!0;u=e.myObj.plzSlctMandFild;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,u,e.alertData,e.alertFunction,e.close)}else{u=e.myObj.plzSlctMandFild;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,u,e.alertData,e.alertFunction,e.close)}},e.converDate_service_fromDate=function(t){e.srvc_fromDate=t;new Date},e.resetService_Inclusion=function(){e.PC_form1.si_dept.$setPristine()},e.addValuesToMatDynamicColumns=function(t,a){for(var i=6;i<t.columnDefs.length&&"frDate"!=t.columnDefs[i].field;i++)"Nolimit"==e.mtLimitType?(a[t.columnDefs[i].field]="N/L",a.matBedClassEnabling=!1):"Quantity"==e.mtLimitType&&(a[t.columnDefs[i].field]=e.mtQuantity,a.matBedClassEnabling=!1)},e.addRow_MaterialInclusion_Array=[],e.sendSave_MaterialInclusion_Array=[],e.addRowMCI=function(a,i,r,l,s,o,c,d){if(void 0!==a&&""!==a&&void 0!==e.mtVdFrm&&""!==e.mtVdFrm&&void 0!==e.mtLimit&&""!==e.mtLimit)if("Amount"==e.mtLimit&&null!=e.mtLimit_Amount&&""!==e.mtLimit_Amount||"Quantity"==e.mtLimit&&null!=e.mtLimit_Qty&&""!==e.mtLimit_Qty||"Nolimit"==e.mtLimit){if(e.mtGrpNameText=$("#mtGrpId option:selected").text(),e.mtName=r,e.mtGrp=a,e.mtSubGrp=i,null!=e.mtSubGrp&&""!=e.mtSubGrp&&(e.mtSubGrpNameText=$("#mtSubGrpId option:selected").text(),"Select"==e.mtSubGrpNameText&&(e.mtSubGrpNameText="--")),null!=e.mtSubGrp&&""!=e.mtSubGrp||(e.mtSubGrpNameText="--",e.mtSubGrp="0"),null!=e.mtName&&""!=e.mtName&&(e.mtNameText=$("#mtNameId option:selected").text(),"Select"==e.mtNameText&&(e.mtNameText="--")),null!=e.mtName&&""!=e.mtName||(e.mtNameText="--",e.mtName="0"),null!=l?(e.mtLimitType=l,"Amount"==e.mtLimitType?e.mtAmount=s:e.mtAmount="0","Nolimit"==e.mtLimitType?e.mtNoLimit="N/L":e.mtNoLimit="0","Quantity"==e.mtLimitType?e.mtQuantity=o:e.mtQuantity="0"):(e.mtAmount="0",e.mtNoLimit="0",e.mtQuantity="0"),null!=e.mtVdFrm?e.mat_validFrom=t("date")(e.mtVdFrm,"yyyy-MM-dd"):e.mat_validFrom="0",null==d&&""==d&&" "==d||(e.mat_validTo=t("date")(d,"yyyy-MM-dd"),e.mat_validToGrd=t("date")(d,"yyyy-MM-dd")),null!=d&&""!=d&&" "!=d||(e.mat_validTo="9999-12-31",e.mat_validToGrd="--"),e.newobjMCI={materialGroup:e.mtGrpNameText,materialGroupID:e.mtGrp,materialSubGroup:e.mtSubGrpNameText,materialSubGroupID:e.mtSubGrp,materialName:e.mtNameText,materialNameId:e.mtName,mtrlNoLimit:e.mtNoLimit,amount:e.mtAmount,qty:e.mtQuantity,frDate:e.mat_validFrom,toDate:e.mat_validToGrd,mi_bedClassArray:e.materialBedModel,matBedClassEnabling:!0},1==e.showIpElements&&e.addValuesToMatDynamicColumns(e.gridOptions_2,e.newobjMCI),e.mi_saveBedClassArray=[],1==e.showIpElements)if(e.materialBedModel.length>0){e.showMatBedError=!1;for(var p=0;p<e.materialBedModel.length;p++)e.mi_saveBedClassObj={bedClassSeqId:e.materialBedModel[p].bedCode,materialSeqId:e.mtName,limit:"0",amount:"0",inclusionType:2},"Quantity"==e.mtLimitType&&(e.mi_saveBedClassObj.limit=e.mtQuantity),e.mi_saveBedClassArray.push(e.mi_saveBedClassObj)}else e.showMatBedError=!0;for(p=0;p<e.addRow_MaterialInclusion_Array.length;p++)if(e.dupFlag=!1,e.mtName==e.addRow_MaterialInclusion_Array[p].materialNameId&&e.mtGrp==e.addRow_MaterialInclusion_Array[p].materialGroupID&&e.mtSubGrp==e.addRow_MaterialInclusion_Array[p].materialSubGroupID){var u=e.myObj.dataAlrdyexist;return n.hisAlertMulti("warning",e.myObj.alertTypeWarn,u,e.alertData,e.alertFunction,e.close),void(e.dupFlag=!0)}if("Amount"==e.mtLimit&&0==parseInt(e.mtLimit_Amount))return void(e.matInc_isZero=!0);if("Quantity"==e.mtLimit&&0==parseInt(e.mtLimit_Qty))return void(e.matInc_isZero=!0);if(e.matInc_isZero=!1,!e.dupFlag&&1==e.mt_isValid&&0==e.matInc_isZero&&0==e.showMatBedError){e.clearMaterialInclusionFields(),e.gridOptions_2.data.push(e.newobjMCI),e.addRow_MaterialInclusion_Array=e.gridOptions_2.data,e.mtrlTemp=[],e.mtrlTemp.push(e.newobjMCI);for(p=0;p<e.mtrlTemp.length;p++)e.saveMat_Obj={"@class":"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo",isPost:2,isPre:2,mtrlCode:e.mtrlTemp[p].materialNameId,mtrlGrpSeqId:e.mtrlTemp[p].materialGroupID,mtrlGrpSubSeqId:e.mtrlTemp[p].materialSubGroupID,frDate:e.mtrlTemp[p].frDate+"T00:00:00.001Z",toDate:("--"==e.mtrlTemp[p].toDate?"9999-12-31":e.mtrlTemp[p].toDate)+"T00:00:00.001Z",amount:e.mtrlTemp[p].amount,qty:e.mtrlTemp[p].qty,mtrlPackBedClassLimitVoList:[{"com.napier.core.masters.vo.MtrlPackBedClassLimitVo":e.mi_saveBedClassArray}]},e.sendSave_MaterialInclusion_Array.push(e.saveMat_Obj);1==e.showIpElements&&(e.isMaterialBedClassDisabled=!0)}}else{u=e.myObj.plzSlctMandFild;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,u,e.alertData,e.alertFunction,e.close)}else if(null==a||""==a||null==e.mtVdFrm||""==e.mtVdFrm||null==e.mtLimit||""==e.mtLimit)if(0==e.addRow_ServiceInclusion_Array.length||null==e.subDeptParm||null==e.pc_pckgName||null==e.packageCat){u=e.myObj.plzSlctMandFild;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,u,e.alertData,e.alertFunction,e.close)}else{u=e.myObj.plzSlctMtrlgrpandfromdate;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,u,e.alertData,e.alertFunction,e.close)}},e.clearPackageDaysFields=function(){e.pkgDays=void 0,e.icu_days=void 0,e.regular_days=void 0,e.preProc_days=void 0,e.tot=void 0,e.PC_form1.pkgDays.$setUntouched(),e.PC_form1.icu_days.$setUntouched(),e.PC_form1.regular_days.$setUntouched(),e.PC_form1.preProc_days.$setUntouched(),e.PC_form1.tot.$setUntouched()},e.clearMaterialInclusionFields=function(){e.mtGrp=void 0,e.mtSubGrp=void 0,e.mtName=void 0,e.mtLimit=void 0,e.mtLimit_Amount=void 0,e.mtLimit_Qty=void 0,e.mtVdTo=void 0,e.PC_form2.mtGrp.$setUntouched(),e.PC_form2.mtSubGrp.$setUntouched(),e.PC_form2.mtName.$setUntouched(),e.PC_form2.mtLimit.$setUntouched(),e.PC_form2.mtVdTo.$setUntouched(),e.PC_form2.mtLimit_Amount.$setUntouched(),e.PC_form2.mtLimit_Qty.$setUntouched()},e.clearServiceInclusionFields=function(){e.si_dept=void 0,e.si_subDept=void 0,e.si_services=void 0,e.serviceAmount_Value=void 0,e.serviceAmount_QuantityValue=void 0,e.si_serviceLimit=void 0,e.si_VDTo=void 0,e.PC_form1.si_dept.$setUntouched(),e.PC_form1.si_subDept.$setUntouched(),e.PC_form1.service.$setUntouched(),e.PC_form1.si_serviceLimit.$setUntouched(),e.PC_form1.serviceAmount_Value.$setUntouched(),e.PC_form1.serviceAmount_QuantityValue.$setUntouched(),e.PC_form1.si_VDTo.$setUntouched()},e.clearPackageCreationGenFields=function(){e.pc_facility="",e.pc_dept="",e.pc_sub_dept="",e.pc_pckgType="",e.pc_pckgCtg="",e.pc_pckgName="",e.pc_aliasName="",e.pc_ME_M="",e.pc_ME_W="",e.pc_ME_D="",e.pc_vDTo="",e.packageName="",e.CFP_chk=!1,e.pc_pckgType=!1,e.PC_form1.pc_facility.$setUntouched(),e.PC_form1.pc_dept.$setUntouched(),e.PC_form1.pc_sub_dept.$setUntouched(),e.PC_form1.pc_pckgType.$setUntouched(),e.PC_form1.pc_pckgCtg.$setUntouched(),e.PC_form1.pc_pckgName.$setUntouched(),e.PC_form1.pc_aliasName.$setUntouched(),e.PC_form1.pc_ME_M.$setUntouched(),e.PC_form1.pc_ME_W.$setUntouched(),e.PC_form1.pc_ME_D.$setUntouched(),e.PC_form1.pc_vDTo.$setUntouched(),e.ME_chk=!1},e.deleteRowPC=function(t){e.srvIncDelIndex=e.gridOptions.data.indexOf(t.entity)},e.delSrvRec=function(t){e.gridOptions.data.splice(t,1),e.sendSave_ServiceInclusion_Array.splice(t,1);var a=e.myObj.delSucesFuly;n.hisAlertMulti("success",e.myObj.alertTypeSucss,a,e.alertData,e.alertFunction,e.close)},e.deleteRowMCI=function(t){e.matIncDelIndex=e.gridOptions_2.data.indexOf(t.entity)},e.delMatRec=function(t){e.gridOptions_2.data.splice(t,1),e.sendSave_MaterialInclusion_Array.splice(t,1);var a=e.myObj.delSucesFuly;n.hisAlertMulti("success",e.myObj.alertTypeSucss,a,e.alertData,e.alertFunction,e.close)},e.edit=!1,e.canEdit=function(){return e.edit},e.tmpl='<div ng-if="!row.entity.editable">{{COL_FIELD}}</div><div ng-if="row.entity.editable"><input type="text"  ng-model="MODEL_COL_FIELD" ></div>',e.tmpl1='<div ng-if="!row.entity.editable" style = "padding-left:25px;" >{{COL_FIELD}}</div><div ng-if="row.entity.editable" ><input type="text"  ng-model="MODEL_COL_FIELD" ></div>',e.bedTempServiseIncl='<div ng-if="row.entity.editable" check="{{row.entity}}" style = "padding-left:25px;" >{{COL_FIELD}}</div><div ng-if="!row.entity.editable" ><input type="text" check="{{row.entity}}"  numbers-only ng-model="MODEL_COL_FIELD" ></div>',e.bedTemp='<div ng-if="!row.entity.editable" check="{{row.entity}}" style = "padding-left:25px;" >{{COL_FIELD}}</div><div ng-if="row.entity.editable" ><input type="text" check="{{row.entity}}"  numbers-only ng-model="MODEL_COL_FIELD" >srinivas</div>',e.gridOptions={};e.gridOptions={data:e.addRow_ServiceInclusion_Array,rowHeight:30,enableRowSelection:!1,enableSelectAll:!0,enableFiltering:!1,isScrollingHorizontally:0,enableSorting:!1,enableColumnMenus:!1,cellEditableCondition:function(e){return e.row.entity.bedClassEnabling},onRegisterApi:function(t){e.gridServiceInclusion=t,e.gridServiceInclusion.edit.on.afterCellEdit(e,function(t,a,i,r){if(t.bedClassEnabling){e.selectedRec=e.addRow_ServiceInclusion_Array[e.gridOptions.data.indexOf(t)].si_bedClassArray,e.countLength=e.addRow_ServiceInclusion_Array[e.gridOptions.data.indexOf(t)].si_bedClassArray.length;for(var n=0;n<e.countLength;n++)a.displayName==e.selectedRec[n].bedName&&(e.selectedRecBedCode=e.selectedRec[n].bedCode);e.selectedSaveServiceInclusionRec=e.sendSave_ServiceInclusion_Array[e.gridOptions.data.indexOf(t)].bedClassWiseLimitsListVo[0]["com.napier.core.masters.vo.BedClassLimitVo"];for(var l=0;l<e.countLength;l++)e.selectedRecBedCode===e.selectedSaveServiceInclusionRec[l].bedClassSeqId&&"0"!=e.sendSave_ServiceInclusion_Array[e.gridOptions.data.indexOf(t)].amount&&(e.selectedSaveServiceInclusionRec[l].amount=i)}})},columnDefs:e.serviceInclusionColumns},e.gridEdit=!1,e.editIpGridRow=function(t,a){e.gridEdit=!0;for(var i=0;i<e.gridOptions.data.length;i++)e.gridOptions.data[i].editable=a==i},e.editAddGrid=function(t,a){e.gridEdit=!1,e.gridOptions.data[a].editable=!1};e.gridOptions_2={},e.gridOptions_2={rowHeight:30,data:e.addRow_MaterialInclusion_Array,enableRowSelection:!0,enableSelectAll:!1,enableFiltering:!1,enableSorting:!1,enableColumnMenus:!1,cellEditableCondition:function(e){return e.row.entity.matBedClassEnabling},onRegisterApi:function(t){e.gridMaterialInclusion=t,e.gridMaterialInclusion.edit.on.afterCellEdit(e,function(t,a,i,r){if(e.$apply(),t.matBedClassEnabling){e.selectedMatRec=e.addRow_MaterialInclusion_Array[e.gridOptions_2.data.indexOf(t)].mi_bedClassArray,e.countLengthMat=e.addRow_MaterialInclusion_Array[e.gridOptions_2.data.indexOf(t)].mi_bedClassArray.length;for(var n=0;n<e.countLengthMat;n++)a.displayName==e.selectedMatRec[n].bedName&&(e.selectedMatRecBedCode=e.selectedMatRec[n].bedCode);e.selectedSaveMaterialInclusionRec=e.sendSave_MaterialInclusion_Array[e.gridOptions_2.data.indexOf(t)].mtrlPackBedClassLimitVoList[0]["com.napier.core.masters.vo.MtrlPackBedClassLimitVo"];for(var l=0;l<e.countLengthMat;l++)e.selectedMatRecBedCode===e.selectedSaveMaterialInclusionRec[l].bedClassSeqId&&"0"!=e.sendSave_MaterialInclusion_Array[e.gridOptions_2.data.indexOf(t)].amount&&(e.selectedSaveMaterialInclusionRec[l].amount=i,e.selectedSaveMaterialInclusionRec[l].materialSeqId=e.sendSave_MaterialInclusion_Array[e.gridOptions_2.data.indexOf(t)].mtrlCode)}})},columnDefs:e.MaterialInclusionColumnDefsArray},e.gridEditMat=!1,e.editIpMatRow=function(t,a){e.gridEditMat=!0;for(var i=0;i<e.gridOptions_2.data.length;i++)e.gridOptions_2.data[i].editable=a==i},e.editAddMatGrid=function(t,a){e.gridEditMat=!1,e.gridOptions_2.data[a].editable=!1},e.totalEnct=0,e.multiEnctCheck=function(t){t||(e.pc_ME_M=void 0,e.pc_ME_W=void 0,e.pc_ME_D=void 0,e.totalEnct=0)},e.ipSrvEx_dupCheck=!1,e.ipSrvEx_vldCheck=!1,e.sampleIp_srvExc_Array=[],e.save_srvcEx_Array=[],e.addSrvcExRow=function(t,a,i){if(null!=t&&""!=t&&null!=a&&""!=a){null!=i&&""!=i||(i="0"),e.se_dept=t,e.se_subDept=a,e.se_service=i,e.srvEx_deptNameText=$("#serviceExclusion_dept option:selected").text(),e.srvEx_subDeptNameText=$("#serviceExclusion_subDept option:selected").text(),e.srvEx_serviceNameText=$("#ex_service_id option:selected").text(),"Select"!=e.srvEx_serviceNameText&&""!=e.srvEx_serviceNameText||(e.srvEx_serviceNameText="--"),e.sampleIp_srvExc_Obj={department:e.srvEx_deptNameText,department_ID:e.se_dept,sub_department:e.srvEx_subDeptNameText,sub_department_ID:e.se_subDept,service_IP_ex:e.srvEx_serviceNameText,service_IP_ex_ID:e.se_service};for(var r=0;r<e.sampleIp_srvExc_Array.length;r++)if(e.ipSrvEx_dupCheck=!1,e.se_service==e.sampleIp_srvExc_Array[r].service_IP_ex_ID&&e.se_dept==e.sampleIp_srvExc_Array[r].department_ID&&e.se_subDept==e.sampleIp_srvExc_Array[r].sub_department_ID){var l=e.myObj.dataAlrdyexist;return n.hisAlertMulti("warning",e.myObj.alertTypeWarn,l,e.alertData,e.alertFunction,e.close),void(e.ipSrvEx_dupCheck=!0)}for(var s=0,o=0;o<e.addRow_ServiceInclusion_Array.length;o++)if((angular.isNumber(e.se_dept)?e.se_dept:parseInt(e.se_dept))!=e.addRow_ServiceInclusion_Array[o].departmentId);else s=1;for(var c=0;c<e.addRow_ServiceInclusion_Array.length;c++){if(e.ipSrvEx_dupCheck=!1,e.se_dept==e.addRow_ServiceInclusion_Array[c].departmentId&&e.se_subDept==e.addRow_ServiceInclusion_Array[c].sub_department_ID&&0==e.se_service){l=e.myObj.plzSlctValidExl;return n.hisAlertMulti("warning",e.myObj.alertTypeWarn,l,e.alertData,e.alertFunction,e.close),void(e.ipSrvEx_dupCheck=!0)}if(e.se_service==e.addRow_ServiceInclusion_Array[c].serviceId&&e.se_dept==e.addRow_ServiceInclusion_Array[c].departmentId&&e.se_subDept==e.addRow_ServiceInclusion_Array[c].sub_department_ID){l=e.myObj.dataAldyIncd;return n.hisAlertMulti("warning",e.myObj.alertTypeWarn,l,e.alertData,e.alertFunction,e.close),void(e.ipSrvEx_dupCheck=!0)}}if(!e.ipSrvEx_dupCheck&&!e.ipSrvEx_vldCheck)if(1==s){e.gridOptions_IP_srvExc.data.push(e.sampleIp_srvExc_Obj),e.srvTemp=[],e.srvTemp.push(e.sampleIp_srvExc_Obj);for(r=0;r<e.srvTemp.length;r++)e.save_srvcEx_Obj={exclServSeqId:e.srvTemp[r].service_IP_ex_ID,deptCode:e.srvTemp[r].department_ID,subDeptSeqId:e.srvTemp[r].sub_department_ID},e.save_srvcEx_Array.push(e.save_srvcEx_Obj);e.clearAddSrvcExclusionFields()}else{l=e.myObj.plzSlctValidExl;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,l,e.alertData,e.alertFunction,e.close)}}else{l=e.myObj.plzSlctallFlds;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,l,e.alertData,e.alertFunction,e.close)}},e.gridOptions_IP_srvExc={data:e.sampleIp_srvExc_Array,enableCellEdit:!1,enableCellEditOnFocus:!0,rowHeight:30,enableRowSelection:!1,enableSelectAll:!0,enableFiltering:!1,enableSorting:!1,enableColumnMenus:!1,onRegisterApi:function(t){e.gridServiceExclusion=t},columnDefs:[{field:"department",displayName:"billing.department",headerCellFilter:"translate",width:"30%",height:"40%",pinnedLeft:!1,cellTemplate:e.tmpl1,enableCellEdit:!1,cellClass:"cellToolTip",enableSorting:!0},{field:"sub_department",displayName:"billing.subDepartment",headerCellFilter:"translate",width:"30%",enableCellEdit:!1,pinnedLeft:!1,cellTemplate:e.tmpl1,height:"40%",cellClass:"cellToolTip",enableSorting:!0},{field:"service_IP_ex",displayName:"billing.service",headerCellFilter:"translate",width:"30%",enableCellEdit:!1,cellTemplate:e.tmpl1,height:"40%",cellClass:"cellToolTip",enableSorting:!0},{field:"Action",displayName:"billing.actions",headerCellFilter:"translate",width:"20%",enableCellEdit:!1,cellClass:"cellToolTip",height:"40%",cellTemplate:'<div><span style="padding-left:10px"  data-toggle="modal" data-target="#ipServiceExclusion" class="glyphicon glyphicon-trash glyf" ng-click="grid.appScope.delSrvExclusion(row)"> </span></div>'},{field:"cesSeqId",displayName:"cesSeqId",enableCellEdit:!1,visible:!1},{field:"exclServSeqId",displayName:"exclServSeqId",enableCellEdit:!1,visible:!1},{field:"deptCode",displayName:"deptCode",enableCellEdit:!1,visible:!1},{field:"subDeptSeqId",displayName:"subDeptSeqId",enableCellEdit:!1,visible:!1}]},e.delSrvExclusion=function(t){e.srvExDelIndex=e.gridOptions_IP_srvExc.data.indexOf(t.entity)},e.service_exclusion_deleteRow=function(t){e.gridOptions_IP_srvExc.data.splice(e.srvExDelIndex,1),e.save_srvcEx_Array.splice(e.srvExDelIndex,1)},e.clearAddSrvcExclusionFields=function(){e.se_dept=void 0,e.se_subDept=void 0,e.se_service=void 0,e.PC_form1.se_dept.$setUntouched(),e.PC_form1.se_subDept.$setUntouched(),e.PC_form1.se_service.$setUntouched()},e.ipMatEx_dupCheck=!1,e.sampleIp_matExc_Array=[],e.save_matEx_Array=[],e.addMatExRow=function(t,a,i){if(null!=t&&""!=t&&null!=a&&""!=a){e.matEx_grpNameText=$("#mtGrpId_ex option:selected").text(),e.matEx_subGrpNameText=$("#mtExSubGrpId option:selected").text(),e.matEx_matNameText=$("#mtExNameId option:selected").text(),"Select"!=e.matEx_matNameText&&""!=e.matEx_matNameText||(e.matEx_matNameText="--"),e.mtGrp_ex=t,e.mtEx_SubGrp=a,e.mtExName=i,e.sampleIp_matExc_Obj={materialGroup:e.matEx_grpNameText,materialGroup_ID:e.mtGrp_ex,materialSubGroup:e.matEx_subGrpNameText,materialSubGroup_ID:e.mtEx_SubGrp,materialName:e.matEx_matNameText,materialName_ID:e.mtExName},null!=e.mtExName&&""!=e.mtExName||(e.mtExName=0);for(var r=0;r<e.sampleIp_matExc_Array.length;r++)if(e.ipMatEx_dupCheck=!1,e.mtExName==e.sampleIp_matExc_Array[r].materialName_ID&&e.mtGrp_ex==e.sampleIp_matExc_Array[r].materialGroup_ID&&e.mtEx_SubGrp==e.sampleIp_matExc_Array[r].materialSubGroup_ID){var l=e.myObj.dataAlrdyexist;return n.hisAlertMulti("warning",e.myObj.alertTypeWarn,l,e.alertData,e.alertFunction,e.close),void(e.ipMatEx_dupCheck=!0)}for(var s=0,o=0;o<e.addRow_MaterialInclusion_Array.length;o++)if((angular.isNumber(e.mtGrp_ex)?e.mtGrp_ex:parseInt(e.mtGrp_ex))!=e.addRow_MaterialInclusion_Array[o].materialGroupID);else s=1;for(var c=0;c<e.addRow_MaterialInclusion_Array.length;c++){if(0==e.mtExName&&e.mtGrp_ex==e.addRow_MaterialInclusion_Array[c].materialGroupID&&e.mtEx_SubGrp==e.addRow_MaterialInclusion_Array[c].materialSubGroupID){l=e.myObj.plzSlctValidExl;return n.hisAlertMulti("warning",e.myObj.alertTypeWarn,l,e.alertData,e.alertFunction,e.close),void(e.ipMatEx_dupCheck=!0)}if(e.ipMatEx_dupCheck=!1,e.mtExName==e.addRow_MaterialInclusion_Array[c].materialNameID&&e.mtGrp_ex==e.addRow_MaterialInclusion_Array[c].materialGroupID&&e.mtEx_SubGrp==e.addRow_MaterialInclusion_Array[c].materialSubGroupID){l=e.myObj.dataAldyIncd;return n.hisAlertMulti("warning",e.myObj.alertTypeWarn,l,e.alertData,e.alertFunction,e.close),void(e.ipMatEx_dupCheck=!0)}}if(!e.ipMatEx_dupCheck)if(1==s){e.gridOptions_IP_mat_ex.data.push(e.sampleIp_matExc_Obj),e.matexcTemp=[],e.matexcTemp.push(e.sampleIp_matExc_Obj);for(r=0;r<e.matexcTemp.length;r++)e.save_matEx_Obj={mtrlCode:e.matexcTemp[r].materialName_ID,mtrlMainCode:e.matexcTemp[r].materialGroup_ID,mtrlSubCode:e.matexcTemp[r].materialSubGroup_ID},e.save_matEx_Array.push(e.save_matEx_Obj);e.clearAddMatExclusionFields()}else{l=e.myObj.plzSlctValidExl;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,l,e.alertData,e.alertFunction,e.close)}}else{l=e.myObj.plzSlctallFlds;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,l,e.alertData,e.alertFunction,e.close)}},e.gridOptions_IP_mat_ex={data:e.sampleIp_matExc_Array,enableCellEdit:!1,enableCellEditOnFocus:!0,rowHeight:30,enableRowSelection:!1,enableSelectAll:!0,enableFiltering:!1,enableSorting:!1,enableColumnMenus:!1,onRegisterApi:function(t){e.gridMaterialExclusion=t},columnDefs:[{field:"materialGroup",displayName:"billing.material.group",headerCellFilter:"translate",width:"30%",height:"40%",pinnedLeft:!1,cellTemplate:e.tmpl1,enableCellEdit:!1,cellClass:"cellToolTip",enableSorting:!0},{field:"materialSubGroup",displayName:"billing.material.subgroup",headerCellFilter:"translate",width:"30%",enableCellEdit:!1,pinnedLeft:!1,cellTemplate:e.tmpl1,height:"40%",cellClass:"cellToolTip",enableSorting:!0},{field:"materialName",displayName:"billing.materialName",headerCellFilter:"translate",width:"30%",enableCellEdit:!1,cellTemplate:e.tmpl1,height:"40%",cellClass:"cellToolTip",enableSorting:!0},{field:"Action",displayName:"billing.actions",headerCellFilter:"translate",width:"20%",enableCellEdit:!1,cellClass:"cellToolTip",height:"40%",cellTemplate:'<div><span style="padding-left:10px"  data-toggle="modal" data-target="#ipMaterialExclusion" class="glyphicon glyphicon-trash glyf" ng-click="grid.appScope.delMatExclusion(row)"> </span></div>'},{field:"cemSeqId",displayName:"cemSeqId",enableCellEdit:!1,visible:!1},{field:"mtrlCode",displayName:"mtrlCode",enableCellEdit:!1,visible:!1},{field:"mtrlMainCode",displayName:"mtrlMainCode",enableCellEdit:!1,visible:!1},{field:"mtrlSubCode",displayName:"mtrlSubCode",enableCellEdit:!1,visible:!1}]},e.delMatExclusion=function(t){e.matExDelIndex=e.gridOptions_IP_mat_ex.data.indexOf(t.entity)},e.material_exclusion_deleteRow=function(){e.gridOptions_IP_mat_ex.data.splice(e.matExDelIndex,1),e.save_matEx_Array.splice(e.matExDelIndex,1)},e.clearAddMatExclusionFields=function(){e.mtGrp_ex=void 0,e.mtEx_SubGrp=void 0,e.mtExName=void 0,e.PC_form2.mtGrp_ex.$setUntouched(),e.PC_form2.mtEx_SubGrp.$setUntouched(),e.PC_form2.mtExName.$setUntouched()},e.clearArrayBlock=function(){e.gridOptions_IP_srvExc.data=[],e.gridOptions_IP_mat_ex.data=[],e.gridOptions_2.data=[],e.gridOptions.data=[],e.sendSave_MaterialInclusion_Array.length=0,e.addRow_MaterialInclusion_Array.length=0,e.addRow_ServiceInclusion_Array.length=0,e.sendSave_ServiceInclusion_Array.length=0,e.sampleIp_srvExc_Array.length=0,e.sampleIp_matExc_Array.length=0,e.save_matEx_Array.length=0,e.save_srvcEx_Array.length=0},e.checkBedClassValues=function(){for(var t=0;t<e.sendSave_ServiceInclusion_Array.length;t++){if(e.isBedClassValuesFilled=!1,"0"!=e.sendSave_ServiceInclusion_Array[t].amount&&"0"==e.sendSave_ServiceInclusion_Array[t].qty){var a=e.sendSave_ServiceInclusion_Array[t].bedClassWiseLimitsListVo[0]["com.napier.core.masters.vo.BedClassLimitVo"];if(null!=a){for(var i=0;i<a.length;i++)if("0"==a[i].amount)return void(e.isBedClassValuesFilled=!0)}else e.isBedClassValuesFilled=!1}if("0"!=e.sendSave_ServiceInclusion_Array[t].qty&&"0"==e.sendSave_ServiceInclusion_Array[t].amount)for(var r=e.sendSave_ServiceInclusion_Array[t].bedClassWiseLimitsListVo[0]["com.napier.core.masters.vo.BedClassLimitVo"],n=0;n<r.length;n++)if("0"==r[n].limit)return void(e.isBedClassValuesFilled=!0)}if(e.sendSave_MaterialInclusion_Array.length)for(var l=0;l<e.sendSave_MaterialInclusion_Array.length;l++){if(e.isBedClassValuesFilled=!1,"0"!=e.sendSave_MaterialInclusion_Array[l].amount&&"0"==e.sendSave_MaterialInclusion_Array[l].qty){var s=e.sendSave_MaterialInclusion_Array[l].mtrlPackBedClassLimitVoList[0]["com.napier.core.masters.vo.MtrlPackBedClassLimitVo"];if(null!=s){for(var o=0;o<s.length;o++)if("0"==s[o].amount)return void(e.isBedClassValuesFilled=!0)}else e.isBedClassValuesFilled=!1}if("0"==e.sendSave_MaterialInclusion_Array[l].amount&&"0"!=e.sendSave_MaterialInclusion_Array[l].qty)for(var c=e.sendSave_MaterialInclusion_Array[l].mtrlPackBedClassLimitVoList[0]["com.napier.core.masters.vo.MtrlPackBedClassLimitVo"],d=0;d<c.length;d++)if("0"==c[d].limit)return void(e.isBedClassValuesFilled=!0)}},e.save=function(){1==e.pc_pckgType&&(e.checkBedClassValues(),e.tot&&e.pkgDays?e.isTotalDaysValid:e.isTotalDaysValid=!1);var a={};if("HSC"===sessionStorage.productCustomization&&e.prepareCheckListModel(),null!=e.deptParm&&null!=e.subDeptParm&&null!=e.pc_pckgName&&null!=e.pc_pckgCtg&&1==e.pc_isValid)if(0==e.isBedClassValuesFilled)if(e.addRow_ServiceInclusion_Array.length>0)null!=e.pc_vDTo&&""!=e.pc_vDTo&&" "!=e.pc_vDTo||(e.pc_vDTo="9999-12-31"),e.onsubmit=!1,e.faci=!1,null==e.pc_ME_M&&(e.pc_ME_M=0),null==e.pc_ME_W&&(e.pc_ME_W=0),null==e.pc_ME_D&&(e.pc_ME_D=0),e.totalEnct=30*e.pc_ME_M+7*e.pc_ME_W+1*e.pc_ME_D,a.url="HISServices/PackageMasterService",a.requestData={operation:"saveService",destination:"com.napier.core.masters.service.external.PackageMasterService",message:{"@class":"com.napier.core.masters.vo.ServiceVo",gnServDesign:"1",gnServStatus:"1",gnTranStatus:"1",notEdit:"1",practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilitySeqId:e.deptParm,defDeptCode:e.subDeptParm,subDeptSeqId:e.packageTypeParm,packageType:e.packageTypeId,packgSeqId:e.pc_pckgCtg,packageCheckListVo:[{"com.napier.core.masters.vo.PackageCheckListVo":e.packageCheckListGridVoModel}],servName:e.pc_pckgName,gender:e.selectedGender,encntrDays:e.totalEnct,servAltName:e.pc_aliasName,servFromDate:t("date")(e.pc_vDFrom,"yyyy-MM-dd")+"T00:00:00.001Z",servToDate:t("date")(e.pc_vDTo,"yyyy-MM-dd")+"T00:00:00.001Z",compositeIncludeServiceVoList:[{"com.napier.core.masters.vo.CompositeIncludeServiceVo":e.sendSave_ServiceInclusion_Array}],compositeServiceIncludeMaterialVoList:[{"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo":e.sendSave_MaterialInclusion_Array}],compositeExculdeServiceVoList:[{"com.napier.core.masters.vo.CompositeExculdeServiceVo":e.save_srvcEx_Array}],compositeServiceExcludeMaterialVoList:[{"com.napier.core.masters.vo.CompositeServiceExcludeMaterialVo":e.save_matEx_Array}],compositeServiceLimitVoList:[{"com.napier.core.masters.vo.CompositeServiceLimitVo":[{icuDays:e.icu_days,preProcDays:e.preProc_days,regularDays:e.regular_days,totalDays:e.pkgDays}]}]}},l.sendRestRequest(a).then(function(t){if(null!=t.data.HITService.message){if("saveService"==t.data.HITService.operation){var a=e.myObj.savdSucesFuly;n.hisAlertMulti("success",e.myObj.alertTypeSucss,a,e.alertData,e.alertFunction,e.close),e.clearPackageCreationGenFields(),e.clearArrayBlock(),e.clearPackageDaysFields(),e.clearCheckListGrid()}if(2045==t.data.HITService.message.errorCode){a=t.data.HITService.message.errorMessage;n.hisAlertMulti("information",e.myObj.alertTypeInfo,a,e.alertData,e.alertFunction,e.close),"9999-12-31"==e.pc_vDTo&&(e.pc_vDTo="",e.PC_form1.pc_vDTo.$setUntouched())}else if(null!=t.data.HITService.message.errorMessage){a=e.myObj.saveFail;n.hisAlertMulti("failure",e.myObj.alertTypeInfo,a,e.alertData,e.alertFunction,e.close)}}else{a=e.myObj.saveFail;n.hisAlertMulti("failure",e.myObj.alertTypeInfo,a,e.alertData,e.alertFunction,e.close)}},function(t){var a=e.myObj.plzTryAgin;n.hisAlertMulti("failure",e.myObj.alertTypeFail,a,e.alertData,e.alertFunction,e.close)});else{var i=e.myObj.plnInclServ;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,i,e.alertData,e.alertFunction,e.close)}else{i=e.myObj.plzFillBedCls;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,i,e.alertData,e.alertFunction,e.close)}else{e.onsubmit=!0,e.faci=!0;i=e.myObj.plzFilMandFild;n.hisAlertMulti("warning",e.myObj.alertTypeWarn,i,e.alertData,e.alertFunction,e.close)}},e.deleteRecord=function(e,t,a){a.pkgCheckListItemDesc="",a.waitingArea=""},e.addExtraRow=function(t){try{e.packageCheckListGrid.data[e.packageCheckListGrid.data.length-1].hideShowRow=!1,e.packageCheckListGrid.data.push({checkListItemPriority:e.packageCheckListGrid.data.length+1,hideShowRow:!0})}catch(e){}},e.prepareCheckListModel=function(){var t=e.packageCheckListGrid.data,a=1;e.packageCheckListGridVoModel=[];for(var i=0;i<t.length;i++)""!==t[i].pkgCheckListItemDesc&&void 0!==t[i].pkgCheckListItemDesc&&(e.packageCheckListGridVo={checkListItemPriority:a,pkgCheckListItemDesc:t[i].pkgCheckListItemDesc,waitingArea:t[i].waitingArea},e.packageCheckListGridVoModel.push(e.packageCheckListGridVo),a++)},e.clearCheckListGrid=function(){e.packageCheckListGrid.data=[];for(var t=1;t<=10;t++)e.packageCheckListGrid.data.push({checkListItemPriority:t})}}e.$inject=["$scope","$filter","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","CallManager","BILLING_APIS","QueryService","assignmentQueryService","packageCheckListGridColumnsData","RoleTaskService","hisCalDefConstant"],angular.module("napierContainerUi").controller("opPackageController",e),angular.module("napierContainerUi").service("assignmentQueryService",["BILLING_APIS","CallManager",function(e,t){this.queryServiceMethod=function(a,i){var r={};return r.url=e.HISCOMBOFILLING.URL,r.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:a,idxList:[{"com.napier.core.service.vo.query.Index":i}]}]}]}},t.sendRestRequest(r)}}]),angular.module("napierContainerUi").directive("autoComplete",["$timeout",function(e){return function(t,a,i){a.autocomplete({source:t[i.uiItems],select:function(){e(function(){a.trigger("input")},0)}})}}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m){new Date;var g=this;a.assignment={},a.servicepostingDtlsList=[],a.showUpdateButton=!1,a.addPack=!1,a.saveBtn=!0,a.isDaysEnabled=!1,a.isBedDaysInvalid=!1,a.isDateValid=!1,delete m.ngModelOptions.timezone,a.assignment.CD=angular.copy(c),a.assignment.CD.uibDateOnly1={},$(".overlay").hide(),a.assignment.frmDate=new Date,a.getDurationDays=function(){var e=a.assignment.pckgName.SERV_FROM_DATE,t=a.assignment.pckgName.SERV_TO_DATE;if(e&&t){e=e.split("-"),t=t.split("-");var i=e[0]+"-"+e[1]+"-"+e[2].substr(0,2),r=t[0]+"-"+t[1]+"-"+t[2].substr(0,2),n=new Date(i),l=new Date(r);Math.abs(l.getTime()-n.getTime());a.assignment.diffDays=parseInt((l-n)/864e5),a.getPackageDays(a.assignment.pckgName.SERV_SEQ_ID)}},a.dateValidation=function(e){if(null!=a.totDays&&null!=a.totDays&&""!==a.totDays&&a.totDays>0){var t=new Date(e);t.setDate(t.getDate()+(a.totDays-1)),a.assignment.toDate=new Date(t)}},a.enablePkgName=!1,a.editDays=function(){a.isDaysEnabled=!0,a.showUpdateButton=!0,a.saveBtn=!0},o.loadModule("billing"),o.changeLanguage("en"),a.updateDays=function(e,t,i,r){e||(e=0,a.icuDays=0),t||(t=0,a.regDays=0),i||(i=0,a.preProcedure=0),a.icuDays=e,a.regDays=t,a.preProcedure=i,a.totDays=r,parseInt(e)+parseInt(t)+parseInt(i)==parseInt(r)?(a.isDaysEnabled=!1,a.showUpdateButton=!1,a.isBedDaysInvalid=!1,a.saveBtn=!1):(a.isDaysEnabled=!0,a.showUpdateButton=!0,a.isBedDaysInvalid=!0)},a.roleTask=d.rolePermission("T_BL_PACKAGE_ASSIGNMENT"),a.gridOptionsPckg={rowHeight:30,enableHorizontalScrollbar:0,enableCellEditOnFocus:!0,enableSelectAll:!0,enableColumnMenu:!1,enableFiltering:!1,enableSorting:!1,onRegisterApi:function(e){a.grid=e},columnDefs:[{field:"serialNumber",displayName:"S.No."},{field:"packageCode",displayName:"Package Code"},{field:"packageName",displayName:" Package Name"},{field:"validFrom",displayName:" Valid From"},{field:"validTo",displayName:"Valid To"},{field:"remarks",displayName:"Remarks"}]},a.gridOptions={rowHeight:30,enableHorizontalScrollbar:0,enableColumnMenu:!1,enableFiltering:!1,enableSorting:!1,enableVerticalScrollbar:!0,onRegisterApi:function(e){a.grid=e},columnDefs:[{field:"serialNumber",displayName:"S.No."},{field:"department",displayName:"Department"},{field:"subDepartment",displayName:"Sub-Department"},{field:"service",displayName:"Service"},{field:"noLimit",displayName:" No Limit"},{field:"amount",displayName:"Amount"},{field:"qunatity",displayName:" Qunatity"},{field:"validFrom",displayName:" Valid From"},{field:"validTo",displayName:"Valid To"}]},a.gridOptionsSrvcExclu={rowHeight:30,enableHorizontalScrollbar:0,enableColumnMenu:!1,enableFiltering:!1,enableSorting:!1,onRegisterApi:function(e){a.grid=e},columnDefs:[{field:"serialNumber",displayName:"S.No."},{field:"department",displayName:"Department"},{field:"subDepartment",displayName:"Sub-Department"},{field:"service",displayName:"Service"}]},a.gridOptionsMtrlInclu={rowHeight:30,enableHorizontalScrollbar:0,enableColumnMenu:!1,enableFiltering:!1,enableSorting:!1,enableVerticalScrollbar:!0,onRegisterApi:function(e){a.grid=e},columnDefs:[{field:"serialNumber",displayName:"S.No."},{field:"materialGroup",displayName:"Material Group"},{field:"materialSubGroup",displayName:"Material Sub-Group"},{field:"materialName",displayName:"Material Name"},{field:"noLimit",displayName:" No Limit"},{field:"amount",displayName:"Amount"},{field:"qunatity",displayName:" Qunatity"},{field:"validFrom",displayName:" Valid From"},{field:"validTo",displayName:"Valid To"}]},a.gridOptionsMtrlEXclu={rowHeight:30,enableHorizontalScrollbar:0,enableColumnMenu:!1,enableFiltering:!1,enableSorting:!1,onRegisterApi:function(e){a.grid=e},columnDefs:[{field:"serialNumber",displayName:"S.No."},{field:"department",displayName:"Department"},{field:"subDepartment",displayName:"Sub-Department"},{field:"service",displayName:"Service"}]},a.patientBannerArray=[],a.patientBannerArray1=[],a.searchPatientService=function(e){e="%"+e+"%",a.patientBannerArray=[],a.multipleComboDataForList={1:a.patientBannerArray};var t=s.executeQueryURLReset();return a.srchPatientArray=new Array,s.prepareParamList(1,e,a.srchPatientArray),s.prepareParamList(2,e,a.srchPatientArray),s.prepareParamList(3,e,a.srchPatientArray),s.prepareParamList(4,e,a.srchPatientArray),s.prepareParamList(5,e,a.srchPatientArray),s.prepareParamList(6,e,a.srchPatientArray),s.executeQueryInput("SEARCH_PAT",a.srchPatientArray,a.multipleComboDataForList,!0,!0,t,"popUp",!0).then(function(e){return a.patientBannerArray=e[1],a.patientBannerArray1=a.patientBannerArray,a.patientBannerArray1=Array.isArray(a.patientBannerArray1)?a.patientBannerArray1:[a.patientBannerArray1],a.patientBannerArray1.map(function(e){return e})})},a.setPatientToBanner=function(){if(a.assignment.srchPatientName.RG_SEQ_ID){a.ipAdSqId=a.assignment.srchPatientName.IPADM_SEQ_ID;var e="1",t={regSeqId:a.assignment.srchPatientName.RG_SEQ_ID,admissionSeqid:a.assignment.srchPatientName.IPADM_SEQ_ID};a.regSqId=t.regSeqId;var n=t;e=null!=n.admissionSeqid?"1":"2";var l=[];g.clearanceStatus=void 0;var o={1:l},c=s.executeQueryURLReset(),d=[];s.prepareParamListWithParam("pAdmnSeqId",t.admissionSeqid,d),s.executeQueryInput("IS_CLEARANCE_GIVEN_STATUS_FOR_BILLING",d,o,!0,!0,c,"popUp",{}).then(function(s){if(null!=l[0]&&(g.clearanceStatus=l[0].IS_CLEARANCE_GIVEN),"Y"==g.clearanceStatus)return i.warning("Warning","Package Assignment Not Allowed After Billing Clearance."),!1;r.getPatientBanner(n,e).then(function(e){a.patientGlobalDtls=e,a.patientGlobalDtls.patientName&&(a.enablePkgName=!0),a.patientGlobalDtls.userPermision=123,a.tarrifSeqId=a.patientGlobalDtls.tariffSeqId,a.bedClassSeqId=a.patientGlobalDtls.bedClassCode,a.admissionSeqid=a.assignment.srchPatientName.IPADM_SEQ_ID,null!=a.patientGlobalDtls.admissionDate&&(a.assignment.CD.uibDateOnly.minDate=new Date(a.patientGlobalDtls.admissionDate))}),p.patientBannerDetail(t.regSeqId).then(function(e){a.patientBannerDetails=e,a.patientRecordsDetail=a.patientBannerDetails.patientRecordsDetail}),u.getDocFile(t.regSeqId,a)})}else i.warning("Warning","Please select the patient.")},a.packName=[],a.multipleComboDataForListName={1:a.packName};var S=s.executeQueryURLReset();a.packageNameArray=new Array,s.prepareParamList(1,1,a.packageNameArray),s.executeQueryInput("PACKNAME_DROPDOWN",a.packageNameArray,a.multipleComboDataForListName,!0,!0,S,"popUp",a.gridOptionsPckg),a.gridOptionsPckg.data=[];a.addPackageRecord=function(e,r){if(null!=a.gridOptionsPckg.data)for(var n=0;n<a.gridOptionsPckg.data.length;n++)if(a.gridOptionsPckg.data[n].packageName==a.assignment.pckgName.SERV_NAME)return i.warning("Warning","Package "+a.assignment.pckgName.SERV_NAME+" Already Added"),!1;if(a.assignment.srchPatientName&&a.assignment.pckgName&&a.assignment.toDate&&a.assignment.frmDate){var l=e,o=r;l=t("date")(new Date(l),"yyyy-MM-dd"),o=t("date")(new Date(o),"yyyy-MM-dd"),a.preparePkgObj={serialNumber:1,packageCode:a.assignment.pckgName.SERV_CODE,packageName:a.assignment.pckgName.SERV_NAME,validFrom:l,validTo:o,remarks:"Patient Remarks"},a.bedClassDaysInfo=[],a.packageDetailsInfo=[],a.packageInclusionServiceInfo=[],a.packageExclusionServiceInfo=[],a.packageInclusionMaterialInfo=[],a.packageExclusionMaterialInfo=[],a.multipleGridDataForPackageSearch={1:a.packageDetailsInfo,2:a.packageInclusionServiceInfo,3:a.packageExclusionServiceInfo,4:a.packageInclusionMaterialInfo,5:a.packageExclusionMaterialInfo};var c=s.executeQueryURLReset();a.packNameSeqId=[{paramName:"pServSeqId",value:a.assignment.pckgName.SERV_SEQ_ID}],a.packDtls=[{paramName:"pServSeqId",value:a.assignment.pckgName.SERV_SEQ_ID},{paramName:"patientIpSeqId",value:a.admissionSeqid}],s.executeQueryInput("PACK_DETAILS",a.packDtls,a.multipleGridDataForPackageSearch,!0,!1,c,"popUp",{}),s.executeQueryInput("PACK_INCL_SERV",a.packNameSeqId,a.multipleGridDataForPackageSearch,!0,!1,c,"popUp",{}),s.executeQueryInput("PACK_EXCL_SERV",a.packNameSeqId,a.multipleGridDataForPackageSearch,!0,!1,c,"popUp",{}),s.executeQueryInput("PACK_INCL_MTRL",a.packNameSeqId,a.multipleGridDataForPackageSearch,!0,!1,c,"popUp",{}),s.executeQueryInput("PACK_EXCL_MTRL",a.packNameSeqId,a.multipleGridDataForPackageSearch,!0,!0,c,"popUp",{}).then(function(e){"Both"==a.packageDetailsInfo[0].GENDER||"Other"==a.packageDetailsInfo[0].GENDER||"Unknown"==a.packageDetailsInfo[0].GENDER||"Ambiguous"==a.packageDetailsInfo[0].GENDER||a.packageDetailsInfo[0].GENDER==a.patientGlobalDtls.gender?(a.prepareServInclusionGridData(a.packageInclusionServiceInfo),a.prepareServExclusionGridData(a.packageExclusionServiceInfo),a.prepareMatInclusionGridData(a.packageInclusionMaterialInfo),a.prepareMatExclusionGridData(a.packageExclusionMaterialInfo),a.preparePkgObj.DISCOUNT_PERCENT=a.packageDetailsInfo[0].DISCOUNT_PERCENT,a.gridOptionsPckg.data.push(a.preparePkgObj),a.saveBtn=!1,a.getPackageDays(a.assignment.pckgName.SERV_SEQ_ID),a.accountDetailsOfPatient(),a.addPack=!0):i.warning("warning","This package applicable for "+a.packageDetailsInfo[0].GENDER+" patient(s) only.")})}else i.warning("warning","please select mandatory fields")},a.getPackageDays=function(e){a.bedDaysSendArray=[{paramName:"pServSeqId",value:e}],l.queryServiceMethod("BED_CLASSDAYS",a.bedDaysSendArray).then(function(e){e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]instanceof Array?a.bedDaysResArray=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"][0].columnList[0]["com.napier.core.service.vo.query.Column"]:a.bedDaysResArray=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].columnList[0]["com.napier.core.service.vo.query.Column"],a.icuDays=a.bedDaysResArray[0].data,a.regDays=a.bedDaysResArray[1].data,a.preProcedure=a.bedDaysResArray[2].data,a.totDays=a.bedDaysResArray[3].data;let t=null!=a.assignment.frmDate&&null!=a.assignment.frmDate&&""!==a.assignment.frmDate?new Date(a.assignment.frmDate):new Date;a.dateValidation(t)},function(e){})},a.prepareServInclusionGridData=function(e){for(var t=0;t<e.length;t++){if(0==e[t].QTY&&0==e[t].INCL_AMOUNT)var i="N/L";else i=0;var r=e[t].FROM_DATE.split("-"),n=e[t].TO_DATE.split("-");a.srvIncObj={serialNumber:t+1,department:e[t].DepartmentName,subDepartment:e[t].SubDepartmentCode,service:e[t].SERV_NAME,noLimit:i,amount:e[t].INCL_AMOUNT,qunatity:e[t].QTY,validFrom:r[0]+"-"+r[1]+"-"+r[2].substring(0,2),validTo:n[0]+"-"+n[1]+"-"+n[2].substring(0,2)},a.gridOptions.data.push(a.srvIncObj)}},a.prepareMatInclusionGridData=function(e){for(var t=0;t<e.length;t++){if(0==e[t].QTY&&0==e[t].MTR_AMOUNT)var i="N/L";else i=0;var r=e[t].FROM_DATE.split("-"),n=e[t].TO_DATE.split("-");a.matIncObj={serialNumber:t+1,materialGroup:e[t].MaterialMainGroupName,materialSubGroup:e[t].MaterialSubGroupName,materialName:e[t].MaterialName,noLimit:i,amount:e[t].MTR_AMOUNT,qunatity:e[t].QTY,validFrom:r[0]+"-"+r[1]+"-"+r[2].substring(0,2),validTo:n[0]+"-"+n[1]+"-"+n[2].substring(0,2)},a.gridOptionsMtrlInclu.data.push(a.matIncObj)}},a.prepareServExclusionGridData=function(e){for(var t=0;t<e.length;t++)a.servExGridObj={serialNumber:t+1,department:e[t].DepartmentName,subDepartment:e[t].SubDepartmentCode,service:e[t].SERV_NAME},a.gridOptionsSrvcExclu.data.push(a.servExGridObj)},a.prepareMatExclusionGridData=function(e){for(var t=0;t<e.length;t++)a.servExGridObj={serialNumber:t+1,department:e[t].MaterialMainGroupName,subDepartment:e[t].MaterialSubGroupName,service:e[t].MaterialName},a.gridOptionsMtrlEXclu.data.push(a.servExGridObj)},a.accountDetailsOfPatient=function(){var e=new Date;a.getDay=e.getDate(),1==a.getDay.toString().length&&(a.getDay="0"+a.getDay),a.getMonth=e.getMonth()+1,a.getYear=e.getFullYear(),a.currentDateModel=a.getYear+"-0"+a.getMonth+"-"+a.getDay,a.accSendArray=[{paramName:"pAdmSeqID",value:a.ipAdSqId},{paramName:"pCurrDate",value:a.currentDateModel}],l.queryServiceMethod("BL_M_COMMON_001",a.accSendArray).then(function(e){a.accDetail=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"],a.accSqIdNo=a.accDetail.columnList[0]["com.napier.core.service.vo.query.Column"][2].data,a.accSubSqIdNo=a.accDetail.columnList[0]["com.napier.core.service.vo.query.Column"][4].data,a.AccPackCatgCode=a.accDetail.columnList[0]["com.napier.core.service.vo.query.Column"][9].data,a.rateCard(a.assignment.pckgName.SERV_SEQ_ID)},function(e){})},a.rateCard=function(t){var r=new Date,l=r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+"."+r.getMilliseconds();a.dateOn=a.getYear+"-"+a.getMonth+"-"+r.getDate()+" "+l+" ";var s={};s.url=e.HISIPINDENT.URL,s.requestData={operation:"getServiceRate",messageId:"",destination:"com.napier.core.ratecard.service.external.RateCardService",message:{"@class":"com.napier.core.service.vo.ratecard.ServiceRateVo",servSeqId:t,bedClassRateVos:{"com.napier.core.service.vo.ratecard.BedClassRateVo":[{bedClassSeqId:a.bedClassSeqId}]},tariffSeqId:a.tarrifSeqId,datedOn:a.dateOn}},n.sendRestRequest(s).then(function(e){null!=e.data.HITService.message.baseRate?(a.baseRate=e.data.HITService.message.baseRate,a.rcvSeqId=e.data.HITService.message.rcvSeqId,a.inflSeqId=e.data.HITService.message.inflSeqId,a.servSeqId=e.data.HITService.message.servSeqId,a.tariffSeqId=e.data.HITService.message.tariffSeqId,a.ServicePostingDtls()):11345==e.data.HITService.message.errorCode&&(i.warning("Warning",e.data.HITService.message.errorMessage),a.saveBtn=!0)},function(e){})},a.clearPageData=function(){a.gridOptions.data=[],a.gridOptionsMtrlInclu.data=[],a.gridOptionsSrvcExclu.data=[],a.gridOptionsMtrlEXclu.data=[],a.gridOptionsPckg.data=[],a.icuDays=0,a.regDays=0,a.preProcedure=0,a.totDays=0,a.assignment.pckgName=void 0,a.assignment.frmDate=new Date,a.assignment.toDate=void 0,a.addPack=!1,a.saveBtn=!0,a.servicepostingDtlsList=[],a.billPayerDtList=[]},a.ServicePostingDtls=function(){$(".overlay").show();var t={};t.url=e.HISIPINDENT.URL,t.requestData={operation:"getPackageBookingServicePostingDtls",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.PackageBookingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingVo",servicePostingDetailsList:[{"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo":[{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",accSeqId:a.accSqIdNo,subAccSeqId:a.accSubSqIdNo,tariffSeqId:a.tarrifSeqId,encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:0,enProvider:0,enSpeciality:0,isAddendum:!1},patientCategoryCode:a.AccPackCatgCode,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ISDEFAULT,practiceId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID_DESC,bedClassCode:a.bedClassSeqId,compSeqId:a.assignment.pckgName.SERV_SEQ_ID}]}]}},n.sendRestRequest(t).then(function(e){if($(".overlay").hide(),a.ServicePostingDetails=[],null!=e.data.HITService.message.servicePostingDetailsList&&""!=e.data.HITService.message.servicePostingDetailsList[0]&&null!=e.data.HITService.message.servicePostingDetailsList[0]&&null!=e.data.HITService.message.servicePostingDetailsList[0]){if(a.spDtlsList=e.data.HITService.message.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"],a.spDtlsList instanceof Array)for(var t=0;t<a.spDtlsList.length;t++)a.ServicePostingDetails[t]={"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",accSeqId:a.spDtlsList[t].accSeqId,subAccSeqId:a.spDtlsList[t].subAccSeqId,servicePostingType:a.spDtlsList[t].servicePostingType,isFollowUp:!1,requestedDateTime:a.dateOn,requestComingFrom:"PACKAGE",renderedByEmpSeqID:a.spDtlsList[t].renderedByEmpSeqID?"":a.spDtlsList[t].renderedByEmpSeqID,renderedByEmpType:a.spDtlsList[t].renderedByEmpType?"":a.spDtlsList[t].renderedByEmpType,renderedDateTime:a.dateOn,quantity:null!=a.spDtlsList[t].serviceVo.serviceQty&&a.spDtlsList[t].serviceVo.serviceQty>0?a.spDtlsList[t].serviceVo.serviceQty:1,visitInfo:1,serviceVo:{"@class":"com.napier.core.scm.master.vo.ServiceVo",servSeqId:a.spDtlsList[t].serviceRateVo.servSeqId,gnServDesign:a.spDtlsList[t].serviceVo.servDesign,servCode:a.spDtlsList[t].serviceVo.servCode,servName:a.spDtlsList[t].serviceVo.servName,servTypeCode:a.spDtlsList[t].serviceVo.servTypeCode,secServTypeCode:a.spDtlsList[t].serviceVo.secServTypeCode,priServTypCode:a.spDtlsList[t].serviceVo.priServTypCode},serviceRateVo:{"@class":"com.napier.core.service.vo.ratecard.ServiceRateVo",rcvSeqId:a.spDtlsList[t].serviceRateVo.rcvSeqId,inflSeqId:a.spDtlsList[t].serviceRateVo.inflSeqId,servSeqId:a.spDtlsList[t].serviceRateVo.servSeqId,baseRate:a.spDtlsList[t].serviceRateVo.baseRate,tariffSeqId:a.spDtlsList[t].serviceRateVo.tariffSeqId,datedOn:a.spDtlsList[t].serviceRateVo.datedOn},encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:a.spDtlsList[t].encounter.enAmbultryStatus,enProvider:a.spDtlsList[t].encounter.enProvider,enSpeciality:a.spDtlsList[t].encounter.enSpeciality,isAddendum:a.spDtlsList[t].encounter.isAddendum},patientCategoryCode:a.spDtlsList[t].patientCategoryCode,facilityId:a.spDtlsList[t].facilityId,practiceId:a.spDtlsList[t].practiceId,gnFlow:a.spDtlsList[t].gnFlow,surcharge:a.spDtlsList[t].surcharge,hospitalSurcharge:a.spDtlsList[t].hospitalSurcharge,doctorSurcharge:a.spDtlsList[t].doctorSurcharge,serviceRate:a.spDtlsList[t].serviceRate,baseRate:a.spDtlsList[t].serviceRateVo.baseRate,actualRate:a.spDtlsList[t].actualRate,doctorAmount:a.spDtlsList[t].doctorAmount,standardDoctorShare:a.spDtlsList[t].standardDoctorShare,doctorModifiedAmount:0,discountAmt:a.spDtlsList[t].discountAmt,isPackage:1,packApplyTypeDesc:null!=a.spDtlsList[t].packApplyTypeDesc?a.spDtlsList[t].packApplyTypeDesc:void 0,hospitalShare:a.spDtlsList[t].hospitalShare,doctorShare:a.spDtlsList[t].doctorShare,isEmergency:a.spDtlsList[t].aaIsEmergency,parentSpSeqId:a.assignment.pckgName.SERV_SEQ_ID,isDepositRequired:a.spDtlsList[t].isDepositRequired,compSeqId:a.spDtlsList[t].serviceRateVo.servSeqId},"{}"!=JSON.stringify(a.spDtlsList[t].multiEmployeeShareList)?a.ServicePostingDetails[t].gnTranStatus=a.spDtlsList[t].multiEmployeeShareList.employeeShareList[0]["com.napier.core.scm.serviceposting.vo.EmployeeShareVo"].gnTranStatus:a.ServicePostingDetails[t].gnTranStatus=1;else a.ServicePostingDetails[0]={"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",accSeqId:a.spDtlsList.accSeqId,subAccSeqId:a.spDtlsList.subAccSeqId,servicePostingType:a.spDtlsList.servicePostingType,isFollowUp:!1,requestedDateTime:a.dateOn,renderedByEmpSeqID:a.spDtlsList.renderedByEmpSeqID?"":a.spDtlsList.renderedByEmpSeqID,renderedByEmpType:a.spDtlsList.renderedByEmpType?"":a.spDtlsList.renderedByEmpType,renderedDateTime:a.dateOn,quantity:null!=a.spDtlsList[t].serviceVo.serviceQty&&a.spDtlsList[t].serviceVo.serviceQty>0?a.spDtlsList[t].serviceVo.serviceQty:1,visitInfo:1,serviceVo:{"@class":"com.napier.core.scm.master.vo.ServiceVo",servSeqId:a.spDtlsList.serviceRateVo.servSeqId,gnServDesign:a.spDtlsList.serviceVo.servDesign,servCode:a.spDtlsList.serviceVo.servCode,servName:a.spDtlsList.serviceVo.servName,servTypeCode:a.spDtlsList.serviceVo.servTypeCode,secServTypeCode:a.spDtlsList.serviceVo.secServTypeCode,priServTypCode:a.spDtlsList.serviceVo.priServTypCode},serviceRateVo:{"@class":"com.napier.core.service.vo.ratecard.ServiceRateVo",rcvSeqId:a.spDtlsList.serviceRateVo.rcvSeqId,inflSeqId:a.spDtlsList.serviceRateVo.inflSeqId,servSeqId:a.spDtlsList.serviceRateVo.servSeqId,baseRate:a.spDtlsList.serviceRateVo.baseRate,tariffSeqId:a.spDtlsList.serviceRateVo.tariffSeqId,datedOn:a.spDtlsList.serviceRateVo.datedOn},encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:a.spDtlsList.encounter.enAmbultryStatus,enProvider:a.spDtlsList.encounter.enProvider,enSpeciality:a.spDtlsList.encounter.enSpeciality,isAddendum:a.spDtlsList.encounter.isAddendum},patientCategoryCode:a.spDtlsList.patientCategoryCode,facilityId:a.spDtlsList.facilityId,practiceId:a.spDtlsList.practiceId,gnTranStatus:a.spDtlsList.multiEmployeeShareList.employeeShareList[0]["com.napier.core.scm.serviceposting.vo.EmployeeShareVo"].gnTranStatus,gnFlow:a.spDtlsList.gnFlow,surcharge:a.spDtlsList.surcharge,hospitalSurcharge:a.spDtlsList.hospitalSurcharge,doctorSurcharge:a.spDtlsList.doctorSurcharge,serviceRate:a.spDtlsList.serviceRate,baseRate:a.spDtlsList.serviceRateVo.baseRate,actualRate:a.spDtlsList.actualRate,doctorAmount:a.spDtlsList.doctorAmount,standardDoctorShare:a.spDtlsList.standardDoctorShare,doctorModifiedAmount:0,discountAmt:a.spDtlsList.discountAmt,isPackage:1,packApplyTypeDesc:null!=a.spDtlsList[t].packApplyTypeDesc?a.spDtlsList[t].packApplyTypeDesc:void 0,hospitalShare:a.spDtlsList.hospitalShare,doctorShare:a.spDtlsList.doctorShare,isEmergency:a.spDtlsList.aaIsEmergency,parentSpSeqId:a.assignment.pckgName.SERV_SEQ_ID,isDepositRequired:a.spDtlsList.isDepositRequired,compSeqId:a.spDtlsList.serviceRateVo.servSeqId};return a.getPayerSummaryDetails(),a.servicepostingDtlsList.push({"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo":a.ServicePostingDetails})}i.warning("Warning","Service Posting Details are Undefined")})},a.billPayerDtList=[],a.getPayerSummaryDetails=function(){if(a.billPayerDtls=[],null!=a.spDtlsList)if(a.spDtlsList instanceof Array)for(var t=0;t<a.spDtlsList.length;t++)a.billPayerDtls[t]={chargeableAmt:a.spDtlsList[t].serviceRateVo.baseRate,servSeqId:a.spDtlsList[t].serviceRateVo.servSeqId,tariffSeqId:a.spDtlsList[t].serviceRateVo.tariffSeqId,"@class":"com.napier.core.billgeneration.vo.BillPayerSummary"};else a.billPayerDtls[0]={chargeableAmt:a.spDtlsList.serviceRateVo.baseRate,servSeqId:a.spDtlsList.serviceRateVo.servSeqId,tariffSeqId:a.spDtlsList.serviceRateVo.tariffSeqId,"@class":"com.napier.core.billgeneration.vo.BillPayerSummary"};var i={};i.url=e.HISIPINDENT.URL,i.requestData={operation:"getPayerSummaryDetailsforOp",messageId:"",destination:"com.napier.core.billgeneration.service.external.BillGenerationService",message:{"@class":"com.napier.core.billgeneration.vo.BillPayerSummaryList",billPayerSummaryList:[{"com.napier.core.billgeneration.vo.BillPayerSummary":a.billPayerDtls}],isHighValueDiscCheck:!0}},n.sendRestRequest(i).then(function(e){if(a.billPayerDtlsList=[],a.billPayerDtlsTemp=e.data.HITService.message.billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"],a.billPayerDtlsTemp instanceof Array)for(var t=0;t<a.billPayerDtlsTemp.length;t++)a.billPayerDtlsList[t]={"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",payerAmount:a.billPayerDtlsTemp[t].payerAmount,payerType:a.billPayerDtlsTemp[t].payerType,payStatus:1,gnStatus:1};else a.billPayerDtlsList.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",payerAmount:a.billPayerDtlsTemp.payerAmount,payerType:a.billPayerDtlsTemp.payerType,payStatus:1,gnStatus:1});return a.billPayerDtList.push({"com.napier.core.billgeneration.vo.BillPayerDetails":a.billPayerDtlsList})})},a.bedDays=function(){var t={};t.url=e.HISIPINDENT.URL,t.requestData={operation:"saveCompositeServiceLimit",messageId:"",destination:"com.napier.core.masters.service.external.PackageMasterService",message:{"@class":"com.napier.core.masters.vo.ServiceVo",compositeServiceLimitVoList:[{"com.napier.core.masters.vo.CompositeServiceLimitVo":[{cslSeqId:a.bedDaysResArray[4].data,servSeqId:a.assignment.pckgName.SERV_SEQ_ID,icuDays:a.icuDays,preProcDays:a.preProcedure,regularDays:a.regDays,totalDays:a.totDays}]}]}},n.sendRestRequest(t).then(function(e){""!=e.data.HITService.message&&null!=e.data.HITService.message&&$(".overlay").hide()})},a.savePackageAssignment=function(){a.gridOptionsPckg.data?0==a.isBedDaysInvalid?($(".overlay").show(),a.save2()):(i.warning("warning","please enter valid Bed Days"),$(".overlay").hide()):(i.warning("warning","please select package to assign"),$(".overlay").hide())},a.save2=function(){var r;null==a.gridOptionsPckg.data[0].DISCOUNT_PERCENT&&(a.gridOptionsPckg.data[0].DISCOUNT_PERCENT=0),r=parseFloat((a.baseRate*(a.gridOptionsPckg.data[0].DISCOUNT_PERCENT/100)).toFixed(2));var l={};l.url=e.HISIPINDENT.URL,l.requestData={operation:"savePackageBooking",messageId:"",destination:"com.napier.core.masters.service.external.PackageMasterService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ApplyPackageListVo",applyPackageVoList:[{"com.napier.core.scm.serviceposting.vo.ApplyPackageVo":[{"@class":"com.napier.core.scm.serviceposting.vo.ApplyPackageVo",patientIpSeqId:a.ipAdSqId,servSeqId:a.assignment.pckgName.SERV_SEQ_ID,fromDate:t("date")(new Date(a.assignment.frmDate),"yyyy-MM-dd")+" 00:00:00.000",toDate:t("date")(new Date(a.assignment.toDate),"yyyy-MM-dd")+" 23:59:59.000",durationDays:parseInt(a.totDays),packageCost:a.baseRate,requestedByEmpSeqID:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,servCode:a.assignment.pckgName.SERV_CODE,servName:a.assignment.pckgName.SERV_NAME,servDate:a.dateOn,effectiveRate:parseFloat((a.baseRate-r).toFixed(2)),discountAmt:r,rcvSeqId:a.rcvSeqId,admssionDate:a.patientGlobalDtls.admissionDate,encounterNo:a.patientGlobalDtls.encounterNo,accountSequenceId:a.patientGlobalDtls.accSeqId,checkFor:a.patientGlobalDtls.checkFor,insurancePlanSeqId:a.patientGlobalDtls.insurancePlanSeqId,subAccSeqId:a.patientGlobalDtls.subAccSeqId,patientId:a.patientGlobalDtls.mrNo}]}]}},n.sendRestRequest(l).then(function(e){null!=e.data.HITService.message.errorCode&&2047==e.data.HITService.message.errorCode||2046==e.data.HITService.message.errorCode||11345==e.data.HITService.message.errorCode||60999==e.data.HITService.message.errorCode||33042==e.data.HITService.message.errorCode?(i.failure("Error",e.data.HITService.message.errorMessage),$(".overlay").hide()):null!=e.data.HITService.destination&&null!=e.data.HITService.operation?(i.success("success","Package Saved Successfully"),a.bedDays(),a.clearPageData()):(i.failure("Error","error occured"),$(".overlay").hide())},function(e){})}}e.$inject=["IPINDENTAPIS","$filter","$scope","hisAlertService","PatientBannerGlobal","CallManager","assignmentQueryService","QueryService","hisTranslationsService","hisCalDefConstant","RoleTaskService","PatientBannerBilling","GetDocumentCommon","uibDatepickerConfig"],angular.module("napierContainerUi").controller("packageAssignment",e),angular.module("napierContainerUi").service("assignmentQueryService",["IPINDENTAPIS","CallManager",function(e,t){this.queryServiceMethod=function(a,i){var r={};return r.url=e.HISCOMBO.URL,r.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:a,idxList:[{"com.napier.core.service.vo.query.Index":i}]}]}]}},t.sendRestRequest(r)}}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v){var D=this;e.assignment={},t.loadModule("billing");var y=n.getLanguageToSet();function f(e){if((e=angular.copy(e))&&!e[0].SER_HIERARCHY_LEVEL){var t=function(e){for(var t=[],a={},i={},r={},n=0;n<e.length;n++){angular.isNumber(e[n].actualRate)||(e[n].actualRate=0),angular.isNumber(e[n].taxAmt)||(e[n].taxAmt=0),e[n].actualRate=e[n].actualRate+e[n].taxAmt,0==parseFloat(e[n].nonChargableAmt)&&e[n].actualRate>0&&(e[n].chargeableAmt=e[n].chargeableAmt+e[n].taxAmt),e[n].deptCode=angular.copy(e[n].serviceDeptCode),e[n].department=angular.copy(e[n].serviceDepartName);let l=_.findIndex(t,function(t){return t.code==e[n].primaryServiceCode});if(-1==l)t.push(C(e[n].primaryServiceCode,e[n],{})),a[e[n].primaryServiceCode]=new Array,a[e[n].primaryServiceCode].push(C(e[n].deptCode,e[n],{})),e[n].specilityCode?(i[e[n].primaryServiceCode+"_"+e[n].deptCode]=new Array,i[e[n].primaryServiceCode+"_"+e[n].deptCode].push(C(e[n].specilityCode,e[n],{})),r[e[n].primaryServiceCode+"_"+e[n].deptCode+"_"+e[n].specilityCode]=new Array,r[e[n].primaryServiceCode+"_"+e[n].deptCode+"_"+e[n].specilityCode].push(C(e[n].serviceVo.servSeqId,e[n],{}))):(r[e[n].primaryServiceCode+"_"+e[n].deptCode]=new Array,r[e[n].primaryServiceCode+"_"+e[n].deptCode].push(C(e[n].serviceVo.servSeqId,e[n],{})));else{t[l]=C(e[n].primaryServiceCode,e[n],t[l]);let s=_.findIndex(a[e[n].primaryServiceCode],function(t){return t.code==e[n].deptCode});if(-1==s)a[e[n].primaryServiceCode].push(C(e[n].deptCode,e[n],{})),e[n].specilityCode?(i[e[n].primaryServiceCode+"_"+e[n].deptCode]=new Array,i[e[n].primaryServiceCode+"_"+e[n].deptCode].push(C(e[n].specilityCode,e[n],{})),r[e[n].primaryServiceCode+"_"+e[n].deptCode+"_"+e[n].specilityCode]=new Array,r[e[n].primaryServiceCode+"_"+e[n].deptCode+"_"+e[n].specilityCode].push(C(e[n].serviceVo.servSeqId,e[n],{}))):(r[e[n].primaryServiceCode+"_"+e[n].deptCode]=new Array,r[e[n].primaryServiceCode+"_"+e[n].deptCode].push(C(e[n].serviceVo.servSeqId,e[n],{})));else if(a[e[n].primaryServiceCode][s]=C(e[n].deptCode,e[n],a[e[n].primaryServiceCode][s]),e[n].specilityCode){let t=_.findIndex(i[e[n].primaryServiceCode+"_"+e[n].deptCode],function(t){return t.code==e[n].specilityCode});if(-1==t)i[e[n].primaryServiceCode+"_"+e[n].deptCode].push(C(e[n].specilityCode,e[n],{})),r[e[n].primaryServiceCode+"_"+e[n].deptCode+"_"+e[n].specilityCode]=new Array,r[e[n].primaryServiceCode+"_"+e[n].deptCode+"_"+e[n].specilityCode].push(C(e[n].serviceVo.servSeqId,e[n],{}));else{i[e[n].primaryServiceCode+"_"+e[n].deptCode][t]=C(e[n].specilityCode,e[n],i[e[n].primaryServiceCode+"_"+e[n].deptCode][t]);let a=_.findIndex(r[e[n].primaryServiceCode+"_"+e[n].deptCode+"_"+e[n].specilityCode],function(t){return t.code==e[n].serviceVo.servSeqId});-1==a?r[e[n].primaryServiceCode+"_"+e[n].deptCode+"_"+e[n].specilityCode].push(C(e[n].serviceVo.servSeqId,e[n],{})):r[e[n].primaryServiceCode+"_"+e[n].deptCode+"_"+e[n].specilityCode][a]=C(e[n].serviceVo.servSeqId,e[n],r[e[n].primaryServiceCode+"_"+e[n].deptCode+"_"+e[n].specilityCode][a])}}else{let t=_.findIndex(r[e[n].primaryServiceCode+"_"+e[n].deptCode],function(t){return t.code==e[n].serviceVo.servSeqId});-1==t?(r[e[n].primaryServiceCode+"_"+e[n].deptCode]=new Array,r[e[n].primaryServiceCode+"_"+e[n].deptCode].push(C(e[n].serviceVo.servSeqId,e[n],{}))):r[e[n].primaryServiceCode+"_"+e[n].deptCode][t]=C(e[n].serviceVo.servSeqId,e[n],r[e[n].primaryServiceCode+"_"+e[n].deptCode][t])}}}return function(e,t,a,i){var r=[];!function(e){for(var t=0;t<e.length;t++)null==e[t][parseInt(sessionStorage.getItem("bedClassId"))]&&3!=e[t].amtNlPer||(0==e[t].$$treeLevel?I.primaryLimit[e[t].srchObj.CODE]={limit:e[t].limit,qty:e[t].quantity}:1==e[t].$$treeLevel?I.departmentLimit[e[t].srchObj.CODE]={limit:e[t].limit,qty:e[t].quantity}:2==e[t].$$treeLevel?I.specialityLimit[e[t].srchObj.CODE]={limit:e[t].limit,qty:e[t].quantity}:3==e[t].$$treeLevel&&(I.serviceLimit[e[t].srchObj.SERV_SEQ_ID]={limit:e[t].limit,qty:e[t].quantity}))}(angular.copy(D.packageAssignmentArray[0].inclusionItems.data));for(var n=0;n<e.length;n++){e[n].$$treeLevel=0,e[n].limit=I.primaryLimit[e[n].code]?I.primaryLimit[e[n].code].limit:void 0,e[n].quantity=I.primaryLimit[e[n].code]?I.primaryLimit[e[n].code].qty:void 0,e[n].srchObj={CODE:e[n].code,DESCRIPTION:e[n].description};let p=e[n].code;if(r.push(e[n]),null!=t[e[n].code])for(var l=0;l<t[e[n].code].length;l++){t[e[n].code][l].$$treeLevel=1,t[e[n].code][l].limit=I.departmentLimit[t[e[n].code][l].code]?I.departmentLimit[t[e[n].code][l].code].limit:void 0,t[e[n].code][l].quantity=I.departmentLimit[t[e[n].code][l].code]?I.departmentLimit[t[e[n].code][l].code].qty:void 0,t[e[n].code][l].srchObj={CODE:t[e[n].code][l].code,DESCRIPTION:t[e[n].code][l].description},r.push(t[e[n].code][l]);var s=t[e[n].code][l];if(null!=a[p+"_"+s.code])for(var o=0;o<a[p+"_"+s.code].length;o++){a[p+"_"+s.code][o].$$treeLevel=2,a[p+"_"+s.code][o].limit=I.specialityLimit[a[p+"_"+s.code][o].code]?I.specialityLimit[a[p+"_"+s.code][o].code].limit:void 0,a[p+"_"+s.code][o].quantity=I.specialityLimit[a[p+"_"+s.code][o].code]?I.specialityLimit[a[p+"_"+s.code][o].code].qty:void 0,a[p+"_"+s.code][o].srchObj={CODE:a[p+"_"+s.code][o].code,DESCRIPTION:a[p+"_"+s.code][o].description},r.push(a[p+"_"+s.code][o]);var c=a[p+"_"+s.code][o];if(i[p+"_"+s.code+"_"+c.code])for(var d=0;d<i[p+"_"+s.code+"_"+c.code].length;d++)i[p+"_"+s.code+"_"+c.code][d].$$treeLevel=3,i[p+"_"+s.code+"_"+c.code][d].limit=I.serviceLimit[i[p+"_"+s.code+"_"+c.code][d].code]?I.serviceLimit[i[p+"_"+s.code+"_"+c.code][d].code].limit:void 0,i[p+"_"+s.code+"_"+c.code][d].quantity=I.serviceLimit[i[p+"_"+s.code+"_"+c.code][d].code]?I.serviceLimit[i[p+"_"+s.code+"_"+c.code][d].code].qty:void 0,i[p+"_"+s.code+"_"+c.code][d].srchObj={SERV_CODE:i[p+"_"+s.code+"_"+c.code][d].code,SERV_NAME:i[p+"_"+s.code+"_"+c.code][d].description},r.push(i[p+"_"+s.code+"_"+c.code][d])}else{var c=i[p+"_"+s.code][o];if(i[s.code])for(var d=0;d<i[s.code].length;d++)i[p+"_"+s.code][d].$$treeLevel=3,i[p+"_"+s.code][d].limit=I.serviceLimit[i[p+"_"+s.code][d].code]?I.serviceLimit[i[s.code][d].code].limit:void 0,i[p+"_"+s.code][d].quantity=I.serviceLimit[i[p+"_"+s.code][d].code]?I.serviceLimit[i[s.code][d].code].qty:void 0,i[p+"_"+s.code][d].srchObj={SERV_CODE:i[p+"_"+s.code][d].code,SERV_NAME:i[p+"_"+s.code][d].description},r.push(i[p+"_"+s.code][d])}}}return r}(t,a,i,r)}(e);D.packageAssignmentArray[0].inclusionItems.data=angular.copy(t)}D.packageAssignmentArray[0].inclusionItems.columnDefs[1].visible=!1,D.packageAssignmentArray[0].inclusionItems.columnDefs[4].visible=!0,D.packageAssignmentArray[0].inclusionItems.columnDefs[5].visible=!0,D.packageAssignmentArray[0].inclusionItems.columnDefs[6].visible=!0,sessionStorage.removeItem("spSeqId"),sessionStorage.removeItem("packageSeqId"),sessionStorage.removeItem("packageServiceList"),sessionStorage.removeItem("bedClassId")}function C(e,t,a){return{code:e,description:e==t.primaryServiceCode?t.pSGDescription?t.pSGDescription:t.priTypeDesc:e==t.deptCode?t.department:e==t.specilityCode?t.specilityDesc:e==t.serviceVo.servSeqId?t.serviceVo.servName:void 0,amount:t.actualRate+(a.amount?a.amount:0),chargableAmount:t.chargeableAmt+(a.chargableAmount?a.chargableAmount:0),nonChargableAmount:t.nonChargableAmt+(a.nonChargableAmount?a.nonChargableAmount:0),limit:"limit"}}t.changeLanguage(y),e.patientBannerArray=[],e.patientBannerArray1=[],e.searchPatientService=function(t){t="%"+t+"%",e.patientBannerArray=[],e.multipleComboDataForList={1:e.patientBannerArray};var a=l.executeQueryURLReset();return e.srchPatientArray=new Array,l.prepareParamList(1,t,e.srchPatientArray),l.prepareParamList(2,t,e.srchPatientArray),l.prepareParamList(3,t,e.srchPatientArray),l.prepareParamList(4,t,e.srchPatientArray),l.prepareParamList(5,t,e.srchPatientArray),l.prepareParamList(6,t,e.srchPatientArray),l.executeQueryInput("SEARCH_PAT",e.srchPatientArray,e.multipleComboDataForList,!0,!0,a,"popUp",!0).then(function(t){return e.patientBannerArray=t[1],e.patientBannerArray1=e.patientBannerArray,e.patientBannerArray1=Array.isArray(e.patientBannerArray1)?e.patientBannerArray1:[e.patientBannerArray1],e.patientBannerArray1.map(function(e){return e})})},e.setPatientToBanner=function(){if(e.assignment.srchPatientName.RG_SEQ_ID){e.ipAdSqId=e.assignment.srchPatientName.IPADM_SEQ_ID;var t="1",a={regSeqId:e.assignment.srchPatientName.RG_SEQ_ID,admissionSeqid:e.assignment.srchPatientName.IPADM_SEQ_ID};e.regSqId=a.regSeqId;var i=a;t=null!=i.admissionSeqid?"1":"2";var r=[];D.clearanceStatus=void 0;var n={1:r},c=l.executeQueryURLReset(),d=[];l.prepareParamListWithParam("pUserSeqId",angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,d),l.prepareParamListWithParam("pAdmnSeqId",a.admissionSeqid,d),l.executeQueryInput("IS_CLEARANCE_GIVEN_STATUS_FOR_BILLING",d,n,!0,!0,c,"popUp",{}).then(function(n){if(null!=r[0])for(var c=0;c<r.length&&(D.clearanceStatus=r[c].IS_CLEARANCE_GIVEN,"N"!=D.clearanceStatus);c++);if("Y"==D.clearanceStatus)return g.warning("Warning","Package Assignment Not Allowed After Billing Clearance."),!1;o.getPatientBanner(i,t).then(function(t){e.patientGlobalDtls=t,e.patientGlobalDtls.patientName&&(e.enablePkgName=!0),e.patientGlobalDtls.userPermision=123,e.tarrifSeqId=e.patientGlobalDtls.tariffSeqId,e.bedClassSeqId=e.patientGlobalDtls.bedClassCode,e.admissionSeqid=e.assignment.srchPatientName.IPADM_SEQ_ID,e.pSubAccSeqId=e.patientGlobalDtls.subAccSeqId,e.FACILITY_ID=angular.fromJson(sessionStorage.userContextObj).FACILITY_ID;var a=[],i={1:a},r=l.executeQueryURLReset(),n=[];l.prepareParamListWithParam("pSubAccSeqId",e.pSubAccSeqId,n),l.prepareParamListWithParam("pFacSeqId",e.FACILITY_ID,n),l.executeQueryInput("GET_PACK_DETAILS_BY_SUBACCOUNT",n,i,!0,!0,r,"popUp",{}).then(function(t){e.packageAssignmentArray=[],angular.forEach(a,function(t,a){1==t.BILL_STATUS?t.isBillGenerated=!0:t.isBillGenerated=!1,e.assignPackageToPatient(t)})})}),s.patientBannerDetail(a.regSeqId).then(function(t){e.patientBannerDetails=t,e.patientRecordsDetail=e.patientBannerDetails.patientRecordsDetail}),v.getDocFile(a.regSeqId,e)})}else g.warning("Warning","Please select the patient.")},e.packageNamesData=[],e.assignment.pckgName=null,e.getPackageData=function(t){e.multipleComboDataForListName={1:e.packageNamesData=[]};var a=l.executeQueryURLReset();return e.packageNameArray=[{paramName:"@SERV_NAME",value:t},{paramName:"@BC_CODE",value:e.patientGlobalDtls.bedClassCode},{paramName:"@IP_NO",value:e.patientGlobalDtls.ipNo},{paramName:"@PAYER_SEQ_ID",value:4!=e.patientGlobalDtls.checkFor&&null!=e.patientGlobalDtls.insuranceSeqId&&null!=e.patientGlobalDtls.insuranceSeqId?e.patientGlobalDtls.insuranceSeqId:-999},{paramName:"@START_DT",value:u("date")(new Date(e.patientGlobalDtls.admissionDate),"yyyy-MM-dd")+" 00:00:00.000"}],l.executeQueryInput("PACKNAME_DROPDOWN_002",e.packageNameArray,e.multipleComboDataForListName,!0,!0,a,"popUp",{}).then(function(t){if(t[1][0])return e.packageNamesData.map(function(e){return e})})},e.getPackageInformation=function(t){null!=t&&null!=t&&(e.assignment.packageDays=t.TOTAL_DAYS,e.assignment.packagePrice=t.AMOUNT,e.assignment.pckgName=t)},e.processDataForTreeGrid=function(t,a){t.$$treeLevel=a,1===t.packageCoverType?e.packageAssigInclArray.push(t):2===t.packageCoverType&&e.packageAssigExcArray.push(t)},e.packageInclusionDetails=[],e.packageAssignmentArray=[],e.packageAssigInclArray=[],e.packageAssigExcArray=[],e.assignPackageToPatient=function(t){var a;null!=t&&null!=t&&(a=t.SERV_SEQ_ID,e.packageAssignmentArray.filter(function(e){return e.SERV_SEQ_ID==a}).length>0?(g.warning("Warning","Package already exist.",!1,!1,S.time),e.assignment.packageDays=null,e.assignment.packagePrice=null,e.assignment.pckgName=null):(t.bedClassId=e.patientGlobalDtls.billingBedClassCode,d.getPackageIncExcDetails(t,{},"1").then(function(a){e.packageAssigInclArray=[],e.packageAssigExcArray=[];for(var i={data:[],columnDefs:[{name:"packageCoverType",displayName:"Inclusion",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="row.entity.$$treeLevel!=3">{{row.entity.srchObj.DESCRIPTION}}</span><span ng-if="row.entity.$$treeLevel==3">{{row.entity.srchObj.SERV_NAME}}</span></div>'},{name:"applicability",displayName:"Applicability",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="row.entity.applicability==1">Per Visit</span><span ng-if="row.entity.applicability==2">Per Week</span><span ng-if="row.entity.applicability==3">Per Day</span></div>'},{name:"limit",displayName:"Limit"},{name:"quantity",displayName:"Quantity"},{name:"amount",displayName:"Amount",visible:!1,aggregationType:r.aggregationTypes.sum,cellFilter:"number:2"},{name:"chargableAmount",displayName:"Chargable Amount",visible:!1,aggregationType:r.aggregationTypes.sum,cellFilter:"number:2"},{name:"nonChargableAmount",displayName:"Non Chargable Amount",visible:!1,aggregationType:r.aggregationTypes.sum,cellFilter:"number:2"}],onRegisterApi:function(e){D.gridApi=e}},n={data:[],columnDefs:[{name:"packageCoverType",displayName:"Inclusion",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="row.entity.$$treeLevel!=3">{{row.entity.srchObj.DESCRIPTION}}</span><span ng-if="row.entity.$$treeLevel==3">{{row.entity.srchObj.SERV_NAME}}</span></div>'},{name:"applicability",displayName:"Applicability",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="row.entity.applicability==1">Per Visit</span><span ng-if="row.entity.applicability==2">Per Week</span><span ng-if="row.entity.applicability==3">Per Day</span></div>'},{name:"limit",displayName:"Limit"},{name:"quantity",displayName:"Quantity"},{name:"amount",displayName:"Amount",visible:!1,aggregationType:r.aggregationTypes.sum},{name:"chargableAmount",displayName:"Chargable Amount",visible:!1,aggregationType:r.aggregationTypes.sum},{name:"nonChargableAmount",displayName:"Non Chargable Amount",visible:!1,aggregationType:r.aggregationTypes.sum}],onRegisterApi:function(e){D.gridApi=e}},l=0;l<a.length;l++)if(a[l].$$treeLevel=0,1==a[l].packageCoverType?e.packageAssigInclArray.push(a[l]):e.packageAssigExcArray.push(a[l]),null!=a[l].departTreeList)for(var s=0;s<a[l].departTreeList.length;s++)if(e.processDataForTreeGrid(a[l].departTreeList[s],1),null!=a[l].departTreeList[s].specltyTreeList)for(var o=0;o<a[l].departTreeList[s].specltyTreeList.length;o++)if(e.processDataForTreeGrid(a[l].departTreeList[s].specltyTreeList[o],2),null!=a[l].departTreeList[s].specltyTreeList[o].srivceTreeList)for(var c=0;c<a[l].departTreeList[s].specltyTreeList[o].srivceTreeList.length;c++)null!=a[l].departTreeList[s].specltyTreeList[o].srivceTreeList[c]&&e.processDataForTreeGrid(a[l].departTreeList[s].specltyTreeList[o].srivceTreeList[c],3);if(i.data=e.packageAssigInclArray,n.data=e.packageAssigExcArray,t.inclusionItems=i,t.exclusionItems=n,e.packageAssignmentArray.push(t),sessionStorage.getItem("packageSeqId")){D.packageAssignmentArray=angular.copy(e.packageAssignmentArray),D.packageAssignmentArray[0].inclusionItems.onRegisterApi=function(e){D.gridApi=e};var d=angular.fromJson(sessionStorage.getItem("packageServiceList"));d?f(d):f()}e.assignment.packageDays=null,e.assignment.packagePrice=null,e.assignment.pckgName=null})))},e.isAsignGridData=function(e){console.log("packageAssignment",e)},e.getPackageAssignmentList=function(){let t=[];for(var a=e.packageAssignmentArray.length-1;a>=0;a--)if(null==e.packageAssignmentArray[a].SP_SEQ_ID){let i={patientIpSeqId:e.ipAdSqId,servSeqId:e.packageAssignmentArray[a].SERV_SEQ_ID,fromDate:u("date")(new Date(e.packageAssignmentArray[a].EFFECTIVE_FROM),"yyyy-MM-dd")+" 00:00:00.000",toDate:u("date")(new Date(e.packageAssignmentArray[a].EFFECTIVE_TO),"yyyy-MM-dd")+" 00:00:00.000",durationDays:parseInt(e.packageAssignmentArray[a].TOTAL_DAYS),packageCost:e.packageAssignmentArray[a].AMOUNT,requestedByEmpSeqID:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,servCode:e.packageAssignmentArray[a].SERV_CODE,servName:e.packageAssignmentArray[a].SERV_NAME,servDate:e.dateOn,effectiveRate:parseFloat(e.packageAssignmentArray[a].AMOUNT)-parseFloat(e.packageAssignmentArray[a].DISCOUNT_PERCENT),discountAmt:parseFloat(e.packageAssignmentArray[a].DISCOUNT_PERCENT),admssionDate:e.patientGlobalDtls.admissionDate,encounterNo:e.patientGlobalDtls.encounterNo,accountSequenceId:e.patientGlobalDtls.accSeqId,checkFor:e.patientGlobalDtls.checkFor,insurancePlanSeqId:e.patientGlobalDtls.insurancePlanSeqId,subAccSeqId:e.patientGlobalDtls.subAccSeqId,patientId:e.patientGlobalDtls.mrNo};t.push(i)}return t},e.saveAssignedPackages=function(){var t={};t.url=p.HISIPINDENT.URL,t.requestData={operation:"savePackageBooking",messageId:"",destination:"com.napier.core.masters.service.external.PackageMasterService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ApplyPackageListVo",applyPackageVoList:[{"com.napier.core.scm.serviceposting.vo.ApplyPackageVo":e.getPackageAssignmentList()}]}},m.sendRestRequest(t).then(function(t){null!=t.data.HITService.message.errorCode&&2047==t.data.HITService.message.errorCode||2046==t.data.HITService.message.errorCode||11345==t.data.HITService.message.errorCode||60999==t.data.HITService.message.errorCode||33042==t.data.HITService.message.errorCode?(g.failure("Error",t.data.HITService.message.errorMessage),$(".overlay").hide()):t.data.HITService.message.applyPackageVoList?(g.success("success","Package Saved Successfully"),e.packageAssignmentArray=[]):(g.failure("Error","error occured"),$(".overlay").hide())},function(e){})},e.assignment.frmDate=new Date,e.getDurationDays=function(){var t=new Date,a=moment(t).format("DD-MM-YYYY"),i=moment(t).format("DD-MM-YYYY");if(a&&i){a=a.split("-"),i=i.split("-");var r=a[0]+"-"+a[1]+"-"+a[2].substr(0,2),n=i[0]+"-"+i[1]+"-"+i[2].substr(0,2),l=new Date(r),s=new Date(n);Math.abs(s.getTime()-l.getTime());e.assignment.diffDays=parseInt((s-l)/864e5),e.getPackageDays(e.assignment.pckgName.SERV_SEQ_ID)}},e.dateValidation=function(t){if(null!=e.totDays&&null!=e.totDays&&""!==e.totDays&&e.totDays>0){var a=new Date(t);a.setDate(a.getDate()+(e.totDays-1)),e.assignment.toDate=new Date(a)}},e.getPackageDays=function(t){e.bedDaysSendArray=[{paramName:"pServSeqId",value:t}],c.queryServiceMethod("BED_CLASSDAYS",e.bedDaysSendArray).then(function(t){t.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]instanceof Array?e.bedDaysResArray=t.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"][0].columnList[0]["com.napier.core.service.vo.query.Column"]:e.bedDaysResArray=t.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].columnList[0]["com.napier.core.service.vo.query.Column"],e.icuDays=e.bedDaysResArray[0].data,e.regDays=e.bedDaysResArray[1].data,e.preProcedure=e.bedDaysResArray[2].data,e.totDays=e.bedDaysResArray[3].data;let a=null!=e.assignment.frmDate&&null!=e.assignment.frmDate&&""!==e.assignment.frmDate?new Date(e.assignment.frmDate):new Date;e.dateValidation(a)},function(e){})},e.isCancelPkg=function(t,a){var i={buttonCallBack1:function(){},buttonCallBack2:function(){if(t.SP_SEQ_ID){var i={};i.url=p.HISIPINDENT.URL,i.requestData={operation:"cancelServicePosting",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingVo",servicePostingDetailsList:[{"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo":[{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",servicePostingSeqId:t.SP_SEQ_ID,cancelRequestedBy:angular.fromJson(sessionStorage.userContextObj).LOGIN_NAME,cancelRequestedRole:angular.fromJson(sessionStorage.userContextObj).LOGIN_NAME,encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:0,enProvider:0,enSpeciality:0,isAddendum:!1},servicePostingCacelReason:"cancel Package from assignment"}]}],entityXml:"testentityXml",packBookingCancelReason:"test CancelReason"}},m.sendRestRequest(i).then(function(t){t.data.HITService.message?(g.success("Success","Package Cancelled Successfully"),e.packageAssignmentArray.splice(a,1)):g.warning("Warning","Cancel Request Not processed")},function(e){})}else e.packageAssignmentArray.splice(a,1)},buttonClose:function(){}};g.hisAlertMulti("warning","Warning","Do You Want To Cancel?",{buttonText:"No",buttonText2:"Yes"},i,i)};var I={};I.primaryLimit={},I.departmentLimit={},I.specialityLimit={},I.serviceLimit={},sessionStorage.getItem("packageSeqId")&&(D.packageAssignmentArray=[{inclusionItems:[],data:[]}],e.assignPackageToPatient({SERV_SEQ_ID:parseInt(sessionStorage.getItem("packageSeqId"))})),D.close=function(){let e=i.getTop();i.dismiss(e.key)}}e.$inject=["$scope","hisTranslationsService","$uibModal","$uibModalStack","uiGridConstants","hisTranslationsGlobalLang","QueryService","PatientBannerBilling","PatientBannerGlobal","assignmentQueryService","PackageMasterService","IPINDENTAPIS","$filter","CallManager","hisAlertService","hisAlertConstants","GetDocumentCommon"],angular.module("napierContainerUi").controller("packageAssignmentController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u){var m=this;a.loadModule("billing");var g=i.getLanguageToSet();a.changeLanguage(g),m.comDateformat=angular.copy(u),m.format=m.comDateformat.uibDateOnly.format,m.validDateOptions={},m.alertObj={},r.loadAlerts(g).then(function(e){m.alertObj=e,m.alertData={buttonText:m.alertObj.ok},m.alertFunction={buttonCallBack1:function(){}},m.closefun={buttonClose:function(){}}}),m.popup1={opened:!1},m.open1=function(){m.popup1.opened=!0},c.put("ui-grid/selectionRowHeaderButtons",'<div class="ui-grid-selection-row-header-buttons " ng-class="{\'ui-grid-row-selected\': row.isSelected}" ><input style="margin: 0; vertical-align: middle" type="radio" ng-model="row.isSelected" ng-value=\'1\' ng-click="row.isSelected=!row.isSelected;selectButtonClick(row, $event)">&nbsp;</div>'),c.put("ui-grid/selectionSelectAllButtons",'<div class="ui-grid-selection-row-header-buttons " ng-class="{\'ui-grid-all-selected\': grid.selection.selectAll}" ng-if="grid.options.enableSelectAll"><input style="margin: 0; vertical-align: middle" type="radio" ng-model="grid.selection.selectAll" ng-click="grid.selection.selectAll=!grid.selection.selectAll;headerButtonClick($event)"></div>'),m.packOb={},m.packOb.status="1",m.selectedRecord=!0,m.packageAdvSrchGrid={enableHorizontalScrollbar:2,enableRowHeaderSelection:!0,multiSelect:!1,enableFullRowSelection:!1,columnDefs:[{name:"SERV_NAME",displayName:"Package Name"},{name:"INC_COMP_NAME",displayName:"Applicable Payer"},{name:"TOTAL_DAYS",displayName:"No of Days"},{name:"IS_PKG_START_BEFORE_OR_ON_ADMS",displayName:"Package Start"},{name:"EFFECTIVE_FROM",displayName:"Valid From",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.EFFECTIVE_FROM || "- -" |date:grid.appScope.pma.format + "&nbsp&nbsp" + "HH:mm:ss"}}</div>'},{name:"GN_STATUS",displayName:"Status",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.GN_STATUS==1?"Active":"Inactive"}}</div>'}]},m.packageAdvSrchGrid.onRegisterApi=function(t){m.gridApi=t,t.selection.on.rowSelectionChanged(e,function(e){m.selectService=m.gridApi.selection.getSelectedRows(),null!=m.selectService&&m.selectService.length>0?m.selectedRecord=!1:m.selectedRecord=!0}),t.selection.on.rowSelectionChangedBatch(e,function(e){m.selectService=m.gridApi.selection.getSelectedRows(),null!=m.selectBatchSelection&&m.selectService.length>0?m.selectedRecord=!1:m.selectedRecord=!0})},m.multipleChkDataForList={1:m.payerList=[]};var S=t.executeQueryURLReset();m.paramListArr=new Array,t.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,m.paramListArr),t.executeQueryInput("PACKAGE_APPLICABLE_PAYER_DROP_DOWN",m.paramListArr,m.multipleChkDataForList,!0,!0,S,"popUp",{}),m.searchResult=function(){if(p){if(p){m.multipleChkDataForList={1:m.packageSearchList=[]};e=t.executeQueryURLReset();m.paramListArr=new Array,t.executeQueryInput("PACKNAME_SEARCH_FOR_CLONE",m.paramListArr,m.multipleChkDataForList,!0,!0,e,"popUp",{}).then(function(e){})}}else{m.multipleChkDataForList={1:m.packageSearchList=[]};var e=t.executeQueryURLReset();m.paramListArr=new Array,t.prepareParamListWithParam("pServCode",null!=m.packOb.packageName&&""!==m.packOb.packageName?m.packOb.packageName:"",m.paramListArr),t.prepareParamListWithParam("pIncCompName",null!=m.packOb.applicablePayer&&""!==m.packOb.applicablePayer&&null!=m.packOb.applicablePayer.INC_SEQ_ID?m.packOb.applicablePayer.INC_SEQ_ID:-999,m.paramListArr),t.prepareParamListWithParam("pEffective_From",null!=m.packOb.validFrm&&""!==m.packOb.validFrm?o("date")(m.packOb.validFrm,"yyyy-MM-dd hh:mm:ss"):"1900-01-01 00:00:00.000",m.paramListArr),t.prepareParamListWithParam("pStatus",parseInt(m.packOb.status),m.paramListArr),t.executeQueryInput("PACKAGE_ADVANCE_SEARCH_DEATILS",m.paramListArr,m.multipleChkDataForList,!0,!0,e,"popUp",{}).then(function(e){m.packageAdvSrchGrid.data=m.packageSearchList})}},m.searchResult(),m.selectPackage=function(){null!=m.packOb.packageSlct&&null!=m.packOb.packageSlct.SERV_NAME||null!=m.selectService&&1==m.selectService.length?p?d.close(m.packOb.packageSlct):d.close(m.selectService[0]):n.information("Information","Please Select Any Record.",!1,!1,l.time)},m.clear=function(){m.packOb={},m.packOb.status="1",m.selectedRecord=!0,m.packageAdvSrchGrid.data=[]},m.selectPackageRslt=function(e){m.selectedPkg=e},m.savePackage=function(){d.close(m.selectedPkg)}}e.$inject=["$scope","QueryService","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","hisAlertConstants","CallManager","$filter","$templateCache","$uibModalInstance","flag","hisCalDefConstant"],angular.module("napierContainerUi").controller("packageMasterAdvSrchCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S){var v=this;a.loadModule("billing");var D=i.getLanguageToSet();a.changeLanguage(D),v.alertObj={},delete S.ngModelOptions.timezone,r.loadAlerts(D).then(function(e){v.alertObj=e,v.alertData={buttonText:v.alertObj.ok},v.alertFunction={buttonCallBack1:function(){}},v.closefun={buttonClose:function(){}}}),e.comDateformat=angular.copy(g),v.format=e.comDateformat.dateOnlySlash.format,v.validDateOptions={minDate:new Date},v.showPriGrpSrch=!0,v.treeViewData=[],v.treeViewDataRemove=[],v.departTreeListRemove=[],v.specltyTreeListRemove=[],v.srivceTreeListRemove=[],v.removeBedClassData=[],v.packageObj={},v.packageObj.packageCoverType="1",v.packageObj.gnStatus="1",v.packageObj.packageStart="2",v.packageObj.validFrm=new Date,v.bedCategoryList=[{CODE:1,DESCRIPTION:"ICU"},{CODE:2,DESCRIPTION:"NON-ICU"}],e.popup1={opened:!1},e.open1=function(){e.popup1.opened=!0},v.multipleDefaultList={1:v.selfTariff=[]};var y=t.executeQueryURLReset();function f(){v.multipleChkDataForList={1:v.bedClassList=[],2:v.primServGrupList=[],3:v.applicablePayerList=[],4:v.autoTriggerServiceList=[],5:v.materialSubCategory=[],6:v.packageNameList=[]};var e=t.executeQueryURLReset();v.tariffClsListArr=new Array,t.prepareParamListWithParam("@pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,v.tariffClsListArr),t.executeQueryInput("SP_USP_BL_GET_TARIFF_CLASS",v.tariffClsListArr,v.multipleChkDataForList,!0,!1,e,"popUp",{}),v.priServGrpListArr=new Array,t.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,v.priServGrpListArr),t.executeQueryInput("SCM_SERV_002_SCM_1",v.priServGrpListArr,v.multipleChkDataForList,!0,!1,e,"popUp",{}),v.emptyParamArr=new Array,t.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,v.emptyParamArr),t.executeQueryInput("PACKAGE_APPLICABLE_PAYER_DROP_DOWN",v.emptyParamArr,v.multipleChkDataForList,!0,!1,e,"popUp",{}),t.executeQueryInput("PACKAGE_AUTO_TRIGGER_SERVICE_DROP_DOWN",v.emptyParamArr,v.multipleChkDataForList,!0,!1,e,"popUp",{}),v.mtrlSubCatArray=new Array,t.prepareParamListWithParam("pCatSeqId",1,v.mtrlSubCatArray),t.executeQueryInput("FETCH_MAT_SUB_CATEGORY",v.mtrlSubCatArray,v.multipleChkDataForList,!0,!1,e,"popUp",{}),v.tariffClsListArr=new Array,t.prepareParamListWithParam("pType",1,v.tariffClsListArr),t.executeQueryInput("PACKNAME_DROPDOWN",v.tariffClsListArr,v.multipleChkDataForList,!0,!0,e,"popUp",{}).then(function(e){v.tempListApplPyr=angular.copy(v.applicablePayerList),v.tempAutoTriggerList=angular.copy(v.autoTriggerServiceList);for(let e=0;e<v.materialSubCategory.length;e++)3!=v.materialSubCategory[e].METERIAL_CATID&&4!=v.materialSubCategory[e].METERIAL_CATID||v.primServGrupList.push({CODE:v.materialSubCategory[e].METERIAL_CATID,DESCRIPTION:v.materialSubCategory[e].CATEGORY,METERIAL_CATG:!0})})}function C(e,t){for(let a=1;v.bedClassGrid.data.length>a;a++){let i=v.bedClassGrid.data[a].bedClass.CODE;parseFloat(e)>parseFloat(100)?t.entity[i]=100:t.entity[i]=e}}v.emptyDefaultArr=new Array,t.executeQueryInput("PACKAGE_TARIFF_CATEGORY_SELF",v.emptyDefaultArr,v.multipleDefaultList,!0,!0,y,"popUp",{}),f(),v.getDepartmentListData=function(e,a){if(null!=e&&""!==e&&null!=e.CODE&&null!=e.CODE&&!e.METERIAL_CATG&&!e.isMaterial){v.multipleDataList={1:v.departList=[]};let i=t.executeQueryURLReset();return v.departListArr=new Array,t.prepareParamListWithParam("pServSeqId",e.CODE,v.departListArr),t.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,v.departListArr),t.prepareParamListWithParam("pFactilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,v.departListArr),t.prepareParamListWithParam("pDepDes",null!=a&&null!=a?"%"+a+"%":"%%",v.departListArr),t.prepareParamListWithParam("pDepCode",null!=a&&null!=a?"%"+a+"%":"%%",v.departListArr),t.executeQueryInput("LBMAQS054_NEW_PACKAGE",v.departListArr,v.multipleDataList,!0,!0,i,"popUp",{}).then(function(t){var a=t[1]instanceof Array?t[1]:[t[1]];return 10006==e.CODE?v.bedCategoryList:a})}if(null!=e&&""!==e&&null!=e.CODE&&null!=e.CODE&&(e.METERIAL_CATG||e.isMaterial)){v.multipleDataList={1:v.departList=[]};let a=t.executeQueryURLReset();return v.departListArr=new Array,t.prepareParamListWithParam("pMetSubCatSeqId",e.CODE,v.departListArr),t.executeQueryInput("FETCH_MAT_GROUP",v.departListArr,v.multipleDataList,!0,!0,a,"popUp",{}).then(function(e){return e[1]instanceof Array?e[1]:[e[1]]})}},v.getSpeciltyListData=function(e,a){if(null!=e&&""!==e&&null!=e.CODE&&null!=e.CODE&&null==e.METERIAL_CATID&&!e.isMaterial){v.multipleSpDataList={1:v.specailtyList=[]};let i=t.executeQueryURLReset();return v.specailtyListArr=new Array,t.prepareParamList(1,e.CODE,v.specailtyListArr),t.prepareParamList(2,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,v.specailtyListArr),t.prepareParamList(3,null!=a&&null!=a?"%"+a+"%":"%%",v.specailtyListArr),t.prepareParamList(4,null!=a&&null!=a?"%"+a+"%":"%%",v.specailtyListArr),t.prepareParamList(5,null!=a&&null!=a?"%"+a+"%":"%%",v.specailtyListArr),t.prepareParamList(6,null!=a&&null!=a?"%"+a+"%":"%%",v.specailtyListArr),t.executeQueryInput("GET_DEPT_SPECIALITY_SERCH_NEW_PACKAGE",v.specailtyListArr,v.multipleSpDataList,!0,!0,i,"popUp",{}).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})}if(null!=e&&""!==e&&null!=e.CODE&&null!=e.CODE&&(null!=e.METERIAL_CATID||e.isMaterial)){v.multipleSpDataList={1:v.specailtyList=[]};let a=t.executeQueryURLReset();return v.specailtyListArr=new Array,t.prepareParamListWithParam("pMetMainCatSeqId",e.CODE,v.specailtyListArr),t.executeQueryInput("FETCH_MAT_SUB_GROUP",v.specailtyListArr,v.multipleSpDataList,!0,!0,a,"popUp",{}).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})}},v.getServiceList=function(e,a){if(!e.primaryGrpSrchObj.METERIAL_CATG&&!e.primaryGrpSrchObj.isMaterial){e.serviceListData=[];let i={1:e.serviceListData},r=t.executeQueryURLReset(),n=new Array;return t.prepareParamListWithParam("pPSG_CODE",null!=e.primaryGrpSrchObj&&null!=e.primaryGrpSrchObj.CODE?e.primaryGrpSrchObj.CODE:-999,n),t.prepareParamListWithParam("pDEPT_CODE",null!=e.departSrchObj&&null!=e.departSrchObj.CODE?e.departSrchObj.CODE:-999,n),t.prepareParamListWithParam("pSPECL_CODE",null!=e.speaciltySrchObj&&null!=e.speaciltySrchObj.CODE?e.speaciltySrchObj.CODE:-999,n),t.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n),t.prepareParamListWithParam("pSERV_NAME",null!=a&&null!=a?a:"",n),t.prepareParamListWithParam("pGN_FLOW",1,n),t.executeQueryInput("BL_GET_SERVICE_SEARCH_SP",n,i,!0,!0,r,"popUp",{}).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})}if(e.primaryGrpSrchObj.METERIAL_CATG||e.primaryGrpSrchObj.isMaterial){e.serviceListData=[];let i={1:e.serviceListData},r=t.executeQueryURLReset(),n=new Array;return t.prepareParamListWithParam("pMaterialCat",null!=e.primaryGrpSrchObj&&null!=e.primaryGrpSrchObj.CODE?e.primaryGrpSrchObj.CODE:-999,n),t.prepareParamListWithParam("pMaterialGroup",null!=e.departSrchObj&&null!=e.departSrchObj.CODE?e.departSrchObj.CODE:-999,n),t.prepareParamListWithParam("pMaterialSubGroup",null!=e.speaciltySrchObj&&null!=e.speaciltySrchObj.CODE?e.speaciltySrchObj.CODE:-999,n),t.prepareParamListWithParam("pMatCodeName",null!=a&&null!=a?a:"",n),t.executeQueryInput("PACKAGE_MATERIAL_DETAILS",n,i,!0,!0,r,"popUp",{}).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})}},v.getMaterailGroupListData=function(e){if(null!=e&&""!==e&&null!=e.CODE&&null!=e.CODE){v.multipleSpDataList={1:v.specailtyList=[]};var a=t.executeQueryURLReset();return v.specailtyListArr=new Array,t.prepareParamListWithParam("pMetSubCatSeqId",e.CODE,v.specailtyListArr),t.executeQueryInput("FETCH_MAT_GROUP",v.specailtyListArr,v.multipleSpDataList,!0,!0,a,"popUp",{}).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})}},v.getMaterailSubGroupListData=function(e){if(null!=e&&""!==e&&null!=e.CODE&&null!=e.CODE){v.multipleSpDataList={1:v.specailtyList=[]};var a=t.executeQueryURLReset();return v.specailtyListArr=new Array,t.prepareParamListWithParam("pMetMainCatSeqId",e.CODE,v.specailtyListArr),t.executeQueryInput("FETCH_MAT_SUB_GROUP",v.specailtyListArr,v.multipleSpDataList,!0,!0,a,"popUp",{}).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})}},v.applicablePayerChange=function(){if(null!=v.packageObj.applicablePayer&&null!=v.packageObj.applicablePayer){let e=v.packageObj.applicablePayer instanceof Array?v.packageObj.applicablePayer:[v.packageObj.applicablePayer],t=[];if(e.length>0){for(let a=0;a<v.applicablePayerList.length;a++)e[0].TARIFF_SEQ_ID==v.applicablePayerList[a].TARIFF_SEQ_ID&&t.push(v.applicablePayerList[a]);v.applicablePayerList=t}else v.applicablePayerList=v.tempListApplPyr}else v.applicablePayerList=v.tempListApplPyr},v.bedClassGrid={enableHorizontalScrollbar:0,columnDefs:[{name:"bedClass",displayName:"Bed Class",cellTemplate:'<div class="ui-grid-cell-contents action-row"><div class="" ng-if="row.entity.isFirstrow"><select class="form-control" ng-model="row.entity.bedClass" ng-options="item as item.DESCRIPTION for item in grid.appScope.pm.bedClassList"><option value="" selected>Select</option></select></div><div ng-if="!row.entity.isFirstrow">{{row.entity.bedClass.DESCRIPTION}}</div></div>'},{name:"amount",displayName:"Amount",cellTemplate:'<div class="ui-grid-cell-contents action-row"><div class="" ng-if="row.entity.isFirstrow"><input type="text" class="form-control" ng-model="row.entity.amount" numbers-with-decimal></div><div ng-if="!row.entity.isFirstrow">{{row.entity.amount}}</div></div>'},{name:"actions",displayName:"Actions",cellTemplate:'<div class="ui-grid-cell-contents action-row"><button ng-if="row.entity.isFirstrow" class="his-btn his-btn-info his-grid-btn" ng-click="grid.appScope.pm.addBedClass(row.entity)"><i class="fa fa-plus" ng-if="!row.entity.isUpdate&&row.entity.isFirstrow"></i><i class="fa fa-check" ng-if="row.entity.isUpdate&&row.entity.isFirstrow"></i></button><div ng-if="!row.entity.isFirstrow"><i class="fa fa-pencil" ng-click="grid.appScope.pm.editBedClass(row.entity,rowRenderIndex)"></i><i class="fa fa-trash" ng-click="grid.appScope.pm.deleteBedClass(row.entity,rowRenderIndex)"></i></div></div>'}]},v.bedClassGrid.data=[{isFirstrow:!0}],v.addBedClass=function(e){if(e.bedClass.CODE&&e.amount)if(e.isUpdate){if(e.isUpdate){let t=angular.copy(e);t.isFirstrow=!1,t.isUpdate=!1,v.addRmovColumnCoverGrid(v.bedClassGrid.data[v.updateRowIndex],!0),v.bedClassGrid.data[v.updateRowIndex]=t,v.bedClassGrid.data[0]={isFirstrow:!0},v.addRmovColumnCoverGrid(v.bedClassGrid.data[v.updateRowIndex])}}else{let t=angular.copy(e),a=!1;angular.forEach(v.bedClassGrid.data,function(t,i){if(0!=i&&null!=t.bedClass&&null!=t.bedClass.CODE&&t.bedClass.CODE==e.bedClass.CODE)return a=!0,!0}),a||(t.isFirstrow=!1,v.bedClassGrid.data.push(t),v.bedClassGrid.data[0]={isFirstrow:!0},v.addRmovColumnCoverGrid(t))}},v.editBedClass=function(e,a){let i=angular.copy(e);i.isFirstrow=!0,i.isUpdate=!0,v.bedClassGrid.data[0]=i,v.bedClassGrid.data[0].bedClass=t.getObjectByAnyValue(v.bedClassList,i.bedClass.CODE,"CODE"),v.updateRowIndex=a},v.deleteBedClass=function(e,t){var a={buttonCallBack1:function(){},buttonCallBack2:function(){v.updateRowIndex=void 0,v.addRmovColumnCoverGrid(e,!0),null!=e.cslBedSeqId&&v.removeBedClassData.push(e),v.bedClassGrid.data.splice(t,1)},buttonClose:function(){}};n.hisAlertMulti("warning","Warning","Do You Want To Delete?",{buttonText:"No",buttonText2:"Yes"},a,a)},v.openAdvanceSrch=function(){c.open("PACKAGE SEARCH",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/packageMaster/package.master.advanceSrch.screen.html",size:"lg",controller:"packageMasterAdvSrchCtrl",controllerAs:"pma",keyboard:!1,backdrop:"static",resolve:{flag:!1}}).result.then(function(e){null!=e&&""!==e&&(v.packageNameObj=e,v.selectPackageRslt(v.packageNameObj))})},v.packageIncExcGrid=angular.copy(u),v.packageIncExcGrid.onRegisterApi=function(e){v.gridApi=e},v.packageIncExcGrid.data=[],v.changeBedAmt=function(e,t,a){if(null!=e&&null!=e&&""!==e)return 2==t.amtNlPer&&C(e,a),2==t.amtNlPer&&parseFloat(e)>parseFloat(100)?100:0==e?void 0:e;2==t.amtNlPer&&C(e,a)},v.addRmovColumnCoverGrid=function(e,t){var a={name:e.bedClass.CODE+"",displayName:e.bedClass.DESCRIPTION,cellTemplate:'<div class="ui-grid-cell-contents action-row"><div class="" ng-if="row.entity.amtNlPer!=3"><input type="text" class="form-control" ng-if="grid.appScope.pm.packageObj.packageCoverType==1" ng-model="MODEL_COL_FIELD" ng-change="MODEL_COL_FIELD=grid.appScope.pm.changeBedAmt(MODEL_COL_FIELD,row.entity,row)" numbers-with-decimal></div><span ng-if="row.entity.amtNlPer==3&&grid.appScope.pm.packageObj.packageCoverType==1">N/L</span></div>'};if(t){for(var i=0;i<v.packageIncExcGrid.columnDefs.length;i++)if(v.packageIncExcGrid.columnDefs[i].name==e.bedClass.CODE){v.packageIncExcGrid.columnDefs.splice(i,1);break}}else v.packageIncExcGrid.columnDefs.splice(v.packageIncExcGrid.columnDefs.length-1,0,a)},v.selectSrchResult=function(e,t){let a=!0;null==v.packageIncExcGrid.data&&(v.packageIncExcGrid.data=[]);for(let t=0;t<v.packageIncExcGrid.data.length;t++)if(null!=e.CODE&&v.packageIncExcGrid.data[t].srchObj.CODE==e.CODE||null!=e.SERV_SEQ_ID&&v.packageIncExcGrid.data[t].srchObj.SERV_SEQ_ID==e.SERV_SEQ_ID){a=!1,n.information("Information","Already Same Record Exist.",!1,!1,l.time);break}if(a){let t={srchObj:e,isMaterial:3==e.CODE||4==e.CODE||null!=e.METERIAL_CATID||null!=e.MTRL_MAIN_GRP_CODE||1==(null!=v.primaryGrpSrchObj&&v.primaryGrpSrchObj.isMaterial)};v.selectedPrimApplicabily&&(t.applicability=v.selectedPrimApplicabily),v.packageIncExcGrid.data.push(t)}"Pri"==t?v.primaryGrpSrchObj=void 0:"Depart"==t?v.departSrchObj=void 0:"Specialty"==t?v.speaciltySrchObj=void 0:"Service"==t&&(v.serviceSrchObj=void 0)},v.addToTreeView=function(){if(1==v.packageObj.packageCoverType)for(let e=0;e<v.packageIncExcGrid.data.length;e++){if(null==v.packageIncExcGrid.data[e].applicability||""===v.packageIncExcGrid.data[e].applicability)return n.information("Information","Please Select Applicability Value"),!1;if(null==v.packageIncExcGrid.data[e].amtNlPer||""===v.packageIncExcGrid.data[e].amtNlPer)return n.information("Information","Please Select Amount Type"),!1;if(1==v.packageIncExcGrid.data[e].amtNlPer)for(let t=1;v.bedClassGrid.data.length>t;t++){let a=v.bedClassGrid.data[t].bedClass.CODE;if(""==v.packageIncExcGrid.data[e][a]||null==v.packageIncExcGrid.data[e][a])return n.information("Information","Please Enter Bed Class Amount"),!1}}v.packageIncExcGrid.data[0].packageCoverType=angular.copy(v.packageObj.packageCoverType),v.showDepartSrch?(v.packageIncExcGrid.data[0].childDisabled=!0,v.treeViewData[v.treePriIndex].departTreeList=[],v.treeViewData[v.treePriIndex].departTreeList=angular.copy(v.packageIncExcGrid.data)):v.showSpecailtySrch?(v.packageIncExcGrid.data[0].childDisabled=!0,v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex].specltyTreeList=[],v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex].specltyTreeList=angular.copy(v.packageIncExcGrid.data)):v.showServiceSrch?(v.packageIncExcGrid.data[0].childDisabled=!0,10012==v.primaryGrpSrchObj.CODE?(v.treeViewData[v.treePriIndex].srivceTreeList=[],v.treeViewData[v.treePriIndex].srivceTreeList=angular.copy(v.packageIncExcGrid.data)):10021==v.primaryGrpSrchObj.CODE?(v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex].srivceTreeList=[],v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex].srivceTreeList=angular.copy(v.packageIncExcGrid.data)):(v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex].specltyTreeList[v.treeSpecltyIndex].srivceTreeList=[],v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex].specltyTreeList[v.treeSpecltyIndex].srivceTreeList=angular.copy(v.packageIncExcGrid.data))):v.treeViewData=angular.copy(v.packageIncExcGrid.data),v.packageIncExcGrid.data=[],v.packageObj.packageName=void 0,v.showPriGrpSrch=!0,v.showDepartSrch=!1,v.showSpecailtySrch=!1,v.showServiceSrch=!1,v.primaryGrpSrchObj=void 0,v.departSrchObj=void 0,v.speaciltySrchObj=void 0,v.serviceSrchObj=void 0,v.packageObj.updateIncExc=!1},v.removeIncExcRcrd=function(e,t){var a={buttonCallBack1:function(){},buttonCallBack2:function(){e.packageCoverType=v.packageObj.packageCoverType,v.showDepartSrch?(v.departTreeListRemove.push(angular.copy(e)),null!=v.treeViewData[v.treePriIndex]&&null!=v.treeViewData[v.treePriIndex].departTreeList&&v.treeViewData[v.treePriIndex].departTreeList.splice(t,1)):v.showSpecailtySrch?(v.specltyTreeListRemove.push(angular.copy(e)),null!=v.treeViewData[v.treePriIndex]&&null!=v.treeViewData[v.treePriIndex].departTreeList&&null!=v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex].specltyTreeList&&v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex].specltyTreeList.splice(t,1)):v.showServiceSrch?(v.srivceTreeListRemove.push(angular.copy(e)),null!=v.treeViewData[v.treePriIndex]&&null!=v.treeViewData[v.treePriIndex].departTreeList&&null!=v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex]&&null!=v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex].specltyTreeList?v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex].specltyTreeList[v.treeSpecltyIndex].srivceTreeList.splice(t,1):null!=v.treeViewData[v.treePriIndex]&&null!=v.treeViewData[v.treePriIndex].departTreeList?v.treeViewData[v.treePriIndex].departTreeList[v.treeDepartIndex].specltyTreeList[v.treeSpecltyIndex].srivceTreeList.splice(t,1):null!=v.treeViewData[v.treePriIndex]&&null!=v.treeViewData[v.treePriIndex].srivceTreeList&&v.treeViewData[v.treePriIndex].srivceTreeList.splice(t,1)):(v.treeViewDataRemove.push(angular.copy(e)),null!=v.treeViewData&&v.treeViewData.splice(t,1)),v.packageIncExcGrid.data.splice(t,1)},buttonClose:function(){}};n.hisAlertMulti("warning","Warning","Do You Want To Delete?",{buttonText:"No",buttonText2:"Yes"},a,a)},v.addPriServiceGrup=function(){v.bedClassGrid.data.length>1?(v.showPriGrpSrch=!0,v.showDepartSrch=!1,v.showSpecailtySrch=!1,v.showServiceSrch=!1,v.primaryGrpSrchObj=void 0,v.departSrchObj=void 0,v.speaciltySrchObj=void 0,v.serviceSrchObj=void 0,v.packageObj.packageName=v.packageObj.packageTreeName,v.packageObj.updateIncExc=!1,v.packageIncExcGrid.columnDefs[0].displayName="Primary Service Group",v.gridApi.grid.notifyDataChange(p.dataChange.ALL),null!=v.treeViewData&&v.treeViewData.length>0&&(v.packageObj.updateIncExc=!0,v.packageIncExcGrid.data=angular.copy(v.treeViewData),v.packageObj.packageCoverType=v.treeViewData[0].packageCoverType+"")):n.warning("Warning","Atleast add one BED Class.",!1,!1,l.time)},v.addDepartment=function(e,t){v.bedClassGrid.data.length>1?10018==e.srchObj.CODE||10023==e.srchObj.CODE||10004==e.srchObj.CODE||10030==e.srchObj.CODE||10003==e.srchObj.CODE?v.packageIncExcGrid.data=[]:10012==e.srchObj.CODE?v.addService(e,t):(v.showPriGrpSrch=!1,v.showDepartSrch=!0,v.showSpecailtySrch=!1,v.showServiceSrch=!1,v.primaryGrpSrchObj=e.srchObj,v.primaryGrpSrchObj.isMaterial=e.isMaterial,v.treePriIndex=t,v.departSrchObj=void 0,v.packageObj.packageName=e.srchObj.DESCRIPTION,v.packageIncExcGrid.columnDefs[0].displayName=e.isMaterial?"Material Main Group":10006==e.srchObj.CODE?"Bed Category":"Department",v.selectedPrimApplicabily=e.applicability,v.packageObj.updateIncExc=!1,v.gridApi.grid.notifyDataChange(p.dataChange.ALL),null!=e.departTreeList&&e.departTreeList.length>0?(v.packageIncExcGrid.data=angular.copy(e.departTreeList),v.packageObj.updateIncExc=!0,v.packageObj.packageCoverType=e.departTreeList[0].packageCoverType+""):10006==e.srchObj.CODE?(v.packageIncExcGrid.data=[],v.packageIncExcGrid.data.push({isMaterial:!1,packageCoverType:e.packageCoverType,srchObj:{CODE:1,DESCRIPTION:"ICU"}}),v.packageIncExcGrid.data.push({isMaterial:!1,packageCoverType:e.packageCoverType,srchObj:{CODE:2,DESCRIPTION:"NON-ICU"}})):v.packageIncExcGrid.data=[]):n.warning("Warning","Atleast add one BED Class.",!1,!1,l.time)},v.addSpecialty=function(e,t,a){v.bedClassGrid.data.length>1?10006==v.treeViewData[t].srchObj.CODE?v.packageIncExcGrid.data=[]:10021==e.srchObj.CODE?v.addService(e,a):(v.showPriGrpSrch=!1,v.showDepartSrch=!1,v.showSpecailtySrch=!0,v.showServiceSrch=!1,v.departSrchObj=e.srchObj,v.departSrchObj.isMaterial=e.isMaterial,v.speaciltySrchObj=void 0,v.treePriIndex=t,v.treeDepartIndex=a,v.packageObj.packageName=e.srchObj.DESCRIPTION,v.packageIncExcGrid.columnDefs[0].displayName=e.isMaterial?"Material Sub Group":"Specialty",v.packageObj.updateIncExc=!1,v.selectedPrimApplicabily=v.treeViewData[t].applicability,v.gridApi.grid.notifyDataChange(p.dataChange.ALL),null!=e.specltyTreeList&&e.specltyTreeList.length>0?(v.packageIncExcGrid.data=angular.copy(e.specltyTreeList),v.packageObj.updateIncExc=!0,v.packageObj.packageCoverType=e.specltyTreeList[0].packageCoverType+""):v.packageIncExcGrid.data=[]):n.warning("Warning","Atleast add one BED Class.",!1,!1,l.time)},v.addService=function(e,t,a,i){v.bedClassGrid.data.length>1?10008==v.treeViewData[t].srchObj.CODE?(v.packageObj.packageName=void 0,v.packageIncExcGrid.data=[]):(v.showPriGrpSrch=!1,v.showDepartSrch=!1,v.showSpecailtySrch=!1,v.showServiceSrch=!0,v.primaryGrpSrchObj=v.treeViewData[t].srchObj,v.primaryGrpSrchObj.isMaterial=v.treeViewData[t].isMaterial,v.departSrchObj=null!=v.treeViewData[t].departTreeList?v.treeViewData[t].departTreeList[a].srchObj:void 0,null!=v.departSrchObj&&(v.departSrchObj.isMaterial=null!=v.treeViewData[t].departTreeList?v.treeViewData[t].departTreeList[a].isMaterial:void 0),null!=v.treeViewData[t].departTreeList&&null!=v.treeViewData[t].departTreeList[a]&&null!=v.treeViewData[t].departTreeList[a].specltyTreeList&&(v.speaciltySrchObj=e.srchObj,v.speaciltySrchObj.isMaterial=e.isMaterial),v.treePriIndex=t,v.treeDepartIndex=a,v.treeSpecltyIndex=i,v.packageObj.packageName=e.srchObj.DESCRIPTION,v.serviceSrchObj=void 0,v.packageIncExcGrid.columnDefs[0].displayName=v.treeViewData[t].isMaterial?"Material":"Service",v.selectedPrimApplicabily=v.treeViewData[t].applicability,v.packageObj.updateIncExc=!1,v.gridApi.grid.notifyDataChange(p.dataChange.ALL),null!=e.srivceTreeList&&e.srivceTreeList.length>0?(v.packageIncExcGrid.data=angular.copy(e.srivceTreeList),v.packageObj.updateIncExc=!0,v.packageObj.packageCoverType=e.srivceTreeList[0].packageCoverType+""):v.packageIncExcGrid.data=[]):n.warning("Warning","Atleast add one BED Class.",!1,!1,l.time)},v.addActiveToggle=function(e){angular.element(e.currentTarget).toggleClass("caret-down"),angular.element(angular.element(e.currentTarget).parent().children()[2]).toggleClass("active")},v.scriptOnClick=function(e,t){},v.changeCoverType=function(){},v.selectPackageRslt=function(e){v.packageIncExcGrid=angular.copy(u),v.bedClassGrid.data=[],v.clearPackageMaster(!0),null!=e.SERV_SEQ_ID&&(v.packageObj.packageTreeName=e.SERV_NAME,d.getPackageHeaderDetails(e).then(function(e){null!=e&&null!=e&&null!=e[1]&&null!=e[1]&&null!=e[1][0]&&null!=e[1][0]?(v.packageIncExcGrid=angular.copy(u),v.packageObj.packageDays=e[1][0].TOTAL_DAYS,v.packageObj.packageStart=e[1][0].IS_PKG_START_BEFORE_OR_ON_ADMS+"",v.packageObj.packageStartBeforeDays=e[1][0].PRE_PROC_DAYS,null!=e[1][0].EFFECTIVE_FROM&&(v.packageObj.validFrm=new Date(e[1][0].EFFECTIVE_FROM)),v.packageObj.gnStatus=e[1][0].GN_STATUS+"",v.packageObj.cslSeqId=e[1][0].CSL_SEQ_ID,null!=e[1][0].IS_DRAFT&&2!=e[1][0].IS_DRAFT||(v.packageObj.disableDraft=!0),null!=e[1][0].IS_PKG_START_BEFORE_OR_ON_ADMS&&(v.packageObj.enableClone=!0),d.getPackageAutoServiceData(e[1][0],v),d.getPackageBedClassDetails(e[1][0],v),d.getPackageApplicablePayerDetails(e[1][0],v),1==e[1][0].IS_DRAFT?v.updateFlag=!1:v.updateFlag=!0):f()}),d.getPackageIncExcDetails(e,v))},v.clearPackageMaster=function(e){v.packageObj={},e||(v.packageNameObj=null),v.packageObj.packageStart="2",v.packageObj.gnStatus="1",v.packageObj.packageCoverType="1",v.packageObj.validFrm=new Date,v.packageObj.clonePackage=!1,v.updateFlag=!1,v.treeViewData=[],v.primaryGrpSrchObj=void 0,v.departSrchObj=void 0,v.speaciltySrchObj=void 0,v.serviceSrchObj=void 0,v.bedClassGrid.data=[],v.packageIncExcGrid.data=[],v.bedClassGrid.data=[{isFirstrow:!0}],v.updateRowIndex=void 0,v.selectedPrimApplicabily=void 0,e||f()},v.getBedClassListPrepare=function(e,t){let a=[];for(let i=0;i<v.bedClassLinkArr.length;i++)a.push({"@class":e.isMaterial?"com.napier.core.masters.vo.MtrlPackBedClassLimitVo":"com.napier.core.masters.vo.BedClassLimitVo",sbclimitSeqId:e.isMaterial?void 0:v.packageObj.clonePackage?void 0:e["sbclimitSeqId"+v.bedClassLinkArr[i].bedClassSeqId],materialSeqId:e.isMaterial?null==e.srchObj.CODE?e.srchObj.SERV_SEQ_ID:e.srchObj.CODE:void 0,mbclimitSeqId:e.isMaterial?v.packageObj.clonePackage?void 0:e["sbclimitSeqId"+v.bedClassLinkArr[i].bedClassSeqId]:void 0,bedClassSeqId:v.bedClassLinkArr[i].bedClassSeqId,limit:null!=e.quantity&&""!==e.quantity?parseInt(e.quantity):void 0,amount:e[v.bedClassLinkArr[i].bedClassSeqId]&&3!=parseInt(e.amtNlPer)?parseFloat(e[v.bedClassLinkArr[i].bedClassSeqId+""]):void 0,inclusionType:parseInt(e.amtNlPer),gnTranStatus:t?2:1}),e.materialFlag&&(a.materialSeqId=e.srchObj.SERV_SEQ_ID);return a},v.hierarchyLevelAddYFlag=function(e){var t="",a=0,i=0;return angular.forEach(e,function(r,n){if(0!=i&&t!=r.priServTypCode&&(a=r.serHierarchyLevel),t=r.priServTypCode,0==i&&(a=r.serHierarchyLevel),t==r.priServTypCode&&1==r.serHierarchyLevel&&(r.inclusionApply="Y"),t==r.priServTypCode&&2==r.serHierarchyLevel){let t=n-1;a!=r.serHierarchyLevel&&(e[t].serHierarchyLevel<=r.serHierarchyLevel&&-1!=t&&delete e[t].inclusionApply,a=r.serHierarchyLevel),r.inclusionApply="Y"}if(t==r.priServTypCode&&3==r.serHierarchyLevel){let t=n-1;a!=r.serHierarchyLevel&&(e[t].serHierarchyLevel<=r.serHierarchyLevel&&-1!=t&&delete e[t].inclusionApply,a=r.serHierarchyLevel),r.inclusionApply="Y"}if(t==r.priServTypCode&&4==r.serHierarchyLevel){let t=n-1;a!=r.serHierarchyLevel&&(-1!=t&&delete e[t].inclusionApply,a=r.serHierarchyLevel),r.inclusionApply="Y"}i++}),e},v.checkBedClassVld=function(){return!(null!=v.treeViewData&&v.treeViewData.length>0)||v.bedClassGrid.data.length>1},v.savePackageMaster=function(){if(v.packageObj.isDraft||null!=v.packageNameObj&&null!=v.packageNameObj&&null!=v.packageNameObj.SERV_SEQ_ID&&(!v.packageObj.selfFlag&&null!=v.packageObj.applicablePayer&&null!=v.packageObj.applicablePayer&&""!==v.packageObj.applicablePayer&&0!=v.packageObj.applicablePayer.length||v.packageObj.selfFlag)&&null!=v.packageObj.packageDays&&null!=v.packageObj.packageDays&&""!==v.packageObj.packageDays&&null!=v.packageObj.validFrm&&null!=v.packageObj.validFrm&&""!==v.packageObj.validFrm&&(1==v.packageObj.packageStart&&null!=v.packageObj.packageStartBeforeDays&&null!=v.packageObj.packageStartBeforeDays&&""!==v.packageObj.packageStartBeforeDays||2==v.packageObj.packageStart)){if(!v.checkBedClassVld())return n.information("Information","Please Add Atleast One Bed Class Amount"),!1;m.prepareSaveRequestForPackage(v);var e=v.hierarchyLevelAddYFlag(v.servInclusionArr),t=v.hierarchyLevelAddYFlag(v.servExculsiveArr),a=v.hierarchyLevelAddYFlag(v.servInclusionMaterrialArr),i=v.hierarchyLevelAddYFlag(v.servExculsiveMaterrialArr),r={url:"HISServices/PackageMasterService"};r.requestData={operation:"savePackageMaster",destination:"com.napier.core.masters.service.external.PackageMasterService",message:{"@class":"com.napier.core.masters.vo.ServiceVo",gnTranStatus:parseInt(v.packageObj.gnStatus),facilitySeqId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,servName:v.packageNameObj.SERV_NAME,servSeqId:v.packageNameObj.SERV_SEQ_ID,packageType:1,compositeServiceLimitVoList:[{"com.napier.core.masters.vo.CompositeServiceLimitVo":[{preProcDays:1==v.packageObj.packageStart?parseInt(v.packageObj.packageStartBeforeDays):void 0,isBeforeOrOnAdmission:parseInt(v.packageObj.packageStart),totalDays:null!=v.packageObj.packageDays&&null!=v.packageObj.packageDays&&""!==v.packageObj.packageDays?parseInt(v.packageObj.packageDays):void 0,effectiveFrom:null!=v.packageObj.validFrm&&null!=v.packageObj.validFrm&&""!==v.packageObj.validFrm?o("date")(v.packageObj.validFrm,"yyyy-MM-dd")+"T00:00:00.001Z":void 0,cslSeqId:v.packageObj.clonePackage?void 0:v.packageObj.cslSeqId,isDraft:v.packageObj.isDraft?1:2}]}],packageLimitPayerLinkVoList:[{"com.napier.core.masters.vo.PackageLimitPayerLinkVo":v.applicablePayerArr}],packageLimitServiceAutoTriggerLinkVoList:[{"com.napier.core.masters.vo.PackageLimitServiceAutoTriggerLinkVo":v.autoTriggerArr}],packageLimitBedClassLinkVoList:[{"com.napier.core.masters.vo.PackageLimitBedClassLinkVo":v.bedClassLinkArr}]}},null!=e&&e.length>0&&(r.requestData.message.compositeIncludeServiceVoList=[{"com.napier.core.masters.vo.CompositeIncludeServiceVo":e}]),null!=a&&a.length>0&&(r.requestData.message.compositeServiceIncludeMaterialVoList=[{"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo":a}]),null!=t&&t.length>0&&(r.requestData.message.compositeExculdeServiceVoList=[{"com.napier.core.masters.vo.CompositeExculdeServiceVo":t}]),null!=i&&i.length>0&&(r.requestData.message.compositeServiceExcludeMaterialVoList=[{"com.napier.core.masters.vo.CompositeServiceExcludeMaterialVo":i}]),s.sendRestRequest(r).then(function(e){if(null!=e.data.HITService&&null!=e.data.HITService.message&&null!=e.data.HITService.message.servSeqId&&null!=e.data.HITService.message.servSeqId&&""!==e.data.HITService.message.servSeqId){v.clearPackageMaster();let e="Package Saved Successfully";v.updateFlag&&(e="Package Update Successfully"),v.packageObj.isDraft&&(e="Package Saved Draft Successfully"),n.success("success",e)}})}else n.information("Information","Please Fill All Mandatory fields")},v.saveDraft=function(){v.packageObj.isDraft=!0,v.savePackageMaster()},v.saveAsClonePackage=function(){if(null!=v.packageNameObj&&null!=v.packageNameObj&&null!=v.packageNameObj.SERV_SEQ_ID&&(!v.packageObj.selfFlag&&null!=v.packageObj.applicablePayer&&null!=v.packageObj.applicablePayer&&""!==v.packageObj.applicablePayer||v.packageObj.selfFlag)&&null!=v.packageObj.packageDays&&null!=v.packageObj.packageDays&&""!==v.packageObj.packageDays&&null!=v.packageObj.validFrm&&null!=v.packageObj.validFrm&&""!==v.packageObj.validFrm&&(1==v.packageObj.packageStart&&null!=v.packageObj.packageStartBeforeDays&&null!=v.packageObj.packageStartBeforeDays&&""!==v.packageObj.packageStartBeforeDays||2==v.packageObj.packageStart)){v.packageObj.clonePackage=!0,c.open("PACKAGE SAVE AS",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/packageMaster/package.master.clonePackage.screen.html",size:"sm",controller:"packageMasterAdvSrchCtrl",controllerAs:"pma",keyboard:!1,backdrop:"static",resolve:{flag:!0}}).result.then(function(e){null!=e&&""!==e&&(v.packageNameObj=e,v.savePackageMaster())})}else n.information("Information","Please Fill All Mandatory fields")},v.clkPayerCheck=function(e){v.packageObj.selfFlag=!!e}}e.$inject=["$scope","QueryService","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","hisAlertConstants","CallManager","$filter","hisModalService","PackageMasterService","uiGridConstants","packageIncExcGridConstant","PackageSaveRequestPrepare","hisCalDefConstant","uibDatepickerConfig"],angular.module("napierContainerUi").controller("packageCreationCtrl",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("packageIncExcGridConstant",{enableHorizontalScrollbar:2,columnDefs:[{name:"primaryServiceGroup",displayName:"Primary Service Group",cellTemplate:'<div class="ui-grid-cell-contents"><div>{{row.entity.srchObj.DESCRIPTION||row.entity.srchObj.SERV_NAME}}</div></div>'},{name:"applicability",displayName:"Applicability",cellTemplate:'<div class="ui-grid-cell-contents action-row"><div class=""><select class="form-control" ng-if="grid.appScope.pm.packageObj.packageCoverType==1" ng-model="MODEL_COL_FIELD"><option value="1">Per Visit</option><option value="2">Per Week</option><option value="3">Per Day</option></select><span ng-if="grid.appScope.pm.packageObj.packageCoverType==2">--</span></div></div>'},{name:"amtNlPer",displayName:"Amount/NL/Percentage",cellTemplate:'<div class="ui-grid-cell-contents action-row"><div class=""><select class="form-control" ng-if="grid.appScope.pm.packageObj.packageCoverType==1" ng-change="(row.entity.amtNlPer==3)?row.entity.quantity=undefined:(row.entity.amtNlPer==2)?grid.appScope.pm.changeBedAmt(row.entity[grid.appScope.pm.bedClassGrid.data[1].bedClass.CODE],row.entity,row):undefined" ng-model="MODEL_COL_FIELD"><option value="1">Amount</option><option value="2">Percentage</option><option value="3">NL</option></select><span ng-if="grid.appScope.pm.packageObj.packageCoverType==2">--</span></div></div>'},{name:"quantity",displayName:"Quantity",cellTemplate:'<div class="ui-grid-cell-contents action-row"><div class=""><input type="text" class="form-control" ng-if="grid.appScope.pm.packageObj.packageCoverType==1" ng-model="MODEL_COL_FIELD" numbers-only ng-disabled="row.entity.amtNlPer==3"><span ng-if="grid.appScope.pm.packageObj.packageCoverType==2">--</span></div></div>'},{name:"actions",displayName:"Actions",pinnedRight:!0,cellTemplate:'<div class="ui-grid-cell-contents action-row"><i class="fa fa-trash" ng-click="grid.appScope.pm.removeIncExcRcrd(row.entity,rowRenderIndex)"></i></div>'}]})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S){e.loadModule("billing");var v=t.getLanguageToSet();e.changeLanguage(v),r.alertData={},a.loadAlerts(v).then(function(e){r.myObj=e,r.close={buttonClose:function(){}}});var D=this;r.SaveFlag=!1,r.editPack=!1,r.permission=!0,r.packageSelect=!1,r.parseInt=parseInt,r.showIpElements=!1;r.example14model=[],r.example15model=[],r.isTotalDaysValid=!0,r.isBedClassDisabled=!1,r.isServiceInclusionAdd=!0,r.isMatInclusionAdd=!0,r.isServExclAdd=!0,r.isMatExclAdd=!0,r.bedClassList=[],r.bedClassListServ=[],r.bedClassListMtrl=[],r.inclusionEditObject={},r.ExclusionEditObject={},r.CD=angular.copy(u),r.example14settings={scrollableHeight:"200px",scrollable:!0,enableSearch:!0},r.serviceInclusionsGrid=angular.copy(o),D.serviceExclusionsGrid=angular.copy(c),r.mtrlExclusionsGrid=angular.copy(d),r.mtrlInclusionsGrid=angular.copy(p),"HSC"===sessionStorage.productCustomization&&(r.HSCChecklistGrid=!0,r.packageCheckListSearchGrid=angular.copy(m),r.packageCheckListGrid=angular.copy(g)),r.checkListObj=[],r.packageType=[],r.packageCat=[],r.packNameTest=[],r.multiGroup=[],r.multiGroup1=[],r.multiDept=[],r.multiDept1=[],r.multiBed=[],r.multiGender=[],r.serviceIncl=0,r.materialIncl=0,r.mtrlAdd=!1,r.servAdd=!1,r.servAdd1=!1,r.mtrlAdd1=!1,r.checkEditclicked=!0,r.multipleComboDataForList={1:r.packageType,2:r.packageCat,3:r.packNameTest,4:r.multiGroup,5:r.multiGroup1,6:r.multiDept,7:r.multiDept1,8:r.multiBed,9:r.multiGender},r.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],r.format=r.formats[1],r.altInputFormats=["M!/d!/yyyy"],r.open1=function(){r.popup1.opened=!0},r.popup1={opened:!1},r.open2=function(){r.popup2.opened=!0},r.popup2={opened:!1},r.open3=function(){r.popup3.opened=!0},r.popup3={opened:!1},r.open4=function(){r.popup4.opened=!0},r.popup4={opened:!1},r.open5=function(){r.popup5.opened=!0},r.popup5={opened:!1},r.open6=function(){r.popup6.opened=!0},r.popup6={opened:!1},r.fDateOptions={minDate:new Date,startingDay:1},r.tDateOptions={minDate:new Date(moment(r.fDateM).format("YYYY-MM-DD")),startingDay:1},r.srvIncFromOptions={minDate:new Date},r.srvIncToOptions={minDate:new Date,maxDate:r.tDate},r.mtrlIncFromOptions={minDate:new Date},r.mtrlIncToOptions={minDate:new Date,maxDate:r.tDate},r.init=function(){r.inclusionEditObject.fDate=new Date,r.inclusionEditObject.dateFrom=new Date,r.srvIncToOptions.maxDate=r.tDate,r.mtrlIncToOptions.maxDate=r.tDate},r.tDateChange=function(e){r.tDate=e,r.srvIncToOptions.maxDate=r.tDate,r.mtrlIncToOptions.maxDate=r.tDate},r.packDis=function(){return 0==r.SaveFlag&&0==r.packageSelect||1==r.SaveFlag},r.pd=function(e){r.pkgDays=e,r.pkgDays!=r.tot?r.isTotalDaysValid=!1:r.isTotalDaysValid=!0},r.totalDays=function(e,t,a,i){r.pkgDays=parseInt(i),r.icuDays=null==e||" "==e||null==e?0:parseInt(e),r.regDays=null==t||" "==t||null==t?0:parseInt(t),r.preProcedure=null==a||" "==a||null==a?0:parseInt(a),r.tot=r.icuDays+r.regDays+r.preProcedure,r.tot===r.pkgDays&&r.tot&&r.pkgDays?r.isTotalDaysValid=!0:r.isTotalDaysValid=!1};var y=s.executeQueryURLReset();r.packageTypeList=new Array,s.executeQueryInput("PATTYPE_DROPDOWN",r.packageTypeList,r.multipleComboDataForList,!0,!1,y,"popUp"),r.packageCatList=new Array,s.executeQueryInput("PACKCAT_DROPDOWN",r.packageCatList,r.multipleComboDataForList,!0,!1,y,"popUp"),r.packageSearchList=new Array,s.executeQueryInput("PACK_SEARCH",r.packageSearchList,r.multipleComboDataForList,!0,!1,y,"popUp"),r.multiGroupList=new Array,s.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r.multiGroupList),s.executeQueryInput("MATRLGRP_DROPDOWN",r.multiGroupList,r.multipleComboDataForList,!0,!1,y,"popUp"),r.multiGroupList1=new Array,s.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r.multiGroupList1),s.executeQueryInput("MATRLGRP_DROPDOWN",r.multiGroupList1,r.multipleComboDataForList,!0,!1,y,"popUp"),r.servExGroupList=new Array,s.prepareParamList(1,"1",r.servExGroupList),s.executeQueryInput("DEPARTMENT_DROPDOWN",r.servExGroupList,r.multipleComboDataForList,!0,!1,y,"popUp"),r.servExGroupList1=new Array,s.prepareParamList(1,"1",r.servExGroupList1),s.executeQueryInput("DEPARTMENT_DROPDOWN",r.servExGroupList1,r.multipleComboDataForList,!0,!1,y,"popUp"),r.bedclassGroupList=new Array,s.prepareParamList(1,"1",r.bedclassGroupList),s.executeQueryInput("BED_CLASS",r.bedclassGroupList,r.multipleComboDataForList,!0,!1,y,"popUp"),r.genGroupList=new Array,s.prepareParamList(1,"1",r.genGroupList),s.executeQueryInput("GENDER_DROPDOWN",r.genGroupList,r.multipleComboDataForList,!0,!0,y,"popUp"),r.getMultiSubGroup=function(e){r.getMultiName(e),r.multiSubGroup=[],r.multipleComboDataForList={1:r.multiSubGroup};var t=s.executeQueryURLReset();return r.multiGroupSubList=new Array,s.prepareParamList(1,e.gQDataCode,r.multiGroupSubList),s.executeQueryInput("MATRLSUBGRP_DROPDOWN",r.multiGroupSubList,r.multipleComboDataForList,!0,!0,t,"popUp")},r.getMultiName=function(e,t){r.multiName=[],r.multipleComboDataForList={1:r.multiName};var a=s.executeQueryURLReset();return r.multiNameList=new Array,s.prepareParamList(1,e?e.gQDataCode:"",r.multiNameList),s.prepareParamList(2,t?t.gQDataCode:"",r.multiNameList),s.prepareParamList(3,t?t.gQDataCode:"",r.multiNameList),s.executeQueryInput("MATRIALNAME_DROPDOWN",r.multiNameList,r.multipleComboDataForList,!0,!0,a,"popUp")},r.getMultiSubGroup1=function(e){r.getMultiName1(e),r.multiSubGroup1=[],r.multipleComboDataForList={1:r.multiSubGroup1};var t=s.executeQueryURLReset();return r.multiGroupSubList1=new Array,s.prepareParamList(1,e.gQDataCode,r.multiGroupSubList1),s.executeQueryInput("MATRLSUBGRP_DROPDOWN",r.multiGroupSubList1,r.multipleComboDataForList,!0,!0,t,"popUp")},r.getMultiName1=function(e,t){r.multiName1=[],r.multipleComboDataForList={1:r.multiName1};var a=s.executeQueryURLReset();return r.multiNameList1=new Array,s.prepareParamList(1,e?e.gQDataCode:"",r.multiNameList1),s.prepareParamList(2,t?t.gQDataCode:"",r.multiNameList1),s.prepareParamList(3,t?t.gQDataCode:"",r.multiNameList1),s.executeQueryInput("MATRIALNAME_DROPDOWN",r.multiNameList1,r.multipleComboDataForList,!0,!0,a,"popUp")},r.getMultiSubDept=function(e){r.getMultiService(e),r.multiSubDept=[],r.multipleComboDataForList={1:r.multiSubDept};var t=s.executeQueryURLReset();return r.servExGroupSubList=new Array,s.prepareParamList(1,e.gQDataCode,r.servExGroupSubList),s.executeQueryInput("SUBDEPARTMENT_DROPDOWN",r.servExGroupSubList,r.multipleComboDataForList,!0,!0,t,"popUp")},r.getMultiService=function(e,t){r.multiService=[],r.multipleComboDataForList={1:r.multiService};var a=s.executeQueryURLReset();return r.multiServiceList=new Array,s.prepareParamList(1,e?e.gQDataCode:"",r.multiServiceList),s.prepareParamList(2,t?t.gQDataCode:"",r.multiServiceList),s.prepareParamList(3,t?t.gQDataCode:"",r.multiServiceList),s.executeQueryInput("SERVNAME_DROPDOWN",r.multiServiceList,r.multipleComboDataForList,!0,!0,a,"popUp")},r.getMultiSubDept1=function(e){r.getMultiService1(e),r.multiSubDept1=[],r.multipleComboDataForList={1:r.multiSubDept1};var t=s.executeQueryURLReset();return r.servExGroupSubList1=new Array,s.prepareParamList(1,e.gQDataCode,r.servExGroupSubList1),s.executeQueryInput("SUBDEPARTMENT_DROPDOWN",r.servExGroupSubList1,r.multipleComboDataForList,!0,!0,t,"popUp")},r.getMultiService1=function(e,t){r.multiService1=[],r.multipleComboDataForList={1:r.multiService1};var a=s.executeQueryURLReset();return r.multiServiceList1=new Array,s.prepareParamList(1,e?e.gQDataCode:"",r.multiServiceList1),s.prepareParamList(2,t?t.gQDataCode:"",r.multiServiceList1),s.prepareParamList(3,t?t.gQDataCode:"",r.multiServiceList1),s.executeQueryInput("SERVNAME_DROPDOWN",r.multiServiceList1,r.multipleComboDataForList,!0,!0,a,"popUp")},r.serviceChange=function(e){r.inclusionEditObject.deptSubEdit1=_.find(r.multiSubDept1,function(t){return t.gQDataName==e.gQDataSequence})},r.serviceExcChange=function(e){r.ExclusionEditObject.deptSubEdit=_.find(r.multiSubDept,function(t){return t.gQDataName==e.gQDataSequence})},r.mtrlChange=function(e){r.inclusionEditObject.mgrSubEdit=_.find(r.multiSubGroup,function(t){return t.gQDataName==e.gQDataSequence})},r.mtrlExcChange=function(e){r.ExclusionEditObject.mgrSubEdit1=_.find(r.multiSubGroup1,function(t){return t.gQDataName==e.gQDataSequence})},r.clearSearchPackage=function(){r.serviceInclusionsGrid.data=[],D.serviceExclusionsGrid.data=[],r.mtrlInclusionsGrid.data=[],r.mtrlExclusionsGrid.data=[],r.facilitySeqId="",r.facility="",r.defDeptCode="",r.depart="",r.subDeptSeqId="",r.subDepart="",r.packageType1="",r.packCat1="",r.packgSeqId="",r.servName="",r.aliasName="",r.packDays=0,r.pkgDays=0,r.icuDays=0,r.regDays=0,r.preProcedure=0,r.tot=0,r.fDate="",r.tDate="",r.serviceIncl=0,r.materialIncl=0},r.getPName=function(e,t){D.packageName="",r.clearSearchPackage(),r.packageSelect=!0,r.packCat=e,r.packType=t;var a=t.gQDataCode;r.showIpElements=1==a,r.packNameTest=[],r.multipleComboDataForChangeList={1:r.packNameTest};var i=s.executeQueryURLReset();r.packageNameList=new Array,s.prepareParamList(1,t?t.gQDataCode:"",r.packageNameList),s.prepareParamList(2,t?t.gQDataCode:"",r.packageNameList),s.prepareParamList(3,e?e.gQDataCode:"",r.packageNameList),s.prepareParamList(4,e?e.gQDataCode:"",r.packageNameList),s.executeQueryInput("PACK_SEARCH",r.packageNameList,r.multipleComboDataForChangeList,!0,!0,i,"popUp")},r.serviceInclusionsGrid.cellEditableCondition=function(e){return e.row.entity.BedClassEnabling},r.mtrlInclusionsGrid.cellEditableCondition=function(e){return e.row.entity.MatBedClassEnabling},r.bedTemp='<div ng-if="!row.entity.editable" style = "padding-left:25px;" >{{COL_FIELD}}</div><div ng-if="row.entity.editable" ><input type="text"  numbers-only ng-model="MODEL_COL_FIELD" ></div>',r.getSearchView=function(e){r.serviceInclusionsGrid=angular.copy(o),D.serviceExclusionsGrid=angular.copy(c),r.mtrlExclusionsGrid=angular.copy(d),r.mtrlInclusionsGrid=angular.copy(p),r.clearSearchPackage(),r.isOpen=!0,r.packNameSeqId=[{paramName:"pServSeqId",value:e}],r.bedClassDaysInfo=[],r.packageDetailsInfo=[],r.packageInclusionServiceInfo=[],r.packageExclusionServiceInfo=[],r.packageInclusionMaterialInfo=[],r.packageExclusionMaterialInfo=[],r.packageCheckListGridInfo=[],r.packageCheckListSearchGridInfo=[],r.multipleGridDataForPackageSearch={1:r.bedClassDaysInfo,2:r.packageDetailsInfo,3:r.packageInclusionServiceInfo,4:r.packageExclusionServiceInfo,5:r.packageInclusionMaterialInfo,6:r.packageCheckListGridInfo,7:r.packageExclusionMaterialInfo};var t=s.executeQueryURLReset();s.executeQueryInput("BED_CLASSDAYS",r.packNameSeqId,r.multipleGridDataForPackageSearch,!0,!1,t,"popUp",{}),s.executeQueryInput("PACK_DETAILS",r.packNameSeqId,r.multipleGridDataForPackageSearch,!0,!1,t,"popUp",{}),s.executeQueryInput("PACK_INCL_SERV",r.packNameSeqId,r.multipleGridDataForPackageSearch,!0,!1,t,"popUp",{}),s.executeQueryInput("PACK_EXCL_SERV",r.packNameSeqId,r.multipleGridDataForPackageSearch,!0,!1,t,"popUp",{}),s.executeQueryInput("PACK_INCL_MTRL",r.packNameSeqId,r.multipleGridDataForPackageSearch,!0,!1,t,"popUp",{}),s.executeQueryInput("NH_M_PACKAGE_CHECK_LIST_001",r.packNameSeqId,r.multipleGridDataForPackageSearch,!0,!1,t,"popUp",{}),s.executeQueryInput("PACK_EXCL_MTRL",r.packNameSeqId,r.multipleGridDataForPackageSearch,!0,!0,t,"popUp",{}).then(function(e){0!=r.bedClassDaysInfo.length&&(r.icuDays=2==r.bedClassDaysInfo.length?r.bedClassDaysInfo[1].ICU_DAYS:r.bedClassDaysInfo[0].ICU_DAYS,r.regDays=2==r.bedClassDaysInfo.length?r.bedClassDaysInfo[1].REGULAR_DAYS:r.bedClassDaysInfo[0].REGULAR_DAYS,r.preProcedure=2==r.bedClassDaysInfo.length?r.bedClassDaysInfo[1].PRE_PROC_DAYS:r.bedClassDaysInfo[0].PRE_PROC_DAYS,r.tot=2==r.bedClassDaysInfo.length?r.bedClassDaysInfo[1].TOTAL_DAYS:r.bedClassDaysInfo[0].TOTAL_DAYS,r.pkgDays=2==r.bedClassDaysInfo.length?r.bedClassDaysInfo[1].TOTAL_DAYS:r.bedClassDaysInfo[0].TOTAL_DAYS,r.endays=2==r.bedClassDaysInfo.length?r.bedClassDaysInfo[1].SUBDESCRITPION:r.bedClassDaysInfo[0].SUBDESCRITPION,r.cslSeqId=2==r.bedClassDaysInfo.length?r.bedClassDaysInfo[1].CSL_SEQ_ID:r.bedClassDaysInfo[0].CSL_SEQ_ID),r.facilitySeqId=r.packageDetailsInfo[0].PACK_FACLITY_ID,r.facility=r.packageDetailsInfo[0].FACILITY,r.defDeptCode=r.packageDetailsInfo[0].DEF_DEPT_CODE,r.depart=r.packageDetailsInfo[0].DESCRIPTION,r.subDeptSeqId=r.packageDetailsInfo[0].PACK_SUBDEPT_CODE,r.subDepart=r.packageDetailsInfo[0].SUBDESCRITPION,r.packageType1=r.packageDetailsInfo[0].PACKAGE_TYPE,r.packType1=r.packageDetailsInfo[0].PACKAGE_TYPE_DESC,r.packCat1=r.packageDetailsInfo[0].PACKAGECATEGORY,r.packgSeqId=r.packageDetailsInfo[0].CODE,r.servName=r.packageDetailsInfo[0].SERV_NAME,r.aliasName=r.packageDetailsInfo[0].ALIASNAME,r.fDateM=new Date(moment(r.packageDetailsInfo[0].SERV_FROM_DATE).format("YYYY-MM-DD")),r.tDate=new Date(moment(r.packageDetailsInfo[0].SERV_TO_DATE).format("YYYY-MM-DD")),r.editPack=null!=r.permissionsObj.T_BL_M_PACKAGE_SEARCH_U,r.gender=_.find(r.multiGender,function(e){if(e.gQDataName==r.packageDetailsInfo[0].GENDER)return e}),"HSC"===sessionStorage.productCustomization&&r.preparePackageCheckListGridData(r.packageCheckListGridInfo),r.prepareServInclusionGridData(r.packageInclusionServiceInfo),r.prepareServExclusionGridData(r.packageExclusionServiceInfo),r.prepareMtrlInclusionGridData(r.packageInclusionMaterialInfo),r.prepareMtrlExclusionGridData(r.packageExclusionMaterialInfo)})},r.prepareServInclusionGridData=function(e){r.bedValue=[],r.bedArrayserv=[],r.bedArrayservList=[],r.bedNameStrArr=[],r.serviceInclusionsGrid.data=[];var t=e[0].BEDNAME;t&&(r.bedNameStrArr=null!=t.indexOf?t.split(","):t);for(var a=e[0].AMOUNT,i=0;i<e.length;i++){var n=0;if(0==e[i].QTY&&0==e[i].INCL_AMOUNT)var l="N/L";else l=0;var s=e[i].FROM_DATE?e[i].FROM_DATE.split("-"):"",o=e[i].TO_DATE?e[i].TO_DATE.split("-"):"";if(r.srvIncObj={serialNumber:i+1,CISSEQID:e[i].CIS_SEQ_ID,INCLSERVSEQID:e[i].INCL_SERV_SEQ_ID,service:e[i].SERV_NAME,DEPTCODE:e[i].DEPT_CODE,department:e[i].DepartmentName,SUBDEPTID:e[i].SUB_DEPT_ID,subDepartment:e[i].SubDepartmentCode,noLimit:l,qunatity:e[i].QTY,amount:e[i].INCL_AMOUNT,BEDSEQID:""==e[i].BEDSEQID?"":null!=e[i].BEDSEQID.indexOf?e[i].BEDSEQID.split(","):e[i].BEDSEQID,validFrom:""==s?"":s[0]+"-"+s[1]+"-"+s[2].substring(0,2),validTo:""==o?"":o[0]+"-"+o[1]+"-"+o[2].substring(0,2)},0!=r.srvIncObj.qunatity){r.bedValue=[],r.bedValue1=""==e[i].LIMIT?"":null!=e[i].LIMIT.indexOf?e[i].LIMIT.split(","):e[i].LIMIT,r.bedClassName=""==e[i].BC_CODE?"":null!=e[i].BC_CODE.indexOf?e[i].BC_CODE.split(","):e[i].BC_CODE;for(var c=0;c<r.bedValue1.length;c++)r.bedValue.push(r.bedValue1[c].split(".")[0]);for(var d=0;d<r.bedNameStrArr.length;d++)for(var p=0;p<r.multiBed.length;p++)if(r.bedNameStrArr[d]==r.multiBed[p].gQDataName){var u={};u={bedName:r.multiBed[p].gQDataName,bedCode:r.multiBed[p].gQDataCode,bedAmount:0,limit:r.bedValue[d]},r.bedArrayserv[n]=u,n+=1}r.bedArrayservList[i]=angular.copy(r.bedArrayserv)}else if(r.srvIncObj.amount){r.bedClassName=""==e[i].BC_CODE?"":null!=e[i].BC_CODE.indexOf?e[i].BC_CODE.split(","):e[i].BC_CODE,r.bedValue=""==e[i].AMOUNT?"":null!=e[i].AMOUNT.indexOf?e[i].AMOUNT.split(","):e[i].AMOUNT;for(d=0;d<r.bedNameStrArr.length;d++)for(p=0;p<r.multiBed.length;p++)if(r.bedNameStrArr[d]==r.multiBed[p].gQDataName){u={};u={bedName:r.multiBed[p].gQDataName,bedCode:r.multiBed[p].gQDataCode,bedAmount:r.bedValue[d],limit:0},r.bedArrayserv[n]=u,n+=1}r.bedArrayservList[i]=angular.copy(r.bedArrayserv)}else if(null!=t&&""!=t){var m=null!=t.indexOf?t.split(","):t;r.bedValue=m,r.bedValue.fill("N/L"),r.bedClassName=""==e[i].BC_CODE?"":null!=e[i].BC_CODE.indexOf?e[i].BC_CODE.split(","):e[i].BC_CODE;for(d=0;d<r.bedNameStrArr.length;d++)for(p=0;p<r.multiBed.length;p++)if(r.bedNameStrArr[d]==r.multiBed[p].gQDataName){u={};u={bedName:r.multiBed[p].gQDataName,bedCode:r.multiBed[p].gQDataCode,bedAmount:0,limit:0},r.bedArrayserv[n]=u,n+=1}r.bedArrayservList[i]=angular.copy(r.bedArrayserv)}1==r.showIpElements&&r.bedCreationAndAssignmentOfValues(t,r.serviceInclusionsGrid,r.srvIncObj,r.bedValue,a,"serviceIncl"),r.serviceInclusionsGrid.data.push(r.srvIncObj),r.serviceInclusionsGrid.data[i].bedClassArray=r.bedArrayservList[i]}},r.prepareServExclusionGridData=function(e){D.serviceExclusionsGrid.data=[];for(var t=0;t<e.length;t++)r.servExGridObj={serialNumber:t+1,CESSEQID:e[t].CES_SEQ_ID,EXCLSERVSEQID:e[t].EXCL_SERV_SEQ_ID,service:e[t].SERV_NAME,DEPTCODE:e[t].DEPT_CODE,department:e[t].DepartmentName,SUBDEPTCODE:e[t].SUB_DEPT_CODE,subDepartment:e[t].SubDepartmentCode},D.serviceExclusionsGrid.data.push(r.servExGridObj)},r.prepareMtrlInclusionGridData=function(e){r.bedArraymtrl=[],r.bedArraymtrlList=[],r.bedNameStrArr1=[],r.mtrlInclusionsGrid.data=[];var t=e[0].BEDNAME;t&&(r.bedNameStrArr1=null!=t.indexOf?t.split(","):t);for(var a=e[0].BC_CODE,i=0;i<e.length;i++){var n=0;if(0!=e[i].QTY||0!=e[i].MTR_AMOUNT&&""!=e[i].MTR_AMOUNT)l=0;else var l="N/L";var s=e[i].FROM_DATE?e[i].FROM_DATE.split("-"):"",o=e[i].TO_DATE?e[i].TO_DATE.split("-"):"";if(r.matIncObj={serialNumber:i+1,CIMSEQID:e[i].CIM_SEQ_ID,MTRLCODE:e[i].MTRL_CODE,materialName:e[i].MaterialName,MTRGRPSEQID:e[i].MTR_GRPSEQ_ID,materialGroup:e[i].MaterialMainGroupName,MTRSUBGRPSEQID:e[i].MTR_SUB_GRPSEQ_ID,materialSubGroup:e[i].MaterialSubGroupName,qunatity:e[i].QTY,noLimit:l,amount:e[i].MTR_AMOUNT,BEDSEQID:""==e[i].BEDSEQID?"":null!=e[i].BEDSEQID.indexOf?e[i].BEDSEQID.split(","):e[i].BEDSEQID,validFrom:""==s?"":s[0]+"-"+s[1]+"-"+s[2].substring(0,2),validTo:""==o?"":o[0]+"-"+o[1]+"-"+o[2].substring(0,2)},0!=r.matIncObj.qunatity){r.bedValue=[],r.bedValue1=""==e[i].LIMIT?"":null!=e[i].LIMIT.indexOf?e[i].LIMIT.split(","):e[i].LIMIT,r.bedCode=""==e[i].BC_CODE?"":null!=e[i].BC_CODE.indexOf?e[i].BC_CODE.split(","):e[i].BC_CODE;for(var c=0;c<r.bedValue1.length;c++)r.bedValue.push(r.bedValue1[c].split(".")[0]);for(var d=0;d<r.bedNameStrArr1.length;d++)for(var p=0;p<r.multiBed.length;p++)if(r.bedNameStrArr1[d]==r.multiBed[p].gQDataName){var u={};u={bedName:r.multiBed[p].gQDataName,bedCode:r.multiBed[p].gQDataCode,bedAmount:0,limit:r.bedValue[d]},r.bedArraymtrl[n]=u,n+=1}r.bedArraymtrlList[i]=angular.copy(r.bedArraymtrl)}else if(r.matIncObj.amount){r.bedValue=""==e[i].AMOUNT?"":null!=e[i].AMOUNT.indexOf?e[i].AMOUNT.split(","):e[i].AMOUNT,r.bedCode=""==e[i].BC_CODE?"":null!=e[i].BC_CODE.indexOf?e[i].BC_CODE.split(","):e[i].BC_CODE;for(d=0;d<r.bedNameStrArr1.length;d++)for(p=0;p<r.multiBed.length;p++)if(r.bedNameStrArr1[d]==r.multiBed[p].gQDataName){u={};u={bedName:r.multiBed[p].gQDataName,bedCode:r.multiBed[p].gQDataCode,bedAmount:r.bedValue[d],limit:0},r.bedArraymtrl[n]=u,n+=1}r.bedArraymtrlList[i]=angular.copy(r.bedArraymtrl)}else if(null!=t&&""!=t){var m=t?null!=t.indexOf?t.split(","):t:"";r.bedValue=m,r.bedValue.fill("N/L"),r.bedCode=""==e[i].BC_CODE?"":null!=e[i].BC_CODE.indexOf?e[i].BC_CODE.split(","):e[i].BC_CODE;for(d=0;d<r.bedNameStrArr1.length;d++)for(p=0;p<r.multiBed.length;p++)if(r.bedNameStrArr1[d]==r.multiBed[p].gQDataName){u={};u={bedName:r.multiBed[p].gQDataName,bedCode:r.multiBed[p].gQDataCode,bedAmount:0,limit:0},r.bedArraymtrl[n]=u,n+=1}r.bedArraymtrlList[i]=angular.copy(r.bedArraymtrl)}1==r.showIpElements&&r.bedCreationAndAssignmentOfValues(t,r.mtrlInclusionsGrid,r.matIncObj,r.bedValue,a,"materialIncl"),r.mtrlInclusionsGrid.data.push(r.matIncObj),r.mtrlInclusionsGrid.data[i].MatBedClassArray=r.bedArraymtrlList[i]}},r.changeBedClass=function(e){r.inclusionEditObject.example14model=e.example15model,r.bedClassListServ=[],r.bedClassListMtrl=[];var t=r.serviceInclusionsGrid.data;r.serviceInclusionsGrid=angular.copy(o),r.serviceInclusionsGrid.data=t;for(var a=0;a<e.example15model.length;a++)for(var i=0;i<r.multiBed.length;i++)if(e.example15model[a]==r.multiBed[i].gQDataName){var n={};n={bedName:r.multiBed[i].gQDataName,bedCode:r.multiBed[i].gQDataCode,bedAmount:0,limit:0},r.bedClassListServ.push(n),r.bedClassListMtrl.push(n)}for(a=0;a<e.example15model.length;a++)for(i=0;i<r.bedArrayserv.length;i++)if(r.bedArrayserv[i].bedName==e.example15model[a]){n={};n={bedName:r.bedArrayserv[a].bedName,bedCode:r.bedArrayserv[a].bedCode,bedAmount:r.bedArrayserv[a].bedAmount,limit:r.bedArrayserv[a].limit},r.bedClassListServ[a]=n}for(a=0;a<e.example15model.length;a++)for(i=0;i<r.bedArraymtrl.length;i++)if(r.bedArraymtrl[i].bedName==e.example15model[a]){n={};n={bedName:r.bedArraymtrl[a].bedName,bedCode:r.bedArraymtrl[a].bedCode,bedAmount:r.bedArraymtrl[a].bedAmount,limit:r.bedArraymtrl[a].limit},r.bedClassListMtrl[a]=n}for(var l=0;l<e.example15model.length;l++)r.bedclassObj={field:e.example15model[l],displayName:e.example15model[l],cellEditableCondition:function(e){return e.row.entity.BedClassEnabling},width:100,enableCellEdit:!0,pinnedLeft:!0},r.serviceInclusionsGrid.columnDefs.splice(6,0,r.bedclassObj);var s=r.mtrlInclusionsGrid.data;r.mtrlInclusionsGrid=angular.copy(p),r.mtrlInclusionsGrid.data=s;for(l=0;l<e.example15model.length;l++)r.MatbedclassObj={field:e.example15model[l],displayName:e.example15model[l],cellEditableCondition:function(e){return e.row.entity.MatBedClassEnabling},width:100,enableCellEdit:!0,pinnedLeft:!0},r.mtrlInclusionsGrid.columnDefs.splice(6,0,r.MatbedclassObj);1==r.SaveFlag&&(r.serviceInclusionsGrid.columnDefs.push({name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,width:100,cellTemplate:'<div class="actionRow"><i class="fa fa-pencil" ng-click="grid.appScope.editServiceInc(row,rowRenderIndex,grid)"></i> <i ng-if="row.entity.CISSEQID == undefined" class="fa fa-trash" data-toggle="modal" data-target="#ipServiceInclusion" ng-click="grid.appScope.deleteServiceInc(row)"></i></div>',pinnedRight:!0}),r.mtrlInclusionsGrid.columnDefs.push({name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,width:100,cellTemplate:'<div class="actionRow" ><i class="fa fa-pencil" ng-click="grid.appScope.editMaterialInc(row,rowRenderIndex,grid)"></i> <i ng-if="row.entity.CIMSEQID == undefined" class="fa fa-trash"  data-toggle="modal" data-target="#ipMaterialInclusion" ng-click="grid.appScope.deleteMaterialInc(row)"></i></div>',pinnedRight:!0}))},r.checkColumnExists=function(e,t){for(var a=0;a<t.length;a++)return t[a].field!=e},r.bedCreationAndAssignmentOfValues=function(e,t,a,i,n,l){"serviceIncl"==l?r.serviceIncl=r.serviceIncl+1:"materialIncl"==l&&(r.materialIncl=r.materialIncl+1),r.serviceInclusionsGrid.cellEditableCondition=function(e){return e.row.entity.isActive};var s=e.split(",");r.bedDetailsList=[];for(var o=n.split(","),c=[],d=0;d<s.length;d++)-1==c.indexOf(s[d])&&c.push(s[d]);s=c;for(var p=0;p<s.length;p++){r.bedclassObj={field:s[p],displayName:s[p],enableSorting:!0,enableCellEdit:!0,width:100,pinnedLeft:!0},a[s[p]]=i[p],1!=r.serviceIncl&&1!=r.materialIncl||t.columnDefs.splice(6,0,r.bedclassObj),{gQDataCode:parseInt(o[p]),gQDataName:s[p],gQDataSequence:""}}},r.prepareMtrlExclusionGridData=function(e){r.mtrlExclusionsGrid.data=[];for(var t=0;t<e.length;t++)r.servExGridObj={serialNumber:t+1,CEMSEQID:e[t].CEM_SEQ_ID,MTRLCODE:e[t].MTRL_CODE,materialName:e[t].MaterialName,MTRLMAINCODE:e[t].MTRL_MAIN_CODE,materialGroup:e[t].MaterialMainGroupName,MTRLSUBCODE:e[t].MTRL_SUB_CODE,materialSubGroup:e[t].MaterialSubGroupName},r.mtrlExclusionsGrid.data.push(r.servExGridObj)},r.EditpackageSearch=function(){if(r.init(),r.SaveFlag=!0,"HSC"===sessionStorage.productCustomization){r.checkEditclicked=!1;var e="";if(r.packageCheckListGrid.data=[],0==(e=r.packageCheckListSearchGrid.data).length){for(var t=[],a=1;a<=10;a++)10==a?t.push({checkListItemPriority:a,hideShowRow:!0}):t.push({checkListItemPriority:a,hideShowRow:!1});r.packageCheckListGrid.data=t}else for(a=0;a<e.length;a++)a==e.length-1?(e[a].hideShowRow=!0,r.packageCheckListGrid.data.push(e[a])):r.packageCheckListGrid.data.push(e[a])}r.serviceInclusionsGrid.columnDefs.push({name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="actionRow"><i class="fa fa-pencil" ng-click="grid.appScope.editServiceInc(row,rowRenderIndex,grid)"></i> <i ng-if="row.entity.CISSEQID == undefined" class="fa fa-trash" data-toggle="modal" data-target="#ipServiceInclusion" ng-click="grid.appScope.deleteServiceInc(row)"></i></div>',pinnedRight:!0}),D.serviceExclusionsGrid.columnDefs.push({name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="actionRow" ><i class="fa fa-pencil" ng-click="grid.appScope.editServiceExc(row,rowRenderIndex)"></i> <i ng-if="row.entity.CESSEQID == undefined" class="fa fa-trash"  data-toggle="modal" data-target="#ipServiceExclusion" ng-click="grid.appScope.deleteServiceExc(row)"></i></div>',pinnedRight:!0}),r.mtrlInclusionsGrid.columnDefs.push({name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="actionRow" ><i class="fa fa-pencil" ng-click="grid.appScope.editMaterialInc(row,rowRenderIndex,grid)"></i> <i ng-if="row.entity.CIMSEQID == undefined" class="fa fa-trash"  data-toggle="modal" data-target="#ipMaterialInclusion" ng-click="grid.appScope.deleteMaterialInc(row)"></i></div>',pinnedRight:!0}),r.mtrlExclusionsGrid.columnDefs.push({name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="actionRow" ><i class="fa fa-pencil" ng-click="grid.appScope.editMaterialExc(row,rowRenderIndex)"></i> <i ng-if="row.entity.CEMSEQID == undefined" class="fa fa-trash"  data-toggle="modal" data-target="#ipMaterialExclusion" ng-click="grid.appScope.deleteMaterialExc(row)"></i></div>',pinnedRight:!0});r.serviceInclusionsGrid.columnDefs;var i=[];if(null!=r.bedArrayservList[0].length&&0!=r.bedArrayservList[0])for(var n=0;n<r.bedArrayservList[0].length;n++)i.push(r.bedArrayservList[0][n].bedName);r.inclusionEditObject.example15model=i,r.inclusionEditObject.example14model=i},r.SavepackageSearch=function(){r.objectssss(),"HSC"===sessionStorage.productCustomization&&r.prepareCheckListModel(),i.editIPServicefun(r.PDFormObj,r.bedClsObj,r.servIncObj,r.mtrlIncObj,r.servExcObj,r.mtrlExcObj,r.checkListObj).then(function(e){if(r.response=e,null!=r.response.data.HITService.message.servSeqId){r.SaveFlag=!1;var t=r.myObj.successUpdatePack;l.hisAlertMulti("success",r.myObj.alertTypeSucss,t,!1,!1,r.close,2e3),r.clearMaterialIncForm(r.inclusionEditObject),r.clearServiceIncForm(r.inclusionEditObject),r.clearServiceExcForm(r.ExclusionEditObject),r.clearMaterialExcForm(r.ExclusionEditObject),r.clearSearchPackage(),"HSC"===sessionStorage.productCustomization&&r.clearPackageChelckListGrid(),D.packageName="",r.serviceInclusionsGrid.columnDefs.pop({name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="actionRow"><i class="fa fa-pencil" ng-click="grid.appScope.editServiceInc(row,rowRenderIndex,grid)"></i> <i ng-if="row.entity.CISSEQID == undefined" class="fa fa-trash" data-toggle="modal" data-target="#ipServiceInclusion" ng-click="grid.appScope.deleteServiceInc(row)"></i></div>',pinnedRight:!0}),D.serviceExclusionsGrid.columnDefs.pop({name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="actionRow" ><i class="fa fa-pencil" ng-click="grid.appScope.editServiceExc(row,rowRenderIndex)"></i> <i ng-if="row.entity.CESSEQID == undefined" class="fa fa-trash"  data-toggle="modal" data-target="#ipServiceExclusion" ng-click="grid.appScope.deleteServiceExc(row)"></i></div>',pinnedRight:!0}),r.mtrlInclusionsGrid.columnDefs.pop({name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="actionRow" ><i class="fa fa-pencil" ng-click="grid.appScope.editMaterialInc(row,rowRenderIndex,grid)"></i> <i ng-if="row.entity.CIMSEQID == undefined" class="fa fa-trash"  data-toggle="modal" data-target="#ipMaterialInclusion" ng-click="grid.appScope.deleteMaterialInc(row)"></i></div>',pinnedRight:!0}),r.mtrlExclusionsGrid.columnDefs.pop({name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="actionRow" ><i class="fa fa-pencil" ng-click="grid.appScope.editMaterialExc(row,rowRenderIndex)"></i> <i ng-if="row.entity.CEMSEQID == undefined" class="fa fa-trash"  data-toggle="modal" data-target="#ipMaterialExclusion" ng-click="grid.appScope.deleteMaterialExc(row)"></i></div>',pinnedRight:!0})}else{t=r.myObj.updateFail;l.hisAlertMulti("warning",r.myObj.alertTypeWarn,t,!1,!1,r.close,2e3)}},function(e){var t=r.myObj.plzTryAgin;l.hisAlertMulti("failure",r.myObj.alertTypeFail,t,!1,!1,r.close,2e3)})},r.addServiceIncRow=function(e){var t="";if(r.addRowToServiceInclusionGridObject={},!(e.deptEdit1&&e.fDate&&e.serLimit)){a=r.myObj.plzSlctMandFild;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),!1}if(!("amount"==e.serLimit&&e.amountValue||"quantity"==e.serLimit&&e.quantityValue||"nolimit"==e.serLimit)){var a=r.myObj.plzFilMandFild;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),!1}if(e.deptSubEdit1||(r.deptsbName="--",r.deptsbCode=0),e.serviceEdit1||(r.serviceName="--",r.serviceCode=0),r.bedClassListServ1=angular.copy(r.bedClassListServ),null!=e.amountValue)for(var i=0;i<r.bedClassListServ1.length;i++)r.bedClassListServ1[i].bedAmount=0,r.bedClassListServ1[i].limit=0;else e.amountValue=0;if(null!=e.quantityValue)for(i=0;i<r.bedClassListServ1.length;i++)r.bedClassListServ1[i].bedAmount=0,r.bedClassListServ1[i].limit=e.quantityValue;else e.quantityValue="--";if("nolimit"==e.serLimit){for(i=0;i<r.bedClassListServ1.length;i++)r.bedClassListServ1[i].bedAmount="N/L",r.bedClassListServ1[i].limit=0;t="N/L",r.BedClassEnabling=!1}else t=0,r.BedClassEnabling=!0;if(e.tDate)var s=n("date")(e.tDate,"yyyy-MM-dd");else{var o=r.tDate;s=n("date")(new Date(o),"yyyy-MM-dd")}r.addRowToServiceInclusionGridObject={DEPTCODE:e.deptEdit1.gQDataCode,department:e.deptEdit1.gQDataName,SUBDEPTID:null==e.deptSubEdit1?r.deptsbCode:e.deptSubEdit1.gQDataCode,subDepartment:null==e.deptSubEdit1?r.deptsbName:e.deptSubEdit1.gQDataName,service:null==e.serviceEdit1?r.serviceName:e.serviceEdit1.gQDataName,INCLSERVSEQID:null==e.serviceEdit1?r.serviceCode:e.serviceEdit1.gQDataCode,amount:e.amountValue,qunatity:"--"==e.quantityValue?0:e.quantityValue,noLimit:t,validFrom:n("date")(e.fDate,"yyyy-MM-dd"),validTo:s,bedClassArray:r.bedClassListServ1,BedClassEnabling:r.BedClassEnabling},r.addValuesToDynamicColumns(r.serviceInclusionsGrid,r.addRowToServiceInclusionGridObject),r.gridTemplate=[];for(var c=0;c<r.serviceInclusionsGrid.data.length;c++){if(r.serviceInclusionsGrid.data[c].department==e.deptEdit1.gQDataName&&r.serviceInclusionsGrid.data[c].subDepartment==e.deptSubEdit1.gQDataName&&r.serviceInclusionsGrid.data[c].service==e.serviceEdit1.gQDataName){var a=r.myObj.dataAlrdyexist;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),r.gridTemplate=null,!1}c==r.serviceInclusionsGrid.data.length-1&&(r.gridTemplate=r.addRowToServiceInclusionGridObject)}!("amount"==e.serLimit&&0==parseInt(e.amountValue)||"quantity"==e.serLimit&&0==parseInt(e.quantityValue))?(e.srvcInc_isZero=!1,0==r.serviceInclusionsGrid.data.length&&(r.gridTemplate=r.addRowToServiceInclusionGridObject),null!=r.gridTemplate&&(r.serviceInclusionsGrid.data.push(r.gridTemplate),r.clearServiceIncForm(e)),r.serviceInclusionsGridApi.grid.refresh()):e.srvcInc_isZero=!0},r.serviceInclusionsGrid.onRegisterApi=function(e){r.serviceInclusionsGridApi=e,e.edit.on.afterCellEdit(r,function(e,t,a,i){var n=!1;if(r.index=r.serviceInclusionsGrid.data.indexOf(e),r.bedClassListServ=angular.copy(r.serviceInclusionsGrid.data[r.index].bedClassArray),e.BedClassEnabling){for(var l=0;l<r.bedClassListServ.length;l++)t.displayName==r.bedClassListServ[l].bedName&&(n=!0,r.bedClassListServ[l].bedAmount=a,r.serviceInclusionsGrid.data[r.index].bedClassArray=r.bedClassListServ);if(0==n){var o=s.getModelByName(r.multiBed,t.displayName);r.bedClassListServ[r.bedClassListServ.length]={bedName:t.displayName,bedAmount:a,limit:0,bedCode:o.gQDataCode},r.serviceInclusionsGrid.data[r.index].bedClassArray=r.bedClassListServ}}})},r.mtrlInclusionsGrid.onRegisterApi=function(e){r.mtrlInclusionsGridApi=e,e.edit.on.afterCellEdit(r,function(e,t,a,i){var n=!1;if(r.matIndex=r.mtrlInclusionsGrid.data.indexOf(e),r.bedClassListMtrl=angular.copy(r.mtrlInclusionsGrid.data[r.matIndex].MatBedClassArray),e.MatBedClassEnabling){for(var l=0;l<r.bedClassListMtrl.length;l++)t.displayName==r.bedClassListMtrl[l].bedName&&(n=!0,r.bedClassListMtrl[l].bedAmount=a,r.mtrlInclusionsGrid.data[r.matIndex].MatBedClassArray=r.bedClassListMtrl);if(0==n){var o=s.getModelByName(r.multiBed,t.displayName);r.bedClassListMtrl[r.bedClassListMtrl.length]={bedName:t.displayName,bedAmount:a,limit:0,bedCode:o.gQDataCode},r.mtrlInclusionsGridApi.data[r.matIndex].MatBedClassArray=r.bedClassListMtrl}}})},r.clearServiceIncForm=function(e){e.deptEdit1=void 0,e.deptSubEdit1=void 0,e.serviceEdit1=void 0,e.serLimit=void 0,e.fDate=new Date,e.tDate=void 0,e.quantityValue=void 0,e.amountValue=void 0},r.addValuesToDynamicColumns=function(e,t){for(var a=6;a<e.columnDefs.length-4;a++)"nolimit"==r.inclusionEditObject.serLimit?(t[e.columnDefs[a].field]="N/L",t.BedClassEnabling=!1):"quantity"==r.inclusionEditObject.serLimit&&(t[e.columnDefs[a].field]=t.qunatity,t.BedClassEnabling=!1)},r.addValuesToMatDynamicColumns=function(e,t){for(var a=6;a<e.columnDefs.length-4;a++)"nolimit"==r.inclusionEditObject.mtrlLimit?(t[e.columnDefs[a].field]="N/L",t.MatBedClassEnabling=!1):"quantity"==r.inclusionEditObject.mtrlLimit&&(t[e.columnDefs[a].field]=t.qunatity,t.MatBedClassEnabling=!1)},r.addMaterialIncRow=function(e){r.mtrlLimit=e.mtrlLimit;var t="";if(!(e.mgrEdit&&e.mtrlLimit&&e.dateFrom)){a=r.myObj.plzSlctMandFild;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),!1}if(!("amount"==e.mtrlLimit&&e.amountValue1||"quantity"==e.mtrlLimit&&e.quantityValue1||"nolimit"==e.mtrlLimit)){var a=r.myObj.plzFilMandFild;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),!1}if(e.mgrSubEdit||(r.mgrSubCode=0,r.mgrSubName="--"),e.mtrlNameEdit||(r.mtrlIncName="--",r.mtrlIncCode=0),null!=e.amountValue1)for(var i=0;i<r.bedClassListMtrl.length;i++)r.bedClassListMtrl[i].bedAmount=0,r.bedClassListMtrl[i].limit=0;else e.amountValue1="--";if(null!=e.quantityValue1)for(i=0;i<r.bedClassListMtrl.length;i++)r.bedClassListMtrl[i].bedAmount=0,r.bedClassListMtrl[i].limit=e.quantityValue1;else e.quantityValue1="--";if("nolimit"==e.mtrlLimit){for(i=0;i<r.bedClassListMtrl.length;i++)r.bedClassListMtrl[i].bedAmount="N/L",r.bedClassListMtrl[i].limit=0;t="N/L",r.MatBedClassEnabling=!1}else t="--",r.MatBedClassEnabling=!0;if(e.dateTo)var s=n("date")(e.dateTo,"yyyy-MM-dd");else var o="9999-12-31",c=r.tDate,d=n("date")(new Date(c),"yyyy-MM-dd");r.addRowToMaterialInclusionGridObject={MTRGRPSEQID:e.mgrEdit.gQDataCode,materialGroup:e.mgrEdit.gQDataName,MTRSUBGRPSEQID:null==e.mgrSubEdit?r.mgrSubCode:e.mgrSubEdit.gQDataCode,materialSubGroup:null==e.mgrSubEdit?r.mgrSubName:e.mgrSubEdit.gQDataName,materialName:null==e.mtrlNameEdit?r.mtrlIncName:e.mtrlNameEdit.gQDataName,MTRLCODE:null==e.mtrlNameEdit?r.mtrlIncCode:e.mtrlNameEdit.gQDataCode,amount:"--"==e.amountValue1?0:e.amountValue1,qunatity:"--"==e.quantityValue1?0:e.quantityValue1,noLimit:t,validFrom:n("date")(e.dateFrom,"yyyy-MM-dd"),validTo:"9999-12-31"==o?d:n("date")(s,"yyyy-MM-dd"),MatBedClassArray:r.bedClassListMtrl,MatBedClassEnabling:r.MatBedClassEnabling},r.addValuesToMatDynamicColumns(r.mtrlInclusionsGrid,r.addRowToMaterialInclusionGridObject),r.gridTemplate=[];for(var p=0;p<r.mtrlInclusionsGrid.data.length;p++){if(r.mtrlInclusionsGrid.data[p].materialGroup==e.mgrEdit.gQDataName&&r.mtrlInclusionsGrid.data[p].materialSubGroup==e.mgrSubEdit.gQDataName&&r.mtrlInclusionsGrid.data[p].materialName==e.mtrlNameEdit.gQDataName){var a=r.myObj.dataAlrdyexist;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),r.gridTemplate=null,!1}p==r.mtrlInclusionsGrid.data.length-1&&(r.gridTemplate=r.addRowToMaterialInclusionGridObject)}!("amount"==e.mtrlLimit&&0==parseInt(e.amountValue1)||"quantity"==e.mtrlLimit&&0==parseInt(e.quantityValue1))?(e.matInc_isZero=!1,0==r.mtrlInclusionsGrid.data.length&&(r.gridTemplate=r.addRowToMaterialInclusionGridObject),null!=r.gridTemplate&&(r.mtrlInclusionsGrid.data.push(r.gridTemplate),r.clearMaterialIncForm(e))):e.matInc_isZero=!0},r.clearMaterialIncForm=function(e){e.mgrEdit=void 0,e.mgrSubEdit=void 0,e.mtrlNameEdit=void 0,e.mtrlLimit=void 0,e.dateFrom=new Date,e.dateTo=void 0,e.amountValue1=void 0,e.quantityValue1=void 0},r.addServiceExcRow=function(e){if(null!=e.deptEdit&&""!=e.deptEdit&&null!=e.deptSubEdit&&""!=e.deptSubEdit){null==e.serviceEdit||""==e.serviceEdit||null==e.serviceEdit?(r.seviceExCode=0,r.seviceExName="--"):(r.seviceExCode=e.serviceEdit.gQDataCode,r.seviceExName=e.serviceEdit.gQDataName),r.addRowToServiceExclusionGridObject={DEPTCODE:e.deptEdit.gQDataCode,department:e.deptEdit.gQDataName,SUBDEPTCODE:e.deptSubEdit.gQDataCode,subDepartment:e.deptSubEdit.gQDataName,service:r.seviceExName,EXCLSERVSEQID:r.seviceExCode},r.gridTemplate=[];for(var t=0;t<D.serviceExclusionsGrid.data.length;t++){if(D.serviceExclusionsGrid.data[t].department==e.deptEdit.gQDataName&&D.serviceExclusionsGrid.data[t].subDepartment==e.deptSubEdit.gQDataName&&D.serviceExclusionsGrid.data[t].service==r.seviceExName){var a=r.myObj.dataAlrdyexist;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),r.gridTemplate=null,!1}t==D.serviceExclusionsGrid.data.length-1&&(r.gridTemplate=r.addRowToServiceExclusionGridObject)}for(var i=0,n=0;n<r.serviceInclusionsGrid.data.length;n++)e.deptEdit.gQDataCode.toString().trim()!=r.serviceInclusionsGrid.data[n].DEPTCODE.toString().trim()||(i=1);for(var s=0;s<r.serviceInclusionsGrid.data.length;s++){if(r.ipSrvEx_dupCheck=!1,e.deptEdit==r.serviceInclusionsGrid.data[s].DEPTCODE&&e.deptSubEdit==r.serviceInclusionsGrid.data[s].SUBDEPTID&&0==r.seviceExCode){a=r.myObj.plzSlctValidExl;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),void(r.ipSrvEx_dupCheck=!0)}if(r.seviceExCode==r.serviceInclusionsGrid.data[s].INCLSERVSEQID&&e.deptEdit.gQDataCode.toString().trim()==r.serviceInclusionsGrid.data[s].DEPTCODE.toString().trim()&&e.deptSubEdit.gQDataCode==r.serviceInclusionsGrid.data[s].SUBDEPTID){a=r.myObj.dataAldyIncd;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),void(r.ipSrvEx_dupCheck=!0)}}if(null!=r.gridTemplate&&1==i&&0==r.ipSrvEx_dupCheck)0==D.serviceExclusionsGrid.data.length&&(r.gridTemplate=r.addRowToServiceExclusionGridObject),D.serviceExclusionsGrid.data.push(r.gridTemplate),r.clearServiceExcForm(e);else{a=r.myObj.plzSlctValidExl;l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3)}}else{a=r.myObj.plzSlctMandFild;l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3)}},r.clearServiceExcForm=function(e){e.deptEdit=void 0,e.deptSubEdit=void 0,e.serviceEdit=void 0},r.addMaterialExcRow=function(e){if(null!=e.mgrEdit1&&""!=e.mgrEdit1&&null!=e.mgrSubEdit1&&""!=e.mgrSubEdit1){null==e.mtrlNameEdit1||""==e.mtrlNameEdit1||null==e.mtrlNameEdit1?(r.mtrlExName="--",r.mtrlExCode=0):(r.mtrlExName=e.mtrlNameEdit1.gQDataName,r.mtrlExCode=e.mtrlNameEdit1.gQDataCode),r.addRowToMaterailExclusionGridObject={MTRLMAINCODE:e.mgrEdit1.gQDataCode,materialGroup:e.mgrEdit1.gQDataName,MTRLSUBCODE:e.mgrSubEdit1.gQDataCode,materialSubGroup:e.mgrSubEdit1.gQDataName,materialName:r.mtrlExName,MTRLCODE:r.mtrlExCode},r.gridTemplate=[];for(var t=0;t<r.mtrlExclusionsGrid.data.length;t++){if(r.mtrlExclusionsGrid.data[t].materialGroup==e.mgrEdit1.gQDataName&&r.mtrlExclusionsGrid.data[t].materialSubGroup==e.mgrSubEdit1.gQDataName&&r.mtrlExclusionsGrid.data[t].materialName==r.mtrlExName){var a=r.myObj.dataAlrdyexist;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),r.gridTemplate=null,!1}t==r.mtrlExclusionsGrid.data.length-1&&(r.gridTemplate=r.addRowToMaterailExclusionGridObject)}for(var i=0,n=0;n<r.mtrlInclusionsGrid.data.length;n++)e.mgrEdit1.gQDataCode!=r.mtrlInclusionsGrid.data[n].MTRGRPSEQID||(i=1);for(var s=0;s<r.mtrlInclusionsGrid.data.length;s++){if(r.ipMatEx_dupCheck=!1,0==r.mtrlExCode&&e.mgrEdit1.gQDataCode==r.mtrlInclusionsGrid.data[s].MTRGRPSEQID&&e.mgrSubEdit1.gQDataCode==r.mtrlInclusionsGrid.data[s].MTRSUBGRPSEQID){a=r.myObj.plzSlctValidExl;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),void(r.ipMatEx_dupCheck=!0)}if(r.mtrlExCode==r.mtrlInclusionsGrid.data[s].MTRLCODE&&e.mgrEdit1.gQDataCode==r.mtrlInclusionsGrid.data[s].MTRGRPSEQID&&e.mgrSubEdit1.gQDataCode==r.mtrlInclusionsGrid.data[s].MTRSUBGRPSEQID){a=r.myObj.dataAldyIncd;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3),void(r.ipMatEx_dupCheck=!0)}}if(null!=r.gridTemplate&&1==i&&0==r.ipMatEx_dupCheck)0==r.mtrlExclusionsGrid.data.length&&(r.gridTemplate=r.addRowToMaterailExclusionGridObject),r.mtrlExclusionsGrid.data.push(r.gridTemplate),r.clearMaterialExcForm(e);else{a=r.myObj.plzSlctValidExl;l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3)}}else{a=r.myObj.plzSlctallFlds;l.hisAlertMulti("warning",r.myObj.alertTypeWarn,a,!1,!1,r.close,2e3)}},r.clearMaterialExcForm=function(e){e.mgrEdit1=void 0,e.mgrSubEdit1=void 0,e.mtrlNameEdit1=void 0},r.editServiceInc=function(e,t,a){r.packDis(),r.savebtn=!0,0!=e.entity.amount&&(r.serviceInclusionsGrid.data[t].BedClassEnabling=!0);var i=[];r.isServiceInclusionAdd=!1;for(var n=0;n<a.columns.length&&"validFrom"!=a.columns[n].colDef.name;n++)n>5&&i.push(a.columns[n].colDef.name);r.inclusionEditObject.example15model=i,r.inclusionEditObject.deptEdit1=s.getModelByName(r.multiDept1,e.entity.department),r.serviceInclusionEditRowId=t,r.getMultiSubDept1(r.inclusionEditObject.deptEdit1).then(function(t){r.inclusionEditObject.deptSubEdit1=null==e.entity.subDepartment?"":s.getModelByName(t[1],e.entity.subDepartment),r.getMultiService1(r.inclusionEditObject.deptEdit1,r.inclusionEditObject.deptSubEdit1).then(function(t){r.inclusionEditObject.serviceEdit1=null==e.entity.service?"":s.getModelByName(t[1],e.entity.service)})}),r.inclusionEditObject.serLimit=null,"N/L"==e.entity.noLimit?(r.inclusionEditObject.serLimit="nolimit",r.inclusionEditObject.nolimitValue=e.entity.nolimit):null!=e.entity.qunatity&&0!=e.entity.qunatity?(r.inclusionEditObject.serLimit="quantity",r.inclusionEditObject.quantityValue=e.entity.qunatity):null!=e.entity.amount&&0!=e.entity.amount&&(r.inclusionEditObject.serLimit="amount",r.inclusionEditObject.amountValue=e.entity.amount),r.inclusionEditObject.fDate=new Date(e.entity.validFrom),r.inclusionEditObject.tDate=new Date(e.entity.validTo)},r.editServiceExc=function(e,t){r.serviceExcIndex=t,r.isServExclAdd=!1,r.ExclusionEditObject.deptEdit=s.getModelByName(r.multiDept,e.entity.department),r.getMultiSubDept(r.ExclusionEditObject.deptEdit).then(function(t){r.ExclusionEditObject.deptSubEdit=s.getModelByName(t[1],e.entity.subDepartment),r.getMultiService(r.ExclusionEditObject.deptEdit,r.ExclusionEditObject.deptSubEdit).then(function(t){r.ExclusionEditObject.serviceEdit=null==e.entity.service?"":s.getModelByName(t[1],e.entity.service)})}),r.savebtn=!0},r.editMaterialInc=function(e,t,a){0!=e.entity.amount&&(r.mtrlInclusionsGrid.data[t].MatBedClassEnabling=!0),r.MaterialIncIndex=t,r.isMatInclusionAdd=!1;for(var i=[],n=0;n<a.columns.length&&"validFrom"!=a.columns[n].colDef.name;n++)n>5&&i.push(a.columns[n].colDef.name);r.inclusionEditObject.example14model=i,r.inclusionEditObject.mgrEdit=s.getModelByName(r.multiGroup,e.entity.materialGroup),r.getMultiSubGroup(r.inclusionEditObject.mgrEdit).then(function(t){r.inclusionEditObject.mgrSubEdit=null==e.entity.materialSubGroup?"":s.getModelByName(t[1],e.entity.materialSubGroup),r.getMultiName(r.inclusionEditObject.mgrEdit,r.inclusionEditObject.mgrSubEdit).then(function(t){r.inclusionEditObject.mtrlNameEdit=null==e.entity.materialName?"":s.getModelByName(t[1],e.entity.materialName)})}),r.inclusionEditObject.mtrlLimit=null,"N/L"==e.entity.noLimit?(r.inclusionEditObject.mtrlLimit="nolimit",r.nolimitValue=e.entity.nolimit):null!=e.entity.amount&&0!=e.entity.amount?(r.inclusionEditObject.mtrlLimit="amount",r.inclusionEditObject.amountValue1=e.entity.amount):null!=e.entity.qunatity&&0!=e.entity.qunatity&&(r.inclusionEditObject.mtrlLimit="quantity",r.inclusionEditObject.quantityValue1=e.entity.qunatity),r.inclusionEditObject.dateFrom=new Date(e.entity.validFrom),r.inclusionEditObject.dateTo=new Date(e.entity.validTo),r.savebtn=!0},r.editMaterialExc=function(e,t){r.MatExcIndex=t,r.isMatExclAdd=!1,r.ExclusionEditObject.mgrEdit1=s.getModelByName(r.multiGroup1,e.entity.materialGroup),r.getMultiSubGroup1(r.ExclusionEditObject.mgrEdit1).then(function(t){r.ExclusionEditObject.mgrSubEdit1=s.getModelByName(t[1],e.entity.materialSubGroup),r.getMultiName1(r.ExclusionEditObject.mgrEdit1,r.ExclusionEditObject.mgrSubEdit1).then(function(t){r.ExclusionEditObject.mtrlNameEdit1=null==e.entity.materialName?"":s.getModelByName(t[1],e.entity.materialName)})}),r.savebtn=!0},r.deleteServiceInc=function(e){r.serIncDelIndex=r.serviceInclusionsGrid.data.indexOf(e.entity)},r.delSrvIncRec=function(e){r.serviceInclusionsGrid.data.splice(e,1);var t=r.myObj.delSucesFuly;l.hisAlertMulti("success",r.myObj.alertTypeSucss,t,!1,!1,r.close,2e3)},r.deleteServiceExc=function(e){r.serExcDelIndex=D.serviceExclusionsGrid.data.indexOf(e.entity)},r.delSrvExcRec=function(e){D.serviceExclusionsGrid.data.splice(e,1);var t=r.myObj.delSucesFuly;l.hisAlertMulti("success",r.myObj.alertTypeSucss,t,!1,!1,r.close,2e3)},r.deleteMaterialExc=function(e){r.mtrlExcDelIndex=r.mtrlExclusionsGrid.data.indexOf(e.entity)},r.delMtrlExcRec=function(e){r.mtrlExclusionsGrid.data.splice(e,1);var t=r.myObj.delSucesFuly;l.hisAlertMulti("success",r.myObj.alertTypeSucss,t,!1,!1,r.close,2e3)},r.deleteMaterialInc=function(e){r.mtrlIncDelIndex=r.mtrlInclusionsGrid.data.indexOf(e.entity)},r.delMtrlIncRec=function(e){r.mtrlInclusionsGrid.data.splice(e,1);var t=r.myObj.delSucesFuly;l.hisAlertMulti("success",r.myObj.alertTypeSucss,t,!1,!1,r.close,2e3)},r.updateSerInc=function(e){if(!(e.deptEdit1&&e.fDate&&e.serLimit)){var t=r.myObj.plzSlctMandFild;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,t,!1,!1,r.close,2e3),!1}if(r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].BedClassEnabling=!1,r.isServiceInclusionAdd=!0,"quantity"==e.serLimit){e.amountValue=0,e.nolimitValue=0;for(var a=0;a<r.bedClassListServ.length;a++)r.bedClassListServ[a].bedAmount=0,r.bedClassListServ[a].limit=e.quantityValue}if("amount"==e.serLimit&&(e.quantityValue=0,e.nolimitValue=0),"nolimit"==e.serLimit){e.quantityValue=0,e.amountValue=0,e.nolimitValue="N/L";for(a=0;a<r.bedClassListServ.length;a++)r.bedClassListServ[a].bedAmount="N/L",r.bedClassListServ[a].limit=0}e.quantityValue||(e.quantityValue=0),"nolimit"!=e.serLimit&&(e.nolimitValue=0),r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].DEPTCODE=e.deptEdit1.gQDataCode,r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].department=e.deptEdit1.gQDataName,r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].SUBDEPTCODE=e.deptSubEdit1?e.deptSubEdit1.gQDataCode:"",r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].subDepartment=e.deptSubEdit1?e.deptSubEdit1.gQDataName:"",r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].service=e.serviceEdit1?e.serviceEdit1.gQDataName:"",r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].INCLSERVSEQID=e.serviceEdit1?e.serviceEdit1.gQDataCode:"",r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].amount=e.amountValue,r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].qunatity=e.quantityValue,r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].noLimit=e.nolimitValue,r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].validFrom=n("date")(e.fDate,"yyyy-MM-dd"),r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].validTo=n("date")(new Date(e.tDate),"yyyy-MM-dd"),r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId].bedClassArray=angular.copy(r.bedClassListServ),r.addValuesToDynamicColumns(r.serviceInclusionsGrid,r.serviceInclusionsGrid.data[r.serviceInclusionEditRowId]),r.clearServiceIncForm(e),r.savebtn=!1},r.updateSerExc=function(e){if(r.isServExclAdd=!0,null==e.deptEdit||""==e.deptEdit||null==e.deptSubEdit||""==e.deptSubEdit||null==e.serviceEdit||""==e.serviceEdit){var t=r.myObj.plzSlctallFlds;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,t,!1,!1,r.close,2e3),!1}D.serviceExclusionsGrid.data[r.serviceExcIndex].EXCLSERVSEQID=e.serviceEdit?e.serviceEdit.gQDataCode:"",D.serviceExclusionsGrid.data[r.serviceExcIndex].service=e.serviceEdit?e.serviceEdit.gQDataName:"",D.serviceExclusionsGrid.data[r.serviceExcIndex].DEPTCODE=e.deptEdit.gQDataCode,D.serviceExclusionsGrid.data[r.serviceExcIndex].department=e.deptEdit.gQDataName,D.serviceExclusionsGrid.data[r.serviceExcIndex].SUBDEPTCODE=e.deptSubEdit.gQDataCode,D.serviceExclusionsGrid.data[r.serviceExcIndex].subDepartment=e.deptSubEdit.gQDataName,r.clearServiceExcForm(e),r.savebtn=!1},r.updateMtrlInc=function(e){if(!(e.mgrEdit&&e.mtrlLimit&&e.dateFrom)){var t=r.myObj.plzSlctMandFild;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,t,!1,!1,r.close,2e3),!1}if(r.mtrlInclusionsGrid.data[r.MaterialIncIndex].MatBedClassEnabling=!1,r.isMatInclusionAdd=!0,e.nolimitValue="","quantity"==e.mtrlLimit){e.amountValue1=0,e.nolimitValue=0;for(var a=0;a<r.bedClassListMtrl.length;a++)r.bedClassListMtrl[a].bedAmount=0,r.bedClassListMtrl[a].limit=e.quantityValue1}if("amount"==e.mtrlLimit&&(e.quantityValue1=0,e.nolimitValue=0),"nolimit"==e.mtrlLimit){e.quantityValue1=0,e.amountValue1=0,e.nolimitValue="N/L";for(a=0;a<r.bedClassListMtrl.length;a++)r.bedClassListMtrl[a].bedAmount="N/L",r.bedClassListMtrl[a].limit=0}e.quantityValue1||(e.quantityValue1=0),"nolimit"!=e.mtrlLimit&&(e.nolimitValue=0),r.mtrlInclusionsGrid.data[r.MaterialIncIndex].MTRLCODE=e.mtrlNameEdit?e.mtrlNameEdit.gQDataCode:"",r.mtrlInclusionsGrid.data[r.MaterialIncIndex].materialName=e.mtrlNameEdit?e.mtrlNameEdit.gQDataName:"",r.mtrlInclusionsGrid.data[r.MaterialIncIndex].MTRGRPSEQID=e.mgrEdit.gQDataCode,r.mtrlInclusionsGrid.data[r.MaterialIncIndex].materialGroup=e.mgrEdit.gQDataName,r.mtrlInclusionsGrid.data[r.MaterialIncIndex].MTRSUBGRPSEQID=e.mgrSubEdit?e.mgrSubEdit.gQDataCode:"",r.mtrlInclusionsGrid.data[r.MaterialIncIndex].materialSubGroup=e.mgrSubEdit?e.mgrSubEdit.gQDataName:"",r.mtrlInclusionsGrid.data[r.MaterialIncIndex].qunatity=e.quantityValue1,r.mtrlInclusionsGrid.data[r.MaterialIncIndex].noLimit=e.nolimitValue,r.mtrlInclusionsGrid.data[r.MaterialIncIndex].amount=e.amountValue1,r.mtrlInclusionsGrid.data[r.MaterialIncIndex].validFrom=n("date")(e.dateFrom,"yyyy-MM-dd"),r.mtrlInclusionsGrid.data[r.MaterialIncIndex].validTo=n("date")(new Date(e.dateTo),"yyyy-MM-dd"),r.mtrlInclusionsGrid.data[r.MaterialIncIndex].MatBedClassArray=angular.copy(r.bedClassListMtrl),r.addValuesToMatDynamicColumns(r.mtrlInclusionsGrid,r.mtrlInclusionsGrid.data[r.MaterialIncIndex]),r.clearMaterialIncForm(e),r.savebtn=!1},r.updateMtrlExc=function(e){if(r.isMatExclAdd=!0,null!=e.mgrEdit1&&""!=e.mgrEdit1&&null!=e.mgrSubEdit1&&""!=e.mgrSubEdit1&&null!=e.mtrlNameEdit1&&""!=e.mtrlNameEdit1)r.mtrlExclusionsGrid.data[r.MatExcIndex].MTRLCODE=e.mtrlNameEdit1?e.mtrlNameEdit1.gQDataCode:"",r.mtrlExclusionsGrid.data[r.MatExcIndex].materialName=e.mtrlNameEdit1?e.mtrlNameEdit1.gQDataName:"",r.mtrlExclusionsGrid.data[r.MatExcIndex].MTRLMAINCODE=e.mgrEdit1.gQDataCode,r.mtrlExclusionsGrid.data[r.MatExcIndex].materialGroup=e.mgrEdit1.gQDataName,r.mtrlExclusionsGrid.data[r.MatExcIndex].MTRLSUBCODE=e.mgrSubEdit1.gQDataCode,r.mtrlExclusionsGrid.data[r.MatExcIndex].materialSubGroup=e.mgrSubEdit1.gQDataName,r.clearMaterialExcForm(e),r.savebtn=!1;else{var t=r.myObj.plzSlctallFlds;l.hisAlertMulti("warning",r.myObj.alertTypeWarn,t,!1,!1,r.close,2e3)}},r.changeGender=function(e){r.gender=e},r.changeAlias=function(e){r.aliasName=e},r.objectssss=function(){var e=n("date")(r.fDateM,"yyyy-MM-dd"),t=n("date")(null==r.tDate?"9999-12-31":r.tDate,"yyyy-MM-dd");if(r.PDFormObj={facilitySeqId:r.facilitySeqId,defDeptCode:r.defDeptCode,subDeptSeqId:r.subDeptSeqId,packageType:r.packType.gQDataCode,packgSeqId:r.packgSeqId,servName:r.servName,gender:null==r.gender?"003":r.gender.gQDataCode,encntrDays:r.endays,packgDays:r.pkgDays,servAltName:r.aliasName,servFromDate:e+"T00:00:00.001Z",servToDate:n("date")(new Date(t),"yyyy-MM-dd")+"T00:00:00.001Z"},r.bedClsObj=[],0!=r.tot&&null!=r.tot&&null!=r.tot&&""!=r.tot){var a={cslSeqId:r.cslSeqId,icuDays:r.icuDays,preProcDays:r.regDays,regularDays:r.preProcedure,totalDays:r.tot};r.bedClsObj.push(a)}r.servIncObj=[],r.mtrlIncObj=[],r.servExcObj=[],r.mtrlExcObj=[],r.servIncObjData=r.serviceInclusionsGrid.data;for(var i=0;i<r.servIncObjData.length;i++)r.servIncObj[i]={"@class":"com.napier.core.masters.vo.CompositeIncludeServiceVo",cisSeqId:r.servIncObjData[i].CISSEQID?r.servIncObjData[i].CISSEQID:void 0,inclServSeqId:r.servIncObjData[i].INCLSERVSEQID?r.servIncObjData[i].INCLSERVSEQID:void 0,isPost:2,isPre:2,isPrint:2,servName:"--"==r.servIncObjData[i].service?"":r.servIncObjData[i].service,deptCode:r.servIncObjData[i].DEPTCODE,subDeptSeqId:r.servIncObjData[i].SUBDEPTID,amount:"--"==r.servIncObjData[i].amount?0:r.servIncObjData[i].amount,qty:"--"==r.servIncObjData[i].qunatity?0:r.servIncObjData[i].qunatity,fromDate:(""==r.servIncObjData[i].validFrom?e:r.servIncObjData[i].validFrom)+"T00:00:00.001Z",toDate:(""==r.servIncObjData[i].validTo?n("date")(new Date(t),"yyyy-MM-dd"):r.servIncObjData[i].validTo)+"T00:00:00.001Z",bedClassWiseLimitsListVo:[{"com.napier.core.masters.vo.BedClassLimitVo":0==r.BedClassLimitFun(i)?[]:r.BedClassLimitFun(i)}]};r.mtrlIncObjData=r.mtrlInclusionsGrid.data;for(i=0;i<r.mtrlIncObjData.length;i++)r.mtrlIncObj[i]={cimSeqId:r.mtrlIncObjData[i].CIMSEQID,isPost:"1",isPre:"1",mtrlCode:r.mtrlIncObjData[i].MTRLCODE,mtrlGrpSeqId:r.mtrlIncObjData[i].MTRGRPSEQID,mtrlGrpSubSeqId:"--"==r.mtrlIncObjData[i].MTRSUBGRPSEQID?"":r.mtrlIncObjData[i].MTRSUBGRPSEQID,amount:"--"==r.mtrlIncObjData[i].amount?0:r.mtrlIncObjData[i].amount,qty:"--"==r.mtrlIncObjData[i].qunatity?0:r.mtrlIncObjData[i].qunatity,frDate:r.mtrlIncObjData[i].validFrom+"T00:00:00.001Z",toDate:r.mtrlIncObjData[i].validTo+"T00:00:00.001Z",mtrlPackBedClassLimitVoList:[{"com.napier.core.masters.vo.MtrlPackBedClassLimitVo":r.mtrlBedClassLimitFun(i)}]};null==D.serviceExclusionsGrid.data?r.servExcObjData=0:r.servExcObjData=D.serviceExclusionsGrid.data;for(i=0;i<r.servExcObjData.length;i++)r.servExcObj[i]={cesSeqId:r.servExcObjData[i].CESSEQID,exclServSeqId:r.servExcObjData[i].EXCLSERVSEQID,deptCode:r.servExcObjData[i].DEPTCODE,subDeptSeqId:r.servExcObjData[i].SUBDEPTCODE};null==r.mtrlExclusionsGrid.data?r.mtrlExcObjData=0:r.mtrlExcObjData=r.mtrlExclusionsGrid.data;for(i=0;i<r.mtrlExcObjData.length;i++)r.mtrlExcObj[i]={cemSeqId:r.mtrlExcObjData[i].CEMSEQID,mtrlCode:r.mtrlExcObjData[i].MTRLCODE,mtrlMainCode:r.mtrlExcObjData[i].MTRLMAINCODE,mtrlSubCode:r.mtrlExcObjData[i].MTRLSUBCODE}},r.BedClassLimitFun=function(e){if(r.servIncObjData=r.serviceInclusionsGrid.data,r.bdclassList=r.servIncObjData[e].bedClassArray,r.BedClassLimit=[],null!=r.bdclassList){if(r.bdclassList.length!=r.bedClassListServ.length){var t=r.myObj.plzFillBedCls;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,t,!1,!1,r.close,2e3),!1}if(null!=r.bdclassList&&0!=r.bdclassList.length&&null!=r.bdclassList.length)for(var a=0;a<r.bdclassList.length;a++){if("N/L"==r.servIncObjData[e].noLimit&&"--"==r.servIncObjData[e].quantity&&(r.bdclassList[a].bedAmount=0,r.bdclassList[a].limit=0),0==r.servIncObjData[e].noLimit&&"--"==r.servIncObjData[e].quantity&&(r.bdclassList[a].bedAmount=0),"--"==r.servIncObjData[e].quantity&&0==r.servIncObjData[e].nolimit&&"--"==r.servIncObjData[e].amount){t=r.myObj.plzFillBedCls;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,t,!1,!1,r.close,2e3),!1}if("N/L"==r.bdclassList[a].bedAmount&&(r.bdclassList[a].bedAmount=0),0!=r.servIncObjData[e].amount&&null!=r.servIncObjData[e].amount&&0==r.bdclassList[a].bedAmount){t=r.myObj.plzFillBedCls;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,t,!1,!1,r.close,2e3),!1}r.BedClassLimit[a]={bedClassSeqId:r.bdclassList[a].bedCode,limit:r.bdclassList[a].limit,inclusionType:2,amount:r.bdclassList[a].bedAmount},null!=r.servIncObjData[e].BEDSEQID&&null!=r.servIncObjData[e].BEDSEQID[a]&&""!=r.servIncObjData[e].BEDSEQID[a]&&null!=r.servIncObjData[e].BEDSEQID[a]&&""!=r.servIncObjData[e].BEDSEQID[a]&&(r.BedClassLimit[a].sbclimitSeqId=r.servIncObjData[e].BEDSEQID[a])}}return r.BedClassLimit},r.mtrlBedClassLimitFun=function(e){if(r.mtrlIncObjData=r.mtrlInclusionsGrid.data,r.matbdClassList1=r.mtrlIncObjData[e].MatBedClassArray,r.mtrlBedClassLimit=[],null!=r.matbdClassList1){if(r.matbdClassList1.length!=r.bedClassListMtrl.length){var t=r.myObj.plzFillBedCls;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,t,!1,!1,r.close,2e3),!1}if(null!=r.matbdClassList1&&0!=r.matbdClassList1.length&&null!=r.matbdClassList1.length)for(var a=0;a<r.matbdClassList1.length;a++){if("N/L"==r.matbdClassList1[a].bedAmount&&(r.matbdClassList1[a].bedAmount=0),0!=r.mtrlIncObjData[e].amount&&null!=r.mtrlIncObjData[e].amount&&0==r.matbdClassList1[a].bedAmount){t=r.myObj.plzFillBedCls;return l.hisAlertMulti("warning",r.myObj.alertTypeWarn,t,!1,!1,r.close,2e3),!1}r.mtrlBedClassLimit[a]={bedClassSeqId:r.matbdClassList1[a].bedCode,limit:r.matbdClassList1[a].limit,inclusionType:2,materialSeqId:r.mtrlIncObjData[e].MTRLCODE,amount:r.matbdClassList1[a].bedAmount},null!=r.mtrlIncObjData[e].BEDSEQID&&null!=r.mtrlIncObjData[e].BEDSEQID[a]&&""!=r.mtrlIncObjData[e].BEDSEQID[a]&&null!=r.mtrlIncObjData[e].BEDSEQID[a]&&""!=r.mtrlIncObjData[e].BEDSEQID[a]&&(r.mtrlBedClassLimit[a].mbclimitSeqId=r.mtrlIncObjData[e].BEDSEQID[a])}}return r.mtrlBedClassLimit},r.preparePackageCheckListGridData=function(e){try{for(var t=0;t<e.length;t++)r.packageCheckListData={},r.packageCheckListData.checkListItemPriority=e[t].CHECK_LIST_ITEM_PRIORITY,r.packageCheckListData.pkgCheckListItemDesc=e[t].PKG_CHECK_LIST_ITEM_DESC,r.packageCheckListData.waitingArea=e[t].WAITING_AREA,r.packageCheckListData.CheckListServiceSeqID=e[t].PKG_CHECK_LIST_SEQ_ID,r.packageCheckListSearchGrid.data.push(r.packageCheckListData)}catch(e){}},r.deleteRecord=function(e,t,a){a.pkgCheckListItemDesc="",a.waitingArea=""},r.prepareCheckListModel=function(){var e=r.packageCheckListGrid.data,t=1;r.checkListObj=[];for(var a=0;a<e.length;a++)""!==e[a].pkgCheckListItemDesc&&void 0!==e[a].pkgCheckListItemDesc&&(r.packageCheckListGridVo={checkListItemPriority:t,pkgCheckListItemDesc:e[a].pkgCheckListItemDesc,waitingArea:e[a].waitingArea,pkgCheckListSeqId:e[a].CheckListServiceSeqID},r.checkListObj.push(r.packageCheckListGridVo),t++)},r.clearPackageChelckListGrid=function(){r.packageCheckListGrid.data=[],r.checkEditclicked=!0,r.packageCheckListSearchGrid.data=[]},r.addExtraRow=function(e){try{r.packageCheckListGrid.data[r.packageCheckListGrid.data.length-1].hideShowRow=!1,r.packageCheckListGrid.data.push({checkListItemPriority:r.packageCheckListGrid.data.length+1,hideShowRow:!0})}catch(e){}},r.permissionsObj=S.rolePermission("T_BL_M_PACKAGE_SEARCH"),null==r.permissionsObj.T_BL_M_PACKAGE_SEARCH_U?(r.permission=!0,r.editPack=!1):(r.permission=!1,r.editPack=!0)}e.$inject=["hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","editIPService","$scope","$filter","hisAlertService","QueryService","serviceInclusionsGrid","serviceExclusionsGrid","mtrlExclusionsGrid","mtrlInclusionsGrid","hisCalDefConstant","packageCheckListSearchGridColumnsData","packageCheckListGridColumnsData","RoleTaskService"],angular.module("napierContainerUi").controller("packageSearchController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f){var C=n.getLanguageToSet();d.changeLanguage(C);var I={};s.loadAlerts(C).then(function(e){(I=e).ok}),this.init=function(e){e.disableType=!1,e.depAgainst=1,e.gridOptionsPayment=angular.copy(S),e.gridOptionsReceiptDetails=angular.copy(v),e.gridOptionsDepositRequest=angular.copy(D),e.gridOptionsDepositHistory=angular.copy(D),e.gridOptionsDepositHistory.columnDefs[0].visible=!1,e.gridOptionsDepositHistory.columnDefs[4].visible=!1,e.gridOptionsDepositRequest.data=[],e.gridOptionsDepositHistory.data=[];var t=e.patientGlobalDtls.subAccSeqId;o.loadDepositTypeCombo(e),o.loadPaymentReceipt(e,t);var a={depositTypeCode:-999,gnDepositStatus:7,depositNo:"",mrNo:"",ipNo:e.patientGlobalDtls.ipNo,patFirstName:"","@class":"com.napier.core.service.vo.deposits.DepositsVo",practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID};c.getGridData(a).then(function(t){if(""!=t.data.HITService.message.deposits[0]){var a=t.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"],i=Array.isArray(a)?a:[a];e.gridOptionsDepositHistory.data=i}});var i={depositTypeCode:-999,gnDepositStatus:6,depositNo:"",mrNo:"",ipNo:e.patientGlobalDtls.ipNo,patFirstName:"","@class":"com.napier.core.service.vo.deposits.DepositsVo",practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID};c.getGridData(i).then(function(t){if(""!=t.data.HITService.message.deposits[0]){var a=t.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"],i=Array.isArray(a)?a:[a];e.gridOptionsDepositRequest.data=i}})},this.changeDeposit=function(e,t){1==e?(t.disableType=!1,t.selectedRequest=void 0,t.payDetails={depositType:void 0},t.gridOptionsPayment.data=[]):(t.disableType=!0,t.payDetails={depositType:void 0},t.gridOptionsPayment.data=[])},this.depositPayment=function(e){var t;if(e.gridOptionsPayment.data.length>0){if((e=e).gridOptionsPayment.data.length>0)if(t=parseFloat(e.gridOptionsPayment.data[0].amtPaid),1==e.depAgainst){var i={"@class":"com.napier.core.service.vo.deposits.DepositsVo",accSeqId:e.patientGlobalDtls.accSeqId,gnDepositStatus:0,depositAmount:t,depositTypeCode:e.gridOptionsPayment.data[0].depositTypeCode,colReqTypeFlow:1,adjustAmount:0,facilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID,gnTranStatus:1,subAccSeqId:e.patientGlobalDtls.subAccSeqId,depositAgainst:5,refSeqId:e.patientBannerDetails.patientReferral.rgSeqId,mrNo:e.patientGlobalDtls.mrNo,rgSeqId:e.patientBannerDetails.patientReferral.rgSeqId,patFirstName:e.patientBannerDetails.patientRecordsDetail.firstName,patMiddleName:e.patientBannerDetails.patientRecordsDetail.middleName,patLastName:e.patientBannerDetails.patientRecordsDetail.lastName,billDepositReasonsList:[{"com.napier.core.service.vo.deposits.DepositsReasonVo":[{depositReason:"",gnDepositStatus:0,depositTranType:0}]}]};(d={billSeqId:"0",tranReqType:1}).rcvdFrmName=e.gridOptionsPayment.data[0].Receivedfrom;var r=[],n=o.savePaymentDataList(d,e.gridOptionsPayment.data,r),s={};s.url=l.HISIPINDENT.URL,s.requestData={operation:"directDeposit",messageId:"savePaymentRefund",destination:"com.napier.core.collections.service.external.PaymentRefundService",message:{"@class":"com.napier.core.collections.vo.DirectDepositVo",depositsVo:i,receiptHeader:n}},a.sendRestRequest(s).then(function(t){var a=t.data.HITService.message.receiptHeader;y.success("Success","Payment done successfully, Receipt No. "+a.receiptNo,!1,!1,f.time),e.afterSave(),e.payDetails={},e.gridOptionsPayment.data=[]})}else if(2==e.depAgainst){var c,d,p=e.depositDetails[0];e.gridOptionsPayment.data[0].actualValue=t,c=e.gridOptionsPayment.data[0].Receivedfrom,(d={}).collSeqId=p.COL_REQ_SEQ_ID,null!=e.selectedRequest?(d.reqAmt=e.selectedRequest.depositAmount,d.rcpAmt=e.selectedRequest.depositAmount,d.ttlAmt=e.selectedRequest.depositAmount):(d.reqAmt=e.depositDetails[0].REQ_AMOUNT,d.rcpAmt=d.reqAmt,d.ttlAmt=d.reqAmt),d.rcvdFrmName=c||"",d.tranReqType=p.TRAN_REQ_TYPE,d.billSeqId=p.BILL_SEQ_ID,d.partialRequestSeqId=e.partialRequestSeqId;r=[];u.savePaymentDataList(d,e.gridOptionsPayment.data,r).then(function(t){var a=t.data.HITService.message[0]["com.napier.core.collections.vo.ReceiptHeader"];y.success("Success","Payment done successfully, Receipt No. "+a.receiptNo,!1,!1,f.time),e.afterSave(),e.payDetails={},e.gridOptionsPayment.data=[]})}}else y.warning("Warning",I.addPaymentBeforeSave)},this.paymentGridRow=function(e){var t=e.payDetails;return 1==e.depAgainst&&angular.isUndefinedOrNull(t.depositType)?(y.warning("Warning",I.PlzFlAlMndtryFlds),!1):angular.isUndefinedOrNull(t.amount)||angular.isUndefinedOrNull(t.receivedFrom)||angular.isUndefinedOrNull(t.paymentMode)?(y.warning("Warning",I.PlzFlAlMndtryFlds),!1):(4!=t.paymentMode.DT_CODE&&9!=t.paymentMode.DT_CODE||!(angular.isUndefinedOrNull(t.cardNumber)||angular.isUndefinedOrNull(t.cardType)||angular.isUndefinedOrNull(t.exMonth)||angular.isUndefinedOrNull(t.exYear)||angular.isUndefinedOrNull(t.cardTranId)))&&(2!=t.paymentMode.DT_CODE&&3!=t.paymentMode.DT_CODE||!(angular.isUndefinedOrNull(t.chqType)||angular.isUndefinedOrNull(t.CHQDDno)||angular.isUndefinedOrNull(t.ChqDDDate)))?5==t.paymentMode.DT_CODE&&angular.isUndefinedOrNull(t.paymentTranType)?(y.warning("Warning",I.PlzFlAlMndtryFlds),!1):7==t.paymentMode.DT_CODE&&(angular.isUndefinedOrNull(t.mobileNumber)||angular.isUndefinedOrNull(t.cardTranId))?(y.warning("Warning",I.PlzFlAlMndtryFlds),!1):8==t.paymentMode.DT_CODE&&(angular.isUndefinedOrNull(t.cardTranId)||angular.isUndefinedOrNull(t.bankName))?(y.warning("Warning",I.PlzFlAlMndtryFlds),!1):e.gridOptionsPayment.data.length>0?(y.warning("Warning",I.depositReqWarning),!1):(e.gridOptionsPayment.data.push({depositTypeCode:t.depositType?t.depositType.DEPOSIT_TYPE_CODE:void 0,PayMode:t.paymentMode.DETAIL_DESC,PayModeCode:t.paymentMode.DT_CODE,amtPaid:t.amount,Receivedfrom:t.receivedFrom,paymentDate:new Date,cardNumber:t.cardNumber,cardTranId:t.cardTranId,bank:t.bankName?t.bankName.DETAIL_DESC:void 0,bankCode:t.bankName?t.bankName.DT_CODE:void 0,chequeType:t.chqType,chequeDDno:t.CHQDDno,chequeDDDate:t.ChqDDDate,paymentTranType:t.paymentTranType?t.paymentTranType:void 0,mobileNumber:t.mobileNumber,cardExpiryDate:t.exMonth&&t.exYear?t.exMonth.month_id+"/"+t.exYear.year_id:void 0,cardType:t.cardType}),void(e.payDetails={})):(y.warning("Warning",I.PlzFlAlMndtryFlds),!1)},this.paymentGridEdit=function(e,t,a){0!=a.tempPaymentGrid.length&&(a.gridOptionsPayment.data.push(a.tempPaymentGrid),a.tempPaymentGrid=[]),a.payDetails.depositType=a.depositTypeArr.find(t=>t.DEPOSIT_TYPE_CODE==e.depositTypeCode),a.payDetails.paymentMode=a.PmtModehData.find(t=>t.DT_CODE==e.PayModeCode),a.payDetails.amount=parseFloat(e.amtPaid),a.payDetails.receivedFrom=e.Receivedfrom,a.payDetails.cardNumber=e.cardNumber?e.cardNumber:void 0,a.payDetails.cardTranId=e.cardTranId?e.cardTranId:void 0,a.payDetails.bankName=e.bankCode?a.bankNamesData.find(t=>t.DT_CODE==e.bankCode):void 0,a.payDetails.chqType=e.chequeType?e.chequeType:void 0,a.payDetails.CHQDDno=e.chequeDDno?e.chequeDDno:void 0,a.payDetails.ChqDDDate=e.chequeDDDate?e.chequeDDDate:void 0,a.payDetails.paymentTranType=e.paymentTranType?e.paymentTranType:void 0,a.payDetails.mobileNumber=e.mobileNumber?e.mobileNumber:void 0,a.payDetails.exMonth=e.cardExpiryDate?a.cardMonths.find(t=>t.month_id==e.cardExpiryDate.slice(0,2)):void 0,a.payDetails.exYear=e.cardExpiryDate?a.expireYears.find(t=>t.year_id==e.cardExpiryDate.slice(3,5)):void 0,a.payDetails.cardType=e.cardType?e.cardType:void 0,a.tempPaymentGrid=a.gridOptionsPayment.data.splice(t,1)},this.payModeChange=function(e,t){e.payDetails={},e.payDetails.depositType=t.depositType?e.depositTypeArr.find(e=>e.DEPOSIT_TYPE_CODE==t.depositType.DEPOSIT_TYPE_CODE):void 0,e.payDetails.paymentMode=t.paymentMode?e.PmtModehData.find(e=>e.DT_CODE==t.paymentMode.DT_CODE):void 0,e.payDetails.amount=t.amount,e.payDetails.receivedFrom=t.receivedFrom},this.printReceipt=function(e,t,a){var i=e.RECP_NO?e.RECP_NO:e.RECEIPT_NO;u.receiptPrintService(i).then(function(e){if(e.data.HITService.message){var t="napier-his-web/NapierReportServlet?reportName="+(e.data.HITService.message.reportName+""),a=m.host();a=location.host;p.open(location.protocol+"//"+a+"/"+t)}})}}e.$inject=["SCHEDULERAPIS","$timeout","CallManager","$q","QueryService","hisTranslationsGlobalLang","IPINDENTAPIS","hisGenericAlertService","patientBillDepositService","depositRequestService","hisTranslationsService","$window","paymentService","$location","$filter","paymentGridDef","patReceiptDetailsGridDef","requestAndHistoryGridDef","hisAlertService","hisAlertConstants"],angular.module("napierContainerUi").service("patientBillDepositBusinessLogic",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f){var C=this;C.filesUploaded=[],C.uploadedfileNames=[],e.myservice?(C.patientBillWorkList=!1,C.patientBillWorkListDis=!0,"view"==e.pageName?(C.approvalDiscountDisable=!0,C.viewModeButtons=!1,C.uploadDis=!0):(C.approvalDiscountDisable=!1,C.viewModeButtons=!0,C.uploadDis=!1)):(C.patientBillWorkList=!0,C.patientBillWorkListDis=!1,C.approvalDiscountDisable=!0),null!=f&&null!=f.valueObj&&null!=f.valueObj&&""!==f.valueObj&&(e.patientGlobalDtls=angular.fromJson(f.valueObj));var I=void 0;null!=f&&null!=f.billSeqID&&null!=f.billSeqID&&""!==f.billSeqID&&(I=angular.fromJson(f.billSeqID)),n.loadModule("billing");var A=l.getLanguageToSet();n.changeLanguage(A),C.alertObj={},s.loadAlerts(A).then(function(e){C.alertObj=e,C.alertObjBtn={buttonText:C.alertObj.ok},C.alertFunction={buttonCallBack1:function(){}},C.buttonClose={buttonClose:function(){}}}),C.patBanShow=!1,e.services=["Service 1","Service 2","Service 3","Service 4"],C.tariffCatList=[],C.multipleChkDataForList={1:C.tariffCatList};var E=a.executeQueryURLReset();C.tariffCatListArr=new Array,a.prepareParamListWithParam("pDiscName","",C.tariffCatListArr),a.prepareParamListWithParam("pDiscSeqId",-999,C.tariffCatListArr),a.prepareParamListWithParam("pGNSTATUS",1,C.tariffCatListArr),a.executeQueryInput("GET_DISCOUNT_MASTERS_DISTINCT_DATA",C.tariffCatListArr,C.multipleChkDataForList,!0,!0,E,"popUp",{}),e.gridDiscountSerivceApi,e.gridOptionsDiscountSerivce=angular.copy(o),e.gridOptionsDiscountSerivce.onRegisterApi=function(t){e.gridDiscountSerivceApi=t},e.gridOptionsDiscountSerivce.data=[],e.gridOptionsDiscountSerivce.data[0]=[],e.gridDiscountSerivceViewApi,e.gridOptionsDiscountSerivceview=angular.copy(D),e.gridOptionsDiscountSerivceview.onRegisterApi=function(t){e.gridDiscountSerivceViewApi=t},e.gridOptionsDiscountSerivceview.data=[],e.gridOptionsDiscountSerivceview.data[0]=[],e.gridDiscountSaveSerivceApi,e.gridOptionsSaveDiscountSerivce=angular.copy(m),e.gridOptionsSaveDiscountSerivce.onRegisterApi=function(t){e.gridDiscountSaveSerivceApi=t},e.gridOptionsSaveDiscountSerivce.data=[],e.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},e.gridApprovalDiscountSerivceApi,e.gridOptionsApprovalDiscountSerivce=angular.copy(g),e.gridOptionsApprovalDiscountSerivce.onRegisterApi=function(t){e.gridApprovalDiscountSerivceApi=t},e.gridOptionsApprovalDiscountSerivce.data=[],e.alertFlag=!1,e.updateFlag=!1,e.saveFlag=!1,e.discountTextVal=!1,e.discountVal=!1,e.editRowFlag=!1,e.duplicateFlag=!1,C.getDiscountTypeDropDown=function(){C.discountTypeList=[],C.discountTypeList1={1:C.discountTypeList};var t=a.executeQueryURLReset(),i=new Array;a.prepareParamListWithParam("pMasterSqId","6502",i),a.executeQueryInput("TRN003",i,C.discountTypeList1,!0,!0,t,"popUp",{}).then(function(t){C.discountType=t[1][0],C.approvalDiscountValueTextVal=t[1][0],e.gridOptionsDiscountSerivce.data[0].discountType=C.discountType})},C.getDiscountTypeDropDown(),C.getDiscount=function(t){t&&(e.duplicateFlag=!1,e.saveFlag=!0),C.discountList=[],C.discountList1={1:C.discountList};var i=a.executeQueryURLReset(),r=new Array;a.prepareParamListWithParam("pDiscName",t||"",r),a.prepareParamListWithParam("pDiscSeqId",-999,r),a.prepareParamListWithParam("pGNSTATUS",-999,r),a.executeQueryInput("GET_DISCOUNT_MASTERS_DISTINCT_DATA",r,C.discountList1,!0,!0,i,"popUp",{}).then(function(a){if(a&&a[1])for(var i=0;i<a[1].length;i++)if(a[1][i].DISCOUNT_NAME===t)return void(e.duplicateFlag=!0)})},Number.prototype.pad=function(e){for(var t=String(this);t.length<(e||2);)t="0"+t;return t},C.remaingDisountValidation=function(t,i,r){if(I&&I.PACKAGE_OR_BILL_SEQ_ID||C.billSeqID){C.discountDroupDown=!1,C.gridDataList=[],C.getDiscountList=[],C.getDiscountList1={1:C.getDiscountList};var n=a.executeQueryURLReset(),l=new Array;a.prepareParamListWithParam("pBILL_SEQ_ID",I?I.PACKAGE_OR_BILL_SEQ_ID:C.billSeqID?C.billSeqID:void 0,l),a.executeQueryInput("PENDING_DISCOUNT_AMT",l,C.getDiscountList1,!0,!0,n,"popUp",{}).then(function(a){a&&a[1]&&a[1][0]&&a[1][0].PATIENT_AMT-parseFloat(t)<0&&null==r?(2==i.entity.approvalAmountType.DT_CODE?i.entity.approvalAmountValue=i.entity.approvalAmountValue-(parseFloat(t)-a[1][0].PATIENT_AMT):(i.entity.appliedDiscount=i.entity.appliedDiscount-(parseFloat(t)-a[1][0].PATIENT_AMT),i.entity.approvalAmountValue=100*i.entity.appliedDiscount/i.entity.amount),C.changePerAmtValue(i,1),C.approvalCalActualAmt(i,1),i.entity.approvalAmountValue=i.entity.approvalAmountValue.toFixed(2),C.sumTotalDisCountValues(e.gridOptionsApprovalDiscountSerivce.data,"ApprovalGrid",2)):a&&a[1]&&a[1][0]&&parseFloat(a[1][0].PATIENT_AMT)<parseFloat(t)&&"ApprovalBillLevel"==r&&(C.approvalDiscountValueTextVal&&2==C.approvalDiscountValueTextVal.DT_CODE?(parseFloat(a[1][0].PATIENT_AMT)<C.approvedTotalAmtTextVal?C.approvalDiscountTextVal=parseFloat(a[1][0].PATIENT_AMT).toFixed(2):C.approvalDiscountTextVal=C.approvalDiscountTextVal.toFixed(2),C.approvedTotalAmtTextVal=C.approvalDiscountTextVal):C.approvalDiscountValueTextVal&&1==C.approvalDiscountValueTextVal.DT_CODE&&(C.approvalDiscountTextVal=C.approvalDiscountTextVal-100*parseFloat(parseFloat(t)-parseFloat(a[1][0].PATIENT_AMT))/C.billAmt,C.approvalDiscountTextVal=parseFloat(C.approvalDiscountTextVal).toFixed(2),C.approvedTotalAmtTextVal=(C.approvalDiscountTextVal/100*parseFloat(C.billAmt)).toFixed(2)))})}},C.getSelectedItem_New=function(t){C.discountDroupDown=!1,C.gridDataList=[],C.getDiscountList=[],C.getDiscountList1={1:C.getDiscountList};var i=a.executeQueryURLReset(),r=new Array;a.prepareParamListWithParam("pSUB_ACC_SEQ_ID",e.patientGlobalDtls.subAccSeqId,r),a.prepareParamListWithParam("pPLAN_SEQ_ID",e.patientGlobalDtls.insurancePlanSeqId?e.patientGlobalDtls.insurancePlanSeqId:-999,r),a.prepareParamListWithParam("pBED_CLASS",e.patientGlobalDtls.bedClassCode?e.patientGlobalDtls.bedClassCode:-999,r),a.prepareParamListWithParam("pEN_SEQ_ID",e.patientGlobalDtls.encounterSeqId?e.patientGlobalDtls.encounterSeqId:-999,r),a.prepareParamListWithParam("pPAT_TYPE",1,r),a.prepareParamListWithParam("pCON_SEQ_ID",t.discount&&t.discount.CONC_SEQ_ID?t.discount.CONC_SEQ_ID:-999,r),a.prepareParamListWithParam("pPractice_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r),a.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,r),a.prepareParamListWithParam("pBILL_SEQ_ID",I.PACKAGE_OR_BILL_SEQ_ID,r),a.executeQueryInput("GET_BL_GET_PRE_BILL_DISCOUNT_DTLS",r,C.getDiscountList1,!0,!0,i,"popUp",{}).then(function(a){if(e.alertFlag=!0,e.updateFlag=!0,e.gridOptionsDiscountSerivce.data=[],e.gridOptionsDiscountSerivce.data[0]=[],e.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},a&&a[1]&&a[1][0]&&1==a[1][0].IS_BILL_OR_SERVICE_LEVEL){C.discountDroupDownField=!0,C.billAmtField=!0,C.discountValueField=!0,C.totalDiscountAmtField=!0,C.discountRemarksField=!0,C.uploadField=!0,C.remarksField=!0,C.discountTextField=!1,C.discountTypeField=!1;var i={DT_CODE:a[1][0].DISCOUNT_TYPE,DETAIL_DESC:a[1][0].DISCOUNT_TYPE_DESC};C.applicability=a[1][0].IS_BILL_OR_SERVICE_LEVEL,C.discountType=i,C.discountText=a[1][0].DISCOUNT_VALUE,C.gnStatus=a[1][0].GN_STATUS,C.discSeqId=a[1][0].DISC_SEQ_ID,C.discount=t.discount,a[1][0].DISCOUNT_VALUE&&(C.discountValue=a[1][0].DISCOUNT_VALUE.toFixed(2)+" "+a[1][0].DISCOUNT_TYPE_DESC),a[1][0].SERV_RATE&&(C.billAmt=a[1][0].SERV_RATE.toFixed(2)),C.totalDiscountAmt=(C.billAmt*(a[1][0].DISCOUNT_VALUE/100)).toFixed(2),C.BL_PAYER_SEQ_ID=a[1][0].BL_PAYER_SEQ_ID,C.BL_SERV_DTL_SEQ_ID=a[1][0].BL_SERV_DTL_SEQ_ID}if(a&&a[1]&&a[1][0]&&2==a[1][0].IS_BILL_OR_SERVICE_LEVEL){if(C.discountDroupDownField=!0,C.discountRemarksField=!0,C.uploadField=!0,C.remarksField=!0,C.billAmtField=!1,C.discountValueField=!1,C.totalDiscountAmtField=!1,C.discountTextField=!1,C.discountTypeField=!1,C.applicability=a[1][0].IS_BILL_OR_SERVICE_LEVEL,C.gnStatus=a[1][0].GN_STATUS,a[1].length>0&&null!=a[1][0]){e.gridOptionsDiscountSerivce.data=[];for(var r=0;r<a[1].length;r++){var n={},l={};l.CODE=a[1][r].PRI_SERV_SEQ_ID,l.DESCRIPTION=a[1][r].PRIMARY_SERVICE_DESC,n.primayServiceGroup=l;var s={};null!=a[1][r].DEPT_CODE&&null!=a[1][r].DEPT_CODE&&(s.CODE=a[1][r].DEPT_CODE.pad(3),s.DESCRIPTION=a[1][r].DEPT_DESC,n.department=s,C.loadDeptDropdown(l,r));var o={};if(null!=a[1][r].SEPL_CODE&&null!=a[1][r].SEPL_CODE){o.CODE=a[1][r].SEPL_CODE,o.DESCRIPTION=a[1][r].SPL_DESC,n.speciality=o;var c={};c.primayServiceGroup=l,c.department=s,C.OnChangeDept(c,r)}var d={};null!=a[1][r].SERV_SEQ_ID&&null!=a[1][r].SERV_SEQ_ID&&(d.SERV_SEQ_ID=a[1][r].SERV_SEQ_ID,d.SERV_NAME=a[1][r].SERV_DESC,d.CODE=a[1][r].SERV_SEQ_ID,n.service=d);var p={};null!=a[1][r].DISCOUNT_TYPE&&null!=a[1][r].DISCOUNT_TYPE&&(p.DETAIL_DESC=a[1][r].DISCOUNT_TYPE_DESC,p.DT_CODE=a[1][r].DISCOUNT_TYPE,n.discountType=p),n.discSeqId=a[1][r].DISC_SEQ_ID,n.discountName=a[1][r].DISCOUNT_NAME,n.discountValue=a[1][r].DISCOUNT_VALUE.toFixed(2),n.serviceHierarcyLevel=a[1][r].SERVICE_HIERARCHY_LEVEL,n.BL_PAYER_SEQ_ID=a[1][r].BL_PAYER_SEQ_ID,n.BL_SERV_DTL_SEQ_ID=a[1][r].BL_SERV_DTL_SEQ_ID,a[1][r].SERV_RATE&&(n.amount=a[1][r].SERV_RATE.toFixed(2)),a[1][r].SERV_RATE&&(a[1][r].DISCOUNT_TYPE&&1==a[1][r].DISCOUNT_TYPE?a[1][r].DISCOUNT_VALUE?n.appliedDiscount=parseFloat((parseFloat(a[1][r].DISCOUNT_VALUE)/100*parseFloat(a[1][r].SERV_RATE)).toFixed(2)).toFixed(2):a[1][r].SERV_RATE&&(n.appliedDiscount=a[1][r].SERV_RATE.toFixed(2)):parseFloat(a[1][r].DISCOUNT_VALUE)>parseFloat(a[1][r].SERV_RATE)?n.appliedDiscount=parseFloat(a[1][r].SERV_RATE).toFixed(2):n.appliedDiscount=parseFloat(a[1][r].DISCOUNT_VALUE).toFixed(2)),n.isFirstRow=!0,n.isEditable=!0,n.isApprovedDiscountEditable=!0,e.gridOptionsDiscountSerivce.data.push(n)}}2==C.applicability&&1==C.isPredefine?e.gridOptionsDiscountSerivce.columnDefs[10].visible=!1:(e.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},e.gridOptionsDiscountSerivce.columnDefs[10].visible=!0),e.gridOptionsDiscountSerivce.data[0].discountType=C.discountType,C.sumTotalDisCountValues(e.gridOptionsDiscountSerivce.data,"RequestGrid")}})},C.getSelectedItem=function(t){if(t.discount&&""!=t.discount.DISCOUNT_NAME){C.discountDroupDown=!1,C.gridDataList=[],C.getDiscountList=[],C.getDiscountList1={1:C.getDiscountList};var i=a.executeQueryURLReset(),r=new Array;a.prepareParamListWithParam("pDiscName",t.discount?t.discount.DISCOUNT_NAME:"",r),a.prepareParamListWithParam("pDiscSeqId",-999,r),a.executeQueryInput("GET_DISCOUNT_MASTERS_GRID_DATA",r,C.getDiscountList1,!0,!0,i,"popUp",{}).then(function(a){if(e.alertFlag=!0,e.updateFlag=!0,e.gridOptionsDiscountSerivce.data=[],e.gridOptionsDiscountSerivce.data[0]=[],e.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},a&&a[1]&&a[1][0]&&1==a[1][0].IS_BILL_OR_SERVICE_LEVEL){C.discountDroupDownField=!0,C.billAmtField=!0,C.discountValueField=!0,C.totalDiscountAmtField=!0,C.discountRemarksField=!0,C.uploadField=!0,C.remarksField=!0,C.discountTextField=!1,C.discountTypeField=!1;var i={DT_CODE:a[1][0].DISCOUNT_TYPE,DETAIL_DESC:a[1][0].DISCOUNT_TYPE_DESC};C.applicability=a[1][0].IS_BILL_OR_SERVICE_LEVEL,C.discountType=i,C.discountText=a[1][0].DISCOUNT_VALUE,C.gnStatus=a[1][0].GN_STATUS,C.discSeqId=a[1][0].DISC_SEQ_ID,C.discount=t.discount,a[1][0].DISCOUNT_VALUE&&(C.discountValue=a[1][0].DISCOUNT_VALUE+" "+a[1][0].DISCOUNT_TYPE_DESC),C.billAmt=a[1][0].BILL_AMT,C.totalDiscountAmt=C.billAmt*(a[1][0].DISCOUNT_VALUE/100)}if(a&&a[1]&&a[1][0]&&2==a[1][0].IS_BILL_OR_SERVICE_LEVEL){if(C.discountDroupDownField=!0,C.discountRemarksField=!0,C.uploadField=!0,C.remarksField=!0,C.billAmtField=!1,C.discountValueField=!1,C.totalDiscountAmtField=!1,C.discountTextField=!1,C.discountTypeField=!1,C.applicability=a[1][0].IS_BILL_OR_SERVICE_LEVEL,C.gnStatus=a[1][0].GN_STATUS,a[1].length>0&&null!=a[1][0]){e.gridOptionsDiscountSerivce.data=[];for(var r=0;r<a[1].length;r++){var n={},l={};l.CODE=a[1][r].PRI_SERV_SEQ_ID,l.DESCRIPTION=a[1][r].PRIMARY_SERVICE_DESC,n.primayServiceGroup=l;var s={};null!=a[1][r].DEPT_CODE&&null!=a[1][r].DEPT_CODE&&(s.CODE=a[1][r].DEPT_CODE.pad(3),s.DESCRIPTION=a[1][r].DEPT_DESC,n.department=s,C.loadDeptDropdown(l,r+1));var o={};if(null!=a[1][r].SEPL_CODE&&null!=a[1][r].SEPL_CODE){o.CODE=a[1][r].SEPL_CODE,o.DESCRIPTION=a[1][r].SPL_DESC,n.speciality=o;var c={};c.primayServiceGroup=l,c.department=s,C.OnChangeDept(c,r+1)}var d={};null!=a[1][r].SERV_SEQ_ID&&null!=a[1][r].SERV_SEQ_ID&&(d.SERV_SEQ_ID=a[1][r].SERV_SEQ_ID,d.SERV_NAME=a[1][r].SERV_DESC,d.CODE=a[1][r].SERV_SEQ_ID,n.service=d);var p={};null!=a[1][r].DISCOUNT_TYPE&&null!=a[1][r].DISCOUNT_TYPE&&(p.DETAIL_DESC=a[1][r].DISCOUNT_TYPE_DESC,p.DT_CODE=a[1][r].DISCOUNT_TYPE,n.discountType=p),n.discSeqId=a[1][r].DISC_SEQ_ID,n.discountName=a[1][r].DISCOUNT_NAME,n.discountValue=a[1][r].DISCOUNT_VALUE,n.serviceHierarcyLevel=a[1][r].SERVICE_HIERARCHY_LEVEL,n.amount=1e3,a[1][r].DISCOUNT_TYPE&&1==a[1][r].DISCOUNT_TYPE?a[1][r].DISCOUNT_VALUE?n.appliedDiscount=parseFloat((parseFloat(a[1][r].DISCOUNT_VALUE)/100*parseFloat(1e3)).toFixed(2)):n.appliedDiscount=1e3:a[1][r].DISCOUNT_VALUE?n.appliedDiscount=(parseFloat(1e3)-parseFloat(a[1][r].DISCOUNT_VALUE)).toFixed(2):n.appliedDiscount=1e3,n.isFirstRow=!0,n.isEditable=!0,n.isApprovedDiscountEditable=!0,e.gridOptionsDiscountSerivce.data.push(n)}}2==C.applicability&&1==C.isPredefine?e.gridOptionsDiscountSerivce.columnDefs[10].visible=!1:(e.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},e.gridOptionsDiscountSerivce.columnDefs[10].visible=!0),e.gridOptionsDiscountSerivce.data[0].discountType=C.discountType,C.sumTotalDisCountValues(e.gridOptionsDiscountSerivce.data,"RequestGrid")}})}},C.loadCoPayCombo=function(){C.psgdwn_copay=[],C.coPayQueryMap={1:C.psgdwn_copay};var e=a.executeQueryURLReset(),t=new Array;a.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,t),a.executeQueryInput("BL_GET_PSG_SEARCH_SP",t,C.coPayQueryMap,!0,!0,e,"popUp",{}).then(function(e){if(e&&e[1]){C.psgdwn_copay=[];for(var t=0;t<e[1].length&&"N"==e[1][t].IS_MATERIAL;t++)C.psgdwn_copay.push(e[1][t])}})},C.loadCoPayCombo(),C.deptdwn_copay=[],C.loadDeptDropdown=function(t,i){C.deptdwn_copay[i]=[],C.deptQueryMap={1:C.deptdwn_copay[i]};var r=a.executeQueryURLReset(),n=new Array;a.prepareParamListWithParam("pPSG_CODE",t?t.CODE:-999,n),a.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n),a.executeQueryInput("BL_GET_DEPARTMENT_SEARCH_SP",n,C.deptQueryMap,!0,!0,r,"popUp",{}).then(function(t){t[1][0]&&e.gridOptionsDiscountSerivce.data[i].department&&e.gridOptionsDiscountSerivce.data[i].department.CODE&&(e.gridOptionsDiscountSerivce.data[i].department=_.find(C.deptdwn_copay[i],function(t){return t.CODE==e.gridOptionsDiscountSerivce.data[i].department.CODE}))})},C.deptSpecicityService=[],C.OnChangeDept=function(t,i){C.deptSpecicityService[i]=[],C.specilityMap={1:C.deptSpecicityService[i]};var r=a.executeQueryURLReset(),n=new Array;a.prepareParamListWithParam("pPSG_CODE",t&&t.primayServiceGroup?t.primayServiceGroup.CODE:-999,n),a.prepareParamListWithParam("pDEPT_CODE",t&&t.department?t.department.CODE:-999,n),a.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n),a.executeQueryInput("BL_GET_SPECIALITY_SEARCH_SP",n,C.specilityMap,!0,!0,r,"popUp",{}).then(function(a){a[1][0]&&(C.deptSpecicityService[i]=a[1],t.speciality&&t.speciality.CODE&&(e.gridOptionsDiscountSerivce.data[i].speciality=_.find(C.deptSpecicityService[i],function(e){return e.CODE==t.speciality.CODE})))})},C.serchOptimSpeciSerch=function(e,t,i){C.optServSerch=[],C.copayserviceMap={1:C.optServSerch};var r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pPSG_CODE",i&&i.primayServiceGroup?i.primayServiceGroup.CODE:-999,n),a.prepareParamListWithParam("pDEPT_CODE",i&&i.department?i.department.CODE:-999,n),a.prepareParamListWithParam("pSPECL_CODE",i&&i.speciality?i.speciality.CODE:-999,n),a.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n),a.prepareParamListWithParam("pSERV_NAME",e,n),a.executeQueryInput("BL_GET_SERVICE_SEARCH_SP",n,C.copayserviceMap,!0,!0,r,"popUp",{}).then(function(e){if(e[1])return C.optServSerch.map(function(e){return e.CODE=e.SERV_SEQ_ID,C.serchCopayResult=e,e})})},C.serchOptimSpeciSerch(""),C.setdWData=function(t,a){if(t&&(e.gridOptionsDiscountSerivce.data[a]=[],e.gridOptionsDiscountSerivce.data[a].service={},e.gridOptionsDiscountSerivce.data[a].primayServiceGroup={},e.gridOptionsDiscountSerivce.data[a].department={},e.gridOptionsDiscountSerivce.data[a].speciality={},e.gridOptionsDiscountSerivce.data[a].discountType={},e.gridOptionsDiscountSerivce.data[a].primayServiceGroup.CODE=t.PRI_SERV_CODE,e.gridOptionsDiscountSerivce.data[a].primayServiceGroup.DESCRIPTION=t.PRI_SERV_DESC,e.gridOptionsDiscountSerivce.data[a].department.CODE=t.DEPT_CODE,e.gridOptionsDiscountSerivce.data[a].department.DESCRIPTION=t.SEPT_DESC,e.gridOptionsDiscountSerivce.data[a].speciality.CODE=t.SPL_CODE,e.gridOptionsDiscountSerivce.data[a].speciality.DESCRIPTION=t.SPL_DESC,e.gridOptionsDiscountSerivce.data[a].discountType=C.discountType,C.loadDeptDropdown(e.gridOptionsDiscountSerivce.data[a].primayServiceGroup,a),C.OnChangeDept(e.gridOptionsDiscountSerivce.data[a],a),e.gridOptionsDiscountSerivce.data[a].service.SERV_CODE=t.SERV_CODE,e.gridOptionsDiscountSerivce.data[a].service.SERV_NAME=t.SERV_NAME,e.gridOptionsDiscountSerivce.data[a].service.SERV_SEQ_ID=t.SERV_SEQ_ID,e.gridOptionsDiscountSerivce.data[a].service.CODE=t.SERV_SEQ_ID,2==C.isPredefine&&2==C.applicability)){var i=T(t,"serviceLevel");e.gridOptionsDiscountSerivce.data[a].amount=i}},C.discountMasterServiceGridList=function(t,a){if(2==C.applicability&&1==C.isPredefine)return t.isEditable=!0,t.isFirstRow=!0,null==t.primayServiceGroup?void c.warning("warning","Please select Primary Service Group."):null==t.discountValue?void c.warning("warning","Please enter Discount Value."):null==t.amount?void c.warning("warning","Please enter Amount."):void C.sumTotalDisCountValues(e.gridOptionsDiscountSerivce.data,"RequestGrid");if(null!=t.primayServiceGroup)if(null!=t.discountValue)if(null!=t.amount){var i={primayServiceGroup:t.primayServiceGroup,isFirstRow:!0,isEditable:!0,isApprovedDiscountEditable:!0};null!=t.department&&(i.department=t.department),null!=t.speciality&&(i.speciality=t.speciality),null!=t.service&&0!=t.service.length&&(t.service.CODE=t.service.SERV_SEQ_ID,i.service=t.service),null!=t.discountValue&&(i.discountValue=t.discountValue),t.discountType&&(i.discountType=t.discountType),C&&C.discount&&(i.discountName=C.discount.DISCOUNT_NAME?C.discount.DISCOUNT_NAME:C.discount),C&&C.gnStatus&&(i.gnStatus=C.gnStatus),null!=t.amount&&(i.amount=t.amount),null!=t.appliedDiscount&&(i.appliedDiscount=t.appliedDiscount),null!=t.primayServiceGroup&&(i.serviceHierarcyLevel=1),null!=t.primayServiceGroup&&null!=t.department&&(i.serviceHierarcyLevel=2),null!=t.primayServiceGroup&&null!=t.department&&null!=t.speciality&&(i.serviceHierarcyLevel=3),null!=t.primayServiceGroup&&null!=t.department&&null!=t.speciality&&null!=t.service&&0!=t.service.length&&(i.serviceHierarcyLevel=4),2==C.isPredefine&&2==C.applicability&&(i=T(i)),null!=i&&(C.gridValidationForAddition(t,0,i.serviceHierarcyLevel)?c.warning("Warning","Not allowed to add record under same hierarchy",!1,!1,d.time):(C.deptdwn_copay[e.gridOptionsDiscountSerivce.data.length]=angular.copy(C.deptdwn_copay[0]),C.deptSpecicityService[e.gridOptionsDiscountSerivce.data.length]=angular.copy(C.deptSpecicityService[0]),e.gridOptionsDiscountSerivce.data.push(angular.copy(i)),e.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1,isApprovedDiscountEditable:!0},e.gridOptionsDiscountSerivce.data[0].discountType=C.discountType,e.gridOptionsDiscountSerivce.data[0].discountValue="",C.sumTotalDisCountValues(e.gridOptionsDiscountSerivce.data,"RequestGrid")))}else c.warning("warning","Please enter Amount.");else c.warning("warning","Please enter Discount Value.");else c.warning("warning","Please select Primary Service Group.")},C.editRow=function(t,a){if(2==C.applicability&&1==C.isPredefine)t.isEditable=!1,t.isFirstRow=!1;else{if(e.selectedIndex=a,e.editRowFlag=!0,Array.isArray(t))t=Object.assign({},t);let i=angular.copy(t);i.isFirstRow=!1,i.isEditable=!1,e.gridOptionsDiscountSerivce.data[0]=i,C.loadDeptDropdown(t.primayServiceGroup,0),C.OnChangeDept(t,0)}},C.updateDiscountServiceGrid=function(t,a){if(2==C.isPredefine&&2==C.applicability)var i=e.gridOptionsDiscountSerivce.data[e.selectedIndex];if(null!=t.primayServiceGroup)if(null!=t.primayServiceGroup&&null!=t.department&&null!=t.speciality&&null!=t.service&&0!=t.service.length?t.serviceHierarcyLevel=4:null!=t.primayServiceGroup&&null!=t.department&&null!=t.speciality?t.serviceHierarcyLevel=3:null!=t.primayServiceGroup&&null!=t.department?t.serviceHierarcyLevel=2:null!=t.primayServiceGroup&&(t.serviceHierarcyLevel=1),C.gridValidationForAddition(t,e.selectedIndex,t.serviceHierarcyLevel))c.warning("Warning","Not allowed to add record under same hierarchy",!1,!1,d.time);else{if(C.deptdwn_copay[e.gridOptionsDiscountSerivce.data.length]=angular.copy(C.deptdwn_copay[e.selectedIndex]),C.deptSpecicityService[e.gridOptionsDiscountSerivce.data.length]=angular.copy(C.deptSpecicityService[e.selectedIndex]),e.gridOptionsDiscountSerivce.data[e.selectedIndex]=[],e.gridOptionsDiscountSerivce.data[e.selectedIndex].primayServiceGroup={},e.gridOptionsDiscountSerivce.data[e.selectedIndex].department={},e.gridOptionsDiscountSerivce.data[e.selectedIndex].speciality={},e.gridOptionsDiscountSerivce.data[e.selectedIndex].discountType={},e.gridOptionsDiscountSerivce.data[e.selectedIndex].isEditable=!0,e.gridOptionsDiscountSerivce.data[e.selectedIndex].isFirstRow=!0,e.gridOptionsDiscountSerivce.data[e.selectedIndex].isApprovedDiscountEditable=!0,e.gridOptionsDiscountSerivce.data[e.selectedIndex].discountValue=t.discountValue,2==C.isPredefine&&2==C.applicability&&(t=T(t)),null==t)return e.gridOptionsDiscountSerivce.data[e.selectedIndex]=i,e.gridOptionsDiscountSerivce.data[0]=[],e.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1,isApprovedDiscountEditable:!0},e.editRowFlag=!1,e.gridOptionsDiscountSerivce.data[e.selectedIndex].isEditable=!0,e.gridOptionsDiscountSerivce.data[e.selectedIndex].isFirstRow=!0,void(e.gridOptionsDiscountSerivce.data[e.selectedIndex].isApprovedDiscountEditable=!0);e.gridOptionsDiscountSerivce.data[e.selectedIndex].amount=t.amount,e.gridOptionsDiscountSerivce.data[e.selectedIndex].appliedDiscount=t.appliedDiscount,C.discount&&(e.gridOptionsDiscountSerivce.data[e.selectedIndex].discountName=C.discount),C.discount&&C.discount.DISCOUNT_NAME&&(e.gridOptionsDiscountSerivce.data[e.selectedIndex].discountName=C.discount.DISCOUNT_NAME),e.gridOptionsDiscountSerivce.data[e.selectedIndex].serviceHierarcyLevel=t.serviceHierarcyLevel,e.editRowFlag=!1,t.primayServiceGroup&&(e.gridOptionsDiscountSerivce.data[e.selectedIndex].primayServiceGroup.CODE=t.primayServiceGroup.CODE,e.gridOptionsDiscountSerivce.data[e.selectedIndex].primayServiceGroup.DESCRIPTION=t.primayServiceGroup.DESCRIPTION),t.department&&(e.gridOptionsDiscountSerivce.data[e.selectedIndex].department.CODE=t.department.CODE,e.gridOptionsDiscountSerivce.data[e.selectedIndex].department.DESCRIPTION=t.department.DESCRIPTION),t.speciality&&(e.gridOptionsDiscountSerivce.data[e.selectedIndex].speciality.CODE=t.speciality.CODE,e.gridOptionsDiscountSerivce.data[e.selectedIndex].speciality.DESCRIPTION=t.speciality.DESCRIPTION),t.discountType&&(e.gridOptionsDiscountSerivce.data[e.selectedIndex].discountType.DT_CODE=t.discountType.DT_CODE,e.gridOptionsDiscountSerivce.data[e.selectedIndex].discountType.DETAIL_DESC=t.discountType.MASTER_DESC),C.loadDeptDropdown(e.gridOptionsDiscountSerivce.data[e.selectedIndex].primayServiceGroup,e.selectedIndex),C.OnChangeDept(e.gridOptionsDiscountSerivce.data[e.selectedIndex],e.selectedIndex),t.service&&(e.gridOptionsDiscountSerivce.data[e.selectedIndex].service={},e.gridOptionsDiscountSerivce.data[e.selectedIndex].service.SERV_CODE=t.service.SERV_CODE,e.gridOptionsDiscountSerivce.data[e.selectedIndex].service.SERV_NAME=t.service.SERV_NAME,e.gridOptionsDiscountSerivce.data[e.selectedIndex].service.SERV_SEQ_ID=t.service.SERV_SEQ_ID,e.gridOptionsDiscountSerivce.data[e.selectedIndex].service.CODE=t.service.SERV_SEQ_ID),e.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1,isApprovedDiscountEditable:!0},e.gridOptionsDiscountSerivce.data[0].discountType=C.discountType,C.sumTotalDisCountValues(e.gridOptionsDiscountSerivce.data,"RequestGrid")}else c.warning("warning","Please select primary service group")},e.deletedRowData=[],C.deleteRow=function(t,a){e.gridOptionsDiscountSerivce.data.splice(a,1)},C.savePatientBillDiscountMaster=function(t,a){if(2==t.isPredefine&&2==t.applicability&&e.gridOptionsDiscountSerivce.data.length<2&&a&&"Apply"==a)c.warning("Warning","Please select atleast one row",!1,!1,d.time);else if(1==t.isPredefine&&2==t.applicability&&a&&"Apply"==a&&null==C.discount)c.warning("Warning","Please Enter Mandatory Fields",!1,!1,d.time);else if(2==t.isPredefine&&1==t.applicability&&a&&"Apply"==a&&null==C.billAmt)c.warning("Warning","Please Enter Bill Amount.",!1,!1,d.time);else if(2==t.isPredefine&&1==t.applicability&&a&&"Apply"==a&&0==C.discountText.length)c.warning("Warning","Please Enter Discount Value.",!1,!1,d.time);else if(a&&"Apply"==a&&0==C.discountRemarks.length)c.warning("Warning","Please Enter Mandatory Fields",!1,!1,d.time);else if(!a||"Approve"!=a||null!=C.approvalRemarks&&""!=C.approvalRemarks)if(!a||"Reject"!=a||null!=C.approvalRemarks&&""!=C.approvalRemarks){if(t.pbc=C,t.subAccSeqId=e.patientGlobalDtls.subAccSeqId,t.statusOfSave=a,t.connectionNumber=C.connectionNumber,I&&I.PACKAGE_OR_BILL_SEQ_ID&&(t.billSeqId=I.PACKAGE_OR_BILL_SEQ_ID),a&&"Apply"==a)if(1==C.isPredefine&&2==C.applicability)for(var i=[],r=0;r<e.gridOptionsDiscountSerivce.data.length;r++){if(null==e.gridOptionsDiscountSerivce.data[r].primayServiceGroup)return void c.warning("Warning","Please Enter Primay Service Group",!1,!1,d.time);if(null==e.gridOptionsDiscountSerivce.data[r].discountValue)return void c.warning("Warning","Please Enter Discount Value",!1,!1,d.time);if(null==e.gridOptionsDiscountSerivce.data[r].amount)return void c.warning("Warning","Please Enter Amount",!1,!1,d.time);i.push(e.gridOptionsDiscountSerivce.data[r])}else for(i=[],r=1;r<e.gridOptionsDiscountSerivce.data.length;r++)i.push(e.gridOptionsDiscountSerivce.data[r]);else{var n=[];for(i=[],r=0;r<e.gridOptionsApprovalDiscountSerivce.data.length;r++){if(a&&"Approve"==a&&0==e.gridOptionsApprovalDiscountSerivce.data[r].select&&null==e.gridOptionsApprovalDiscountSerivce.data[r].appliedDiscount)return void c.warning("Warning","Please Approved Discount",!1,!1,d.time);i.push(e.gridOptionsApprovalDiscountSerivce.data[r]),e.gridOptionsApprovalDiscountSerivce.data[r].select?n.push(e.gridOptionsApprovalDiscountSerivce.data[r].select):n.push(!1)}if(e.deletedRowData)i=i.concat(e.deletedRowData);t.concStatusFlag=n}p.saveDiscountMasterData(t,i).then(function(t){if(null!=t.data.HITService.message)if(a&&"Apply"!=a)"Approve"==a?c.success("Successfully Approved.","",!1,!1,d.time):c.success("Successfully Rejected.","",!1,!1,d.time),e.$emit("awl.approvalDone",{message:!1});else{c.success("Successfully Saved",""+t.data.HITService.message.concessionReqNo,!1,!1,d.time);for(let e=0;e<C.filesUploaded.length;e++)C.filesUploaded[e].referenceId=t.data.HITService.message.concessionReqSeqId,C.filesUploaded[e].prmryEntityId=t.data.HITService.message.concessionReqSeqId;S.saveDocument(C),e.gridOptionsSaveDiscountSerivce.data=[],C.getPatientBillGridDetails(),C.filesUploaded=[],C.billAmt=[],C.discountValue=[],C.totalDiscountAmt=[],C.discountRemarks=[],C.remarks=[],C.discountText=[],e.gridOptionsDiscountSerivce.data=[],C.applicability=1,C.isPredefine=1,C.discount=[],C.showHideData()}else c.success("Successfully updated","",!1,!1,d.time);null!=t.data.HITService.message&&null!=t.data.HITService.message.errorCode&&c.information("Information",t.data.HITService.message.errorMessage)})}else c.warning("Warning","Please Enter Mandatory Fields",!1,!1,d.time);else c.warning("Warning","Please Enter Mandatory Fields",!1,!1,d.time)},C.clear=function(){(C={}).applicability=1,C.gnStatus=1,C.getDiscount(),C.getDiscountTypeDropDown(),e.gridOptionsDiscountSerivce.data=[],e.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},e.alertFlag=!1,e.updateFlag=!1,e.saveFlag=!1,e.discountTextVal=!1,e.discountVal=!1,e.editRowFlag=!1,e.duplicateFlag=!1},C.openDisMastPopup=function(){hisModalService.open("Discount List",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/DiscountMasters/sections/discount.masters.modal.html",size:"lg",controller:"discountModalCtrl"}).result.then(function(e){if(e){var t={discount:{}};t.discount.DISCOUNT_NAME=e,C.discount=e,C.getSelectedItem(t)}},function(){})},C.validateDiscountVal=function(e,t){var a=void 0;a=1==t?e.approvedDiscount:e.discountValue,e.discountType&&1==e.discountType.DT_CODE&&null!=a&&null!=a&&""!=a&&parseFloat(e.discountValue)>parseFloat(100)&&(e.discountValue=100)},C.validateDiscountText=function(e){e.discountType&&1==e.discountType.DT_CODE&&null!=e.discountText&&null!=e.discountText&&""!=e.discountText&&parseFloat(e.discountText)>parseFloat(100)&&(C.discountText=100,C.discountTextVal=!1)};var h={1:"primayServiceGroup",2:"department",3:"speciality",4:"service"};function b(e){e.filesUploaded=[],e.uploadedfileNames=[],p.getDocument(e).then(function(t){for(var a=0;a<t.length;a++)e.filesUploaded.push({"@class":"com.napier.core.service.vo.uploadfile.NapierDocument",docName:t[a].DOC_NAME,docSeqId:t[a].DOC_SEQ_ID,status:2,machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,fileSize:t[a].FILE_SIZE,trimFileName:S.trimFile(t[a].DOC_NAME),fSize:t[a].FILE_SIZE}),e.uploadedfileNames.push(t[a].DOC_NAME)})}function T(e,t){var a=void 0;e.primayServiceGroup&&e.primayServiceGroup.CODE&&(a=e.primayServiceGroup.CODE),e.department&&e.department.CODE&&(a=a+""+e.department.CODE),e.speciality&&e.speciality.CODE&&(a=a+""+e.speciality.CODE),e.service&&e.service.SERV_SEQ_ID&&(a=a+""+e.service.SERV_SEQ_ID),e.serviceHierarcyLevel&&(a=a+""+e.serviceHierarcyLevel),t&&"serviceLevel"==t&&(a=e.PRI_SERV_CODE+""+e.DEPT_CODE+e.SPL_CODE+e.SERV_SEQ_ID+4);var i=void 0;if(C.adhocValidation)for(var r=0;r<C.adhocValidation.length;r++)if(C.adhocValidation[r].LEVEL==a){i=C.adhocValidation[r].RATE,e.amount=i;break}return t&&"serviceLevel"==t?i:(C.AdhocCalActualAmt(e),null==i&&(e=void 0),e)}C.gridValidationForAddition=function(t,a,i){for(var r=!1,n=e.gridOptionsDiscountSerivce.data,l=1;l<n.length&&l!=a;l++){for(var s=[],o=n[l].serviceHierarcyLevel,c=1;c<=o;c++){if(r=C.validate(t,n[l],h[c]),s.push(r),r&&1==i||r&&1==o)return!0;r=!1}var d=s.filter(function(e){return!0===e}).length;if(s.length==d||r&&i<o&&d-1==s.length-1||i<o&&d>=2)return!0}return r},C.validate=function(e,t,a){return null!=e[a]&&e[a].CODE==t[a].CODE},C.FileUpload=function(e,t){angular.element(document.querySelector("#"+e)).click()},e.idProofUpload=function(t,a){var i=[];if(null!=t.files[0]){"passport"==a&&(i.captureIdproofpassport=null,i.pssfileobj=t.files[0]);var r=t.files[0];if(r.size>e.allowedFileSize)return void c.warning("Warning!","File size can not be more than 5MB",!1,!1,d.time);var n=new FileReader;n.readAsDataURL(r),n.onload=function(){n.result&&("IDno"==a?(u(function(){i.eyeDisIdVal=""},200),i.captureIdproof=n.result.split("base64")[1],i.idFileName=r.name):"passport"==a?(u(function(){i.eyeDisPassVal=""},200),i.captureIdproofpassport=n.result.split("base64")[1],i.passFileName=r.name):"nationality"==a&&(u(function(){i.eyeDisNatioVal=""},200),i.captureIdproofnationality=n.result.split("base64")[1],i.naFileName=r.name))}}else"IDno"==a?i.eyeDisIdVal="":"passport"==a?i.eyeDisPassVal="":"nationality"==a&&(i.eyeDisNatioVal="");C.patDetails=i},C.AdhocCalActualAmt=function(e){e.discountType&&1==e.discountType.DT_CODE?e.discountValue?e.appliedDiscount=parseFloat((parseFloat(e.discountValue)/100*parseFloat(e.amount)).toFixed(2)):e.appliedDiscount=e.amount:e.discountValue&&(parseFloat(e.discountValue)>parseFloat(e.amount)?e.appliedDiscount=e.amount:e.appliedDiscount=e.discountValue)},C.calActualAmt=function(e,t,a){a?a.billAmt&&(a.discountText&&null!=a.discountText&&(a.discountType&&a.discountType.DT_CODE&&1==a.discountType.DT_CODE?parseFloat(a.discountText)>parseFloat(100)&&(a.discountText=100):a.discountType&&a.discountType.DT_CODE&&2==a.discountType.DT_CODE&&parseFloat(a.discountText)>parseFloat(a.billAmt)&&(a.discountText=a.billAmt)),a.discountType&&1==a.discountType.DT_CODE?a.discountText?a.totalDiscountAmt=parseFloat((parseFloat(a.discountText)/100*parseFloat(a.billAmt)).toFixed(2)):a.totalDiscountAmt=a.billAmt:parseFloat(a.discountText)>parseFloat(a.billAmt)?a.totalDiscountAmt=a.billAmt:a.totalDiscountAmt=a.discountText):e.entity.amount&&(e.entity.discountValue&&null!=e.entity.discountValue&&""!=e.entity.discountValue?e.entity.discountType&&e.entity.discountType.DT_CODE&&1==e.entity.discountType.DT_CODE?parseFloat(e.entity.discountValue)>parseFloat(100)&&(e.entity.discountValue=100):e.entity.discountType&&e.entity.discountType.DT_CODE&&2==e.entity.discountType.DT_CODE&&parseFloat(e.entity.discountValue)>parseFloat(e.entity.amount)&&(e.entity.discountValue=e.entity.amount):e.entity.appliedDiscount="",e.entity.discountType&&1==e.entity.discountType.DT_CODE?e.entity.discountValue?e.entity.appliedDiscount=parseFloat((parseFloat(e.entity.discountValue)/100*parseFloat(e.entity.amount)).toFixed(2)):e.entity.discountValue&&(e.entity.appliedDiscount=e.entity.amount):parseFloat(e.entity.discountValue)>parseFloat(e.entity.amount)?e.entity.appliedDiscount=e.entity.amount:e.entity.appliedDiscount=e.entity.discountValue)},C.approvalCalActualAmt=function(e,t,a){a?a.approvalAmountType&&1==a.approvalAmountType.DT_CODE?a.discountText?a.totalDiscountAmt=parseFloat((parseFloat(a.discountText)/100*parseFloat(a.billAmt)).toFixed(2)):a.totalDiscountAmt=a.billAmt:parseFloat(a.discountText)>parseFloat(a.billAmt)?a.totalDiscountAmt=a.billAmt:a.totalDiscountAmt=a.discountText:e.entity.approvalAmountType&&1==e.entity.approvalAmountType.DT_CODE&&e.entity.approvalAmountValue&&null!=e.entity.approvalAmountValue?e.entity.approvalAmountValue?e.entity.appliedDiscount=parseFloat((parseFloat(e.entity.approvalAmountValue)/100*parseFloat(e.entity.amount)).toFixed(2)):e.entity.appliedDiscount=e.entity.amount:e.entity.approvalAmountValue&&null!=e.entity.approvalAmountValue&&(parseFloat(e.entity.approvalAmountValue)>parseFloat(e.entity.amount)?e.entity.appliedDiscount=e.entity.amount:e.entity.appliedDiscount=e.entity.approvalAmountValue)},C.selectPatientRslt=function(e){C.getPatientBanner(e),C.getPatientBillGridDetails()},C.clear=function(){C.patBanShow=!1},C.showHideData=function(){1==C.isPredefine&&1==C.applicability&&(C.discountDroupDownField=!0,C.billAmtField=!0,C.discountValueField=!0,C.totalDiscountAmtField=!0,C.discountRemarksField=!0,C.uploadField=!0,C.remarksField=!0,C.discountTextField=!1,C.discountTypeField=!1),1==C.isPredefine&&2==C.applicability&&(C.discountDroupDownField=!0,C.discountRemarksField=!0,C.uploadField=!0,C.remarksField=!0,C.billAmtField=!1,C.discountValueField=!1,C.totalDiscountAmtField=!1,C.discountTextField=!1,C.discountTypeField=!1,e.gridOptionsDiscountSerivce.columnDefs[10].visible=!1),2==C.isPredefine&&1==C.applicability&&(C.billAmtField=!0,C.discountTypeField=!0,C.discountTextField=!0,C.totalDiscountAmtField=!0,C.discountRemarksField=!0,C.uploadField=!0,C.remarksField=!0,C.discountDroupDownField=!1,C.discountValueField=!1,C.billAmtFieldDis=!1),2==C.isPredefine&&2==C.applicability&&(C.discountRemarksField=!0,C.uploadField=!0,C.remarksField=!0,C.discountValueField=!1,C.discountDroupDownField=!1,C.billAmtField=!1,C.totalDiscountAmtField=!1,C.discountTextField=!1,C.discountTypeField=!1,e.gridOptionsDiscountSerivce.columnDefs[10].visible=!0),1==C.isPredefine&&1==C.applicability&&(C.billAmtFieldDis=!0,C.discountValueFieldDis=!0,C.totalDiscountAmtFieldDis=!0,C.discountDroupDownFieldDis=!1,C.discountTextFieldDis=!1,C.discountTypeFieldDis=!1)},C.onDiscountTypeChange=function(t,i){C.showHideData(),function(){if(2==C.isPredefine&&1==C.applicability&&I&&I.PACKAGE_OR_BILL_SEQ_ID){C.papulateAdhocBillAmtList=[],C.papulateAdhocBillAmt={1:C.papulateAdhocBillAmtList};var e=a.executeQueryURLReset(),t=new Array;a.prepareParamListWithParam("pBILL_SEQ_ID",I?I.PACKAGE_OR_BILL_SEQ_ID:C.billSeqID?C.billSeqID:void 0,t),a.executeQueryInput("ADOHCBILL_AMOUNT",t,C.papulateAdhocBillAmt,!0,!0,e,"popUp",{}).then(function(e){e&&e[1]&&e[1][0]&&e[1][0].PAYER_AMOUNT&&(C.billAmt=parseFloat(e[1][0].PAYER_AMOUNT).toFixed(2))})}}(),null==i&&(C.discount=void 0),C.billAmt=void 0,C.discountValue=[],C.totalDiscountAmt=[],C.discountRemarks=[],C.remarks=[],C.discountText=[],C.totalAppliedDiscount=[],e.gridOptionsDiscountSerivce.data=[],e.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1},2==C.isPredefine&&2==C.applicability&&(e.gridOptionsDiscountSerivce.data=[],e.gridOptionsDiscountSerivce.data[0]={isApprovedDiscountEditable:!0,discountType:C.discountType})},C.viewDiscountDetilas=function(t,i){if(t.seqId){"Adhoc Discount"==t.discount&&1==t.DT_CODE?(C.patientBillRequestMode=!0,C.patientBillViewMode=!1):(C.patientBillRequestMode=!1,C.patientBillViewMode=!0),C.discountDroupDown=!1,C.gridDataList=[],C.getDiscountList=[],C.getDiscountList1={1:C.getDiscountList};var r=a.executeQueryURLReset(),n=new Array;a.prepareParamListWithParam("pBL_CONC_SEQ_ID",t.seqId,n),a.executeQueryInput("VIEW_PATIENT_BILL_DISCOUNT_DETAILS",n,C.getDiscountList1,!0,!0,r,"popUp",{}).then(function(a){if(a&&a[1]&&a[1][0]&&1==a[1][0].IS_BILL_OR_SERVICE_LEVEL){C.isPredefine=a[1][0].CONC_CATG,C.applicability=a[1][0].IS_BILL_OR_SERVICE_LEVEL,C.showHideData(),C.billSeqID=a[1][0].BILL_SEQ_ID,C.seqIdhidden=a[1][0].CONC_SEQ_ID,C.discountRemarks=a[1][0].REASON_FOR_CONC,C.remarks=a[1][0].REMARKS;var i=[];null!=a[1][0].APPROVE_GN_AMT_TYPE&&null!=a[1][0].APPROVE_GN_AMT_TYPE&&(i.DETAIL_DESC=a[1][0].APPROVAL_DISCOUNT_TYPE_DESC,i.DT_CODE=a[1][0].APPROVE_GN_AMT_TYPE,C.approvalDiscountValueTextVal=i),a[1][0].APPROVED_CONC&&(C.approvalDiscountTextVal=a[1][0].APPROVED_CONC.toFixed(2)),a[1][0].APPROVED_AMT&&(C.approvedTotalAmtTextVal=a[1][0].APPROVED_AMT.toFixed(2));var r={DISCOUNT_NAME:a[1][0].DISCOUNT_NAME,CONC_SEQ_ID:a[1][0].DISCOUNT_MASTER_ID};C.discount=r;var n={DT_CODE:a[1][0].DISCOUNT_TYPE,DETAIL_DESC:a[1][0].DISCOUNT_TYPE_DESC};C.applicability=a[1][0].IS_BILL_OR_SERVICE_LEVEL,C.discountType=n,a[1][0].DISCOUNT_VALUE&&(C.discountText=a[1][0].DISCOUNT_VALUE.toFixed(2)),C.gnStatus=a[1][0].GN_TRAN_STATUS,C.discSeqId=a[1][0].DISC_SEQ_ID,C.discount=r,a[1][0].DISCOUNT_VALUE&&(C.discountValue=a[1][0].DISCOUNT_VALUE.toFixed(2)+" "+a[1][0].DISCOUNT_TYPE_DESC),a[1][0].BILL_AMT&&(C.billAmt=a[1][0].BILL_AMT.toFixed(2)),a[1][0].DISCOUNT_TYPE&&1==a[1][0].DISCOUNT_TYPE?a[1][0].DISCOUNT_VALUE?C.totalDiscountAmt=parseFloat((parseFloat(a[1][0].DISCOUNT_VALUE)/100*parseFloat(C.billAmt)).toFixed(2)).toFixed(2):a[1][0].SERV_RATE&&(C.totalDiscountAmt=C.billAmt.toFixed(2)):parseFloat(C.billAmt)>a[1][0].DISCOUNT_VALUE?C.totalDiscountAmt=parseFloat(a[1][0].DISCOUNT_VALUE).toFixed(2):C.totalDiscountAmt=parseFloat(C.billAmt).toFixed(2),C.approvalRemarks=a[1][0].APPROVED_REMARKS}if(a&&a[1]&&a[1][0]&&2==a[1][0].IS_BILL_OR_SERVICE_LEVEL){if(C.isPredefine=a[1][0].CONC_CATG,C.applicability=a[1][0].IS_BILL_OR_SERVICE_LEVEL,C.showHideData(),C.seqIdhidden=a[1][0].CONC_SEQ_ID,C.totalAppliedDiscount=a[1][0].CONC_AMOUNT,C.discountRemarks=a[1][0].REASON_FOR_CONC,C.remarks=a[1][0].REMARKS,C.applicability=a[1][0].IS_BILL_OR_SERVICE_LEVEL,C.gnStatus=a[1][0].GN_STATUS,C.approvalRemarks=a[1][0].APPROVED_REMARKS,a[1].length>0&&null!=a[1][0]){r={DISCOUNT_NAME:a[1][0].DISCOUNT_NAME,CONC_SEQ_ID:a[1][0].DISCOUNT_MASTER_ID};C.discount=r,e.gridOptionsDiscountSerivceview.data=[],e.gridOptionsDiscountSerivce.data=[],e.gridOptionsDiscountSerivce.data[0]=[],e.gridOptionsDiscountSerivce.data[0]={isFirstRow:!1,isEditable:!1};for(var l=0;l<a[1].length;l++){var s={};if("Adhoc Discount"!=t.discount||1!=t.DT_CODE)a[1][l].PRIMARY_SERVICE_DESC?s.primayServiceGroup=a[1][l].PRIMARY_SERVICE_DESC:s.primayServiceGroup="--",a[1][l].DEPT_DESC?s.department=a[1][l].DEPT_DESC:s.department="--",a[1][l].SPL_DESC?s.speciality=a[1][l].SPL_DESC:s.speciality="--",a[1][l].SERV_DESC?s.service=a[1][l].SERV_DESC:s.service="--";else{var o={};o.CODE=a[1][l].PRI_SERV_SEQ_ID,o.DESCRIPTION=a[1][l].PRIMARY_SERVICE_DESC,s.primayServiceGroup=o;var c={};null!=a[1][l].DEPT_CODE&&null!=a[1][l].DEPT_CODE&&(c.CODE=a[1][l].DEPT_CODE.pad(3),c.DESCRIPTION=a[1][l].DEPT_DESC,s.department=c,C.loadDeptDropdown(o,l+1));var d={};if(null!=a[1][l].SEPL_CODE&&null!=a[1][l].SEPL_CODE){d.CODE=a[1][l].SEPL_CODE,d.DESCRIPTION=a[1][l].SPL_DESC,s.speciality=d;var p={};p.primayServiceGroup=o,p.department=c,C.OnChangeDept(p,l+1)}var u={};null!=a[1][l].SERV_SEQ_ID&&null!=a[1][l].SERV_SEQ_ID&&(u.SERV_SEQ_ID=a[1][l].SERV_SEQ_ID,u.SERV_NAME=a[1][l].SERV_DESC,u.CODE=a[1][l].SERV_SEQ_ID,s.service=u);i={};null!=a[1][l].DISCOUNT_TYPE&&null!=a[1][l].DISCOUNT_TYPE&&(i.DETAIL_DESC=a[1][l].DISCOUNT_TYPE_DESC,i.DT_CODE=a[1][l].DISCOUNT_TYPE,s.discountType=i),a[1][l].DISCOUNT_VALUE&&(s.discountValue=a[1][l].DISCOUNT_VALUE),s.isFirstRow=!0,s.isEditable=!0}s.discSeqId=a[1][l].DISC_SEQ_ID,s.discountName=a[1][l].DISCOUNT_NAME,a[1][l].DISCOUNT_TYPE&&1==a[1][l].DISCOUNT_TYPE?s.defination=a[1][l].DISCOUNT_VALUE.toFixed(2)+" "+a[1][l].DISCOUNT_TYPE_DESC:s.defination=a[1][l].DISCOUNT_VALUE.toFixed(2),s.serviceHierarcyLevel=a[1][l].SERVICE_HIERARCHY_LEVEL,a[1][l].SERV_RATE&&(s.amount=a[1][l].SERV_RATE.toFixed(2)),null!=a[1][l].APPROVE_GN_AMT_TYPE&&null!=a[1][l].APPROVE_GN_AMT_TYPE&&1==a[1][l].APPROVE_GN_AMT_TYPE?a[1][l].APPROVED_CONC&&(s.approvedDiscount=a[1][l].APPROVED_CONC.toFixed(2)+" "+a[1][l].APPROVAL_DISCOUNT_TYPE_DESC):a[1][l].APPROVED_CONC&&(s.approvedDiscount=a[1][l].APPROVED_CONC.toFixed(2)),a[1][l].APPROVED_AMT&&(s.approvalAppliedDiscount=parseFloat(a[1][l].APPROVED_AMT).toFixed(2)),a[1][l].DISCOUNT_TYPE&&1==a[1][l].DISCOUNT_TYPE?a[1][l].DISCOUNT_VALUE?s.appliedDiscount=parseFloat((parseFloat(a[1][l].DISCOUNT_VALUE)/100*parseFloat(a[1][l].SERV_RATE)).toFixed(2)).toFixed(2):a[1][l].SERV_RATE&&(s.appliedDiscount=a[1][l].SERV_RATE.toFixed(2)):parseFloat(a[1][l].SERV_RATE)>a[1][l].DISCOUNT_VALUE?s.appliedDiscount=parseFloat(a[1][l].DISCOUNT_VALUE).toFixed(2):s.appliedDiscount=parseFloat(a[1][l].SERV_RATE).toFixed(2),"Adhoc Discount"==t.discount&&1==t.DT_CODE?e.gridOptionsDiscountSerivce.data.push(s):e.gridOptionsDiscountSerivceview.data.push(s)}}"Adhoc Discount"==t.discount&&1==t.DT_CODE?C.sumTotalDisCountValues(e.gridOptionsDiscountSerivce.data,"RequestGrid"):C.sumTotalDisCountValues(e.gridOptionsDiscountSerivceview.data,"RequestGrid")}}),C.collectionSeqId=t.seqId,b(C)}},C.deleteDiscount=function(t,a){e.gridOptionsSaveDiscountSerivce.data.splice(a,1),t.seqId&&p.deleteAdocData(t).then(function(e){})},C.getPatientBillGridDetails=function(){C.getDiscountList=[],C.getDiscountList1={1:C.getDiscountList};var t=a.executeQueryURLReset(),i=new Array;a.prepareParamListWithParam("pSUB_ACC_SEQ_ID",e.patientGlobalDtls.subAccSeqId,i),a.executeQueryInput("VIEW_PATIENT_BILL_DISCOUNT_GRID_DETAILS",i,C.getDiscountList1,!0,!0,t,"popUp",{}).then(function(t){if(t&&t[1]&&t[1][0]){e.gridOptionsSaveDiscountSerivce.data=[];let r=!1;for(var a=0;a<t[1].length;a++){var i={};i.discount=t[1][a].CONC_NAME,i.applicability=t[1][a].DESCRIPTION,i.disValue=t[1][a].DISCOUNT_VALUE,t[1][a].CONC_AMOUNT&&(i.disAmt=parseFloat(t[1][a].CONC_AMOUNT).toFixed(2)),i.disStatus=t[1][a].TOATL_DEPOSIT,i.seqId=t[1][a].BL_CONC_SEQ_ID,i.disStatus=t[1][a].DESCRIPTION_DTL,i.DT_CODE=t[1][a].DT_CODE,i.requestNumber=t[1][a].CONC_REQ_NO,e.gridOptionsSaveDiscountSerivce.data.push(i),2!=t[1][a].GN_CONC_STATUS||null!=t[1][a].CONC_SEQ_ID||r||(r=!0,e.$emit("discountApprovedData",t[1][a]))}}})},C.sumTotalDisCountValues=function(t,a,i,r){if(a&&"RequestGrid"==a){var n=[];if(n=t||e.gridOptionsDiscountSerivce.data){for(var l=0,s=0;s<n.length;s++)n[s].appliedDiscount&&(l=parseFloat(l)+parseFloat(n[s].appliedDiscount));C.totalAppliedDiscount=l.toFixed(2)}}else if(a&&"ApprovalGrid"==a){n=[];if(n=t||e.gridOptionsApprovalDiscountSerivce.data){l=0;var o=0;for(s=0;s<n.length;s++)n[s].appliedDiscount&&(l=parseFloat(l)+parseFloat(n[s].appliedDiscount)),n[s].reqDiscount&&(o=parseFloat(o)+parseFloat(n[s].reqDiscount));C.totalApprovalDiscount=l.toFixed(2),C.totalApReqlDiscount=o}i&&null==r&&C.remaingDisountValidation(C.totalApprovalDiscount,i)}},C.viewAppliedDiscountDetilas=function(t,i){if(C.approvalButton=!0,t.seqId){C.discountDroupDown=!1,C.gridDataList=[],C.getDiscountList=[],C.getDiscountList1={1:C.getDiscountList};var r=a.executeQueryURLReset(),n=new Array;a.prepareParamListWithParam("pBL_CONC_SEQ_ID",t.seqId,n),a.executeQueryInput("VIEW_PATIENT_BILL_DISCOUNT_DETAILS",n,C.getDiscountList1,!0,!0,r,"popUp",{}).then(function(t){if(e.alertFlag=!0,e.updateFlag=!0,e.gridOptionsApprovalDiscountSerivce.data=[],t&&t[1]&&t[1][0]&&1==t[1][0].IS_BILL_OR_SERVICE_LEVEL){C.billSeqID=t[1][0].BILL_SEQ_ID,C.isPredefine=t[1][0].CONC_CATG,C.applicability=t[1][0].IS_BILL_OR_SERVICE_LEVEL,C.showHideData(),C.seqIdhidden=t[1][0].CONC_SEQ_ID,C.dtlSeqIdhidden=t[1][0].BL_CONC_DTL_SEQ_ID,C.connectionNumber=t[1][0].CONC_REQ_NO,C.discountRemarks=t[1][0].REASON_FOR_CONC,C.remarks=t[1][0].REMARKS;var a={DISCOUNT_NAME:t[1][0].DISCOUNT_NAME,CONC_SEQ_ID:t[1][0].DISCOUNT_MASTER_ID};C.discount=a;var i={DT_CODE:t[1][0].DISCOUNT_TYPE,DETAIL_DESC:t[1][0].DISCOUNT_TYPE_DESC};C.applicability=t[1][0].IS_BILL_OR_SERVICE_LEVEL,C.discountType=i,t[1][0].DISCOUNT_VALUE&&(C.discountText=t[1][0].DISCOUNT_VALUE.toFixed(2)),C.gnStatus=t[1][0].GN_TRAN_STATUS,C.discSeqId=t[1][0].DISC_SEQ_ID,C.discount=a,t[1][0].DISCOUNT_VALUE&&(C.discountValue=t[1][0].DISCOUNT_VALUE+" "+t[1][0].DISCOUNT_TYPE_DESC),t[1][0].BILL_AMT&&(C.billAmt=t[1][0].BILL_AMT.toFixed(2)),t[1][0].DISCOUNT_TYPE&&1==t[1][0].DISCOUNT_TYPE?t[1][0].DISCOUNT_VALUE?C.totalDiscountAmt=parseFloat((parseFloat(t[1][0].DISCOUNT_VALUE)/100*parseFloat(C.billAmt)).toFixed(2)).toFixed(2):t[1][0].SERV_RATE&&(C.totalDiscountAmt=C.billAmt.toFixed(2)):parseFloat(C.billAmt)>t[1][0].DISCOUNT_VALUE?C.totalDiscountAmt=parseFloat(t[1][0].DISCOUNT_VALUE).toFixed(2):C.totalDiscountAmt=parseFloat(C.billAmt).toFixed(2),1==C.applicability&&(C.rejectButton=!0);var r=[];null!=t[1][0].APPROVE_GN_AMT_TYPE&&null!=t[1][0].APPROVE_GN_AMT_TYPE&&(r.DETAIL_DESC=t[1][0].APPROVAL_DISCOUNT_TYPE_DESC,r.DT_CODE=t[1][0].APPROVE_GN_AMT_TYPE,C.approvalDiscountValueTextVal=r),C.approvalDiscountTextVal=t[1][0].APPROVED_CONC,t[1][0].APPROVED_AMT&&(C.approvedTotalAmtTextVal=t[1][0].APPROVED_AMT.toFixed(2)),C.approvalRemarks=t[1][0].APPROVED_REMARKS}if(t&&t[1]&&t[1][0]&&2==t[1][0].IS_BILL_OR_SERVICE_LEVEL){if(C.isPredefine=t[1][0].CONC_CATG,C.applicability=t[1][0].IS_BILL_OR_SERVICE_LEVEL,C.showHideData(),C.seqIdhidden=t[1][0].CONC_SEQ_ID,C.connectionNumber=t[1][0].CONC_REQ_NO,C.totalAppliedDiscount=t[1][0].CONC_AMOUNT,C.discountRemarks=t[1][0].REASON_FOR_CONC,C.remarks=t[1][0].REMARKS,C.applicability=t[1][0].IS_BILL_OR_SERVICE_LEVEL,C.gnStatus=t[1][0].GN_STATUS,C.approvalRemarks=t[1][0].APPROVED_REMARKS,t[1].length>0&&null!=t[1][0]){a={DISCOUNT_NAME:t[1][0].DISCOUNT_NAME,CONC_SEQ_ID:t[1][0].DISCOUNT_MASTER_ID};C.discount=a,e.gridOptionsApprovalDiscountSerivce.data=[];for(var n=0;n<t[1].length;n++){var l={};l.approvalAmountType=C.discountType,l.primayServiceGroup=t[1][n].PRIMARY_SERVICE_DESC,t[1][n].DEPT_DESC?l.department=t[1][n].DEPT_DESC:l.department="--",t[1][n].SPL_DESC?l.speciality=t[1][n].SPL_DESC:l.speciality="--",t[1][n].SERV_DESC?l.service=t[1][n].SERV_DESC:l.service="--",t[1][n].SERV_RATE&&(l.amount=t[1][n].SERV_RATE.toFixed(2)),l.discSeqId=t[1][n].DISC_SEQ_ID,l.discountName=t[1][n].DISCOUNT_NAME,1==t[1][n].DTL_CONC_STATUS?l.select=!1:3==t[1][n].DTL_CONC_STATUS?l.select=!0:2==t[1][n].DTL_CONC_STATUS&&(l.select=!1);r={};null!=t[1][n].APPROVE_GN_AMT_TYPE&&null!=t[1][n].APPROVE_GN_AMT_TYPE&&(r.DETAIL_DESC=t[1][n].APPROVAL_DISCOUNT_TYPE_DESC,r.DT_CODE=t[1][n].APPROVE_GN_AMT_TYPE,l.approvalAmountType=r),l.approvalAmountValue=t[1][n].APPROVED_CONC,t[1][n].APPROVED_AMT&&(l.appliedDiscount=parseFloat(t[1][n].APPROVED_AMT).toFixed(2)),C.billSeqID=t[1][n].BILL_SEQ_ID,l.SP_SEQ_ID=t[1][n].SP_SEQ_ID,l.BL_CONC_DTL_SEQ_ID=t[1][n].BL_CONC_DTL_SEQ_ID,t[1][n].DISCOUNT_TYPE&&1==t[1][n].DISCOUNT_TYPE?l.defination=t[1][n].DISCOUNT_VALUE.toFixed(2)+""+t[1][n].DISCOUNT_TYPE_DESC:l.defination=t[1][n].DISCOUNT_VALUE.toFixed(2),t[1][n].DISCOUNT_TYPE&&1==t[1][n].DISCOUNT_TYPE?t[1][n].DISCOUNT_VALUE?l.reqDiscount=parseFloat((parseFloat(t[1][n].DISCOUNT_VALUE)/100*parseFloat(t[1][n].SERV_RATE)).toFixed(2)).toFixed(2):l.reqDiscount=t[1][n].SERV_RATE.toFixed(2):parseFloat(t[1][n].SERV_RATE)>t[1][n].DISCOUNT_VALUE?l.reqDiscount=parseFloat(t[1][n].DISCOUNT_VALUE).toFixed(2):l.reqDiscount=parseFloat(t[1][n].SERV_RATE).toFixed(2),l.isEditable=!0,"view"==e.pageName?(e.rejectAllDisable=!0,l.rejectDisable=!0,null!=t[1][n].APPROVE_GN_AMT_TYPE&&null!=t[1][n].APPROVE_GN_AMT_TYPE&&(l.approvedDiscountValue=t[1][n].APPROVED_CONC+" "+t[1][n].APPROVAL_DISCOUNT_TYPE_DESC),e.gridOptionsApprovalDiscountSerivce.columnDefs[8].visible=!0,e.gridOptionsApprovalDiscountSerivce.columnDefs[9].visible=!1):(e.rejectAllDisable=!1,l.rejectDisable=!1,e.gridOptionsApprovalDiscountSerivce.columnDefs[8].visible=!1,e.gridOptionsApprovalDiscountSerivce.columnDefs[9].visible=!0),e.gridOptionsApprovalDiscountSerivce.data.push(l)}}C.sumTotalDisCountValues(e.gridOptionsApprovalDiscountSerivce.data,"ApprovalGrid")}})}C.collectionSeqId=t.seqId,b(C)},e.toogleAllCheckBox=function(e,t){for(var a=0;a<e.length;a++)t?(e[a].select=!0,e[a].approvalAmountType=void 0,e[a].approvalAmountValue=void 0,e[a].appliedDiscount=void 0,C.approvalButton=!1,C.rejectButton=!0):(e[a].select=!1,C.approvalButton=!0,C.rejectButton=!1)},C.uploadFile=function(t){t&&null!=t&&S.fileUploadCheck(t,C,e)},C.preAuthFile=function(t,a){"new"==a&&null==e.pageName&&(p.removeUploadedFile(t,C),null!=t.docSeqId&&v.deleteFileORRetriveFileFun("removeDocumentList",t,angular.fromJson(sessionStorage.userContextObj)).then(function(e){angular.isUndefined(e.data.HITService.message.napierDocumentList[0]["com.napier.core.service.vo.uploadfile.NapierDocument"])}))},C.changePerAmtValue=function(e,t){e.approvalAmountValue&&null!=e.approvalAmountValue&&(e.approvalAmountType&&e.approvalAmountType.DT_CODE&&1==e.approvalAmountType.DT_CODE?parseFloat(e.approvalAmountValue)>parseFloat(100)&&(e.approvalAmountValue=100):e.approvalAmountType&&e.approvalAmountType.DT_CODE&&2==e.approvalAmountType.DT_CODE&&parseFloat(e.approvalAmountValue)>parseFloat(e.amount)&&(e.approvalAmountValue=e.amount))},C.downloadFile=function(e){e.regSeqId=C.seqIdhidden,S.downloadDocument(e)},C.isChecked=function(t){t.select?t.isAppliedDiscountEditable=!0:t.isAppliedDiscountEditable=!1,t.select&&(t.appliedDiscount=void 0,t.approvalAmountType=void 0,t.approvalAmountValue=void 0);for(var a=0,i=0;i<e.gridOptionsApprovalDiscountSerivce.data.length;i++)e.gridOptionsApprovalDiscountSerivce.data[i].select&&(a+=1);0!=a&&a==e.gridOptionsApprovalDiscountSerivce.data.length?(C.approvalButton=!1,C.rejectButton=!0,e.headerCheckBox=!0,C.totalApprovalDiscount=void 0):(C.approvalButton=!0,C.rejectButton=!1,e.headerCheckBox=!1)},C.approvalTimeDiscountCal=function(e,t,a){a.approvalDiscountTextVal&&null!=a.approvalDiscountTextVal&&(a.approvalDiscountValueTextVal&&1==a.approvalDiscountValueTextVal.DT_CODE?parseFloat(a.approvalDiscountTextVal)>parseFloat(100)&&(a.approvalDiscountTextVal=100):a.approvalDiscountValueTextVal&&2==a.approvalDiscountValueTextVal.DT_CODE&&parseFloat(a.approvalDiscountTextVal)>parseFloat(a.billAmt)&&(a.approvalDiscountTextVal=a.billAmt)),a.approvalDiscountTextVal&&(a.approvalDiscountValueTextVal&&1==a.approvalDiscountValueTextVal.DT_CODE?a.approvalDiscountTextVal?a.approvedTotalAmtTextVal=parseFloat((parseFloat(a.approvalDiscountTextVal)/100*parseFloat(a.billAmt)).toFixed(2)):a.approvedTotalAmtTextVal=a.billAmt:parseFloat(a.approvalDiscountTextVal)>parseFloat(a.billAmt)?a.approvedTotalAmtTextVal=a.billAmt:a.approvedTotalAmtTextVal=a.approvalDiscountTextVal),a.remaingDisountValidation(a.approvedTotalAmtTextVal,e,"ApprovalBillLevel")},function(){if(C.patientBillRequestMode=!0,C.patientBillViewMode=!1,e.patientGlobalDtls&&e.patientGlobalDtls.subAccSeqId&&C.getPatientBillGridDetails(),C.isPredefine=1,C.applicability=1,C.onDiscountTypeChange("val"),e.myservice&&e.myservice.concessionReqSeqId){var t={seqId:e.myservice.concessionReqSeqId};C.billSeqId=e.myservice.billSeqId,C.viewAppliedDiscountDetilas(t,2)}e.patientGlobalDtls&&e.patientGlobalDtls.subAccSeqId&&function(){if(I&&I.PACKAGE_OR_BILL_SEQ_ID){C.adhocValidation=[],C.getDiscountList=[],C.getDiscountList1={1:C.getDiscountList};var t=a.executeQueryURLReset(),i=new Array;a.prepareParamListWithParam("pSUB_ACC_SEQ_ID",e.patientGlobalDtls.subAccSeqId,i),a.prepareParamListWithParam("pPLAN_SEQ_ID",e.patientGlobalDtls.insurancePlanSeqId?e.patientGlobalDtls.insurancePlanSeqId:-999,i),a.prepareParamListWithParam("pBED_CLASS",e.patientGlobalDtls.bedClassCode?e.patientGlobalDtls.bedClassCode:-999,i),a.prepareParamListWithParam("pEN_SEQ_ID",e.patientGlobalDtls.encounterSeqId?e.patientGlobalDtls.encounterSeqId:-999,i),a.prepareParamListWithParam("pPAT_TYPE",1,i),a.prepareParamListWithParam("pCON_SEQ_ID",-999,i),a.prepareParamListWithParam("pPractice_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,i),a.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,i),a.prepareParamListWithParam("pBILL_SEQ_ID",I.PACKAGE_OR_BILL_SEQ_ID,i),a.executeQueryInput("GET_BL_GET_PRE_BILL_DISCOUNT_DTLS",i,C.getDiscountList1,!0,!0,t,"popUp",{}).then(function(e){for(var t=0;t<e[1].length;t++)C.adhocValidation.push({LEVEL:e[1][t].COMPARE_VALUE,RATE:e[1][t].SERV_RATE});console.log("pbd.adhocValidation---",C.adhocValidation)})}}()}(),e.$on("pbd.onloadingGridDateFetch",function(e,t){C.getPatientBillGridDetails()}),C.onRejectButton=function(){C.approvalDiscountTextVal=void 0,C.approvedTotalAmtTextVal=void 0}}e.$inject=["$scope","PreAuthService","QueryService","PatientBannerGlobal","PatientBannerBilling","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","patientBillDiscountServiceGridDef","hisAlertService","hisAlertConstants","patientBillDiscountService","$timeout","discountSaveGridDef","approvalDiscountServiceGridDef","gridDefApproval","uploadFileService","patientBillViewGridDef","$state","$stateParams"],angular.module("napierContainerUi").controller("patientBillingDiscount",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C,I,A,E,h,b,T,L,P,O,R,N){var w=this;n.loadModule("billing");var F=l.getLanguageToSet();function M(e){e||(w.data={planDetails:{defaultAuth:"1",opCopayLevel:"1",ipCopayLevel:"1",coInsurance:"1",discountLevel:"1",coInsuranceOp:"1",coInsuranceIp:"1"}}),w.discountDetails={},w.planTreeViewData=[],w.planInclGridOptions=angular.copy(o),w.diagnosisExclGridOptions=angular.copy(c),w.diagnosisInclGridOptions=angular.copy(c),w.planExclGridOptions=angular.copy(o),w.planServicesGridOptions=angular.copy(d),w.ipCoPayGridOptions=angular.copy(p),w.opCoPayGridOptions=angular.copy(p),w.defaultAuthGridOptions=angular.copy(p),w.discountGridOptions=angular.copy(p),w.opCoInsuranceGridOptions=angular.copy(p),w.ipCoInsuranceGridOptions=angular.copy(p),w.ipCoPayGridOptions.columnDefs[7].visible=!0,w.defaultAuthGridOptions.columnDefs[4].visible=!0,w.defaultAuthGridOptions.columnDefs[5].visible=!0,w.defaultAuthGridOptions.columnDefs[6].visible=!0,w.opCoPayGridOptions.columnDefs[7].visible=!0,w.discountGridOptions.columnDefs[8].visible=!0,w.opCoInsuranceGridOptions.columnDefs[9].visible=!0,w.ipCoInsuranceGridOptions.columnDefs[9].visible=!0}function G(e,t,a,i,r){if(null==t.srivceTreeList)t.srivceTreeList=[],t.srivceTreeList.push({cisSeqId:r[a].CIS_SEQ_ID,primServGroup:{DESCRIPTION:r[a].PSG_DESC,CODE:r[a].PSG_CODE,IS_MATERIAL:r[a].IS_MATERIAL},payerSerSeqId:r[a].PAYER_SER_SEQ_ID,department:{DESCRIPTION:r[a].DEPT_DESC,CODE:r[a].DEPT_CODE},speciality:{DESCRIPTION:r[a].SPL_DESC,CODE:r[a].SPL_CODE},servCode:r[a].SERV_CODE,servName:{SERV_NAME:r[a].SERV_NAME,SERV_SEQ_ID:r[a].SERV_SEQ_ID},inclusion:r[a].IS_INCL_OR_EXCL,isRequired:r[a].IS_APPROVAL_REQUIRED,level:r[a].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:r[a].IS_AMT_NL_PERC,applicability:r[a].APPLICABILITY_TYPE,approvedQty:r[a].QTY,approvedAmount:r[a].INCL_AMOUNT}),t.srivceTreeList[0][r[a].BED_CLASS_CODE]=r[a].BED_CLASS_AMT,t.srivceTreeList[0]["sbclSeqId"+r[a].BED_CLASS_CODE]=r[a].SBCL_SEQ_ID;else for(let e=0;e<t.srivceTreeList.length;e++){if(r[a].CIS_SEQ_ID&&t.srivceTreeList[e].cisSeqId==r[a].CIS_SEQ_ID){t.srivceTreeList[e][r[a].BED_CLASS_CODE]=r[a].BED_CLASS_AMT,t.srivceTreeList[e]["sbclSeqId"+r[a].BED_CLASS_CODE]=r[a].SBCL_SEQ_ID;break}if(e==t.srivceTreeList.length-1){t.srivceTreeList.push({cisSeqId:r[a].CIS_SEQ_ID,primServGroup:{DESCRIPTION:r[a].PSG_DESC,CODE:r[a].PSG_CODE,IS_MATERIAL:r[a].IS_MATERIAL},payerSerSeqId:r[a].PAYER_SER_SEQ_ID,department:{DESCRIPTION:r[a].DEPT_DESC,CODE:r[a].DEPT_CODE},speciality:{DESCRIPTION:r[a].SPL_DESC,CODE:r[a].SPL_CODE},servCode:r[a].SERV_CODE,servName:{SERV_NAME:r[a].SERV_NAME,SERV_SEQ_ID:r[a].SERV_SEQ_ID},inclusion:r[a].IS_INCL_OR_EXCL,isRequired:r[a].IS_APPROVAL_REQUIRED,level:r[a].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:r[a].IS_AMT_NL_PERC,applicability:r[a].APPLICABILITY_TYPE,approvedQty:r[a].QTY,approvedAmount:r[a].INCL_AMOUNT}),t.srivceTreeList[e+1][r[a].BED_CLASS_CODE]=r[a].BED_CLASS_AMT,t.srivceTreeList[e+1]["sbclSeqId"+r[a].BED_CLASS_CODE]=r[a].SBCL_SEQ_ID;break}}}n.changeLanguage(F),w.permissionList=N.rolePermission("T_BL_PATIENT_BILLING"),w.alertObj={},s.loadAlerts(F).then(function(e){w.alertObj=e,w.alertObjBtn={buttonText:w.alertObj.ok},w.alertFunction={buttonCallBack1:function(){}},w.buttonClose={buttonClose:function(){}}}),w.patBanShow=!1,w.patientDataBedPlan=[],w.patientAddressData=[],w.generateBillDisable=!0,w.cancelBillDisable=!0,w.patientDepostis=[],w.parmaBillService=[],this.activeFirst=1,this.disabledTabForCal=!0,w.dataObj={},w.disabledTabForDiscount=!0,w.dischargeStatus={},w.disablePrint=!0,w.searchPatient=function(e){return w.billNoObj=void 0,f.patientSearchBilling(e).then(function(e){return e.map(function(e){return e})})},M(),w.billNoSrch=function(e){w.patientSearchObj=void 0;var t="%"+e+"%";w.billData=[],w.multipleBillDataForList={1:w.billData};var i=a.executeQueryURLReset();return w.billDataList=new Array,a.prepareParamListWithParam("pBillNo",t,w.billDataList),a.executeQueryInput("PATIENT_BILLING_BILL_NO_SEARCH",w.billDataList,w.multipleBillDataForList,!0,!0,i,"popUp",{}).then(function(e){return w.billData.map(function(e){return e})})},w.getPatientSummaryDetails=function(e){w.multipleDataObj={1:w.patientDataBedPlan=[],2:w.patientAddressData=[],3:w.patientDepostis=[]};var t=a.executeQueryURLReset();w.paramList=new Array,a.prepareParamListWithParam("pAdmSeqId",e.admissionSeqid,w.paramList),a.prepareParamListWithParam("pRegSeqId",e.regSeqId,w.paramList),a.prepareParamListWithParam("pPatSeqId",e.regSeqId,w.paramList),a.executeQueryInput("GET_BILL_SUMMARY_BED_DETAILS",w.paramList,w.multipleDataObj,!0,!1,t,"popUp",{}).then(function(e){}),a.executeQueryInput("GET_BILL_SUMMARY_ADDRESS_DETAILS",w.paramList,w.multipleDataObj,!0,!1,t,"popUp",{}).then(function(e){}),a.executeQueryInput("AVILABLE_PATIENT_DEPOSITS",w.paramList,w.multipleDataObj,!0,!0,t,"popUp",{}).then(function(e){})},this.getBillDetailsViewPostBill=function(e){f.getBillDetailsViewPostBill(e.PACKAGE_OR_BILL_SEQ_ID,w).then(function(e){w.getBillDetailsData(w.billDetailList)})},this.getBillOrPackageData=function(e,t){if(null!=e.subAccSeqId){w.multipleDataList={1:w.billOrPackageList=[]};var i=a.executeQueryURLReset();w.paramArray=new Array,a.prepareParamListWithParam("pSub_Seq_Id",e.subAccSeqId,w.paramArray),a.executeQueryInput("GET_BILL_OR_PACKAGE_NAME_FOR_DROP_DOWN",w.paramArray,w.multipleDataList,!0,!0,i,"popUp",{}).then(function(e){if(w.cancelBillEnable=!1,t){w.disabledTabForCal=!0,w.cancelBillEnable=!0,w.disabledTabForDiscount=!0;for(let e=0;e<w.billOrPackageList.length;e++)if(w.billOrPackageList[e].PACKAGE_OR_BILL==t.PACKAGE_OR_BILL){w.billOrPackage=w.billOrPackageList[e],w.getBillDetailsViewPostBill(w.billOrPackageList[e]);break}}else if(null!=w.billNoObj&&null!=w.billNoObj&&""!==w.billNoObj&&null!=w.billNoObj.BILL_NO||!(0==w.billOrPackageList.length||null!=w.billOrPackageList[0]&&null!=w.billOrPackageList[0].SP_SEQ_ID||null!=w.billOrPackageList[0]&&"Unbilled"==w.billOrPackageList[0].PACKAGE_OR_BILL))for(let e=0;e<w.billOrPackageList.length;e++)if(null!=w.billNoObj&&null!=w.billNoObj&&""!==w.billNoObj&&null!=w.billNoObj.BILL_NO){if(w.billNoObj.BILL_NO==w.billOrPackageList[e].PACKAGE_OR_BILL){w.billOrPackage=w.billOrPackageList[e],null!=w.billOrPackageList[e].GN_BILL_STATUS&&1==w.billOrPackageList[e].GN_BILL_STATUS?(w.generateBillDisable=!0,w.disabledTabForCal=!1,w.disabledTabForDiscount=!1,w.getBillDetailsViewPostBill(w.billOrPackageList[e])):(w.generateBillDisable=!1,w.disabledTabForCal=!1,w.disabledTabForDiscount=!0,w.getBillDetailsViewPostBill(w.billOrPackageList[e]));break}}else{if(null!=w.billOrPackageList[e].GN_BILL_STATUS&&1==w.billOrPackageList[e].GN_BILL_STATUS){w.generateBillDisable=!0,w.disabledTabForCal=!1,w.disabledTabForDiscount=!1,w.getBillDetailsViewPostBill(w.billOrPackageList[e]),w.billOrPackage=w.billOrPackageList[e];break}if(w.billOrPackageList.length-1==e){w.generateBillDisable=!0,w.disabledTabForCal=!0,w.disabledTabForDiscount=!0;break}}else w.disabledTabForCal=!0,w.disabledTabForDiscount=!0,w.billOrPackage=w.billOrPackageList[0];null!=w.billOrPackage.GN_BILL_STATUS&&1==w.billOrPackage.GN_BILL_STATUS&&(w.cancelBillDisable=!1)})}},this.addPreAuthNoToCal=function(e){w.dataObj.preAuthIds=e,w.disabledTabForCal=!0,0==w.generateBillDisable&&(w.generateBillDisable=!0)},this.getClearanceStatus=function(e,t){var i=[];w.dischargeCheck=[],w.dischargeQuickSummaryDetails=[],w.dischargeStatus={};var r={1:w.dischargeCheck,2:i,3:w.dischargeQuickSummaryDetails};w.clearanceStatusList=[];var n=a.executeQueryURLReset();w.dischargeCheckList=new Array,a.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,w.dischargeCheckList),a.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,w.dischargeCheckList),a.prepareParamListWithParam("pAdmseqid",e.admissionSeqid,w.dischargeCheckList),a.executeQueryInput("NHIS_ADT_TR_096",w.dischargeCheckList,w.multipleComboList,!0,!1,n,"popUp");var l=[];a.prepareParamListWithParam("pAdmnSeqId",e.admissionSeqid,l),a.prepareParamListWithParam("pUserSeqId",angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,l),a.executeQueryInput("IS_CLEARANCE_GIVEN_STATUS_FOR_BILLING",l,r,!0,!1,n,"popUp"),a.executeQueryInput("FETCH_EXP_DISCHARGE_DTLS",w.dischargeCheckList,r,!0,!0,n,"popUp",{}).then(function(e){if(null!=i[0]){for(var a=0;a<i.length;a++)"N"==i[a].IS_CLEARANCE_GIVEN&&w.clearanceStatusList.push(i[a].LOCATION_DESCRIPTION);0!=w.clearanceStatusList.length?w.clearanceStatus="N":w.clearanceStatus="Y"}else w.clearanceStatus="Y";if(null!=w.dischargeCheck&&w.dischargeCheck.length>0)w.onClickDischargeScreenLoad(w,!0,t);else if(null!=w.dischargeQuickSummaryDetails[0]){let e=new Date(w.dischargeQuickSummaryDetails[0].ADMISSION_DATE);1==w.dischargeQuickSummaryDetails[0].STAY_UNIT?e.setDate(e.getDate()+w.dischargeQuickSummaryDetails[0].EXPECTED_LEN_OF_STAY):e.setMonth(e.getMonth()+w.dischargeQuickSummaryDetails[0].EXPECTED_LEN_OF_STAY),w.dischargeStatus.initiatedDischargeDate=moment(e).format("DD-MM-YYYY"),w.dischargeStatus.DISCHARGE_STATUS=w.dischargeQuickSummaryDetails[0].DESCRIPTION}})},this.discountApprovedData=function(e){w.dataObj.concessionSequeceId=e.BL_CONC_SEQ_ID},this.calAndAddCreditNoteOnPat=function(e){w.creditNoteList=e},e.$on("addPreAuthNoToCal",function(e,t){w.addPreAuthNoToCal(t)}),e.$on("discountApprovedData",function(e,t){w.discountApprovedData(t)}),e.$on("creditNoteFromPaymentTab",function(e,t){w.calAndAddCreditNoteOnPat(t)}),e.$on("locationClearanceForBill",function(e,t){w.getClearanceStatus(w.patientInput),w.activeFirst=1}),this.getPatientBillCommon=function(e){f.getPayerAccountBillAndClaim(e.subAccSeqId).then(function(e){w.billDtlsCommon=e})},w.getPatientBanner=function(t){w.regSeqId=t.RG_SEQ_ID,w.patientInput={regSeqId:t.RG_SEQ_ID,admissionSeqid:t.IPADM_SEQ_ID},i.getPatientBanner(w.patientInput,1).then(function(t){e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=12,w.getPatientSummaryDetails(w.patientInput),w.getBillOrPackageData(e.patientGlobalDtls),w.getPatientBillCommon(e.patientGlobalDtls),S.go("index.billingSub.patientBilling.patientBillingDiscount",{valueObj:JSON.stringify(e.patientGlobalDtls)}),w.patBanShow=!0,w.getPlansList(),e.$emit("pbd.onloadingGridDateFetch",{message:!1}),w.getClearanceStatus(w.patientInput,!0)}),r.patientBannerDetail(w.regSeqId).then(function(t){e.patientBannerDetails=t,w.patBanShow=!0,e.patientRecordsDetail=e.patientBannerDetails.patientRecordsDetail,e.$emit("pbd.onloadingGridDateFetch",{message:!1})})},w.selectPatientRslt=function(e){w.clear("patient"),w.patBanShow=!1,e.RG_SEQ_ID?w.getPatientBanner(e):g.warning("Warning","Please select the patient.")},w.selectBillRslt=function(e){w.clear("bill"),w.patBanShow=!1,w.getPatientBanner(e)},w.getPlansList=function(t){var i={1:w.plansList=[]},r=a.executeQueryURLReset(),n=new Array;a.prepareParamListWithParam("pRg_Seq_Id",w.patientInput.regSeqId,n),a.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n),a.executeQueryInput("PALN_AUTO_COMPLETE_FOR_PATIENT",n,i,!0,!0,r,"popUp",{}).then(function(t){t[1][0]&&w.plansList.length>0&&(w.data.plans=_.find(w.plansList,function(t){return t.INC_PLAN_SEQ_ID==e.patientGlobalDtls.insurancePlanSeqId}),w.getDefaultPlanDetails())})},w.getDefaultPlanDetails=function(t){if(M(!0),w.data.plans){var i={1:w.primaryServicePlanList=[],2:w.diagnosisList=[],3:w.discountList=[],4:w.pocketList=[],5:w.defaultList=[],6:w.planServiceList=[]},r=a.executeQueryURLReset(),n=new Array;a.prepareParamListWithParam("pPLAN_SEQ_ID",w.data.plans.INC_PLAN_SEQ_ID,n),a.prepareParamListWithParam("pIncSeqId",w.data.plans.INC_SEQ_ID,n),a.prepareParamListWithParam("pPlanSeqId",w.data.plans.INC_PLAN_SEQ_ID,n),a.prepareParamListWithParam("pINC_PLAN_SEQ_ID",w.data.plans.INC_PLAN_SEQ_ID,n),a.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,n),a.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n),a.prepareParamListWithParam("pPAT_TYPE",-999,n),a.prepareParamListWithParam("pIS_COPAY_OR_COINSURANCE",-999,n),a.prepareParamListWithParam("pPRACTICE_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,n),a.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n),a.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n),a.executeQueryInput("BL_GET_PLAN_PSG_SEARCH_SP",n,i,!0,!1,r,"popUp"),a.executeQueryInput("GET_PLAN_DIAGNOSIS_DETAILS",n,i,!0,!1,r,"popUp"),a.executeQueryInput("GET_PLAN_DISCOUNT_DETAILS",n,i,!0,!1,r,"popUp"),a.executeQueryInput("GET_PLAN_OUTPOCKET_DETAILS",n,i,!0,!1,r,"popUp"),a.executeQueryInput("GET_PLAN_DEFALUT_PREAUTH_DETAILS",n,i,!0,!1,r,"popUp"),a.executeQueryInput("BL_GET_CREDIT_PLAN_SERVICE_DTLS",n,i,!0,!0,r,"popUp",{}).then(function(i){if(i[1]){w.data.planDetails={defaultAuth:w.data.plans.IS_PRE_AUTH_BILL_OR_SERVICE_LEVEL,defaultAuthValue:w.data.plans.DEFAULT_AUTH_VALUE,duration:w.data.plans.PRE_AUTH_DURATION,durationType:w.data.plans.PRE_AUTH_DURATION_TYPE,ipCopayLevel:w.data.plans.COPAY_IP,ipCopayValue:w.data.plans.COPAY_PERCENTAGE_IP,opCopayLevel:w.data.plans.COPAY,opCopayValue:w.data.plans.PATIENT_COPAY_PERCENTAGE,coInsuranceIp:w.data.plans.IS_COINSURANCE_BILL_OR_SERVICE_LEVEL_IP,coInsuranceOp:w.data.plans.IS_COINSURANCE_BILL_OR_SERVICE_LEVEL_OP,coInsuranceIpValue:w.data.plans.COINSURANCE_VALUE_IP,coInsuranceOpValue:w.data.plans.COINSURANCE_VALUE_OP,opDeductable:w.data.plans.DEDUCTABLE_AMT,ipDeductable:w.data.plans.IP_DEDUCTABLE_AMOUNT,opMaxCopay:w.data.plans.OP_MAX_OUT_OF_POCKET,ipMaxCopay:w.data.plans.IP_MAX_OUT_OF_POCKET,discountLevel:w.data.plans.BILL_LEVEL_DISCOUNT,discountValue:w.data.plans.DISCOUNT_PERCENT};for(var r=0;r<w.diagnosisList.length;r++){let e={pidsSeqId:!t&&w.diagnosisList[r].pidsSeqId?w.diagnosisList[r].pidsSeqId:void 0,status:w.diagnosisList[r].GN_STATUS,diagnosisName:w.diagnosisList[r].DIAG_NAME,diagnosisCode:w.diagnosisList[r].DIAG_CODE,type:w.diagnosisList[r].IS_INCL_OR_EXCL};1==w.diagnosisList[r].IS_INCL_OR_EXCL?w.diagnosisInclGridOptions.data.push(e):w.diagnosisExclGridOptions.data.push(e)}for(r=0;r<w.discountList.length;r++){let e={discSeqId:w.discountList[r].DISC_SEQ_ID?w.discountList[r].DISC_SEQ_ID:void 0,status:w.discountList[r].GN_STATUS,primayServiceGroup:w.discountList[r].PRIMARY_SERVICE_DESC,department:w.discountList[r].DEPT_DESC,speciality:w.discountList[r].SPL_DESC,servName:w.discountList[r].SERV_DESC,discount:w.discountList[r].DISCOUNT_VALUE,type:4};w.discountGridOptions.data.push(e)}w.planServicesGridOptions.data=[];for(r=0;r<w.pocketList.length;r++){let e={copaySeqId:w.pocketList[r].COPAY_SEQ_ID?w.pocketList[r].COPAY_SEQ_ID:void 0,status:w.pocketList[r].GN_STATUS,primayServiceGroup:w.pocketList[r].PRIMARY_SERVICE_DESC,department:w.pocketList[r].DEPT_DESC,speciality:w.pocketList[r].SPL_DESC,servName:w.pocketList[r].SERV_DESC,copayment:1==w.pocketList[r].IS_COPAY_OR_COINSURANCE?w.pocketList[r].VALUE:void 0,coInsurance:2==w.pocketList[r].IS_COPAY_OR_COINSURANCE?w.pocketList[r].VALUE:void 0,type:1==w.pocketList[r].IS_COPAY_OR_COINSURANCE&&1==w.pocketList[r].PAT_TYPE?2:1==w.pocketList[r].IS_COPAY_OR_COINSURANCE&&2==w.pocketList[r].PAT_TYPE?3:2==w.pocketList[r].IS_COPAY_OR_COINSURANCE&&2==w.pocketList[r].PAT_TYPE?5:6};2==e.type?w.ipCoPayGridOptions.data.push(e):3==e.type?w.opCoPayGridOptions.data.push(e):5==e.type?w.opCoInsuranceGridOptions.data.push(e):6==e.type&&w.ipCoInsuranceGridOptions.data.push(e)}w.defaultAuthGridOptions.data=[];for(r=0;r<w.defaultList.length;r++){let e={pdpaSeqId:w.defaultList[r].PDPA_SEQ_ID?w.defaultList[r].PDPA_SEQ_ID:void 0,status:w.defaultList[r].GN_STATUS,approvedAmount:w.defaultList[r].AMOUNT,durationType:w.defaultList[r].DURATION_TYPE,quantity:w.defaultList[r].QTY,apprIsAmtPercNl:w.defaultList[r].IS_AMT_PERC_NL_CODE,type:1,primayServiceGroup:w.defaultList[r].PRI_SERV_DESC,department:w.defaultList[r].DEPT_DESC,speciality:w.defaultList[r].SPL_DESC,servName:w.defaultList[r].SERV_NAME};w.defaultAuthGridOptions.data.push(e)}w.planServicesGridOptions.data=[],w.planTreeViewData=[];for(let e=0;e<w.planServiceList.length;e++)if(w.planServiceList[e].IS_MATERIAL=2==w.planServiceList[e].IS_MATERIAL?"Y":"N",w.planServiceList[e].IS_APPROVAL_REQUIRED=w.planServiceList[e].APPROVAL_REQUIRED?w.planServiceList[e].APPROVAL_REQUIRED:void 0,1==w.planServiceList[e].SERVICE_HIERARCHY_LEVEL)if(0==w.planTreeViewData.length)w.planTreeViewData.push({cisSeqId:w.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:w.planServiceList[e].PSG_DESC,CODE:w.planServiceList[e].PSG_CODE,IS_MATERIAL:w.planServiceList[e].IS_MATERIAL},payerSerSeqId:w.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:w.planServiceList[e].DEPT_DESC,CODE:w.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:w.planServiceList[e].SPL_DESC,CODE:w.planServiceList[e].SPL_CODE},servCode:w.planServiceList[e].SERV_CODE,servName:{SERV_CODE:w.planServiceList[e].SERV_CODE,SERV_NAME:w.planServiceList[e].SERV_NAME,SERV_SEQ_ID:w.planServiceList[e].SERV_SEQ_ID},inclusion:w.planServiceList[e].IS_INCL_OR_EXCL,isRequired:w.planServiceList[e].IS_APPROVAL_REQUIRED,level:w.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:w.planServiceList[e].IS_AMT_NL_PERC,applicability:w.planServiceList[e].APPLICABILITY_TYPE,approvedQty:w.planServiceList[e].QTY,approvedAmount:w.planServiceList[e].INCL_AMOUNT}),w.planTreeViewData[0][w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].BED_CLASS_AMT,w.planTreeViewData[0]["sbclSeqId"+w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].SBCL_SEQ_ID;else for(let t=0;t<w.planTreeViewData.length;t++){if(w.planTreeViewData[t].cisSeqId==w.planServiceList[e].CIS_SEQ_ID){w.planTreeViewData[t][w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].BED_CLASS_AMT,w.planTreeViewData[t]["sbclSeqId"+w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].SBCL_SEQ_ID;break}if(t==w.planTreeViewData.length-1){w.planTreeViewData.push({cisSeqId:w.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:w.planServiceList[e].PSG_DESC,CODE:w.planServiceList[e].PSG_CODE,IS_MATERIAL:w.planServiceList[e].IS_MATERIAL},payerSerSeqId:w.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:w.planServiceList[e].DEPT_DESC,CODE:w.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:w.planServiceList[e].SPL_DESC,CODE:w.planServiceList[e].SPL_CODE},servCode:w.planServiceList[e].SERV_CODE,servName:{SERV_CODE:w.planServiceList[e].SERV_CODE,SERV_NAME:w.planServiceList[e].SERV_NAME,SERV_SEQ_ID:w.planServiceList[e].SERV_SEQ_ID},inclusion:w.planServiceList[e].IS_INCL_OR_EXCL,isRequired:w.planServiceList[e].IS_APPROVAL_REQUIRED,level:w.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:w.planServiceList[e].IS_AMT_NL_PERC,applicability:w.planServiceList[e].APPLICABILITY_TYPE,approvedQty:w.planServiceList[e].QTY,approvedAmount:w.planServiceList[e].INCL_AMOUNT}),w.planTreeViewData[t+1][w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].BED_CLASS_AMT,w.planTreeViewData[t+1]["sbclSeqId"+w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].SBCL_SEQ_ID;break}}else if(2==w.planServiceList[e].SERVICE_HIERARCHY_LEVEL){for(let t=0;t<w.planTreeViewData.length;t++)if(w.planTreeViewData[t].primServGroup.CODE==w.planServiceList[e].PSG_CODE)if(null==w.planTreeViewData[t].departTreeList)w.planTreeViewData[t].departTreeList=[],w.planTreeViewData[t].departTreeList.push({cisSeqId:w.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:w.planServiceList[e].PSG_DESC,CODE:w.planServiceList[e].PSG_CODE,IS_MATERIAL:w.planServiceList[e].IS_MATERIAL},payerSerSeqId:w.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:w.planServiceList[e].DEPT_DESC,CODE:w.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:w.planServiceList[e].SPL_DESC,CODE:w.planServiceList[e].SPL_CODE},servCode:w.planServiceList[e].SERV_CODE,servName:{SERV_CODE:w.planServiceList[e].SERV_CODE,SERV_NAME:w.planServiceList[e].SERV_NAME,SERV_SEQ_ID:w.planServiceList[e].SERV_SEQ_ID},inclusion:w.planServiceList[e].IS_INCL_OR_EXCL,isRequired:w.planServiceList[e].IS_APPROVAL_REQUIRED,level:w.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:w.planServiceList[e].IS_AMT_NL_PERC,applicability:w.planServiceList[e].APPLICABILITY_TYPE,approvedQty:w.planServiceList[e].QTY,approvedAmount:w.planServiceList[e].INCL_AMOUNT}),w.planTreeViewData[t].departTreeList[0][w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].BED_CLASS_AMT,w.planTreeViewData[t].departTreeList[0]["sbclSeqId"+w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].SBCL_SEQ_ID;else for(let a=0;a<w.planTreeViewData[t].departTreeList.length;a++){if(w.planTreeViewData[t].departTreeList[a].cisSeqId==w.planServiceList[e].CIS_SEQ_ID){w.planTreeViewData[t].departTreeList[a][w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].BED_CLASS_AMT,w.planTreeViewData[t].departTreeList[a]["sbclSeqId"+w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].SBCL_SEQ_ID;break}if(a==w.planTreeViewData[t].departTreeList.length-1){w.planTreeViewData[t].departTreeList.push({cisSeqId:w.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:w.planServiceList[e].PSG_DESC,CODE:w.planServiceList[e].PSG_CODE,IS_MATERIAL:w.planServiceList[e].IS_MATERIAL},payerSerSeqId:w.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:w.planServiceList[e].DEPT_DESC,CODE:w.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:w.planServiceList[e].SPL_DESC,CODE:w.planServiceList[e].SPL_CODE},servCode:w.planServiceList[e].SERV_CODE,servName:{SERV_CODE:w.planServiceList[e].SERV_CODE,SERV_NAME:w.planServiceList[e].SERV_NAME,SERV_SEQ_ID:w.planServiceList[e].SERV_SEQ_ID},inclusion:w.planServiceList[e].IS_INCL_OR_EXCL,isRequired:w.planServiceList[e].IS_APPROVAL_REQUIRED,level:w.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:w.planServiceList[e].IS_AMT_NL_PERC,applicability:w.planServiceList[e].APPLICABILITY_TYPE,approvedQty:w.planServiceList[e].QTY,approvedAmount:w.planServiceList[e].INCL_AMOUNT}),w.planTreeViewData[t].departTreeList[a+1][w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].BED_CLASS_AMT,w.planTreeViewData[t].departTreeList[a+1]["sbclSeqId"+w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].SBCL_SEQ_ID;break}}}else if(3==w.planServiceList[e].SERVICE_HIERARCHY_LEVEL){for(let t=0;t<w.planTreeViewData.length;t++)if(w.planTreeViewData[t].primServGroup.CODE==w.planServiceList[e].PSG_CODE&&w.planTreeViewData[t].departTreeList)for(let a=0;a<w.planTreeViewData[t].departTreeList.length;a++)if(w.planTreeViewData[t].departTreeList[a].department.CODE==w.planServiceList[e].DEPT_CODE)if(null==w.planTreeViewData[t].departTreeList[a].specltyTreeList)w.planTreeViewData[t].departTreeList[a].specltyTreeList=[],w.planTreeViewData[t].departTreeList[a].specltyTreeList.push({cisSeqId:w.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:w.planServiceList[e].PSG_DESC,CODE:w.planServiceList[e].PSG_CODE,IS_MATERIAL:w.planServiceList[e].IS_MATERIAL},payerSerSeqId:w.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:w.planServiceList[e].DEPT_DESC,CODE:w.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:w.planServiceList[e].SPL_DESC,CODE:w.planServiceList[e].SPL_CODE},servCode:w.planServiceList[e].SERV_CODE,servName:{SERV_CODE:w.planServiceList[e].SERV_CODE,SERV_NAME:w.planServiceList[e].SERV_NAME,SERV_SEQ_ID:w.planServiceList[e].SERV_SEQ_ID},inclusion:w.planServiceList[e].IS_INCL_OR_EXCL,isRequired:w.planServiceList[e].IS_APPROVAL_REQUIRED,level:w.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:w.planServiceList[e].IS_AMT_NL_PERC,applicability:w.planServiceList[e].APPLICABILITY_TYPE,approvedQty:w.planServiceList[e].QTY,approvedAmount:w.planServiceList[e].INCL_AMOUNT}),w.planTreeViewData[t].departTreeList[a].specltyTreeList[0][w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].BED_CLASS_AMT,w.planTreeViewData[t].departTreeList[a].specltyTreeList[0]["sbclSeqId"+w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].SBCL_SEQ_ID;else for(let i=0;i<w.planTreeViewData[t].departTreeList[a].specltyTreeList.length;i++){if(w.planTreeViewData[t].departTreeList[a].specltyTreeList[i].cisSeqId==w.planServiceList[e].CIS_SEQ_ID){w.planTreeViewData[t].departTreeList[a].specltyTreeList[i][w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].BED_CLASS_AMT,w.planTreeViewData[t].departTreeList[a].specltyTreeList[i]["sbclSeqId"+w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].SBCL_SEQ_ID;break}if(i==w.planTreeViewData[t].departTreeList[a].specltyTreeList.length-1){w.planTreeViewData[t].departTreeList[a].specltyTreeList.push({cisSeqId:w.planServiceList[e].CIS_SEQ_ID,primServGroup:{DESCRIPTION:w.planServiceList[e].PSG_DESC,CODE:w.planServiceList[e].PSG_CODE,IS_MATERIAL:w.planServiceList[e].IS_MATERIAL},payerSerSeqId:w.planServiceList[e].PAYER_SER_SEQ_ID,department:{DESCRIPTION:w.planServiceList[e].DEPT_DESC,CODE:w.planServiceList[e].DEPT_CODE},speciality:{DESCRIPTION:w.planServiceList[e].SPL_DESC,CODE:w.planServiceList[e].SPL_CODE},servCode:w.planServiceList[e].SERV_CODE,servName:{SERV_CODE:w.planServiceList[e].SERV_CODE,SERV_NAME:w.planServiceList[e].SERV_NAME,SERV_SEQ_ID:w.planServiceList[e].SERV_SEQ_ID},inclusion:w.planServiceList[e].IS_INCL_OR_EXCL,isRequired:w.planServiceList[e].IS_APPROVAL_REQUIRED,level:w.planServiceList[e].SERVICE_HIERARCHY_LEVEL,apprIsAmtPercNl:w.planServiceList[e].IS_AMT_NL_PERC,applicability:w.planServiceList[e].APPLICABILITY_TYPE,approvedQty:w.planServiceList[e].QTY,approvedAmount:w.planServiceList[e].INCL_AMOUNT}),w.planTreeViewData[t].departTreeList[a].specltyTreeList[i+1][w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].BED_CLASS_AMT,w.planTreeViewData[t].departTreeList[a].specltyTreeList[i+1]["sbclSeqId"+w.planServiceList[e].BED_CLASS_CODE]=w.planServiceList[e].SBCL_SEQ_ID;break}}}else if(4==w.planServiceList[e].SERVICE_HIERARCHY_LEVEL)for(let t=0;t<w.planTreeViewData.length;t++)if(w.planTreeViewData[t].primServGroup.CODE==w.planServiceList[e].PSG_CODE&&w.planTreeViewData[t].departTreeList)for(let a=0;a<w.planTreeViewData[t].departTreeList.length;a++)if(w.planTreeViewData[t].departTreeList[a].department.CODE==w.planServiceList[e].DEPT_CODE)for(let i=0;i<w.planTreeViewData[t].departTreeList[a].specltyTreeList.length;i++)w.planTreeViewData[t].departTreeList[a].specltyTreeList[i].speciality.CODE==w.planServiceList[e].SPL_CODE&&(w.planTreeViewData[t].departTreeList[a].specltyTreeList[i].payerSerSeqId=w.planTreeViewData[t].departTreeList[a].specltyTreeList[i].PAYER_SER_SEQ_ID,G(w,w.planTreeViewData[t].departTreeList[a].specltyTreeList[i],e,t,w.planServiceList));for(r=0;r<w.planTreeViewData.length;r++)if(w.planTreeViewData[r].$$treeLevel=0,w.planServicesGridOptions.data.push(w.planTreeViewData[r]),null!=w.planTreeViewData[r].departTreeList)for(var n=0;n<w.planTreeViewData[r].departTreeList.length;n++)if(e.processDataForTreeGrid(w.planTreeViewData[r].departTreeList[n],1),null!=w.planTreeViewData[r].departTreeList[n].specltyTreeList)for(var l=0;l<w.planTreeViewData[r].departTreeList[n].specltyTreeList.length;l++)if(e.processDataForTreeGrid(w.planTreeViewData[r].departTreeList[n].specltyTreeList[l],2),null!=w.planTreeViewData[r].departTreeList[n].specltyTreeList[l].srivceTreeList)for(var s=0;s<w.planTreeViewData[r].departTreeList[n].specltyTreeList[l].srivceTreeList.length;s++)null!=w.planTreeViewData[r].departTreeList[n].specltyTreeList[l].srivceTreeList[s]&&e.processDataForTreeGrid(w.planTreeViewData[r].departTreeList[n].specltyTreeList[l].srivceTreeList[s],3);if(w.data.plans.IS_BED_CLASS_INCL_OR_EXCL){var o={1:w.getTariffList=[]},c=a.executeQueryURLReset(),d=new Array;a.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,d),a.prepareParamListWithParam("pINC_SEQ_ID",w.data.plans.INC_SEQ_ID,d),a.prepareParamListWithParam("pINC_PLAN_SEQ_ID",w.data.plans.INC_PLAN_SEQ_ID,d),a.prepareParamListWithParam("pIS_INCL_OR_EXCL",w.data.plans.IS_BED_CLASS_INCL_OR_EXCL,d),a.executeQueryInput("BL_GET_CREDIT_PAYER_AND_PLAN_BED_CLASS_DTLS",d,o,!0,!0,c,"popUp",{}).then(function(e){if(e[1][0]){for(var t=[],a=0;a<w.getTariffList.length;a++)t.push({tariffSeqId:w.getTariffList[a].TARFIFF_INCL_SEQ_ID?w.getTariffList[a].TARFIFF_INCL_SEQ_ID:w.getTariffList[a].TARFIFF_EXCL_SEQ_ID?w.getTariffList[a].TARFIFF_EXCL_SEQ_ID:void 0,status:w.getTariffList[a].GN_STATUS,bedClassName:w.getTariffList[a].BC_DESC,bedClassCode:w.getTariffList[a].BC_CODE,type:w.data.bedClassInclusion});if(1==w.data.plans.IS_BED_CLASS_INCL_OR_EXCL){w.planInclGridOptions.data=w.planInclGridOptions.data=t;for(a=0;a<w.planInclGridOptions.data.length;a++)w.addRmovColumnCoverGrid(w.planInclGridOptions.data[a])}else w.planExclGridOptions.data=w.planExclGridOptions.data=t}})}}})}},w.setdWData=function(t,a){t&&(e.gridOptionsDiscountSerivce.data[a]=[],e.gridOptionsDiscountSerivce.data[a].service={},e.gridOptionsDiscountSerivce.data[a].primayServiceGroup={},e.gridOptionsDiscountSerivce.data[a].department={},e.gridOptionsDiscountSerivce.data[a].speciality={},e.gridOptionsDiscountSerivce.data[a].discountType={},e.gridOptionsDiscountSerivce.data[a].primayServiceGroup.CODE=t.PRI_SERV_CODE,e.gridOptionsDiscountSerivce.data[a].primayServiceGroup.DESCRIPTION=t.PRI_SERV_DESC,e.gridOptionsDiscountSerivce.data[a].department.CODE=t.DEPT_CODE,e.gridOptionsDiscountSerivce.data[a].department.DESCRIPTION=t.SEPT_DESC,e.gridOptionsDiscountSerivce.data[a].speciality.CODE=t.SPL_CODE,e.gridOptionsDiscountSerivce.data[a].speciality.DESCRIPTION=t.SPL_DESC,e.gridOptionsDiscountSerivce.data[a].discountType=w.discountType,w.loadDeptDropdown(e.gridOptionsDiscountSerivce.data[a].primayServiceGroup,a),w.OnChangeDept(e.gridOptionsDiscountSerivce.data[a],a),e.gridOptionsDiscountSerivce.data[a].service.SERV_CODE=t.SERV_CODE,e.gridOptionsDiscountSerivce.data[a].service.SERV_NAME=t.SERV_NAME,e.gridOptionsDiscountSerivce.data[a].service.SERV_SEQ_ID=t.SERV_SEQ_ID,e.gridOptionsDiscountSerivce.data[a].service.CODE=t.SERV_SEQ_ID)},e.processDataForTreeGrid=function(e,t){e.$$treeLevel=t,w.planServicesGridOptions.data.push(e)},w.addRmovColumnCoverGrid=function(e,t){var a={name:e.bedClassCode+"",displayName:e.bedClassName,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents">{{row.entity.apprIsAmtPercNl==3?"":MODEL_COL_FIELD}} {{(MODEL_COL_FIELD&&row.entity.apprIsAmtPercNl==2)?"%":(row.entity.apprIsAmtPercNl==3)?"N/L":""}}</div>'};if(t){for(var i=0;i<w.planServicesGridOptions.columnDefs.length;i++)if(w.planServicesGridOptions.columnDefs[i].name==e.bedClassName.CODE){w.planServicesGridOptions.columnDefs.splice(i,1);break}}else w.planServicesGridOptions.columnDefs.splice(w.planServicesGridOptions.columnDefs.length-1,0,a)};a.executeQueryURLReset();w.highlightFilteredHeader=function(e,t,a,i){return"ui-grid-header-custom-right"},h.columnDefs[1].headerCellClass=w.highlightFilteredHeader,h.columnDefs[2].headerCellClass=w.highlightFilteredHeader,h.columnDefs[3].headerCellClass=w.highlightFilteredHeader,h.columnDefs[4].headerCellClass=w.highlightFilteredHeader,h.columnDefs[5].headerCellClass=w.highlightFilteredHeader,h.columnDefs[6].headerCellClass=w.highlightFilteredHeader,w.billDetailGrid=angular.copy(h),w.billDetailGrid.onRegisterApi=function(t){w.gridApi=t,w.gridApi.expandable.on.rowExpandedStateChanged(e,function(e){!e.isExpanded&&null!=e.entity.$$treeLevel&&(2==e.entity.$$treeLevel||1==e.entity.$$treeLevel&&null!=e.entity.subGridList&&e.entity.subGridList.length>0)&&w.gridApi.expandable.toggleRowExpansion(e.entity)}),w.gridApi.treeBase.on.rowExpanded(e,function(e){null!=e.entity.$$treeLevel&&(2==e.entity.$$treeLevel||1==e.entity.$$treeLevel&&null!=e.entity.subGridList&&e.entity.subGridList.length>0)&&(e.isExpanded=!0,w.gridApi.expandable.toggleRowExpansion(e.entity))}),w.gridApi.treeBase.on.rowCollapsed(e,function(e){null!=e.entity.$$treeLevel&&(2==e.entity.$$treeLevel||1==e.entity.$$treeLevel&&null!=e.entity.subGridList&&e.entity.subGridList.length>0)&&e.isExpanded&&(e.isExpanded=!1)}),w.gridApi.selection.on.rowSelectionChanged(e,function(e){w.getSelectedRows=w.gridApi.selection.getSelectedRows()}),w.gridApi.selection.on.rowSelectionChangedBatch(e,function(e){w.getSelectedRows=w.gridApi.selection.getSelectedRows()})},w.expandGridRow=function(){w.expandableGrid=!0,w.gridApi.treeBase.expandAllRows()},w.collapseGridRow=function(){w.expandableGrid=!1,w.gridApi.treeBase.collapseAllRows()},w.getBillDetailsData=function(t,a){L.getBillDetailsData(t,a,I,C,A,E,w,e)},this.onClickDischargeScreenLoad=function(t,i,r){if(null!=t.dischargeCheck&&t.dischargeCheck.length>0){let n=[],l={1:n},s=a.executeQueryURLReset(),o=new Array,c=angular.fromJson(sessionStorage.userContextObj).spLocation.LOC_SEQ_ID;a.prepareParamList(1,c||-999,o),a.prepareParamList(2,c||-999,o),a.prepareParamList(3,"",o),a.prepareParamList(4,"",o),a.prepareParamList(5,"1800-01-01 00:00:00",o),a.prepareParamList(6,"9999-01-01 00:00:00",o),a.prepareParamList(7,"1800-01-01 00:00:00",o),a.prepareParamList(8,"9999-01-01 00:00:00",o),a.prepareParamList(9,e.patientGlobalDtls.ipNo?e.patientGlobalDtls.ipNo:"",o),a.prepareParamList(11,"",o),a.prepareParamList(13,"",o),a.prepareParamList(15,"",o),a.prepareParamList(17,"",o),a.executeQueryInput("NHIS_IP_LOCATION_WISE_CLEARANCE_DATA",o,l,!0,!0,s,"popUp",!0).then(function(e){if(n.length>0&&null!=n[0])if(i)t.dischargeStatus=n[0],t.dischargeStatus.initiatedDischargeDate=moment(n[0].DISCH_INTIM_DATE).format("DD-MM-YYYY");else{var a=moment(n[0].AdivcedateTime).format("DD-MM-YYYY HH:mm"),l=moment(n[0].EXPECTED_DISCH_DATE).format("DD-MM-YYYY HH:mm"),s={patientBannerReq:!1,ipNo:n[0].IP_NO,ipSeqid:n[0].IPADM_SEQ_ID,patName:n[0].PAT_NAME,age:n[0].AGE,gender:n[0].GENDER,disStatus:n[0].DS_STATUS,disposition:n[0].DISCH_DISPO,adviceDate:a,ipdaSeqId:n[0].IPDA_SEQ_ID,advicetoIntimationTime:n[0].AdvToInt,intimationtoDepts:n[0].AdvTodeptclear,intimationToFinaclearanceTime:n[0].deptToFinClr,financialToDischargeTime:n[0].FinclrToDis,disTAT:n[0].DISCH_TAT,admittedDocName:n[0].ADM_DOC_NAME,adviceDocName:n[0].ADV_DOC_NAME,disType:n[0].DISCH_TYPE,expDiscDate:l,location:n[0].LOCATION,disCriteria:n[0].DISCH_CRITERIA,disIntimationStatus:n[0].DISCHARGE_STATUS,disValue:n[0].GN_TRAN_STATUS,partialClearance:n[0].PARTIAL_CLEARANCE_GIVEN,rgSeqId:n[0].RG_SEQ_ID,admittedDocSeqId:n[0].ADM_DOC_SEQ_ID,disTypeId:n[0].GN_DISCH_TYPE,disDispositionId:n[0].GN_DISCH_DESTINATION,clearance:n[0].IS_CLEARANCE_GIVEN,episodeSeq:n[0].EP_SEQ_ID};sessionStorage.patientArrDetails&&delete sessionStorage.patientArrDetails,t.activeFirst=7,sessionStorage.setItem("adviceRowData",JSON.stringify(s)),S.go("index.billingSub.patientBilling.patientBillingDischargeInitmationTemplateView")}else r||g.hisAlertMulti("warning",t.alertObj.alertTypeWarn,t.alertObj.discAdvRaisdSlctPat,!1,t.alertFunction,t.buttonClose,v.time)})}else r||g.hisAlertMulti("warning",t.alertObj.alertTypeWarn,t.alertObj.discAdvRaisdSlctPat,!1,t.alertFunction,t.buttonClose,v.time)},this.onClickPaymentScreenLoad=function(t){t.activeFirst=3;let a=[{billNo:t.billOrPackage.PACKAGE_OR_BILL,billStatus:t.billOrPackage.GN_BILL_STATUS,billOrPackageList:t.billOrPackageList,billOrPackage:t.billOrPackage,patientGlobalDtls:e.patientGlobalDtls,patientInput:t.patientInput}];S.go("index.billingSub.patientBilling.patientBillingPaymentTabView",{billObj:JSON.stringify(a)})},this.onClickDiscountScreenLoad=function(t){t.billOrPackage&&t.billOrPackage.GN_BILL_STATUS?(t.activeFirst=4,S.go("index.billingSub.patientBilling.patientBillingDiscount",{valueObj:JSON.stringify(e.patientGlobalDtls),billSeqID:JSON.stringify(t.billOrPackage)})):g.warning("Warning","Please Select Bill.",!1,!1,v.time)},this.onClickPreAuthScreenLoad=function(t){let a=[{ipNo:e.patientGlobalDtls.ipNo,preAuthList:t.dataObj.preAuthIds}];t.activeFirst=5,S.go("index.billingSub.patientBilling.patientBillingPreAuthTabView",{valueObj:JSON.stringify(a)})},this.preAuthScreen=function(){let t=[];if(null!=w.getSelectedRows&&w.getSelectedRows.length>0||null!=w.getSelectedRowSubGrid&&w.getSelectedRowSubGrid.length>0){w.mergedData=_.concat(w.getSelectedRows,w.getSelectedRowSubGrid);for(let e=0;e<w.mergedData.length;e++)t.push({SERVICE_RATE:w.mergedData[e].serviceRate,QTY:w.mergedData[e].quantity,SERV_APPRV_STATUS:w.mergedData[e].SERV_APPRV_STATUS,IS_SERVICE_FROM:w.mergedData[e].IS_SERVICE_FROM,IS_ORDER_FROM:w.mergedData[e].IS_ORDER_FROM,PSRVGRP:null!=w.mergedData[e].$$treeLevel&&0==w.mergedData[e].$$treeLevel?w.mergedData[e].details:w.mergedData[e].serviceVo.primaryServiceDesc,PSRVGRPCODE:null!=w.mergedData[e].$$treeLevel&&0==w.mergedData[e].$$treeLevel?w.mergedData[e].detailCode:w.mergedData[e].serviceVo.primaryServiceCode,IS_MATERIAL:w.mergedData[e].isMaterial,DEPTDESC:null!=w.mergedData[e].$$treeLevel&&0==w.mergedData[e].$$treeLevel?void 0:null!=w.mergedData[e].$$treeLevel&&1==w.mergedData[e].$$treeLevel?w.mergedData[e].details:w.mergedData[e].serviceVo.deptDesc,DEPTCODE:null!=w.mergedData[e].$$treeLevel&&0==w.mergedData[e].$$treeLevel?void 0:null!=w.mergedData[e].$$treeLevel&&1==w.mergedData[e].$$treeLevel?w.mergedData[e].detailCode:w.mergedData[e].serviceVo.deptCode,SPCLDESC:null==w.mergedData[e].$$treeLevel||0!=w.mergedData[e].$$treeLevel&&1!=w.mergedData[e].$$treeLevel?null!=w.mergedData[e].$$treeLevel&&2==w.mergedData[e].$$treeLevel?w.mergedData[e].details:w.mergedData[e].serviceVo.specialityDesc:void 0,SPCLCODE:null==w.mergedData[e].$$treeLevel||0!=w.mergedData[e].$$treeLevel&&1!=w.mergedData[e].$$treeLevel?null!=w.mergedData[e].$$treeLevel&&2==w.mergedData[e].$$treeLevel?w.mergedData[e].detailCode:w.mergedData[e].serviceVo.specilityCode:void 0,SERV_NAME:null==w.mergedData[e].$$treeLevel||0!=w.mergedData[e].$$treeLevel&&1!=w.mergedData[e].$$treeLevel&&2!=w.mergedData[e].$$treeLevel?w.mergedData[e].serviceVo.servName:void 0,SERV_SEQ_ID:null==w.mergedData[e].$$treeLevel||0!=w.mergedData[e].$$treeLevel&&1!=w.mergedData[e].$$treeLevel&&2!=w.mergedData[e].$$treeLevel?w.mergedData[e].serviceVo.servSeqId:void 0,TOTALAMOUNT:w.mergedData[e].chargeableAmt});w.activeFirst=5;let a=[{ipNo:e.patientGlobalDtls.ipNo,selectedData:t,preAuthList:w.dataObj.preAuthIds}];S.go("index.billingSub.patientBilling.patientBillingPreAuthTabView",{valueObj:JSON.stringify(a)})}},this.clearanceBillGen=function(e){this.onClickDischargeScreenLoad(e)},this.calculatePatientBill=function(t,a){null!=t.billOrPackage.GN_BILL_STATUS&&null!=t.billOrPackage.GN_PAYER_TYPE&&null!=t.billOrPackageList[0]&&"Unbilled"==t.billOrPackageList[0].PACKAGE_OR_BILL&&(t.billOrPackage=t.billOrPackageList[0],t.cancelBillDetails=[]),f.getCalculateBillData(e.patientGlobalDtls,t.dataObj,a).then(function(e){if(null!=e.data.HITService&&null!=e.data.HITService.message){if(t.disabledTabForCal=!1,t.disablePrint=!1,0==t.billOrPackageList.length||null!=t.billOrPackageList[0]&&"Unbilled"==t.billOrPackageList[0].PACKAGE_OR_BILL?t.generateBillDisable=!1:t.generateBillDisable=!0,t.billDetailsData=e.data.HITService.message,t.materialsList=[],null!=t.billDetailsData.servicePostingDetailsList&&null!=t.billDetailsData.servicePostingDetailsList[0]&&""!==t.billDetailsData.servicePostingDetailsList[0])if(t.billDetailList=t.billDetailsData.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]instanceof Array?t.billDetailsData.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]:[t.billDetailsData.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]],null!=t.billDetailsData.materialsList&&""!==t.billDetailsData.materialsList&&(t.materialsList=t.billDetailsData.materialsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]instanceof Array?t.billDetailsData.materialsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]:[t.billDetailsData.materialsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]]),null!=t.billOrPackage.SP_SEQ_ID)t.getBillDetailsData(t.billDetailList,t.materialsList);else if(0==t.billOrPackageList.length||null!=t.billOrPackageList[0]&&"Unbilled"==t.billOrPackageList[0].PACKAGE_OR_BILL){t.billDetailsDataForPatient=e.data.HITService.message,t.parmaBillService=t.billDetailList;let a={servicePostingDetailsList:[t.billDetailsDataForPatient.servicePostingDetailsList[0]],packageCoverList:null!=t.billDetailsDataForPatient.packageCoverList&&null!=t.billDetailsDataForPatient.packageCoverList[0]&&""!==t.billDetailsDataForPatient.packageCoverList?[t.billDetailsDataForPatient.packageCoverList[0]]:void 0};t.serviceObj=angular.copy(a),t.serviceObj["@class"]="com.napier.core.scm.serviceposting.vo.ServicePostingVo",t.getBillDetailsData(t.billDetailList,t.materialsList)}else t.getBillDetailsData(t.billDetailList,t.materialsList);else t.billDetailList=[],t.getBillDetailsData(t.billDetailList,[]);null!=t.billDetailsDataForPatient.depositDetails&&null!=t.billDetailsDataForPatient.depositDetails[0]&&""!==t.billDetailsDataForPatient.depositDetails[0]?t.depositDetailList=t.billDetailsDataForPatient.depositDetails[0]["com.napier.core.service.vo.deposits.DepositsVo"]instanceof Array?t.billDetailsDataForPatient.depositDetails[0]["com.napier.core.service.vo.deposits.DepositsVo"]:[t.billDetailsDataForPatient.depositDetails[0]["com.napier.core.service.vo.deposits.DepositsVo"]]:t.depositDetailList=[]}})},this.onChangeBillOrPackage=function(e){w.disabledTabForDiscount=!0,null!=e&&null!=e.GN_BILL_STATUS?(w.cancelBillDisable=null==e.GN_BILL_STATUS||1!=e.GN_BILL_STATUS,w.cancelBillDisable?w.disabledTabForDiscount=!0:w.disabledTabForDiscount=!1,f.getBillDetailsViewPostBill(e.PACKAGE_OR_BILL_SEQ_ID,w).then(function(e){w.getBillDetailsData(w.billDetailList)})):null!=e&&null==e.GN_BILL_STATUS&&null!=e.SP_SEQ_ID?null!=w.billOrPackageList[0]&&"Unbilled"==w.billOrPackageList[0].PACKAGE_OR_BILL?w.calculatePatientBill(w,e.SP_SEQ_ID):f.getPackageViewPostBill(e.PACKAGE_OR_BILL_SEQ_ID,e.SP_SEQ_ID).then(function(e){null!=e.data&&null!=e.data.HITService&&null!=e.data.HITService.message&&(null!=e.data.HITService.message.servicePostingDetailsList&&null!=e.data.HITService.message.servicePostingDetailsList[0]&&""!==e.data.HITService.message.servicePostingDetailsList[0]?w.billDetailList=e.data.HITService.message.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]instanceof Array?e.data.HITService.message.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]:[e.data.HITService.message.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]]:w.billDetailList=[],w.getBillDetailsData(w.billDetailList))}):null!=e&&null==e.GN_BILL_STATUS&&null==e.SP_SEQ_ID?(w.cancelBillDetails=[],w.calculatePatientBill(w),w.cancelBillDisable=!0):w.cancelBillDisable=!0},this.generateBill=function(){if(0!=this.dischargeCheck.length)if(null!=this.clearanceStatus&&"Y"==this.clearanceStatus){w.serviceGridOptions={},w.serviceGridOptions.data=w.parmaBillService,w.packageGridOptions={},w.packageGridOptions.data=[];var t=D.saveBillService(w.serviceGridOptions,w.packageGridOptions,w.billDetailsDataForPatient,w,e.patientGlobalDtls,w.materialsList);if(0==t)return g.hisAlertMulti("warning",this.alertObj.alertTypeWarn,"Bill Can Be Generated Only For Rendered Postings.",!1,w.alertFunction,w.buttonClose,v.time),!1;null!=e.depositGridOptionsTemp?e.depositGridOptionsTemp:e.depositGridOptions;var a=D.saveParamObjectForDeposit(w.depositDetailList,e,w,t);(function(){y.generateBillFromPatientBilling(t,a,w,w.billDetailsDataForPatient,1,e,w.patientInput.admissionSeqid,w.patientInput.regSeqId,e.patientGlobalDtls,w.dataObj,w.billDtlsCommon).then(function(e){if(null!=e.data.HITService.message.billingList){let a=e.data.HITService.message.billingList[0]["com.napier.core.billgeneration.vo.Bill"],i="",r=[];if(a instanceof Array)for(let e=0;e<a.length;e++)i+=a[e].billNo,r.push(a[e].billNo),e!=a.length-1&&(i+=", ");else i=a[0]?a[0]["com.napier.core.billgeneration.vo.Bill"].billNo:a.billNo,r.push(i);w.billNoForPrint=i;var t=w.alertObj.bilGenSuccssfuly+" "+i+" . ";g.hisAlertMulti("success",w.alertObj.alertTypeSucss,t,!1,!1,v.time);let n=w.patientSearchObj;w.clear(),w.patientSearchObj=n,w.selectPatientRslt(n)}else e.data.HITService.message&&e.data.HITService.message.errorCode&&g.hisAlertMulti("warning",w.alertObj.alertTypeWarn,e.data.HITService.message.errorMessage,!1,!1,v.time)})})()}else g.warning("Warning","Clearance Required For <b>"+this.clearanceStatusList+"</b>",!1,!1,v.time);else g.hisAlertMulti("warning",this.alertObj.alertTypeWarn,this.alertObj.discAdvRaisdSlctPat,!1,w.alertFunction,w.buttonClose,v.time)},w.checkQueryService=function(e){w.cancelChk=[],w.concsChk=[],w.multipleChkDataForList={1:w.cancelChk,2:w.concsChk};var t=a.executeQueryURLReset();return w.chkParamList=new Array,a.prepareParamListWithParam("pBillSeqId",e,w.chkParamList),a.executeQueryInput("BL_CANCEL_CHK",w.chkParamList,w.multipleChkDataForList,!0,!1,t,"popUp",{}),a.executeQueryInput("BL_CONCS_DUP_CHK1",w.chkParamList,w.multipleChkDataForList,!0,!0,t,"popUp",{}).then(function(e){return(e instanceof Array?e:[e]).map(function(e){return e})})},this.cancelBill=function(){var t={buttonCallBack1:function(){},buttonCallBack2:function(){let t={frmDate:"1800-01-01",toDate:"9999-01-01"};t.billNo=w.billOrPackage.PACKAGE_OR_BILL,P.getBillWorkList(t).then(function(t){if(null!=t.data.HITService.message&&null!=t.data.HITService.message[0]&&""!==t.data.HITService.message[0]&&null!=t.data.HITService.message[0]){let r=t.data.HITService.message[0]["com.napier.core.billgeneration.vo.Bill"];if(2==(r=r instanceof Array?r:[r])[0].invoiceReturnAmt){var i=w.alertObj.inviceGenBillPlzCnlInvBill;return g.hisAlertMulti("information",w.alertObj.alertTypeInfo,i,w.alertObjBtn,w.alertFunction,w.buttonClose),!1}w.checkQueryService(w.billOrPackage.PACKAGE_OR_BILL_SEQ_ID,!1).then(function(t){if(0==parseInt(t[0][1][0].CNT)&&0==parseInt(t[0][2][0].CNT)){e.serviceData=[],e.singleComboDataForList={1:e.serviceData};let t=a.executeQueryURLReset();e.serviceDataList=new Array;let i=r[0].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"],n="";if(null!=i)if(i instanceof Array){for(let e=0;e<i.length;e++)if(4!=i[e].payerType){n="Y";break}}else 4!=i.payerType&&(n="Y");a.prepareParamListWithParam("pBillSeqId",w.billOrPackage.PACKAGE_OR_BILL_SEQ_ID,e.serviceDataList),a.prepareParamListWithParam("pFlag",n,e.serviceDataList),a.executeQueryInput("BL_BILL_SERVICE_DTLS",e.serviceDataList,e.singleComboDataForList,!0,!0,t,"popUp",{}).then(function(t){if(null!=t[1]&&null!=t[1]&&""!=t[1]&&t[1]instanceof Array){var a={flagComp:n,flag:!0};O.open("BILL CANCELLATION",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/billingWorkList/cancel/cancelBillFromPatientBilling.screen.html",size:"md",controller:"cancelController",keyboard:!1,backdrop:"static",resolve:{billSelectedData:function(){return r},flag:function(){return a},serviceData:function(){return t[1]}}}).result.then(function(t){t&&w.getBillOrPackageData(e.patientGlobalDtls,w.billOrPackage)})}else{var i=w.alertObj.NoDataAvlble;g.hisAlertMulti("information",w.alertObj.alertTypeInfo,i,w.alertObjBtn,w.alertFunction,w.buttonClose)}})}else{var i=w.alertObj.invStldPtlyStldSelBilCncl;g.hisAlertMulti("information",w.alertObj.alertTypeInfo,i,w.alertObjBtn,w.alertFunction,w.buttonClose)}})}})},buttonClose:function(){}};g.hisAlertMulti("warning","Warning","Do you want to cancel the bill?",{buttonText:"No",buttonText2:"Yes"},t,t)},this.clear=function(e){w.patBanShow=!1,w.patientDataBedPlan=[],w.getSelectedRows=[],w.getSelectedRowSubGrid=[],w.patientAddressData=[],w.generateBillDisable=!0,w.cancelBillDisable=!0,w.patientDepostis=[],"patient"!=e&&(w.patientSearchObj=void 0),"bill"!=e?(w.billNoObj=void 0,w.disablePrint=!0):w.disablePrint=!1,this.activeFirst=1,this.disabledTabForCal=!0,w.billDetailsDataForPatient=void 0,w.billDetailList=void 0},this.print=function(){if(null!=w.billOrPackage&&"Unbilled"==w.billOrPackage.PACKAGE_OR_BILL)T.printUnbilled(e.patientGlobalDtls,w.parmaBillService,w.patientInput);else if(null!=w.billOrPackage&&w.billOrPackage.PACKAGE_OR_BILL_SEQ_ID){var t={billSeqId:w.billOrPackage.PACKAGE_OR_BILL_SEQ_ID,pFlagComp:2==w.billOrPackage.GN_PAYER_TYPE?"Y":"N"};4==w.billOrPackage.GN_PAYER_TYPE?t.reportId="BillingInPatientFinalBillReceiptReport":2==w.billOrPackage.GN_PAYER_TYPE&&(t.reportId="BillingInPatientFinalCrBillReceiptReport"),R.printReportModal("PrintTypeSelection","sm",!1).then(function(e){R.printReportModal("printBillWorkList","lg",e.printType?e.printType:e,t,e.taxType)})}}}e.$inject=["$scope","PreAuthService","QueryService","PatientBannerGlobal","PatientBannerBilling","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","bedClassGridViewConstants","diagnosisGridViewConstants","creditServiceGridViewConstants","coPayGridViewConstants","discountServiceGridDef","discountSaveGridDef","hisAlertService","$state","hisAlertConstants","BillSavePrepare","BillSaveService","patientBillingService","billDetailsForGridConstantBedRental","billDetailsForGridConstantInvestigations","billDetailsForGridConstantOT","billDetailsForGridConstantEquipment","billDetailsForGridConstantMain","$filter","patientBillingPrintService","patientBillingGridDataVald","GetBillWorkListData","hisModalService","PrintService","RoleTaskService"],angular.module("napierContainerUi").controller("patientBillingCtrl",e)}(),function(){function e(e,t,a,i,r,n){n.pageName="Print Bill",n.cancel=function(){t.dismiss("cancel")},n.printParameterList=new Array,"BillingPostingSheetReceiptReport"==e.reportId&&(i.prepareParamList("pSubAccSeqId",e.subAccSeqId,n.printParameterList),i.prepareParamList("facilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n.printParameterList),i.prepareParamList("practiceId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,n.printParameterList),i.prepareParamList("pIpSeqId",e.admissionSeqid,n.printParameterList),i.prepareParamList("pFlioSeqId",null==e.folioSeqId?"":e.folioSeqId.gQDataCode,n.printParameterList),i.prepareParamList("pBillStatus",0,n.printParameterList),i.prepareParamList("pIpNo",e.ipNo,n.printParameterList),i.prepareParamList("pFoliono",null==e.folioSeqId?"ALL":e.folioSeqId.gQDataName,n.printParameterList),i.prepareParamList("serviceListString",e.serviceListString?angular.toJson(e.serviceListString):void 0,n.printParameterList),n.printObject={},n.printObject.reportId=e.reportId),n.printObject.destination="reportingServiceImpl",n.printObject.reportType={id:"PDF"==a?4:5,desc:a},n.printObject.paramsList=n.printParameterList,r.printReportFunction(n.printObject,n)}e.$inject=["returnObj","$uibModalInstance","selectedPrintType","QueryService","PrintService","$scope"],angular.module("napierContainerUi").controller("patientBillingPrintController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l){var s=this;i.loadModule("billing"),s.authNameErrMsgStr=!1,s.authRemarksErrMsgStr=!1,s.authUserNameErrMsgStr=!1,s.authPwdErrMsgStr=!1,s.authUserNameMatchErrMsgStr=!1;JSON.parse(sessionStorage.userContextObj);var o=!0;s.validateLoginData=function(){return o=!0,s.authUserNameErrMsgStr=!1,s.logUserName||s.logUserPwd?s.logUserName?void 0:(s.authUserNameErrMsgStr=!0,o=!1,!1):(s.authUserNameErrMsgStr=!0,s.authPwdErrMsgStr=!0,o=!1,!1)},s.validateLogPwdinData=function(){if(o=!0,s.authPwdErrMsgStr=!1,!s.logUserPwd)return s.authPwdErrMsgStr=!0,o=!1,!1},s.saveAuth=function(){if(s.validateLoginData(),s.validateLogPwdinData(),!o)return!1;if(s.logUserName.toString().toLowerCase()!=JSON.parse(sessionStorage.userContextObj).LOGIN_NAME.toString().toLowerCase())return s.authUserNameMatchErrMsgStr=!0,o=!1,!1;var e={};o&&(e.authuserName=s.logUserName,e.authUserPwd=btoa(s.logUserPwd),n.checkPreLogin(e).then(function(e){if(e.data.HITService.message){if(e.data.HITService.message.hasOwnProperty("responseCode")){if(1025==e.data.HITService.message.responseCode)return void l.information(e.data.HITService.message.responseMessage)}else if(e.data.HITService.message.hasOwnProperty("userId")){if(e.data.HITService.message.userId!=JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID)return void l.information("info","User Mismatch");var i={};i.billSeqId=a,i.colSeqId=r.payment.patBillWorkSrch.COL_REQ_SEQ_ID,i.authName=r.authName,i.authRemarks=r.authRemarks,n.savePaymentBillAuth(i).then(function(e){if(e.data.HITService.message){var a=e.data.HITService.message;null!=a.ppaSeqId&&0!=a.ppaSeqId&&(r.payment.noAuthenticate=!1,r.payment.authButton=!0,t.close(i))}else l.information("info","Authorization fail")})}}else l.information("info","Authentication fail")}))};var c=!0;s.validateAuthData=function(){return s.authNameErrMsgStr=!1,c=!0,s.authName||s.authRemarks?s.authName?void s.paymentStrFrmt(s.authName):(s.authNameErrMsgStr=!0,c=!1,!1):(s.authNameErrMsgStr=!0,s.authRemarksErrMsgStr=!0,c=!1,!1)},s.validateAuthRemData=function(){if(s.authRemarksErrMsgStr=!1,c=!0,!s.authRemarks)return s.authRemarksErrMsgStr=!0,c=!1,!1;s.paymentStrFrmt(s.authName)},s.openAuth=function(i,n){if(n.validateAuthData(),n.validateAuthRemData(),!c)return!1;n.payment=r,t.close(!0),e.open({animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/payment/templates/authorization.LoginCheck.html",size:i,controller:"authModelPopupController",controllerAs:"auth",resolve:{billSeqId:function(){return a},payment:function(){return n}}}).result.then(function(e){n.reqMainData=e})},s.cancelAuth=function(){t.close(!0)},s.paymentStrFrmt=function(e){if(e){if(0==/^[a-zA-Z\s]+$/.test(e))return s.authNameErrMsgStr=!0,c=!1,!1;s.authNameErrMsgStr=!1,c=!0}}}e.$inject=["$uibModal","$uibModalInstance","billSeqId","hisTranslationsService","payment","paymentService","hisAlertService"],angular.module("napierContainerUi").controller("authModelPopupController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C,I,A,E,h,b,T,L,P,O,R){var N=this;N.cheskSession=!1,N.getsummary=!1,N.partial=!1,N.billPartialAmtList=[],null!=sessionStorage.getItem("cashier")||sessionStorage.getItem("checkModel")?N.cheskSession=!0:(sessionStorage.setItem("checkModel",!0),N.concessionModal=e.open({animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/collection-summary/sections/counter.management.login.model.html",controller:"concessionModalCtrl",controllerAs:"cmc",backdrop:"static",keyboard:!1,size:"sm"}),N.concessionModal.result.then(function(){sessionStorage.removeItem("checkModel")})),v.loadModule("billing");var w=f.getLanguageToSet();function F(e){for(var t=0;t<e.length;t++){var a=_.findIndex(N.crNoteGridOptions.data,function(a){return a.CRN_HD_SEQ_ID==e[t].entity.CRN_HD_SEQ_ID});e[t].entity.isRequired&&(N.crNoteGridOptions.data[a].isRequired=!1,N.gridOptions.data[5].patientAmt=N.gridOptions.data[5].patientAmt+e[t].entity.adjustNewAmt,N.gridOptions.data[5].patientAmt=parseFloat(N.gridOptions.data[5].patientAmt.toFixed(2)),N.paymentTabgridOptions.data.length>0?N.paymentTabgridOptions.data[0].amtPaid=N.gridOptions.data[5].patientAmt:(N.payAmountCash=N.gridOptions.data[5].patientAmt,N.payAmountCashTemp=N.payAmountCash,N.roundOffValue=0),m.amount=N.gridOptions.data[5].patientAmt,N.adjustAmt=N.adjustAmt-parseFloat(e[t].entity.adjustNewAmt.toFixed(2)))}}v.changeLanguage(w),m.chequeDateOptions={},m.chequeDateOptions.minDate=moment(),N.open=function(e){l.open("AUTHORIZATION",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/payment/templates/authorization.modal.html",size:e,controller:"authModelPopupController",controllerAs:"auth",resolve:{billSeqId:function(){return B},payment:function(){return N}}})},N.receiptsmode=function(){N.activeFirst=2},N.gridOptions=angular.copy(a),N.paymentTabgridOptions=angular.copy(c),N.receiptTabGridDefinitionDisplay=angular.copy(d),N.receiptTabGridDefinitionDisplay.data=[],N.gridOptions.data=[],N.crNoteGridOptions=angular.copy(n),N.creditNoteGridOptions=angular.copy(n),N.creditNoteGridOptions.columnDefs[N.creditNoteGridOptions.columnDefs.length-1].visible=!0,N.crNoteGridOptions.columnDefs[2].aggregationType=parseFloat(i.aggregationTypes.sum.toFixed(2)),N.crNoteGridOptions.columnDefs[3].aggregationType=parseFloat(i.aggregationTypes.sum.toFixed(2)),N.crNoteGridOptions.columnDefs[4].aggregationType=parseFloat(i.aggregationTypes.sum.toFixed(2)),N.crNoteGridOptions.onRegisterApi=function(e){N.crGridApi=e,e.selection.on.rowSelectionChanged(m,function(e){N.crGridApi.selection.getSelectedRows().length>0?N.adjustFlag=!0:N.adjustFlag=!1,F([e])}),e.selection.on.rowSelectionChangedBatch(m,function(e){N.crGridApi.selection.getSelectedRows().length>0?N.adjustFlag=!0:N.adjustFlag=!1,F(e)})};var M=!0;N.paymentValidateStrFrmt=function(e){if(N.PatientErrMsgStr=!1,M=!0,e){if(0==/^[a-zA-Z\s_\\\/.@(’',)?*&$!#^+:%-]+$/.test(e))return N.PatientErrMsgStr=!0,M=!1,!1;N.PatientErrMsgStr=!1,M=!0}},N.roleTask=I.rolePermission("T_CH_TR_PAYMENT_REFUND"),N.changeDisableStatus=function(){N.patBillWorkSrch||(m.disableFlg=!1,m.disableBnrFlg=!1,m.corpSettlementBnr=!1,N.colReqSeqId=void 0,N.gridOptions.data=[])},N.changeDisableStatus1=function(){N.patBillRcptSrch?N.isfromBWL=!0:N.patBillRcptSrch||(N.isfromBWL=!1,m.isRcptChkFlg=!1,m.corpSettlementBnr=!1,m.disableBnrFlg=!1,N.colReqSeqId=void 0,N.receiptTabGridDefinitionDisplay.data=[])},N.patientBillNoSrch=function(e){e?m.disableFlg=!0:(m.disableFlg=!1,m.disableBnrFlg=!1,N.colReqSeqId=void 0,N.gridOptions.data=[]),N.billData=[],N.multipleBillDataForList={1:N.billData};var t=g.executeQueryURLReset();return N.billDataList=new Array,g.prepareParamListWithParam("visitId",e,N.billDataList),g.prepareParamListWithParam("visitId",e,N.billDataList),g.prepareParamListWithParam("pBillNo",e,N.billDataList),g.prepareParamListWithParam("pBillNo",e,N.billDataList),g.prepareParamListWithParam("pMrNO",e,N.billDataList),g.prepareParamListWithParam("pMrNO",e,N.billDataList),g.prepareParamListWithParam("pPatName",e,N.billDataList),g.prepareParamListWithParam("pPatName",e,N.billDataList),g.prepareParamListWithParam("pPatName",e,N.billDataList),g.prepareParamListWithParam("pPatName",e,N.billDataList),g.prepareParamListWithParam("pIpNo",e,N.billDataList),g.prepareParamListWithParam("pIpNo",e,N.billDataList),g.executeQueryInput("SEARCH_PATIENT_BILL_NO",N.billDataList,N.multipleBillDataForList,!0,!0,t,"popUp",N.gridOptions).then(function(e){var t=e[1]instanceof Array?e[1]:[e[1]];return N.depositDetails=t,t.map(function(e){return e})})},N.getCrNoteData=function(){var e={1:N.crNoteDataList=[]},t=g.executeQueryURLReset(),a=new Array;g.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,a),g.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a),g.prepareParamListWithParam("pFromDate","1800-01-01",a),g.prepareParamListWithParam("pToDate","9999-12-30",a),g.prepareParamListWithParam("pFirstName","",a),g.prepareParamListWithParam("pScrollStatus","",a),g.prepareParamListWithParam("pPaymentStatus","",a),g.prepareParamListWithParam("pPatientId",m.patientGlobalDtls.mrNo,a),g.prepareParamListWithParam("pRefType","",a),g.prepareParamListWithParam("pIpNo","",a),m.patientGlobalDtls.mrNo&&g.executeQueryInput("BL_CREDIT_NOTE_001",a,e,!0,!0,t,"popUp",{}).then(function(e){if(e[1]&&e[1][0])if(N.isfromPB){N.creditNoteGridOptions.data=[];for(var t=0;t<N.crNoteDataList.length;t++)N.crNoteDataList[t].balanceAmt=N.crNoteDataList[t].CR_NOTE_AMT-N.crNoteDataList[t].CNH_ADJ_AMT,N.creditNoteGridOptions.data.push(N.crNoteDataList[t])}else{N.crNoteGridOptions.data=[];for(t=0;t<N.crNoteDataList.length;t++)N.crNoteDataList[t].balanceAmt=N.crNoteDataList[t].CR_NOTE_AMT-N.crNoteDataList[t].CNH_ADJ_AMT,N.crNoteGridOptions.data.push(N.crNoteDataList[t])}else N.crNoteGridOptions.data=[],N.creditNoteGridOptions.data=[]})},N.getPatBillDetailsData=function(e){N.billPatDetails=[],N.getPatBillDetails={1:N.billPatDetails};var t=g.executeQueryURLReset();return N.billPatDetailsDataList=new Array,g.prepareParamListWithParam("pColReqSeqId",e,N.billPatDetailsDataList),g.executeQueryInput("SCROLL_IPBILL_PATIENTDETAILS",N.billPatDetailsDataList,N.getPatBillDetails,!0,!0,t,"popUp",N.gridOptions).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})};var G=[],x=[];N.corpResult1=[];var q=[],V=[],B=0;N.billSearchResult=function(e){if(N.adjustFlag=!1,N.noAuthenticate=!0,N.isfromBWLP=!0,N.colReqSeqId=void 0,N.billPartialAmtList=[],N.refundData=void 0,N.crGridApi&&N.crGridApi.selection.clearSelectedRows(),e.hasOwnProperty("TRAN_REQ_TYPE")||N.isfromBWL){if(C.colReqType=e.COL_REQ_TYPE,8==e.COL_REQ_TYPE){m.disableTabs=!1,N.authButton=!1,m.isDepositPay=!1,N.activeFirst=1,N.saveButton=!0,N.partial=!1,N.gridOptions.data=[],N.paymentTabgridOptions.data=[],m.corpSettlementBnr=!0,m.disableBnrFlg=!0,N.paymentMode=1,m.amount=0,N.payAmountCash=0,N.payAmountCashTemp=0,N.roundOffValue=0,N.billAmmount="2",N.rcvdFrmCash="",N.CorpStlmntData=[],N.getCorpStlmntDataList={1:N.CorpStlmntData};var t=g.executeQueryURLReset();N.corpStlmntDataList=new Array,g.prepareParamListWithParam("pColReqSeqID",e.COL_REQ_SEQ_ID,N.corpStlmntDataList),g.executeQueryInput("INVOICE_DETAILS_BANNER",N.corpStlmntDataList,N.getCorpStlmntDataList,!0,!0,t,"popUp",N.gridOptions).then(function(e){(x=e[1]instanceof Array?e[1]:[e[1]])[0].COL_REQ_DATE&&(x[0].COL_REQ_DATE=moment(x[0].COL_REQ_DATE).format("DD-MMM-YYYY")),x[0].INVC_SETL_ON&&(x[0].INVC_SETL_ON=moment(x[0].INVC_SETL_ON).format("DD-MMM-YYYY")),N.corpResult1=x[0],m.amount=x[0].NET_AMT,N.payAmountCash=x[0].NET_AMT,N.payAmountCashTemp=h.roundoff(N.payAmountCash),N.roundOffValue=parseFloat(N.payAmountCashTemp)-parseFloat(m.amount),null!=x[0].COMP_ID&&null!=x[0].COMP_ID&&(N.payerCompanyId=x[0].COMP_ID),null!=x[0].COMP_NAME&&null!=x[0].COMP_NAME&&(N.payerCompanyName=x[0].COMP_NAME)}),N.CorpStlmntBannerData=[],N.getCorpStlmntBannerDataList={1:N.CorpStlmntBannerData};t=g.executeQueryURLReset();N.corpStlmntBannerDataList=new Array,g.prepareParamListWithParam("pCompSeqId",e.REF_SEQ_ID,N.corpStlmntBannerDataList),g.prepareParamListWithParam("pCompSeqId",e.REF_SEQ_ID,N.corpStlmntBannerDataList),g.prepareParamListWithParam("pPayerAccSeqId",e.PAYER_ACC_SEQ_ID,N.corpStlmntBannerDataList),g.prepareParamListWithParam("pPayerAccSeqId",e.PAYER_ACC_SEQ_ID,N.corpStlmntBannerDataList),g.executeQueryInput("ON_ACC_DESP_COMPANY_BANNER",N.corpStlmntBannerDataList,N.getCorpStlmntBannerDataList,!0,!0,t,"popUp",N.gridOptions).then(function(e){e[1]instanceof Array?e[1]:[e[1]]})}else m.disableTabs=!1,N.authButton=!1,m.isDepositPay=!1,N.activeFirst=1,N.saveButton=!0,N.partial=!1,m.corpSettlementBnr=!1,N.getPatBillDetailsData(e.COL_REQ_SEQ_ID).then(function(t){if(B=t.length>0&&t[0].BILL_SEQ_ID?t[0].BILL_SEQ_ID:e.BILL_SEQ_ID,m.disableBnrFlg=!0,null!=e.PAY_MODE?N.paymentMode=e.PAY_MODE:N.paymentMode=1,m.amount=0,N.payAmountCash=0,N.billAmmount="1",N.rcvdFrmCash="",N.gridOptions.data=[],N.paymentTabgridOptions.data=[],N.searchData=[],N.getSelectedBillDataList={1:N.searchData},0!=B){var a=g.executeQueryURLReset();N.billSearchDataList=new Array,g.prepareParamListWithParam("pBillSeqId",B,N.billSearchDataList),g.executeQueryInput("PAYMENT_GRID_DATA",N.billSearchDataList,N.getSelectedBillDataList,!0,!0,a,"popUp",N.gridOptions).then(function(t){G=t[1]instanceof Array?t[1]:[t[1]];var a=2==e.TRAN_REQ_TYPE?e.REQ_AMOUNT:G[0].PAT_REFUND_AMOUNT;N.refundData=a,N.gridOptions.data=[],N.gridOptions.data.push({billDtls:"Bill Amount",payerAmt:G[1]?G[1].COMP_AMT:G[0].COMP_AMT,patientAmt:G[0].PAT_AMT}),N.gridOptions.data.push({billDtls:"Discount",payerAmt:G[1]?G[1].COMP_TPA_DISCOUNT_AMT:G[0].COMP_TPA_DISCOUNT_AMT,patientAmt:G[0].PAT_DISCOUNT_AMT}),N.gridOptions.data.push({billDtls:"Deposit",payerAmt:G[1]?G[1].DEP_COMP_ADJUST_AMT:G[0].DEP_COMP_ADJUST_AMT,patientAmt:G[0].DEP_PAT_ADJUST_AMT}),N.gridOptions.data.push({billDtls:"Receipts",payerAmt:void 0,patientAmt:void 0}),N.gridOptions.data.push({billDtls:"Refunds",payerAmt:G[1]?G[1].COMP_REFUND_AMOUNT:G[0].COMP_REFUND_AMOUNT,patientAmt:a}),N.gridOptions.data.push({billDtls:"Net Balance",payerAmt:G[1]?G[1].COMP_NET_BALANCE:G[0].COMP_NET_BALANCE,patientAmt:G[0].PAT_NET_BALANCE}),N.payAmountCash=G[1]?G[1].COMP_REFUND_AMOUNT:G[0].COMP_REFUND_AMOUNT,"1"==N.billAmmount?(m.amount=G[0].PAT_NET_BALANCE,N.payAmountCash=G[0].PAT_NET_BALANCE,N.payAmountCashTemp=h.roundoff(G[0].PAT_NET_BALANCE),N.colReqSeqId=G[0].COL_REQ_SEQ_ID):"2"==N.billAmmount&&(m.amount=G[0].COMP_NET_BALANCE,N.payAmountCash=G[0].COMP_NET_BALANCE,N.payAmountCashTemp=h.roundoff(G[0].COMP_NET_BALANCE),N.colReqSeqId=G[1]?G[1].COL_REQ_SEQ_ID:G[0].COL_REQ_SEQ_ID),N.roundOffValue=parseFloat(N.payAmountCashTemp)-parseFloat(m.amount),function(e){var t={1:N.billPartialAmtList=[]},a=g.executeQueryURLReset(),i=new Array;g.prepareParamListWithParam("pBillNo",e.billNo,i),g.prepareParamListWithParam("pRegSeqId",e.patSeqId,i),g.executeQueryInput("GET_PARTIAL_AMOUNT",i,t,!0,!0,a,"popUp",{}).then(function(e){if(N.billPartialAmtList[0]){if(N.partialAmount=angular.copy(N.billPartialAmtList[0].PATIENT_PAYING_AMOUNT),null==N.billPartialAmtList[0].COL_REQ_SEQ_ID||null==N.billPartialAmtList[0].COL_REQ_SEQ_ID){var t=(null==N.gridOptions.data[5].patientAmt?parseFloat(0):N.gridOptions.data[5].patientAmt)+(null==N.gridOptions.data[5].payerAmt?parseFloat(0):N.gridOptions.data[5].payerAmt);N.partialAmountTotal=t-angular.copy(N.billPartialAmtList[0].PATIENT_PAYING_AMOUNT),N.partialAmountTotal=parseFloat(N.partialAmountTotal.toFixed(2)),N.partialRequestSeqId=N.billPartialAmtList[0].PA_REQ_SEQ_ID}else N.partialAmountTotal=0;N.partialStatus=angular.copy(N.billPartialAmtList[0].STATUS),N.partialCollectionSeqId=N.billPartialAmtList[0].COL_REQ_SEQ_ID}})}({patSeqId:e.PAT_RG_SEQ_ID,billNo:N.patBillWorkSrch.REQ_AGAINST_NO})})}if(5==e.COL_REQ_TYPE||10==e.COL_REQ_TYPE||11==e.COL_REQ_TYPE||20==e.COL_REQ_TYPE||27==e.COL_REQ_TYPE){N.authButton=!0,m.isDepositPay=!0,N.billDepositPatDetails=[],N.getPatBillDepositDetails={1:N.billDepositPatDetails};a=g.executeQueryURLReset();N.billDepositPatDetailsDataList=new Array,g.prepareParamListWithParam("pColReqId",e.COL_REQ_SEQ_ID,N.billDepositPatDetailsDataList),g.executeQueryInput("REQUEST_DETAILS_BANNER",N.billDepositPatDetailsDataList,N.getPatBillDepositDetails,!0,!0,a,"popUp",N.gridOptions).then(function(t){var a,i;q=t[1]instanceof Array?t[1]:[t[1]],5==e.COL_REQ_TYPE?(N.billAmmount="2",m.amount=q[0].REQ_AMT,N.payAmountCash=q[0].REQ_AMT,i=q[0].REQ_AMT):(N.billAmmount="1",m.amount=q[0].REQ_AMT,N.payAmountCash=q[0].REQ_AMT,a=q[0].REQ_AMT),N.payAmountCashTemp=h.roundoff(N.payAmountCash),N.roundOffValue=parseFloat(N.payAmountCashTemp)-parseFloat(m.amount),N.gridOptions.data=[],N.gridOptions.data.push({billDtls:"Bill Amount",payerAmt:void 0,patientAmt:void 0}),N.gridOptions.data.push({billDtls:"Discount",payerAmt:void 0,patientAmt:void 0}),N.gridOptions.data.push({billDtls:"Deposit",payerAmt:i,patientAmt:a}),N.gridOptions.data.push({billDtls:"Receipts",payerAmt:void 0,patientAmt:void 0}),N.gridOptions.data.push({billDtls:"Refunds",payerAmt:void 0,patientAmt:void 0}),N.gridOptions.data.push({billDtls:"Net Balance",payerAmt:void 0,patientAmt:void 0}),5==e.COL_REQ_TYPE?(N.billAmmount="2",m.amount=q[0].REQ_AMT,N.payAmountCash=q[0].REQ_AMT):(N.billAmmount="1",m.amount=q[0].REQ_AMT,N.payAmountCash=q[0].REQ_AMT)})}if(2==e.TRAN_REQ_TYPE){m.disableTabs=!0,N.activeFirst=3,N.saveButton=!1,N.billRefundPatDetails=[],N.getPatBillRefundDetails={1:N.billRefundPatDetails};a=g.executeQueryURLReset();N.billRefundPatDetailsDataList=new Array,N.payAmountCash=N.refundData,g.prepareParamListWithParam("pColReqId",e.COL_REQ_SEQ_ID,N.billRefundPatDetailsDataList),g.executeQueryInput("REQUEST_DETAILS_BANNER",N.billRefundPatDetailsDataList,N.getPatBillRefundDetails,!0,!0,a,"popUp",N.gridOptions).then(function(e){q=e[1]instanceof Array?e[1]:[e[1]],N.refundData=null==N.refundData?q[0].REQ_AMT:N.refundData,N.payAmountCash=N.refundData,E(function(){N.payAmountCash=N.refundData,N.payAmountCashTemp=h.roundoff(N.refundData),N.roundOffValue=parseFloat(N.payAmountCashTemp)-parseFloat(N.refundData)},100),N.refundId=q[0].REQ_NO})}var i="1",r=e;r.regSeqId=e.PAT_RG_SEQ_ID,r.admissionSeqid=e.PAT_IPADM_SEQ_ID,i=null!=r.admissionSeqid&&0!=r.admissionSeqid?"1":"2",null==m.patientGlobalDtls?s.getPatientBanner(r,i).then(function(e){m.patientGlobalDtls=e,o.patientBannerDetail(r.regSeqId).then(function(e){m.patientBannerDetails=e,m.patientRecordsDetail=m.patientBannerDetails.patientRecordsDetail,m.patientValue=m.patientBannerDetails.patientValue,N.getCrNoteData()})}):m.patientGlobalDtls&&N.getCrNoteData()});N.receiptTabGridDefinitionDisplay.data=[],N.billRcptPatDetails=[],N.getPatRcptDetails={1:N.billRcptPatDetails};t=g.executeQueryURLReset();N.billRcptPatDetailsDataList=new Array,g.prepareParamListWithParam("pColReqSeqId",e.COL_REQ_SEQ_ID,N.billRcptPatDetailsDataList),g.executeQueryInput("SCR_RECIEPT_DTLS_VIEW_GRID",N.billRcptPatDetailsDataList,N.getPatRcptDetails,!0,!0,t,"popUp",N.gridOptions).then(function(e){if(0!=(V=e[1]instanceof Array?e[1]:[e[1]]).length){for(var t=0;t<V.length;t++)V[t].RECP_DATE&&(V[t].RECP_DATE=moment(V[t].RECP_DATE).format("DD-MMM-YYYY HH:mm"));N.receiptTabGridDefinitionDisplay.data=angular.copy(V)}})}else u.warning("Warning","Please Select Existing Bill/Unpaid Bill")},N.paymentModeResult=function(){N.PmtModehData=[],N.bankNamesData=[],N.ecsTranTypeData=[],N.chequeTypeData=[],N.cardTypeData=[],N.getSelectedPmtMode={1:N.PmtModehData,2:N.bankNamesData,3:N.ecsTranTypeData,4:N.chequeTypeData,5:N.cardTypeData};var e=g.executeQueryURLReset();N.paymentModeDataList=new Array,g.prepareParamListWithParam("pMasterSqId","21008",N.paymentModeDataList),g.executeQueryInput("NH_GN_M_MASTER_DT_COMBO",N.paymentModeDataList,N.getSelectedPmtMode,!0,!1,e,"popUp",N.gridOptions),N.bankNamesDataList=new Array,g.prepareParamListWithParam("pMasterSqId","700179",N.bankNamesDataList),g.executeQueryInput("NH_GN_M_MASTER_DT_COMBO",N.bankNamesDataList,N.getSelectedPmtMode,!0,!1,e,"popUp",N.gridOptions),N.ecsTranTypeDataList=new Array,g.prepareParamListWithParam("pMasterSqId","700189",N.ecsTranTypeDataList),g.executeQueryInput("NH_GN_M_MASTER_DT_COMBO",N.ecsTranTypeDataList,N.getSelectedPmtMode,!0,!1,e,"popUp",N.gridOptions),N.chequeTypeDataList=new Array,g.prepareParamListWithParam("pMasterSqId","21009",N.chequeTypeDataList),g.executeQueryInput("NH_GN_M_MASTER_DT_COMBO",N.chequeTypeDataList,N.getSelectedPmtMode,!0,!0,e,"popUp",N.gridOptions),N.cardTypeDataList=new Array,g.prepareParamListWithParam("pMasterSqId","969",N.cardTypeDataList),g.executeQueryInput("NH_GN_M_MASTER_DT_COMBO",N.cardTypeDataList,N.getSelectedPmtMode,!0,!1,e,"popUp",N.gridOptions)},N.getBank=function(e){N.chequeDDDate=2==e||3==e?new Date:"",5!=e&&8!=e||(N.rcvdFrmCash=""),N.PatientErrMsgStr=!1,M=!0,N.bankData=[],N.getSelectedbank={1:N.bankData};var t=g.executeQueryURLReset();N.getBankByepaymentMode=new Array,g.prepareParamListWithParam("pPaymentMode",e,N.getBankByepaymentMode),g.executeQueryInput("COL_BANK_DTLS_BASED_ON_PAYMMODE",N.getBankByepaymentMode,N.getSelectedbank,!0,!0,t,"popUp",N.gridOptions)},m.setBillAmount=function(e){"1"==e?(m.amount=G[0].PAT_NET_BALANCE,N.payAmountCash=G[0].PAT_NET_BALANCE,N.payAmountCashTemp=h.roundoff(G[0].PAT_NET_BALANCE),N.colReqSeqId=G[0].COL_REQ_SEQ_ID,N.billAmmount="1"):"2"==e&&(m.amount=G[1]?G[1].COMP_NET_BALANCE:G[0].COMP_NET_BALANCE,N.payAmountCash=G[1]?G[1].COMP_NET_BALANCE:G[0].COMP_NET_BALANCE,N.payAmountCashTemp=h.roundoff(G[1]?G[1].COMP_NET_BALANCE:G[0].COMP_NET_BALANCE),N.billAmmount="2",N.colReqSeqId=G[1]?G[1].COL_REQ_SEQ_ID:G[0].COL_REQ_SEQ_ID),N.roundOffValue=parseFloat(N.payAmountCashTemp)-parseFloat(m.amount)},N.changeTemp=function(e){N.payAmountCash=N.payAmountCashTemp,N.roundOffValue=0,N.flagT=!1},N.validateRequiredFields=function(e){var t="77";if("99"==e&&(t="99"),M=!0,1==N.paymentMode){if(!(N.adjustAmtFlag||N.payAmountCash&&0!=N.payAmountCash||"8"!=e&&"99"!=t))return N.cashAmountErrMsgStr=!0,M=!1,!1;"8"==e&&(N.cashAmountErrMsgStr=!1)}if(2==N.paymentMode||3==N.paymentMode){if(!(N.payAmountCash&&0!=N.payAmountCash||N.chequeType||N.chequeDDno||"99"!=t))return N.cashAmountErrMsgStr=!0,N.chqTypeErrMsgStr=!0,N.chqDDTypeErrMsgStr=!0,M=!1,!1;if(N.payAmountCash&&0!=N.payAmountCash||"5"!=e&&"99"!=t)"5"==e&&(N.cashAmountErrMsgStr=!1);else if(N.cashAmountErrMsgStr=!0,M=!1,"99"!=t)return!1;if(N.chequeType||"6"!=e&&"99"!=t)"6"==e&&(N.chqTypeErrMsgStr=!1);else if(N.chqTypeErrMsgStr=!0,M=!1,"99"!=t)return!1;if(N.chequeDDno||"7"!=e&&"99"!=t)"7"==e&&(N.chqDDTypeErrMsgStr=!1);else if(N.chqDDTypeErrMsgStr=!0,M=!1,"99"!=t)return!1}if(4==N.paymentMode||9==N.paymentMode){if(!(N.payAmountCash&&0!=N.payAmountCash||N.cardNumber||N.cardTranId||N.cardType||"99"!=t||N.exMonth||N.exYear))return N.cashAmountErrMsgStr=!0,N.cCardNoErrMsgStr=!0,N.cCardTranIdErrMsgStr=!0,N.cCardTypeErrMsgStr=!0,N.PatientErrMonthExpiryDate=!0,N.PatientErrYearExpiryDate=!0,M=!1,!1;if(N.payAmountCash&&0!=N.payAmountCash||"1"!=e&&"99"!=t)"1"==e&&(N.cashAmountErrMsgStr=!1);else if(N.cashAmountErrMsgStr=!0,M=!1,"99"!=t)return!1;if(N.cardNumber||"2"!=e&&"99"!=t)"2"==e&&(N.cCardNoErrMsgStr=!1,N.cCardNoLengthErrMsgStr=!1);else if(N.cCardNoErrMsgStr=!0,M=!1,"99"!=t)return!1;if(N.cardNumber&&N.cardNumber.length<16&&"99"==t&&(N.cCardNoLengthErrMsgStr=!0,M=!1),N.cardTranId||"3"!=e&&"99"!=t)"3"==e&&(N.cCardTranIdErrMsgStr=!1);else if(N.cCardTranIdErrMsgStr=!0,M=!1,"99"!=t)return!1;if(N.exMonth||"5"!=e&&"99"!=t)"5"==e&&(N.PatientErrMonthExpiryDate=!1);else if(N.PatientErrMonthExpiryDate=!0,M=!1,"99"!=t)return!1;if(N.exYear||"6"!=e&&"99"!=t)"6"==e&&(N.PatientErrYearExpiryDate=!1);else if(N.PatientErrYearExpiryDate=!0,M=!1,"99"!=t)return!1;if(N.cardType||"7"!=e&&"99"!=t)"7"==e&&(N.cCardTypeErrMsgStr=!1);else if(N.cCardTypeErrMsgStr=!0,M=!1,"99"!=t)return!1}if(5==N.paymentMode){if(!(N.payAmountCash&&0!=N.payAmountCash||N.paymentTranType||"99"!=t))return N.cashAmountErrMsgStr=!0,N.EcsPayTypeErrMsgStr=!0,M=!1,!1;if(N.payAmountCash&&0!=N.payAmountCash||"9"!=e&&"99"!=t)"9"==e&&(N.cashAmountErrMsgStr=!1);else if(N.cashAmountErrMsgStr=!0,M=!1,"99"!=t)return!1;if(N.paymentTranType||"10"!=e&&"99"!=t)"10"==e&&(N.EcsPayTypeErrMsgStr=!1);else if(N.EcsPayTypeErrMsgStr=!0,M=!1,"99"!=t)return!1}if(7==N.paymentMode){if(!(N.payAmountCash&&0!=N.payAmountCash||N.mobileNumber||N.cardTranId||"99"!=t))return N.cashAmountErrMsgStr=!0,N.eWltMobileErrMsgStr=!0,N.eWltTranIdErrMsgStr=!0,M=!1,!1;if(N.payAmountCash&&0!=N.payAmountCash||"11"!=e&&"99"!=t)"11"==e&&(N.cashAmountErrMsgStr=!1);else if(N.cashAmountErrMsgStr=!0,M=!1,"99"!=t)return!1;if(N.mobileNumber||"12"!=e&&"99"!=t)"12"==e&&(N.eWltMobileErrMsgStr=!1,N.eWltMobileLengthErrMsgStr=!1);else if(N.eWltMobileErrMsgStr=!0,M=!1,"99"!=t)return!1;if(N.mobileNumber&&N.mobileNumber.length<10&&"99"==t&&(N.eWltMobileLengthErrMsgStr=!0,M=!1),N.cardTranId||"14"!=e&&"99"!=t)"14"==e&&(N.eWltTranIdErrMsgStr=!1);else if(N.eWltTranIdErrMsgStr=!0,M=!1,"99"!=t)return!1}if(8==N.paymentMode){if(!(N.payAmountCash&&0!=N.payAmountCash||N.cardTranId||N.bankName||"99"!=t))return N.cashAmountErrMsgStr=!0,N.ntBnkTranIdErrMsgStr=!0,N.ntBnkBankErrMsgStr=!0,M=!1,!1;if(N.payAmountCash&&0!=N.payAmountCash||"15"!=e&&"99"!=t)"15"==e&&(N.cashAmountErrMsgStr=!1);else if(N.cashAmountErrMsgStr=!0,M=!1,"99"!=t)return!1;if(N.cardTranId||"16"!=e&&"99"!=t)"16"==e&&(N.ntBnkTranIdErrMsgStr=!1);else if(N.ntBnkTranIdErrMsgStr=!0,M=!1,"99"!=t)return!1;if(N.bankName||"17"!=e&&"99"!=t)"17"==e&&(N.ntBnkBankErrMsgStr=!1);else if(N.ntBnkBankErrMsgStr=!0,M=!1,"99"!=t)return!1}},m.createPayGrid=function(){if(!N.billPartialAmtList[0]||2!=N.billPartialAmtList[0].STATUS||null!=N.billPartialAmtList[0].COL_REQ_SEQ_ID&&null!=N.billPartialAmtList[0].COL_REQ_SEQ_ID){if(N.billPartialAmtList[0]&&1==N.billPartialAmtList[0].STATUS&&parseFloat(N.gridOptions.data[5].patientAmt)!=parseFloat(N.payAmountCash))return void u.warning("Warning","Partial Payment Approval is  Pending")}else if(N.billPartialAmtList[0].PATIENT_PAYING_AMOUNT>parseFloat(N.payAmountCash))return void u.warning("Warning","Due amount should be less than or equal to &nbsp;"+N.partialAmountTotal);if(N.paymentValidateStrFrmt(N.rcvdFrmCash),!M)return!1;if(N.validateRequiredFields("99"),!M)return!1;var e=null,t=null,a=!1;if(parseFloat(N.payAmountCash)<0)u.warning("Warning","Negative Amount Not Allow to make Payment");else{if(angular.forEach(N.PmtModehData,function(t){t.DT_CODE==N.paymentMode&&(e=t.DETAIL_DESC)}),N.bankName&&angular.forEach(N.bankNamesData,function(e){e.DT_CODE==N.bankName&&(t=e.DETAIL_DESC)}),m.corpSettlementBnr){if(N.paymentTabgridOptions.data.length>0){var i=0;if(angular.forEach(N.paymentTabgridOptions.data,function(e){"2"==N.billAmmount&&"2"==e.payerRadType&&(parseFloat(e.roundOffValue),i+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue)),e.PayModeCode==N.paymentMode&&(a=!0)}),a)return void u.warning("Warning","Payment Mode "+e+" is already existed.");if("2"==N.billAmmount&&(G[1]?G[1].REQ_AMOUNT:null!=G[0]?G[0].REQ_AMOUNT:m.amount)<parseFloat(N.payAmountCash)+i)return void u.warning("Warning","Amount should not exceed from Total Amount");if("2"==N.billAmmount&&0==parseFloat(N.payAmountCash)&&(G[1]?G[1].REQ_AMOUNT:null!=G[0]?G[0].REQ_AMOUNT:m.amount)==parseFloat(N.payAmountCash)+i)return void u.warning("Warning","sum of added Amount Reached to Total Amount")}else{if("2"==N.billAmmount&&G[1]?G[1].REQ_AMOUNT:null!=G[0]&&null!=G[0].REQ_AMOUNT&&G[0].REQ_AMOUNT<parseFloat(N.payAmountCash))return(G[1]?G[1].REQ_AMOUNT:0==G[0].REQ_AMOUNT&&G[1]?G[1].REQ_AMOUNT:G[0].REQ_AMOUNT<=parseFloat(N.payAmountCash))?void u.warning("Warning","Payer have Zero(0) Total Ammout"):void u.warning("Warning","Amount should not exceed from Total Amount");if("2"==N.billAmmount&&null==G[1]&&null==G[0]&&null!=m.amount&&null!=m.amount&&m.amount<parseFloat(N.payAmountCash))return void u.warning("Warning","Amount should not exceed from Total Amount")}N.paymentTabgridOptions.data.push({payerRadType:N.billAmmount,PayMode:e,PayModeCode:N.paymentMode,amtPaid:1==N.activeFirst?parseFloat(N.payAmountCashTemp):N.payAmountCash,Receivedfrom:N.rcvdFrmCash,paymentDate:N.paymentDate,cardNumber:N.cardNumber,cardTranId:N.cardTranId,bank:N.bankName?t:N.bankName,chequeType:N.chequeType?N.chequeType:void 0,chequeDDno:N.chequeDDno,chequeDDDate:N.chequeDDDate,paymentTranType:N.paymentTranType?N.paymentTranType:void 0,refNo:N.cardTranId?N.cardTranId:N.chequeDDno,mobileNumber:N.mobileNumber,cardExpiryDate:N.exMonth&&N.exYear?N.exMonth.month_id+"/"+N.exYear.year_id:void 0,cardType:N.cardType,roundOffValue:parseFloat(N.roundOffValue)});var r=0;angular.forEach(N.paymentTabgridOptions.data,function(e){"2"==N.billAmmount&&"2"==e.payerRadType&&(parseFloat(e.roundOffValue),r+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue))}),"2"==N.billAmmount&&(N.payAmountCash=N.adjustAmtFlag?0:G[1]&&null!=G[1].REQ_AMOUNT?G[1].REQ_AMOUNT:null!=G[0]&&null!=G[0].REQ_AMOUNT?G[0].REQ_AMOUNT-r:null!=m.amount?m.amount-r:0),N.adjustAmtFlag||0!=parseFloat(N.payAmountCash)||(N.rcvdFrmCash="",N.payAmountCashTemp=0,N.roundOffValue=0),0==N.roundOffValue&&(N.payAmountCashTemp=N.payAmountCash),0!=N.payAmountCashTemp&&(N.payAmountCashTemp=h.roundoff(N.payAmountCash),N.roundOffValue=parseFloat(N.payAmountCashTemp)-parseFloat(N.payAmountCash))}else if(m.isDepositPay){if(N.paymentTabgridOptions.data.length>0){n=0,i=0;if(angular.forEach(N.paymentTabgridOptions.data,function(e){"1"==N.billAmmount&&"1"==e.payerRadType?(parseFloat(e.roundOffValue),n+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue)):"2"==N.billAmmount&&"2"==e.payerRadType&&(parseFloat(e.roundOffValue),i+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue)),e.PayModeCode==N.paymentMode&&(a=!0)}),a)return void u.warning("Warning","Payment Mode "+e+" is already existed.");if("1"==N.billAmmount&&q[0].REQ_AMT<parseFloat(N.payAmountCash)+n)return void u.warning("Warning","Amount should not exceed from Total Amount");if("2"==N.billAmmount&&q[0].REQ_AMT<parseFloat(N.payAmountCash)+i)return void u.warning("Warning","Amount should not exceed from Total Amount");if("1"==N.billAmmount&&0==parseFloat(N.payAmountCash)&&q[0].REQ_AMT==parseFloat(N.payAmountCash)+n)return void u.warning("Warning","sum of added Amount Reached to Total Amount");if("2"==N.billAmmount&&0==parseFloat(N.payAmountCash)&&q[0].REQ_AMT==parseFloat(N.payAmountCash)+i)return void u.warning("Warning","sum of added Amount Reached to Total Amount")}else{if("1"==N.billAmmount&&q[0].REQ_AMT<parseFloat(N.payAmountCash))return 0==q[0].REQ_AMT&&q[0].REQ_AMT<=parseFloat(N.payAmountCash)?void u.warning("Warning","Patient have Zero(0) Total Ammout"):void u.warning("Warning","Amount should not exceed from Total Amount");if("2"==N.billAmmount&&q[0].REQ_AMT<parseFloat(N.payAmountCash))return 0==q[0].REQ_AMT&&q[0].REQ_AMT<=parseFloat(N.payAmountCash)?void u.warning("Warning","Payer have Zero(0) Total Ammout"):void u.warning("Warning","Amount should not exceed from Total Amount")}N.paymentTabgridOptions.data.push({payerRadType:N.billAmmount,PayMode:e,PayModeCode:N.paymentMode,amtPaid:1==N.activeFirst?parseFloat(N.payAmountCashTemp):N.payAmountCash,Receivedfrom:N.rcvdFrmCash,paymentDate:N.paymentDate,cardNumber:N.cardNumber,cardTranId:N.cardTranId,bank:N.bankName?t:N.bankName,chequeType:N.chequeType?N.chequeType:void 0,chequeDDno:N.chequeDDno,chequeDDDate:N.chequeDDDate,paymentTranType:N.paymentTranType?N.paymentTranType:void 0,refNo:N.cardTranId?N.cardTranId:N.chequeDDno,mobileNumber:N.mobileNumber,cardExpiryDate:N.exMonth&&N.exYear?N.exMonth.month_id+"/"+N.exYear.year_id:void 0,cardType:N.cardType,roundOffValue:parseFloat(N.roundOffValue)});l=0,r=0;angular.forEach(N.paymentTabgridOptions.data,function(e){"1"==N.billAmmount&&"1"==e.payerRadType?(parseFloat(e.roundOffValue),l+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue)):"2"==N.billAmmount&&"2"==e.payerRadType&&(parseFloat(e.roundOffValue),r+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue)),"1"==e.payerRadType?m.isGidContainsPatType=!0:"2"==e.payerRadType&&(m.isGidContainsPayerType=!0)}),"1"==N.billAmmount?N.payAmountCash=q[0].REQ_AMT-l:"2"==N.billAmmount&&(N.payAmountCash=q[0].REQ_AMT-r),0==parseFloat(N.payAmountCash)&&(N.rcvdFrmCash="",N.payAmountCashTemp=0,N.roundOffValue=0),0==N.roundOffValue&&(N.payAmountCashTemp=N.payAmountCash),0!=N.payAmountCashTemp&&(N.payAmountCashTemp=h.roundoff(N.payAmountCash),N.roundOffValue=parseFloat(N.payAmountCashTemp)-parseFloat(N.payAmountCash))}else{if(N.paymentTabgridOptions.data.length>0){var n=0,i=0;if(angular.forEach(N.paymentTabgridOptions.data,function(e){"1"==N.billAmmount&&"1"==e.payerRadType?(parseFloat(e.roundOffValue),n+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue)):"2"==N.billAmmount&&"2"==e.payerRadType&&(parseFloat(e.roundOffValue),i+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue)),e.PayModeCode==N.paymentMode&&(a=!0)}),a)return void u.warning("Warning","Payment Mode "+e+" is already existed.");if("1"==N.billAmmount&&G[0].PAT_NET_BALANCE<parseFloat(N.payAmountCash)+n+N.adjustAmt)return void u.warning("Warning","Amount should not exceed from Total Amount");if("2"==N.billAmmount&&(G[1]?G[1].COMP_NET_BALANCE:G[0].COMP_NET_BALANCE)<parseFloat(N.payAmountCash)+i)return void u.warning("Warning","Amount should not exceed from Total Amount");if("1"==N.billAmmount&&0==parseFloat(N.payAmountCash)&&G[0].PAT_NET_BALANCE==parseFloat(N.payAmountCash)+n+N.adjustAmt)return void u.warning("Warning","sum of added Amount Reached to Total Amount");if("2"==N.billAmmount&&0==parseFloat(N.payAmountCash)&&G[0].COMP_NET_BALANCE==parseFloat(N.payAmountCash)+i)return void u.warning("Warning","sum of added Amount Reached to Total Amount")}else{if("1"==N.billAmmount&&G[0].PAT_NET_BALANCE<parseFloat(N.payAmountCash)+N.adjustAmt)return 0==G[0].PAT_NET_BALANCE&&G[0].PAT_NET_BALANCE<=parseFloat(N.payAmountCash)+N.adjustAmt?void u.warning("Warning","Patient have Zero(0) Total Ammout"):void u.warning("Warning","Amount should not exceed from Total Amount");if("2"==N.billAmmount&&(G[1]?G[1].COMP_NET_BALANCE:G[0].COMP_NET_BALANCE)<parseFloat(N.payAmountCash))return 0==G[0].PAT_NET_BALANCE&&G[0].COMP_NET_BALANCE<=parseFloat(N.payAmountCash)?void u.warning("Warning","Payer have Zero(0) Total Ammout"):void u.warning("Warning","Amount should not exceed from Total Amount")}N.paymentTabgridOptions.data.push({payerRadType:N.billAmmount,PayMode:e,PayModeCode:N.paymentMode,amtPaid:1==N.activeFirst?parseFloat(N.payAmountCashTemp):N.payAmountCash,Receivedfrom:N.rcvdFrmCash,paymentDate:N.paymentDate,cardNumber:N.cardNumber,cardTranId:N.cardTranId,bank:N.bankName?t:N.bankName,chequeType:N.chequeType?N.chequeType:void 0,chequeDDno:N.chequeDDno,chequeDDDate:N.chequeDDDate,paymentTranType:N.paymentTranType?N.paymentTranType:void 0,refNo:N.cardTranId?N.cardTranId:N.chequeDDno,mobileNumber:N.mobileNumber,cardExpiryDate:N.exMonth&&N.exYear?N.exMonth.month_id+"/"+N.exYear.year_id:void 0,cardType:N.cardType,roundOffValue:parseFloat(N.roundOffValue)});var l=0,r=0;angular.forEach(N.paymentTabgridOptions.data,function(e){"1"==N.billAmmount&&"1"==e.payerRadType?(parseFloat(e.roundOffValue),l+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue)):"2"==N.billAmmount&&"2"==e.payerRadType&&(parseFloat(e.roundOffValue),r+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue)),"1"==e.payerRadType?m.isGidContainsPatType=!0:"2"==e.payerRadType&&(m.isGidContainsPayerType=!0)}),"1"==N.billAmmount?N.payAmountCash=(N.adjustAmtFlag,G[0].PAT_NET_BALANCE-(l+N.adjustAmt)):"2"==N.billAmmount&&(N.payAmountCash=N.adjustAmtFlag?0:(G[1]?G[1].COMP_NET_BALANCE:G[0].COMP_NET_BALANCE)-r),0==parseFloat(N.payAmountCash)&&(N.rcvdFrmCash="",N.payAmountCashTemp=0,N.roundOffValue=0),0==N.roundOffValue&&(N.payAmountCashTemp=N.payAmountCash),0!=N.payAmountCashTemp&&(N.payAmountCashTemp=h.roundoff(N.payAmountCash),N.roundOffValue=parseFloat(N.payAmountCashTemp)-parseFloat(N.payAmountCash))}N.cardNumber="",N.cardTranId="",N.bankName="",N.cardType="",N.chequeType="",N.chequeDDno="",N.chequeDDDate=new Date,N.paymentTranType="",N.mobileNumber="",0==parseFloat(N.payAmountCash)&&(N.authButton=!0),N.billPartialAmtList[0]&&2==N.billPartialAmtList[0].STATUS?0==parseFloat(N.payAmountCash)?(N.saveButton=!1,N.partial=!1):(N.partial=!1,N.saveButton=!1):0==parseFloat(N.payAmountCash)?(N.saveButton=!1,N.partial=!1):(N.partial=!0,N.saveButton=!0),m.corpSettlementBnr&&(N.partial=!1,N.saveButton=!1)}},m.removePayGriRow=function(e,t){var a=0,i=0;N.paymentTabgridOptions.data.splice(t,1),N.paymentTabgridOptions.data.length>0?angular.forEach(N.paymentTabgridOptions.data,function(e){"1"==N.billAmmount&&"1"==e.payerRadType?(a+=parseFloat(e.amtPaid),N.payAmountCash=m.amount-a):"2"==N.billAmmount&&"2"==e.payerRadType&&(i+=parseFloat(e.amtPaid),N.payAmountCash=m.amount-i)}):("1"==N.billAmmount?N.payAmountCash=m.amount:"2"==N.billAmmount&&(N.payAmountCash=m.amount),N.payAmountCashTemp=h.roundoff(N.payAmountCash),N.roundOffValue=parseFloat(N.payAmountCashTemp)-parseFloat(m.amount)),0==N.paymentTabgridOptions.data.length?(N.saveButton=!0,m.isGidContainsPatType=!1,m.isGidContainsPayerType=!1):N.billPartialAmtList[0]&&2==N.billPartialAmtList[0].STATUS?0==parseFloat(N.payAmountCash)?(N.saveButton=!1,N.partial=!1):(N.partial=!1,N.saveButton=!1):0==parseFloat(N.payAmountCash)?(N.saveButton=!1,N.partial=!1):(N.partial=!0,N.saveButton=!0),N.noAuthenticate&&(N.authButton=!1),N.payAmountCashTemp=N.payAmountCash,0!=N.payAmountCashTemp&&(N.payAmountCashTemp=h.roundoff(N.payAmountCash),N.roundOffValue=parseFloat(N.payAmountCashTemp)-parseFloat(N.payAmountCash)),N.payAmountCash>0&&(N.cashAmountErrMsgStr=!1,N.chqAmountErrMsgStr=!1,N.cCardAmountErrMsgStr=!1,N.ecsAmountErrMsgStr=!1,N.eWltAmountErrMsgStr=!1,N.ntBnkAmountErrMsgStr=!1)},m.cardMonths=[{month:"01",month_id:"01"},{month:"02",month_id:"02"},{month:"03",month_id:"03"},{month:"04",month_id:"04"},{month:"05",month_id:"05"},{month:"06",month_id:"06"},{month:"07",month_id:"07"},{month:"08",month_id:"08"},{month:"09",month_id:"09"},{month:"10",month_id:"10"},{month:"11",month_id:"11"},{month:"12",month_id:"12"}];for(var U=(new Date).getFullYear(),k=[],Q=0;Q<41;Q++)k.push({year:U+Q,year_id:parseInt(String(U+Q).slice(2,4))});m.expireYears=k,N.save=function(){if(3===N.activeFirst&&(N.validateRequiredFields("99"),!M))return!1;if(m.disableTabs){var e=null;angular.forEach(N.PmtModehData,function(t){t.DT_CODE==N.paymentMode&&(e=t.DETAIL_DESC)});var a={},i={},r=[];i.payerRadType=N.billAmmount,i.PayMode=e,i.PayModeCode=N.paymentMode,i.amtPaid=N.payAmountCash?N.payAmountCash:q[0].REQ_AMT,i.Receivedfrom=N.patBillWorkSrch.RG_FIRST_NAME,i.paymentDate=N.paymentDate,i.cardNumber=N.cardNumber,i.cardTranId=N.cardTranId,i.bank=N.bankName,i.chequeType=N.chequeType?N.chequeType:void 0,i.chequeDDno=N.chequeDDno,i.chequeDDDate=N.chequeDDDate,i.paymentTranType=N.paymentTranType?N.paymentTranType:void 0,i.cardExpiryDate=N.exMonth?N.exMonth.month_id+"/"+N.exYear.year_id:void 0,i.cardType=N.cardType,r.push(i);var n=[];if(N.crNoteGridOptions&&N.crNoteGridOptions.data&&N.crNoteGridOptions.data.length>0)for(let e=0;e<N.crNoteGridOptions.data.length;e++)N.crNoteGridOptions.data[e].isRequired&&N.crNoteGridOptions.data[e].balanceAmt>0&&n.push({billSeqId:null!=N.patBillWorkSrch.BILL_SEQ_ID?N.patBillWorkSrch.BILL_SEQ_ID:N.crNoteGridOptions.data[e].REF_SEQ_ID,creditNoteHdSeqId:N.crNoteGridOptions.data[e].CRN_HD_SEQ_ID,crNoteAdjAmt:N.gridOptions.data[5].patientAmt>0?N.crNoteGridOptions.data[e].balanceAmt:N.crNoteGridOptions.data[e].adjustNewAmt,balAmt:_.round(parseInt(N.crNoteGridOptions.data[e].CR_NOTE_AMT)-parseInt(N.crNoteGridOptions.data[e].balanceAmt))});a.collSeqId=null!=N.patBillWorkSrch.TRAN_REQ_TYPE&&2==N.patBillWorkSrch.TRAN_REQ_TYPE?N.patBillWorkSrch.COL_REQ_SEQ_ID:N.colReqSeqId?N.colReqSeqId:N.patBillWorkSrch.COL_REQ_SEQ_ID,2==N.billAmmount&&(a.gnPayerType=2),a.ttlAmt=q[0].REQ_AMT,a.rcpAmt=q[0].REQ_AMT,a.reqAmt=q[0].REQ_AMT,a.rcvdFrmName=N.patBillWorkSrch.RG_FIRST_NAME,a.depBankDesc=N.bankData.DEPOSIT_BANK_ACC_DESC,a.depBankSeqId=N.bankData.DEPOSIT_BANK_ACC_SEQ_ID,a.tranReqType=N.patBillWorkSrch.TRAN_REQ_TYPE,a.billSeqId=N.patBillWorkSrch.BILL_SEQ_ID,a.partialRequestSeqId=N.partialRequestSeqId,p.savePaymentDataList(a,r,n).then(function(e){if(e.data.HITService.message){3===N.activeFirst&&(N.cardNumber="",N.cardTranId="",N.bankName="",N.cardType="",N.chequeType="",N.chequeDDno="",N.chequeDDDate=new Date,N.paymentTranType="",N.mobileNumber="");var a="",i="",r="",n="",l=e.data.HITService.message[0]["com.napier.core.collections.vo.ReceiptHeader"];Array.isArray(l)?angular.forEach(l,function(e){a=", "+e.receiptNo+", ",i=e.receiptNo,l.receiptTranType,r=l.colReqSeqId,n=l.receiptHdSeqId}):(a=", "+l.receiptNo+", ",i=l.receiptNo,l.receiptTranType,r=l.colReqSeqId,n=l.receiptHdSeqId);var s={buttonCallBack1:function(){m.disableBnrFlg=!1,m.disableFlg=!1,m.disableTabs=!1,N.patBillWorkSrch="",N.colReqSeqId=void 0,N.isfromBWLP=!1,N.isfromBWL?(N.isfromBWL=!1,t.go("index.billingSub.BillingWorkList")):N.billOrPackage&&N.onChangeBillOrPackage(N.billOrPackage)},buttonCallBack2:function(){""!=C.colReqType&&"HSC"===sessionStorage.productCustomization?p.receiptRefundPrintService(r,C.colReqType,i,n).then(function(e){if(e.data.HITService.message){var t="napier-his-web/NapierReportServlet?reportName="+(e.data.HITService.message.reportName+""),a=y.host();a=location.host;D.open(location.protocol+"//"+a+"/"+t)}}):p.receiptPrintService(i).then(function(e){if(e.data.HITService.message){var t="napier-his-web/NapierReportServlet?reportName="+(e.data.HITService.message.reportName+""),a=y.host();a=location.host;D.open(location.protocol+"//"+a+"/"+t)}}),m.disableBnrFlg=!1,m.disableFlg=!1,m.disableTabs=!1,N.patBillWorkSrch="",N.colReqSeqId=void 0,N.isfromBWLP=!1,N.isfromBWL?(N.isfromBWL=!1,t.go("index.billingSub.BillingWorkList")):N.billOrPackage&&N.onChangeBillOrPackage(N.billOrPackage)}};u.hisAlertMulti("information","Information","Amount Refunded successfully"+a+" do you want to Print?",{buttonText:"No",buttonText2:"Yes"},s,!1)}else u.warning("Warning","Procesing Refund Unsuccessful ")})}else if(N.paymentTabgridOptions.data.length>0){var l,s=0,o=0;angular.forEach(N.paymentTabgridOptions.data,function(e){"1"==N.billAmmount&&"1"==e.payerRadType?(parseFloat(e.roundOffValue),s+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue),e.actualValue=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue)):"2"==N.billAmmount&&"2"==e.payerRadType&&(parseFloat(e.roundOffValue),o+=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue),e.actualValue=parseFloat(e.amtPaid)-parseFloat(e.roundOffValue)),l||(l=e.Receivedfrom)});r=[];(a={}).collSeqId=null!=N.patBillWorkSrch.TRAN_REQ_TYPE&&2==N.patBillWorkSrch.TRAN_REQ_TYPE?N.patBillWorkSrch.COL_REQ_SEQ_ID:N.colReqSeqId?N.colReqSeqId:N.patBillWorkSrch.COL_REQ_SEQ_ID,2==N.billAmmount&&(a.gnPayerType=2),m.corpSettlementBnr?"2"==N.billAmmount&&(a.reqAmt=x[0].REQ_AMOUNT):m.isDepositPay?"1"==N.billAmmount?a.reqAmt=q[0].REQ_AMT:"2"==N.billAmmount&&(a.reqAmt=q[0].REQ_AMT):"1"==N.billAmmount?a.reqAmt=G[0].PAT_NET_BALANCE:"2"==N.billAmmount&&(a.reqAmt=null!=G[1]?G[1].COMP_NET_BALANCE:G[0].COMP_NET_BALANCE),a.rcpAmt=s+o,a.ttlAmt=s+o,m.corpSettlementBnr&&"2"==N.billAmmount&&(a.rcpAmt=parseFloat((a.rcpAmt+(null!=x[0].RCP_AMOUNT?parseFloat(x[0].RCP_AMOUNT):parseFloat(0))).toFixed(2)),a.ttlAmt=a.rcpAmt),a.rcvdFrmName=l||"",a.depBankDesc=N.bankData.DEPOSIT_BANK_ACC_DESC,a.depBankSeqId=N.bankData.DEPOSIT_BANK_ACC_SEQ_ID,a.tranReqType=N.patBillWorkSrch.TRAN_REQ_TYPE,a.billSeqId=N.patBillWorkSrch.BILL_SEQ_ID,a.partialRequestSeqId=N.partialRequestSeqId;n=[];if(N.crNoteGridOptions&&N.crNoteGridOptions.data&&N.crNoteGridOptions.data.length>0)for(let e=0;e<N.crNoteGridOptions.data.length;e++)N.crNoteGridOptions.data[e].isRequired&&N.crNoteGridOptions.data[e].balanceAmt>0&&n.push({billSeqId:null!=N.patBillWorkSrch.BILL_SEQ_ID?N.patBillWorkSrch.BILL_SEQ_ID:N.crNoteGridOptions.data[e].REF_SEQ_ID,creditNoteHdSeqId:N.crNoteGridOptions.data[e].CRN_HD_SEQ_ID,crNoteAdjAmt:N.gridOptions.data[5].patientAmt>0?N.crNoteGridOptions.data[e].balanceAmt:N.crNoteGridOptions.data[e].adjustNewAmt,balAmt:_.round(parseInt(N.crNoteGridOptions.data[e].CR_NOTE_AMT)-parseInt(N.crNoteGridOptions.data[e].balanceAmt))});p.savePaymentDataList(a,N.paymentTabgridOptions.data,n).then(function(e){if(e.data.HITService.message){var a="",i="",r="",n="",l=e.data.HITService.message[0]["com.napier.core.collections.vo.ReceiptHeader"];Array.isArray(l)?angular.forEach(l,function(e){a=", "+e.receiptNo+", ",i=e.receiptNo,l.receiptTranType,r=l.colReqSeqId,n=l.receiptHdSeqId}):(a=", "+l.receiptNo+", ",i=l.receiptNo,l.receiptTranType,r=l.colReqSeqId,n=l.receiptHdSeqId);var s={buttonCallBack1:function(){N.receiptGridLoad(),m.disableBnrFlg=!1,m.disableFlg=!1,N.patBillWorkSrch="",m.corpSettlementBnr=!1,m.disableTabs=!1,N.colReqSeqId=void 0,N.isfromBWLP=!1,N.isfromBWL?(N.isfromBWL=!1,t.go("index.billingSub.BillingWorkList")):N.billOrPackage&&N.onChangeBillOrPackage(N.billOrPackage)},buttonCallBack2:function(){N.receiptGridLoad(),""!=C.colReqType&&"HSC"===sessionStorage.productCustomization?p.receiptRefundPrintService(r,C.colReqType,i,n).then(function(e){if(e.data.HITService.message){var t="napier-his-web/NapierReportServlet?reportName="+(e.data.HITService.message.reportName+""),a=y.host();a=location.host;D.open(location.protocol+"//"+a+"/"+t)}}):p.receiptPrintService(i).then(function(e){if(e.data.HITService.message){var t="napier-his-web/NapierReportServlet?reportName="+(e.data.HITService.message.reportName+""),a=y.host();a=location.host;D.open(location.protocol+"//"+a+"/"+t)}}),m.disableBnrFlg=!1,m.disableFlg=!1,m.disableTabs=!1,N.patBillWorkSrch="",m.corpSettlementBnr=!1,N.colReqSeqId=void 0,N.isfromBWLP=!1,N.isfromBWL?(N.isfromBWL=!1,t.go("index.billingSub.BillingWorkList")):N.billOrPackage&&N.onChangeBillOrPackage(N.billOrPackage)}},o={buttonClose:function(){N.receiptGridLoad()}};u.hisAlertMulti("information","Information","Payment is <b>processed</b> successfully"+a+" do you want to Print?",{buttonText:"No",buttonText2:"Yes"},s,o)}else u.warning("Warning","Procesing Payment Unsuccessful ")})}},N.cancelPayment=function(){m.disableBnrFlg=!1,m.disableFlg=!1,N.patBillWorkSrch="",m.corpSettlementBnr=!1,N.colReqSeqId=void 0,N.isfromBWLP=!1,N.adjustAmt=0,N.refundData=void 0,N.isfromBWL?(N.isfromBWL=!1,t.go("index.billingSub.BillingWorkList")):N.billOrPackage&&N.onChangeBillOrPackage(N.billOrPackage)},N.patientRcptNoSrch=function(e){N.rcptData=[],N.multipleRcptDataForList={1:N.rcptData};var t=g.executeQueryURLReset();return N.rcptDataList=new Array,g.prepareParamListWithParam("visitId",e,N.rcptDataList),g.prepareParamListWithParam("visitId",e,N.rcptDataList),g.prepareParamListWithParam("pBillNo",e,N.rcptDataList),g.prepareParamListWithParam("pBillNo",e,N.rcptDataList),g.prepareParamListWithParam("pMrNO",e,N.rcptDataList),g.prepareParamListWithParam("pMrNO",e,N.rcptDataList),g.prepareParamListWithParam("pPatName",e,N.rcptDataList),g.prepareParamListWithParam("pPatName",e,N.rcptDataList),g.prepareParamListWithParam("pPatName",e,N.rcptDataList),g.prepareParamListWithParam("pPatName",e,N.rcptDataList),g.prepareParamListWithParam("pIpNo",e,N.rcptDataList),g.prepareParamListWithParam("pIpNo",e,N.rcptDataList),g.executeQueryInput("PAY_RECIEPT_DTLS_VIEW_AUTO",N.rcptDataList,N.multipleRcptDataForList,!0,!0,t,"popUp",N.gridOptions).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})},N.rcptSearchResult=function(e){if(N.adjustFlag=!1,N.partial=!1,e.hasOwnProperty("PAT_RG_SEQ_ID")){m.corpSettlementBnr=!1,m.disableBnrFlg=!0,m.isRcptChkFlg=!0,m.disableTabs=!1,N.activeFirst=2;var t="1",a=e;a.regSeqId=e.PAT_RG_SEQ_ID,a.admissionSeqid=e.PAT_IPADM_SEQ_ID,t=null!=a.admissionSeqid&&0!=a.admissionSeqid?"1":"2",s.getPatientBanner(a,t).then(function(e){m.patientGlobalDtls=e,o.patientBannerDetail(a.regSeqId).then(function(e){m.patientBannerDetails=e,m.patientRecordsDetail=m.patientBannerDetails.patientRecordsDetail,m.patientValue=m.patientBannerDetails.patientValue,N.getCrNoteData()})}),N.receiptTabGridDefinitionDisplay.data=[],N.billRcptPatDetails=[],N.getPatRcptDetails={1:N.billRcptPatDetails};var i=g.executeQueryURLReset();N.billRcptPatDetailsDataList=new Array,g.prepareParamListWithParam("pColReqSeqId",e.COL_REQ_SEQ_ID,N.billRcptPatDetailsDataList),g.prepareParamListWithParam("mrNo",e.PAT_RG_INT_MR_NO,N.billRcptPatDetailsDataList),g.executeQueryInput("SCR_RECIEPT_DTLS_VIEW_GRID",N.billRcptPatDetailsDataList,N.getPatRcptDetails,!0,!0,i,"popUp",N.gridOptions).then(function(e){if(0!=(V=e[1]instanceof Array?e[1]:[e[1]]).length){for(var t=0;t<V.length;t++)V[t].RECP_DATE&&(V[t].RECP_DATE=moment(V[t].RECP_DATE).format("DD-MMM-YYYY HH:mm"));N.receiptTabGridDefinitionDisplay.data=angular.copy(V)}})}},N.adjustAmount=function(){N.adjustAmtFlag=!0,N.adjustAmt=0;for(var e=0;e<N.crGridApi.selection.getSelectedRows().length;e++){var t=_.findIndex(N.crNoteGridOptions.data,function(t){return t.CRN_HD_SEQ_ID==N.crGridApi.selection.getSelectedRows()[e].CRN_HD_SEQ_ID});N.crGridApi.selection.getSelectedRows()[e].isRequired||(N.crNoteGridOptions.data[t].isRequired=!0,N.gridOptions.data[5].patientAmt>N.crGridApi.selection.getSelectedRows()[e].balanceAmt?(N.gridOptions.data[5].patientAmt=N.gridOptions.data[5].patientAmt-N.crGridApi.selection.getSelectedRows()[e].balanceAmt,N.gridOptions.data[5].patientAmt=parseFloat(N.gridOptions.data[5].patientAmt.toFixed(2)),N.adjustAmt=N.adjustAmt+parseFloat(N.crGridApi.selection.getSelectedRows()[e].balanceAmt.toFixed(2)),N.crNoteGridOptions.data[t].adjustNewAmt=parseFloat(N.crGridApi.selection.getSelectedRows()[e].balanceAmt.toFixed(2))):(N.crNoteGridOptions.data[t].adjustNewAmt=angular.copy(N.gridOptions.data[5].patientAmt),N.adjustAmt=N.adjustAmt+parseFloat(angular.copy(N.gridOptions.data[5].patientAmt).toFixed(2)),N.gridOptions.data[5].patientAmt=0),N.paymentTabgridOptions.data.length>0?N.paymentTabgridOptions.data[0].amtPaid=N.gridOptions.data[5].patientAmt:(N.payAmountCash=N.gridOptions.data[5].patientAmt,N.payAmountCashTemp=N.payAmountCash,N.roundOffValue=0),m.amount=N.gridOptions.data[5].patientAmt)}},N.partialPay=function(){for(var e=0,a=0;a<N.paymentTabgridOptions.data.length;a++)e+=parseFloat(N.paymentTabgridOptions.data[a].amtPaid);var i=N.gridOptions.data[0].payerAmt?parseFloat(N.gridOptions.data[0].payerAmt):0;l.open("PARTIAL PAYMENT AUTHORIZATION",{animation:!0,templateUrl:"app/consumer/his17_1/opVisitManagement/screens/opVisitManagement/templates/op-visit-mgt-partial-pay-auth.html",controller:"opVisitPartialPayAuthCtrl",controllerAs:"cas",backdrop:"static",size:"md",resolve:{data:{payAuthTotalAmount:N.gridOptions.data[0].patientAmt+i,payAuthPatientAmount:N.gridOptions.data[5].patientAmt,ordervisitId:void 0,orderencounterSeqId:N.patBillWorkSrch.EN_SEQ_ID,orderregSeqId:N.patBillWorkSrch.PAT_RG_SEQ_ID,billNo:N.patBillWorkSrch.REQ_AGAINST_NO,payAuthPayingAmount:e,payAuthDueAmount:N.payAmountCash?parseFloat(N.payAmountCash.toFixed(2)):0,ip:1}}}).result.then(function(e){e&&(null!=N.selectBill[0]&&null!=N.selectBill[0].patientGlobalDtls?N.onChangeBillOrPackage(N.billOrPackage):t.go("index.billingSub.angularbillappwrklist"))})},N.adjustCreditNote=function(e){m.$emit("creditNoteFromPaymentTab",e)},N.refundCreditNote=function(e){},N.receiptGridLoad=function(){if(null!=m.patientGlobalDtls&&null!=m.patientGlobalDtls.subAccSeqId){N.receiptTabGridDefinitionDisplay.columnDefs[4].visible=!1,N.receiptTabGridDefinitionDisplay.columnDefs[6].visible=!0,N.receiptTabGridDefinitionDisplay.columnDefs[16].visible=!0,N.receiptTabGridDefinitionDisplay.data=[],N.billRcptPatDetails=[],N.getPatRcptDetails={1:N.billRcptPatDetails};var e=g.executeQueryURLReset();N.billRcptPatDetailsDataList=new Array,g.prepareParamListWithParam("pSubAccSeqID",m.patientGlobalDtls.subAccSeqId,N.billRcptPatDetailsDataList),g.executeQueryInput("SCR_RECIEPT_DTLS_VIEW_PATIENT_BILLING",N.billRcptPatDetailsDataList,N.getPatRcptDetails,!0,!0,e,"popUp",N.gridOptions).then(function(e){if(0!=(V=e[1]instanceof Array?e[1]:[e[1]]).length){for(var t=0;t<V.length;t++)V[t].RECP_DATE&&(V[t].RECP_DATE=moment(V[t].RECP_DATE).format("DD-MMM-YYYY HH:mm"));N.receiptTabGridDefinitionDisplay.data=angular.copy(V)}})}},N.onChangeBillOrPackage=function(e){var t=e;null!=t.GN_BILL_STATUS&&1==t.GN_BILL_STATUS?(N.patBillWorkSrch=t.PACKAGE_OR_BILL,N.patientBillNoSrch(N.patBillWorkSrch).then(function(e){null!=e&&null!=e&&""!==e&&null!=e[0]&&null!=e[0]&&""!==e[0]?(N.billSearchResult(e[0]),N.patBillWorkSrch=e[0]):m.disableBnrFlg=!0,N.receiptGridLoad()})):(m.disableFlg=!1,m.disableBnrFlg=!1,N.colReqSeqId=void 0,N.gridOptions.data=[])},N.depositScreenLoad=function(){(""!=S.billObj?JSON.parse(S.billObj):void 0)&&(N.cardMonths=angular.copy(m.cardMonths),N.expireYears=angular.copy(m.expireYears),N.patientGlobalDtls=m.patientGlobalDtls,N.patientBannerDetails=m.patientBannerDetails,R.init(N))},N.afterSave=function(){R.init(N)},N.changeDeposit=function(e){R.changeDeposit(e,N)},N.requestSelect=function(e){N.selectedRequest=e.entity,N.payDetails.depositType=N.depositTypeArr.find(t=>t.DEPOSIT_TYPE_DESC==e.entity.depositTypeDesc);var t="";N.payDetails=N.payDetails?N.payDetails:{},t=2==e.entity.depositAgainst?e.entity.ipNo:e.entity.depositNo,N.patientBillNoSrch(t),N.payDetails.amount=e.entity.depositAmount},N.payModeChange=function(e){R.payModeChange(N,e)},N.billSelect=function(e){N.patientBillNoSrch(e)},N.paymentGridAdd=function(){R.paymentGridRow(N)},N.savePayment=function(){R.depositPayment(N)},N.editPayment=function(e,t){N.tempPaymentGrid=[],R.paymentGridEdit(e,t,N)},N.deletePayment=function(e,t){N.gridOptionsPayment.data.splice(t,1)},N.printReceipt=function(e,t){R.printReceipt(e,t,N)},N.format=angular.copy(r.uibDateOnly.format),m.isRcptChkFlg=!1,m.disableFlg=!1,m.isGidContainsPatType=!1,m.isGidContainsPayerType=!1,m.corpSettlementBnr=!1,m.disableTabs=!1,m.disableBnrFlg=!1,m.isDepositPay=!1,N.billAmmount="1",N.activeFirst=1,N.rcvdFrmCash="",N.dataTypeValidatios=!1,N.flagT=!1,N.isfromBWL=!1,N.authButton=!1,N.isfromPB=!1,N.adjustAmt=0,C.colReqType="",""!==S.billObj&&"billObj"!=S.billObj&&(N.selectBill=JSON.parse(S.billObj),null!=N.selectBill[0].patientGlobalDtls?(N.billOrPackageList=N.selectBill[0].billOrPackageList,N.billOrPackage=N.selectBill[0].billOrPackage,m.patientGlobalDtls=N.selectBill[0].patientGlobalDtls,N.depositScreenLoad(),N.getCrNoteData(),N.receiptGridLoad(),null!=N.selectBill[0].billStatus&&1==N.selectBill[0].billStatus?(N.patBillWorkSrch=N.selectBill[0].billNo,N.patientBillNoSrch(N.patBillWorkSrch).then(function(e){null!=e&&null!=e&&""!==e&&null!=e[0]&&null!=e[0]&&""!==e[0]?(N.billSearchResult(e[0]),N.patBillWorkSrch=e[0]):m.disableBnrFlg=!0})):m.disableBnrFlg=!0,N.isfromPB=!0):(N.isfromBWL=!0,N.patBillWorkSrch=N.selectBill[0].billNo,N.patientBillNoSrch(N.patBillWorkSrch).then(function(e){N.billSearchResult(e[0]),N.patBillWorkSrch=e[0]}))),A.getDynamicConfig("GET_HIS_CONFIG_VALUE","Site_Ref").then(function(e){m.hscSpecific=e[1][0].VALUE,"HSC"===m.hscSpecific?m.bankNameMasterSeqID="969":m.bankNameMasterSeqID="700179"}),E(function(){N.paymentModeResult()},500),N.paymentMode=1,N.paymentTabgridOptions.data=[],N.saveButton=!0,N.noAuthenticate=!0,N.partial=!1,N.paymentDate=new Date,N.getBank(1),N.payerCompanyId="",N.payerCompanyName=""}e.$inject=["$uibModal","$state","paymentGridDefinition","uiGridConstants","hisCalDefConstant","crNoteGridDefinition","hisModalService","PatientBannerGlobal","PatientBannerBilling","paymentTabGridDefinition","receiptTabGridDefinition","paymentService","hisAlertService","$scope","QueryService","$stateParams","hisTranslationsService","$window","$location","hisTranslationsGlobalLang","$rootScope","RoleTaskService","hisConfigurationService","$timeout","HISROUNDOFFNEW","paymentGridDef","patientBillDepositService","depositRequestService","patReceiptDetailsGridDef","requestAndHistoryGridDef","patientBillDepositBusinessLogic"],angular.module("napierContainerUi").controller("angPaymentController",e)}(),function(){"use strict";angular.module("napierContainerUi").service("CommonForServiceData",["hisAlertService","QueryService",function(e,t){this.commonServiceOnLoad=function(e){e.priServGroupList=[];let a={1:e.priServGroupList},i=t.executeQueryURLReset(),r=new Array;t.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r),t.executeQueryInput("BL_GET_PSG_SEARCH_SP",r,a,!0,!0,i,"popUp",{})},this.getDepartment=function(e,a,i,r,n){if(e.deptList=[],e.speciltyList=[],null!=a&&null!=a.CODE&&"N"==a.IS_MATERIAL){let l={1:e.deptList},s=t.executeQueryURLReset(),o=new Array;t.prepareParamListWithParam("pPSG_CODE",a.CODE,o),t.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,o),t.executeQueryInput("BL_GET_DEPARTMENT_SEARCH_SP",o,l,!0,!0,s,"popUp",{}).then(function(a){n&&null!=r.department&&null!=r.department.CODE?(i.department=t.getObjectByAnyValue(e.deptList,r.department.CODE,"CODE"),e.changeDept(i.department,i,r,n)):null!=r?(i.department=t.getObjectByAnyValue(e.deptList,r.DEPT_CODE,"CODE"),null!=i.department&&e.changeDept(i.department,i,r)):null==r&&(i.service=void 0)})}if("Y"==a.IS_MATERIAL){let l={1:e.deptList},s=t.executeQueryURLReset(),o=new Array;t.prepareParamListWithParam("pMetSubCatSeqId",a.CODE,o),t.executeQueryInput("FETCH_MAT_GROUP",o,l,!0,!0,s,"popUp",{}).then(function(a){n&&null!=r.department&&null!=r.department.CODE?(i.department=t.getObjectByAnyValue(e.deptList,r.department.CODE,"CODE"),e.changeDept(i.department,i,r,n)):null!=r?(i.department=t.getObjectByAnyValue(e.deptList,r.DEPT_CODE,"CODE"),null!=i.department&&e.changeDept(i.department,i,r)):null==r&&(i.service=void 0)})}},this.getSpeciltyData=function(e,a,i,r,n,l){if(e.speciltyList=[],null!=a&&null!=a.CODE&&"N"==i.IS_MATERIAL){let s={1:e.speciltyList},o=t.executeQueryURLReset(),c=new Array;t.prepareParamListWithParam("pPSG_CODE",i.CODE,c),t.prepareParamListWithParam("pDEPT_CODE",a.CODE,c),t.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,c),t.executeQueryInput("BL_GET_SPECIALITY_SEARCH_SP",c,s,!0,!0,o,"popUp",{}).then(function(a){(n||n.specialty)&&(n.SPL_CODE=n.SPL_CODE?n.SPL_CODE:n.specialty.CODE),l&&null!=n.specialty&&null!=n.SPL_CODE?r.specialty=t.getObjectByAnyValue(e.speciltyList,n.SPL_CODE,"CODE"):null!=n?(r.inActiveVal=!1,r.specialty=t.getObjectByAnyValue(e.speciltyList,n.SPL_CODE,"CODE")):null==n&&(r.service=void 0,r.inActiveVal=!0)})}if("Y"==i.IS_MATERIAL&&null!=a&&null!=a.CODE){let i={1:e.speciltyList},s=t.executeQueryURLReset(),o=new Array;t.prepareParamListWithParam("pMetMainCatSeqId",a.CODE,o),t.executeQueryInput("FETCH_MAT_SUB_GROUP",o,i,!0,!0,s,"popUp",{}).then(function(a){n&&(n.SPL_CODE=n.SPL_CODE?n.SPL_CODE:n.specialty.CODE),l&&null!=n.specialty&&null!=n.SPL_CODE?r.specialty=t.getObjectByAnyValue(e.speciltyList,n.SPL_CODE,"CODE"):null!=n?(r.inActiveVal=!1,r.specialty=t.getObjectByAnyValue(e.speciltyList,n.SPL_CODE,"CODE")):null==n&&(r.service=void 0,r.inActiveVal=!0)})}},this.getServiceList=function(e,a,i){e.serviceListData=[];let r={1:e.serviceListData};if(e.priServGroup&&"Y"==e.priServGroup.IS_MATERIAL){let i={1:e.serviceListData},r=t.executeQueryURLReset(),n=new Array;return t.prepareParamListWithParam("pMaterialCat",null!=e.priServGroup&&null!=e.priServGroup.CODE?e.priServGroup.CODE:-999,n),t.prepareParamListWithParam("pMaterialGroup",null!=e.department&&null!=e.department.CODE?e.department.CODE:-999,n),t.prepareParamListWithParam("pMaterialSubGroup",null!=e.specialty&&null!=e.specialty.CODE?e.specialty.CODE:-999,n),t.prepareParamListWithParam("pMatCodeName",null!=a&&null!=a?a:"",n),t.executeQueryInput("PACKAGE_MATERIAL_DETAILS",n,i,!0,!0,r,"popUp",{}).then(function(t){return e.serviceListData.map(function(e){return e})})}{let n=t.executeQueryURLReset(),l=new Array;return t.prepareParamListWithParam("pPSG_CODE",null!=e.priServGroup&&null!=e.priServGroup.CODE?e.priServGroup.CODE:-999,l),t.prepareParamListWithParam("pDEPT_CODE",null!=e.department&&null!=e.department.CODE?e.department.CODE:-999,l),t.prepareParamListWithParam("pSPECL_CODE",null!=e.specialty&&null!=e.specialty.CODE?e.specialty.CODE:-999,l),t.prepareParamListWithParam("pSERV_NAME",null!=a&&null!=a?a:"",l),t.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,l),t.prepareParamListWithParam("pGN_FLOW",parseInt(i),l),t.executeQueryInput("BL_GET_SERVICE_SEARCH_SP",l,r,!0,!0,n,"popUp",{}).then(function(t){return e.serviceListData.map(function(e){return e})})}},this.getServiceRate=function(a,i,r,n){if(n.priServGroup&&"N"==n.priServGroup.IS_MATERIAL){var l=a;let s={1:n.serviceListRate=[]},o=t.executeQueryURLReset(),c=new Array;t.prepareParamListWithParam("@SERV_SEQ_ID",i.pServId?i.pServId:-999,c),t.prepareParamListWithParam("@TARIFF_SEQ_ID",i.ptarifSeqId?i.ptarifSeqId:-999,c),t.prepareParamListWithParam("@DATE_ON",moment(new Date).format("YYYY-MM-DD HH:mm:ss.000"),c),t.prepareParamListWithParam("@PRACTICE_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,c),t.prepareParamListWithParam("@FACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,c),t.prepareParamListWithParam("@BED_CLASS_CODE",i.pBedSeqId?i.pBedSeqId:-999,c),t.prepareParamListWithParam("@PRIORITY",i.pPriority,c),t.prepareParamListWithParam("@SPL_SEQ_ID",i.pSplCode?i.pSplCode:-999,c),t.prepareParamListWithParam("@DOCT_SEQ_ID",-999,c),t.prepareParamListWithParam("@PLAN_SEQ_ID",n.payer.planseqid?n.payer.planseqid:-999,c),t.executeQueryInput("GET_SERVICE_RATE_WITH_OUT_VERSION_NEW_SP",c,s,!0,!0,o,"popUp",{}).then(function(t){if(t[1][0])n.preAuthDetailsGridOtions.data[0].serviceAmt=n.serviceListRate[0].VALUE,r.service=l,n.changeAmount(r,0);else{let t={buttonText:n.alertObj.no,buttonText2:n.alertObj.yes},a={buttonCallBack1:function(){n.preAuthDetailsGridOtions.data[0].service=""},buttonCallBack2:function(){}},i={buttonClose:function(){}};e.hisAlertMulti("information",n.alertObj.alertTypeInfo,"Rate not defined. Do you want to continue ?",t,a,i)}})}else a.MRP&&(n.preAuthDetailsGridOtions.data[0].serviceAmt=a.MRP,r.service=a,n.changeAmount(r,0))},this.getDropDownBasedService=function(e,a,i){a.priServGroup=t.getObjectByAnyValue(i.priServGroupList,e.PRI_SERV_CODE,"CODE"),null!=a.priServGroup&&i.changePriServ(a.priServGroup,a,e)},this.calPreAuthAmt=function(e){let t=0;for(let a=1;a<e.length;a++)1==e[a].isAmtNlPercFlag&&null!=e[a].valueAmt&&null!=e[a].valueAmt&&""!=e[a].valueAmt&&(t+=parseFloat(e[a].valueAmt));return t},this.validDuplicate=function(e,t,a){if(!(!a&&e.preAuthDetailsGridOtions.data.length>1||a&&e.authApprovalGrid.data.length>1))return!0;{let i=a?e.authApprovalGrid.data:e.preAuthDetailsGridOtions.data;for(let e=1;e<i.length;e++){if(!(null!=t.service&&null!=t.service.SERV_SEQ_ID||null!=i[e].service&&null!=i[e].service.SERV_SEQ_ID||null!=t.specialty&&null!=t.specialty.CODE||null!=i[e].specialty&&null!=i[e].specialty.CODE||null!=t.department&&null!=t.department.CODE||null!=i[e].department&&null!=i[e].department.CODE||null==t.priServGroup||null==i[e].priServGroup||i[e].priServGroup.CODE!=t.priServGroup.CODE))return!1;if(!(null!=t.service&&null!=t.service.SERV_SEQ_ID||null!=i[e].service&&null!=i[e].service.SERV_SEQ_ID||null!=t.specialty&&null!=t.specialty.CODE||null!=i[e].specialty&&null!=i[e].specialty.CODE||null==t.department||null==i[e].department||i[e].department.CODE!=t.department.CODE||null==t.priServGroup||null==i[e].priServGroup||i[e].priServGroup.CODE!=t.priServGroup.CODE))return!1;if(!(null!=t.service&&null!=t.service.SERV_SEQ_ID||null!=i[e].service&&null!=i[e].service.SERV_SEQ_ID||null==t.specialty||null==i[e].specialty||i[e].specialty.CODE!=t.specialty.CODE||null==t.priServGroup||null==i[e].priServGroup||i[e].priServGroup.CODE!=t.priServGroup.CODE||null==t.department||null==i[e].department||i[e].department.CODE!=t.department.CODE))return!1;if(null!=t.service&&null!=i[e].service&&i[e].service.SERV_SEQ_ID==t.service.SERV_SEQ_ID&&null!=t.priServGroup&&null!=i[e].priServGroup&&i[e].priServGroup.CODE==t.priServGroup.CODE&&null!=t.department&&null!=i[e].department&&i[e].department.CODE==t.department.CODE&&null!=t.specialty&&null!=i[e].specialty&&i[e].specialty.CODE==t.specialty.CODE)return!1;if(e==i.length-1)return!0}}}}])}(),(app=angular.module("napierContainerUi")).constant("gridDefinationCommon",{packageDetlOtions:{enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!0,multiSelect:!1,enableSelectAll:!0,enableVerticalScrollbar:2,paginationCurrentPage:1,paginationPageSize:10,columnDefs:[{name:"approxBillDtSeqId",visible:!1},{name:"approxPackBillSeqId",visible:!1},{name:"strPackCode",displayName:"billing.packageCode",headerCellFilter:"translate"},{name:"primaryServiceTypeAliasName",displayName:"billing.package.name",headerCellFilter:"translate"},{name:"cptCode",displayName:"billing.cpt.code",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><span uib-tooltip="{{row.entity.cptCode}}" tooltip-placement="left">{{row.entity.cptCode}}</span></div>'},{name:"limitAmt",displayName:"billing.packageCost",headerCellFilter:"translate"},{name:"remarks",displayName:"billing.remarks",headerCellFilter:"translate"},{name:"primaryServiceTypeCode",visible:!1},{name:"facilityId",visible:!1},{name:"practiceId",visible:!1},{name:"gnTranStatus",visible:!1},{name:"Action",displayName:"billing.action",headerCellFilter:"translate",cellTemplate:'<div class="actionsDurgs" style="text-align:center;"><span ng-click="grid.appScope.edit || grid.appScope.editPackage(row,rowRenderIndex)" style="padding-right: 10px;padding-left: 10px;"><i class="fa fa-pencil" aria-hidden="true"></i></span>|<span ng-click = "grid.appScope.deleteRecord || grid.appScope.deletePackage(row, rowRenderIndex)" style="padding: 10px;"><i class="fa fa-trash-o" aria-hidden="true"></i></span></div>'},{name:"identification",displayName:"identification",visible:!1}]},serviceDetailsGridOtions:{enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!1,multiSelect:!1,enableSelectAll:!0,enableVerticalScrollbar:2,paginationCurrentPage:1,paginationPageSizes:[8,16,32,64],paginationPageSize:10,columnDefs:[{name:"serviceSeqId",displayName:"Service Sequence ID",enableCellEdit:!1,visible:!1},{name:"serviceCode",displayName:"billing.serviceCode",headerCellFilter:"translate",enableCellEdit:!1},{name:"serviceName",displayName:"billing.serviceName",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span uib-tooltip="{{row.entity.serviceName}}" tooltip-placement="left">{{row.entity.serviceName}}</span></div>'},{name:"serviceRate",displayName:"billing.servicePrice",headerCellFilter:"translate",enableCellEdit:!1},{name:"serviceDiscountAmt",displayName:"billing.discount",headerCellFilter:"translate",enableCellEdit:!1},{name:"serviceQty",displayName:"billing.quantity",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-if="!row.entity.editable">{{COL_FIELD}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable"><input type="text" numbers-only ng-model="MODEL_COL_FIELD" min="1" my-maxlength="6"></div>'},{name:"chargeableAmt",displayName:"billing.amt",headerCellFilter:"translate",enableCellEdit:!1},{name:"serviceTax",displayName:"billing.taxAplicable",headerCellFilter:"translate",enableCellEdit:!1},{name:"approxBillDtSeqId",visible:!1},{name:"expcServDate",visible:!1},{name:"facilityId",visible:!1},{name:"practiceId",visible:!1},{name:"gnTranStatus",visible:!1},{name:"Action",displayName:"billing.action",headerCellFilter:"translate",enableCellEdit:!1,visible:!0,cellTemplate:'<div class="ui-grid-cell-contents action-row actionsDurgs" style="text-align:center;"><span ng-if="!grid.appScope.update1" ng-click="grid.appScope.editService(row,rowRenderIndex,grid,col)" style="padding-right: 10px;padding-left: 10px;"><i class="{{grid.appScope.getTemplate(row.entity,grid.appScope.editStart,grid,col,row)}}" aria-hidden="true"></i></span>|<span ng-click = "grid.appScope.deleteRecord || grid.appScope.deleteService(row, rowRenderIndex)" style="padding: 10px;"><i class="fa fa-trash-o" aria-hidden="true"></i></span></div>'},{name:"identification",displayName:"identification",visible:!1}]},durgCnsmblesGridOtions:{enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!0,enableSelectAll:!1,multiSelect:!1,enableVerticalScrollbar:2,paginationCurrentPage:1,paginationPageSize:10,columnDefs:[{name:"approxBillDtSeqId",visible:!1},{name:"materialName",displayName:"billing.name",headerCellFilter:"translate"},{name:"price",displayName:"billing.price",headerCellFilter:"translate"},{name:"quantaty",displayName:"billing.quantity",headerCellFilter:"translate"},{name:"totalPrice",displayName:"billing.totalPrice",headerCellFilter:"translate"},{name:"expcMtrlDate",visible:!1},{name:"gnTranStatus",visible:!1},{name:"remarks",visible:!1},{name:"Action",displayName:"billing.action",headerCellFilter:"translate",cellTemplate:'<div class="actionsDurgs" style="text-align:center;"><span ng-click="grid.appScope.edit || grid.appScope.editRecord(row,rowRenderIndex)" style="padding-right: 10px;padding-left: 10px;"><i class="fa fa-pencil" aria-hidden="true"></i></span>|<span ng-click = "grid.appScope.deleteRecord || grid.appScope.deleteAddRecord(row, rowRenderIndex)" style="padding: 10px;"><i class="fa fa-trash-o" aria-hidden="true"></i></span></div>'},{name:"identification",displayName:"identification",visible:!1}]}}),function(){"use strict";angular.module("napierContainerUi").service("PatientBannerBilling",["CallManager","GetDocumentCommon","QueryService","IPINDENTAPIS","$q",function(e,t,a,i,r){this.patientBannerDetail=function(n){var l,s,o,c,d=r.defer(),p=localStorage.patientArrDetails;if(null!=n)c=n;else if(null==sessionStorage.patientArrDetails)if(null==sessionStorage.NS_BedBoard_patient_record)c=JSON.parse(p).regestrationSeqId;else{var u=JSON.parse(sessionStorage.NS_BedBoard_patient_record);c=null==u.regSeqId?JSON.parse(sessionStorage.NS_BedBoard_patient_record).regestrationSeqId:JSON.parse(sessionStorage.NS_BedBoard_patient_record).regSeqId}else null==sessionStorage.NS_BedBoard_patient_record?c=JSON.parse(sessionStorage.patientArrDetails).regestrationSeqId:null!=sessionStorage.NS_BedBoard_Info&&(c=JSON.parse(sessionStorage.NS_BedBoard_Info).regestrationSeqId);var m,g=[],S={1:g},v=a.executeQueryURLReset(),D=new Array;a.executeQueryInput("MQ0005",D,S,!0,!0,v,"popUp");var y={};return y.url=i.HISIPINDENT.URL,y.requestData={operation:"getRegistrationById",messageId:"",destination:"com.napier.core.registration.service.external.RegistrationService",voclass:"com.napier.core.service.vo.registration.Registration",message:{"@class":"com.napier.core.service.vo.registration.Registration",rgSeqId:c}},e.sendRestRequest(y).then(function(e){if(null!=(l=e.data.HITService.message.patient).patientAddress&&null!=(s=null==e.data.HITService.message.patient.patientAddress[0]["com.napier.core.service.vo.emrmasters.AddressMasterGenericVo"][0]?l.patientAddress[0]["com.napier.core.service.vo.emrmasters.AddressMasterGenericVo"]:l.patientAddress[0]["com.napier.core.service.vo.emrmasters.AddressMasterGenericVo"][0]).levelMappingVoList[0]["com.napier.core.service.vo.emrmasters.LevelMappingVo"]&&(null!=s.levelMappingVoList[0]["com.napier.core.service.vo.emrmasters.LevelMappingVo"]?s.levelMappingVoList[0]["com.napier.core.service.vo.emrmasters.LevelMappingVo"][0]:""),!angular.isUndefined(l.bloodGroup.code))for(var a=0;a<g.length;a++)g[a].gQDataCode==l.bloodGroup.code&&(m=g[a].gQDataName);var i;null!=e.data.HITService.message.insuranceList&&(i=e.data.HITService.message.insuranceList[0]["com.napier.core.service.vo.registration.Insurance"]),o={insurance:i,patientRecordsDetail:e.data.HITService.message.patient,patientValue:null==l.patientAddress?void 0:null==l.patientAddress[0]["com.napier.core.service.vo.emrmasters.AddressMasterGenericVo"][0]?l.patientAddress[0]["com.napier.core.service.vo.emrmasters.AddressMasterGenericVo"]:l.patientAddress[0]["com.napier.core.service.vo.emrmasters.AddressMasterGenericVo"][0],patientAddress:null==s?void 0:null==s.levelMappingVoList[0]?s.levelMappingVoList:null!=s.levelMappingVoList[0]["com.napier.core.service.vo.emrmasters.LevelMappingVo"]?s.levelMappingVoList[0]["com.napier.core.service.vo.emrmasters.LevelMappingVo"][0]:"",bloodGroupName:m,patientReferral:e.data.HITService.message.patientReferral},t.getDocFile(c,o),"HSC"==sessionStorage.productCustomization&&(o.agentSeqId=e.data.HITService.message.refAgentSeqId),d.resolve(o)},function(e){d.reject(e)}),d.promise}}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p){var u=this;u.data={},"#billListingCancelled"==window.top.location.hash?e.billListingGrid=angular.copy(i):e.billListingGrid=angular.copy(a),l.getSearchGridQuery("NHIS_M_004","").then(function(t){var a=[];try{for(var i=0;i<t[1].length;i++)t[1][i].SL_No=i+1,a.push(t[1][i]);e.specality=a}catch(e){}}),u.data.fromDate=new Date,u.data.toDate=new Date,e.billListsMandatory=!1,e.dateOptions={maxDate:new Date,showWeeks:!1},e.toDateOptions={maxDate:new Date,showWeeks:!1},e.open1=function(t){e.popup1.opened=!0,e.popup2.opened=!1,u.data.toDate=new Date},e.open2=function(t){e.popup2.opened=!0,e.popup1.opened=!1,e.toDateOptions.minDate=u.data.fromDate},e.popup1={opened:!1},e.popup2={opened:!1},u.getPayerList=function(){u.payerList=[],u.payerData={1:u.payerList};var e=p.executeQueryURLReset();u.payerDataParamsList=[],p.prepareParamListWithParam("pPracticeId","Napier123",u.payerDataParamsList),p.executeQueryInput("GET_INS_CORP_NAME_HSC",u.payerDataParamsList,u.payerData,!1,!0,e,"popUp",u).then(function(e){})},u.getPayerList();var m={pageNumber:1,pageSize:8,sort:null};e.billListingGrid.onRegisterApi=function(t){t.pagination.on.paginationChanged(e,function(e,t){m.pageNumber=e,m.pageSize=t})},u.searchGridData=function(t){""!=u.data.fromDate&&""!=u.data.toDate?(e.billListsData={pFromDate:u.data.fromDate.toISOString().slice(0,10)+" 00:00:00",pToDate:u.data.toDate.toISOString().slice(0,10)+" 23:59:59",pPatcatgSeqId:u.data.billType?u.data.billType.PCATG_SEQ_ID:-999,pBillType:u.data.patientType?u.data.patientType:-999,pPayerSeqID:u.data.payerId?u.data.payerId.toString():""},e.billListsMandatory=!1,l.getSearchGridQuery(t,e.billListsData).then(function(t){for(var a=[],i=0;i<t[1].length;i++)t[1][i].SL_No=i+1,a.push(t[1][i]);e.billListingGrid.data=a,e.bigTotalItems=10*Math.ceil(a.length/e.billListingGrid.paginationPageSize)})):e.billListsMandatory=!0},e.bigTotalItems=0,u.clearFormData=function(){u.data={},e.billListingGrid.data=[],e.bigTotalItems=0,u.data.fromDate=new Date,u.data.toDate=new Date,e.billListsMandatory=!1},u.generatePDFprint=function(t,a){if(0!=e.billListingGrid.data.length){var i={pFromDate:u.data.fromDate.toISOString().slice(0,10)+" 00:00:00",pToDate:u.data.toDate.toISOString().slice(0,10)+" 23:59:59",pPatcatgSeqId:u.data.billType?u.data.billType.PCATG_SEQ_ID:-999,pBillType:u.data.patientType?u.data.patientType:-999,pPatcatgDesc:u.data.billType?u.data.billType.PCATG_DESC:"All",pPayerSeqID:u.data.payerId?u.data.payerId.toString():"",pReportType:a,reportId:t};s.printReportModal("printBillListingCtrl","lg","PDF",i)}},u.generateExcelPrint=function(t,a){if(0!=e.billListingGrid.data.length){var i={pFromDate:u.data.fromDate.toISOString().slice(0,10)+" 00:00:00",pToDate:u.data.toDate.toISOString().slice(0,10)+" 23:59:59",pPatcatgSeqId:u.data.billType?u.data.billType.PCATG_SEQ_ID:-999,pBillType:u.data.patientType?u.data.patientType:-999,pPatcatgDesc:u.data.billType?u.data.billType.PCATG_DESC:"All",pReportType:a,pPayerSeqID:u.data.payerId?u.data.payerId.toString():""};o.generateExcel(t,i).then(function(e){try{var t="napier-his-web/NapierReportServlet?reportName="+(e.data.HITService.message.reportName+""),a=location.host;c.open("http://"+a+"/"+t)}catch(e){}})}},u.getTableHeight=function(){var t;return e.billListingGrid.data.length>=10?(t=400,t+="px"):0==e.billListingGrid.data.length?t="200px !important":(t=30*e.billListingGrid.data.length+30+70,t+="px"),{height:t}},u.checkPrintPermission=function(){return!!d.loadRoleTaskService("T_BL_LISTING_SCREEN").T_BL_LISTING_SCREEN_P}}function t(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){s.pageName="Report",s.cancel=function(){u.dismissAll()},s.printParameterList=[],i.prepareParamList("pFromDate",e.pFromDate,s.printParameterList),i.prepareParamList("pToDate",e.pToDate,s.printParameterList),i.prepareParamList("pPatcatgSeqId",e.pPatcatgSeqId,s.printParameterList),i.prepareParamList("pPatcatgDesc",e.pPatcatgDesc,s.printParameterList),i.prepareParamList("pBillType",e.pBillType,s.printParameterList),i.prepareParamList("pPayerSeqID",e.pPayerSeqID,s.printParameterList),i.prepareParamList("pReportType",e.pReportType,s.printParameterList),s.printObject={},s.printObject.reportId=e.reportId,s.printObject.destination="reportingServiceImpl",s.printObject.reportType={"@class":"com.napier.report.type.ReportType",id:"PDF"==a?4:5,desc:a},s.printObject.paramsList=s.printParameterList,r.printReportFunction(s.printObject,s)}e.$inject=["$scope","$uibModal","billListingReportGridColumnData","billListingCancelledReportGridColumnData","billListingSearchQuery","CallManager","billLisitngService","PrintService","ExcelService","$window","adtDailyReportComboQueryservice","QueryService"],t.$inject=["returnObj","$uibModalInstance","selectedPrintType","QueryService","PrintServiceCustome","$sce","$rootScope","$scope","CallManager","IPINDENTAPIS","APIS","$window","$uibModalStack","hisAlertService","PrintService"],angular.module("napierContainerUi").controller("billListingPrintController",e).controller("printBillListingCtrl",t)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s){var o=this;o.data={},o.data.fromDate=new Date,o.data.toDate=new Date,o.data.mainStatusValue="1",e.cashierCtrlMandatory=!1,e.dateOptions={maxDate:new Date,showWeeks:!1},e.toDateOptions={maxDate:new Date,showWeeks:!1},e.open1=function(t){e.popup1.opened=!0,e.popup2.opened=!1,o.data.toDate=new Date},e.open2=function(t){e.popup2.opened=!0,e.popup1.opened=!1,e.toDateOptions.minDate=o.data.fromDate},e.popup1={opened:!1},e.popup2={opened:!1},e.bigTotalItems=0,o.clearFormData=function(){o.data={},o.data.fromDate=new Date,o.data.toDate=new Date,e.cashierCtrlMandatory=!1},o.generatePDFprint=function(){var e="";"1"==o.data.mainStatusValue?e="DailyCashDrawerListingReportForHSC":"2"==o.data.mainStatusValue&&(e="DAILY_CASHIER_DETAILS_LISTING_REPORT");var t={pFromDate:o.data.fromDate.toISOString().slice(0,10)+" 00:00:00",pToDate:o.data.toDate.toISOString().slice(0,10)+" 23:59:59",pDeptType:o.data.deptType,pCashierID:o.data.cashierID,reportId:e};r.printReportModal("printCahierListingCtrl","lg","PDF",t)},o.generateExcelPrint=function(){var e="";"1"==o.data.mainStatusValue?e="DailyCashDrawerListingReportForHSC":"2"==o.data.mainStatusValue&&(e="DAILY_CASHIER_DETAILS_LISTING_REPORT");var t={pFromDate:o.data.fromDate.toISOString().slice(0,10)+" 00:00:00",pToDate:o.data.toDate.toISOString().slice(0,10)+" 23:59:59",pCashierid:o.data.cashierID?o.data.cashierID.USER_SEQ_ID:-999,pCashieridDesc:o.data.cashierID?o.data.cashierID.EMP_CODE:"All",pVisitLocation:o.data.deptType?o.data.deptType.CODE:-999,pVisitLocationDesc:o.data.deptType?o.data.deptType.DESCRIPTION:"All"};n.generateExcel(e,t).then(function(e){try{var t="napier-his-web/NapierReportServlet?reportName="+(e.data.HITService.message.reportName+""),a=location.host;l.open("http://"+a+"/"+t)}catch(e){}})},o.checkPrintPermission=function(){return!!s.loadRoleTaskService("T_BL_CASH_DRAWER_LISTING").T_BL_CASH_DRAWER_LISTING_P},s.loadCombos("CASH_DROPDOWN_001_RPT",JSON.parse(sessionStorage.userContextObj).CLIENT_REF_ID).then(function(t){e.cashierData=t[1]}),s.loadCombos("HSC_VISITLOCATION_DROPDOWN_001",JSON.parse(sessionStorage.userContextObj).CLIENT_REF_ID).then(function(t){e.visitDepartment=t[1]})}function t(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){s.pageName="Report",s.cancel=function(){u.dismissAll()},s.printParameterList=[],i.prepareParamList("pFromDate",e.pFromDate,s.printParameterList),i.prepareParamList("pToDate",e.pToDate,s.printParameterList),i.prepareParamList("pCashierid",e.pCashierID?e.pCashierID.USER_SEQ_ID:-999,s.printParameterList),i.prepareParamList("pCashieridDesc",e.pCashierID?e.pCashierID.EMP_CODE:"All",s.printParameterList),i.prepareParamList("pVisitLocation",e.pDeptType?e.pDeptType.CODE:-999,s.printParameterList),i.prepareParamList("pVisitLocationDesc",e.pDeptType?e.pDeptType.DESCRIPTION:"All",s.printParameterList),s.printObject={},s.printObject.reportId=e.reportId,s.printObject.destination="reportingServiceImpl",s.printObject.reportType={"@class":"com.napier.report.type.ReportType",id:"PDF"==a?4:5,desc:a},s.printObject.paramsList=s.printParameterList,r.printReportFunction(s.printObject,s)}e.$inject=["$scope","$uibModal","CallManager","billLisitngService","PrintService","ExcelService","$window","adtDailyReportComboQueryservice"],t.$inject=["returnObj","$uibModalInstance","selectedPrintType","QueryService","PrintServiceCustome","$sce","$rootScope","$scope","CallManager","IPINDENTAPIS","APIS","$window","$uibModalStack","hisAlertService","PrintService"],angular.module("napierContainerUi").controller("cashierDrawerkLisitngCtlr",e).controller("printCahierListingCtrl",t)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s){var o=this;o.data={},o.data.fromDate=new Date,o.data.toDate=new Date,e.cashCtrlDeptMandatory=!1,e.dateOptions={maxDate:new Date,showWeeks:!1},e.toDateOptions={maxDate:new Date,showWeeks:!1},e.open1=function(t){e.popup1.opened=!0,e.popup2.opened=!1,o.data.toDate=new Date},e.open2=function(t){e.popup2.opened=!0,e.popup1.opened=!1,e.toDateOptions.minDate=o.data.fromDate},e.popup1={opened:!1},e.popup2={opened:!1},e.bigTotalItems=0,o.clearFormData=function(){o.data={},o.data.fromDate=new Date,o.data.toDate=new Date,e.cashCtrlDeptMandatory=!1},o.generatePDFprint=function(t){e.cashCtrlDeptMandatory=!1;var a={pFromDate:o.data.fromDate.toISOString().slice(0,10)+" 00:00:00",pToDate:o.data.toDate.toISOString().slice(0,10)+" 23:59:59",pVisitLoc:o.data.visitDetails?o.data.visitDetails.CODE:-999,pVisitLocDesc:o.data.visitDetails?o.data.visitDetails.DESCRIPTION:"All",pCashierID:o.data.cashierDetails?o.data.cashierDetails.USER_SEQ_ID:-999,pCashierDesc:o.data.cashierDetails?o.data.cashierDetails.EMP_CODE:"All",reportId:t};r.printReportModal("printCashDrawerDeptPrintCtrl","lg","PDF",a)},o.generateExcelPrint=function(t){e.cashCtrlDeptMandatory=!1;var a={pFromDate:o.data.fromDate.toISOString().slice(0,10)+" 00:00:00",pToDate:o.data.toDate.toISOString().slice(0,10)+" 23:59:59",pVisitLoc:o.data.visitDetails?o.data.visitDetails.CODE:-999,pVisitLocDesc:o.data.visitDetails?o.data.visitDetails.DESCRIPTION:"All",pCashierID:o.data.cashierDetails?o.data.cashierDetails.USER_SEQ_ID:-999,pCashierDesc:o.data.cashierDetails?o.data.cashierDetails.EMP_CODE:"All",reportId:t};n.generateExcel(t,a).then(function(e){try{var t="napier-his-web/NapierReportServlet?reportName="+(e.data.HITService.message.reportName+""),a=location.host;l.open("http://"+a+"/"+t)}catch(e){}})},o.checkPrintPermission=function(){return!!s.loadRoleTaskService("T_BL_CASH_DRAWER_DEPT").T_BL_CASH_DRAWER_DEPT_P},s.loadCombos("CASH_DROPDOWN_001_RPT",JSON.parse(sessionStorage.userContextObj).CLIENT_REF_ID).then(function(t){e.cashierData=t[1]}),s.loadCombos("HSC_VISITLOCATION_DROPDOWN_001",JSON.parse(sessionStorage.userContextObj).CLIENT_REF_ID).then(function(t){e.visitDepartment=t[1]})}function t(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){s.pageName="Report",s.cancel=function(){u.dismissAll()},s.printParameterList=[],i.prepareParamList("pFromDate",e.pFromDate,s.printParameterList),i.prepareParamList("pToDate",e.pToDate,s.printParameterList),i.prepareParamList("pCashierID",e.pCashierID?e.pCashierID:-999,s.printParameterList),i.prepareParamList("pCashierDesc",e.pCashierDesc?e.pCashierDesc:"All",s.printParameterList),i.prepareParamList("pVisitLoc",e.pVisitLoc?e.pVisitLoc:-999,s.printParameterList),i.prepareParamList("pVisitLocDesc",e.pVisitLoc?e.pVisitLocDesc:"All",s.printParameterList),s.printObject={},s.printObject.reportId=e.reportId,s.printObject.destination="reportingServiceImpl",s.printObject.reportType={"@class":"com.napier.report.type.ReportType",id:"PDF"==a?4:5,desc:a},s.printObject.paramsList=s.printParameterList,r.printReportFunction(s.printObject,s)}e.$inject=["$scope","$uibModal","CallManager","billLisitngService","PrintService","ExcelService","$window","adtDailyReportComboQueryservice"],t.$inject=["returnObj","$uibModalInstance","selectedPrintType","QueryService","PrintServiceCustome","$sce","$rootScope","$scope","CallManager","IPINDENTAPIS","APIS","$window","$uibModalStack","hisAlertService","PrintService"],angular.module("napierContainerUi").controller("cashDrawerDepartmentCtrl",e).controller("printCashDrawerDeptPrintCtrl",t)}(),function(){"use strict";function e(e,t,a,i,r,n){var l=this;function s(e){return n.instant(e)}t.loadModule("billing"),t.changeLanguage("en"),l.validateServiceCode=function(e){if(e.serviceCode){for(var t=0,a=0;a<l.modalGridOptions.data.length;a++)_.toLower(l.modalGridOptions.data[a].serviceCode)==_.toLower(e.serviceCode)&&(t+=1);if(t>1){i.information("Information","service already exists.");var r=_.findIndex(l.modalGridOptions.data,function(t){return t.serviceCode==e.serviceCode&&t.id==e.id});-1!=r&&(l.modalGridOptions.data[r].serviceCode="")}}},l.validateServiceName=function(e){if(e.serviceName){for(var t=0,a=0;a<l.modalGridOptions.data.length;a++)_.toLower(l.modalGridOptions.data[a].serviceName)==_.toLower(e.serviceName)&&(t+=1);if(t>1){i.information("Information","service already exists.");var r=_.findIndex(l.modalGridOptions.data,function(t){return t.serviceName==e.serviceName&&t.id==e.id});-1!=r&&(l.modalGridOptions.data[r].serviceName="")}}},l.changePrimaryService=function(t,a){if(l.secondaryService[a]=[],l.multipleComboDataForList={1:l.secondaryService[a]},t.pServiceGroup&&t.pServiceGroup.gQDataCode){var i=e.executeQueryURLReset(),r=new Array;e.prepareParamList(1,t.pServiceGroup.gQDataCode,r),e.executeQueryInput("SCM_SERV_002_SCM_1_2",r,l.multipleComboDataForList,!0,!0,i,"popUp")}},l.changeSecondaryService=function(t,a){if(l.serviceTypeList[a]=[],l.multipleComboDataForList={1:l.serviceTypeList[a]},t.sServiceGroup&&t.sServiceGroup.gQDataCode){var i=e.executeQueryURLReset(),r=new Array;e.prepareParamList(1,t.sServiceGroup.gQDataCode,r),e.executeQueryInput("SCM_SERV_003_SCM_1_2",r,l.multipleComboDataForList,!0,!0,i,"popUp")}},l.changeServices=function(){if(l.service){l.modalGridOptions.data=[];for(var e=0;e<parseInt(l.service);e++)l.modalGridOptions.data.push({id:e})}},l.addServices=function(){l.serviceData=!1,l.addData=[];for(var e=0;e<l.modalGridOptions.data.length;e++)(l.modalGridOptions.data[e].serviceCode||l.modalGridOptions.data[e].serviceName||l.modalGridOptions.data[e].pServiceGroup||!l.modalGridOptions.data[e].sServiceGroup)&&(!l.modalGridOptions.data[e].serviceCode||l.modalGridOptions.data[e].serviceName||l.modalGridOptions.data[e].pServiceGroup||l.modalGridOptions.data[e].sServiceGroup)&&(l.modalGridOptions.data[e].serviceCode||l.modalGridOptions.data[e].serviceName||!l.modalGridOptions.data[e].pServiceGroup||l.modalGridOptions.data[e].sServiceGroup)&&(l.modalGridOptions.data[e].serviceCode||!l.modalGridOptions.data[e].serviceName||l.modalGridOptions.data[e].pServiceGroup||l.modalGridOptions.data[e].sServiceGroup)&&(l.modalGridOptions.data[e].serviceCode||l.modalGridOptions.data[e].serviceName||l.modalGridOptions.data[e].pServiceGroup||l.modalGridOptions.data[e].sServiceGroup||!l.modalGridOptions.data[e].serviceType)?!l.modalGridOptions.data[e].serviceCode&&!l.modalGridOptions.data[e].serviceName&&l.modalGridOptions.data[e].pServiceGroup&&l.modalGridOptions.data[e].sServiceGroup?(l.modalGridOptions.data[e].required=!0,l.serviceData=!0):l.modalGridOptions.data[e].serviceCode&&l.modalGridOptions.data[e].serviceName&&!l.modalGridOptions.data[e].pServiceGroup&&!l.modalGridOptions.data[e].sServiceGroup?(l.modalGridOptions.data[e].required=!0,l.serviceData=!0):l.modalGridOptions.data[e].serviceCode&&!l.modalGridOptions.data[e].serviceName&&!l.modalGridOptions.data[e].pServiceGroup&&l.modalGridOptions.data[e].sServiceGroup?(l.modalGridOptions.data[e].required=!0,l.serviceData=!0):!l.modalGridOptions.data[e].serviceCode&&l.modalGridOptions.data[e].serviceName&&l.modalGridOptions.data[e].pServiceGroup&&!l.modalGridOptions.data[e].sServiceGroup?(l.modalGridOptions.data[e].required=!0,l.serviceData=!0):(!l.modalGridOptions.data[e].serviceCode||l.modalGridOptions.data[e].serviceName||l.modalGridOptions.data[e].pServiceGroup||l.modalGridOptions.data[e].sServiceGroup)&&(l.modalGridOptions.data[e].serviceCode||!l.modalGridOptions.data[e].serviceName||l.modalGridOptions.data[e].pServiceGroup||l.modalGridOptions.data[e].sServiceGroup)&&(l.modalGridOptions.data[e].serviceCode||l.modalGridOptions.data[e].serviceName||!l.modalGridOptions.data[e].pServiceGroup||l.modalGridOptions.data[e].sServiceGroup)&&(l.modalGridOptions.data[e].serviceCode||l.modalGridOptions.data[e].serviceName||l.modalGridOptions.data[e].pServiceGroup||!l.modalGridOptions.data[e].sServiceGroup)?l.modalGridOptions.data[e].serviceCode&&l.modalGridOptions.data[e].serviceName&&l.modalGridOptions.data[e].pServiceGroup&&l.modalGridOptions.data[e].sServiceGroup&&l.addData.push(l.modalGridOptions.data[e]):(l.modalGridOptions.data[e].required=!0,l.serviceData=!0):(l.modalGridOptions.data[e].required=!0,l.serviceData=!0);!l.serviceData&&l.addData.length>0?r.close(l.addData):i.information("Information","Please fill all the mandatory fields")},l.cancelService=function(e){r.close()},function(){l.primaryService=[],l.secondaryService=[],l.serviceTypeList=[],l.service="10",l.multipleComboDataForList={1:l.primaryService};var t=e.executeQueryURLReset(),i=new Array;e.executeQueryInput("SCM_SERV_001_1",i,l.multipleComboDataForList,!0,!0,t,"popUp"),l.modalGridOptions=angular.copy(a),l.modalGridOptions.gridMenuTitleFilter=s,l.changeServices()}()}e.$inject=["QueryService","hisTranslationsService","modalGridServiceDefinition","hisAlertService","$uibModalInstance","$translate"],angular.module("napierContainerUi").controller("serviceMastersModalController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c){var d=this;function p(e){return $translate.instant(e)}function u(e){for(var t=_.find(d.commonList,function(e){return 1==e.gQDataCode}),a=_.find(d.designList,function(e){return 1==e.gQDataCode}),i=_.find(d.servicePriorityList,function(e){return 1==e.gQDataCode}),r=0;r<e.length;r++){if(-1==_.findIndex(d.gridOptions.data,function(t){return t.servSeqId==e[r].SERV_SEQ_ID})){var l=0;l=d.gridOptions.data.length>0?d.gridOptions.data.length:0,d.taxFromOptions[l]={minDate:new Date},d.fromDateOptions[l]={minDate:new Date},d.serviceValidTo[l]={minDate:new Date},d.taxValidTo[l]={minDate:new Date},d.gridOptions.data.push({aaEffectiveOption:"2",serviceCode:e[r].SERV_CODE,serviceName:e[r].SERV_NAME,servSeqId:e[r].SERV_SEQ_ID,serviceDescription:e[r].serviceDescription,serviceDesign:a,pServiceGroup:{gQDataCode:e[r].PRI_SERV_TYPE_CODE,gQDataName:e[r].PRIDESC},sServiceGroup:{gQDataCode:e[r].SEC_SERV_TYPE_CODE,gQDataName:e[r].SECDESC},serviceType:{gQDataCode:e[r].SERV_TYPE_CODE,gQDataName:e[r].STDSC},gnStatus:e[r].GN_STATUS,serviceValidFrom:new Date,serviceValidTo:new Date,billable:t,serviceDiscountApplicable:t,billWiseDiscountApplicable:t,srCitizenDiscountApplicable:t,depositRequired:t,rateEditable:t,servicePriority:[i],hospitalSurchargeApplicable:t,payerSurchargeApplicable:t,taxable:t,associateRevenueCode:t,schedulable:t,cosmeticSurgery:_.find(d.cosmeticList,function(e){return 1==e.gQDataCode})})}else n.failure("Failure","Record already exists.")}}o.loadModule("billing"),o.changeLanguage("en"),d.changePrimaryService=function(e,t){if(d.secondaryServiceList[t]=[],d.multipleComboDataForList={1:d.secondaryServiceList[t]},e.pServiceGroup&&e.pServiceGroup.gQDataCode){var a=s.executeQueryURLReset(),i=new Array;s.prepareParamList(1,e.pServiceGroup.gQDataCode,i),s.prepareParamList(2,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,i),s.executeQueryInput("SCM_SERV_002_SCM_1_2",i,d.multipleComboDataForList,!0,!0,a,"popUp").then(function(){})}},d.checkValue=function(e,t){e.entity.MMACode="",null!=t&&(1==t.code?e.entity.mmCode=!0:e.entity.mmCode=!1)},d.changeFacility=function(e){d.taxList=[];var t={1:d.taxList},a=s.executeQueryURLReset(),i=[];s.prepareParamList(1,e,i),e&&s.executeQueryInput("SCM_TAX_MASTER_DROP_DOWN_001",i,t,!0,!0,a,"popUp")},d.changeDepartment=function(e,t){d.subDepartmentList[t]=[];var a={1:d.subDepartmentList[t]},i=s.executeQueryURLReset(),r=new Array;s.prepareParamList(1,e,r),s.executeQueryInput("SUBDEPARTMENT_DROPDOWN",r,a,!0,!0,i,"popUp")},d.addServices=function(){d.facility?(d.serviceName.length>0?u(d.serviceName):u(d.serviceNameList),d.serviceName=[],d.serviceNameList=[],d.primaryGroup="",d.secondaryServiceAddList=[],d.sService=""):(d.required=!0,n.failure("Failure","Please Select Facility "))},d.searchService=function(e,t,a){d.serviceNameList=[];var i={1:d.serviceNameList},r=s.executeQueryURLReset(),n=new Array;s.prepareParamListWithParam("pPrimaryservice",e,n),s.prepareParamListWithParam("pSecondaryservice",t&&t.length>0?_.toString(t):"",n),s.prepareParamListWithParam("pServName","",n),s.prepareParamListWithParam("pGnStatus",-999,n),s.executeQueryInput("SCM_GET_12_SERVICES_21",n,i,!0,!0,r,"popUp",{}).then(function(e){})},d.changePrimaryServiceAdd=function(e,t){if(d[t]=[],d.multipleComboDataForList={1:d[t]},e){var a=s.executeQueryURLReset(),i=new Array;s.prepareParamList(1,e,i),s.executeQueryInput("SCM_SERV_002_SCM_1_2",i,d.multipleComboDataForList,!0,!0,a,"popUp").then(function(){}),"secondaryServiceAddList"==t&&d.searchService(e)}},d.getFacilityMasters=function(){d.getFacilityMastersList=[];var e={1:d.getFacilityMastersList},t=s.executeQueryURLReset(),a=new Array;s.prepareParamListWithParam("pPrimaryservice",d.data.pServiceGroup?d.data.pServiceGroup:-999,a),s.prepareParamListWithParam("pSecondaryservice",d.data.sServiceGroup&&d.data.sServiceGroup.length>0?_.toString(d.data.sServiceGroup):"",a),s.prepareParamListWithParam("pServName",d.data.serviceName?d.data.serviceName:"",a),s.prepareParamListWithParam("pGnStatus",d.data.status?parseInt(d.data.status):-999,a),s.prepareParamListWithParam("pServApplicability",d.data.sApplicable?parseInt(d.data.sApplicable):-999,a),s.prepareParamListWithParam("pFromDate",d.data.fromDate?moment(new Date(d.data.fromDate)).format("YYYY-MM-DD 00:00:00"):"1800-01-01 00:00:00",a),s.prepareParamListWithParam("pToDate",d.data.toDate?moment(new Date(d.data.toDate)).format("YYYY-MM-DD 23:59:59"):"9999-12-31 23:59:59",a),s.executeQueryInput("SCM_GET_SERVICES_MAPPING_001",a,e,!0,!0,t,"popUp",{}).then(function(e){if(e[1]){d.gridOptions.data=[];for(var t=0;t<d.getFacilityMastersList.length;t++){d.changeDepartment(d.getFacilityMastersList[t].DEPTCODE,t);_.findIndex(d.gridOptions.data,function(e){return e.servSeqId==d.getFacilityMastersList[t].SERV_SEQ_ID});var a=0;a=d.gridOptions.data.length>0?d.gridOptions.data.length:0,d.taxFromOptions[a]={minDate:new Date(d.getFacilityMastersList[t].AA_VALID_FROM)},d.fromDateOptions[a]={minDate:new Date(d.getFacilityMastersList[t].SERVFROMDATE)},d.serviceValidTo[a]={minDate:new Date(d.getFacilityMastersList[t].SERVFROMDATE)},d.taxValidTo[a]={minDate:new Date(d.getFacilityMastersList[t].AA_VALID_FROM)};var i=[],r=[];if(d.getFacilityMastersList[t].PRIORITY_SEQ_ID)if(d.getFacilityMastersList[t].PRIORITY_SEQ_ID.length>1)for(var n=0;n<d.getFacilityMastersList[t].PRIORITY_SEQ_ID.split(",").length;n++){var l=_.find(d.servicePriorityList,function(e){return e.gQDataCode==parseInt(d.getFacilityMastersList[t].PRIORITY_SEQ_ID.split(",")[n])});i.push(l)}else{l=_.find(d.servicePriorityList,function(e){return e.gQDataCode==parseInt(d.getFacilityMastersList[t].PRIORITY_SEQ_ID)});r.push({servSeqId:d.getFacilityMastersList[t].SERV_SEQ_ID,code:parseInt(d.getFacilityMastersList[t].PRIORITY_SEQ_ID),servPrioritySeqId:angular.copy(d.getFacilityMastersList[t].SERV_PRIORITY_SEQ_ID)}),i.push(l)}else{l=_.find(d.servicePriorityList,function(e){return 1==e.gQDataCode});i.push(l)}var s=null;s="HSC"==sessionStorage.productCustomization?{MMACode:d.getFacilityMastersList[t].EXTERNAL_CODE,baSeqId:d.getFacilityMastersList[t].BA_AF_SEQ_ID,aaEffectiveOption:d.getFacilityMastersList[t].AA_EFFECTIVE_OPTION,serviceCode:d.getFacilityMastersList[t].SERV_CODE,serviceName:d.getFacilityMastersList[t].SERV_NAME,MMACodeApp:_.find(d.mmid,function(e){return e.code==d.getFacilityMastersList[t].EXTERNAL_CODE_APPLICABLE}),servSeqId:d.getFacilityMastersList[t].SERV_SEQ_ID,serviceDescription:d.getFacilityMastersList[t].serviceDescription,serviceDesign:_.find(d.designList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].GN_SERV_DESIGN}),pServiceGroup:{gQDataCode:d.getFacilityMastersList[t].PRI_SERV_TYPE_CODE,gQDataName:d.getFacilityMastersList[t].PRIDESC},sServiceGroup:{gQDataCode:d.getFacilityMastersList[t].SEC_SERV_TYPE_CODE,gQDataName:d.getFacilityMastersList[t].SECDESC},serviceType:{gQDataCode:d.getFacilityMastersList[t].SERV_TYPE_CODE,gQDataName:d.getFacilityMastersList[t].SERVICETYPE},gnStatus:d.getFacilityMastersList[t].GN_STATUS,serviceValidFrom:d.getFacilityMastersList[t].SERVFROMDATE?new Date(d.getFacilityMastersList[t].SERVFROMDATE):new Date,serviceValidTo:d.getFacilityMastersList[t].SERVTOMDATE?new Date(d.getFacilityMastersList[t].SERVTOMDATE):new Date,taxValidFrom:d.getFacilityMastersList[t].AA_VALID_FROM?new Date(d.getFacilityMastersList[t].AA_VALID_FROM):"",taxValidTo:d.getFacilityMastersList[t].AA_VALID_TO?new Date(d.getFacilityMastersList[t].AA_VALID_TO):"",genderApplicability:_.find(d.genderList,function(e){return e.gQDataCode==parseInt(d.getFacilityMastersList[t].GENDER)}),serviceApplicability:_.find(d.applicabilityList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].PACKAGE_TYPE}),taxesApplicable:_.find(d.taxList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].APPLICABLE_TAX}),department:_.find(d.departmentList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].DEPTCODE}),subDepartment:{gQDataCode:d.getFacilityMastersList[t].SUBDEPTCODE,gQDataName:d.getFacilityMastersList[t].SUBDEPTNAME},billable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_BILLABLE}),serviceDiscountApplicable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_DISCOUNT_ALLOWED}),billWiseDiscountApplicable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].BLDISCAPP}),srCitizenDiscountApplicable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_SR_DISCOUNT_ALLOWED}),depositRequired:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_DEPOSIT_REQUIRED}),rateEditable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_RATE_EDITABLE}),servicePriority:i,hospitalSurchargeApplicable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_SURCHARGE_FLAG}),payerSurchargeApplicable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].IS_PAYER_SURCHARGE}),billingSubGroup:_.find(d.billingSubList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].SUB_BRPTC_SEQ_ID}),misSubGroup:_.find(d.misSubList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].MIS_SUBGRP_SEQ_ID}),taxable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_TAXABLE}),associateRevenueCode:_.find(d.commonList,function(e){return e.gQDataCode==parseInt(d.getFacilityMastersList[t].FA_DIST_REVENUE)}),revenueCode:d.getFacilityMastersList[t].BA_REVENUE_CODE,taxCutOffLimit:d.getFacilityMastersList[t].TAXCUTOFF_LIMIT,schedulable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].AA_IS_SCHEDULABLE}),cosmeticSurgery:_.find(d.cosmeticList,function(e){return e.gQDataCode==parseInt(d.getFacilityMastersList[t].COSTSURG)}),taxPercentages:d.getFacilityMastersList[t].TAX_PERCENTAGE,gnFlow:d.getFacilityMastersList[t].GN_FLOW,servPriorityArray:r}:{baSeqId:d.getFacilityMastersList[t].BA_AF_SEQ_ID,aaEffectiveOption:d.getFacilityMastersList[t].AA_EFFECTIVE_OPTION,serviceCode:d.getFacilityMastersList[t].SERV_CODE,serviceName:d.getFacilityMastersList[t].SERV_NAME,servSeqId:d.getFacilityMastersList[t].SERV_SEQ_ID,serviceDescription:d.getFacilityMastersList[t].serviceDescription,serviceDesign:_.find(d.designList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].GN_SERV_DESIGN}),pServiceGroup:{gQDataCode:d.getFacilityMastersList[t].PRI_SERV_TYPE_CODE,gQDataName:d.getFacilityMastersList[t].PRIDESC},sServiceGroup:{gQDataCode:d.getFacilityMastersList[t].SEC_SERV_TYPE_CODE,gQDataName:d.getFacilityMastersList[t].SECDESC},serviceType:{gQDataCode:d.getFacilityMastersList[t].SERV_TYPE_CODE,gQDataName:d.getFacilityMastersList[t].SERVICETYPE},gnStatus:d.getFacilityMastersList[t].GN_STATUS,serviceValidFrom:d.getFacilityMastersList[t].SERVFROMDATE?new Date(d.getFacilityMastersList[t].SERVFROMDATE):new Date,serviceValidTo:d.getFacilityMastersList[t].SERVTOMDATE?new Date(d.getFacilityMastersList[t].SERVTOMDATE):new Date,taxValidFrom:d.getFacilityMastersList[t].AA_VALID_FROM?new Date(d.getFacilityMastersList[t].AA_VALID_FROM):new Date,taxValidTo:d.getFacilityMastersList[t].AA_VALID_TO?new Date(d.getFacilityMastersList[t].AA_VALID_TO):"",genderApplicability:_.find(d.genderList,function(e){return e.gQDataCode==parseInt(d.getFacilityMastersList[t].GENDER)}),serviceApplicability:_.find(d.applicabilityList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].PACKAGE_TYPE}),taxesApplicable:_.find(d.taxList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].APPLICABLE_TAX}),department:_.find(d.departmentList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].DEPTCODE}),subDepartment:{gQDataCode:d.getFacilityMastersList[t].SUBDEPTCODE,gQDataName:d.getFacilityMastersList[t].SUBDEPTNAME},billable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_BILLABLE}),serviceDiscountApplicable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_DISCOUNT_ALLOWED}),billWiseDiscountApplicable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].BLDISCAPP}),srCitizenDiscountApplicable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_SR_DISCOUNT_ALLOWED}),depositRequired:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_DEPOSIT_REQUIRED}),rateEditable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_RATE_EDITABLE}),servicePriority:i,hospitalSurchargeApplicable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_SURCHARGE_FLAG}),payerSurchargeApplicable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].IS_PAYER_SURCHARGE}),billingSubGroup:_.find(d.billingSubList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].SUB_BRPTC_SEQ_ID}),misSubGroup:_.find(d.misSubList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].MIS_SUBGRP_SEQ_ID}),taxable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].FA_IS_TAXABLE}),associateRevenueCode:_.find(d.commonList,function(e){return e.gQDataCode==parseInt(d.getFacilityMastersList[t].FA_DIST_REVENUE)}),revenueCode:d.getFacilityMastersList[t].BA_REVENUE_CODE,taxCutOffLimit:d.getFacilityMastersList[t].TAXCUTOFF_LIMIT,schedulable:_.find(d.commonList,function(e){return e.gQDataCode==d.getFacilityMastersList[t].AA_IS_SCHEDULABLE}),cosmeticSurgery:_.find(d.cosmeticList,function(e){return e.gQDataCode==parseInt(d.getFacilityMastersList[t].COSTSURG)}),taxPercentages:d.getFacilityMastersList[t].TAX_PERCENTAGE,gnFlow:d.getFacilityMastersList[t].GN_FLOW,servPriorityArray:r},d.gridOptions.data.push(s)}}})},d.saveFacilityMaster=function(){if(!d.facility)return d.required=!0,void n.failure("Failure","Please Select Facility");var e=[];if(d.gridOptions.data.length>0){for(var t=0;t<d.gridOptions.data.length;t++){if(!d.gridOptions.data[t].department)return d.gridOptions.data[t].required=!0,void n.failure("Failure","Please enter all mandatory data");if(!d.gridOptions.data[t].subDepartment)return d.gridOptions.data[t].required=!0,void n.failure("Failure","Please enter all mandatory data");if(!d.gridOptions.data[t].billingSubGroup)return d.gridOptions.data[t].required=!0,void n.failure("Failure","Please enter all mandatory data");if(!d.gridOptions.data[t].misSubGroup)return d.gridOptions.data[t].required=!0,void n.failure("Failure","Please enter all mandatory data");if(!d.gridOptions.data[t].serviceApplicability)return d.gridOptions.data[t].required=!0,void n.failure("Failure","Please enter all mandatory data");if(!d.gridOptions.data[t].serviceValidFrom)return d.gridOptions.data[t].required=!0,void n.failure("Failure","Please enter all mandatory data");if(!d.gridOptions.data[t].genderApplicability)return d.gridOptions.data[t].required=!0,void n.failure("Failure","Please enter all mandatory data");if(!d.gridOptions.data[t].taxesApplicable)return d.gridOptions.data[t].required=!0,void n.failure("Failure","Please enter all mandatory data");if(1==d.gridOptions.data[t].associateRevenueCode.gQDataCode&&!d.gridOptions.data[t].revenueCode)return d.gridOptions.data[t].required=!0,void n.failure("Failure","Please enter all mandatory data");if(0==d.gridOptions.data[t].servicePriority.length)return d.gridOptions.data[t].required=!0,void n.failure("Failure","Please enter all mandatory data");for(var a=[],i=0;i<d.gridOptions.data[t].servicePriority.length;i++)a.push({prioritySeqId:d.gridOptions.data[t].servicePriority[i].gQDataCode,status:1});var l={facilityMasterList:[{"com.napier.core.service.vo.masters.FacilityMaster":{code:d.facility}}],priServTypCode:d.gridOptions.data[t].pServiceGroup.gQDataCode,servSeqId:d.gridOptions.data[t].servSeqId,secServTypeCode:d.gridOptions.data[t].sServiceGroup.gQDataCode,servTypeCode:d.gridOptions.data[t].serviceType.gQDataCode,gnServDesign:_.toString(d.gridOptions.data[t].serviceDesign.gQDataCode),gnServStatus:_.toString(d.gridOptions.data[t].gnStatus),packageType:_.toString(d.gridOptions.data[t].serviceApplicability.gQDataCode),servCode:d.gridOptions.data[t].serviceCode,servName:d.gridOptions.data[t].serviceName,servDesc:d.gridOptions.data[t].serviceDescription,servDefStatus:"1",servPriorityLinkVo:[{"com.napier.core.scm.master.vo.ServicePriorityLinkVo":angular.copy(a)}],servFromDate:angular.copy(moment(new Date(d.gridOptions.data[t].serviceValidFrom)).format("YYYY-MM-DD HH:mm:ss.SSS")),servToDate:angular.copy(moment(new Date(d.gridOptions.data[t].serviceValidTo)).format("YYYY-MM-DD HH:mm:ss.SSS")),gender:_.toString(d.gridOptions.data[t].genderApplicability.gQDataCode),subBrptcSeqId:_.toString(d.gridOptions.data[t].billingSubGroup.gQDataCode),misSubGrpSeqId:_.toString(d.gridOptions.data[t].misSubGroup.gQDataCode),atomicDetailsVo:{scmMasterServiceDeptSpeclVoList:[{"com.napier.core.scm.master.vo.ServiceDepartmentSpecailityLinkVo":{departmentMaster:{code:d.gridOptions.data[t].subDepartment.gQDataCode,deptCode:d.gridOptions.data[t].department.gQDataCode},specialityCode:[{"com.napier.core.service.vo.masters.SpecialityMaster":{code:d.gridOptions.data[t].subDepartment.gQDataCode}}]}}]},scmMasterServBillingAttrVo:{aaEffectiveOption:d.gridOptions.data[t].aaEffectiveOption,aaIsSchedulable:_.toString(d.gridOptions.data[t].schedulable.gQDataCode),faPayerSurchargeFlag:_.toString(d.gridOptions.data[t].payerSurchargeApplicable.gQDataCode),faIsBillable:_.toString(d.gridOptions.data[t].billable.gQDataCode),faIsDepositRequired:_.toString(d.gridOptions.data[t].depositRequired.gQDataCode),isServDiscApplicable:d.gridOptions.data[t].serviceDiscountApplicable.gQDataCode,faIsDiscountAllowed:d.gridOptions.data[t].serviceDiscountApplicable.gQDataCode,faIsRateEditable:_.toString(d.gridOptions.data[t].rateEditable.gQDataCode),faIsTaxable:_.toString(d.gridOptions.data[t].taxable.gQDataCode),faSurchargeFlag:_.toString(d.gridOptions.data[t].hospitalSurchargeApplicable.gQDataCode),isSrCitizenDiscountAllowed:_.toString(d.gridOptions.data[t].srCitizenDiscountApplicable.gQDataCode),applicableTax:d.gridOptions.data[t].taxesApplicable?_.toString(d.gridOptions.data[t].taxesApplicable.gQDataCode):void 0,taxPercentage:d.gridOptions.data[t].taxPercentages>0&&d.gridOptions.data[t].taxesApplicable?parseInt(d.gridOptions.data[t].taxPercentages):0===parseInt(d.gridOptions.data[t].taxPercentages)?parseInt(d.gridOptions.data[t].taxPercentages):void 0,aaValidFrom:d.gridOptions.data[t].taxValidFrom?moment(new Date(d.gridOptions.data[t].taxValidFrom)).format("YYYY-MM-DD HH:mm:ss.SSS"):void 0,aaValidTo:d.gridOptions.data[t].taxValidTo?moment(new Date(d.gridOptions.data[t].taxValidTo)).format("YYYY-MM-DD HH:mm:ss.SSS"):void 0,baRevenueCode:d.gridOptions.data[t].revenueCode&&1==d.gridOptions.data[t].associateRevenueCode.gQDataCode?parseInt(d.gridOptions.data[t].revenueCode):void 0,faDistRevenue:d.gridOptions.data[t].associateRevenueCode.gQDataCode,taxCutOffLimit:d.gridOptions.data[t].taxCutOffLimit?d.gridOptions.data[t].taxCutOffLimit:void 0,billWiseDiscountApplicable:_.toString(d.gridOptions.data[t].billWiseDiscountApplicable.gQDataCode),isCosmeticSurgery:_.toString(d.gridOptions.data[t].cosmeticSurgery.gQDataCode),scmMasterServBAAppFlowVoList:[{"com.napier.core.scmmaster.vo.ServiceBillingAttributeAppFlowVo":[{"@class":"com.napier.core.scm.master.vo.ServiceBillingAttributeAppFlowVo",generalMaster:{"@class":"com.napier.core.service.vo.masters.GeneralMaster",code:d.gridOptions.data[t].serviceApplicability.gQDataCode,description:d.gridOptions.data[t].serviceApplicability.gQDataName}}]}]},gnTranStatus:d.gridOptions.data[t].gnStatus};"HSC"==sessionStorage.productCustomization&&null!=d.gridOptions.data[t].MMACodeApp&&(l.externalCodeApplicable=d.gridOptions.data[t].MMACodeApp.code,l.externalCode=d.gridOptions.data[t].MMACode),3==d.gridOptions.data[t].serviceApplicability.gQDataCode&&(l.scmMasterServBillingAttrVo.scmMasterServBAAppFlowVoList[0]["com.napier.core.scmmaster.vo.ServiceBillingAttributeAppFlowVo"]=[],l.scmMasterServBillingAttrVo.scmMasterServBAAppFlowVoList[0]["com.napier.core.scmmaster.vo.ServiceBillingAttributeAppFlowVo"].push({"@class":"com.napier.core.scm.master.vo.ServiceBillingAttributeAppFlowVo",generalMaster:{"@class":"com.napier.core.service.vo.masters.GeneralMaster",code:1,description:"IP"}},{"@class":"com.napier.core.scm.master.vo.ServiceBillingAttributeAppFlowVo",generalMaster:{"@class":"com.napier.core.service.vo.masters.GeneralMaster",code:2,description:"OP"}})),e.push(angular.copy(l))}e.length>0&&(d.saveFlag=!0,r.saveServiceMastersData(e).then(function(e){if(e.data.HITService.message&&e.data.HITService.message.errorCode)return n.failure("Failure",e.data.HITService.message.errorMessage),void(d.saveFlag=!1);e.data.HITService.message&&e.data.HITService.message.length>0&&e.data.HITService.message[0]["com.napier.core.scm.master.vo.ServiceVo"]?(n.success("Success","Record Saved Successfully"),d.saveFlag=!1,d.gridOptions.data=[]):(n.information("Information","Something went wrong"),d.saveFlag=!1)}))}else n.information("Information","Record Not Found in Grid")},d.getAutoServiceName=function(e){d.getServiceListSearch=[];var t={1:d.getServiceListSearch},a=s.executeQueryURLReset(),i=new Array;return s.prepareParamListWithParam("pPrimaryservice",d.data.pServiceGroup?d.data.pServiceGroup:-999,i),s.prepareParamListWithParam("pSecondaryservice",d.data.sServiceGroup?_.toString(d.data.sServiceGroup):"",i),s.prepareParamListWithParam("pServName",e,i),s.prepareParamListWithParam("pGnStatus",d.data.status?parseInt(d.data.status):-999,i),s.prepareParamListWithParam("pServApplicability",d.data.sApplicable?parseInt(d.data.sApplicable):-999,i),s.prepareParamListWithParam("pFromDate",d.data.fromDate?moment(new Date(d.data.fromDate)).format("YYYY-MM-DD 00:00:00"):"1800-01-01 00:00:00",i),s.prepareParamListWithParam("pToDate",d.data.toDate?moment(new Date(d.data.toDate)).format("YYYY-MM-DD 23:59:59"):"9999-12-31 23:59:59",i),s.executeQueryInput("SCM_GET_SERVICES_MAPPING_001",i,t,!0,!0,a,"popUp").then(function(e){return e[1].length>0?d.getServiceListSearch.map(function(e){return e}):[]})},d.changeSecondaryService=function(e,t){if(d.serviceTypeList[t]=[],d.multipleComboDataForList={1:d.serviceTypeList[t]},e.sServiceGroup&&e.sServiceGroup.gQDataCode){var a=s.executeQueryURLReset(),i=new Array;s.prepareParamList(1,e.sServiceGroup.gQDataCode,i),s.prepareParamList(2,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,i),s.executeQueryInput("SCM_SERV_003_SCM_1_2",i,d.multipleComboDataForList,!0,!0,a,"popUp")}},d.closeGrid=function(e,t){if("HSC"!=sessionStorage.productCustomization||null==e.MMACodeApp||1!=e.MMACodeApp.code||""!=e.MMACode){t=_.findIndex(d.gridOptions.data,function(t){return t.servSeqId==e.servSeqId});d.gridOptions.data[t].editable=!1}else n.failure("Failure","Please enter MMA Code")},d.editGrid=function(e,t,a){if("HSC"==sessionStorage.productCustomization&&null!=e.entity.MMACodeApp&&(1==e.entity.MMACodeApp.code?e.entity.mmCode=!0:e.entity.mmCode=!1),"HSC"==sessionStorage.productCustomization)a=_.findIndex(d.gridOptions.data,function(t){return t.servSeqId==e.entity.servSeqId});else a=_.findIndex(d.gridOptions.data,function(t){return t.servSeqId==e.servSeqId});for(var i=0;i<d.gridOptions.data.length;i++)i==a?(d.gridOptions.data[i].subDepartment&&(d.gridOptions.data[i].subDepartment=_.find(d.subDepartmentList[i],function(e){return e.gQDataCode==d.gridOptions.data[i].subDepartment.gQDataCode})),d.gridOptions.data[i].editable=!0):d.gridOptions.data[i].editable=!1},d.removeData=function(e){var t=_.findIndex(d.gridOptions.data,function(t){return t.servSeqId==e.servSeqId});d.subDepartmentList.splice(t,1),d.gridOptions.data.splice(t,1)},d.changeTax=function(e){var t=_.findIndex(d.gridOptions.data,function(t){return t.servSeqId==e.servSeqId});if(d.gridOptions.data[t].taxPercentages="",d.gridOptions.data[t].taxValidFrom="",d.gridOptions.data[t].taxValidTo="",e.taxesApplicable){var a={1:d.getTaxPercentList=[]},i=s.executeQueryURLReset(),r=new Array;s.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,r),s.prepareParamListWithParam("pTaxSeqId",e.taxesApplicable.gQDataCode,r),s.executeQueryInput("SCM_TAX_MASTER_PERCENTAGE",r,a,!0,!0,i,"popUp",{}).then(function(e){e[1][0]&&(d.gridOptions.data[t].taxPercentages=d.getTaxPercentList[0].TAX_PERCENTAGE,d.gridOptions.data[t].taxValidFrom=d.getTaxPercentList[0].VALID_FROM?new Date(d.getTaxPercentList[0].VALID_FROM):"",d.gridOptions.data[t].taxValidTo=d.getTaxPercentList[0].FUTURE_VALID_FROM?new Date(d.getTaxPercentList[0].FUTURE_VALID_FROM):"")})}},d.changeStatus=function(e){r.updateStatus(e).then(function(e){})},function(){d.format=angular.copy(a.uibDateOnly.format),delete t.ngModelOptions.timezone,d.pariority=[],"HSC"==sessionStorage.productCustomization&&(d.mmid=[{code:1,name:"Yes"},{code:2,name:"No"}]),d.toDateOptionsSearch={maxDate:new Date},d.fromDateOptionsSearch={maxDate:new Date},d.primaryService=[],d.secondaryService=[],d.serviceTypeList=[],d.serviceNameList=[],d.subDepartmentList=[],d.data={status:"1"},d.secondaryServiceList=[],d.departmentList=[],d.facilityList=[],d.genderList=[],d.billingSubList=[],d.applicabilityList=[{gQDataCode:3,gQDataName:"Both"}],d.misSubList=[],d.designList=[],d.taxList=[];var i={1:d.billingSubList,2:d.misSubList,3:d.departmentList,4:d.facilityList,5:d.genderList,6:d.primaryService,7:d.applicabilityList,8:d.designList,9:d.taxList},r=s.executeQueryURLReset(),n=new Array,o=new Array,u=new Array;d.commonList=[{gQDataCode:1,gQDataName:"Yes"},{gQDataCode:2,gQDataName:"No"}],d.cosmeticList=[{gQDataCode:1,gQDataName:"Yes"},{gQDataCode:0,gQDataName:"No"}],d.taxFromOptions={minDate:new Date},d.fromDateOptions={minDate:new Date},d.serviceValidTo=[],d.taxValidTo=[];var m=[];s.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,m),s.prepareParamListWithParam("pFacility",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,m),s.prepareParamListWithParam("pStatus",1,m),s.executeQueryInput("NHIS_BILLING_SUB_MASTER_LIST",m,i,!0,!1,r,"popUp"),s.executeQueryInput("NHIS_MIS_SUB_GROUP_MASTER_LIST",m,i,!0,!1,r,"popUp"),s.executeQueryInput("DEPARTMENT_DROPDOWN_SCM_1",u,i,!0,!1,r,"popUp"),s.executeQueryInput("FACILITY_DROPDOWN",o,i,!0,!1,r,"popUp");var g=new Array;s.prepareParamList(1,"A",g),s.executeQueryInput("MQ0002",g,i,!0,!1,r,"popUp"),s.executeQueryInput("SCM_SERV_001_1",n,i,!0,!1,r,"popUp");var S=[];s.prepareParamList(1,18005,S),s.executeQueryInput("TRN003",S,i,!0,!1,r,"popUp");var v=[];s.prepareParamList(1,18002,v),s.executeQueryInput("TRN003",v,i,!0,!1,r,"popUp"),v=[],s.executeQueryInput("SCM_TAX_MASTER_DROP_DOWN_001",v,i,!0,!0,r,"popUp"),"HSC"==sessionStorage.productCustomization?d.gridOptions=angular.copy(e):d.gridOptions=angular.copy(l),d.gridOptions.gridMenuTitleFilter=p,function(){d.servicePriorityList=[],d.servicePriorityComboList={1:d.servicePriorityList};var e=s.executeQueryURLReset(),t=new Array;s.prepareParamListWithParam("pMasterSqId",45005,t),s.executeQueryInput("PRIORITY_TYPE",d.servicePriorityList,d.servicePriorityComboList,!0,!0,e,"popUp")}(),d.permissionList=c.rolePermission("T_SCM_M_SERV_FAC_MAP"),d.pariority=[]}()}e.$inject=["facilityMappingGridDefinitionForHSC","uibDatepickerConfig","hisCalDefConstant","$scope","serviceMastersCreationService","hisAlertService","facilityMappingGridDefinition","QueryService","hisTranslationsService","RoleTaskService"],angular.module("napierContainerUi").controller("FacilityServiceMappingController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o){r.loadModule("billing"),r.changeLanguage("en");var c=this;function d(e){var t=e.name.split("."),a=t[t.length-1],i=null;["jpg","png","gif","jpeg","tif","tiff","bmp","doc","docx","xls","xlsx","pdf"].indexOf(a)>=0&&e.size<=5244601&&((i=new window.FileReader).onloadend=function(t){var a=t.target.result.split(",")[1];n.uploadFile(a).then(function(t){t.data.HITService.message.serviceList[0]["com.napier.core.scm.master.vo.ServiceVo"].length>0?(t.data.HITService.message.serviceList[0]["com.napier.core.scm.master.vo.ServiceVo"],l.success("Success","Service details uploaded successfully")):e=""})},i.readAsDataURL(e))}c.data={status:"-999"},c.searchChangePrimaryService=function(e){if(e){var t={1:c.secondaryService},a=i.executeQueryURLReset(),r=new Array;i.prepareParamList(1,e,r),i.executeQueryInput("SCM_SERV_002_SCM_1_2",r,t,!0,!0,a,"popUp")}},c.changePrimaryService=function(e,t,a){if(c.secondaryServiceList[t]=[],c.multipleComboDataForList={1:c.secondaryServiceList[t]},e.pServiceGroup&&e.pServiceGroup.gQDataCode){var r=i.executeQueryURLReset(),n=new Array;i.prepareParamList(1,e.pServiceGroup.gQDataCode,n),i.executeQueryInput("SCM_SERV_002_SCM_1_2",n,c.multipleComboDataForList,!0,!0,r,"popUp").then(function(i){i[1]&&a&&(c.gridOptions.data[t].sServiceGroup=_.find(c.secondaryServiceList[t],function(t){return t.gQDataCode==e.sServiceGroup.gQDataCode}))})}},c.ExportFiles=function(e){if(c.gridOptions.data.length>0){var t={buttonCallBack1:function(){delete c.files},buttonCallBack2:function(){d(e),delete c.files}};l.hisAlertMulti("information","Information","You have unsaved uploaded data. Unsaved data will be lost. Are you sure you want to upload another file?.",{buttonText:"No",buttonText2:"Yes"},t,!1)}else d(e),delete c.files},c.removeData=function(e){if(e.servSeqId)var t=_.findIndex(c.gridOptions.data,function(t){return t.servSeqId==e.servSeqId});else t=_.findIndex(c.gridOptions.data,function(t){return t.serviceCode==e.serviceCode&&t.serviceName==e.serviceName});c.gridOptions.data.splice(t,1),c.serviceTypeList.splice(t,1),c.secondaryServiceList.splice(t,1)},c.getAutoServiceName=function(e){c.getServiceListSearch=[];var t={1:c.getServiceListSearch},a=i.executeQueryURLReset(),r=new Array;return i.prepareParamListWithParam("pPrimaryservice",c.data.pService?c.data.pService:-999,r),i.prepareParamListWithParam("pSecondaryservice",c.data.sService?c.data.sService:-999,r),i.prepareParamListWithParam("pServName",c.data.serviceName?e:"",r),i.prepareParamListWithParam("pGnStatus",c.data.status?parseInt(c.data.status):-999,r),i.executeQueryInput("SCM_GET_123_SERVICES",r,t,!0,!0,a,"popUp").then(function(e){return e[1].length>0?c.getServiceListSearch.map(function(e){return e}):[]})},c.changeSecondaryService=function(e,t,a){if(c.serviceTypeList[t]=[],c.multipleComboDataForList={1:c.serviceTypeList[t]},e.sServiceGroup&&e.sServiceGroup.gQDataCode){var r=i.executeQueryURLReset(),n=new Array;i.prepareParamList(1,e.sServiceGroup.gQDataCode,n),i.executeQueryInput("SCM_SERV_003_SCM_1_2",n,c.multipleComboDataForList,!0,!0,r,"popUp").then(function(i){i[1]&&a&&(c.gridOptions.data[t].serviceType=_.find(c.serviceTypeList[t],function(t){return t.gQDataCode==e.serviceType.gQDataCode}))})}},c.options=!1,c.gridOptions=angular.copy(e),c.gridOptions.gridMenuTitleFilter=function(e){return $translate.instant(e)},c.save=function(){var e=[];if(c.gridOptions.data.length>0){for(var t=0;t<c.gridOptions.data.length;t++)c.gridOptions.data[t].pServiceGroup&&c.gridOptions.data[t].sServiceGroup?c.gridOptions.data[t].serviceCode&&c.gridOptions.data[t].serviceName&&c.gridOptions.data[t].pServiceGroup&&c.gridOptions.data[t].sServiceGroup&&(c.serviceData=!1,e.push({facilityMasterList:[{"com.napier.core.service.vo.masters.FacilityMaster":{}}],servSeqId:c.gridOptions.data[t].servSeqId?c.gridOptions.data[t].servSeqId:void 0,servCode:c.gridOptions.data[t].serviceCode,servName:c.gridOptions.data[t].serviceName,priServTypCode:c.gridOptions.data[t].pServiceGroup.gQDataCode,secServTypeCode:c.gridOptions.data[t].sServiceGroup.gQDataCode,servTypeCode:c.gridOptions.data[t].serviceType?c.gridOptions.data[t].serviceType.gQDataCode:void 0,gnServDesign:"1",gnServStatus:"1",gnTranStatus:c.gridOptions.data[t].gnTranStatus})):(c.gridOptions.data[t].required=!0,c.serviceData=!0);!c.serviceData&&e.length>0&&(c.saveFlag=!0,n.saveServiceMastersData(e).then(function(e){if(e.data.HITService.message.errorCode)return l.failure("Failure",e.data.HITService.message.errorMessage),void(c.saveFlag=!1);if(e.data.HITService.message[0]["com.napier.core.scm.master.vo.ServiceVo"]){if(!(t=e.data.HITService.message[0]["com.napier.core.scm.master.vo.ServiceVo"]).length)var t=[t];var a=[],i=angular.copy(c.gridOptions.data);c.gridOptions.data=[];for(var r=0;r<t.length;r++)if(t[r].dupCheck){for(var n=0;n<i.length;n++)delete i[n].isDuplicate,i[n].serviceCode==t[r].servCode&&(i[n].isDuplicate=!0,c.gridOptions.data.push(angular.copy(i[n])));a.push(t[r].servName)}a.length>0?(l.information("Information","Duplicate Records Exits: &nbsp"+a),c.saveFlag=!1):(l.success("Success","Record Saved Successfully"),c.gridOptions.data=[],c.saveFlag=!1)}}))}else l.information("Information","Record Not Found in Grid")},c.searchService=function(){c.getServiceList=[];var e={1:c.getServiceList},t=i.executeQueryURLReset(),a=new Array;i.prepareParamListWithParam("pPrimaryservice",c.data.pService?c.data.pService:-999,a),i.prepareParamListWithParam("pSecondaryservice",c.data.sService?c.data.sService:-999,a),i.prepareParamListWithParam("pServName",c.data.serviceName?c.data.serviceName:"",a),i.prepareParamListWithParam("pGnStatus",c.data.status?parseInt(c.data.status):-999,a),i.executeQueryInput("SCM_GET_123_SERVICES",a,e,!0,!0,t,"popUp",{}).then(function(e){if(e[1]){c.gridOptions.data=[];for(var t=0;t<c.getServiceList.length;t++){var a=_.find(c.primaryService,function(e){return e.gQDataCode==c.getServiceList[t].PRI_SERV_TYPE_CODE}),i={serviceCode:c.getServiceList[t].SERV_CODE,serviceName:c.getServiceList[t].SERV_NAME,pServiceGroup:a,sServiceGroup:{gQDataCode:c.getServiceList[t].SEC_SERV_TYPE_CODE},serviceType:{gQDataCode:c.getServiceList[t].SERV_TYPE_CODE},gnTranStatus:c.getServiceList[t].GN_STATUS,servSeqId:c.getServiceList[t].SERV_SEQ_ID};c.gridOptions.data.push(i),c.changeSecondaryService(i,t,"search"),c.changePrimaryService(i,t,"search")}}})},c.editGrid=function(e,t){c.gridOptions.data[t].sServiceGroup=_.find(c.secondaryServiceList[t],function(t){return t.gQDataCode==e.sServiceGroup.gQDataCode}),c.gridOptions.data[t].pServiceGroup=_.find(c.primaryService,function(t){return t.gQDataCode==e.pServiceGroup.gQDataCode}),c.gridOptions.data[t].serviceType=e.serviceType?_.find(c.serviceTypeList[t],function(t){return t.gQDataCode==e.serviceType.gQDataCode}):"",c.gridOptions.data[t].editable=!0},c.closeGrid=function(e,t){c.gridOptions.data[t].editable=!1},c.open=function(e){s.open("{{'billing.createService'|translate}}",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/service-masters/sections/create.service.modal.html",size:e,controller:"serviceMastersModalController",controllerAs:"smc"}).result.then(function(e){e&&function(e){for(var t=0;t<e.length;t++)c.gridOptions.data.length>0?-1==_.findIndex(c.gridOptions.data,function(a){return a.serviceName==e[t].serviceName||a.serviceCode==e[t].serviceCode})?(angular.extend(e[t],{gnTranStatus:1}),c.changeSecondaryService(e[t],t),c.changePrimaryService(e[t],t),c.gridOptions.data.push(e[t])):l.warning("Warning","service already exists."):(angular.extend(e[t],{gnTranStatus:1}),c.changeSecondaryService(e[t],t),c.changePrimaryService(e[t],t),c.gridOptions.data.push(e[t]))}(e)})},c.facilityMappingService=function(){a.go("facilityServiceMapping")},c.changeStatus=function(e){n.updateStatus(e).then(function(e){})},function(){c.primaryService=[],c.secondaryService=[],c.serviceTypeList=[],c.secondaryServiceList=[],c.multipleComboDataForList={1:c.primaryService},c.permissionList=o.rolePermission("T_SCM_M_SERV_LIST"),c.facilityList=o.rolePermission("T_SCM_M_SERV_FAC_MAP");var e=i.executeQueryURLReset();c.primaryServiceList=new Array,i.executeQueryInput("SCM_SERV_001_1",c.primaryServiceList,c.multipleComboDataForList,!0,!0,e,"popUp")}()}e.$inject=["serviceMastersGridServiceDefinition","$scope","$state","QueryService","hisTranslationsService","serviceMastersCreationService","hisAlertService","hisModalService","RoleTaskService"],angular.module("napierContainerUi").controller("serviceMastersCreateController",e)}(),function(){"use strict";function e(e,t,a,i){this.saveServiceMastersData=function(i,r){var n=e.defer(),l={};return l.url=t.HISIPINDENT.URL,l.requestData={operation:"saveServiceList",messageId:"",destination:"com.napier.core.scm.master.service.external.ScmMasterService",message:i},a.sendRestRequest(l).then(function(e){n.resolve(e)}),n.promise},this.getServiceCostHistoryData=function(e){var t=i.executeQueryURLReset(),a={1:[]},r=new Array;return i.prepareParamListWithParam("pServSeqId",e,r),i.executeQueryInput("GET_SERVICE_COST_HISTORY",r,a,!0,!0,t,"popUp",{})}}e.$inject=["$q","IPINDENTAPIS","CallManager","QueryService"],angular.module("napierContainerUi").service("servMastersService",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){var S=this;S.globalTask=t.rolePermission("T_SCM_M_SERV"),S.localTaskBillAtt=t.rolePermission("T_SCM_M_SERV_BILL_ATTR"),m.loadModule("billing");var v=g.getLanguageToSet();function D(){var e=n.executeQueryURLReset(),t={1:S.primaryService=[],2:S.billingSubList=[],3:S.misSubList=[],4:S.facilityList=[],5:S.genderList=[]},a=new Array;n.executeQueryInput("SCM_SECONDARY_SERVICE_GROUP_DROP_DOWN_QUERY",a,t,!0,!1,e,"popUp",{});var i=new Array,r=[];n.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r),n.prepareParamListWithParam("pFacility",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,r),n.prepareParamListWithParam("pStatus",1,r),n.executeQueryInput("NHIS_BILLING_SUB_MASTER_LIST",r,t,!0,!1,e,"popUp",{}),n.executeQueryInput("NHIS_MIS_SUB_GROUP_MASTER_LIST",r,t,!0,!1,e,"popUp",{}),n.executeQueryInput("FACILITY_DROPDOWN",i,t,!0,!1,e,"popUp",{});var l=new Array;n.prepareParamList(1,"A",l),n.executeQueryInput("MQ0002",l,t,!0,!0,e,"popUp",{})}function y(e,t){return e.filter(function(e){return e.TAX_CODE==t.TAX_CODE}).length>0}function f(t){if(t.length>0){S.issave=!1,S.isupdate=!0;var a=t[0];S.servMasterObj.itemCode=a.SERV_CODE,S.servMasterObj.itemName=a.SERV_NAME,S.servMasterObj.servHisSeqId=a.SERV_HIS_SEQ_ID,S.servMasterObj.serviceCost=a.SERV_RATE,null!=a.EFFECTIVE_FROM&&(S.servMasterObj.effectFrom=new Date(a.EFFECTIVE_FROM)),S.servMasterObj.primaryServiceGrp=a.SEC_SERV_TYPE_CODE;var i=n.getObjectByAnyValue(S.billingSubList,a.SUB_BRPTC_SEQ_ID,"SUB_BRPTC_SEQ_ID");S.servMasterObj.billingsubGrp=null!=i&&null!=i.SUB_BRPTC_SEQ_ID?i.SUB_BRPTC_SEQ_ID:a.SUB_BRPTC_SEQ_ID,S.servMasterObj.misSubGrp=a.MIS_SUBGRP_SEQ_ID,S.servMasterObj.genderAppl=a.GENDER,S.servMasterObj.serDesign=a.GN_SERV_DESIGN,S.servMasterObj.serAppl=null==a.GN_FLOW||"1,2"==a.GN_FLOW?3:a.GN_FLOW,S.servMasterObj.speciality=a.SPECIALITY_CODE,S.servMasterObj.dept=a.SUBDEPTCODE,S.changePrimaryGroup(),S.servMasterObj.dept&&S.OnChangeDept();var r=(a.PRIORITY_SEQ_ID+"").split(",");e.serPriCheckList=[{prioritySeqId:1}],angular.forEach(r,function(t,a){for(var i=!0,r=0;r<e.serPriCheckList.length;r++){if(e.serPriCheckList[r].prioritySeqId==t){i=!1;break}e.serPriCheckList[r].length-1==r&&(i=!0)}i&&("2"==t&&(S.servMasterObj.serPriorityASAP="A",S.isAsap=!0,e.serPriCheckList.push({prioritySeqId:parseInt(t)})),"3"==t&&(S.servMasterObj.serPrioritySTAT="S",S.Stat=!0,e.serPriCheckList.push({prioritySeqId:parseInt(t)})))});var s=a.FACILITY_DESC.split(",");if(S.addFaclist=[],angular.forEach(s,function(e,t){angular.forEach(S.facilityList,function(t,a){if(e==t.DESCRIPTION){for(var i=!0,r=0;r<S.addFaclist.length;r++){if(S.addFaclist[r].DESCRIPTION==e){i=!1;break}S.addFaclist.length-1==r&&(i=!0)}i&&S.addFaclist.push(S.facilityList[a])}})}),S.servMasterObj.billable=a.FA_IS_BILLABLE,S.servMasterObj.RateEditable=a.FA_IS_RATE_EDITABLE,S.servMasterObj.status=a.GN_STATUS,S.servMasterObj.faIsDiscountAllowed=null==a.FA_IS_DISCOUNT_ALLOWED?2:a.FA_IS_DISCOUNT_ALLOWED,e.SERV_SEQ_ID=a.SERV_SEQ_ID,l.getServiceCostHistoryData(e.SERV_SEQ_ID).then(function(e){null!=e[1]&&0!=e[1].length?(S.disableHisIcon=!1,S.historyData=e[1]):(S.historyData=[],S.disableHisIcon=!0)}),null!=a.APPLICABLE_TAX&&null!=a.FA_IS_TAXABLE&&1==a.FA_IS_TAXABLE){var o=n.executeQueryURLReset(),c=[],d={1:c},p=new Array;n.prepareParamListWithParam("pApplicableTax",a.APPLICABLE_TAX,p),n.executeQueryInput("SCM_TAX_DETAILS_FOR_SERVICE",p,d,!0,!0,o,"popUp",{}).then(function(t){if(c.length>0){var a={};a.matTaxCode=c[0].MTRL_TAX_CODE,a.taxCodeSeqId=c[0].TAX_CODE_SEQ_ID,e.matTaxCodeSelectedData=a,S.countryCode=a.matTaxCode,S.taxCodeSeqID=a.taxCodeSeqId,e.taxApplicableSeqId=a.taxCodeSeqId,null!=S.countryCode&&""!==S.countryCode?S.TaxDataFromMasterViewMode=!0:S.TaxDataFromMasterViewMode=!1,e.saleTaxList=[],e.IPsaleTaxList=[];for(var i=0;i<c.length;i++)c[i].taxType=angular.copy(c[i].TAX_TYPE),c[i].TAX_TYPE=void 0,c[i].TAX_PERCENTAGE=angular.copy(c[i].TAX_VALUES),c[i].TAX_VALUES=void 0,2==c[i].taxType?e.saleTaxList.push(c[i]):4==c[i].taxType&&e.IPsaleTaxList.push(c[i])}})}}}m.changeLanguage(v),e.init=function(){delete u.ngModelOptions.timezone,S.servMasterObj={serDesign:1,serAppl:3,serPriorityRoutine:1,RateEditable:1,billable:1,status:1,faIsDiscountAllowed:1},S.issave=!0,S.isupdate=!1,S.isAsap=!1,S.Stat=!1,e.taxObj={},S.primaryService=[],S.departmentList=[],S.billingSubList=[],S.misSubList=[],S.genderList=[],S.facilityList=[],S.specialityList=[],S.departmentListTemp=[],S.disableHisIcon=!0,S.historyData=[],D(),e.saleTaxList=[],e.IPsaleTaxList=[],S.dateFormat=d.uibDateOnly.format,S.effectFromOptions={minDate:new Date}},e.init(),S.clearData=function(){S.issave=!0,S.isupdate=!1,S.servMasterObj={serDesign:1,serAppl:3,serPriorityRoutine:1,RateEditable:1,billable:1,status:1,itemCode:"",itemName:"",primaryServiceGrp:"",speciality:"",dept:"",billingsubGrp:"",misSubGrp:"",genderAppl:"",facility:"",faIsDiscountAllowed:1},S.addFaclist=[],S.isAsap=!1,S.Stat=!1,S.countryCode="",e.matTaxCodeSelectedData="",e.saleTaxList=[],e.IPsaleTaxList=[],e.taxApplicableSeqId=void 0,e.SERV_SEQ_ID=void 0,S.disableHisIcon=!0,S.historyData=[],S.specialityList=[],S.departmentList=[],D()},e.createTaxModal=function(e){r.open("Create Tax Code",{animation:!0,templateUrl:"app/consumer/his17_1/common/serv_mas/create.tax.code.modal.html",size:e,windowClass:"service-masters-styles-main"})},e.searchServModal=function(e){r.open("Search Service Master",{animation:!0,templateUrl:"app/consumer/his17_1/common/serv_mas/search.service.modal.html",size:e,controller:"serviceMastersModalCtrl",windowClass:"service-masters-styles-main"})},S.addFaclist=[],S.changeFac=function(){angular.forEach(S.facilityList,function(e,t){if(e.DESCRIPTION==S.servMasterObj.facility){-1==_.findIndex(S.addFaclist,function(t){return t.CODE==e.CODE})?(S.addFaclist.push(S.facilityList[t]),S.servMasterObj.facility=""):S.servMasterObj.facility=""}})},S.delfaclist=function(e){S.addFaclist.splice(e,1)},e.serviceItemModal=function(e){r.open("Search Service Master",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/serviceMastersNew/sections/service.item.code.modal.html",size:e,windowClass:"service-masters-styles-main",controller:"servMasterSerItemModalCtrl",controllerAs:"sermodalCtrl"}).result.then(function(e){f(e)},function(){$log.info("Modal dismissed at: "+new Date)})},S.getAutoServiceName=function(e){S.getServiceListSearch=[];var t={1:S.getServiceListSearch},a=n.executeQueryURLReset(),i=new Array;return n.prepareParamListWithParam("pPrimaryservice",-999,i),n.prepareParamListWithParam("pSpecialityCode",-999,i),n.prepareParamListWithParam("pDeptCode",-999,i),n.prepareParamListWithParam("pServName",e,i),n.executeQueryInput("SCM_GET_SERVICES_MAPPING_001",i,t,!0,!0,a,"popUp",{}).then(function(e){return S.getServiceListSearch=e[1],S.getServiceListSearch.length>0?S.getServiceListSearch.map(function(e){return e}):[]})},S.selectedservItem=function(e,t,a){f([e])},e.serPriCheckList=[{prioritySeqId:1}],e.serPriCheck=function(t){"A"==t||"S"==t?angular.forEach(e.serPriCheckList,function(a,i){"A"==t&&2==a.prioritySeqId&&e.serPriCheckList.splice(i,1),"S"==t&&3==a.prioritySeqId&&e.serPriCheckList.splice(i,1)}):e.serPriCheckList.push({prioritySeqId:parseInt(t)})},e.taxListValue=function(t){if(t.length>0){var a=[{paramName:"pFacilityId",value:"1"},{paramName:"pTaxCode",value:t+"%"}];return s.getList("GET_PURCHASE_AND_SALES_TAX_VALUES_FORM_MASTER",a).then(function(t){e.taxListVal=[];var a=o.getQryComboList(t);return angular.forEach(a,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"],r={TAX_M_SEQ_ID:i[0].data,TAX_CODE:i[1].data,TAX_NAME:i[2].data,TAX_PERCENTAGE:"TFL.TAX_PERCENTAGE"==i[3].name?i[3].data:i[4].data};e.taxListVal.push(r)}),(e.taxListVal instanceof Array?e.taxListVal:[e.taxListVal]).map(function(e){return e})})}},e.selectOnSuggestedsaletax=function(t){y(e.saleTaxList,t)?a.warning("Warning","Already Exist."):(t.taxType=2,e.saleTaxList.push(t),e.taxObj.outPatientTaxItem="")},e.deletesaleTax=function(t){e.saleTaxList.splice(t,1)},e.selectOnSuggestedIPsaletax=function(t){y(e.IPsaleTaxList,t)?a.warning("Warning","Already Exist."):(t.taxType=4,e.IPsaleTaxList.push(t),e.taxObj.IPTaxItem="")},e.deleteIPsaleTax=function(t){e.IPsaleTaxList.splice(t,1)},S.countryCodeLatestTaxes=function(e){if(e){var t={};return t.code=e,t.matTaxCodeStatus=1,t.matTaxCodeType="1",c.getMatTaxCodeData(t).then(function(t){for(var a=0,i=0;i<t.length;i++)if(t[i].matTaxCode==e){a++;break}if(1==a)return t;var r={matTaxCode:e+" (Add New)"};return t.push(r),t})}},S.materialTaxCodeSelect=function(t){if(t.taxCodeSeqId)e.matTaxCodeSelectedData=t,S.TaxDataFromMasterViewMode=!0,e.saleTaxList=[],e.IPsaleTaxList=[],t.outPatientTaxDetailsArray.length>0&&(e.saleTaxList=t.outPatientTaxDetailsArray),t.inPatientTaxDetailsArray.length>0&&(e.IPsaleTaxList=t.inPatientTaxDetailsArray),S.countryCode=t.matTaxCode,S.taxCodeSeqID=t.taxCodeSeqId,e.taxApplicableSeqId=t.taxCodeSeqId;else{var a=t.matTaxCode.split(" ")[0];S.countryCode="",t.matTaxCode=a,r.open("CREATE SERVICE TAX CODE",{animation:!0,windowClass:"itemGroup",templateUrl:"app/consumer/his17_1/billing/screens/serviceMastersNew/sections/countryCode.create.newMaterialtaxCode.html",controller:"countryCodecreNewMatTaxCodeCtrlr",controllerAs:"contrycnmtc",keyboard:!1,resolve:{data:{rowData:t,mode:"DirectCreateTaxFromAddNewMat"}},backdrop:"static",size:"md"}).result.then(function(t){if(t){var a={};a.code=t.materialTaxCode,a.matTaxCodeStatus=t.gnStatus,a.matTaxCodeType="1",c.getMatTaxCodeData(a).then(function(a){if(a&&a[0]){var i=_.findIndex(a,function(e){return e.matTaxCode==t.materialTaxCode});e.matTaxCodeSelectedData=a[i],e.saleTaxList=[],e.IPsaleTaxList=[],a[i].outPatientTaxDetailsArray.length>0&&(e.saleTaxList=a[i].outPatientTaxDetailsArray),a[i].inPatientTaxDetailsArray.length>0&&(e.IPsaleTaxList=a[i].inPatientTaxDetailsArray),S.countryCode=a[i].matTaxCode,null!=S.countryCode&&""!==S.countryCode?S.TaxDataFromMasterViewMode=!0:S.TaxDataFromMasterViewMode=!1,S.taxCodeSeqID=a[i].taxCodeSeqId,e.taxApplicableSeqId=a[i].taxCodeSeqId}})}})}},S.matTaxCodeChangeMethod=function(){if(e.matTaxCodeSelectedData&&e.matTaxCodeSelectedData.taxCodeSeqId||e.saleTaxList.length>0||e.IPsaleTaxList.length>0){var t={buttonCallBack1:function(){S.TaxDataFromMasterViewMode=!1,e.saleTaxList=[],e.IPsaleTaxList=[],S.countryCode="",S.taxCodeSeqID="",e.matTaxCodeSelectedData="",e.taxApplicableSeqId=""},buttonCallBack2:function(){S.countryCode=e.matTaxCodeSelectedData.matTaxCode}};a.hisAlertMulti("warning","Confirmation","Changing Service Tax Code Will Remove All The Unsaved Taxes. Do You Want To Continue?",{buttonText:"YES",buttonText2:"NO"},t,close)}};var C=function(){return null==S.localTaskBillAtt.T_SCM_M_SERV_BILL_ATTR_SAV&&null==S.localTaskBillAtt.T_SCM_M_SERV_BILL_ATTR_U||(null==e.SERV_SEQ_ID&&null==S.localTaskBillAtt.T_SCM_M_SERV_BILL_ATTR_SAV&&null!=S.localTaskBillAtt.T_SCM_M_SERV_BILL_ATTR_U||null!=e.SERV_SEQ_ID&&null!=S.localTaskBillAtt.T_SCM_M_SERV_BILL_ATTR_SAV&&null==S.localTaskBillAtt.T_SCM_M_SERV_BILL_ATTR_U)};S.serMasterSubmit=function(t){if(null==S.servMasterObj.itemCode||""===S.servMasterObj.itemCode||null==S.servMasterObj.primaryServiceGrp||""===S.servMasterObj.primaryServiceGrp||null==S.servMasterObj.itemName||""===S.servMasterObj.itemName||null==S.servMasterObj.dept||""===S.servMasterObj.dept||null==S.servMasterObj.billingsubGrp||""===S.servMasterObj.billingsubGrp||null==S.servMasterObj.misSubGrp||""===S.servMasterObj.misSubGrp||null==S.servMasterObj.genderAppl||""===S.servMasterObj.genderAppl||0==S.addFaclist.length)a.warning("Warning","Please Fill All Mandatory Field(s).",!1,!1,i.time);else if(null==S.servMasterObj.serviceCost||""===S.servMasterObj.serviceCost||null!=S.servMasterObj.effectFrom&&""!==S.servMasterObj.effectFrom)if(null==S.servMasterObj.effectFrom||""===S.servMasterObj.effectFrom||null!=S.servMasterObj.serviceCost&&""!==S.servMasterObj.serviceCost){var r=[];S.addFaclist.length>0&&angular.forEach(S.addFaclist,function(e,t){let a={code:e.CODE};r.push(a)});var n=[];3==S.servMasterObj.serAppl&&n.push({"@class":"com.napier.core.scm.master.vo.ServiceBillingAttributeAppFlowVo",generalMaster:{"@class":"com.napier.core.service.vo.masters.GeneralMaster",code:1,description:"IP"}},{"@class":"com.napier.core.scm.master.vo.ServiceBillingAttributeAppFlowVo",generalMaster:{"@class":"com.napier.core.service.vo.masters.GeneralMaster",code:2,description:"OP"}}),1!=S.servMasterObj.serAppl&&2!=S.servMasterObj.serAppl||n.push({"@class":"com.napier.core.scm.master.vo.ServiceBillingAttributeAppFlowVo",generalMaster:{"@class":"com.napier.core.service.vo.masters.GeneralMaster",code:S.servMasterObj.serAppl,description:1==S.servMasterObj.serAppl?"IP":"OP"}});var s=[];e.saleTaxList.length>0&&angular.forEach(e.saleTaxList,function(e,t){s.push({taxMasterSeqId:e.TAX_M_SEQ_ID,taxType:2,taxPercentage:e.TAX_PERCENTAGE})}),e.IPsaleTaxList.length>0&&angular.forEach(e.IPsaleTaxList,function(e,t){s.push({taxMasterSeqId:e.TAX_M_SEQ_ID,taxType:4,taxPercentage:e.TAX_PERCENTAGE})}),S.saveObj={"@class":"com.napier.core.scm.master.vo.ServiceListVo",serviceList:[{"com.napier.core.scm.master.vo.ServiceVo":[{facilityMasterList:[{"com.napier.core.service.vo.masters.FacilityMaster":r}],servTaxApplicableLinkVo:C()?void 0:0==s.length&&"save"==t?[]:0==s.length?[]:[{"com.napier.core.scm.master.vo.ServiceTaxApplicableLinkVo":[{taxApplicableSeqId:null==e.taxApplicableSeqId||""===e.taxApplicableSeqId?0:e.taxApplicableSeqId,serviceTaxApplicableLinkDtVosList:[{"com.napier.core.scm.master.vo.ServiceTaxApplicableLinkDtVo":s}]}]}],servCode:S.servMasterObj.itemCode,servName:S.servMasterObj.itemName,secServTypeCode:S.servMasterObj.primaryServiceGrp,gnServDesign:C()?void 0:parseInt(S.servMasterObj.serDesign),gnTranStatus:S.servMasterObj.status,packageType:C()?void 0:parseInt(S.servMasterObj.serAppl),servHisSeqId:S.servMasterObj.servHisSeqId,servCost:null!=S.servMasterObj.serviceCost&&null!=S.servMasterObj.serviceCost&&""!==S.servMasterObj.serviceCost?parseFloat(S.servMasterObj.serviceCost):void 0,effectiveFrom:null!=S.servMasterObj.serviceCost&&null!=S.servMasterObj.serviceCost&&""!==S.servMasterObj.serviceCost&&null!=S.servMasterObj.effectFrom&&null!=S.servMasterObj.effectFrom&&""!==S.servMasterObj.effectFrom?p("date")(S.servMasterObj.effectFrom,"yyyy-MM-dd")+" "+p("date")(new Date,"HH:mm:ss.s"):void 0,servPriorityLinkVo:[{"com.napier.core.scm.master.vo.ServicePriorityLinkVo":C()?void 0:e.serPriCheckList}],gender:S.servMasterObj.genderAppl,subBrptcSeqId:S.servMasterObj.billingsubGrp,misSubGrpSeqId:S.servMasterObj.misSubGrp,atomicDetailsVo:{scmMasterServiceDeptSpeclVoList:[{"com.napier.core.scm.master.vo.ServiceDepartmentSpecailityLinkVo":{departmentMaster:{code:S.servMasterObj.dept},specialityCode:[{"com.napier.core.service.vo.masters.SpecialityMaster":{code:null==S.servMasterObj.speciality||null==S.servMasterObj.speciality||""===S.servMasterObj.speciality?void 0:S.servMasterObj.speciality}}]}}]},scmMasterServBillingAttrVo:C()?void 0:{faIsRateEditable:S.servMasterObj.RateEditable,faIsBillable:S.servMasterObj.billable,faIsTaxable:0==s.length?2:1,aaEffectiveOption:2,faIsDiscountAllowed:parseInt(S.servMasterObj.faIsDiscountAllowed),scmMasterServBAAppFlowVoList:[{"com.napier.core.scmmaster.vo.ServiceBillingAttributeAppFlowVo":n}]}}]}]},"update"==t&&e.SERV_SEQ_ID&&(S.saveObj.serviceList[0]["com.napier.core.scm.master.vo.ServiceVo"][0].servSeqId=e.SERV_SEQ_ID,S.saveObj.serviceList[0]["com.napier.core.scm.master.vo.ServiceVo"][0].servTaxSeqid=C()?void 0:null==e.taxApplicableSeqId||""===e.taxApplicableSeqId?void 0:e.taxApplicableSeqId),l.saveServiceMastersData(S.saveObj,t).then(function(e){var i;"save"==t&&((i=e.data.HITService.message)&&i.errorCode?a.failure("FAILED",i.errorMessage):i.servSeqId||null!=i[0]&&null!=i[0]["com.napier.core.scm.master.vo.ServiceVo"]&&i[0]["com.napier.core.scm.master.vo.ServiceVo"].servSeqId?(S.clearData(),a.success("SUCCESS","Saved Successfully")):i.dupCheck||null!=i[0]&&null!=i[0]["com.napier.core.scm.master.vo.ServiceVo"]&&i[0]["com.napier.core.scm.master.vo.ServiceVo"].dupCheck?a.failure("FAILED","The Service Code And Name Already Exists"):a.failure("FAILED"," Save Failed"));"update"==t&&((i=e.data.HITService.message)&&i.errorCode?a.failure("FAILED",i.errorMessage):i?(S.clearData(),a.success("SUCCESS","Updated Successfully")):a.failure("FAILED"," Update Failed"))})}else a.warning("Warning","Please Fill Service Cost.",!1,!1,i.time);else a.warning("Warning","Please Fill Effective From.",!1,!1,i.time)},S.serviceCostHistory=function(){if(null!=e.SERV_SEQ_ID)r.open("Service Cost History",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/serviceMastersNew/sections/service.cost.history.html",size:"md",windowClass:"service-masters-styles-main",controller:"serviceCostHistoryCtrl",controllerAs:"sch",keyboard:!1,resolve:{data:{gridData:S.historyData}},backdrop:"static"})},S.changePrimaryGroup=function(e){if(S.departmentList=[],S.specialityList=[],S.servMasterObj.primaryServiceGrp){let e={1:S.departmentList=[]},t=n.executeQueryURLReset(),a=new Array;n.prepareParamListWithParam("pServSeqId",S.servMasterObj.primaryServiceGrp,a),n.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,a),n.prepareParamListWithParam("pFactilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,a),n.executeQueryInput("LBMAQS054_NEW",a,e,!0,!0,t,"popUp",{})}},S.OnChangeDept=function(e){if(S.specialityList=[],S.servMasterObj.dept){S.specilityMap={1:S.specialityList=[]};var t=n.executeQueryURLReset(),a=new Array;n.prepareParamListWithParam("PDept_Code",S.servMasterObj.dept,a),n.prepareParamListWithParam("pPracticeid",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,a),n.executeQueryInput("GET_DEPT_SPECIALITY_SERCH_NEW",a,S.specilityMap,!0,!0,t,"popUp",{})}}}e.$inject=["$scope","RoleTaskService","hisAlertService","hisAlertConstants","hisModalService","QueryService","servMastersService","dropdownQueryService","otComService","materialTaxService","hisCalDefConstant","$filter","uibDatepickerConfig","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("serMasterCntrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C,I){g.loadModule("billing");var A=v.getLanguageToSet();g.changeLanguage(A);var E=this;E.alertObj={},f.loadAlerts(A).then(function(e){E.alertObj=e,E.alertData={buttonText:E.alertObj.ok},E.alertFunction={buttonCallBack1:function(){}},E.close={buttonClose:function(){}}}),E.oneAtATime=!1,l.test=!1,E.disableButton=!0,l.status={},l.status1={},l.totalService=0;var h=0;l.billRenderServiceOnlyFlag="T",C.getDynamicConfig("GET_HIS_CONFIG_VALUE","IS_BILL_RENDERED_SERVICE_ONLY").then(function(e){var t=e[1];l.billRenderServiceOnlyFlag=t[0].VALUE}),E.roleValue=I.rolePermission("T_SCM_SERV_POST"),"patObj"!=D.patObj&&""!==D.patObj&&(E.visitType=D.visitType,E.patientInput=JSON.parse(D.patObj),E.serviceType=0),E.gridOptions=angular.copy(e),u.getColumnDefAll(E.gridOptions,o,E),E.gridOptions.onRegisterApi=function(e){E.grid=e,e.selection.on.rowSelectionChanged(l,function(e){e.isSelected;E.selectBatchSelection=[],E.countRowsRadio=E.grid.selection.getSelectedRows().length,E.countRowsRadio>0?(E.selectService=E.grid.selection.getSelectedRows(),E.disableButton=!1):(E.selectService=null,E.disableButton=!0)}),e.selection.on.rowSelectionChangedBatch(l,function(e){E.selectService=[],E.selectBatchSelection=E.grid.selection.getSelectedRows(),null!=E.selectBatchSelection&&null!=E.selectBatchSelection&&E.selectBatchSelection.length})},E.CD=angular.copy(t),E.fromDateOptions={maxDate:new Date},E.format=angular.copy(t.uibDateOnly.format),E.toDateOptions={minDate:E.frmDate},E.changeToDate=function(e){E.toDate=new Date(e),E.toDateOptions.minDate=e},E.options=!1,E.serviceStatus=[],E.servicePriority=[],E.folio=[],E.multipleComboDataForList={1:E.serviceStatus,2:E.servicePriority};var b=a.executeQueryURLReset();E.serviceStatusList=new Array,a.prepareParamList(1,"45002",E.serviceStatusList),a.executeQueryInput("TRN003",E.serviceStatusList,E.multipleComboDataForList,!0,!1,b,"popUp"),E.servicePriorityList=new Array,a.executeQueryInput("PRIORITY_TYPE",E.servicePriorityList,E.multipleComboDataForList,!0,!0,b,"popUp"),E.patientSearch=function(e,t){if(e.length>1)return n.paitentAutoSearchWithStatus(e,t);E.showErrors=!1},E.changeFiled=function(e){E.clear()},E.newServicePost=function(){if(null==E.patientInput||null==E.patientInput||null==E.patientInput.mrNo||null==E.patientInput.regSeqId){l.svp.alertObj.plzSlctPatnt;S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.plzSlctPatnt,E.alertData,E.alertFunction,E.close)}else{var e={1:[]},t=a.executeQueryURLReset(),i=new Array;a.prepareParamListWithParam("pAdmSeqId",E.adm,i),a.prepareParamListWithParam("pIsActive",1,i),a.executeQueryInput("GET_FOLIO_NO",i,e,!0,!0,t,"popUp").then(function(e){if(0==e[1].length)S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.noActiveFolioAvil,E.alertData,E.alertFunction,E.close);else{var t=angular.copy(E.patientInput);angular.extend(t,{visitType:E.visitType}),m.go("index.billingSub.servicePostingNew",{patObj:JSON.stringify(t)})}})}},E.cnclServicePost=function(){if(null==E.patientInput||null==E.patientInput||null==E.patientInput.mrNo||null==E.patientInput.regSeqId)S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.plzSlctPatnt,E.alertData,E.alertFunction,E.close);else if(null!=E.selectService||null!=E.selectBatchSelection){for(var e=null!=E.selectBatchSelection&&null!=E.selectBatchSelection&&E.selectBatchSelection.length>0?E.selectBatchSelection:E.selectService,t=!1,a=0;a<e.length;a++){if("RG"!=e[a].packApplyTypeDesc)return void S.warning(E.alertObj.alertTypeWarn,E.alertObj.plzSlctSrv);if("Planned"!=e[a].servicePostingType){if(t=!1,"Rendered"==e[a].servicePostingType&&10==e[a].moduleId&&(t=!0),"Rendered"==e[a].servicePostingType&&10!=e[a].moduleId){S.hisAlertMulti("warning",E.alertObj.alertTypeWarn,"Please Select Only Planned/Manual Posted Services as Rendered From SCM",E.alertData,E.alertFunction,E.close);break}if("Cancelled"==e[a].servicePostingType){S.hisAlertMulti("warning",E.alertObj.alertTypeWarn,E.alertObj.servAlrCncl,E.alertData,E.alertFunction,E.close);break}}else a==e.length-1&&(t=!0)}if(1==t){var i={buttonText:E.alertObj.no,buttonText2:E.alertObj.yes},r={buttonCallBack1:function(){},buttonCallBack2:function(){m.go("index.billingSub.servicePostingCancel",{patObj:JSON.stringify(E.patientInput),gridObj:JSON.stringify(e),flag:!0,flag1:!1,visitType:E.visitType})}};S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.doUWntCnclSlctSrv,i,r,!1)}}},E.cancelPackage=function(){if(null==E.patientInput||null==E.patientInput||null==E.patientInput.mrNo||null==E.patientInput.regSeqId)S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.plzSlctPatnt,E.alertData,E.alertFunction,E.close);else if(null!=E.selectService||null!=E.selectBatchSelection){for(var e=null!=E.selectBatchSelection&&null!=E.selectBatchSelection&&E.selectBatchSelection.length>0?E.selectBatchSelection:E.selectService,t=!1,a=0;a<e.length;a++){if("PM"!=e[a].packApplyTypeDesc)return void S.warning(E.alertObj.alertTypeWarn,E.alertObj.plzSlctPack);if("Planned"!=e[a].servicePostingType&&"Rendered"!=e[a].servicePostingType){t=!1,"Cancelled"==e[a].servicePostingType&&S.hisAlertMulti("warning",E.alertObj.alertTypeWarn,E.alertObj.packAlrCncl,E.alertData,E.alertFunction,E.close);break}a==e.length-1&&(t=!0)}if(1==t){var i={buttonText:E.alertObj.no,buttonText2:E.alertObj.yes},r={buttonCallBack1:function(){},buttonCallBack2:function(){m.go("index.billingSub.servicePostingPackageCancel",{patObj:JSON.stringify(E.patientInput),gridObj:JSON.stringify(e),visitType:E.visitType})}};S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.slctPackAlrRendStilPrcCncl,i,r,!1)}}},E.viewServicePost=function(){if(null==E.patientInput||null==E.patientInput||null==E.patientInput.mrNo||null==E.patientInput.regSeqId)S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.plzSlctPatnt,E.alertData,E.alertFunction,E.close);else if(null!=E.selectService||null!=E.selectBatchSelection){var e=null!=E.selectBatchSelection&&null!=E.selectBatchSelection&&E.selectBatchSelection.length>0?E.selectBatchSelection:E.selectService;m.go("index.billingSub.servicePostingCancel",{patObj:JSON.stringify(E.patientInput),gridObj:JSON.stringify(e),flag:!1,flag1:!0,visitType:E.visitType})}else S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.plzSlctOneRecrd,E.alertData,E.alertFunction,E.close)},E.billPost=function(){if(null==E.patientInput||null==E.patientInput||null==E.patientInput.mrNo||null==E.patientInput.regSeqId)S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.plzSlctPatnt,E.alertData,E.alertFunction,E.close);else{if("F"==l.billRenderServiceOnlyFlag||i.getVerifyValid(E.gridOptions))if(E.folioDtls){var e={patientInput:E.patientInput,serviceType:E.serviceType,frmDate:E.frmDate,toDate:E.toDate,servPriority:E.servPriority,servStatus:E.servStatus,visitType:E.visitType,folioDtls:E.folioDtls,ammountValue:E.authLimitValue};m.go("index.billingSub.serviceBillPosting",{allObj:JSON.stringify(e),gridObj:JSON.stringify(E.selectService),visitType:E.visitType})}else S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.noActiveFolioAvil,E.alertData,E.alertFunction,E.close)}},E.servPostSheet=function(){if(null==E.patientInput||null==E.patientInput||null==E.patientInput.mrNo||null==E.patientInput.regSeqId)S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.plzSlctPatnt,E.alertData,E.alertFunction,E.close);else{var e={frmDate:E.frmDate,toDate:E.toDate};m.go("index.billingSub.servicePostSheet",{patObj:JSON.stringify(E.patientInput),gridObj:JSON.stringify(E.selectService),visitType:E.visitType,folio:JSON.stringify(E.folioDtls),folioList:JSON.stringify(E.folio),allObj:JSON.stringify(e)})}},l.selectMatch=function(e,t,i,n,s){var o;E.patientInput=e,E.patientInputIP=e,E.showErrors=!1,E.showErrorsIP=!1,E.creditLimit=0,E.folioAll=!1,null!=e.admissionDate&&null!=e.admissionDate.$?(E.frmDate=new Date(e.admissionDate.$),E.fromDateOptions.minDate=new Date(e.admissionDate.$)):(E.frmDate=new Date,null!=e.regDate&&null!=e.regDate.$?(E.fromDateOptions.minDate=new Date(e.regDate.$),E.frmDate=new Date):(E.frmDate=new Date,E.fromDateOptions.minDate=new Date("0001-01-25T16:02:32.000000+0530"))),null==e.dischargedDate||null==e.dischargedDate.$?(E.dischargedStatus="Not Discharged",E.toDate=new Date,E.toDateOptions.maxDate=new Date,E.dischargeDate=null):(E.dischargedStatus="Discharged",E.toDate=new Date(e.dischargedDate.$),E.toDateOptions.maxDate=new Date(e.dischargedDate.$),E.dischargeDate=r("date")(e.dischargedDate.$,"dd/MM/yyyy")),E.patientDepostis=[],E.multipleComboDataForListD={1:E.patientDepostis};var c=a.executeQueryURLReset();if(E.patientDepostisList=new Array,a.prepareParamListWithParam("pPatSeqId",e.regSeqId,E.patientDepostisList),a.executeQueryInput("AVILABLE_PATIENT_DEPOSITS",E.patientDepostisList,E.multipleComboDataForListD,!0,!0,c,"popUp").then(function(e){null!=e[1]&&null!=e[1]&&null!=e[1][0]&&null!=e[1][0].gQDataName?E.patientDepostisValue=e[1][0].gQDataName:E.patientDepostisValue=0}),null!=e.admissionSeqid){var d=[];E.clearanceStatus=void 0;var p={1:d},u=a.executeQueryURLReset(),m=[];a.prepareParamListWithParam("pAdmnSeqId",e.admissionSeqid,m),a.prepareParamListWithParam("pUserSeqId",angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,m),a.executeQueryInput("IS_CLEARANCE_GIVEN_STATUS_FOR_BILLING",m,p,!0,!0,u,"popUp",{}).then(function(e){if(null!=d[0]){for(var t=0;t<d.length;t++)if(E.clearanceStatus=d[t].IS_CLEARANCE_GIVEN,"N"==E.clearanceStatus)return}else E.clearanceStatus="N"}),E.adm=e.admissionSeqid,o=e.admissionSeqid,E.billDtls=[],E.multipleComboDataForList2={1:E.billDtls};var g=a.executeQueryURLReset();E.billDtlsList=new Array,a.prepareParamListWithParam("pAdmSeqID",e.admissionSeqid,E.billDtlsList),a.prepareParamListWithParam("pCurrDate",r("date")(new Date,"yyyy-MM-dd"),E.billDtlsList),a.executeQueryInput("BL_M_COMMON_001",E.billDtlsList,E.multipleComboDataForList2,!0,!0,g,"popUp",E.gridOptions).then(function(e){var t=e[1][0];if(null!=t&&null!=t.ACC_SEQ_ID){E.ammountValue=[],E.multipleComboDataForList3={1:E.ammountValue};var i=a.executeQueryURLReset();E.ammountValueList=new Array,a.prepareParamListWithParam("pAccSeqId",t.ACC_SEQ_ID,E.ammountValueList),a.prepareParamListWithParam("pSubAccSeqId",t.SUB_ACC_SEQ_ID,E.ammountValueList),a.prepareParamListWithParam("pPayerAccSeqId",t.PAYER_ACC_SEQ_ID,E.ammountValueList),a.executeQueryInput("GET_PRE_AUTH_TOTALAMT_DETAILS",E.ammountValueList,E.multipleComboDataForList3,!0,!0,i,"popUp",E.gridOptions).then(function(e){}),E.authLimit=[],E.multipleComboDataForListL={1:E.authLimit};var r=a.executeQueryURLReset();E.authLimitList=new Array,a.prepareParamListWithParam("pSubAccSeqId",t.SUB_ACC_SEQ_ID,E.authLimitList),a.executeQueryInput("PRE_AUTH_LIMIT_NEW",E.authLimitList,E.multipleComboDataForListL,!0,!0,r,"popUp").then(function(e){null!=e[1]&&null!=e[1]&&null!=e[1][0]&&null!=e[1][0].gQDataCode?E.authLimitValue=e[1][0].gQDataCode:E.authLimitValue=0})}}),E.folio=[],E.multipleComboDataForList1={1:E.folio};var S=a.executeQueryURLReset();E.servicePriorityList=new Array,a.prepareParamListWithParam("pAdmSeqId",o,E.servicePriorityList),a.executeQueryInput("GET_FOLIO_NO",E.servicePriorityList,E.multipleComboDataForList1,!0,!0,S,"popUp").then(function(e){E.folioDtls=E.folio[0],s&&(E.searchResult(),"patObj"==D.patObj?l.status.open||(l.status.open=!0):0==l.status.open?l.status.open=!0:l.status.open=!1,l.status1.open=!0),E.folioAll=!0})}else o=e.regDate.$,E.folioAll=!1},E.searchResult=function(){"patObj"==D.patObj?l.status.open||(l.status.open=!0):0==l.status.open&&(l.status.open=!0),l.status1.open=!0,null!=E.patientInput&&null!=E.patientInput.mrNo&&null!=E.patientInput.mrNo?("1"==E.visitType||(E.folio=[],E.folioAll=!1),s.getPatientBanner(E.patientInput,E.visitType).then(function(e){l.patientGlobalDtls=e,l.patientGlobalDtls.userPermision=12,null!=l.patientGlobalDtls.mrNo?l.patientShow=!0:l.patientShow=!1}),c.patientBannerDetail(E.patientInput.regSeqId).then(function(e){l.patientBannerDetails=e,l.patientRecordsDetail=l.patientBannerDetails.patientRecordsDetail}),y.getDocFile(E.patientInput.regSeqId,l),i.getServicePosting(E).then(function(e){if(u.getColumnDefAll(E.gridOptions,o),E.serviceSlct="1",h=0,E.hideGrand=!1,E.hideGrandFiled=!1,l.remarks=!1,E.patientInput.baseRate=E.patientInput.serviceAmount=E.patientInput.effectiveRate=E.patientInput.payerSurcharge=E.patientInput.hospitalSh=E.patientInput.docShare=0,E.patientInput.discounts=0,E.patientInput.nonCharge=0,E.patientInput.docSurcharge=0,E.patientInput.taxTotal=0,E.gridOptions.data=[],E.patientInput.totalService=0,null==e.data.HITService.message.servicePostingDetailsList){var t=l.svp.alertObj.noRcrdFound;S.hisAlertMulti("information",E.alertObj.alertTypeInfo,t,E.alertData,E.alertFunction,E.close)}else{var a=[],i=e.data.HITService.message.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"];i instanceof Array?a=i:a.push(i);p.uniqueCount(a,l,"serviceVo.servCode");for(var r=0;r<a.length;r++){a[r].servCode=a[r].serviceVo.servCode,a[r].servName=a[r].serviceVo.servName,a[r].apliTariffdDesc=a[r].apliTariffdDesc;for(var n=0;n<E.serviceStatus.length;n++)E.serviceStatus[n].gQDataCode==a[r].servicePostingType&&(a[r].servicePostingType=E.serviceStatus[n].gQDataName);for(var s=0;s<E.servicePriority.length;s++)null!=a[r].priority&&null!=a[r].priority&&E.servicePriority[s].gQDataCode==a[r].priority&&(a[r].priority=E.servicePriority[s].gQDataName);null!=a[r].baseRate&&null!=a[r].baseRate&&"Cancelled"!=a[r].servicePostingType&&(E.patientInput.baseRate=E.patientInput.baseRate+a[r].baseRate),null!=a[r].serviceRate&&null!=a[r].serviceRate&&"Cancelled"!=a[r].servicePostingType&&(E.patientInput.serviceAmount=E.patientInput.serviceAmount+a[r].serviceRate),null!=a[r].discountAmt&&null!=a[r].discountAmt&&(null!=a[r].quantity&&null!=a[r].quantity?"Cancelled"!=a[r].servicePostingType&&(E.patientInput.discounts=E.patientInput.discounts+a[r].discountAmt):(a[r].discountAmt=0,"Cancelled"!=a[r].servicePostingType&&(E.patientInput.discounts=E.patientInput.discounts+a[r].discountAmt))),null!=a[r].taxAmt&&null!=a[r].taxAmt?"Cancelled"!=a[r].servicePostingType&&(E.patientInput.taxTotal=E.patientInput.taxTotal+a[r].taxAmt):a[r].taxAmt=0,null!=a[r].actualRate&&null!=a[r].actualRate&&(null!=a[r].nonChargableAmt&&null!=a[r].nonChargableAmt?"Cancelled"!=a[r].servicePostingType&&(E.patientInput.nonCharge=E.patientInput.nonCharge+a[r].nonChargableAmt):a[r].nonChargableAmt=0),null!=a[r].surchargeOnDoctNoCharge&&null!=a[r].surchargeOnDoctNoCharge?"Cancelled"!=a[r].servicePostingType&&(E.patientInput.payerSurcharge=E.patientInput.payerSurcharge+a[r].surchargeOnDoctNoCharge):a[r].surchargeOnDoctNoCharg=0,null!=a[r].surcharge&&null!=a[r].surcharge?"Cancelled"!=a[r].servicePostingType&&(E.patientInput.docSurcharge=E.patientInput.docSurcharge+a[r].surcharge):a[r].surcharge=0,null!=a[r].hospitalShare&&null!=a[r].hospitalShare?"Cancelled"!=a[r].servicePostingType&&(E.patientInput.hospitalSh=E.patientInput.hospitalSh+a[r].hospitalShare):a[r].hospitalShare=0,null!=a[r].doctorShare&&null!=a[r].doctorShare?"Cancelled"!=a[r].servicePostingType&&(E.patientInput.docShare=E.patientInput.docShare+a[r].doctorShare):a[r].doctorShare=0,null==a[r].surchargeOnDoctNoCharge&&(a[r].surchargeOnDoctNoCharge=0),isNaN(a[r].actualRate)?a[r].actualRate=0:a[r].actualRate=a[r].actualRate,isNaN(a[r].serviceRate)?a[r].serviceRate=0:a[r].serviceRate=a[r].serviceRate,a[r].actualRatefixed=angular.copy(a[r].actualRate),"1"==E.visitType?(a[r].actualRate=a[r].chargeableAmt,null!=a[r].taxAmt&&a[r].taxAmt>0&&(3==a[r].packApplyType||4==a[r].packApplyType)&&(a[r].actualRate=Math.round(100*(a[r].actualRate+a[r].taxAmt))/100),"Cancelled"!=a[r].servicePostingType&&(E.patientInput.effectiveRate=E.patientInput.effectiveRate+a[r].actualRate)):(a[r].actualRate=a[r].chargeableAmt,null!=a[r].taxAmt&&a[r].taxAmt>0&&(a[r].actualRate=Math.round(100*(a[r].actualRate+a[r].taxAmt))/100),"Cancelled"!=a[r].servicePostingType&&(E.patientInput.effectiveRate=E.patientInput.effectiveRate+a[r].actualRate)),E.gridOptions.data.push(a[r]),E.patientInput.totalService=E.patientInput.totalService+E.gridOptions.data[r].quantity}E.allData=angular.copy(E.gridOptions)}})):S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.patientIdSlct,E.alertData,E.alertFunction,E.close)},E.getAllDataGrid=function(e){"1"!=e||!h&&null!=h||(u.getColumnDefAll(E.gridOptions,o),E.searchResult(),h=0)},E.getUniqueDataGrid=function(e){"2"!=e||h&&null!=h||(p.getUniqueData(E.gridOptions,E.allData),p.getColumnDefUniqueData(E.gridOptions,o),h=1)},E.clear=function(){h=null,E.patientInput={},E.patientInput.mrNo=null,E.patientInputIP=null,E.patientDepostisValue=E.authLimitValue=E.dischargedStatus=E.dischargeDate=null,E.creditLimit=null,E.frmDate="",E.toDate="",E.gridOptions.data=[],E.serviceType="0",E.servStatus=[],E.servPriority=[],E.folioDtls=[],E.hideGrand=!1,E.hideGrandFiled=!1,l.remarks=!1,l.patientShow=!1,l.displayGraph=!1,l.displaySelected=!1,l.displaySelected2=!1,E.folio=[],E.folioAll=!1},E.showBillWiseData=function(){if(h=null,u.billWiseColDef(E.gridOptions,o),E.gridOptions.data=[],E.patientInput.serviceAmount=0,E.patientInput.discounts=0,E.patientInput.payerSurcharge=0,E.billWise instanceof Array){E.gridOptions.data=E.billWise;for(var e=0;e<E.gridOptions.data.length;e++)E.patientInput.serviceAmount=E.patientInput.serviceAmount+E.gridOptions.data[e].chargeableAmt,E.patientInput.discounts=E.patientInput.discounts+E.gridOptions.data[e].discountAmt,E.patientInput.payerSurcharge=E.patientInput.payerSurcharge+E.gridOptions.data[e].surcharge}else E.gridOptions.data.push(E.billWise),E.patientInput.serviceAmount=E.patientInput.serviceAmount+E.gridOptions.data[0].chargeableAmt,E.patientInput.discounts=E.patientInput.discounts+E.gridOptions.data[0].discountAmt,E.patientInput.payerSurcharge=E.patientInput.payerSurcharge+E.gridOptions.data[0].surcharge},E.showServiceWiseData=function(){if(h=null,u.serviceWiseColDef(E.gridOptions,o),E.gridOptions.data=[],E.patientInput.serviceAmount=0,E.patientInput.discounts=0,E.patientInput.payerSurcharge=0,E.serviceWise instanceof Array){E.gridOptions.data=E.serviceWise;for(var e=0;e<E.gridOptions.data.length;e++)E.patientInput.serviceAmount=E.patientInput.serviceAmount+E.gridOptions.data[e].chargeableAmt,E.patientInput.discounts=E.patientInput.discounts+E.gridOptions.data[e].discountAmt,E.patientInput.payerSurcharge=E.patientInput.payerSurcharge+E.gridOptions.data[e].surcharge}else E.gridOptions.data.push(E.serviceWise),E.patientInput.serviceAmount=E.patientInput.serviceAmount+E.gridOptions.data[0].chargeableAmt,E.patientInput.discounts=E.patientInput.discounts+E.gridOptions.data[0].discountAmt,E.patientInput.payerSurcharge=E.patientInput.payerSurcharge+E.gridOptions.data[0].surcharge},E.serviceGraph=function(e){var t=[];e instanceof Array?t=e:t.push(e);var a=[];e instanceof Array?a=e:a.push(e);var i=[];l.totalService=t.length;for(var r=0;r<t.length;r++)for(var n=0,s=0;s<a.length;s++)if(t[r].primaryService==a[s].primaryService?(n+=1,1):0,s==a.length-1)if(n>1){for(var o=!0,c=0;c<i.length;c++)i[c].name==t[r].primaryService&&(i[c].name=t[r].primaryService,t[r].chargeableAmt!=i[c].data[0]&&(i[c].data=[t[r].chargeableAmt+i[c].data[0]]),o=!1),c==i.length-1&&o&&i.push({name:t[r].primaryService,data:[t[r].chargeableAmt],pointWidth:20});0==i.length&&o&&i.push({name:t[r].primaryService,data:[t[r].chargeableAmt],pointWidth:20})}else i.push({name:t[r].primaryService,data:[t[r].chargeableAmt],pointWidth:20});l.uniqueService=i.length;var d=0;if(i.length>0)for(var p=0;p<i.length;p++)d+=i[p].data[0],p==i.length-1&&(d+=i[p].data[0]);Highcharts.chart("container",{chart:{type:"column"},title:{text:""},xAxis:{categories:["Service Group"]},yAxis:{allowDecimals:!1,min:0,max:d,title:{text:""}},tooltip:{},plotOptions:{column:{cursor:"pointer",dataLabels:{rotation:-90,y:-5,align:"left",enabled:!0,formatter:function(){return this.series.name.split(" ")[0]},color:Highcharts.theme&&Highcharts.theme.dataLabelsColor||"white"},pointPadding:.2,borderWidth:0,events:{click:function(){E.showServiceWiseData()}}}},series:i})},E.billGraph=function(e){var t=[];e instanceof Array?t=e:t.push(e);var a=[],i=[],r=0;e instanceof Array?i=e:i.push(e);for(var n=0;n<t.length;n++){for(var l=0;l<i.length;l++)t[n].billingGrpCodeDesc==i[l].billingGrpCodeDesc&&1,l==i.length-1&&(r+=t[n].chargeableAmt,a.push({name:t[n].billingGrpCodeDesc,data:[t[n].chargeableAmt],pointWidth:20,pointHeight:20}));n==t.length-1&&(r+=t[n].chargeableAmt)}Highcharts.chart("billGroup",{chart:{type:"column"},title:{text:""},xAxis:{categories:["Bill Group"]},yAxis:{allowDecimals:!1,min:0,max:r,title:{text:""}},tooltip:{},plotOptions:{column:{pointPadding:.2,borderWidth:0,dataLabels:{enabled:!0,rotation:-90,y:-2,align:"left",formatter:function(){return this.series.name.split(" ")[0]},color:Highcharts.theme&&Highcharts.theme.dataLabelsColor||"white"},events:{click:function(){E.showBillWiseData()}}}},series:a})},"patObj"!=D.patObj&&""!==D.patObj&&l.selectMatch(E.patientInput,!1,!1,!1,!0),E.updateServicePost=function(){if(null==E.patientInput||null==E.patientInput||null==E.patientInput.mrNo||null==E.patientInput.regSeqId)S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.plzSlctPatnt,E.alertData,E.alertFunction,E.close);else{var e={1:[]},t=a.executeQueryURLReset(),i=new Array;a.prepareParamListWithParam("pAdmSeqId",E.adm,i),a.prepareParamListWithParam("pIsActive",1,i),a.executeQueryInput("GET_FOLIO_NO",i,e,!0,!0,t,"popUp").then(function(e){if(0==e[1].length)S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.noActiveFolioAvil,E.alertData,E.alertFunction,E.close);else if(null!=E.selectService||null!=E.selectBatchSelection){var t=null!=E.selectBatchSelection&&null!=E.selectBatchSelection&&E.selectBatchSelection.length>0?E.selectBatchSelection:E.selectService;E.cancellCount=0;for(var a=0;a<t.length;a++){if(t[a].tarrifCategory=l.patientGlobalDtls.tarrifCategory,t[a].actualRate=t[a].actualRatefixed,1==t[a].billStatus)return void S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.bildServCntUpdate,E.alertData,E.alertFunction,E.close);"Cancelled"==t[a].servicePostingType&&(E.cancellCount=1)}if(E.cancellCount==t.length)return void S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.cnclServCntUpdate,E.alertData,E.alertFunction,E.close);if(E.cancellCount>=1)return void S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.plzSlctServCnclRcrd,E.alertData,E.alertFunction,E.close);var i={buttonText:E.alertObj.no,buttonText2:E.alertObj.yes},r={buttonCallBack1:function(){},buttonCallBack2:function(){var e=angular.copy(E.patientInput);angular.extend(e,{visitType:E.visitType}),m.go("index.billingSub.servicePostingNew",{patObj:JSON.stringify(e),gridObj:JSON.stringify(t)})}};S.hisAlertMulti("information",E.alertObj.alertTypeInfo,E.alertObj.doUWntChangeExtSrvDtls,i,r,!1)}else S.hisAlertMulti("warning",E.alertObj.alertTypeWarn,E.alertObj.plzSlctAtlServGrid,E.alertData,E.alertFunction,E.close)})}},E.viewPharmacyDetails=function(e){var t={1:[]},i=a.executeQueryURLReset(),r=new Array;l.patObj={},l.patObj.RG_SEQ_ID=E.patientInput.regSeqId,l.patObj.IPADM_SEQ_ID=E.patientInput.admissionSeqid,l.patObj.RETANABLE_QTY="",l.patObj.ISS_STATUS="",l.patObj.WHERE_FROM="SCM",l.patObj.viewIssue=3,l.patObj.returnStatus=3,l.patObj.RG_INT_MR_NO=E.patientInput.mrNo,l.patObj.patientDetails=E.patientInput,angular.extend(l.patObj.patientDetails,{visitType:E.visitType}),"Pharmacy Issues"===e.entity.isPharmacyService?(a.prepareParamListWithParam("pIssueSequenceId",e.entity.refTranSeqID,r),a.executeQueryInput("IP_ISSUES_STORE_CODE",r,t,!0,!0,i,"popUp").then(function(t){l.patObj.INDT_HD_SEQ_ID=e.entity.refTranSeqID,l.patObj.ENTITY_SEQ_ID=t[1][0].gQDataCode,l.patObj.ENTITY_NAME=t[1][0].gQDataCode,m.go("index.opPharmcyWorklist.ipPharmacyOrderView",{storeObj:angular.toJson(l.patObj),patObj:angular.toJson(l.patObj)}),l.$emit("opw.toggleStatus",{message:!0})})):"Pharmacy Retruns"===e.entity.isPharmacyService&&(a.prepareParamListWithParam("pReturnSequenceId",e.entity.refTranSeqID,r),a.executeQueryInput("IP_RETURNS_STORE_CODE",r,t,!0,!0,i,"popUp").then(function(t){l.patObj.RET_HD_SEQ_ID=e.entity.refTranSeqID,l.patObj.ENTITY_SEQ_ID=t[1][0].gQDataCode,l.patObj.ENTITY_NAME=t[1][0].gQDataCode,m.go("index.opPharmcyWorklist.returnsView",{storeObj:angular.toJson(l.patObj),patObj:angular.toJson(l.patObj)}),l.$emit("opw.toggleStatus",{message:!0})}))},E.editGrid=function(e){for(var t=_.findIndex(E.gridOptions.data,function(t){return t.servicePostingSeqId==e.servicePostingSeqId}),a=0;a<E.gridOptions.data.length;a++)t==a?E.gridOptions.data[t].fillHealth=!0:(E.gridOptions.data[a].servCode=E.gridOptions.data[a].servCode&&E.gridOptions.data[a].servCode.PAYER_ALIAS_CODE?E.gridOptions.data[a].servCode.PAYER_ALIAS_CODE:E.gridOptions.data[a].serviceVo.servCode,E.gridOptions.data[a].fillHealth=!1)},E.getAutoSearchQuery=function(e,t){E.getServiceListSearch=[];var i={1:E.getServiceListSearch},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pServCodeName",e,n),a.prepareParamListWithParam("pPayerSerSeqId",t,n),a.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,n),a.executeQueryInput("PAYER_CODE_NAME_AUTOPOPUP_DETAILS",n,i,!0,!0,r,"popUp",{}).then(function(e){return e[1].length>0?E.getServiceListSearch.map(function(e){return e}):[]})},E.closeGrid=function(e){e.servCode.PAYER_ALIAS_CODE?i.upDateServiceAliasName(e).then(function(t){if(t.data.HITService.message&&t.data.HITService.message.servicePostingSeqId){var a=_.findIndex(E.gridOptions.data,function(t){return t.servicePostingSeqId==e.servicePostingSeqId});E.gridOptions.data[a].servCode=E.gridOptions.data[a].servCode.PAYER_ALIAS_CODE?E.gridOptions.data[a].servCode.PAYER_ALIAS_CODE:E.gridOptions.data[a].servCode,E.gridOptions.data[a].serviceVo&&(E.gridOptions.data[a].serviceVo.servCode=E.gridOptions.data[a].servCode,E.gridOptions.data[a].serviceVo.servName=E.gridOptions.data[a].servName),E.gridOptions.data[a].fillHealth=!1}else if(t.data.HITService.message&&t.data.HITService.message.errorCode)return void S.hisAlertMulti("information",E.alertObj.alertTypeInfo,t.data.HITService.message.errorMessage,E.alertData,E.alertFunction,E.close)}):S.hisAlertMulti("information",E.alertObj.alertTypeInfo,"The entered code has not been captured as a payer code in the contract definition",E.alertData,E.alertFunction,E.close)};var T=sessionStorage.getItem("currentPatIpNum");if(null!=T&&""!=T)try{E.patientInputIP=T,E.patientSearch(E.patientInputIP,"1").then(function(e){e&&e[0]&&(l.selectMatch(e[0],!1,!1,!1,!0),sessionStorage.removeItem("currentPatIpNum"))})}catch(e){}}e.$inject=["servicePostingGridDefinition","hisCalDefConstant","QueryService","GetServicePostingListData","$filter","PatientGlobal","$scope","PatientBannerGlobal","uiGridConstants","PatientBannerBilling","GroupWiseService","UniqueService","GridColDef","$state","hisTranslationsService","hisAlertService","hisTranslationsGlobalLang","$stateParams","GetDocumentCommon","hisGenericAlertService","hisConfigurationService","RoleTaskService"],angular.module("napierContainerUi").controller("servicePostingController",e)}(),function(){"use strict";function e(e,a,i){var r=this;r.gridOptions=angular.copy(a),e.getSummaryListGridData().then(function(e){r.gridOptions.data=angular.copy(e)}),r.actionClicked=function(e){r.genSummaryModal=i.open("COLLECTION SUMMARY",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/summary-list/sections/summary.list.model.html",size:"lg",controller:t,controllerAs:"cs",resolve:{getsummarydata:function(){return e}}})}}function t(e,t,a,i,r,n,l){var s=this;s.rowdata=a,s.enableAccept=!1,"submitted"==s.rowdata.colStatus&&(s.enableAccept=!0),s.colSumGridOptions=angular.copy(i),null!=s.rowdata&&r.getCollectionSummaryData(s.rowdata.summerySeqId).then(function(e){e[0].length>0&&(s.colSumGridOptions.data=angular.copy(e[0])),s.form_data=e[1][0],null!=e[1][0].ACCEPT_REMARKS?s.remarks=e[1][0].ACCEPT_REMARKS:s.remarks=""}),s.submitSummary=function(){r.submitSummaryData(s.rowdata.summerySeqId,s.remarks).then(function(t){l.dismissAll(),n.success("Success","Record Successfully Accepted"),e.reload()})},s.print=function(){angular.element(document.querySelector(".shide")).hide(),angular.element(document.querySelector(".shide1")).hide(),window.print(),angular.element(document.querySelector(".shide")).show(),angular.element(document.querySelector(".shide1")).show()}}e.$inject=["angTranSummaryListControllerService","transSummaryListGridDef","hisModalService"],t.$inject=["$state","hisModalService","getsummarydata","sumcolSummaryGridDef","angTranSummaryListControllerService","hisAlertService","$uibModalStack"],angular.module("napierContainerUi").controller("angTranSummaryListController",e).controller("summaryListcolSumCtrl",t)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){a.loadModule("billing");var S=i.getLanguageToSet();a.changeLanguage(S),r.loadAlerts(S).then(function(t){e.alertObjectRes=t,e.alertData={},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}},function(e){});var v=this;e.loadScroll=function(e){o.hash(e),s()},e.facilityName=[],e.multidropdown={1:e.facilityName};var D=u.executeQueryURLReset();e.facilityNameList=new Array,u.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,e.facilityNameList),u.executeQueryInput("FACILITY_DROPDOWN",e.facilityNameList,e.multidropdown,!0,!0,D,"popUp"),e.roleTask=g.rolePermission("T_BL_M_TARIFF_CATEGORY"),e.tariffCategorySettings={scrollableHeight:"200px"},e.tariffCategoryData=[],e.data={},e.loadScroll("tariffCategoryScroll"),e.tariffSave=function(){e.data.dropdownValue=[],e.data.dropdownValue.push({facilityId:e.data.TariffCategoryLinkVo.gQDataCode,facilityDesc:e.data.TariffCategoryLinkVo.gQDataName,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}),null==e.data||null==e.data.TariffCategoryLinkVo||null==e.data.TariffCategoryLinkVo||0==e.data.TariffCategoryLinkVo.length?e.nameReq=!0:(p.billingTariffCreateCategory(e.data).then(function(a){if(e.nameReq=!1,a.data.HITService.message.errorCode){var i=e.alertObjectRes.FcltyNmeArdyExsts;t.hisAlertMulti("warning","Warning",i,!1,!1,e.close,2e3)}else if(a.data.HITService.message.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].length>0)var r=a.data.HITService.message.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"];else{r=[a.data.HITService.message.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"]],i=e.alertObjectRes.savdSucesFuly;t.hisAlertMulti("success","Success",i,!1,!1,e.close,2e3)}for(var n=0;n<r.length;n++)e.tariffCategoryGridOptions.data.unshift(angular.extend(r[n],{code:a.data.HITService.message.code,name:a.data.HITService.message.description,gnStatus:a.data.HITService.message.gnStatus,remarks:a.data.HITService.message.remarks,gnStatusDesc:a.data.HITService.message.name}));e.data={gnStatus:"1",TariffCategoryLinkVo:[]},e.tariffCategoryDetails=!e.tariffCategoryDetails}),e.loadScroll("tariffCategoryScroll"))},e.tariffCategoryGridOptions=angular.copy(d),e.tariffCategoryGridOptions.data=[],e.tariffCategoryGridOptions.onRegisterApi=function(t){e.tariffCategoryGridApi=t},e.tariffCategoryAddNewItem=!1,e.tariffCategoryAddNewItem=function(){if(e.tariffCategoryDetails=!e.tariffCategoryDetails,0==e.tariffCategoryData.length)for(var t=0;t<e.facilityName.length;t++)e.tariffCategoryData.push({facilityDesc:e.facilityName[t].gQDataName,facilityId:e.facilityName[t].gQDataCode})},e.rowIndex,e.editrow=function(t,a){e.tariffCategoryDetails=!e.tariffCategoryDetails,e.rowIndex=a,e.SaveFlag=!0,e.loadScroll("tariffCategoryEditScroll"),e.data.code=t.code,e.data.name=t.gnStatusDesc,e.faciTxt=t.facilityDesc,e.data.gnStatus=t.gnStatus.toString(),e.data.description=t.name,e.data.remarks=t.remarks,e.data.tarfaclnkSeqId=t.tarfaclnkSeqId,e.facilityEdit=[{gQDataCode:t.facilityId,gQDataName:t.facilityDesc}];for(var i=0;i<e.facilityName.length;i++){if(e.facilityName[i].gQDataCode==t.facilityId){e.data.TariffCategoryLinkVo=e.facilityName[i];break}e.tariffCategoryData.push({facilityDesc:t.facilityDesc,facilityId:t.facilityId})}},e.activeCorpClick=function(t,a){e.updateData={},e.updateData.code=t.code,e.updateData.name=t.gnStatusDesc,e.updateData.gnStatus=t.gnStatus.toString(),e.updateData.description=t.name,e.updateData.remarks=t.remarks,e.updateData.tarfaclnkSeqId=t.tarfaclnkSeqId,e.updateData.TariffCategoryLinkVo=[],e.updateData.TariffCategoryLinkVo.push({facilityDesc:t.facilityDesc,facilityId:t.facilityId,tarfaclnkSeqId:t.tarfaclnkSeqId}),m.billingTariffUpdateCategory(e.updateData,e.updateData.TariffCategoryLinkVo).then(function(e){})},e.editGrid=function(t,a){for(var i=0;i<e.tariffCategoryGridOptions.data.length;i++)e.tariffCategoryGridOptions.data[i].editable=a==i;e.tariffCategoryGridApi.core.notifyDataChange(c.dataChange.EDIT)},e.data.TariffCategoryLinkVo=[],e.tariffUpdate=function(){if(e.data.TariffCategoryLinkVo){e.nameReq=!1,e.tariffCategoryGridOptions.data.splice(e.rowIndex,1);var a=[];a.push({facilityId:e.data.TariffCategoryLinkVo.gQDataCode,facilityDesc:e.data.TariffCategoryLinkVo.gQDataName,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}),m.billingTariffUpdateCategory(e.data,a).then(function(a){if(a.data.HITService.message.errorCode){var i=a.data.HITService.message.errorMessage;t.hisAlertMulti("warning","Warning",i,!1,!1,e.close,2e3)}else if(a.data.HITService.message.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].length>0){var r=a.data.HITService.message.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"];i=e.alertObjectRes.updatedSucsfuly;t.hisAlertMulti("success","Success",i,!1,!1,e.close,2e3)}else{r=[a.data.HITService.message.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"]],i=e.alertObjectRes.updatedSucsfuly;t.hisAlertMulti("success","Success",i,!1,!1,e.close,2e3)}angular.forEach(e.tariffCategoryData,function(t,i){t.facilityId==a.data.HITService.message.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].facilityId&&(e.facilityDescVar=t.facilityDesc)});for(var n=0;n<r.length;n++)e.tariffCategoryGridOptions.data.splice(e.rowIndex,0,{facilityId:a.data.HITService.message.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].facilityId,facilityDesc:e.facilityDescVar,code:a.data.HITService.message.code,name:a.data.HITService.message.description,gnStatus:a.data.HITService.message.gnStatus,remarks:a.data.HITService.message.remarks,gnStatusDesc:a.data.HITService.message.name,tarfaclnkSeqId:a.data.HITService.message.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].tarfaclnkSeqId,practiceId:a.data.HITService.message.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].practiceId});e.SaveFlag=!1,e.data={gnStatus:"1",TariffCategoryLinkVo:[]},e.tariffCategoryDetails=!e.tariffCategoryDetails,v.data.facility=""}),e.loadScroll("tariffCategoryScroll")}else e.nameReq=!0},e.tariffSearch=function(){if(v.data.facility){var a={};a.url=l.HISSCMSERVICE.URL,a.requestData={operation:"getTariffSearchList",destination:"com.napier.core.scm.master.service.external.ScmMasterService",voclass:"com.napier.core.scm.master.vo.TariffCategoryVo",message:{"@class":"com.napier.core.scm.master.vo.TariffCategoryVo",tariffFacilityList:[{"com.napier.core.scm.master.vo.TariffCategoryLinkVo":[{facilityId:v.data.facility?v.data.facility.gQDataCode:""}]}],gnStatus:v.data.status?parseInt(v.data.status):0,name:v.data.name?v.data.name.name:""}},n.sendRestRequest(a).then(function(a){e.nameNotFound="";var i=a.data.HITService.message[0]["com.napier.core.scm.master.vo.TariffCategoryVo"];if(null!=(i=angular.isArray(i)?i:[i])[0]){e.searchDataDetails=[];for(var r=0;r<i.length;r++)e.searchDataDetails.push({code:i[r].code,gnStatus:i[r].gnStatus,gnStatusDesc:i[r].name,name:i[r].gnStatusDesc,facilityDesc:i[r].tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].facilityDesc,facilityId:i[r].tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].facilityId,tarfaclnkSeqId:i[r].tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].tarfaclnkSeqId});e.tariffCategoryGridOptions.data=[],e.tariffCategoryGridOptions.data=e.searchDataDetails}else{var n=e.alertObjectRes.noRcrdFound;t.hisAlertMulti("information","Information",n,!1,!1,e.close,2e3),e.tariffCategoryGridOptions.data=[],v.data.name="",e.nameNotFound=""}})}else{var i=e.alertObjectRes.PlzSlctFaclty;t.hisAlertMulti("warning","Warning",i,!1,!1,e.close,2e3)}},e.clearForm=function(){e.tCat.data={status:"0"},e.nameNotFound="",e.tariffCategoryGridOptions.data=[]},e.tariffNameSearch=function(t){var a={};return a.url=l.HISSCMSERVICE.URL,a.requestData={operation:"getTariffSearchList",destination:"com.napier.core.scm.master.service.external.ScmMasterService",voclass:"com.napier.core.scm.master.vo.TariffCategoryVo",message:{"@class":"com.napier.core.scm.master.vo.TariffCategoryVo",tariffFacilityList:[{"com.napier.core.scm.master.vo.TariffCategoryLinkVo":[{facilityId:v.data.facility?v.data.facility.gQDataCode:""}]}],gnStatus:v.data.status?parseInt(v.data.status):0,name:v.data.name}},n.sendRestRequest(a).then(function(t){var a=t.data.HITService.message[0]["com.napier.core.scm.master.vo.TariffCategoryVo"];if(e.searchDataDetails=[],Array.isArray(a))for(var i=0;i<a.length;i++)r(a[i]);else{if(null==a)return"j";r(a)}function r(t){e.searchDataDetails.push({code:t.code,gnStatus:t.gnStatus,gnStatusDesc:t.name,name:t.gnStatusDesc,facilityDesc:t.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].facilityDesc,facilityId:t.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].facilityId,tarfaclnkSeqId:t.tariffFacilityList[0]["com.napier.core.scm.master.vo.TariffCategoryLinkVo"].tarfaclnkSeqId})}return e.searchDataDetails.map(function(e){return e})})},$("dropdown-menu dropdown-menu-form").on("click",function(e){e.stopPropagation()})}e.$inject=["$scope","hisAlertService","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","CallManager","BILLING_APIS","$anchorScroll","$location","uiGridConstants","tariffCategoryGridOptions","billingTariffCategoryCreateService","QueryService","billingTariffCategoryUpdateService","RoleTaskService"],angular.module("napierContainerUi").controller("BillingBaseRateTariffCategoryController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u){t.loadModule("billing");var m=a.getLanguageToSet();t.changeLanguage(m);var g=this;g.data={},g.alertData={},i.loadAlerts(m).then(function(t){g.alertData=t,e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}},function(e){}),e.loadScroll=function(e){p.hash(e),l()},e.tariffClassGrid=angular.copy(c),e.IPGrid=angular.copy(o),e.loadScroll("tariffClassScroll"),g.status1=!0,g.status2=!1,e.tariffClassAddNewItem=function(){g.status1=!1,g.status2=!0,g.editFlag=!0,e.Refresh(),g.addTariff="",e.tariffClassGrid.data=[],e.updisable=!1},e.facilityName=[],e.multiDept=[],e.tariffTypeList=[],e.multidropdown={1:e.facilityName,2:e.multiDept,3:e.tariffTypeList};var S=d.executeQueryURLReset();e.facilityNameList=new Array,d.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,e.facilityNameList),d.executeQueryInput("FACILITY_DROPDOWN",e.facilityNameList,e.multidropdown,!0,!1,S,"popUp"),e.servExGroupList1=new Array,d.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,e.servExGroupList1),d.executeQueryInput("DEPARTMENT_DROPDOWN",e.servExGroupList1,e.multidropdown,!0,!1,S,"popUp"),e.tariffTypeListArr=new Array,d.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_CODE,e.tariffTypeListArr),d.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,e.tariffTypeListArr),d.prepareParamListWithParam("pBedTypeStatus",1,e.tariffTypeListArr),d.executeQueryInput("NHIS_BEDTYPE_M_030",e.tariffTypeListArr,e.multidropdown,!0,!0,S,"popUp"),e.servicesAvailabe=[],e.getMultiSubDept=function(t){e.multiSubDept=[],e.serviceInDropDown=[],e.multidropdown={1:e.multiSubDept,2:e.serviceInDropDown},g.deptSubEdit="";var a=d.executeQueryURLReset();null!=t.gQDataCode&&null!=t.gQDataCode&&""!=t.gQDataCode&&(e.multidropdown[1]=e.multiSubDept,e.multidropdown[2]=e.serviceInDropDown,e.servExGroupSubList=new Array,e.selectedDepartment=t.gQDataCode,d.prepareParamList(1,e.selectedDepartment,e.servExGroupSubList),d.executeQueryInput("SUBDEPARTMENT_DROPDOWN",e.servExGroupSubList,e.multidropdown,!0,!1,a,"popUp"),e.serviceForDepartmentInput=new Array,d.prepareParamList(1,e.selectedDepartment,e.serviceForDepartmentInput),d.executeQueryInput("SERVIC_EXCL_NAME_001_DROPDOWN",e.serviceForDepartmentInput,e.multidropdown,!0,!0,S,"popUp",[]))},e.getMultiService=function(t){for(var a=[],i=0;i<t.length;i++)a.push(t[i].CODE);if(null!=a&&null!=a&&a.length>0&&null!=e.selectedDepartment&&null!=e.selectedDepartment&&""!=e.selectedDepartment){e.serviceInDropDown=[],e.multidropdown={1:e.serviceInDropDown};var r=d.executeQueryURLReset();e.multiServiceList=new Array,d.prepareParamList(1,e.selectedDepartment,e.multiServiceList),d.prepareParamList(2,a.toString(),e.multiServiceList),d.executeQueryInput("SERVIC_EXCL_NAME_002_DROPDOWN",e.multiServiceList,e.multidropdown,!0,!0,r,"popUp",[])}},e.roleTask=u.rolePermission("T_BL_M_TARIFF_CLASS"),e.checkDuplicate=function(t){for(var a=!1,i=0;i<e.IPGrid.data.length;i++)if(e.IPGrid.data[i].SERV_SEQ_ID==t.SERV_SEQ_ID)return a;return a=!0},e.addService=function(t,a,i){if(null==e.selectedDepartment||null==e.selectedDepartment||""==e.selectedDepartment){var n=g.alertData.plzSlctDept;return r.hisAlertMulti("information",g.alertData.alertTypeInfo,n,n,!1,!1,e.close,2e3),!1}if(0==e.serviceInDropDown.length){n=g.alertData.NoDfndSerAva;r.hisAlertMulti("information",g.alertData.alertTypeInfo,n,!1,!1,e.close,2e3)}else{var l=[];l=e.IPGrid.data.length>0?angular.copy(e.IPGrid.data):[];var s=[];s=0==g.serviceEdit.length?e.serviceInDropDown:g.serviceEdit;for(var o=0;o<s.length;o++)e.checkDuplicate(s[o])&&l.push(s[o]);e.IPGrid.data=l}},e.clearServiceMapping=function(){g.deptEdit="",g.deptSubEdit="",g.serviceEdit=""},e.tariffCodeSearch=function(t){if(null!=g.data.Sfacility&&null!=g.data.Sfacility&&""!=g.data.Sfacility){var a={};return a.url=s.HISSCMSERVICE.URL,a.requestData={operation:"getFacilityId",messageId:"",destination:"com.napier.his.masters.service.external.BedClassService",message:{"@class":"com.napier.his.masters.vo.BedClassMaster",facilityId:g.data.Sfacility.gQDataCode}},a.requestData.message.bedClassSeqId=t,n.sendRestRequest(a).then(function(e){return e.data.HITService.message[0]["com.napier.his.masters.vo.BedClassMaster"].map(function(e){return e})})}var i=g.alertData.PlzSlctFaclty;return r.hisAlertMulti("warning",g.alertData.alertTypeWarn,i,!1,!1,e.close,2e3),!1},e.tariffNameSearch=function(t){if(null!=g.data.Sfacility&&null!=g.data.Sfacility&&""!=g.data.Sfacility){var a={};return a.url=s.HISSCMSERVICE.URL,a.requestData={operation:"getFacilityId",messageId:"",destination:"com.napier.his.masters.service.external.BedClassService",message:{"@class":"com.napier.his.masters.vo.BedClassMaster",facilityId:g.data.Sfacility.gQDataCode}},a.requestData.message.bedClassDesc=t,n.sendRestRequest(a).then(function(e){return e.data.HITService.message[0]["com.napier.his.masters.vo.BedClassMaster"].map(function(e){return e})})}var i=g.alertData.PlzSlctFaclty;return r.hisAlertMulti("warning",g.alertData.alertTypeWarn,i,!1,!1,e.close,2e3),!1},e.tariffClassSearch=function(){if(g.data.Sfacility){var t={};return t.url=s.HISSCMSERVICE.URL,t.requestData={operation:"getFacilityId",messageId:"",destination:"com.napier.his.masters.service.external.BedClassService",message:{"@class":"com.napier.his.masters.vo.BedClassMaster",facilityId:g.data.Sfacility.gQDataCode}},null!=g.data.Scode&&null!=g.data.Scode&&g.data.Scode&&(t.requestData.message.bedClassSeqId=null==g.data.Scode.bedClassSeqId?g.data.Scode:g.data.Scode.bedClassSeqId),null!=g.data.Sname&&null!=g.data.Sname&&(t.requestData.message.bedClassDesc=null==g.data.Sname.bedClassDesc?g.data.Sname:g.data.Sname.bedClassDesc),null!=g.data.Stype&&null!=g.data.Stype&&(t.requestData.message.encounterTypeArray=g.data.Stype.toString()),n.sendRestRequest(t).then(function(t){if(e.tariffClassGrid.data=[],t.data.HITService.message.errorCode){var a=t.data.HITService.message.errorMessage;r.hisAlertMulti("warning",g.alertData.alertTypeWarn,a,!1,!1,e.close,2e3)}else{var i=t.data.HITService.message[0]["com.napier.his.masters.vo.BedClassMaster"];if(null==i){a=g.alertData.noRcrdFound;r.hisAlertMulti("information",g.alertData.alertTypeInfo,a,!1,!1,e.close,2e3),e.clearForm()}else""!=t.data.HITService.message[0]&&null==i.length?e.tariffClassGrid.data[0]=i:i.length>0&&""!=t.data.HITService.message[0]&&(e.tariffClassGrid.data=i)}})}var a=g.alertData.PlzSlctFaclty;return r.hisAlertMulti("warning",g.alertData.alertTypeWarn,a,!1,!1,e.close,2e3),!1},e.tariffClassSave=function(){if(1==g.addTariff||3==g.addTariff)if(null!=g.data.facility&&0!=g.data.facility.length&&g.data.name&&g.data.code){if(null!=g.data.facility&&0!=g.data.facility.length&&g.data.name&&g.data.code)(a={}).url=s.HISSCMSERVICE.URL,a.requestData={operation:"saveBedClass",messageId:"",destination:"com.napier.his.masters.service.external.BedClassService",message:{"@class":"com.napier.his.masters.vo.BedClassMaster",bedClassDesc:g.data.name?g.data.name:"",bedClassSeqId:g.data.code?g.data.code:"",gnStatus:g.data.status?g.data.status:"",shortName:g.data.alias?g.data.alias:"",isSrCitizenAppclb:g.data.scdstatus?g.data.scdstatus:"",isNegotiable:g.data.negstatus?g.data.negstatus:"",billLevelDiscount:g.data.billstatus?g.data.billstatus:"",serviceDiscount:g.data.sdstatus?g.data.sdstatus:"",encounterType:g.addTariff,facilityId:g.data.facility.gQDataCode,remarks:g.data.remarks}},n.sendRestRequest(a).then(function(t){if(e.tariffClassGrid.data=[],t.data.HITService.message.errorCode){var a=t.data.HITService.message.errorMessage;r.hisAlertMulti("warning",g.alertData.alertTypeWarn,a,!1,!1,e.close,2e3)}else{for(var i,n=t.data.HITService.message.facilityId,l=0;l<e.facilityName.length;l++)e.facilityName[l].gQDataCode==n&&(i=e.facilityName[l].gQDataName);e.tariffClassGrid.data.push({facilityName:i,bedClassSeqId:t.data.HITService.message.bedClassSeqId,bedClassDesc:t.data.HITService.message.bedClassDesc,shortName:t.data.HITService.message.shortName,encounterType:t.data.HITService.message.encounterType,gnStatus:t.data.HITService.message.gnStatus,billLevelDiscount:t.data.HITService.message.billLevelDiscount,serviceDiscount:t.data.HITService.message.serviceDiscount,isSrCitizenAppclb:t.data.HITService.message.isSrCitizenAppclb,isNegotiable:t.data.HITService.message.isNegotiable,remarks:t.data.HITService.message.remarks});a=g.alertData.savdSucesFuly;r.hisAlertMulti("success",g.alertData.alertTypeSucss,a,!1,!1,e.close,2e3),e.clearBedform(),e.loadScroll("tariffClassScroll"),g.status1=!0,g.status2=!1}});else;}else{e.submit=!0,e.test=!1;var t=g.alertData.PlzFllManFields;r.hisAlertMulti("warning",g.alertData.alertTypeInfo,t,!1,!1,e.close,2e3)}else if(null!=g.data.pharmacy&&0!=g.data.pharmacy.length&&null!=g.data.facility&&0!=g.data.facility.length&&g.data.name&&g.data.code&&null!=g.data.tariffType&&0!=g.data.tariffType.length){var a;if(null!=g.data.pharmacy&&0!=g.data.pharmacy.length&&null!=g.data.facility&&0!=g.data.facility.length&&g.data.name&&g.data.code)(a={}).url=s.HISSCMSERVICE.URL,a.requestData={operation:"saveBedClass",messageId:"",destination:"com.napier.his.masters.service.external.BedClassService",message:{"@class":"com.napier.his.masters.vo.BedClassMaster",bedClassDesc:g.data.name?g.data.name:"",bedClassSeqId:g.data.code?g.data.code:"",gnStatus:g.data.status?g.data.status:"",shortName:g.data.alias?g.data.alias:"",isSrCitizenAppclb:g.data.scdstatus?g.data.scdstatus:"",isNegotiable:g.data.negstatus?g.data.negstatus:"",billLevelDiscount:g.data.billstatus?g.data.billstatus:"",serviceDiscount:g.data.sdstatus?g.data.sdstatus:"",encounterType:g.addTariff,isPharmacyMrpOrCost:g.data.pharmacy?g.data.pharmacy:"",intrimDnForIcuBed:g.data.icu?g.data.icu:"",facilityId:g.data.facility.gQDataCode,bedTypeSeqId:g.data.tariffType.gQDataCode,remarks:g.data.remarks,listOfTarifMappingsVo:[{"com.napier.his.masters.vo.TarifClassServiceMappingVo":e.perpareServiceDataForIP()}]}},n.sendRestRequest(a).then(function(t){if(e.tariffClassGrid.data=[],t.data.HITService.message.errorCode){var a=t.data.HITService.message.errorMessage;r.hisAlertMulti("warning",g.alertData.alertTypeWarn,a,!1,!1,e.close,2e3)}else{for(var i,n=t.data.HITService.message.facilityId,l=0;l<e.facilityName.length;l++)e.facilityName[l].gQDataCode==n&&(i=e.facilityName[l].gQDataName);e.tariffClassGrid.data.push({facilityName:i,bedClassSeqId:t.data.HITService.message.bedClassSeqId,bedClassDesc:t.data.HITService.message.bedClassDesc,shortName:t.data.HITService.message.shortName,encounterType:t.data.HITService.message.encounterType,gnStatus:t.data.HITService.message.gnStatus,billLevelDiscount:t.data.HITService.message.billLevelDiscount,serviceDiscount:t.data.HITService.message.serviceDiscount,isSrCitizenAppclb:t.data.HITService.message.isSrCitizenAppclb,isNegotiable:t.data.HITService.message.isNegotiable,isPharmacyMrpOrCost:t.data.HITService.message.isPharmacyMrpOrCost,intrimDnForIcuBed:t.data.HITService.message.intrimDnForIcuBed,bedTypeSeqId:t.data.HITService.message.bedTypeSeqId,remarks:t.data.HITService.message.remarks});a=g.alertData.savdSucesFuly;r.hisAlertMulti("success",g.alertData.alertTypeSucss,a,!1,!1,e.close,2e3),g.status1=!0,g.status2=!1,e.clearBedform()}});else;}else{e.submit=!0,e.test=!1,e.loadScroll("tariffClassScroll");t=g.alertData.PlzFllManFields;r.hisAlertMulti("warning",g.alertData.alertTypeWarn,t,!1,!1,e.close,2e3)}},e.perpareServiceDataForIP=function(){for(var t=[],a=0;a<e.IPGrid.data.length;a++){var i={};i.facilityId=g.data.facility.gQDataCode,i.gnStatus=e.IPGrid.data[a].GN_STATUS,null!=e.IPGrid.data[a].SERV_MAP_SEQ_ID&&null!=e.IPGrid.data[a].SERV_MAP_SEQ_ID&&""!=e.IPGrid.data[a].SERV_MAP_SEQ_ID&&(i.serviceMappingSeq_Id=e.IPGrid.data[a].SERV_MAP_SEQ_ID),i.servSeqId=e.IPGrid.data[a].SERV_SEQ_ID,t.push(i)}return t},e.loadDataToIPGrid=function(t){e.IPGrid.data=[],e.serviceDataForIPGrid=[],e.multidropdown={1:e.serviceDataForIPGrid};var a=d.executeQueryURLReset();e.criteriaNameList=new Array,e.criteriaNameList.push({paramName:"pBedclassCode",value:t}),null!=e.selectedService&&null!=e.selectedService&&""!=e.selectedService?e.criteriaNameList.push({paramName:"pServiceSeqID",value:e.selectedService}):e.criteriaNameList.push({paramName:"pServiceSeqID",value:""}),null!=g.SdeptEdit&&null!=g.SdeptEdit&&""!=g.SdeptEdit?e.criteriaNameList.push({paramName:"pDepCode",value:g.SdeptEdit.gQDataCode}):e.criteriaNameList.push({paramName:"pDepCode",value:""}),null!=g.SdeptSubEdit&&null!=g.SdeptSubEdit&&""!=g.SdeptSubEdit?e.criteriaNameList.push({paramName:"pSubDeptCode",value:g.SdeptSubEdit.CODE}):e.criteriaNameList.push({paramName:"pSubDeptCode",value:""}),d.executeQueryInput("NHIS_M_BED_061",e.criteriaNameList,e.multidropdown,!0,!0,a,"popUp",e.IPGrid).then(function(){if(""!=e.serviceDataForIPGrid)e.IPGrid.data=e.serviceDataForIPGrid;else{var t=g.alertData.noRcrdFoundView;r.hisAlertMulti("information",g.alertData.alertTypeWarn,t,!1,!1,e.close,2e3)}})},e.SearchServiceMapping=function(){if(!g.SdeptEdit){var t=g.alertData.plzSlctDept;return r.hisAlertMulti("information",g.alertData.alertTypeInfo,t,e.alertData,e.alertFunction,e.close),!1}e.loadDataToIPGrid(g.data.code)},e.getServiceInfo=function(t){e.selectedService=t.SERV_SEQ_ID},e.editrow=function(t,a){if(g.status1=!1,g.status2=!0,e.indexValue=a,e.updisable=!0,1==t.gnStatus){g.editFlag=!0,e.loadScroll("tariffClassEditScroll");for(var i=0;i<e.facilityName.length;i++)t.facilityName==e.facilityName[i].gQDataName&&(g.data.facility=e.facilityName[i]);g.data.code=t.bedClassSeqId,g.data.name=t.bedClassDesc,g.data.alias=t.shortName,g.data.remarks=t.remarks,g.data.status=null==t.gnStatus||null==t.gnStatus?"1":t.gnStatus.toString(),g.data.billstatus=null==t.billLevelDiscount||null==t.billLevelDiscount?"1":t.billLevelDiscount.toString(),g.data.sdstatus=null==t.serviceDiscount||null==t.serviceDiscount?"1":t.serviceDiscount.toString(),g.data.scdstatus=null==t.isSrCitizenAppclb||null==t.isSrCitizenAppclb?"1":t.isSrCitizenAppclb.toString(),g.data.negstatus=null==t.isNegotiable||null==t.isNegotiable?"1":t.isNegotiable.toString(),g.data.pharmacy=null==t.isPharmacyMrpOrCost||null==t.isPharmacyMrpOrCost?"":t.isPharmacyMrpOrCost.toString(),g.data.icu=null==t.intrimDnForIcuBed||null==t.intrimDnForIcuBed?"1":t.intrimDnForIcuBed.toString(),g.addTariff=1==t.encounterType?"1":3==t.encounterType?"3":17==t.encounterType?"17":"",g.data.tariffType=d.getModelByCode(e.tariffTypeList,t.bedTypeSeqId,!1)}},e.activeCorpClick=function(e,t){var a={};a.url=s.HISSCMSERVICE.URL,a.requestData={operation:"updateBedClass",messageId:"",destination:"com.napier.his.masters.service.external.BedClassService",message:{"@class":"com.napier.his.masters.vo.BedClassMaster",bedClassDesc:e.bedClassDesc,bedClassSeqId:e.bedClassSeqId,gnStatus:e.gnStatus,shortName:e.shortName,isSrCitizenAppclb:e.isSrCitizenAppclb,isNegotiable:e.isNegotiable,billLevelDiscount:e.billLevelDiscount,serviceDiscount:e.serviceDiscount,encounterType:e.encounterType,facilityId:e.facilityid,remarks:g.data.remarks}},n.sendRestRequest(a).then(function(e){})},e.tariffClassUpdate=function(){var t;1==g.addTariff||3==g.addTariff?((t={}).url=s.HISSCMSERVICE.URL,t.requestData={operation:"updateBedClass",messageId:"",destination:"com.napier.his.masters.service.external.BedClassService",message:{"@class":"com.napier.his.masters.vo.BedClassMaster",bedClassDesc:g.data.name?g.data.name:"",bedClassSeqId:g.data.code?g.data.code:"",gnStatus:g.data.status?g.data.status:"",shortName:g.data.alias?g.data.alias:"",isSrCitizenAppclb:g.data.scdstatus?g.data.scdstatus:"",isNegotiable:g.data.negstatus?g.data.negstatus:"",billLevelDiscount:g.data.billstatus?g.data.billstatus:"",serviceDiscount:g.data.sdstatus?g.data.sdstatus:"",encounterType:g.addTariff,facilityId:g.data.facility.gQDataCode,remarks:g.data.remarks}},n.sendRestRequest(t).then(function(t){if(t.data.HITService.message.errorCode){var a=t.data.HITService.message.errorMessage;r.hisAlertMulti("warning",g.alertData.alertTypeWarn,a,!1,!1,e.close,2e3)}else{for(var i=t.data.HITService.message.facilityId,n=0;n<e.facilityName.length;n++)e.facilityName[n].gQDataCode==i&&(l=e.facilityName[n].gQDataName);e.tariffClassGrid.data=[];var l;for(i=t.data.HITService.message.facilityId,n=0;n<e.facilityName.length;n++)e.facilityName[n].gQDataCode==i&&(l=e.facilityName[n].gQDataName);e.tariffClassGrid.data.splice(e.indexValue,1),e.tariffClassGrid.data.unshift({facilityName:l,bedClassSeqId:t.data.HITService.message.bedClassSeqId,bedClassDesc:t.data.HITService.message.bedClassDesc,shortName:t.data.HITService.message.shortName,encounterType:t.data.HITService.message.encounterType,gnStatus:t.data.HITService.message.gnStatus,billLevelDiscount:t.data.HITService.message.billLevelDiscount,serviceDiscount:t.data.HITService.message.serviceDiscount,isSrCitizenAppclb:t.data.HITService.message.isSrCitizenAppclb,isNegotiable:t.data.HITService.message.isNegotiable,remarks:t.data.HITService.message.remarks});a=g.alertData.updatedSucsfuly;r.hisAlertMulti("success",g.alertData.alertTypeSucss,a,!1,!1,e.close,2e3),g.data={},g.editFlag=!1,e.loadScroll("tariffClassScroll"),g.status1=!0,g.status2=!1}}),e.loadScroll("tariffClassScroll")):((t={}).url=s.HISSCMSERVICE.URL,t.requestData={operation:"updateBedClass",messageId:"",destination:"com.napier.his.masters.service.external.BedClassService",message:{"@class":"com.napier.his.masters.vo.BedClassMaster",bedClassDesc:g.data.name?g.data.name:"",bedClassSeqId:g.data.code?g.data.code:"",gnStatus:g.data.status?g.data.status:"",shortName:g.data.alias?g.data.alias:"",isSrCitizenAppclb:g.data.scdstatus?g.data.scdstatus:"",isNegotiable:g.data.negstatus?g.data.negstatus:"",billLevelDiscount:g.data.billstatus?g.data.billstatus:"",serviceDiscount:g.data.sdstatus?g.data.sdstatus:"",encounterType:g.addTariff,isPharmacyMrpOrCost:g.data.pharmacy?g.data.pharmacy:"",intrimDnForIcuBed:g.data.icu?g.data.icu:"",facilityId:g.data.facility.gQDataCode,bedTypeSeqId:g.data.tariffType.gQDataCode,remarks:g.data.remarks,listOfTarifMappingsVo:[{"com.napier.his.masters.vo.TarifClassServiceMappingVo":e.perpareServiceDataForIP()}]}},n.sendRestRequest(t).then(function(t){for(var a=t.data.HITService.message.facilityId,i=0;i<e.facilityName.length;i++)e.facilityName[i].gQDataCode==a&&(n=e.facilityName[i].gQDataName);e.tariffClassGrid.data=[];var n;for(a=t.data.HITService.message.facilityId,i=0;i<e.facilityName.length;i++)e.facilityName[i].gQDataCode==a&&(n=e.facilityName[i].gQDataName);e.tariffClassGrid.data.splice(e.indexValue,1),e.tariffClassGrid.data.unshift({facilityName:n,bedClassSeqId:t.data.HITService.message.bedClassSeqId,bedClassDesc:t.data.HITService.message.bedClassDesc,shortName:t.data.HITService.message.shortName,encounterType:t.data.HITService.message.encounterType,gnStatus:t.data.HITService.message.gnStatus,billLevelDiscount:t.data.HITService.message.billLevelDiscount,serviceDiscount:t.data.HITService.message.serviceDiscount,isSrCitizenAppclb:t.data.HITService.message.isSrCitizenAppclb,isNegotiable:t.data.HITService.message.isNegotiable,isPharmacyMrpOrCost:t.data.HITService.message.isPharmacyMrpOrCost,intrimDnForIcuBed:t.data.HITService.message.intrimDnForIcuBed,bedTypeSeqId:t.data.HITService.message.bedTypeSeqId,remarks:t.data.HITService.message.remarks});var l=g.alertData.updatedSucsfuly;r.hisAlertMulti("success",g.alertData.alertTypeSucss,l,!1,!1,e.close,2e3),e.clearBedform(),e.loadScroll("tariffClassScroll"),g.editFlag=!1,g.status1=!0,g.status2=!1}))},e.Refresh=function(){g.data={},e.submit=!1,g.editFlag=!1,e.clearSearchService(),e.clearBedform()},e.clearForm=function(){g.data={},e.tariffClassGrid.data=[],g.status2=!1},e.clearBedform=function(){g.data={},g.data.status="1",g.data.billstatus="1",g.data.sdstatus="1",g.data.scdstatus="1",g.data.negstatus="1",g.data.icu="1",g.deptEdit="",g.deptSubEdit="",g.serviceEdit="",g.SdeptEdit="",g.SdeptSubEdit="",g.Sname="",e.IPGrid.data=[],e.submit=!1},e.resetServiceInfo=function(){""==g.Scode&&""==g.Sname&&(e.selectedService="")},e.clearSearchService=function(){g.SdeptEdit="",g.SdeptSubEdit="",g.Sname="",g.Scode="",e.selectedService="",e.IPGrid.data=[]},e.serviceMappingChangeStatus=function(){var t={};t.url=s.HISSCMSERVICE.URL,t.requestData={operation:"saveBedClass",messageId:"",destination:"com.napier.his.masters.service.external.BedClassService",message:{"@class":"com.napier.his.masters.vo.BedClassMaster",bedClassDesc:g.data.name?g.data.name:"",bedClassSeqId:g.data.code?g.data.code:"",gnStatus:g.data.status?g.data.status:"",shortName:g.data.alias?g.data.alias:"",isSrCitizenAppclb:g.data.scdstatus?g.data.scdstatus:"",isNegotiable:g.data.negstatus?g.data.negstatus:"",billLevelDiscount:g.data.billstatus?g.data.billstatus:"",serviceDiscount:g.data.sdstatus?g.data.sdstatus:"",encounterType:g.addTariff,isPharmacyMrpOrCost:g.data.pharmacy?g.data.pharmacy:"",intrimDnForIcuBed:g.data.icu?g.data.icu:"",facilityId:g.data.facility.gQDataCode,remarks:g.data.remarks,listOfTarifMappingsVo:[{"com.napier.his.masters.vo.TarifClassServiceMappingVo":e.perpareServiceDataForIP()}]}},n.sendRestRequest(t).then(function(e){})}}e.$inject=["$scope","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","CallManager","$anchorScroll","BILLING_APIS","IPGrid","tariffClassGrid","QueryService","$location","RoleTaskService"],angular.module("napierContainerUi").controller("tariffClassController",e)}(),angular.module("napierContainerUi").directive("alphabetsPatternNumeric",function(){return{require:"ngModel",link:function(e,t,a,i){i.$parsers.push(function(e){var t=e.replace(/[^A-Za-z0-9 ]/g,"");return t!==e&&(i.$setViewValue(t),i.$render()),t})}}}),angular.module("napierContainerUi").directive("restrictZero",function(){return{require:"ngModel",link:function(e,t,a,i){i.$parsers.push(function(e){var t=e.replace(/^0+/gi,"");return t!==e&&(i.$setViewValue(t),i.$render()),t})}}}),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p){var u=this;o.loadModule("billing");var m=c.getLanguageToSet();o.changeLanguage(m),d.loadAlerts(m).then(function(t){e.myObj=t,e.close={buttonClose:function(){}}}),u.roleTask=p.rolePermission("T_BL_M_TAX"),u._=_,u.contextObj=JSON.parse(sessionStorage.userContextObj),u.search={},u.editGridInfo=[],u.search.facility=u.contextObj.FACILITY_CODE+"  ",u.search.status="1",u.status1=!0,u.addDetailsClicked=!1,u.status2=!1,u.gridOptions=angular.copy(r),u.formgridOptions=angular.copy(i),u.serviceFormgridOptions=angular.copy(l),u.editdatesprevious=[],u.mapFacility=!1,u.addbtnClicked=!1,u.isEditMode=!1,u.autoCompleteName=[],u.applicabilityBill=!1,u.applicabilityService=!1,u.applicability=2,u.taxcalculation=5,u.taxfromDateOptions={ngModelOptions:"{ timezone: 'UTC' }",minDate:new Date},u.taxtoDateOptions={ngModelOptions:"{ timezone: 'UTC' }",minDate:new Date},u.show=function(){u.status1=!1,u.status2=!0,u.isEditMode&&(u.taxCode="",u.isEditMode=!1,u.taxName="",u.taxDesc="",u.applicability="",u.taxcalculation="",u.paymentmode="",u.applicabilityBill=!1,u.applicabilityService=!1,u.addDetailsClicked=!1,u.remarks="",S=[],u.formgridOptions.data=[],u.serviceFormgridOptions.data=[])},u.clear=function(e){u.search.name="",u.search.facility=u.contextObj.FACILITY_CODE+"  ",u.search.status="1",n.getGridData(u.search.facility).then(function(e){u.gridOptions.data=e,angular.forEach(e,function(e,t){-1==u.autoCompleteName.indexOf(e.taxName)&&u.autoCompleteName.push(e.taxName)})})},n.comboBoxFetch("QS_FACILITY_USER_PERMITED",u.contextObj.USER_SEQ_ID).then(function(e){u.facilityComboObj=e}),u.activeInactiveStatusTaxType=function(e){n.activeInactiveTaxType(e.entity.taxSeqId,e.entity.actStatus).then(function(i){1==i.data.HITService.message.responseCode&&(e.entity.actStatus?(e.entity.gnStatus=1,e.entity.gnStatusDesc="Active"):(e.entity.gnStatus=2,e.entity.gnStatusDesc="Inactive")),a(function(){t.reload()},1500)})},u.SetStatusformapping=function(){n.comboBoxFetch("QS_TAX_CAL_BASED",u.applicability).then(function(e){u.taxCalBasedComboObj=e})},u.addDetails=function(e){if(S=[],e.addDetailsClicked=!0,1==e.applicability){if(e.formgridOptions.data){e.formgridOptions.data=[];t={editable:!1};e.formgridOptions.data.push(t)}else{e.formgridOptions.data=[];var t={editable:!1};e.formgridOptions.data.push(t)}e.applicabilityBill=!0,e.applicabilityService=!1}else{if(e.serviceFormgridOptions.data){e.serviceFormgridOptions.data=[];t={editable1:!1,facilityflag:!0,curdateflag:!0,curdatesplflag:!0,furdateflag:!0,saveflag:!0,activeInactiveStat:!0,gnStatusDesc:"Active",gnStatus:1};e.serviceFormgridOptions.data.push(t)}else{e.serviceFormgridOptions.data=[];var t={editable1:!1,facilityflag:!0,curdateflag:!0,curdatesplflag:!0,furdateflag:!0,saveflag:!0,activeInactiveStat:!0,gnStatusDesc:"Active",gnStatus:1};e.serviceFormgridOptions.data.push(t)}e.applicabilityService=!0,e.applicabilityBill=!1}6==e.taxcalculation?(e.formgridOptions.columnDefs.splice(2,0,{name:"min",displayName:"Min",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*",cellTemplate:'<div ng-if="row.entity.editable" class="gridTextAlign">{{row.entity.minvalue}}</div><div class="col-sm-12 col-md-12 col-lg-12 taxgridFields" ng-if="!row.entity.editable"><div class="form-group"><input type="number" class="form-control" ng-disabled="row.entity.gridfacility?false:true" placeholder="Enter" ng-model="row.entity.minvalue" maxlength="200" ng-blur="grid.appScope.taxMasters.checkMinValue(row)"></div></div>'},{name:"max",displayName:"Max",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*",cellTemplate:'<div ng-if="row.entity.editable" class="gridTextAlign">{{row.entity.maxvalue}}</div><div class="col-sm-12 col-md-12 col-lg-12 taxgridFields" ng-if="!row.entity.editable"><div class="form-group"><input type="number" class="form-control" placeholder="Enter" ng-disabled="row.entity.gridfacility?false:true" ng-model="row.entity.maxvalue" maxlength="200" ng-blur="grid.appScope.taxMasters.checkMaxValue(row)"></div></div>'}),e.refresh=!0,a(function(){e.refresh=!1},1)):"min"==e.formgridOptions.columnDefs[2].name&&e.formgridOptions.columnDefs.splice(2,2)},u.cancelGridValues=function(e,t){if(e.entity.isEditable)n.viewTaxTypeDetails(e.entity.taxSeqId).then(function(t){u.editGridInfo=angular.copy(t);var a=!0;angular.forEach(u.formgridOptions.data,function(t,i){a&&t.taxFactSeqId==e.entity.taxFactSeqId&&(u.formgridOptions.data.splice(i,1),u.formgridOptions.data.splice(i,0,u.editGridInfo[i]),a=!1)})});else{var a=u.formgridOptions.data.indexOf(e.entity);u.formgridOptions.data.splice(a,1)}},u.cancelServiceGridValues=function(e,t){if(e.entity.isEditable1)n.viewTaxTypeDetails(e.entity.taxSeqId).then(function(t){u.editGridInfo=angular.copy(t);var a=!0;angular.forEach(u.serviceFormgridOptions.data,function(t,i){a&&t.taxFactSeqId==e.entity.taxFactSeqId&&(u.serviceFormgridOptions.data.splice(i,1),u.serviceFormgridOptions.data.splice(i,0,u.editGridInfo[i]),a=!1)})});else{var a=u.serviceFormgridOptions.data.indexOf(e.entity);u.serviceFormgridOptions.data.splice(a,1)}},u.taxcalculationbase=function(e){e&&(u.istaxcalculation=!1),6==u.taxcalculation&&n.comboBoxFetch("QS_PAYMENT_TYPE").then(function(e){u.paymentTypeComboObj=e})},n.getGridData(u.search.facility).then(function(e){u.gridOptions.data=e,angular.forEach(e,function(e,t){-1==u.autoCompleteName.indexOf(e.taxName)&&u.autoCompleteName.push(e.taxName)})}),u.searchTaxDetails=function(e){n.getGridData(e).then(function(e){0!=e.length?u.gridOptions.data=e:(u.gridOptions.data=[],u.gridOptions.data.push({taxName:"No Records Found",Action:""}))})},u.editTaxMasters=function(e){var t=e.entity;u.isEditMode=!0,u.status1=!1,u.status2=!0,u.taxCode=t.taxCode,u.taxName=t.taxName,u.taxDesc=t.taxDesc,u.applicability=t.applicability,u.taxcalculation=t.taxCalBase,u.paymentmode=t.paymentMode,u.taxSeqId=t.taxSeqId,u.remarks=t.remarks,u.addDetailsClicked=!0,n.comboBoxFetch("QS_TAX_CAL_BASED",u.applicability).then(function(e){u.taxCalBasedComboObj=e}),n.comboBoxFetch("QS_PAYMENT_TYPE").then(function(e){u.paymentTypeComboObj=e}),n.viewTaxTypeDetails(t.taxSeqId).then(function(e){S=[],angular.forEach(e,function(e,t){2!=e.gnStatus&&(u.editdates=g(e.validfrom,e.validto),_.forEach(u.editdates,function(e){S.push(e)}))}),u.formgridOptions.data=[],1==u.applicability?(u.applicabilityService=!1,u.applicabilityBill=!0,6==t.taxCalBase?u.formgridOptions.columnDefs.splice(2,0,{name:"min",displayName:"Min",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*",cellTemplate:'<div class="gridTextAlign" ng-if="row.entity.editable">{{row.entity.minvalue}}</div><div class="col-sm-12 col-md-12 col-lg-12 taxgridFields" ng-if="!row.entity.editable"><div class="form-group"><input type="number" class="form-control" placeholder="Enter" ng-model="row.entity.minvalue" maxlength="200" ng-blur="grid.appScope.taxMasters.checkMinValue(row)"></div></div>'},{name:"max",displayName:"Max",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*",cellTemplate:'<div ng-if="row.entity.editable" class="gridTextAlign">{{row.entity.maxvalue}}</div><div class="col-sm-12 col-md-12 col-lg-12 taxgridFields" ng-if="!row.entity.editable"><div class="form-group"><input type="number" class="form-control" placeholder="Enter" ng-model="row.entity.maxvalue" maxlength="200" ng-blur="grid.appScope.taxMasters.checkMaxValue(row)"></div></div>'}):"min"==u.formgridOptions.columnDefs[2].name&&u.formgridOptions.columnDefs.splice(2,2),u.refresh=!0,a(function(){u.refresh=!1,u.formgridOptions.data=e},2)):(u.applicabilityBill=!1,u.applicabilityService=!0,u.serviceFormgridOptions.data=e)})},u.mapFacility=function(e){u.datesCheck=!0;u.formgridOptions.data.push({isRowEditMode:!1,editable:!1})},u.mapFacility1=function(e){u.serviceFormgridOptions.data.push({isRowEditMode:!1,editable1:!1,facilityflag:!0,curdateflag:!0,curdatesplflag:!0,furdateflag:!0,saveflag:!0,activeInactiveStat:!0,gnStatusDesc:"Active",gnStatus:1})},u.activeInactive=function(e){e.entity.taxFactSeqId?n.activeInactiveFacility(e.entity.taxFactSeqId,e.entity.activeInactiveStat).then(function(t){if(1==t.data.HITService.message.responseCode)if(e.entity.activeInactiveStat){e.entity.gnStatus=1,e.entity.gnStatusDesc="Active";a=g(e.entity.validfrom,e.entity.validto);_.forEach(a,function(e,t){S.splice(t,0,e)})}else{e.entity.gnStatus=2,e.entity.gnStatusDesc="Inactive";var a=g(e.entity.validfrom,e.entity.validto);_.remove(S,function(e){return-1!==_.indexOf(a,e)})}}):e.entity.activeInactiveStat?(e.entity.gnStatus=1,e.entity.gnStatusDesc="Active"):(e.entity.gnStatus=2,e.entity.gnStatusDesc="Inactive")},u.facilitySelection=function(e){e.entity.hasOwnProperty("gridfacility")&&e.entity.gridfacility||(e.entity={})};var g=function(e,t){for(var a=[],i=[],r=e,n=function(e){var t=new Date(this.valueOf());return t.setDate(t.getDate()+e),t};r<=t;)i.push(r),r=n.call(r,1);return angular.forEach(i,function(e){a.push(e.setHours(0,0,0))}),a},S=[];u.dataEntered=function(t){if(t.entity.showvalidTo=moment(t.entity.validto).format("DD-MM-YYYY"),t.entity.showvalidFrom=moment(t.entity.validfrom).format("DD-MM-YYYY"),t.entity.activeInactiveStat=!0,t.entity.gnStatusDesc="Active",t.entity.gnStatus=1,t.entity.hasOwnProperty("gridfacility")&&t.entity.gridfacility){if(6==u.taxcalculation)var a=!(t.entity.hasOwnProperty("taxpercent")&&t.entity.taxpercent&&t.entity.hasOwnProperty("validfrom")&&t.entity.validfrom&&t.entity.hasOwnProperty("validto")&&t.entity.validto&&t.entity.hasOwnProperty("maxvalue")&&t.entity.maxvalue&&t.entity.hasOwnProperty("minvalue")&&null!=t.entity.minvalue);else a=!(t.entity.hasOwnProperty("taxpercent")&&t.entity.taxpercent&&t.entity.hasOwnProperty("validfrom")&&t.entity.validfrom&&t.entity.hasOwnProperty("validto")&&t.entity.validto);if(a){i=e.myObj.enterAll;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,i,!1,!1,e.close,2300)}else if(t.entity.taxpercent<0||t.entity.taxpercent>100){i=e.myObj.enterValdTaxPerc;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,i,!1,!1,e.close,2300)}else if(t.entity.minvalue<0){i=e.myObj.enterValdMinVal;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,i,!1,!1,e.close,2300)}else if(t.entity.maxvalue<0){i=e.myObj.enterValdMaxVal;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,i,!1,!1,e.close,2300)}else if(t.entity.maxvalue<t.entity.minvalue){i=e.myObj.rangeBwMinMax;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,i,!1,!1,e.close,2300)}else if(t.entity.validto<t.entity.validfrom){i=e.myObj.rangeBwDates;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,i,!1,!1,e.close,2300)}else t.entity.validto&&t.entity.validfrom&&(S=[],u.alreadyEnteredDates=[],angular.forEach(u.formgridOptions.data,function(a,i){if(a.gridfacility.CODE==t.entity.gridfacility.CODE){var r=0;if(6!=u.taxcalculation){var n=g(a.validfrom,a.validto);S&&_.forEach(S,function(e){-1!=n.map(Number).indexOf(+e)&&r++})}else if(6==u.taxcalculation){n=g(a.validfrom,a.validto);if(S&&_.forEach(S,function(e){-1!=n.map(Number).indexOf(+e)&&r++}),r>0)for(var l=0;l<u.formgridOptions.data.length;l++){if(Number.prototype.between=function(e,t){return this>=e&&this<=t},!(l<u.formgridOptions.data.length-1)){r=0;break}if(u.formgridOptions.data[u.formgridOptions.data.length-1].minvalue.between(u.formgridOptions.data[l].minvalue,u.formgridOptions.data[l].maxvalue)){s.hisAlertMulti("warning",e.myObj.alertTypeWarn,"Tax percentage already exists for this amount. Please re-enter.",!1,!1,e.close);break}if(u.formgridOptions.data[u.formgridOptions.data.length-1].maxvalue.between(u.formgridOptions.data[l].minvalue,u.formgridOptions.data[l].maxvalue)){s.hisAlertMulti("warning",e.myObj.alertTypeWarn,"Tax percentage already exists for this amount. Please re-enter.",!1,!1,e.close);break}}}if(0==r)_.forEach(n,function(e){2!=a.gnStatus&&S.push(e)}),t.entity.editable=!0;else{e.close1={buttonClose:function(){return t.entity.editable=!1,!1}};var o=e.myObj.rangeExt;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,o,!1,!1,e.close1,2300)}}}))}else{t.entity={};var i=e.myObj.PlzSlctFaclty;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,i,!1,!1,e.close,2300)}},u.dataEntered1=function(t){if(t.entity.newvalidfromdate?t.entity.showvalidnewFrom=moment(t.entity.newvalidfromdate).format("DD-MM-YYYY"):t.entity.showvalidnewFrom="",t.entity.validfrom?t.entity.showvalidFrom=moment(t.entity.validfrom).format("DD-MM-YYYY"):t.entity.showvalidFrom="",t.entity.hasOwnProperty("gridfacility1")&&t.entity.gridfacility1){var a=0;1!=u.serviceFormgridOptions.data.length?(angular.forEach(u.serviceFormgridOptions.data,function(e,i){void 0!==e.gridfacility1&&e.gridfacility1.CODE==t.entity.gridfacility1.CODE&&a++}),a>1?(t.entity.editable1=!1,s.hisAlertMulti("warning",e.myObj.alertTypeWarn,"Facility already mapped",!1,!1,e.close,2300)):(t.entity.editable1=!0,t.entity.activeInactiveStat=!0,t.entity.gnStatusDesc="Active",t.entity.gnStatus=1)):(t.entity.editable1=!0,t.entity.activeInactiveStat=!0,t.entity.gnStatusDesc="Active",t.entity.gnStatus=1)}else{t.entity={},t.entity.editable1=!1,t.entity.facilityflag=!0,t.entity.curdateflag=!0,t.entity.curdatesplflag=!0,t.entity.furdateflag=!0;var i=e.myObj.PlzSlctFaclty;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,i,!1,!1,e.close,2300)}},u.editGridDetails=function(e){e.entity.taxSeqId&&angular.forEach(u.facilityComboObj,function(t,a){e.entity.gridfacility.CODE==t.CODE&&angular.forEach(u.formgridOptions.data,function(a,i){e.entity.taxSeqId==a.taxSeqId&&(u.formgridOptions.data[i].gridfacility=t)})}),u.alreadyEnteredDates=g(e.entity.validfrom,e.entity.validto),_.forEach(u.alreadyEnteredDates,function(e){var t=S.map(Number).lastIndexOf(+e);S.splice(t,1)}),u.datesCheck=!1,e.entity.editable=!1},u.editGridDetails1=function(e){if(e.entity.taxFactSeqId&&angular.forEach(u.facilityComboObj,function(t,a){e.entity.gridfacility1.CODE==t.CODE&&angular.forEach(u.serviceFormgridOptions.data,function(a,i){e.entity.taxFactSeqId==a.taxFactSeqId&&(u.serviceFormgridOptions.data[i].gridfacility1=t)})}),e.entity.editable1=!1,e.entity.facilityflag=!0,e.entity.gridfacility1&&(e.entity.facilityflag=!1),e.entity.curdatesplflag=!0,e.entity.taxpercent&&(e.entity.curdatesplflag=!1),e.entity.curdateflag=!0,(e.entity.validfrom||e.entity.isRowEditMode)&&(e.entity.curdateflag=!1),e.entity.isRowEditMode)if(e.entity.validfrom){if(moment().isBefore(moment(e.entity.validfrom).format("YYYY-DD-MM"),"year"))var t=new Date;else t=new Date(moment(e.entity.validfrom).format("MM/DD/YYYY"));e.entity.taxnewDateOptions={ngModelOptions:"{ timezone: 'UTC' }",minDate:t}}else e.entity.taxnewDateOptions={ngModelOptions:"{ timezone: 'UTC' }",minDate:new Date};e.entity.furdateflag=!0,e.entity.taxpercent2&&(e.entity.furdateflag=!1)},u.facilityChange=function(e){e.entity.gridfacility1?e.entity.facilityflag=!1:(e.entity.facilityflag=!0,e.entity.curdatesplflag=!0,e.entity.curdateflag=!0,e.entity.furdateflag=!0,e.entity.taxpercent="",e.entity.validfrom="",e.entity.taxpercent2="",e.entity.newvalidfromdate="")},u.curdateChanges1=function(e){e.entity.taxpercent?e.entity.curdatesplflag=!1:(e.entity.curdatesplflag=!0,e.entity.curdateflag=!0,e.entity.furdateflag=!0,e.entity.validfrom="",e.entity.taxpercent2="",e.entity.newvalidfromdate="")},u.curdateChanges2=function(e){e.entity.validfrom?(e.entity.curdateflag=!1,e.entity.taxnewDateOptions={ngModelOptions:"{ timezone: 'UTC' }",minDate:new Date(moment(e.entity.validfrom).add(1,"days").format("MM/DD/YYYY"))}):(e.entity.curdateflag=!0,e.entity.furdateflag=!0,e.entity.taxpercent2="",e.entity.newvalidfromdate="")},u.furdateChanges=function(e){e.entity.taxpercent2?e.entity.furdateflag=!1:(e.entity.furdateflag=!0,e.entity.newvalidfromdate="")},u.submitTaxForm=function(a,i){var r,l=!0,o=!0,c=!0;if(a.hasOwnProperty("taxCode")&&a.taxCode)if(u.istaxcode=!1,a.hasOwnProperty("taxName")&&a.taxName){u.istaxname=!1;var d=0;if(1!=(r=1==u.applicability?u.formgridOptions.data:u.serviceFormgridOptions.data).length)for(var p=0;p<r.length;p++)for(var m=p+1;m<r.length;m++)if(void 0!==r[p].gridfacility1&&void 0!==r[m].gridfacility1&&r[p].gridfacility1.CODE==r[m].gridfacility1.CODE&&d++,0!=d)return void s.hisAlertMulti("warning",e.myObj.alertTypeWarn,"Facility already mapped",!1,!1,e.close,2300);if("save"==i&&_.forEach(u.gridOptions.data,function(t,i){if(l)if(t.taxCode==a.taxCode){var r=e.myObj.taxcodeAldyExt;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,r,!1,!1,e.close,2300),l=!1}else if(t.taxName==a.taxName){r=e.myObj.taxnameAldyExt;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,r,!1,!1,e.close,2300),l=!1}else l=!0}),l)if(0!=r.length){var g=0,S=0;angular.forEach(r,function(t,i){if(o)if(1==a.applicability){if(t.editable||g++,g>0){var r=e.myObj.enterReqVal;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,r,!1,!1,e.close,2300),o=!1}}else{if(void 0===t.gridfacility1){r=e.myObj.mapAtlstOneFaci;return void s.hisAlertMulti("warning",e.myObj.alertTypeWarn,r,!1,!1,e.close,2300)}if(t.editable1||t.isEditable1&&S++,S>0){r=e.myObj.enterValdValGrd;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,r,!1,!1,e.close,2300),o=!1}}})}else{var v=e.myObj.mapAtlstOneFaci;s.hisAlertMulti("warning",e.myObj.alertTypeWarn,v,!1,!1,e.close,2300)}if(l&&o){var D=0;angular.forEach(r,function(t,a){if(c&&(t.taxpercent2&&(t.newvalidfromdate||D++),t.taxpercent&&(t.validfrom||D++),D>0)){return s.hisAlertMulti("warning",e.myObj.alertTypeWarn,"Enter dates for the corresponding rates",!1,!1,e.close,2300),void(c=!1)}})}l&&o&&c&&(a.applicability=2,a.taxcalculation=5,n.submitTaxMastersForm(a,r,i).then(function(a){"save"==i?a.taxSeqId&&n.getGridData(u.search.facility).then(function(a){u.gridOptions.data=a;var i=e.myObj.savdSucesFuly;s.hisAlertMulti("success",e.myObj.alertTypeSucss,i,!1,!1,e.close,2300),t.reload()}):a.taxSeqId&&n.getGridData(u.search.facility).then(function(a){u.gridOptions.data=a;var i=e.myObj.updatedSucsfuly;s.hisAlertMulti("success",e.myObj.alertTypeSucss,i,!1,!1,e.close,2300),t.reload()})}))}else u.istaxname=!0;else u.istaxcode=!0}}e.$inject=["$scope","$state","$timeout","taxMastersFormGridDef","taxMastersGridDef","angtaxMastersService","taxMastersServiceFormGridDef","hisAlertService","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","RoleTaskService"],angular.module("napierContainerUi").controller("angTaxMastersController",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("agentCommissionGrid",{multiSelect:!0,enableHorizontalScrollbar:1,enableVerticalScrollbar:0,enableColumnMenus:!1,enableSorting:!0,paginationPageSizes:[10,16,32,64],paginationPageSize:10,columnDefs:[{field:"slno",displayName:"SL No",width:60},{field:"REFERRAL_AGENT_NAME",displayName:"Agent Name",width:150,cellTooltip:function(e,t){return e.entity.REFERRAL_AGENT_NAME}},{field:"PAT_NAME",displayName:"Patient Name",width:150,cellTooltip:function(e,t){return e.entity.PAT_NAME}},{field:"MR_NO",displayName:"MR No",width:100,cellTooltip:function(e,t){return e.entity.MR_NO}},{field:"ipNo",displayName:"IP No",width:100,cellTooltip:function(e,t){return e.entity.ipNo}},{field:"VISIT_NO",displayName:"Visit No",width:100,cellTooltip:function(e,t){return e.entity.VISIT_NO}},{field:"BILL_NO",displayName:"Bill No",width:130,cellTooltip:function(e,t){return e.entity.BILL_NO}},{field:"BILL_AMT",displayName:"Bill Amount",width:100,cellTooltip:function(e,t){return e.entity.BILL_AMT}},{field:"COMMISSION_AMOUNT",displayName:"Agent Commission",width:100,cellTooltip:function(e,t){return e.entity.COMMISSION_AMOUNT}},{field:"aCPrcStatus",displayName:"Status",width:100,cellTooltip:function(e,t){return e.entity.aCPrcStatus}},{field:"action",displayName:"Action",width:100,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="glyphicon glyphicon-pencil" style="padding-left:10px;" ng-click="grid.appScope.editAgentComm(row, rowRenderIndex, grid, col);"></span><span class="glyphicon glyphicon-print" style="padding-left:10px;" ng-click="grid.appScope.printAgentComm(row, rowRenderIndex, grid, col);"></span><span class="glyphicon glyphicon-eye-open" style="padding-left:10px;" ng-click="grid.appScope.viewAgentComm(row, rowRenderIndex, grid, col);"></span></div>',cellTooltip:function(e,t){return e.entity.action}}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("agentCommissionModalGrid",{multiSelect:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableColumnMenus:!1,enableSorting:!0,paginationPageSizes:[10,16,32,64],paginationPageSize:6,columnDefs:[{field:"REFERRAL_AGENT_NAME",displayName:"Agent Name",width:110,cellTooltip:function(e,t){return e.entity.REFERRAL_AGENT_NAME}},{field:"REFERRAL_AGENT_CODE",displayName:"Agent Code",width:100,cellTooltip:function(e,t){return e.entity.REFERRAL_AGENT_CODE}},{field:"PAT_NAME",displayName:"Patient Name",width:130,cellTooltip:function(e,t){return e.entity.PAT_NAME}},{field:"MR_NO",displayName:"MR No",width:120,cellTooltip:function(e,t){return e.entity.MR_NO}},{field:"BILL_NO",displayName:"Bill No",width:120,cellTooltip:function(e,t){return e.entity.BILL_NO}},{field:"VISIT_NO",displayName:"Visit No",width:120,cellTooltip:function(e,t){return e.entity.VISIT_NO}},{field:"BILL_DATE",displayName:"Bill Date",type:"date",cellFilter:'date:"dd-MM-yyyy"',width:140,cellTooltip:function(e,t){return e.entity.BILL_DATE}}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("agentCommissionServiceCalculationGrid",{multiSelect:!0,enableHorizontalScrollbar:1,enableVerticalScrollbar:1,enableColumnMenus:!1,enableSorting:!0,paginationPageSizes:[10,16,32,64],paginationPageSize:10,columnDefs:[{field:"slNo",displayName:"SL No",width:60,enableCellEdit:!1},{field:"SERV_CODE",displayName:"Service Code",width:90,enableCellEdit:!1,cellTooltip:function(e,t){return e.entity.SERV_CODE}},{field:"SERV_NAME",displayName:"Service Name",width:120,enableCellEdit:!1,cellTooltip:function(e,t){return e.entity.SERV_NAME}},{field:"ORD_DATE",displayName:"Order Date",type:"date",enableCellEdit:!1,cellFilter:'date:"dd-MM-yyyy"',width:130,cellTooltip:function(e,t){return e.entity.ORD_DATE}},{field:"SERVICE_RATE",displayName:"Rate",width:90,enableCellEdit:!1,cellTooltip:function(e,t){return e.entity.SERVICE_RATE}},{field:"QTY",displayName:"QTY",width:60,enableCellEdit:!1,cellTooltip:function(e,t){return e.entity.QTY}},{field:"TAX_AMT",displayName:"Tax",width:90,enableCellEdit:!1,cellTooltip:function(e,t){return e.entity.TAX_AMT}},{field:"DISCOUNT_AMT",displayName:"Discount",width:90,enableCellEdit:!1,cellTooltip:function(e,t){return e.entity.DISCOUNT_AMT}},{field:"CHARGEABLE_AMT",displayName:"Total",width:90,enableCellEdit:!1,cellTooltip:function(e,t){return e.entity.CHARGEABLE_AMT}},{field:"commissionRate",displayName:"Commission Rate(%)",width:90,cellTemplate:'<span ng-class="{\'grey\':grid.appScope.rowFormatter(row)}"><input type="text" ng-change="grid.appScope.calcCommRateHide(row, rowRenderIndex)" style="height:26px;border:1px solid #2f3333!important" ng-blur="grid.appScope.calcCommRate(row, rowRenderIndex, grid, col)"  style="boader:1px solid #000" validate-percentage  decimal-upto="2" degits-upto="3" allow-negative="false" ng-model="row.entity.commissionRate" placeholder="Commission Rate" ng-disabled="grid.appScope.aCNU.calcCommRateDis"></span>',cellTooltip:function(e,t){return e.entity.commissionRate}},{field:"commissionAmount",displayName:"Commission Amount",width:90,enableCellEdit:!1,cellTooltip:function(e,t){return e.entity.commissionAmount}},{field:"action",displayName:"Action",width:60,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="glyphicon glyphicon-remove" style="padding-left:10px;" ng-click="grid.appScope.removeOneService(row, rowRenderIndex, grid, col);" ng-disabled="removeDisable"></span></div>',cellTooltip:function(e,t){return e.entity.action}}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("agentCommissionSeviceSelectGrid",{multiSelect:!0,enableHorizontalScrollbar:1,enableVerticalScrollbar:1,enableColumnMenus:!1,enableSorting:!0,paginationPageSizes:[10,16,32,64],paginationPageSize:10,columnDefs:[{field:"slno",displayName:"SL No",width:70,cellTooltip:function(e,t){return e.entity.slno}},{field:"SERV_CODE",displayName:"Service Code",width:110,cellTooltip:function(e,t){return e.entity.SERV_CODE}},{field:"SERV_NAME",displayName:"Service Name",width:180,cellTooltip:function(e,t){return e.entity.SERV_NAME}},{field:"ORD_DATE",displayName:"Order Date",type:"date",cellFilter:'date:"dd-MM-yyyy"',width:160,cellTooltip:function(e,t){return e.entity.ORD_DATE}},{field:"SERVICE_RATE",displayName:"Rate",width:100,cellTooltip:function(e,t){return e.entity.SERVICE_RATE}},{field:"QTY",displayName:"QTY",width:80,cellTooltip:function(e,t){return e.entity.QTY}},{field:"TAX_AMT",displayName:"Tax",width:100,cellTooltip:function(e,t){return e.entity.TAX_AMT}},{field:"DISCOUNT_AMT",displayName:"Discount",width:100,cellTooltip:function(e,t){return e.entity.DISCOUNT_AMT}},{field:"CHARGEABLE_AMT",displayName:"Total",width:120,cellTooltip:function(e,t){return e.entity.CHARGEABLE_AMT}}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("discountModelGridDef",{enableHorizontalScrollbar:0,columnDefs:[{name:"radio_row",displayName:"",width:"35",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align: center;"><input type="radio" name="discountRadio" ng-init="discountRow=0" ng-value="true" ng-model="discountRow" ng-click="grid.appScope.onRadioBtnClick(row)" style="border:none"></div>'},{name:"DISCOUNT_NAME",displayName:"Discount Type"},{name:"IS_BILL_OR_SERVICE_LEVEL",displayName:"Applicability"},{name:"STATUS",displayName:"Status"}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("discountServiceGridDef",{enableSorting:!1,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:0,columnDefs:[{name:"primayServiceGroup",displayName:"Primay Service Group",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div  class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.primayServiceGroup"  ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.dmc.psgdwn_copay track by dept.CODE" ng-change="grid.appScope.dmc.loadDeptDropdown(row.entity.primayServiceGroup,rowRenderIndex)"><option selected hidden="" style="">Select One</option></select></div>'},{name:"department",displayName:"Department",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.department" ng-change="grid.appScope.dmc.OnChangeDept(row.entity,rowRenderIndex)" ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.dmc.deptdwn_copay[rowRenderIndex] track by dept.CODE"><option selected hidden="" style="">Select One</option></select></div>'},{name:"speciality",displayName:"Speciality",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.speciality" ng-options="spe as spe.DESCRIPTION for spe in grid.appScope.dmc.deptSpecicityService[rowRenderIndex] track by spe.CODE"><option selected hidden="" style="">Select One</option></select></div>'},{name:"service",displayName:"Service",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" class="form-control" ng-disabled="row.entity.isEditable"ng-model="row.entity.service" placeholder="service" uib-typeahead="suppliersList as suppliersList.SERV_NAME for suppliersList in grid.appScope.dmc.serchOptimSpeciSerch($viewValue,rowRenderIndex,row.entity)"  typeahead-on-select="grid.appScope.dmc.setdWData(row.entity.service,rowRenderIndex)" style="" typeahead-append-to-body=true ></div>'},{name:"discountType",displayName:"Discount",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.discountType" ng-change="grid.appScope.dmc.validateDiscountVal(row.entity)" ng-options="dept as dept.DETAIL_DESC for dept in grid.appScope.dmc.discountTypeList track by dept.DT_CODE"></select></div>'},{name:"discountValue",displayName:" ",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" class="form-control" ng-disabled="row.entity.isEditable" number-with-decimal decimal-upto="2" allow-negative="false" ng-blur="grid.appScope.dmc.validateDiscountVal(row.entity)" my-maxlength="15" ng-model="row.entity.discountValue" placeholder="Enter" style=""></div>'},{name:"actions",displayName:"Actions",enableSorting:!1,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents action-row copay-grid-action-icons" ng-if="row.entity.isFirstRow"><i class="fa fa-pencil" ng-click="grid.appScope.dmc.editRow(row.entity,rowRenderIndex)"></i><i class="fa fa-trash" ng-click="grid.appScope.dmc.deleteRow(row.entity,rowRenderIndex)"></i></div><div class="ui-grid-cell-contents"><button ng-if="(!row.entity.isFirstRow && !grid.appScope.editRowFlag)" class="his-btn his-btn-info his-grid-btn" ng-click="grid.appScope.dmc.discountMasterServiceGridList(row.entity,rowRenderIndex)"><i class="fa fa-plus"></i> Add</button><button ng-if="grid.appScope.editRowFlag"class="his-btn his-btn-info his-grid-btn" ng-click="grid.appScope.dmc.updateDiscountServiceGrid(row.entity,rowRenderIndex)"><i class="fa fa-plus"></i> Update</button></div>'}]})}(),function(){"use strict";function e(e,t,a,i,r,n,l){var s=function(e,t){var a=[];if(1==e.applicability){var i={collectionSeqId:e.discount.CONC_SEQ_ID?e.discount.CONC_SEQ_ID:void 0,discountSeqId:e.discSeqId?e.discSeqId:void 0,isBillOrServiceLevel:e.applicability,discountType:e.discountType?e.discountType.DT_CODE:void 0,discountValue:e.discountText,gnStatus:e.gnStatus};e.discount&&(i.discountName=e.discount),e.discount&&e.discount.DISCOUNT_NAME&&(i.discountName=e.discount.DISCOUNT_NAME),a.push(i)}if(2==e.applicability){var r=t instanceof Array?t:[t];angular.forEach(r,function(t,i){if(t.primayServiceGroup){var r={collectionSeqId:e.discount.CONC_SEQ_ID?e.discount.CONC_SEQ_ID:void 0,discountSeqId:t.discSeqId?t.discSeqId:void 0,discountName:t.discountName?t.discountName:void 0,servSeqId:t.service?t.service.SERV_SEQ_ID:void 0,primaryServiceSeqId:t.primayServiceGroup?t.primayServiceGroup.CODE:void 0,deptCode:t.department?t.department.CODE:void 0,seplCode:t.speciality?t.speciality.CODE:void 0,isBillOrServiceLevel:e.applicability,discountType:t.discountType?t.discountType.DT_CODE:void 0,discountValue:t.discountValue?t.discountValue:void 0,serviceHierarcyLevel:t.serviceHierarcyLevel,gnStatus:t.gnStatus?t.gnStatus:e.gnStatus};a.push(r)}})}return a};this.saveDiscountMasterData=function(a,i){var r={},n={"@class":"com.napier.core.billgeneration.vo.DiscountMastersVoList",discountMastersVoList:[{"com.napier.core.billgeneration.vo.DiscountMastersVo":s(a,i)}]};return r.url=e.HISSERVICETYPES.URL,r.requestData={operation:"saveDiscountMasters",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:n},t.sendRestRequest(r)};var o=function(e){var t=[];if(1==e.IS_BILL_OR_SERVICE_LEVEL){var a={discountName:e.DISCOUNT_NAME,isBillOrServiceLevel:1,discountType:e.discountType?e.discountType.DT_CODE:void 0,discountValue:e.discountText,gnStatus:e.gnStatus};t.push(a)}return t};this.updateDiscountMasterData=function(a){var i={},r={"@class":"com.napier.core.billgeneration.vo.DiscountMastersVoList",discountMastersVoList:[{"com.napier.core.billgeneration.vo.DiscountMastersVo":o(a)}]};return i.url=e.HISSERVICETYPES.URL,i.requestData={operation:"saveDiscountMasters",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:r},t.sendRestRequest(i)}}e.$inject=["SCHEDULERAPIS","CallManager","$q","QueryService","IPINDENTAPIS","$filter","hisAlertService"],angular.module("napierContainerUi").service("discountMasterService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("MISSubGroupMasterDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,multiSelect:!1,columnDefs:[{field:"companyId",displayName:"Description",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"companyName",displayName:"Code",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"}],enablePaginationControls:!1,useExternalSorting:!1,enableColumnMenus:!1,paginationPageSize:1})}(),function(){"use strict";angular.module("napierContainerUi").constant("SIGMasterSubPageDefinition1",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,multiSelect:!0,columnDefs:[{field:"administerByDesc",displayName:"prescriptions.admby",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"}],enablePaginationControls:!1,useExternalSorting:!1,enableColumnMenus:!1,paginationPageSize:1}).constant("SIGMasterSubPageDefinition2",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,multiSelect:!0,columnDefs:[{field:"directionDesc",displayName:"prescriptions.direction",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"}],enablePaginationControls:!1,useExternalSorting:!1,enableColumnMenus:!1,paginationPageSize:1})}(),function(){"use strict";function e(e,t,a,i,r){this.displayDataService=function(a){var i=e.defer(),r={url:"HISServices/HITService",requestData:{operation:"retriveSigMaster",messageId:"",destination:"com.napier.core.master.service.external.PrescriptionMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.SigMaster",sigDirectionSeqId:-999,sigCode:-999,formSeqId:-999,formTypeSeqId:-999,sigAdministerByMasterSeqId:-999,gnStatus:1,sigMasterSeqId:-999}}};return t.sendRestRequest(r).then(function(e){var t=e.data.HITService,a=(e.data,e.data.HITService.message,[]);a[0]=t?e.data.HITService.message.sigAdministerByMasterSeqId[0]["com.napier.core.service.vo.emrmasters.SigAdministerByMaster"]:[],a[1]=t?e.data.HITService.message.sigDirectionSeqId[0]["com.napier.core.service.vo.emrmasters.SigDirectionMaster"]:[];var r=getArrayObjects(a);i.resolve(r)}).then(function(e){i.reject(e)}),i.promise},this.saveSigMasterService=function(a){var i=e.defer(),r={"@class":"com.napier.core.service.vo.emrmasters.SigMaster",sigDirectionSeqId:[{"com.napier.core.service.vo.emrmasters.SigDirectionMaster":a.sigDirectionMasterSeqIdArray}],sigAdministerByMasterSeqId:[{"com.napier.core.service.vo.emrmasters.SigAdministerByMaster":a.sigAdministerByMasterSeqIdArray}],gnStatus:{code:1},formSeqId:{drugFormMasterSeqId:a.drugseqid},formTypeSeqId:{drugFormTypeMasterSeqId:a.drugtypeseqid},drugformtypeasso:{drugFormTypeAssoSeqId:a.drugassoc,drugFormSeqId:a.drugseqid,drugFormTypeSeqId:a.drugtypeseqid,status:1},status:1},n={url:"HISServices/HITService"};return n.requestData={operation:"saveSigMaster",messageId:"",destination:"com.napier.core.master.service.external.PrescriptionMasterService",message:r},t.sendRestRequest(n).then(function(e){i.resolve(e)}),i.promise},this.displayUpdateDataService=function(a){var i=e.defer(),r={"@class":"com.napier.core.service.vo.emrmasters.SigMaster",gnStatus:{code:1},formSeqId:{drugFormMasterSeqId:a.drugseqid},formTypeSeqId:{drugFormTypeMasterSeqId:a.drugtypeseqid},status:1},n={url:"HISServices/HITService"};return n.requestData={operation:"getSigMaster",messageId:"",destination:"com.napier.core.master.service.external.PrescriptionMasterService",message:r},t.sendRestRequest(n).then(function(e){var t=e.data.HITService,a=(e.data,e.data.HITService.message,[]);a[0]=t?e.data.HITService.message.sigAdministerByMasterSeqId[0]["com.napier.core.service.vo.emrmasters.SigAdministerByMaster"]:[],a[1]=t?e.data.HITService.message.sigDirectionSeqId[0]["com.napier.core.service.vo.emrmasters.SigDirectionMaster"]:[];var r=getArrayObjects(a);i.resolve(r)}).then(function(e){i.reject(e)}),i.promise}}e.$inject=["$q","CallManager","$log","PrintService","QueryService"],angular.module("napierContainerUi").service("SIGMasterPageService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("agentViewGridList",{enableSorting:!1,enenableRowHeaderSelection:!1,enableHorizontalScrollbar:0,multiSelect:!1,showGridFooter:!1,paginationPageSizes:[10,16,32,64],paginationPageSize:10,columnDefs:[{field:"refAgentCode",displayName:"Agent Code"},{field:"refAgentName",displayName:"Agent Name"},{field:"status",displayName:"Status",cellTemplate:'<div><md-switch  ng-true-value="1" ng-false-value="2" ng-model="row.entity.status" ng-change="grid.appScope.agentCorpClick(row.entity,rowRenderIndex)" class=" md-primary actionSwitch" aria-label="Switch 1" style="display:initial;">{{(row.entity.status==1)?"Active":"Inactive"}}</md-switch></div>'},{displayName:"Actions",field:"actions",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div><img class="edit" ng-show="row.entity.editPermissionId==\'U\'" src="assets/icons/edit_ic.png" ng-click="row.entity.status==1&&grid.appScope.editrow(row.entity,rowRenderIndex)"><i class="fa fa-eye" ng-show="row.entity.permissionId==\'V\'" ng-click="grid.appScope.editView(row.entity,rowRenderIndex)"></i></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("appWorklistGridDef",{enableSorting:!0,enableCellEditOnFocus:!1,enableRowHeaderSelection:!1,multiSelect:!1,enableFiltering:!1,enableFullRowSelection:!0,enableSelection:!1,enableHorizontalScrollbar:1,paginationPageSizes:[10,25,50,100],paginationPageSize:10,columnDefs:[{name:"statusCode",displayName:"",cellTemplate:"<div></div>",cellClass:function(e,t,a,i,r){return 1==e.getCellValue(t,a)?"blue-bg-cell":2==e.getCellValue(t,a)?"green-bg-cell":3==e.getCellValue(t,a)?"red-bg-cell":4==e.getCellValue(t,a)?"orange-bg-cell":void 0},width:"3"},{name:"billDate",displayName:"billing.billDtOrTme",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"13%"},{name:"reqno",displayName:"billing.requstNum",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"10%"},{name:"billno",displayName:"billing.billNo",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"10%"},{name:"MR",displayName:"billing.mrno",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"10%"},{name:"Patient",displayName:"billing.patientName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"10%"},{name:"Billa",displayName:"billing.billAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"10%"},{name:"reqfor",displayName:"billing.reqstFor",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"10%"},{name:"reqtype",displayName:"billing.reqstType",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"10%"},{name:"status",displayName:"billing.status",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"10%"},{name:"amountreq",displayName:"billing.amtRequest",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"13%"},{name:"approvalAmt",displayName:"billing.amtApprve",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"13%"},{name:"approvalRejectedBy",displayName:"billing.apprveOrRejctBy",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"14%"},{name:"approvalRejectedOn",displayName:"billing.apprveOrRejctOn",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"14%"},{name:"visitNo",displayName:"billing.visitNo",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"8%"}],useExternalSorting:!1,enableColumnMenus:!1}).constant("approveRejectConcessionGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"approve",displayName:"billing.Approve",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"7%",cellTemplate:'<div class="ui-grid-cell-contents"><input ng-disabled="!row.entity.reqbillLimitPercent || !grid.appScope.awl.disableOnView" style="border:none; " type="checkbox" ng-model="row.entity.hasApproved" ng-change="grid.appScope.awl.isApproved(row.entity)"/></div>'},{name:"reject",displayName:"billing.reject",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"5%",cellTemplate:'<div class="ui-grid-cell-contents"><input ng-disabled="!row.entity.reqbillLimitPercent || !grid.appScope.awl.disableOnView" style="border:none;" type="checkbox" ng-model="row.entity.hasRejected" ng-change="grid.appScope.awl.isRejected(row.entity)"/></div>'},{name:"billno",displayName:"billing.billNo",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"12%"},{name:"billamount",displayName:"billing.billAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"9%"},{name:"billdate",displayName:"billing.billDate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"15%"},{name:"billLimitPercent",displayName:"billing.limitWithSybml",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"8%",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="row.entity.masterAmountType == 1">{{row.entity.billLimitPercent}}</div></div>'},{name:"limitamt",displayName:"billing.limitAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"12%",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="row.entity.masterAmountType == 2">{{row.entity.limitamt}}</div></div>'},{name:"requestedAmount",displayName:"billing.concssionRequst",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"17%",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="row.entity.defaultamountType == 1">{{row.entity.reqConession}}</div> <div ng-if="row.entity.defaultamountType == 2"  class="">{{row.entity.requestedAmount}}</div></div>'},{name:"concessionRequest",displayName:"billing.cncessionAprroved",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><input id="g" ng-keyup="grid.appScope.awl.checkValue(row.entity, \'bill\')" style="width:55px;float:left;padding: 3px;position:relative;top: -4px;" class="form-control" ng-model="row.entity.concessionRequest" ng-blur="grid.appScope.awl.concessionCompare(row.entity, \'bill\')" ng-disabled="!row.entity.hasApproved || !grid.appScope.awl.disableOnView" ng-if="!row.entity.hasRejected" /><select style="width:55px;margin-left:3px;float:left" class="form-control" ng-disabled="!row.entity.hasApproved || !grid.appScope.awl.disableOnView" ng-options="concession.CODE as concession.DESCRIPTION for concession in grid.appScope.awl.conReqCombo" ng-model="row.entity.amountType" ng-change="grid.appScope.awl.concessionCompareChange(row.entity, \'bill\')"></select></div>',width:"130"}],useExternalSorting:!1,enableColumnMenus:!1}).constant("approveRejectServiceGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,columnDefs:[{name:"approve",displayName:"billing.Approve",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><input ng-disabled="!row.entity.reqserviceLimitPercent || !grid.appScope.awl.disableOnView" style="border:none;" type="checkbox" ng-model="row.entity.hasApproved" ng-change="grid.appScope.awl.isApproved(row.entity)"/></div>'},{name:"reject",displayName:"billing.reject",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><input ng-disabled="!row.entity.reqserviceLimitPercent || !grid.appScope.awl.disableOnView" style="border:none;" type="checkbox" ng-model="row.entity.hasRejected" ng-change="grid.appScope.awl.isRejected(row.entity)"/></div>'},{name:"serviceCode",displayName:"billing.serviceCode",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"serviceName",displayName:"billing.serviceName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"serviceCost",displayName:"billing.serviceCost",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"serviceQuantity",displayName:"billing.quantity",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"totalAmount",displayName:"billing.totalCost",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"serviceLimitPercent",displayName:"billing.limitWithSybml",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="row.entity.masterAmountType == 1">{{row.entity.serviceLimitPercent}}</div></div>'},{name:"serviceLimitAmount",displayName:"billing.limitAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="row.entity.masterAmountType == 2">{{row.entity.serviceLimitAmount}}</div></div>'},{name:"reqserviceLimitPercent",displayName:"billing.requestPer",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="row.entity.defaultamountType == 1">{{row.entity.reqserviceLimitPercent}} </div></div>'},{name:"reqserviceLimitAmount",displayName:"billing.reqAmount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="row.entity.defaultamountType == 2">{{row.entity.reqserviceLimitAmount}} </div></div>'},{name:"concessionRequest",displayName:"billing.apprveAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"concessionRequest",displayName:"billing.cncessionAprroved",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div  class="ui-grid-cell-contents"><input class="g" ng-keyup="grid.appScope.awl.checkValue(row.entity, \'service\')" style="width:55px;float:left;padding: 3px;position:relative;top: -4px;" class="form-control" ng-model="row.entity.concessionRequest" ng-blur="grid.appScope.awl.concessionCompare(row.entity, \'service\')" ng-disabled="!row.entity.hasApproved || !grid.appScope.awl.disableOnView" ng-if="!row.entity.hasRejected" /><select style="width:55px;margin-left:5px;float:left" class="form-control" ng-disabled="!row.entity.hasApproved || !grid.appScope.awl.disableOnView" ng-options="concession.CODE as concession.DESCRIPTION for concession in grid.appScope.awl.conReqCombo" ng-model="row.entity.amountType" ng-change="grid.appScope.awl.concessionCompareChange(row.entity, \'service\')"></select></div>',width:"130"}],useExternalSorting:!1,enableColumnMenus:!1}).constant("SplitBillGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:2,columnDefs:[{name:"approve",displayName:"billing.Approve",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"10%",cellTemplate:'<div class="ui-grid-cell-contents"><input ng-disabled="!grid.appScope.awl.disableOnView" style="border:none;" type="checkbox" ng-model="row.entity.hasApproved" ng-change="grid.appScope.awl.isSplitBillApproved(row.entity)"/></div>'},{name:"reject",displayName:"billing.reject",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"10%",cellTemplate:'<div class="ui-grid-cell-contents"><input ng-disabled="!grid.appScope.awl.disableOnView" style="border:none;" type="checkbox" ng-model="row.entity.hasRejected" ng-change="grid.appScope.awl.isSplitBillRejected(row.entity)"/></div>'},{name:"billno",displayName:"billing.billNo",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"Billa",displayName:"billing.billAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"billDate",displayName:"billing.billDate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"}],useExternalSorting:!1,enableColumnMenus:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("appWorklistGridData",[{id:1302,name:"Biochemistry"},{id:760299435,name:"Hematology"},{id:1305,name:"Microbiology"}]).constant("statusCodeConstant",{PENDING:1,APPROVED:2,REJECTED:3,CANCELLED:4}).constant("requestForCodeConstant",{CONCESSION:1,REFUND:2,AUTHENTICATION:3,MERGEBILL:4,SPLITBILL:5,WRITEOFF:6,OPPARTIALPAID:7})}(),function(){"use strict";angular.module("napierContainerUi").constant("appWorklistGridData",[]).constant("appWorklistFormGridData",[])}(),function(){"use strict";function e(e,t,a,i,r,n,l){function s(e,t){var a=e*(t/100);return null==a||!angular.isNumber(a)||isNaN(a)?"":a.toFixed(2)}function o(e,t){if(t>=e)var a=100;else a=t/e*100;return a.toFixed(2)}function c(e){if(null!=e){var t=e.split("."),a=t[t.length-1];if(t[0].length>8)var i=t[0].slice(0,5)+"..."+a;else i=e;return i}}function d(e){return e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]}this.getTodayStatistics=function(){var i=e.defer(),r={};return r.url=t.HISDEPOSITSEARCH.URL,r.requestData={operation:"ExecuteQuery",messageId:"",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"GET_APPROVAL_WORK_LIST_STATUS_COUNT",idxList:[{"com.napier.core.service.vo.query.Index":[]}]}]}]}},a.sendRestRequest(r).then(function(e){if(e.data.HITService.message.queryList&&e.data.HITService.message.queryList.length>0){var t=e.data.HITService.message.queryList;if(t[0]["com.napier.core.service.vo.query.Query"].rowList&&t[0]["com.napier.core.service.vo.query.Query"].rowList.length){var a=t[0]["com.napier.core.service.vo.query.Query"].rowList;if(a[0]["com.napier.core.service.vo.query.Row"]){var r=a[0]["com.napier.core.service.vo.query.Row"],n={};angular.isArray(r)?angular.forEach(r,function(e,t){angular.forEach(e.columnList,function(e,t){var a=e["com.napier.core.service.vo.query.Column"];a&&a.length>0&&(a[1].data==l.PENDING&&(n.pending=a[2].data),a[1].data==l.APPROVED&&(n.approved=a[2].data),a[1].data==l.REJECTED&&(n.rejected=a[2].data),a[1].data==l.CANCELLED&&(n.cancelled=a[2].data))})}):angular.forEach(r.columnList,function(e,t){var a=e["com.napier.core.service.vo.query.Column"];a&&a.length>0&&(a[1].data==l.PENDING&&(n.pending=a[2].data),a[1].data==l.APPROVED&&(n.approved=a[2].data),a[1].data==l.REJECTED&&(n.rejected=a[2].data),a[1].data==l.CANCELLED&&(n.cancelled=a[2].data))}),i.resolve(angular.copy(n))}}}},function(e){i.reject("")}),i.promise},this.getGridData=function(i){var r=e.defer(),s={};s=null==i?{"@class":"com.napier.core.service.vo.corebillingconcession.ApprovalWorkListVo",fromDate:"1800-01-01T00:00:00.000Z",toDate:"9999-12-31T23:59:59.999Z",requestFor:"-999",mrNo:"",requestNo:"",status:"-999",billFromDate:"1800-01-01T00:00:00.000Z",billToDate:"9999-12-31T23:59:59.999Z",billNo:"",visitType:"-999"}:{"@class":"com.napier.core.service.vo.corebillingconcession.ApprovalWorkListVo",fromDate:i.fromDate?i.fromDate.format("YYYY-MM-DD")+"T00:00:00.000Z":"1800-01-01T00:00:00.000Z",toDate:i.toDate?i.toDate.format("YYYY-MM-DD")+"T23:59:59.999Z":"9999-12-31T23:59:59.999Z",requestFor:i.reqfor?i.reqfor.CODE:-999,mrNo:i.mrno?i.mrno:"",requestNo:i.reqno?i.reqno:"",status:i.status?i.status.CODE:-999,billFromDate:i.billDate?i.billDate.format("YYYY-MM-DD")+"T00:00:00.000Z":"1800-01-01T00:00:00.000Z",billToDate:i.billDate?i.billDate.format("YYYY-MM-DD")+"T23:59:59.999Z":"9999-12-31T23:59:59.999Z",billNo:i.billno?i.billno:"",visitType:i.visitType?i.visitType.CODE:-999};var o={};return o.url=t.HISDEPOSITSEARCH.URL,o.requestData={operation:"getApprovalList",messageId:"",destination:"com.napier.core.corebillingconcession.service.external.CoreBillingConcessionService",message:s},a.sendRestRequest(o).then(function(e){n=[];var t=e.data.HITService.message;if(Array.isArray(t)&&t.length>0){var a=t[0]["com.napier.core.service.vo.corebillingconcession.ApprovalWorkListVo"];if(null!=a&&Array.isArray(a)&&a.length>0)_.forEach(a,function(e,t){var a={billDate:null!=e.billDate?moment(e.billDate.$).format("DD/MM/YYYY hh:mm A"):"",reqno:e.requestNo?e.requestNo:"",billno:e.billNo?e.billNo:"",MR:e.mrNo?e.mrNo:"",Patient:e.patientName?e.patientName:"",Billa:e.billAmt?e.billAmt:"",reqforCode:e.requestFor?e.requestFor:"",reqfor:e.requestForDesc?e.requestForDesc:"",reqtype:e.requestTypeDesc?e.requestTypeDesc:"",status:e.statusDesc?e.statusDesc:"",statusCode:e.status?e.status:"",amountreq:e.requestedAmt?e.requestedAmt:"",concessionReqSeqId:e.concessioReqSeqId?e.concessioReqSeqId:"",visitNo:e.visitNo?e.visitNo.split(" ")[0]:"",approvalRejectedBy:e.approvalRejectedBy?e.status==l.PENDING?"":e.approvalRejectedBy:"",approvalAmt:e.approvalAmt?e.approvalAmt:"",approvalRejectedOn:e.approvalRejectedOn?e.status==l.PENDING?"":moment(e.approvalRejectedOn.$).format("DD/MM/YYYY hh:mm A"):"",rgSeqId:e.rgSeqId?e.rgSeqId:"",billSeqId:e.billSeqId?e.billSeqId:"",isGridEmpty:!1};n.push(a)});else if(null!=a.responseDesc&&a.responseDesc.length>0){var i={billDate:a.responseDesc,isGridEmpty:!0};n.push(i)}else if(Object.keys(a).length>0){var s={billDate:null!=a.billDate?moment(a.billDate.$).format("DD/MM/YYYY hh:mm A"):"",reqno:a.requestNo?a.requestNo:"",billno:a.billNo?a.billNo:"",MR:a.mrNo?a.mrNo:"",Patient:a.patientName?a.patientName:"",Billa:a.billAmt?a.billAmt:"",reqforCode:a.requestFor?a.requestFor:"",reqfor:a.requestForDesc?a.requestForDesc:"",reqtype:a.requestTypeDesc?a.requestTypeDesc:"",status:a.statusDesc?a.statusDesc:"",statusCode:a.status?a.status:"",amountreq:a.requestedAmt?a.requestedAmt:"",concessionReqSeqId:a.concessioReqSeqId?a.concessioReqSeqId:"",visitNo:a.visitNo?a.visitNo.split(" ")[0]:"",approvalRejectedBy:a.approvalRejectedBy?a.status==l.PENDING?"":a.approvalRejectedBy:"",approvalAmt:a.approvalAmt?a.approvalAmt:"",approvalRejectedOn:a.approvalRejectedOn?a.status==l.PENDING?"":moment(a.approvalRejectedOn.$).format("DD/MM/YYYY hh:mm A"):"",rgSeqId:a.rgSeqId?a.rgSeqId:"",billSeqId:a.billSeqId?a.billSeqId:"",isGridEmpty:!1};n.push(s)}r.resolve(angular.copy(n))}else 0==Object.keys(t).length?console.log("Error:  message is empty"):console.log("Error: "+t)}),r.promise},this.submitApprovalorRejectForm=function(i,r){var n=e.defer(),l=r[0],s={};if(1==l.concessionType){if(l.hasApproved)var o=2;if(l.hasRejected)o=3;s={"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionRequest",concessionReqSeqId:l.concessionReqSeqId,billSeqId:l.billSeqId,concessionStatus:o,concessionType:l.concessionType,tranStatus:"1",approveRemarks:i.approvalRemarks,concessionRequestDetailsList:[{"com.napier.core.service.vo.corebillingconcession.ConcessionRequestDetails":[{concessionReqDetailSeqId:l.concessionReqDetailSeqId,approvedConcession:""!=l.concessionRequest?l.concessionRequest:0,amountType:l.amountType,concessionStatus:o,tranStatus:"1"}]}]}}else if(2==l.concessionType){o=2;s={"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionRequest",concessionReqSeqId:l.concessionReqSeqId,billSeqId:l.billSeqId,concessionStatus:o,concessionType:l.concessionType,tranStatus:"1",approveRemarks:null!=i.approvalRemarks?i.approvalRemarks:"",rejectRemarks:null!=i.cancellationreason?i.cancellationreason:"",concessionRequestDetailsList:[{"com.napier.core.service.vo.corebillingconcession.ConcessionRequestDetails":[]}]};for(var c=0;c<r.length;c++)if(r[c].hasApproved||r[c].hasRejected){if(r[c].hasApproved)o=2;if(r[c].hasRejected)o=3;var d={servSeqId:r[c].servSeqId,servicePostSeqID:r[c].servicePostSeqID,concessionReqDetailSeqId:r[c].concessionReqDetailSeqId,approvedConcession:""!=r[c].concessionRequest?r[c].concessionRequest:0,amountType:r[c].amountType,concessionStatus:o,tranStatus:"1"};s.concessionRequestDetailsList[0]["com.napier.core.service.vo.corebillingconcession.ConcessionRequestDetails"].push(d)}}var p={};return p.url=t.HISDEPOSITSEARCH.URL,p.requestData={operation:"approveORRejectConcessionRequest",messageId:"",destination:"com.napier.core.corebillingconcession.service.external.CoreBillingConcessionService",message:s},a.sendRestRequest(p).then(function(e){e.data.HITService.message.errorCode?n.reject(e.data.HITService.message.errorMessage):n.resolve(angular.copy(e.data.HITService.message))},function(e){n.reject("Server Error")}),n.promise},this.viewConcession=function(n){var l=e.defer(),c={};c=(n.reqtype,{"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionRequest",concessionReqSeqId:n.concessionReqSeqId});var d={};return d.url=t.HISDEPOSITSEARCH.URL,d.requestData={operation:"viewConcessionRequest",messageId:"",destination:"com.napier.core.corebillingconcession.service.external.CoreBillingConcessionService",message:c},a.sendRestRequest(d).then(function(e){i=[],r=[];var t=e.data.HITService.message,a=t.concessionRequestDetailsList[0]["com.napier.core.service.vo.corebillingconcession.ConcessionRequestDetails"];if(null==a)return l.reject("No data");var n=t.concessionReqSeqId,c=t.billSeqId,d=t.concessionReqNo,p=t.concessionSeqId,u=t.concessionType,m=t.reasonForConcession,g=t.remarks,S=t.concessionName,v=null!=t.approveRemarks?t.approveRemarks:"",D=null!=t.rejectRemarks?t.rejectRemarks:"";if(Array.isArray(a))angular.forEach(a,function(e,t){if(1==e.masterAmountType)var a=s(e.billAmount,e.concessionAmount),l=s(e.totalAmount,e.concessionAmount),y=e.concessionAmount,f=e.concessionAmount;else if(2==e.masterAmountType)a=e.concessionAmount,l=e.concessionAmount,y=o(e.billAmount,e.concessionAmount),f=o(e.totalAmount,e.concessionAmount);if(1==e.amountType)var C=e.reqConession,I=s(e.billAmount,e.reqConession),A=e.reqConession,E=s(e.totalAmount,e.reqConession);else C=o(e.billAmount,e.requestedAmount),I=e.requestedAmount,A=o(e.totalAmount,e.requestedAmount),E=e.requestedAmount;var h={defaultamountType:null!=e.amountType?e.amountType:"",billno:null!=e.billNo?e.billNo:"",billamount:null!=e.billAmount?e.billAmount:"",concessionReqDetailSeqId:null!=e.concessionReqDetailSeqId?e.concessionReqDetailSeqId:"",billdate:null!=e.billDate.$?moment(e.billDate.$).format("DD/MM/YYYY hh:mm A"):"",servSeqId:null!=e.servSeqId?e.servSeqId:"",servicePostSeqID:null!=e.servicePostSeqID?e.servicePostSeqID:"",amountType:null!=e.amountType?e.amountType:"",concessionStatus:null!=e.concessionStatus?e.concessionStatus:"",concessionStatusDesc:null!=e.concessionStatusDesc?e.concessionStatusDesc:"",concessionSeqID:null!=e.concessionSeqID?e.concessionSeqID:"",concessionAmount:null!=e.concessionAmount?e.concessionAmount:"",totalAmount:null!=e.totalAmount?e.totalAmount:"",masterAmountType:null!=e.masterAmountType?e.masterAmountType:"",reqConPer:null!=e.reqConPer?e.reqConPer:"",reqConAmt:null!=e.reqConAmt?e.reqConAmt:"",serviceCode:null!=e.serviceCode?e.serviceCode:"",serviceCost:null!=e.serviceCost?e.serviceCost:"",serviceName:null!=e.serviceName?e.serviceName:"",serviceQuantity:null!=e.serviceQuantity?e.serviceQuantity:"",concessionRequest:null!=e.approvedConcession?e.approvedConcession:"",hasApproved:null!=e.concessionStatus&&2==e.concessionStatus,hasRejected:null!=e.concessionStatus&&3==e.concessionStatus,concessionReqSeqId:n,billSeqId:c,concessionReqNo:d,concessionType:u,concessionSeqId:p,limitamt:a,billLimitPercent:y,serviceLimitAmount:l,serviceLimitPercent:f,reasonForConcession:m,remarks:g,concessionName:S,reqbillLimitPercent:C,reqbillLimitAmount:I,reqserviceLimitPercent:A,reqserviceLimitAmount:E,requestedAmount:null!=e.requestedAmount?e.requestedAmount:"",reqConession:null!=e.reqConession?e.reqConession:"",approveRemarks:v,rejectRemarks:D};1==u?i.push(h):r.push(h)});else{if(1==a.masterAmountType)var y=s(a.billAmount,a.reqConession),f=s(a.totalAmount,a.reqConession),C=a.concessionAmount,I=a.concessionAmount;else if(2==a.masterAmountType)y=a.concessionAmount,f=a.concessionAmount,C=o(a.billAmount,a.concessionAmount),I=o(a.totalAmount,a.concessionAmount);if(1==a.amountType)var A=a.reqConession,E=s(a.billAmount,a.reqConession),h=a.reqConession,b=s(a.totalAmount,a.reqConession);else A=o(a.billAmount,a.requestedAmount),E=a.requestedAmount,h=o(a.totalAmount,a.requestedAmount),b=a.requestedAmount;var T={defaultamountType:null!=a.amountType?a.amountType:"",billno:null!=a.billNo?a.billNo:"",billamount:null!=a.billAmount?a.billAmount:"",concessionReqDetailSeqId:null!=a.concessionReqDetailSeqId?a.concessionReqDetailSeqId:"",billdate:null!=a.billDate.$?moment(a.billDate.$).format("DD/MM/YYYY hh:mm A"):"",servSeqId:null!=a.servSeqId?a.servSeqId:"",servicePostSeqID:null!=a.servicePostSeqID?a.servicePostSeqID:"",amountType:null!=a.amountType?a.amountType:"",concessionStatus:null!=a.concessionStatus?a.concessionStatus:"",concessionStatusDesc:null!=a.concessionStatusDesc?a.concessionStatusDesc:"",concessionSeqID:null!=a.concessionSeqID?a.concessionSeqID:"",concessionAmount:null!=a.concessionAmount?a.concessionAmount:"",totalAmount:null!=a.totalAmount?a.totalAmount:"",masterAmountType:null!=a.masterAmountType?a.masterAmountType:"",reqConPer:null!=a.reqConPer?a.reqConPer:"",reqConAmt:null!=a.reqConAmt?a.reqConAmt:"",serviceCode:null!=a.serviceCode?a.serviceCode:"",serviceCost:null!=a.serviceCost?a.serviceCost:"",serviceName:null!=a.serviceName?a.serviceName:"",serviceQuantity:null!=a.serviceQuantity?a.serviceQuantity:"",concessionRequest:null!=a.approvedConcession?a.approvedConcession:"",hasApproved:null!=a.concessionStatus&&2==a.concessionStatus,hasRejected:null!=a.concessionStatus&&3==a.concessionStatus,concessionReqSeqId:n,billSeqId:c,concessionReqNo:d,concessionType:u,concessionSeqId:p,limitamt:y,billLimitPercent:C,serviceLimitAmount:f,serviceLimitPercent:I,reasonForConcession:m,remarks:g,concessionName:S,reqbillLimitPercent:A,reqbillLimitAmount:E,reqserviceLimitPercent:h,reqserviceLimitAmount:b,requestedAmount:null!=a.requestedAmount?a.requestedAmount:"",reqConession:null!=a.reqConession?a.reqConession:"",approveRemarks:v,rejectRemarks:D};1==u?i.push(T):r.push(T)}1==u?l.resolve(angular.copy(i)):l.resolve(angular.copy(r))}),l.promise},this.documentNames=function(i){var r=e.defer(),n={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"QS_CONC_REQ_DOC",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:i.concessionReqSeqId}]}]}]}]},l={};return l.url=t.HISAPPWORKSTATUSCOMBO.URL,l.requestData={operation:"ExecuteQuery",destination:"QueryService",message:n},a.sendRestRequest(l).then(function(e){var t=[],a=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"];t=[];if(null==a)return r.reject("No documents available");var i={};if(Array.isArray(a))angular.forEach(a,function(e,a){var r=e.columnList[0]["com.napier.core.service.vo.query.Column"];angular.forEach(r,function(e,t){var a=e.name;1==a.includes(".",0)&&(i[e.name.substring(a.indexOf(".")+1)]=e.data)}),i.T_NAME=c(i.FILE_NAME),t.push(i),i={}});else{var n=a.columnList[0]["com.napier.core.service.vo.query.Column"];angular.forEach(n,function(e,t){var a=e.name;1==a.includes(".",0)&&(i[e.name.substring(a.indexOf(".")+1)]=e.data)}),i.T_NAME=c(i.FILE_NAME),t.push(i),i={}}r.resolve(t)}),r.promise},this.downloaddocument=function(i){var r=e.defer(),n={"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionReqDocVo",concReqDocSeqId:i},l={};return l.url=t.HISAPPWORKSTATUSCOMBO.URL,l.requestData={operation:"viewConcessionDoc",messageId:"",destination:"com.napier.core.corebillingconcession.service.external.CoreBillingConcessionService",message:n},a.sendRestRequest(l).then(function(e){var t=e.data.HITService.message.requestDocument[0];r.resolve(t)}),r.promise},this.concessionReqCombo=function(){var i=e.defer(),r={};return r.url=t.HISCONCESSIONREQUESTCOMBO.URL,r.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"TRN003",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:6502},{ident:"2",value:6502}]}]}]}]}},a.sendRestRequest(r).then(function(e){var t=d(e),a=[];angular.forEach(t,function(e,t){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={CODE:i[0].data,DESCRIPTION:i[1].data};a.push(r)}),i.resolve(a)}),i.promise},this.requestForCombo=function(){var i=e.defer(),r={};return r.url=t.HISAPPWORKREQFORCOMBO.URL,r.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"QS_CONC_REQ_FOR",idxList:[{"com.napier.core.service.vo.query.Index":[]}]}]}]}},a.sendRestRequest(r).then(function(e){var t=d(e),a=[];angular.forEach(t,function(e,t){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={CODE:i[0].data,DESCRIPTION:i[1].data};a.push(r)}),i.resolve(a)}),i.promise},this.awlStatusCombo=function(){var i=e.defer(),r={};return r.url=t.HISAPPWORKSTATUSCOMBO.URL,r.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"TRN003",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:6018}]}]}]}]}},a.sendRestRequest(r).then(function(e){var t=[],a=d(e);angular.forEach(a,function(e,a){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={CODE:i[0].data,DESCRIPTION:i[1].data};t.push(r)}),i.resolve(t)}),i.promise},this.getComboDataForVisitType=function(){var i=e.defer(),r={};return r.url=t.HISAPPWORKREQFORCOMBO.URL,r.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"MQ_VISIT_TYPE",idxList:[{"com.napier.core.service.vo.query.Index":[]}]}]}]}},a.sendRestRequest(r).then(function(e){var t=d(e),a=[];angular.forEach(t,function(e,t){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={CODE:i[0].data,DESCRIPTION:i[1].data};a.push(r)}),i.resolve(a)}),i.promise},this.updateSplitBillStatus=function(i){var r=e.defer(),n={"@class":"com.napier.core.billgeneration.vo.Bill",billSeqId:i.billSeqId,gnStatus:i.gnStatus,remarks:i.remarks},l={};return l.url=t.HISAPPWORKREQFORCOMBO.URL,l.requestData={operation:"updateSplitBillStatus",destination:"com.napier.core.billgeneration.service.external.BillGenerationService",message:n},a.sendRestRequest(l).then(function(e){var t=e.data.HITService.message;null!=t&&Object.keys(t).length>0&&r.resolve(t)},function(){r.reject("Error")}),r.promise},this.getSplitBillView=function(i){var r=e.defer(),n={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"GET_SPLIT_BILL_REMARKS",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:i}]}]}]}]},l={};return l.url=t.HISAPPWORKREQFORCOMBO.URL,l.requestData={operation:"ExecuteQuery",destination:"QueryService",message:n},a.sendRestRequest(l).then(function(e){var t={},a=!1,i=e.data.HITService.message;if(null!=i&&Object.keys(i).length>0){var n=i.queryList;if(null!=n&&n.length>0){var l=n[0];if(null!=l&&Object.keys(l).length>0){var s=l["com.napier.core.service.vo.query.Query"];if(null!=s&&Object.keys(s).length>0){var o=s.rowList;if(null!=o&&o.length>0){var c=s.rowList[0];if(null!=c&&Object.keys(c).length>0){var d=c["com.napier.core.service.vo.query.Row"].columnList;if(null!=d&&d.length>0){var p=d[0];if(null!=p&&Object.keys(p).length>0){var u=p["com.napier.core.service.vo.query.Column"];null!=u?angular.isArray(u)?(t.statusCode=u[0].data,t.remarks=u[1].data):(t.statusCode=u.data,t.remarks=""):a=!0}else a=!0}else a=!0}else a=!0}else a=!0}else a=!0}else a=!0}else a=!0}else a=!0;a?r.reject("Error"):r.resolve(t)},function(){r.reject("Error")}),r.promise},this.getOPPartialPaidDetails=function(i){var r=e.defer(),n={};return n.url=t.HISAPPWORKREQFORCOMBO.URL,n.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"PARTIALLY_PAID_REQUEST_QUERY",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pReqSeqId",value:i}]}]}]}]}},a.sendRestRequest(n).then(function(e){var t=e.data.HITService.message;if(null!=t&&Object.keys(t).length>0){var a={},i=t.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"].columnList[0]["com.napier.core.service.vo.query.Column"];angular.forEach(i,function(e,t){"REQUEST.BILL_NO"==e.name&&(a.billNumber=e.data),"REQUEST.DUE_AMOUNT"==e.name&&(a.dueAmount=e.data),"REQUEST.PATIENT_AMOUNT"==e.name&&(a.patientAmount=e.data),"REQUEST.PATIENT_PAYING_AMOUNT"==e.name&&(a.patientPayingAmount=e.data),"REQUEST.REQUEST_REMARKS"==e.name&&(a.requestRemarks=e.data),"REQUEST.REQUEST_TYPE"==e.name&&(a.requestType=e.data),"REQUEST.REQUEST_STATUS"==e.name&&(a.requeststatus=e.data),"REQUEST.TOTAL_AMOUNT"==e.name&&(a.totalAmount=e.data),"REQUEST.RG_SEQ_ID"==e.name&&(a.rgSeqId=e.data),"REQUEST.APPRV_REJ_REMARKS"==e.name&&(a.appRejRemarks=e.data),"REQUEST.REQUESTED_BY"==e.name&&(a.requestBy=e.data),"REQUEST.PATIENT_TYPE"==e.name&&(a.patientType=e.data),"REQUEST.VISIT_NO"==e.name&&(a.visitNo=e.data),"DT_STATUS.REQUEST_STATUS_DESCRIPTION"==e.name&&(a.requestStatusDescription=e.data),"DT_REQUEST_FOR.REQUEST_FOR_DESCRIPTION"==e.name&&(a.requestForDescription=e.data)}),r.resolve(a)}},function(){r.reject("Error")}),r.promise},this.opPartialDetailsSave=function(i){var r=e.defer(),n={"@class":"com.napier.core.service.vo.visitmanagement.PartialPaymentAuthorizationVO",partialPaymentSeqId:i.selectedRecord.concessionReqSeqId,requestStatus:parseInt(i.arStatus),requestedBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,requestType:i.partialPaidDetails.requestType,status:1,requestRemarks:i.payAuthRemarks,approvedBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,approvedDate:moment(new Date).format("YYYY-MM-DD HH:mm:ss.000"),aprovalOrRejectionRemarks:i.approvalRejectedRemarks?i.approvalRejectedRemarks:"",totalOrderedAmount:i.payAuthTotalAmount,patientAmount:i.payAuthPatientAmount,patientPayingAmount:i.payAuthPayingAmount,patientDueAmount:i.payAuthDueAmount,approvedAmount:i.payAuthDueAmount,patientType:i.partialPaidDetails.patientType,visit:{visitNo:i.selectedRecord.visitNo},encounter:{enSeqId:i.partialPaidDetails.enSeqId},registration:{rgSeqId:i.selectedRecord.rgSeqId}};""!=i.selectedRecord.billno&&(n.billNo=i.selectedRecord.billno);var l={};return l.url=t.HISAPPWORKREQFORCOMBO.URL,l.requestData={operation:"aproveOrRejectRequest",messageId:"",destination:"com.napier.core.visitmanagement.service.external.PartialPaymentAuthorizationService",message:n},a.sendRestRequest(l).then(function(e){var t=e.data.HITService.message;null!=t&&Object.keys(t).length>0&&r.resolve(t)},function(){r.reject("Error")}),r.promise}}e.$inject=["$q","BILLING_APIS","CallManager","approveRejectConcessionGridDef","approveRejectServiceGridDef","appWorklistGridData","statusCodeConstant"],angular.module("napierContainerUi").service("angapprovalWorklistService",e)}(),function(){"use strict";angular.module("napierContainerUi").service("PatientBannerApproval",["CallManager","QueryService","IPINDENTAPIS","$q",function(e,t,a,i){this.patientBannerDetail=function(r){var n,l,s,o,c=i.defer(),d=sessionStorage.patientArrDetails;if(null!=r)o=r;else if(null==sessionStorage.patientArrDetails){if(null==sessionStorage.NS_BedBoard_patient_record)o=JSON.parse(d).regestrationSeqId;else o=null==JSON.parse(sessionStorage.NS_BedBoard_patient_record).regSeqId?JSON.parse(sessionStorage.NS_BedBoard_patient_record).regestrationSeqId:JSON.parse(sessionStorage.NS_BedBoard_patient_record).regSeqId}else null==sessionStorage.NS_BedBoard_patient_record?o=JSON.parse(sessionStorage.patientArrDetails).regestrationSeqId:null!=sessionStorage.NS_BedBoard_Info&&(o=JSON.parse(sessionStorage.NS_BedBoard_Info).regestrationSeqId);var p,u=[],m={1:u},g=t.executeQueryURLReset(),S=new Array;t.executeQueryInput("MQ0005",S,m,!0,!0,g,"popUp");var v={};return v.url=a.HISIPINDENT.URL,v.requestData={operation:"getRegistrationById",messageId:"",destination:"com.napier.core.registration.service.external.RegistrationService",voclass:"com.napier.core.service.vo.registration.Registration",message:{"@class":"com.napier.core.service.vo.registration.Registration",rgSeqId:o}},e.sendRestRequest(v).then(function(e){n=e.data.HITService.message.patient;var t,a=e.data.HITService.message.patient.patientAddress[0]["com.napier.core.service.vo.emrmasters.AddressMasterGenericVo"];if(l=a instanceof Array?l[0]:a,l.levelMappingVoList[0]["com.napier.core.service.vo.emrmasters.LevelMappingVo"][0],!angular.isUndefined(n.bloodGroup.code))for(var i=0;i<u.length;i++)u[i].gQDataCode==n.bloodGroup.code&&(p=u[i].gQDataName);null!=e.data.HITService.message.insuranceList&&(t=e.data.HITService.message.insuranceList[0]["com.napier.core.service.vo.registration.Insurance"]),s={insurance:t,patientRecordsDetail:e.data.HITService.message.patient,patientValue:n.patientAddress[0]["com.napier.core.service.vo.emrmasters.AddressMasterGenericVo"][0],patientAddress:l.levelMappingVoList[0]["com.napier.core.service.vo.emrmasters.LevelMappingVo"][0],bloodGroupName:p},c.resolve(s)},function(e){c.reject(e)}),c.promise}}])}(),function(){"use strict";angular.module("napierContainerUi").constant("onaccountDepositsDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,multiSelect:!1,enableHorizontalScrollbar:0,columnDefs:[{field:"onaccdepNo",displayName:"billing.depositAccNo",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"payerName",displayName:"billing.companyNameid",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"depositedAmt",displayName:"billing.depositAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"adjustedAmt",displayName:"billing.adjAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"balAmt",displayName:"billing.availDeposit",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"onaccDepositStatusDesc",displayName:"billing.PaymentStatus",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"}],enablePaginationControls:!1,useExternalSorting:!1,enableColumnMenus:!1,paginationPageSize:1})}(),function(){"use strict";angular.module("napierContainerUi").constant("serviceMappingGrid",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!0,enableRowSelection:!0,enableSelection:!1,multiSelect:!1,rowTemplate:'<div ng-click="grid.appScope.billingConfig.rowDblClick(row)" >  <div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell"  ui-grid-cell></div></div>',columnDefs:[{name:"serviceCode",displayName:"billing.serviceCode",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*"},{name:"serviceName",displayName:"billing.serviceName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*"}],useExternalSorting:!1,enableColumnMenus:!1}).constant("serviceDiscountGrid",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableRowSelection:!0,enableHorizontalScrollbar:0,columnDefs:[{name:"serviceCode",displayName:"billing.serviceCode",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*"},{name:"serviceName",displayName:"billing.serviceName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*"},{name:"discountPercentage",displayName:"billing.discount%",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="!row.entity.editable"><span ng-if="row.entity.discountPercentage">{{row.entity.discountPercentage}} %</span><span ng-if="!row.entity.discountPercentage">%</span></div><div ng-if="row.entity.editable"><input type="number" class="form-control" ng-model="row.entity.discountPercentage" ng-blur="grid.appScope.billingConfig.discountAmountBlur(row)" />%</div>'},{name:"gnStatus",displayName:"billing.action",headerCellFilter:"translate",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents discount-grid-actions action-row"><md-switch ng-click="" ng-true-value="1" ng-false-value="2" ng-model="row.entity.gnStatus" ng-change="grid.appScope.billingConfig.activeInactive(row)" class=" md-primary actionSwitch" aria-label="Switch 1" style="display:initial;">{{(row.entity.gnStatus==1)?"Active":"Inactive"}}</md-switch><i class="fa fa-pencil" style="margin-left: 5px;" ng-click="row.entity.gnStatus==1&&grid.appScope.billingConfig.editDetails(row)"></i></div>',width:"*"}],useExternalSorting:!1,enableColumnMenus:!1}).constant("deptGridConst",{enableSorting:!0,enableCellEdit:!1,enableCellEditOnFocus:!1,enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("slotLevelGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!0,enableRowSelection:!0,enableSelection:!1,multiSelect:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"byFixedSlot",displayName:"By Fixed Slot",enableSorting:!0,enableCellEdit:!1,width:140,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><span ng-show="row.entity.isfirst" style="color:#ffffff; margin-right:7px;">-</span><input type="radio" ng-model=row.entity.freqyradio name="radiofreq" ng-value=1 ng-selected="true"  ng-show="!row.entity.isfirst" ng-change="grid.appScope.eqp.setGridInputs(eqp.gridOptions.data.length-1,eqp.gridOptions.data[eqp.gridOptions.data.length-1])""><input type="text" numbers-only ng-blur="grid.appScope.eqp.slotValid(row,rowRenderIndex,true)" ng-disabled="row.entity.isEdited||row.entity.freqyradio==2" allow-negative="false"  ng-model=row.entity.byFixedSlot min=0 max=24 class="form-control" style="width:100px; padding: auto 6px; display: inline;" placeholder="From"><span>-</span></div>'},{name:"dummyField",displayName:" ",enableSorting:!0,enableCellEdit:!1,width:240,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><input type="text" min=1 max=24 numbers-only  ng-disabled=row.entity.isEdited||row.entity.freqyradio==2 ng-model=row.entity.dummyField my-maxlength="2" ng-blur="grid.appScope.eqp.slotValid(row,rowRenderIndex,true)" class="form-control" style="width:100px; padding: auto 6px; display: inline;" placeholder="To"></div>'},{name:"byFrequencySlot",displayName:"By Frequency Slot",enableSorting:!0,enableCellEdit:!1,width:250,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><span ng-show="row.entity.isfirst" style="color:#ffffff; margin-right:7px;">-</span><input type="radio" ng-model=row.entity.freqyradio name="radiofreq" ng-value=2 ng-change="grid.appScope.eqp.setGridInputs(eqp.gridOptions.data.length,eqp.gridOptions.data[eqp.gridOptions.data.length])" ng-show="!row.entity.isfirst"><span>></span><input type="text" numbers-only  allow-negative="false" min=1 max=24 my-maxlength="2" class="form-control" ng-disabled="row.entity.isEdited||row.entity.freqyradio==1" ng-model=row.entity.byFrequencySlot style="width:100px; padding: auto 6px; display: inline;" ><span ng-show="(row.entity.freqyradio==2&&row.entity.isfirst)||(!row.entity.isfirst)">hrs</span><label><strong ng-show="(row.entity.freqyradio==2&&row.entity.isfirst)||(!row.entity.isfirst)">every</strong></label></div>'},{name:"dummyField2",displayName:" ",enableSorting:!0,enableCellEdit:!1,width:250,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><input type="text" numbers-only my-maxlength="4" max="1440" allow-negative="false" ng-model=row.entity.dummyField2 ng-disabled="row.entity.isEdited||row.entity.freqyradio==1" class="form-control" style="width:100px; padding: auto 6px; display: inline;" min=eqp.gridOptions.data[eqp.gridOptions.data.dummyField]><span ng-show=(row.entity.freqyradio==2&&row.entity.isfirst)||(!row.entity.isfirst)>min</span></div>'},{name:"status",displayName:"Actions",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-actions action-row"><button class="his-btn his-btn-info his-grid-btn" ng-if="!row.entity.isfirst" ng-click="grid.appScope.eqp.addRow(row,rowRenderIndex);grid.appScope.otcc.addRow(row,rowRenderIndex)">Add</button><i class="fa fa-pencil" ng-if="row.entity.isfirst" ng-disabled="row.entity.status==2" ng-click="grid.appScope.eqp.chng2edit(row,rowRenderIndex);grid.appScope.otcc.chng2edit(row,rowRenderIndex)"></i><md-switch class="md-primary actionSwitch" ng-true-value="1"  ng-false-value="2" ng-change="grid.appScope.eqp.status(row.entity,rowRenderIndex);grid.appScope.otcc.status(row.entity.status,rowRenderIndex)" ng-model="row.entity.status" ng-if="row.entity.isfirst" style="margin:0px;display:inline;"></md-switch>'}]}).constant("theaterslotLevelGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!0,enableRowSelection:!0,enableSelection:!1,multiSelect:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"byFixedSlot",displayName:"By Fixed Slot",enableSorting:!0,enableCellEdit:!1,width:130,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><span ng-show="row.entity.isfirst" style="color:#ffffff; margin-right:14px;">-</span><input type="radio" ng-model="row.entity.freqyradio" name="radiofreq" ng-value=1 ng-selected="true"  ng-show="!row.entity.isfirst" ng-change="grid.appScope.otcc.setGridInputs(otcc.gridOptions.data.length-1,otcc.gridOptions.data[otcc.gridOptions.data.length-1])""><input ng-blur="grid.appScope.otcc.slotValid(row,rowRenderIndex,true)" ng-disabled="row.entity.isEdited||row.entity.freqyradio==2" type="text" ng-model="row.entity.byFixedSlot" min=0 max=24 class="form-control" style="width:100px; padding: auto 6px; display: inline;" placeholder="From"><span>-</span></div>'},{name:"dummyField",displayName:" ",enableSorting:!0,enableCellEdit:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><input type="text" ng-disabled="row.entity.isEdited||row.entity.freqyradio==2" ng-blur="grid.appScope.otcc.slotValid(row,rowRenderIndex,true)" ng-model="row.entity.dummyField" class="form-control" style="width:100px; padding: auto 6px; display: inline;" placeholder="To" min="1" max="24"></div>'},{name:"byFrequencySlot",displayName:"By Frequency Slot",enableSorting:!0,enableCellEdit:!1,width:190,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><span ng-show="row.entity.isfirst" style="color:#ffffff; margin-right:14px;">-</span><input type="radio" ng-model="row.entity.freqyradio" name="radiofreq" ng-value=2 ng-change="grid.appScope.otcc.setGridInputs(otcc.gridOptions.data.length,otcc.gridOptions.data[otcc.gridOptions.data.length])" ng-show="!row.entity.isfirst"><span>></span><input type="text" class="form-control" ng-disabled="row.entity.isEdited||row.entity.freqyradio==1" ng-model="row.entity.byFrequencySlot" style="width:100px; padding: auto 6px; display: inline;" min="1" max="24"><span style="margin-right: 7px;" ng-show="(row.entity.freqyradio==2&&row.entity.isfirst)||(!row.entity.isfirst)">hrs</span><label><strong ng-show="(row.entity.freqyradio==2&&row.entity.isfirst)||(!row.entity.isfirst)">every</strong></label></div>'},{name:"dummyField2",displayName:" ",enableSorting:!0,enableCellEdit:!1,width:145,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template action-row"><input type="text" ng-model="row.entity.dummyField2" ng-disabled="row.entity.isEdited||row.entity.freqyradio==1" class="form-control" style="width:100px; padding: auto 6px; display: inline;" min=otcc.gridOptions.data[otcc.gridOptions.data.dummyField] max="59"><span ng-show="(row.entity.freqyradio==2&&row.entity.isfirst)||(!row.entity.isfirst)">min</span></div>'},{name:"status",displayName:"Actions",enableSorting:!0,enableCellEdit:!1,width:80,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-actions action-row"><button class="his-btn his-btn-info his-grid-btn" ng-if="!row.entity.isfirst" ng-click="grid.appScope.otcc.addRow(row,rowRenderIndex)">Add</button><i class="fa fa-pencil" ng-if="row.entity.isfirst" ng-disabled="row.entity.status==2" ng-click="grid.appScope.otcc.chng2edit(row,rowRenderIndex)"></i><md-switch class="md-primary actionSwitch" ng-true-value="1"  ng-false-value="2" ng-value="1" ng-change="grid.appScope.otcc.status(row.entity,rowRenderIndex)" ng-model="row.entity.status" ng-if="row.entity.isfirst" style="margin:0px;display:inline;"></md-switch>'}]}).constant("theatreTypeGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!0,enableRowSelection:!0,enableSelection:!1,multiSelect:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"theaterType",displayName:"Theater",enableSorting:!0,enableCellEdit:!1,width:"45%"},{name:"slots",displayName:"Slots",enableSorting:!0,enableCellEdit:!1,width:"60%"}]}).constant("reducedRateGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableRowSelection:!0,enableHorizontalScrollbar:0,columnDefs:[{name:"sequence",displayName:"Surgery Number",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><input type="text" validate-percentage degits-upto="2" allow-negative="false" class="form-control" ng-disabled="row.entity.isEdited" style="" placeholder="Enter" ng-model="row.entity.sequence"></div>'},{name:"percentageOfRate",displayName:"Percentage of Rate To Be Applied",enableSorting:!0,enableCellEdit:!1,width:190,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><input type="text" validate-percentage degits-upto="2" allow-negative="false" class="form-control" ng-disabled="row.entity.isEdited" style="width:80%" placeholder="Enter" ng-model="row.entity.percentageOfRate" ></div>'},{name:"status",displayName:"Actions",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-actions action-row"><button class="his-btn his-btn-info his-grid-btn" ng-if="!row.entity.isfirst" ng-click="grid.appScope.otcc.addReduceRateGridRow(row,row.grid.rows.length)">Add</button><i class="fa fa-pencil" ng-if="row.entity.isfirst" ng-disabled="!row.entity.isEdited"  ng-click="grid.appScope.otcc.chng2edit(row,rowRenderIndex)"></i><md-switch class="md-primary actionSwitch" ng-change="grid.appScope.otcc.status(row.entity.status,rowRenderIndex)" ng-model="row.entity.status" ng-if="row.entity.isfirst" ng-true-value="1" ng-false-value="2" style="margin:0px;display:inline;"></md-switch>'}]}).constant("gradeGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableRowSelection:!0,enableHorizontalScrollbar:0,columnDefs:[{name:"gradeName",displayName:"Grade Name",enableSorting:!0,enableCellEdit:!1},{name:"gradeServiceDesc",displayName:"Grade Service Mapping",enableSorting:!0,enableCellEdit:!1},{name:"status",displayName:"Actions",enableSorting:!0,enableCellEdit:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-actions action-row"><i class="fa fa-pencil" ng-if="row.entity.isfirst" ng-disabled="!row.entity.isEdited" ng-click="grid.appScope.otcc.chng2edit(row,rowRenderIndex)"></i><md-switch class="md-primary actionSwitch" ng-change="grid.appScope.otcc.status(row.entity.status,rowRenderIndex)" ng-model="row.entity.status" ng-if="row.entity.isfirst" ng-true-value="1" ng-false-value="2" style="margin:0px;display:inline;"></md-switch>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("roomRentGridDef",{enableSorting:!1,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"byFixedSlot",displayName:"By Fixed Slot",enableSorting:!0,enableCellEdit:!1,width:80,cellTemplate:'<div class="ui-grid-cell-contents rr-grid-template"><div class="radio-container"><input type="radio" ng-model="row.entity.freqyradio" name="radiofreq"  style="border:none" ng-value=1 ng-selected="true" ng-init="row.entity.freqyradio=1" ng-if="rowRenderIndex==0" ng-change="grid.appScope.billingConfig.setGridInputs(billingConfig.rrGridOpts.data.length-1,billingConfig.rrGridOpts.data[billingConfig.rrGridOpts.data.length-1])"></div><input ng-disabled="rowRenderIndex!=0||row.entity.freqyradio==2" type="text" numbers-only ng-model="row.entity.byFixedSlot" min=0 max=24 class="form-control rr-grid-textbox" placeholder="From"><span class="divider">-</span></div>'},{name:"dummyField",displayName:" ",enableSorting:!0,enableCellEdit:!1,width:65,cellTemplate:'<div class="ui-grid-cell-contents rr-grid-template"><input type="text" numbers-only ng-disabled="rowRenderIndex!=0||row.entity.freqyradio==2" ng-model="row.entity.dummyField" class="form-control rr-grid-textbox" placeholder="To" min="1" max="24"></div>'},{name:"byFrequencySlot",displayName:"By Frequency Slot",enableSorting:!0,enableCellEdit:!1,width:190,cellTemplate:'<div class="ui-grid-cell-contents rr-grid-template"><div class="radio-container"><input type="radio" ng-model="row.entity.freqyradio" name="radiofreq" ng-value=2 style="border:none" ng-change="grid.appScope.billingConfig.setGridInputs(billingConfig.rrGridOpts.data,billingConfig.rrGridOpts.data[billingConfig.rrGridOpts.data.length])" ng-if="rowRenderIndex==0"></div><span class="divider">></span><input type="text" numbers-only class="form-control rr-grid-textbox" ng-disabled="rowRenderIndex!=0||row.entity.freqyradio==1" ng-model="row.entity.byFrequencySlot"  min="1" max="24"><span style="margin: 0 8px;color: #444; font-weight: 500;" ng-if="(row.entity.freqyradio==2&&rowRenderIndex!=0)||rowRenderIndex==0">hrs</span><label><span ng-show="(row.entity.freqyradio==2&&rowRenderIndex!=0)||rowRenderIndex==0" style="font-weight: 600! important;">every</span></label></div>'},{name:"dummyField2",displayName:" ",enableSorting:!0,enableCellEdit:!1,width:"85",cellTemplate:'<div class="ui-grid-cell-contents rr-grid-template"><input type="text" numbers-only ng-model="row.entity.dummyField2" ng-disabled="rowRenderIndex!=0||row.entity.freqyradio==1" class="form-control rr-grid-textbox" min=grid.appScope.billingConfig.rrGridOpts.data[billingConfig.rrGridOpts.data.dummyField] max="59"><label ng-show="(row.entity.freqyradio==2&&rowRenderIndex!=0)||rowRenderIndex==0">min</label></div>'},{name:"status",displayName:"Actions",enableSorting:!0,enableCellEdit:!1,width:60,cellTemplate:'<div class="ui-grid-cell-contents rr-grid-template"><button class="his-btn his-btn-info rr-grid-button" ng-if="rowRenderIndex==0&&!grid.appScope.billingConfig.editIndex" ng-click="grid.appScope.billingConfig.addRow(row,rowRenderIndex)">Add</button><button class="his-btn his-btn-info rr-grid-button" ng-if="rowRenderIndex==0&&grid.appScope.billingConfig.editIndex" ng-click="grid.appScope.billingConfig.updateRow(row.entity,rowRenderIndex)">Update</button><i class="fa fa-pencil" ng-if="rowRenderIndex!=0 && row.entity.status==1"  ng-click="grid.appScope.billingConfig.chng2edit(row,rowRenderIndex)"></i><md-switch class="md-primary actionSwitch" ng-true-value="1"  ng-false-value="2" ng-change="grid.appScope.billingConfig.statusChange(row,rowRenderIndex)" ng-model="row.entity.status" ng-if="rowRenderIndex!=0" style="margin:0px;display:inline;"></md-switch></div>'}]}).constant("companionConfigGridDef",{enableSorting:!1,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"byFixedSlot",displayName:"By Fixed Slot",enableSorting:!0,enableCellEdit:!1,width:140,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><span ng-if="rowRenderIndex!=0" style="color:#ffffff; margin-right:7px;">-</span><input type="radio" ng-model=row.entity.freqyradio name="radiofreq" ng-value=1 ng-selected="true"  ng-if="rowRenderIndex==0" ng-change="grid.appScope.billingConfig.setGridInputs(billingConfig.rrGridOpts.data.length-1,billingConfig.rrGridOpts.data[billingConfig.rrGridOpts.data.length-1])"><input type="text" numbers-only  ng-change="grid.appScope.billingConfig.setGridMinMaxValues(1)" ng-disabled="rowRenderIndex!=0||row.entity.freqyradio==2" allow-negative="false"  ng-model="row.entity.byFixedSlot" class="form-control" my-maxlength="2" style="width:100px; padding: auto 6px; display: inline;" placeholder="From"><span>-</span></div>'},{name:"dummyField",displayName:" ",enableSorting:!0,enableCellEdit:!1,width:240,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><input type="text" min=1 max=24 numbers-only  ng-disabled="rowRenderIndex!=0||row.entity.freqyradio==2" ng-change="grid.appScope.billingConfig.setGridMinMaxValues(2)" ng-model=row.entity.dummyField my-maxlength="2" class="form-control" style="width:100px; padding: auto 6px; display: inline;" placeholder="To"></div>'},{name:"byFrequencySlot",displayName:"By Frequency Slot",enableSorting:!0,enableCellEdit:!1,width:250,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><span ng-if="rowRenderIndex!=0" style="color:#ffffff; margin-right:7px;">-</span><input type="radio" ng-model=row.entity.freqyradio name="radiofreq" ng-value=2 ng-change="grid.appScope.billingConfig.setGridInputs(billingConfig.rrGridOpts.data,billingConfig.rrGridOpts.data[billingConfig.rrGridOpts.data.length])" ng-if="rowRenderIndex==0"><span> > </span><input type="text" numbers-only  allow-negative="false" min=1 max=24 my-maxlength="2" class="form-control" ng-disabled="rowRenderIndex!=0||row.entity.freqyradio==1" ng-change="grid.appScope.billingConfig.setGridMinMaxValues(3)" ng-model="row.entity.byFrequencySlot" style="width:100px; padding: auto 6px; display: inline;" ><span ng-if="(row.entity.freqyradio==2&&rowRenderIndex!=0)||rowRenderIndex==0">hrs</span><label><strong ng-if="(row.entity.freqyradio==2&&rowRenderIndex!=0)||rowRenderIndex==0">every</strong></label></div>'},{name:"dummyField2",displayName:" ",enableSorting:!0,enableCellEdit:!1,width:250,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-template"><input type="text" numbers-only my-maxlength="2"  ng-model="row.entity.dummyField2" ng-disabled="rowRenderIndex!=0||row.entity.freqyradio==1" class="form-control" style="width:100px; padding: auto 6px; display: inline;" ng-change="grid.appScope.billingConfig.setGridMinMaxValues(4)"><span ng-if="(row.entity.freqyradio==2&&rowRenderIndex!=0)||rowRenderIndex==0">min</span></div>'},{name:"status",displayName:"Actions",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents equip-grid-actions action-row"><button class="his-btn his-grid-btn his-btn-info" ng-if="rowRenderIndex==0&&!grid.appScope.billingConfig.editIndex" ng-click="grid.appScope.billingConfig.addRow(row,rowRenderIndex)">Add</button><button class="his-btn his-btn-info his-grid-btn" ng-if="rowRenderIndex==0&&grid.appScope.billingConfig.editIndex" ng-click="grid.appScope.billingConfig.updateRow(row.entity,rowRenderIndex)">Update</button><i class="fa fa-pencil" ng-if="rowRenderIndex!=0 && row.entity.status==1"  ng-click="grid.appScope.billingConfig.chng2edit(row,rowRenderIndex)"></i><md-switch class="md-primary actionSwitch" ng-true-value="1"  ng-false-value="2" ng-change="grid.appScope.billingConfig.statusChange(row,rowRenderIndex)" ng-model="row.entity.status" ng-if="rowRenderIndex!=0" style="margin:0px;display:inline;"></md-switch></div>'}]}).constant("ipVisitGridConstants",{enableSorting:!1,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"visitType",displayName:"Visit Type",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0"><select class="form-control" ng-required="row.entity.required"  ng-model="row.entity.visitType" style=""  ng-options="primary  as primary.gQDataName for primary in grid.appScope.billingConfig.visitNoService track by primary.gQDataCode" ></select></div><div ng-if="rowRenderIndex>0">{{row.entity.visitType.gQDataName}}</div></div>'},{name:"visitPriority",displayName:"Visit Priority",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0" ><select  ng-required="row.entity.required" class="form-control" ng-model="row.entity.visitPriority"    ng-options="priority  as priority.gQDataName for priority in grid.appScope.billingConfig.priorityList track by priority.gQDataCode" >                                  </select></div><span ng-if="rowRenderIndex>0">{{row.entity.visitPriority.gQDataName}}</span></div>'},{name:"visitNo",displayName:"Max Visit Count",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0" ><input type="text" ng-model="row.entity.visitNo"    numbers-only class="form-control"></div><span ng-if="rowRenderIndex>0">{{row.entity.visitNo}}</span></div>'},{name:"actions",displayName:"Actions",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents ip-visit-grid-fields action-row"><button ng-if="rowRenderIndex==0" type="button" ng-disabled="row.entity.visitNo==undefined" class="his-btn his-btn-info his-grid-btn" ng-click="grid.appScope.billingConfig.addRowToGrid(row.entity,grid.options.name)" >{{(grid.appScope.billingConfig.editRow[grid.options.name])?"Update":"Add"}}</button><div ng-if="rowRenderIndex>0"class="actionRow action-row"><span ng-click="grid.appScope.billingConfig.editRowToGrid(row.entity,rowRenderIndex,grid.options.name)" ><i  class="fa fa-pencil" style="position: relative; top: 2px;"></i> </span><span  ng-disabled ="row.entity.isEditable" ng-click="grid.appScope.billingConfig.deleteRowToGrid(row.entity,rowRenderIndex,grid.options.name)" ng-style="{ \'cursor\': \'pointer\' }"><i class="fa fa-trash fa-lg" aria-hidden="true"></i></span></div></div>'}]})}(),function(){"use strict";function e(e,t,a){function i(e){var t=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"];return t instanceof Array?t:[t]}this.comboBoxFetch=function(r,n){var l=e.defer(),s={},o=r;"FACILITY_DROPDOWN"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}]}]}]}]}),"GET_ACTIVE_BED_CLASSES"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{"com.napier.core.service.vo.query.Index":[]}]}]}]}),"TARIFF_CARG"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{"com.napier.core.service.vo.query.Index":[{ident:1,value:"1  "}]}]}]}]}),"SCM_SERV_001"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pPracticeId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}]}]}]}]}),"SCM_SERVICE_LIST_WITH_OUT_RATES"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pPracticeId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID},{paramName:"pFacilityId",value:1},{paramName:"pServCode",value:"%5008373%"},{paramName:"pServName",value:"%HOSPITAL REGISTRATION CHARGE%"},{paramName:"pPriServTypeCode",value:""},{paramName:"pSecServTypeCode",value:""},{paramName:"pServTypeCode",value:""},{paramName:"pServDesign",value:""},{paramName:"pFlowElement",value:""},{paramName:"pServStatus",value:"1"},{paramName:"pServDefStatus",value:""},{paramName:"pDepartment",value:""},{paramName:"pIsEmergency",value:""},{paramName:"pExcludePri",value:""}]}]}]}]}),"SCM_SERV_002"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pPracticeId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID},{paramName:"pPriServTypeCode",value:n}]}]}]}]}),"SCM_SERV_003"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pPracticeId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID},{paramName:"pSecServTypeCode",value:n}]}]}]}]}),"GET_CURRENCY_COUNTRY_DATA"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{"com.napier.core.service.vo.query.Index":[]}]}]}]}),"SCM_EMER_NOT_ALLOW_SERVICES_01"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{}]}]}]});var c={};return c.url=t.HISCOMBOFILLING.URL,c.requestData={operation:"ExecuteQuery",destination:"QueryService",message:s},a.sendRestRequest(c).then(function(e){if("FACILITY_DROPDOWN"==o){var t=[],a=i(e);angular.forEach(a,function(e,a){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={CODE:i[0].data.trim(),DESCRIPTION:i[1].data};t.push(r)}),l.resolve(t)}if("GET_ACTIVE_BED_CLASSES"==o){var r=[];a=i(e);angular.forEach(a,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={CODE:a[0].data,DESCRIPTION:a[1].data};r.push(i)}),l.resolve(r)}if("TARIFF_CARG"==o){var n=[],s=i(e);angular.forEach(s,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={CODE:a[0].data,DESCRIPTION:a[1].data};n.push(i)}),l.resolve(n)}if("SCM_SERV_001"==o){var c=[];a=i(e);angular.forEach(a,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={CODE:a[0].data,DESCRIPTION:a[1].data};c.push(i)}),l.resolve(c)}if("SCM_SERV_002"==o){var d=[];a=i(e);if(Array.isArray(a))angular.forEach(a,function(e,t){if(e.columnList){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={CODE:a[0].data,DESCRIPTION:a[1].data};d.push(i)}});else{var p={CODE:(m=a.columnList[0]["com.napier.core.service.vo.query.Column"])[0].data,DESCRIPTION:m[1].data};d.push(p)}l.resolve(d)}if("SCM_SERV_003"==o){d=[];var u=i(e);if(Array.isArray(u))angular.forEach(u,function(e,t){if(e&&e.columnList){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={CODE:a[0].data,DESCRIPTION:a[1].data};d.push(i)}});else if(u){var m,g={CODE:(m=u.columnList[0]["com.napier.core.service.vo.query.Column"])[0].data,DESCRIPTION:m[1].data};d.push(g)}l.resolve(d)}if("GET_CURRENCY_COUNTRY_DATA"==o){var S=[],v=i(e);angular.forEach(v,function(e,t){if(e.columnList){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={CODE:a[0].data,DESCRIPTION:a[1].data+" - "+a[2].data};S.push(i)}}),l.resolve(S)}if("SCM_SERVICE_LIST_WITH_OUT_RATES"==o)c=[],a=i(e);if("SCM_EMER_NOT_ALLOW_SERVICES_01"==o){var D=[],y=i(e);angular.forEach(y,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={CODE:a[0].data,DESCRIPTION:a[1].data};D.push(i)}),l.resolve(D)}}),l.promise},this.searchServices=function(r,n,l,s){var o=e.defer();if(s)c="SCM_SERVICE_LIST_WITH_OUT_RATES_FOR_OP";else var c="SCM_SERVICE_LIST_WITH_OUT_RATES";var d;d={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:c,idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pPracticeId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID},{paramName:"pFacilityId",value:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID},{paramName:"pServCode",value:""},{paramName:"pServName",value:l||""},{paramName:"pPriServTypeCode",value:r||""},{paramName:"pSecServTypeCode",value:n||""},{paramName:"pServTypeCode",value:""},{paramName:"pServDesign",value:""},{paramName:"pFlowElement",value:""},{paramName:"pServStatus",value:"1"},{paramName:"pServDefStatus",value:""},{paramName:"pDepartment",value:""},{paramName:"pIsEmergency",value:""},{paramName:"pExcludePri",value:""}]}]}]}]};var p={};return p.url=t.HISCOMBOFILLING.URL,p.requestData={operation:"ExecuteQuery",destination:"QueryService",message:d},a.sendRestRequest(p).then(function(e){var t=i(e),a=[];if(Array.isArray(t))angular.forEach(t,function(e,t){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r=[];angular.forEach(i,function(e,t){r.push(e.data)});var n={serviceSeqId:r[0],serviceCode:r[1],serviceName:r[2]};a.push(n)});else if(t){var r=t.columnList[0]["com.napier.core.service.vo.query.Column"],n=[];angular.forEach(r,function(e,t){n.push(e.data)});var l={serviceSeqId:n[0],serviceCode:n[1],serviceName:n[2]};a.push(l)}o.resolve(a)}),o.promise},this.saveCurrency=function(i){var r=e.defer(),n={"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMasterList",configurationBillingMasterList:{"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster":[{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:134,configValue:i}]}},l={};return l.url=t.HISCOMBOFILLING.URL,l.requestData={operation:"updateConfigurationBillingMaster",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:n},a.sendRestRequest(l).then(function(e){r.resolve(e)}),r.promise},this.saveGeneralConfig=function(i,r,n){var l=e.defer(),s={"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMasterList",configurationBillingMasterList:{"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster":[{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:1,configValue:i.ageOfSeniorCitizen?i.ageOfSeniorCitizen+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:4,configValue:i.billPercent?i.billPercent+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:109,configValue:r.regSeqId?r.regSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:110,configValue:r.ipSeqId?r.ipSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:111,configValue:r.mlcSeqId?r.mlcSeqId+"":void 0},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:7,configValue:i.servTaxNum?i.servTaxNum+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:8,configValue:i.incomeTaxNum?i.incomeTaxNum+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:109,configValue:r.regSeqId?r.regSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:110,configValue:r.ipSeqId?r.ipSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:111,configValue:r.mlcSeqId?r.mlcSeqId+"":void 0},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:135,configValue:i.opTariffCat?i.opTariffCat+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:131,configValue:i.opTariff?i.opTariff+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:133,configValue:i.opCash?i.opCash:""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:132,configValue:i.ipTariff?i.ipTariff+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:379,configValue:1==i.radioCode?1:2},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:406,configValue:i.fetchBy},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:407,configValue:i.convertType}]}};n&&(s={"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMasterList",configurationBillingMasterList:{"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster":[{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:140,configValue:i.consltseqId?i.consltseqId+"":"",remarks:"New Consultation"},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:141,configValue:i.flwUpseqId?i.flwUpseqId+"":"",remarks:"Follow up"},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:142,configValue:i.freeFlwUpseqId?i.freeFlwUpseqId+"":"",remarks:"Free follow up"},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:143,configValue:i.ipFlwUpseqId?i.ipFlwUpseqId+"":"",remarks:"Ip follow up"},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:144,configValue:i.flagRate?"1":"2",remarks:"OP Consultation rates based on doctor"}]}});var o={};return o.url=t.HISCOMBOFILLING.URL,o.requestData={operation:"updateConfigurationBillingMaster",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:s},a.sendRestRequest(o).then(function(e){l.resolve(e)}),l.promise},this.saveIPVisitDetails=function(i,r){var n=e.defer(),l={"@class":"com.napier.core.dao.entities.corebillingmasters.DoctorVisitServiceVo",firstVisitServId:i.firstVisitSeqID?i.firstVisitSeqID+"":"",dayVisitServId:i.dayVisitSeqID?i.dayVisitSeqID+"":"",nightVisitvServId:i.nightVisitSeqID?i.nightVisitSeqID+"":"",facilityId:"1",practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnTranStatus:1};r&&(l.docConfigSeqId=r+"");var s={};return s.url=t.HISCOMBOFILLING.URL,s.requestData={operation:"updateDoctorVisitConfiguration",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:l},a.sendRestRequest(s).then(function(e){n.resolve(e)}),n.promise},this.saveInventoryDetails=function(i){var r=e.defer(),n={"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMasterList",configurationBillingMasterList:{"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster":[{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:101,configValue:i.generalIssuesSeqId?i.generalIssuesSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:102,configValue:i.generalReturnSeqId?i.generalReturnSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:103,configValue:i.pharmacyIssuesSeqId?i.pharmacyIssuesSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:104,configValue:i.pharmacyReturnSeqId?i.pharmacyReturnSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:105,configValue:i.cssdIssuesSeqId?i.cssdIssuesSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:106,configValue:i.cssdReturnSeqId?i.cssdReturnSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:107,configValue:i.cathlabIssuesSeqId?i.cathlabIssuesSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:108,configValue:i.cathlabReturnSeqId?i.cathlabReturnSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:119,configValue:i.stationaryIssuesSeqId?i.stationaryIssuesSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:120,configValue:i.stationaryReturnSeqId?i.stationaryReturnSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:121,configValue:i.retailIssuesSeqId?i.retailIssuesSeqId+"":""},{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:126,configValue:i.retailReturnSeqId?i.retailReturnSeqId+"":""}]}},l={};return l.url=t.HISCOMBOFILLING.URL,l.requestData={operation:"updateConfigurationBillingMaster",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:n},a.sendRestRequest(l).then(function(e){r.resolve(e)}),r.promise},this.payerSelectionTariffCat=function(r,n){var l=e.defer(),s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:r,idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pCompSeqId",value:n}]}]}]}]},o={};return o.url=t.HISCOMBOFILLING.URL,o.requestData={operation:"ExecuteQuery",destination:"QueryService",message:s},a.sendRestRequest(o).then(function(e){var t=i(e);if(t)var a=null!=t[0]?t[0].columnList[0]["com.napier.core.service.vo.query.Column"]:t.columnList[0]["com.napier.core.service.vo.query.Column"],r={CODE:a[0].data,DESCRIPTION:a[1].data};l.resolve(r)}),l.promise},this.getDoctorDetails=function(){var r=e.defer(),n={};return n.url=t.HISCOMBOFILLING.URL,n.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"NH_BL_DOCT_VISIT_CONFIG",idxList:[{"com.napier.core.service.vo.query.Index":[{}]}]}]}]}},a.sendRestRequest(n).then(function(e){var t=i(e),a=null!=t[0]?t[0].columnList[0]["com.napier.core.service.vo.query.Column"]:t.columnList[0]["com.napier.core.service.vo.query.Column"];r.resolve(a)}),r.promise},this.saveRoomRentDetails=function(i,r,n){var l,s,o=new Date;r.admissionMeridiam&&("1"==r.admissionMeridiam?l="AM":"2"==r.admissionMeridiam&&(l="PM")),r.cutoffMeridiam&&("1"==r.cutoffMeridiam?s="AM":"2"==r.cutoffMeridiam&&(s="PM"));var c=moment(o).format("YYYY-MM-DD")+" 00:00:00.000",d=e.defer(),p={"@class":"com.napier.core.service.vo.corebillingmasters.RoomRentConfigVo",roomrentSeqId:r.rrcSeqId,isSlotLevel:r.slotLv,slotDuration:r.slotDuration?r.slotDuration:"",soltLevelGracePeriod:r.slotGracePeriodTime?r.slotGracePeriodTime:"",gracePeriodAdmission:r.cutoffAdmsnTime?r.graceAdmsnTime:"",gracePeriodDischarge:r.cutoffDischargeTime?r.graceDischargeTime:"",cutOffAddmissionTime:r.cutoffAdmsnTime?r.cutoffAdmsnTime+" "+l:"",cutOffDischargeTime:r.cutoffDischargeTime?r.cutoffDischargeTime+" "+s:"",halfDayCutOff:r.halfDayTime?r.halfDayTime:"",fullDayCutOff:r.fullDayTime?r.fullDayTime:"",dischargeFulDayCutOff:r.fullDayTimeDis?r.fullDayTimeDis:"",dischargeHalfDayCutOff:r.halfDayTimeDis?r.halfDayTimeDis:"",halfDayserviceDay:i.halfDayRentCode?i.halfDayRentCode:-999,fullDayserviceDay:i.fullDayRentCode?i.fullDayRentCode:-999,multipleTransfer:r.multipleTransfer?"1":"0",isApplyTrafficRate:r.tariff,mintimespent:r.minTimeSpent?r.minTimeSpent:"",gnMachineIp:n.machineIP?n.machineIP:"",practiceId:n.practiceId?n.practiceId:"",gnStatus:"1",createdBy:"1",createdOn:c,editedBy:"2",editedOn:c,facilityId:n.facilityId},u={};return u.url=t.HISCOMBOFILLING.URL,u.requestData={operation:"saveUpdateRoomRentConfiguration",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:p},a.sendRestRequest(u).then(function(e){d.resolve(e)}),d.promise},this.saveDiscountDetails=function(i){var r=e.defer(),n={"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMasterList",configurationBillingMasterList:{"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster":[{"@class":"com.napier.core.service.vo.corebillingmasters.ConfigurationBillingMaster",billConfigSeqId:130,configValue:i}]}},l={};return l.url=t.HISCOMBOFILLING.URL,l.requestData={operation:"updateConfigurationBillingMaster",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:n},a.sendRestRequest(l).then(function(e){e&&r.resolve(e)}),r.promise},this.saveCorporateDetails=function(i,r,n,l){var s=new Date,o=moment(s).format("YYYY-MM-DD")+" 00:00:00.000",c=e.defer(),d={"@class":"com.napier.core.service.vo.corebillingmasters.CorporateDiscountsVo",seqId:l,payer:i.payer,tarrifSeqId:n,opServiceDisc:i.serviceOP,ipServiceDisc:i.serviceIP,opItemDisc:i.itemOP,ipItemDisc:i.itemIP,lastUpdatedOn:o,gnMachineIp:r.machineIP,practiceId:r.practiceId,gnStatus:"1",createdBy:"1",createdOn:o,editedBy:"2",editedOn:o,facilityId:r.facilityId},p={};return p.url=t.HISCOMBOFILLING.URL,p.requestData={operation:"saveUpdateCorporateDiscount",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:d},a.sendRestRequest(p).then(function(e){e&&c.resolve(e)}),c.promise},this.searchDiscountServices=function(i,r){var n=e.defer(),l={"@class":"com.napier.core.service.vo.corebillingmasters.CompanyHighValServicesDiscountHdVo",companySeqId:i,tarrifSeqId:r,companyServiceDiscountsDtlsVoList:[{"com.napier.core.service.vo.corebillingmasters.CompanyHighValServicesDiscountDtlVo":[{deptSeqId:-999}]}]},s={};return s.url=t.HISCOMBOFILLING.URL,s.requestData={operation:"getCompanyServicesDiscountHighValueBills",destination:"com.napier.core.corebillingmasters.service.external.CompanyServiceDiscountsService",message:l},a.sendRestRequest(s).then(function(e){var t=e.data.HITService.message.compHldiscHdSeqId,a=e.data.HITService.message.billLimitValue,i=e.data.HITService.message.companyServiceDiscountsDtlsVoList[0]["com.napier.core.service.vo.corebillingmasters.CompanyHighValServicesDiscountDtlVo"],r=[];angular.forEach(i,function(e,i){var n={deptSeqId:e.deptSeqId,serviceSeqId:e.serviceSeqId,serviceCode:e.serviceCode,serviceName:e.serviceName,discountPercentage:e.discountPercentage,compHldiscDtSeqId:e.compHldiscDtSeqId,gnStatus:e.gnStatus,actStatus:!0,actStatusDesc:"Active",editable:!1,checked:!1,compHldiscHdSeqId:t,billLimitValue:a};r.push(n)}),n.resolve(r)}),n.promise},this.highValDiscSearch=function(i,r){var n=e.defer(),l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"GET_SERVICE_QUCIK_SEARCH",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pPracticeId",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID},{paramName:"pFacilityId",value:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID},{paramName:"pSerCode",value:"%"+i+"%"},{paramName:"pSerCode",value:"%"+i+"%"},{paramName:"ptariffSeqId",value:r}]}]}]}]},s={};return s.url=t.HISCOMBOFILLING.URL,s.requestData={operation:"ExecuteQuery",destination:"QueryService",message:l},a.sendRestRequest(s).then(function(e){var t=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"],a=[];if(Array.isArray(t))angular.forEach(t,function(t){var i={serviceSeqId:(e=t.columnList[0]["com.napier.core.service.vo.query.Column"])[0].data,serviceCode:e[1].data,serviceName:e[2].data,discountPercentage:null!=e[3]?e[3].data:void 0,gnStatus:null!=e[4]&&"DISC.GN_STATUS"==e[4].name?e[4].data:0,actStatusDesc:"Active",editable:!1,checked:!1};a.push(i)});else{var i={serviceSeqId:(e=t.columnList[0]["com.napier.core.service.vo.query.Column"])[0].data,serviceCode:e[1].data,serviceName:e[2].data,discountPercentage:null!=e[3]?e[3].data:void 0,gnStatus:null!=e[4]&&"DISC.GN_STATUS"==e[4].name?e[4].data:0,actStatusDesc:"Active",editable:!1,checked:!1};a.push(i)}n.resolve(a)}),n.promise},this.fetchUpdateDetails=function(r){var n=e.defer(),l={},s=r;"CONFIG_MASTER_001"==s&&(l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:s,idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID},{ident:"2",value:1},{ident:"3",value:1},{ident:"4",value:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID},{ident:"5",value:1},{ident:"6",value:1}]}]}]}]}),"DISC_CONFG_CURRENCT_TAB"==s&&(l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:s,idxList:[{}]}]}]}),"DISCCOUNT_TAB_CONG"==s&&(l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:s,idxList:[{}]}]}]}),"NH_BL_DOCT_VISIT_CONFIG"==s&&(l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:s,idxList:[{"com.napier.core.service.vo.query.Index":[{}]}]}]}]}),"GET_BED_CLASS_DTL_BY_BL_CONFIG_SEQ_ID"==s&&(l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:s,idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pBillConfigSeqId",value:114}]}]}]}]}),"DISC_CONFG_DISC_TAB"==s&&(l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:s,idxList:[{}]}]}]}),"DISC_CONFG_ROOM_RENT"==s&&(l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:s,idxList:[{}]}]}]});var o={};return o.url=t.HISCOMBOFILLING.URL,o.requestData={operation:"ExecuteQuery",destination:"QueryService",message:l},a.sendRestRequest(o).then(function(e){var t=i(e),a=[];if("CONFIG_MASTER_001"==s&&(angular.forEach(t,function(e){var t=null==e.columnList&&null!=e[0]?e[0].columnList[0]["com.napier.core.service.vo.query.Column"]:e.columnList[0]["com.napier.core.service.vo.query.Column"],i={};i=111==t[0].data?{configSeqID:t[0].data,configDesc:t[1].data,configVal:"BCM.CONFIG_VALUE"==t[2].name?t[2].data:void 0,tranStatus:null!=t[3]?t[3].data:void 0,icuRate:null!=t[4]?t[4].data:void 0}:{configSeqID:t[0].data,configDesc:t[1].data,configVal:t[2].data,tranStatus:t[3].data,icuRate:t[4].data},a.push(i)}),n.resolve(a)),"DISC_CONFG_CURRENCT_TAB"==s){var r=null==t.columnList&&null!=t[0]?t[0].columnList[0]["com.napier.core.service.vo.query.Column"]:t.columnList[0]["com.napier.core.service.vo.query.Column"];n.resolve(r)}if("NH_BL_DOCT_VISIT_CONFIG"==s){var l,o,c,d;r=null==t.columnList&&null!=t[0]?t[0].columnList[0]["com.napier.core.service.vo.query.Column"]:t.columnList[0]["com.napier.core.service.vo.query.Column"];angular.forEach(r,function(e){"DVC.FIRST_VISIT_SERV_ID"==e.name&&(l=e.data),"DVC.DAY_VISIT_SERV_ID"==e.name&&(o=e.data),"DVC.NIGHT_VISIT_SERV_ID"==e.name&&(c=e.data),"DVC.DOCV_CONFIG_SEQ_ID"==e.name&&(d=e.data)});var p={firstVisitSeqId:l,dayVisitSeqId:o,nightVisitSeqId:c,docVisitSeqId:d};n.resolve(p)}if("DISCCOUNT_TAB_CONG"==s){var u=(r=null==t.columnList&&null!=t[0]?t[0].columnList[0]["com.napier.core.service.vo.query.Column"]:t.columnList[0]["com.napier.core.service.vo.query.Column"]).data;n.resolve(u)}if("DISC_CONFG_DISC_TAB"==s){var m=null==t.columnList&&null!=t[0]?t[0].columnList[0]["com.napier.core.service.vo.query.Column"]:t.columnList[0]["com.napier.core.service.vo.query.Column"];n.resolve(m)}"DISC_CONFG_ROOM_RENT"==s&&(m=t?null==t.columnList&&null!=t[0]?t[0].columnList[0]["com.napier.core.service.vo.query.Column"]:t.columnList[0]["com.napier.core.service.vo.query.Column"]:"No Data",n.resolve(m));if("GET_BED_CLASS_DTL_BY_BL_CONFIG_SEQ_ID"==s){r=null==t.columnList&&null!=t[0]?t[0].columnList[0]["com.napier.core.service.vo.query.Column"]:t.columnList[0]["com.napier.core.service.vo.query.Column"];n.resolve(r)}}),n.promise},this.discountSaveHighBill=function(i,r,n,l,s,o,c){if(!n){var d=[];angular.forEach(r,function(e,t){var a={deptSeqId:e.deptSeqId,serviceSeqId:e.serviceSeqId,serviceCode:e.serviceCode,serviceName:e.serviceName,discountPercentage:e.discountPercentage,gnStatus:e.gnStatus,discountAmountType:1};e.checked&&d.push(a)});var p=e.defer(),u={"@class":"com.napier.core.service.vo.corebillingmasters.CompanyHighValServicesDiscountHdVo",companySeqId:l,tarrifSeqId:s,compHldiscHdSeqId:o,billLimitValue:c,companyType:1,companyServiceDiscountsDtlsVoList:[{"com.napier.core.service.vo.corebillingmasters.CompanyHighValServicesDiscountDtlVo":d}],companyServiceDiscountsDeselectDtlsVoList:[{}]},m={};return m.url=t.HISCOMBOFILLING.URL,m.requestData={operation:"saveOrUpdateCompanyServicesDiscountHighValueBills",destination:"com.napier.core.corebillingmasters.service.external.CompanyServiceDiscountsService",message:u},a.sendRestRequest(m).then(function(e){p.resolve(e)}),p.promise}},this.companionSave=function(e,t){var i={url:"HISServices/companionSave"};return i.requestData={operation:"SaveServiceConfiguration",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:{"@class":"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList",billingHISConfigurationVo:[{"com.napier.core.service.vo.corebillingmasters.BillingHISConfigurationVo":[{configurationId:405,value:e[0].serviceSeqId,reqFrom:"COMPANION",slotOrConnection:t?1:0}]}],billingServiceConfigurationVoList:[{"com.napier.core.service.vo.corebillingmasters.BillingServiceConfigurationVoList":e}]}},a.sendRestRequest(i)}}e.$inject=["$q","BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("angBillingConfigurationService",e)}(),function(){"use strict";function e(e,t){this.getColumnDef=function(e){e.columnDefs=[{name:"subDepartmentDesc",displayName:"Speciality",cellClass:"noborder",headerCellFilter:"translate",width:"*"},{name:"billVisitconfigSeqId",visible:!1},{name:"subSeqCode",visible:!1},{name:"freeDays",displayName:"billing.freeDays",headerCellFilter:"translate",cellClass:"noborder",width:"*",type:"number",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="!row.entity.editable">{{row.entity.freeDays}}</span><input ng-if="row.entity.editable" type="text" ng-model="MODEL_COL_FIELD" numbers-only ng-change="grid.appScope.billingConfig.changeValue(row.entity,col)" my-maxlength="3" ng-blur="grid.appScope.billingConfig.defaultValue(row.entity,col)"></div>'},{name:"noOfFreeVisits",displayName:"billing.freeVisit",headerCellFilter:"translate",cellClass:"noborder",width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="!row.entity.editable">{{row.entity.noOfFreeVisits}}</span><input ng-if="row.entity.editable" type="text" ng-model="MODEL_COL_FIELD" numbers-only ng-change="grid.appScope.billingConfig.changeValue(row.entity,col)" ng-blur="grid.appScope.billingConfig.defaultValue(row.entity,col)" my-maxlength="3"></div>'},{name:"noOfValidDays",displayName:"billing.validDays",headerCellFilter:"translate",cellClass:"noborder",width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="!row.entity.editable">{{row.entity.noOfValidDays}}</span><input ng-if="row.entity.editable" type="text" ng-model="MODEL_COL_FIELD" ng-change="grid.appScope.billingConfig.changeValue(row.entity,col)" numbers-only ng-blur="grid.appScope.billingConfig.defaultValue(row.entity,col)" my-maxlength="3"></div>'},{name:"noOfVisits",displayName:"billing.validVisit",headerCellFilter:"translate",cellClass:"noborder",width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="!row.entity.editable">{{row.entity.noOfVisits}}</span><input ng-if="row.entity.editable" type="text" ng-model="MODEL_COL_FIELD" ng-change="grid.appScope.billingConfig.changeValue(row.entity,col)" numbers-only ng-blur="grid.appScope.billingConfig.defaultValue(row.entity,col)" my-maxlength="3"></div>'},{name:"alternateDoctor",displayName:"billing.altnateDoc",headerCellFilter:"translate",cellClass:"noborder",width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="!row.entity.editable">{{row.entity.alternateDoctor==2?"No":"Yes"}}</span><select ng-if="row.entity.editable" ng-model="MODEL_COL_FIELD"><option value=1>Yes</option><option value=2>No</option></select></div>'},{name:"alternateVisitType",displayName:"billing.altnateVistTyp",headerCellFilter:"translate",cellClass:"noborder",width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="!row.entity.editable">{{row.entity.alternateVisitType==2?"FollowUp":"Free"}}</span><select ng-if="row.entity.editable" ng-model="MODEL_COL_FIELD"><option value=1>Free</option><option value=2>Follow Up</option></select></div>'},{name:"status",visible:!1},{name:"actions",displayName:"billing.actions",headerCellFilter:"translate",cellTemplate:'<div class="actionRow action-row ui-grid-cell-contents"><span style="float: left; margin-right:6px;" ng-style="{ pointerEvents: row.entity.status? \'auto\': \'none\'}" ng-click="grid.appScope.billingConfig.editDep(row.entity,rowRenderIndex,row)"><i class="fa fa-pencil" ng-if="!row.entity.editable"></i><i class="fa fa-check" ng-if="row.entity.editable"></i></span><div style="float:left;"><md-switch class="md-primary wlabel" ng-disabled="row.entity.editable" ng-model="row.entity.status" ng-change="grid.appScope.billingConfig.activeInactiveStatus(row)">{{row.entity.status?"Active":"InActive"}}</md-switch></div></div>',width:"*"}]},this.getColumnDefTariff=function(e){e.columnDefs=[{name:"tariffCatgSeqId",visible:!1},{name:"tariffClsSeqId",visible:!1},{name:"billVisitconfigSeqId",visible:!1},{name:"tariffCategory",displayName:"billing.tariffcategory",headerCellFilter:"translate",cellClass:"noborder",width:"*"},{name:"tariffClass",displayName:"billing.tariffClass",headerCellFilter:"translate",cellClass:"noborder",width:"*"},{name:"newServiceRate",displayName:"billing.newCase",headerCellFilter:"translate",cellClass:"noborder",type:"number",width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="!row.entity.editable">{{row.entity.newServiceRate}}</span><input ng-if="row.entity.editable" type="text" ng-model="MODEL_COL_FIELD" numbers-only ng-blur="grid.appScope.billingConfig.defaultValue(row.entity,col)" my-maxlength="7"></div>'},{name:"followUpServiceRate",displayName:"billing.followUp",headerCellFilter:"translate",cellClass:"noborder",width:"*",type:"number",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="!row.entity.editable">{{row.entity.followUpServiceRate}}</span><input ng-if="row.entity.editable" type="text" ng-model="MODEL_COL_FIELD" numbers-only ng-blur="grid.appScope.billingConfig.defaultValue(row.entity,col)" my-maxlength="7"></div>'},{name:"ipFollowUpServiceRate",displayName:"billing.ipFollowUp",headerCellFilter:"translate",cellClass:"noborder",type:"number",width:"*",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="!row.entity.editable">{{row.entity.ipFollowUpServiceRate}}</span><input ng-if="row.entity.editable" type="text" ng-model="MODEL_COL_FIELD" numbers-only ng-blur="grid.appScope.billingConfig.defaultValue(row.entity,col)" my-maxlength="7"></div>'},{name:"status",visible:!1},{name:"opEmergencyRate",visible:!1},{name:"actions",displayName:"billing.actions",headerCellFilter:"translate",cellTemplate:'<div class="actionRow action-row ui-grid-cell-contents"><span style="float: left; margin-right:6px;" ng-style="{ pointerEvents: row.entity.status? \'auto\': \'none\'}" ng-click="grid.appScope.billingConfig.editDep(row.entity,rowRenderIndex,row)"><i class="fa fa-pencil" ng-if="!row.entity.editable"></i><i class="fa fa-check" ng-if="row.entity.editable"></i></span><div style="float:left;"><md-switch class="md-primary wlabel" ng-disabled="row.entity.editable" ng-model="row.entity.status" ng-change="grid.appScope.billingConfig.activeInactiveStatus(row)">{{row.entity.status?"Active":"InActive"}}</md-switch></div></div>',width:"*",pinnedRight:!0}]},this.saveBillOPVisitConfig=function(a,i,r,n){var l=[];if(null!=r&&null!=r&&r.length>0)for(var s=0;s<a.data.length;s++)for(var o=0;o<r.length;o++)l.push({billVisitconfigSeqId:a.data[s].billVisitconfigSeqId,tariffCatgSeqId:a.data[s].tariffCatgSeqId,doctorSeqId:null==r[o].EMP_SEQ_ID?void 0:r[o].EMP_SEQ_ID,newServSeqId:a.data[s].newServSeqId,fallowUpServSeqId:a.data[s].fallowUpServSeqId,status:a.data[s].status?1:2,tariffClsSeqId:a.data[s].tariffClsSeqId,clinicalSeqId:null==r[o].gQDataCode?void 0:r[o].gQDataCode,newServiceRate:parseInt(a.data[s].newServiceRate),followUpServiceRate:parseInt(a.data[s].followUpServiceRate),opEmergencyRate:0,ipFollowUpServiceRate:parseInt(a.data[s].ipFollowUpServiceRate),"@class":"com.napier.core.service.vo.corebillingmasters.VisitConfigurationVo"});else if(null!=r&&null!=r)for(s=0;s<a.data.length;s++)r&&l.push({billVisitconfigSeqId:a.data[s].billVisitconfigSeqId,tariffCatgSeqId:a.data[s].tariffCatgSeqId,doctorSeqId:"2"==n&&null!=r.CODE?r.CODE:void 0,newServSeqId:a.data[s].newServSeqId,fallowUpServSeqId:a.data[s].fallowUpServSeqId,status:a.data[s].status?1:2,tariffClsSeqId:a.data[s].tariffClsSeqId,clinicalSeqId:"1"==n&&null!=r.CODE?r.CODE:void 0,newServiceRate:parseInt(a.data[s].newServiceRate),followUpServiceRate:parseInt(a.data[s].followUpServiceRate),opEmergencyRate:0,ipFollowUpServiceRate:parseInt(a.data[s].ipFollowUpServiceRate),"@class":"com.napier.core.service.vo.corebillingmasters.VisitConfigurationVo"});for(s=0;s<i.data.length;s++)l.push({billVisitconfigSeqId:i.data[s].billVisitconfigSeqId,newServSeqId:i.data[s].newServSeqId,noOfValidDays:i.data[s].noOfValidDays,noOfVisits:i.data[s].noOfVisits,status:i.data[s].status?1:2,freeDays:i.data[s].freeDays,alternateDoctor:i.data[s].alternateDoctor,alternateVisitType:i.data[s].alternateVisitType,noOfFreeVisits:null==i.data[s].noOfFreeVisits?0:i.data[s].noOfFreeVisits,clinicalSeqId:i.data[s].subSeqCode,"@class":"com.napier.core.service.vo.corebillingmasters.VisitConfigurationVo"});var c={};return c.url=e.HISIPINDENT.URL,c.requestData={operation:"saveBillVisitConfiguration",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:{"@class":"com.napier.core.service.vo.corebillingmasters.VisitConfigurationVoList",visitConfigurationVoLst:[{"com.napier.core.service.vo.corebillingmasters.VisitConfigurationVo":l}]}},t.sendRestRequest(c)}}e.$inject=["BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("opVisitConfService",e)}(),function(){"use strict";function e(e,t){this.saveSlotService=function(a){var i={};return i.url=e.HISCOMBOFILLING.URL,i.requestData={operation:"SaveServiceConfiguration",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:a},t.sendRestRequest(i)},this.saveGrademappingService=function(a){var i={};return i.url=e.HISCOMBOFILLING.URL,i.requestData={operation:"saveSurgeryGradeConfiguration",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:a},t.sendRestRequest(i)},this.saveReducedRateService=function(a){var i={};return i.url=e.HISCOMBOFILLING.URL,i.requestData={operation:"saveReducedRateConfiguration",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:a},t.sendRestRequest(i)},this.saveEmrgRoomRentService=function(a){var i={};return i.url=e.HISCOMBOFILLING.URL,i.requestData={operation:"saveEmrgRoomRentSlotService",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:a},t.sendRestRequest(i)},this.saveOTConfServices=function(a){var i={};return i.url=e.HISCOMBOFILLING.URL,i.requestData={operation:"saveOTConfigurationServices",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:a},t.sendRestRequest(i)},this.saveOTPercService=function(a){var i={};return i.url=e.HISCOMBOFILLING.URL,i.requestData={operation:"updateConfigurationBillingMaster",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:a},t.sendRestRequest(i)},this.saveIpConfigService=function(a){var i={};return i.url=e.HISDEPOSITSEARCH.URL,i.requestData={operation:"saveDoctorVisitConfiguration",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:a},t.sendRestRequest(i)}}e.$inject=["BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("otConfigurationService",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C){i.loadModule("billing");var I,A=S.getLanguageToSet();i.changeLanguage(A),e.oneTimeCanclesave=!1,e.alertObj={},v.loadAlerts(A).then(function(t){e.alertObj=t,e.alertData={buttonText:e.alertObj.ok},e.alertFunction={buttonCallBack1:function(){}},e.closefun={buttonClose:function(){}}}),e.roleValue=D.rolePermission("T_BL_BILLING"),e.cobj={},e.flag=d.flag,e.isCrOrCs=null==d.flagComp?"":d.flagComp,e.serviceGridOptions=angular.copy(n),e.depositGridOptions=angular.copy(n),e.chargeDtlGridOptions=angular.copy(n),l.getColumnDefService(e.serviceGridOptions,a,e.flag),l.getColumnDefDeposit(e.depositGridOptions,a),l.getColumnDefChargeDtls(e.chargeDtlGridOptions,a),I=null==o[0].ipAdmSeqId?"2":"1",m.getPatientBanner(o[0],I).then(function(t){e.patientGlobalDtls=t}),p.patientBannerDetail(o[0].regSeqId).then(function(t){e.patientBannerDetails=t,e.patientRecordsDetail=e.patientBannerDetails.patientRecordsDetail,e.patientValue=e.patientBannerDetails.patientValue}),e.serviceGridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){t.isSelected;e.selectService=e.gridApi.selection.getSelectedRows(),null!=e.selectService&&e.selectService.length>0?e.disableCancel=!0:e.disableCancel=!1}),t.selection.on.rowSelectionChangedBatch(e,function(t){e.selectBatchSelection=e.gridApi.selection.getSelectedRows(),null!=e.selectBatchSelection?e.disableCancel=!0:e.disableCancel=!1})},e.serviceGridOptions.data=[],u=u instanceof Array?u:[u];for(let t=0;t<u.length;t++)2!=u[t].PACK_APPLY_TYPE&&e.serviceGridOptions.data.push(u[t]);r(function(){e.gridApi.selection.selectAllRows()},100),e.depositData=[],e.chargeDtls=[],e.multipleComboDataForList={1:e.chargeDtls,2:e.depositData};var E=t.executeQueryURLReset();e.serviceDataList=new Array,t.prepareParamListWithParam("pBillSeqId",o[0].billSeqId,e.serviceDataList),t.executeQueryInput("GET_BILLING_WORKLIST_AMT_VIEW",e.serviceDataList,e.multipleComboDataForList,!0,!0,E,"popUp",e.serviceGridOptions).then(function(t){e.chargeDtls={},e.chargeDtls=t[1][0]}),e.depositData=[],e.multipleDepositForList={1:e.depositData};var h=t.executeQueryURLReset();e.serviceDataListD=new Array,t.prepareParamListWithParam("pBillSeqId",o[0].billSeqId,e.serviceDataListD),t.executeQueryInput("GET_BILL_WORK_LIST_DEP_ADJUSTMENT_VIEW",e.serviceDataListD,e.multipleDepositForList,!0,!0,h,"popUp",e.serviceGridOptions).then(function(t){e.depositGridOptions.data=t[1]}),e.cancelReasn=[],e.cancelList={1:e.cancelReasn};var b=t.executeQueryURLReset();e.cancelReasnList=new Array,t.executeQueryInput("BL_M_CANCEL_REASON",e.cancelReasnList,e.cancelList,!0,!0,b,"popUp",e.serviceGridOptions),e.cancelBill=function(t,a){e.oneTimeCanclesave=!0;var i,r=null!=e.selectService||null!=e.selectService?e.selectService:e.selectBatchSelection;if(null!=a.cnclBillRsn&&null!=a.cnclBillRsn&&0!=a.cnclBillRsn.length){for(var n=0;n<r.length;n++){if("R"==r[n].SERV_TYPE){i=!1;var l={buttonText:e.alertObj.ok},d={buttonClose:function(){}},p=r[n].SERV_NAME+e.alertObj.rendServCnclPlndSrvCncl;s.information(e.alertObj.alertTypeInfo,p,l,{buttonCallBack1:function(){}},d);break}n==r.length-1&&(i=!0)}if(i){e.disableCancel=!1,null==e.selectService||null==e.selectService?e.selectBatchSelection:null!=e.selectBatchSelection&&null!=e.selectBatchSelection||e.selectService;var m=c.cancelBillDataPrepare(u);c.cancelBillService(t,a,m,e.isCrOrCs,o[0]).then(function(t){if(e.disableCancel=!0,null!=t.data.HITService.message.cancelHdSeqId){var a={buttonText:e.alertObj.ok},i={buttonCallBack1:function(){g.close(!0)}},r={buttonClose:function(){g.close(!0)}},n=e.alertObj.sucsfulyCncld;s.hisAlertMulti("success",e.alertObj.alertTypeSucss,n,a,i,r)}})}}else{var S={buttonText:e.alertObj.ok},v=(d={buttonClose:function(){}},e.alertObj.plzSlctCnlRsn);s.hisAlertMulti("information",e.alertObj.alertTypeInfo,v,S,{buttonCallBack1:function(){}},d)}},e.editGrid=function(t){for(var a=_.findIndex(e.serviceGridOptions.data,function(e){return e.SP_SEQ_ID==t.SP_SEQ_ID}),i=0;i<e.serviceGridOptions.data.length;i++)a==i?(e.serviceGridOptions.data[a].fillHealth=!0,e.serviceGridOptions.data[a].editServCode=e.serviceGridOptions.data[a].SERV_CODE,e.serviceGridOptions.data[a].editServName=e.serviceGridOptions.data[a].SERV_NAME):(e.serviceGridOptions.data[i].SERV_CODE=e.serviceGridOptions.data[i].SERV_CODE&&e.serviceGridOptions.data[i].SERV_CODE.PAYER_ALIAS_CODE?e.serviceGridOptions.data[i].SERV_CODE.PAYER_ALIAS_CODE:e.serviceGridOptions.data[i].SERV_CODE,e.serviceGridOptions.data[i].fillHealth=!1)},e.getAutoSearchQuery=function(a,i){e.getServiceListSearch=[];var r={1:e.getServiceListSearch},n=t.executeQueryURLReset(),l=new Array;return t.prepareParamListWithParam("pServCodeName",a,l),t.prepareParamListWithParam("pPayerSerSeqId",i,l),t.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,l),t.executeQueryInput("PAYER_CODE_NAME_AUTOPOPUP_DETAILS",l,r,!0,!0,n,"popUp",{}).then(function(t){return t[1].length>0?e.getServiceListSearch.map(function(e){return e}):[]})},e.closeGrid=function(t){t.SERV_CODE.PAYER_ALIAS_CODE?e.upDateServiceAliasName(t).then(function(a){if(a.data.HITService.message&&a.data.HITService.message.servicePostingSeqId){var i=_.findIndex(e.serviceGridOptions.data,function(e){return e.SP_SEQ_ID==t.SP_SEQ_ID});e.serviceGridOptions.data[i].SERV_CODE=e.serviceGridOptions.data[i].SERV_CODE.PAYER_ALIAS_CODE?e.serviceGridOptions.data[i].SERV_CODE.PAYER_ALIAS_CODE:e.serviceGridOptions.data[i].SERV_CODE,e.serviceGridOptions.data[i]&&(e.serviceGridOptions.data[i].SERV_CODE=e.serviceGridOptions.data[i].SERV_CODE,e.serviceGridOptions.data[i].SERV_NAME=e.serviceGridOptions.data[i].SERV_NAME),e.serviceGridOptions.data[i].fillHealth=!1}else if(a.data.HITService.message&&a.data.HITService.message.errorCode)return void s.hisAlertMulti("information",e.alertObj.alertTypeInfo,a.data.HITService.message.errorMessage,e.alertData,e.alertFunction,e.close)}):s.hisAlertMulti("information",e.alertObj.alertTypeInfo,"The entered code has not been captured as a payer code in the contract definition",e.alertData,e.alertFunction,e.close)},e.upDateServiceAliasName=function(e){var t={};return t.url=f.HISIPINDENT.URL,t.requestData={operation:"simpleUpdateForServicePosting",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",servicePostingSeqId:e.SP_SEQ_ID,philHealthCode:e.SERV_CODE.PAYER_ALIAS_CODE,philHealthName:e.SERV_CODE.PAYER_ALIAS_NAME}},y.sendRestRequest(t)},e.viewPackageDetails=function(t){sessionStorage.setItem("packageSeqId",t.SERV_SEQ_ID),sessionStorage.setItem("spSeqId",t.SP_SEQ_ID),sessionStorage.setItem("bedClassId",e.patientGlobalDtls.bedClassCode),C.open("Package Charge Details",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/packageAssignment/package.view.screen.html",size:"lg",controller:"packageAssignmentController",controllerAs:"packageAssignment",resolve:{}}).result.then(function(e){},function(e){})}}e.$inject=["$scope","QueryService","uiGridConstants","hisTranslationsService","$timeout","billWorkGridDefinition","CancelBillGridColDef","hisAlertService","billSelectedData","CancelBillService","flag","PatientBannerBilling","serviceData","PatientBannerGlobal","$uibModalInstance","hisTranslationsGlobalLang","hisGenericAlertService","RoleTaskService","CallManager","IPINDENTAPIS","hisModalService"],angular.module("napierContainerUi").controller("cancelController",e)}(),function(){"use strict";angular.module("napierContainerUi").service("CancelBillGridColDef",["$translate","hisTranslationsService",function(e,t){this.getColumnDefService=function(e,a,i){e.gridMenuTitleFilter=t.menuTranslate,e.enableRowHeaderSelection=i,e.multiSelect=!0,e.noUnselect=!0,e.enableFullRowSelection=!1,e.columnDefs=[{name:"SERV_CODE",displayName:"billing.serviceCode",cellTemplate:'<div ng-if="!row.entity.fillHealth" class="ui-grid-cell-contents leftAlign">{{row.entity.SERV_CODE}}<span ><i  ng-if="row.entity.PAYER_SER_SEQ_ID&&row.entity.IS_MULTI_SEVICE_NAMES==\'Y\'&& grid.appScope.roleValue.T_BL_BILLING_EPAC" class="fa fa-pencil" ng-click="grid.appScope.editGrid(row.entity)" ></i> </span></div><div class="ui-grid-cell-contents" ng-if="row.entity.fillHealth" ><input type="text" ng-model="row.entity.SERV_CODE" uib-typeahead="query as query.PAYER_ALIAS_CODE  for query in grid.appScope.getAutoSearchQuery($viewValue,row.entity.PAYER_SER_SEQ_ID) "  typeahead-min-length="2"  typeahead-on-select="row.entity.SERV_NAME=row.entity.SERV_CODE.PAYER_ALIAS_NAME" style="margin-top: -4px;width:60%" typeahead-append-to-body=true ><span ><i   ng-disabled="!row.entity.SERV_CODE" class="fa fa-check" aria-hidden="true" ng-click="grid.appScope.closeGrid(row.entity,rowRenderIndex)" ></i><i ng-disabled="!row.entity.SERV_CODE" ng-click="row.entity.SERV_CODE=(row.entity.editServCode)?row.entity.editServCode:row.entity.SERV_CODE;row.entity.SERV_NAME=(row.entity.editServName)?row.entity.editServName:row.entity.SERV_NAME;row.entity.fillHealth=false;" class="fa fa-ban" aria-hidden="true"></i></span></div>',enableSorting:!0,enableCellEdit:!1,pinnedLeft:!1,width:100,headerCellFilter:"translate"},{name:"SERV_NAME",displayName:"billing.serviceName",enableSorting:!0,enableCellEdit:!1,width:150,headerCellFilter:"translate"},{name:"SERV_DATE",displayName:"billing.serviceDate",enableSorting:!0,enableCellEdit:!1,width:150,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.SERV_DATE|date:"dd/MM/yyyy"}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()  }}</div>',aggregationType:a.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"QTY",displayName:"billing.quantity",enableSorting:!0,enableCellEdit:!1,width:100,headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()  }}</div>',aggregationType:a.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"SERVICE_RATE",displayName:"billing.serviceRate",enableSorting:!0,enableCellEdit:!1,width:150,headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()  }}</div>',aggregationType:a.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"AMOUNT",displayName:"billing.amt",enableSorting:!0,enableCellEdit:!1,width:100,headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()  }}</div>',aggregationType:a.aggregationTypes.sum},{name:"TAX_AMT",displayName:"billing.tax",enableSorting:!0,enableCellEdit:!1,width:150,headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()  }}</div>',aggregationType:a.aggregationTypes.sum},{name:"NONCHARGEABLE_AMT",displayName:"billing.nonChrgblAmnt",enableSorting:!0,enableCellEdit:!1,width:200,headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()  }}</div>',aggregationType:a.aggregationTypes.sum},{name:"SURCHARGE_ONDOCT_NOCHARGE",displayName:"billing.paySurcharge",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:150,footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()  }}</div>',aggregationType:a.aggregationTypes.sum},{name:"HOSP_SHARE",displayName:"billing.hospShare",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:120,footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()  }}</div>',aggregationType:a.aggregationTypes.sum},{name:"DOCT_SHARE",displayName:" billing.docShare",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:100,footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()  }}</div>',aggregationType:a.aggregationTypes.sum},{name:"DEPARTMENT",displayName:"billing.department",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:120},{name:"DOCT_NAME",displayName:"billing.doc",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:150},{name:"DOCTOR_SURCHARE",displayName:"billing.docSurcharge",enableSorting:!0,enableCellEdit:!1,width:150,headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()  }}</div>',aggregationType:a.aggregationTypes.sum},{name:"BILL_GRP_DESC",displayName:"billing.billingGroup",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:100},{name:"actions",displayName:"Action",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents rightAlign" ng-if="row.entity.PACK_APPLY_TYPE==4"  ng-click="grid.appScope.viewPackageDetails(row.entity)" role="button"><i class="fa fa-eye eye-color" aria-hidden="true"></i></div>'}]},this.getColumnDefDeposit=function(e,a){e.gridMenuTitleFilter=t.menuTranslate,e.columnDefs=[{name:"depositSeqId",visible:!1},{name:"DEPOSIT_DATE",displayName:"billing.depositDate",enableSorting:!0,enableCellEdit:!1,width:120,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.DEPOSIT_DATE|date:"dd/MM/yyyy"}}</div>'},{name:"DEPOSIT_TYPE_CODE",displayName:"billing.depositType",enableSorting:!0,width:120,enableCellEdit:!1,headerCellFilter:"translate"},{name:"DEPOSIT_AMOUNT",displayName:"billing.depositAmt",enableSorting:!0,enableCellEdit:!1,width:120,headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.depositAmount=col.getAggregationValue() |number:2}}</div>',aggregationType:a.aggregationTypes.sum},{name:"AVAIL_AMT",displayName:"billing.availAmt",enableSorting:!0,enableCellEdit:!1,width:130,headerCellFilter:"translate"},{name:"DEP_ADJ_AMOUNT",displayName:"billing.adjAmt",enableSorting:!0,width:150,headerCellFilter:"translate",enableCellEditOnFocus:!1,enableCellEdit:!1}]},this.getColumnDefChargeDtls=function(e,a){e.gridMenuTitleFilter=t.menuTranslate,e.columnDefs=[{name:"charge_dtls",displayName:"Charge Details",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate"}]}}])}(),function(){"use strict";angular.module("napierContainerUi").service("CancelBillService",["CallManager","$filter","IPINDENTAPIS",function(e,t,a){this.cancelBillDataPrepare=function(e){for(var t=0,a={service:[],approvedAmt:0,taxAmt:0},i=0;i<e.length;i++)a.service.push({servicePostSeqId:e[i].SP_SEQ_ID}),t+=parseFloat(e[i].AMOUNT),null!=e[i].TAX_AMT&&(a.taxAmt=a.taxAmt+parseFloat(e[i].TAX_AMT)),i==e.length-1&&(a.approvedAmt=t);return a},this.cancelBillService=function(i,r,n,l,s){var o={};let c=0;return null==i.DEPOSIT_APPLIED_AMT&&(i.DEPOSIT_APPLIED_AMT=0),null==i.PATINET_DUE&&(i.PATINET_DUE=0),c=parseFloat(i.PATINET_DUE)+parseFloat(i.DEPOSIT_APPLIED_AMT),o.url=a.HISIPINDENT.URL,o.requestData={operation:"cancelBillNew",messageId:"",destination:"com.napier.core.billgeneration.service.external.BillGenerationService",message:{"@class":"com.napier.core.billgeneration.vo.BillCanceHdlDetails",billCancDtList:[{"com.napier.core.billgeneration.vo.BillCancelDtDetails":n.service}],billSeqId:i.BILL_SEQ_ID,cancelBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,cancelbillDate:t("date")(new Date,"yyyy-MM-dd HH:MM:ss.s"),cancelNo:"",cancelReasonCode:r.cnclBillRsn.CODE,cancelReason:r.cnclBillRsn.DESCRIPTION,cancelRemarks:r.remarks,approvedAmt:c>0?c:n.approvedAmt,flagIp:!0,gnTranStatus:"1",lastUpdatedOn:t("date")(new Date,"yyyy-MM-dd HH:MM:ss.s"),cancelBill:!1,insurancePlanSeqId:0,isCsOrCR:"Y"==l,subAccSeqId:s.subAccSeqId,ipAdmSeqId:s.ipAdmSeqId,cancelStatus:{code:"4"}}},e.sendRestRequest(o)},this.saveChangeCategoryService=function(t){var i={url:a.HISIPINDENT.URL,requestData:{operation:"saveChangeCategory",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:t}};return e.sendRestRequest(i)},this.updateChangeCategoryService=function(t){var i={url:a.HISIPINDENT.URL,requestData:{operation:"getCalculatedServicePostings",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:t}};return e.sendRestRequest(i)}}])}(),function(){"use strict";angular.module("napierContainerUi").constant("billWorkGridDefinition",{enableSorting:!0,enableCellEditOnFocus:!1,enableHorizontalScrollbar:1,enableRowHeaderSelection:!0,multiSelect:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,showGridFooter:!1,showColumnFooter:!1,paginationPageSize:10,useExternalSorting:!1,enableColumnMenus:!0,showTreeExpandNoChildren:!0}).constant("consServWiseGridDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"select",displayName:"billing.select",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents" ><input style="border-width: 0px;" type="checkbox" ng-disabled="row.entity.concessionApplicability == \'Not Applicable\'" ng-model="row.entity.editmode"/></div>',width:"6%"},{name:"serviceCode",displayName:"billing.serviceCode",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:"*"},{name:"serviceName",displayName:"billing.serviceName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"serviceCost",displayName:"billing.serviceCost",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"serviceQuantity",displayName:"billing.quantity",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"totalAmount",displayName:"billing.totalCost",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"billLimitPercent",displayName:"billing.limitWithSybml",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div style="" ng-if="row.entity.defaultamountType == 1">{{row.entity.concessionAmount}}</div></div>',width:"*"},{name:"serviceLimitAmount",displayName:"billing.limitAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div style="" ng-if="row.entity.defaultamountType == 2">{{row.entity.serviceLimitAmount}}</div></div>',width:"*"},{name:"concessionRequest",displayName:"billing.concssionRequst",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div  class="ui-grid-cell-contents"><div ng-if="row.entity.editmode"><input ng-keyup="grid.appScope.bWC.checkValue(row.entity, \'service\')" class="form-control" style="width:56px; margin-top: -4px; float:left" ng-model="row.entity.concessionRequest" ng-blur="grid.appScope.bWC.concessionCompare(row.entity, \'service\')"/> <select class="form-control" style="width:55px;margin-left:3px;float:right" ng-options="concession.CODE as concession.DESCRIPTION for concession in grid.appScope.bWC.conReqCombo" ng-model="row.entity.amountType"  ng-change="grid.appScope.bWC.concessionCompareChange(row.entity, \'service\')"></select></div></div>',width:130},{name:"concessionApplicability",displayName:"billing.concssionAplicble",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"}],enablePaginationControls:!1,useExternalSorting:!1,enableColumnMenus:!1}).constant("ageWiseBillReport",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,paginationPageSizes:[10,16,32,64],paginationPageSize:10,columnDefs:[{name:"PAT_CATG_DESC",displayName:"Patient Category",width:"10%"},{name:"COMP_DESC",displayName:"Company Name",width:"10%"},{name:"BILL_NO",displayName:"Bill No",width:"10%"},{name:"MR_NO",displayName:"MR No",width:"10%"},{name:"IP_OP_NO",displayName:"Vist No/ Admission No",width:"13%"},{name:"RG_FIRST_NAME",displayName:"Patient Name",width:"10%"},{name:"BILL_AMT",displayName:"Billed/ UnBilled Amount",width:"10%",cellFilter:"number: 2"},{name:"COMPANY_AMOUNT",displayName:"Company Amount",width:"10%",cellFilter:"number: 2"},{name:"PATIENT_AMOUNT",displayName:"Patient Amount",width:"10%",cellFilter:"number: 2"},{name:"COMPANY_DUE",displayName:"Company Outstanding Amount",width:"20%",cellFilter:"number: 2"},{name:"PATIENT_DUE",displayName:"Patient Outstanding Amount",width:"20%",cellFilter:"number: 2"},{name:"zeroTothirty",displayName:"0-30 (Days)",width:"12%",cellFilter:"number: 2"},{name:"thirtyOneToSixty",displayName:"31-60 (Days)",width:"12%",cellFilter:"number: 2"},{name:"sixtyoneToNinty",displayName:"61-90 (Days)",width:"12%",cellFilter:"number: 2"},{name:"moreThanNinty",displayName:">90 (Days)",width:"12%",cellFilter:"number: 2"}]}).constant("ageWiseBillSummaryReport",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,paginationPageSizes:[10,16,32,64],paginationPageSize:10,columnDefs:[{name:"RG_FIRST_NAME",displayName:"Patient Name",width:"*"},{name:"MR_NO",displayName:"MR NO",width:"*"},{name:"IP_OP_NO",displayName:"Visit/ Admission No",width:"*"},{name:"COMP_DESC",displayName:"Company Name",width:"*"},{name:"BILL_NO",displayName:"Bill No",width:"*"},{name:"COMPANY_AMOUNT",displayName:"Company Amount",width:"*",cellFilter:"number: 2"},{name:"PATIENT_AMOUNT",displayName:"Patient Amount",width:"*",cellFilter:"number: 2"},{name:"COMPANY_DUE",displayName:"Company Outstanding Amount",width:"*",cellFilter:"number: 2"},{name:"PATIENT_DUE",displayName:"Patient Outstanding Amount",width:"*",cellFilter:"number: 2"},{name:"BILL_AMT",displayName:"Total",width:"*",cellFilter:"number: 2"}]}).constant("consBillWiseGridDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"billNo",displayName:"billing.billNo",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"billAmount",displayName:"billing.billAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"billDate",displayName:"billing.billDate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"billLimitPercent",displayName:"billing.limitWithSybml",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="row.entity.defaultamountType == 1">{{row.entity.concessionAmount}}</div></div>',width:"*"},{name:"billLimitAmount",displayName:"billing.limitAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="row.entity.defaultamountType == 2">{{row.entity.billLimitAmount}}</div></div>',width:"*"},{name:"concessionRequest",displayName:"billing.concssionRequst",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><input style="width:65px;margin-top: -4px;float:left" ng-keyup="grid.appScope.bWC.checkValue(row.entity, \'bill\')" class="form-control" ng-model="row.entity.concessionRequest"  ng-blur="grid.appScope.bWC.concessionCompare(row.entity, \'bill\')"/><select style="width:60px;margin-left:3px;float:right" class="form-control" ng-options="concession.CODE as concession.DESCRIPTION for concession in grid.appScope.bWC.conReqCombo" ng-model="row.entity.amountType" ng-change="grid.appScope.bWC.concessionCompareChange(row.entity, \'bill\')"></select></div>',width:"*"}],enablePaginationControls:!1,useExternalSorting:!1,enableColumnMenus:!1,paginationPageSize:1})}(),function(){"use strict";angular.module("napierContainerUi").service("GetBillWorkListData",["CallManager","$filter","IPINDENTAPIS",function(e,t,a){this.getBillWorkList=function(i){var r={};return r.url=a.HISIPINDENT.URL,r.requestData={operation:"getBillingWorkList",messageId:"",destination:"com.napier.core.billgeneration.service.external.BillGenerationService",message:{"@class":"com.napier.core.billgeneration.vo.BillingWorkListSearch",fromDate:t("date")(new Date(i.frmDate),"yyyy-MM-dd")+" 00:00:00.111",toDate:t("date")(new Date(i.toDate),"yyyy-MM-dd")+" 23:59:59.333",mrNO:null!=i.patientInput&&null!=i.patientInput.mrNo?i.patientInput.mrNo:null!=i.patientInput?i.patientInput:void 0,billSearchStatus:null==i.billStatus||"Bill"==i.billStatus||"7"==i.billStatus||"0"==i.billStatus?void 0:i.billStatus,billStatus:null==i.billStatus||"0"==i.billStatus?void 0:"Bill"==i.billStatus||"7"==i.billStatus?"Bill"==i.billStatus?1:7:void 0,paymentStatus:null!=i.paymentStatus&&0!=i.paymentStatus?i.paymentStatus:void 0,billInvoiceStatus:null!=i.invoiceStatus&&0!=i.invoiceStatus?i.invoiceStatus:void 0,billNO:null==i.billNo||null==i.billNo||""==i.billNo?void 0:null==i.billNo.BILL_NO?"%"+i.billNo+"%":i.billNo.BILL_NO,patientName:null==i.patientName||null==i.patientName||""==i.patientName?void 0:i.patientName,payer:null!=i.payer&&null!=i.payer&&i.payer!=[]?i.payer.INS_SEQ_ID:void 0,billCategory:null!=i.billCategory&&null!=i.billCategory&&0!=i.billCategory?i.billCategory:void 0}},e.sendRestRequest(r)},this.getBillDataInGrid=function(e,t){for(var a=e instanceof Array?e:[e],i=0;i<a.length;i++){var r=a[i].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"],n=[];if(null!=r){n=r instanceof Array?r:[r];for(var l=0,s=0;s<n.length;s++)null!=n[s].settledAmount&&(l+=n[s].settledAmount,a[i].settledAmount=l)}a[i].$$treeLevel=0,t.data.push(a[i]);for(var o=0;o<n.length;o++)t.data.push({payerName:n[o].payerName,billAmount:n[o].payerAmount,tobePaidAmount:n[o].dueAmount,billPayStatusDesc:n[o].paymentStatusDesc,settledAmount:n[o].settledAmount,consStatus:99,refundStaus:99,Authentication:99,splitStaus:99,writeofStatus:99})}}}])}(),function(){"use strict";function e(e,t,a){function i(e,t){var a=e*(t/100);return null==a||!angular.isNumber(a)||isNaN(a)?"":a.toFixed(2)}function r(e,t){if(t>=e)var a=100;else a=t/e*100;return a.toFixed(2)}function n(e){return e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]}this.getServiceDetails=function(n){var l=e.defer(),s={"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionRequestDetails",concessionSeqID:n.concessionSeqid,billSeqId:n.billSeqId,concessionType:n.concessionType},o={};return o.url=t.HISCONSESSIONSERVICEDETAILS.URL,o.requestData={operation:"getServiceDetails",messageId:"",destination:"com.napier.core.corebillingconcession.service.external.CoreBillingConcessionService",message:s},a.sendRestRequest(o).then(function(e){var t=e.data.HITService.message[0]["com.napier.core.service.vo.corebillingconcession.ConcessionRequestDetails"];if(null==t)return l.reject("No Data");var a=[];if(Array.isArray(t)){angular.forEach(t,function(e,t){if(1==e.amountType)var n=i(e.billAmount,e.concessionAmount),l=i(e.totalAmount,e.concessionAmount),s=e.concessionAmount,o=e.concessionAmount;else n=e.concessionAmount,l=e.concessionAmount,s=r(e.billAmount,e.concessionAmount),o=r(e.totalAmount,e.concessionAmount);var c={defaultamountType:null!=e.amountType?e.amountType:"",amountType:null!=e.amountType?e.amountType:1,billAmount:null!=e.billAmount?e.billAmount:"",billDate:null!=e.billDate?moment(e.billDate.$).format("MM/DD/YYYY"):"",billNo:null!=e.billNo?e.billNo:"",billSeqId:null!=e.billSeqId?e.billSeqId:"",concessionAmount:null!=e.concessionAmount?e.concessionAmount:"",concessionApplicability:null!=e.concessionApplicability?e.concessionApplicability:"",servSeqId:null!=e.servSeqId?e.servSeqId:"",serviceCode:null!=e.serviceCode?e.serviceCode:"",serviceCost:null!=e.serviceCost?e.serviceCost:"",serviceName:null!=e.serviceName?e.serviceName:"",servicePostSeqID:null!=e.servicePostSeqID?e.servicePostSeqID:"",serviceQuantity:null!=e.serviceQuantity?e.serviceQuantity:"",totalAmount:null!=e.totalAmount?e.totalAmount:"",billLimitAmount:n,serviceLimitAmount:l,billLimitPercent:s,serviceLimitPercent:o};a.push(c)});var n={}}else{if(1==t.amountType)var s=i(t.billAmount,t.concessionAmount),o=i(t.totalAmount,t.concessionAmount),c=t.concessionAmount,d=t.concessionAmount;else s=t.concessionAmount,o=t.concessionAmount,c=r(t.billAmount,t.concessionAmount),d=r(t.totalAmount,t.concessionAmount);n={defaultamountType:null!=t.amountType?t.amountType:"",amountType:null!=t.amountType?t.amountType:1,billAmount:null!=t.billAmount?t.billAmount:"",billDate:null!=t.billDate?moment(t.billDate.$).format("MM/DD/YYYY"):"",billNo:null!=t.billNo?t.billNo:"",billSeqId:null!=t.billSeqId?t.billSeqId:"",concessionAmount:null!=t.concessionAmount?t.concessionAmount:"",concessionApplicability:null!=t.concessionApplicability?t.concessionApplicability:"",servSeqId:null!=t.servSeqId?t.servSeqId:"",serviceCode:null!=t.serviceCode?t.serviceCode:"",serviceCost:null!=t.serviceCost?t.serviceCost:"",serviceName:null!=t.serviceName?t.serviceName:"",servicePostSeqID:null!=t.servicePostSeqID?t.servicePostSeqID:"",serviceQuantity:null!=t.serviceQuantity?t.serviceQuantity:"",totalAmount:null!=t.totalAmount?t.totalAmount:"",billLimitAmount:s,serviceLimitAmount:o,billLimitPercent:c,serviceLimitPercent:d};a.push(n)}l.resolve(a)}),l.promise},this.checkConcessionStatus=function(i){var r=e.defer(),l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"BL_CONCS_DUP_CHK1",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:i}]}]}]}]},s={};return s.url=t.HISCONCESSIONDETAILSCHECK.URL,s.requestData={operation:"ExecuteQuery",destination:"QueryService",message:l},a.sendRestRequest(s).then(function(e){var l=n(e);if(null!=l&&0==l.columnList[0]["com.napier.core.service.vo.query.Column"].data){var s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"BL_CANCEL_CHK",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:i}]}]}]}]},o={};o.url=t.HISCONCESSIONDETAILSCHECK.URL,o.requestData={operation:"ExecuteQuery",destination:"QueryService",message:s},a.sendRestRequest(o).then(function(e){var t=n(e);null!=t&&0==t.columnList[0]["com.napier.core.service.vo.query.Column"].data?r.resolve("Bill data Available"):r.reject("Concession already provided for the selected bill. Can't raise the Concession Request")})}else r.reject("Concession already provided for the selected bill. Can't raise the Concession Request")}),r.promise},this.FileUploadSave=function(i){var r=e.defer(),n={"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionReqDocVo",billSeqId:i.billSeqId,fileName:i.fName,fileSize:i.fsize,requestDocument:i.requestDocument.split("base64,")[1],tranStatus:"1"},l={};return l.url=t.HISCONSESSIONUPLOADFILES.URL,l.requestData={operation:"uploadConcessionReqDoc",messageId:"",destination:"com.napier.core.corebillingconcession.service.external.CoreBillingConcessionService",message:n},a.sendRestRequest(l).then(function(e){var t=e.data.HITService.message;null!=t&&null!=t.concReqDocSeqId||r.reject("Upload Failed"),r.resolve(t.concReqDocSeqId)}),r.promise},this.linkUploadedFilestoConcession=function(i,r,n){var l=e.defer(),s={"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionReqDocVo",billSeqId:i,concReqSeqId:r,saveFileReqConcDocId:[{"java.math.BigDecimal":n}]},o={};return o.url=t.HISCONSESSIONUPLOADFILES.URL,o.requestData={operation:"updateUploadedConcessionReqDoc",messageId:"",destination:"com.napier.core.corebillingconcession.service.external.CoreBillingConcessionService",message:s},a.sendRestRequest(o).then(function(e){var t=e.data.HITService.message;null==t&&l.reject("Upload Failed"),l.resolve(t)}),l.promise},this.concessionTypeCombo=function(i){var r=e.defer(),l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"CONCESS_MASTER_001",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"2",value:1},{ident:"3",value:i}]}]}]}]},s={};return s.url=t.HISCONSESSIONTYPECOMBO.URL,s.requestData={operation:"ExecuteQuery",destination:"QueryService",message:l},a.sendRestRequest(s).then(function(e){var t=n(e),a=[];if(Array.isArray(t))angular.forEach(t,function(e,t){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={CODE:i[0].data,DESCRIPTION:i[1].data};a.push(r)});else if(null!=t.columnList){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"],l={CODE:i[0].data,DESCRIPTION:i[1].data};a.push(l)}r.resolve(a)}),r.promise},this.saveBillWiseConcession=function(i,r){var n=angular.copy(i),l=e.defer(),s={"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionRequest",concessionSeqId:null!=n.concessiontype.CODE?n.concessiontype.CODE:"",billSeqId:null!=r[0].billSeqId?r[0].billSeqId:"",concessionStatus:"1",remarks:null!=n.remarks?n.remarks:"",reasonForConcession:null!=n.reasonForConcession?n.reasonForConcession:"",tranStatus:"1",concessionType:null!=n.cType?n.cType:"",concessionRequestDetailsList:[{"com.napier.core.service.vo.corebillingconcession.ConcessionRequestDetails":[{servicePostSeqID:null!=r[0].servicePostSeqID?r[0].servicePostSeqID:"",reqConession:null!=r[0].concessionRequest?r[0].concessionRequest:0,amountType:null!=r[0].amountType?r[0].amountType:"",concessionStatus:"1",tranStatus:"1"}]}]},o={};return o.url=t.HISCONBILLWISESAVE.URL,o.requestData={operation:"saveConessionRequest",messageId:"",destination:"com.napier.core.corebillingconcession.service.external.CoreBillingConcessionService",message:s},a.sendRestRequest(o).then(function(e){l.resolve(e)}),l.promise},this.saveServiceWiseConcession=function(i,r){for(var n=angular.copy(i),l=e.defer(),s={"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionRequest",concessionSeqId:null!=n.concessiontype.CODE?n.concessiontype.CODE:"",billSeqId:null!=r[0].billSeqId?r[0].billSeqId:"",concessionStatus:"1",remarks:null!=n.remarks?n.remarks:"",reasonForConcession:null!=n.reasonForConcession?n.reasonForConcession:"",tranStatus:"1",concessionType:null!=n.cType?n.cType:"",concessionRequestDetailsList:[{"com.napier.core.service.vo.corebillingconcession.ConcessionRequestDetails":[]}]},o=0;o<r.length;o++){n={servSeqId:null!=r[o].servSeqId?r[o].servSeqId:"",servicePostSeqID:null!=r[o].servicePostSeqID?r[o].servicePostSeqID:"",reqConession:r[o].editmode&&null!=r[o].concessionRequest?r[o].concessionRequest:0,amountType:null!=r[o].amountType?r[o].amountType:"",concessionStatus:"1",tranStatus:"1"};s.concessionRequestDetailsList[0]["com.napier.core.service.vo.corebillingconcession.ConcessionRequestDetails"].push(n)}var c={};return c.url=t.HISCONSERVICEWISESAVE.URL,c.requestData={operation:"saveConessionRequest",messageId:"",destination:"com.napier.core.corebillingconcession.service.external.CoreBillingConcessionService",message:s},a.sendRestRequest(c).then(function(e){l.resolve(e)}),l.promise},this.concessionReqCombo=function(){var i=e.defer(),r={};return r.url=t.HISCONCESSIONREQUESTCOMBO.URL,r.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"TRN003",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:6502},{ident:"2",value:6502}]}]}]}]}},a.sendRestRequest(r).then(function(e){var t=n(e),a=[];angular.forEach(t,function(e,t){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={CODE:i[0].data,DESCRIPTION:i[1].data};a.push(r)}),i.resolve(a)}),i.promise}}e.$inject=["$q","BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("angBillConcessionService",e)}(),function(){"use strict";angular.module("napierContainerUi").service("GenerateInvoiceService",["CallManager","IPINDENTAPIS",function(e,t){this.saveGenerateInvoice=function(a,i){for(var r,n=[],l=0,s=0,o=0,c=0;c<a.length;c++){var d=a[c].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"];d=d instanceof Array?d:[d],s=a.length;for(var p=0;p<d.length;p++){var u=null==d[p].settledAmt?0:d[p].settledAmt;l+=d[p].dueAmount,r=d[p].payerType,d[p].payerSeqId,o+=u,n.push({settledAmount:u,amount:d[p].dueAmount,billPayerSeqId:d[p].billPayerSeqId,billSeqId:d[p].billSeqId})}}var m={};return m.url=t.HISIPINDENT.URL,m.requestData={operation:"saveInvoice",messageId:"",destination:"com.napier.core.invoicesettlement.service.external.InvoiceService",message:{"@class":"com.napier.core.invoicesettlement.vo.InvoiceHeader",invoiceAmount:l,companyType:r,noOfBills:s,settledAmount:o,invoiceStatus:2,companySeqId:null!=i&&null!=i[0]?i[0].CLAIM_TO:null!=d&&null!=d[0]?d[0].payerSeqId:void 0,invoiceDetailsList:[{"com.napier.core.invoicesettlement.vo.InvoiceDetails":n}]}},e.sendRestRequest(m)}}])}(),function(){"use strict";angular.module("napierContainerUi").service("BillWorkListGridColDef",["hisTranslationsService",function(e){this.getColumnDefAll=function(t,a){t.gridMenuTitleFilter=e.menuTranslate,t.columnDefs=[{name:"flag",displayName:"",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!1,width:20,cellTemplate:'<div class="ui-grid-cell-contents"><label class="" ng-class={"flagBill":row.entity.billStatusDesc=="Cancelled"}></label></div>'},{name:"patientName",displayName:"billing.patientName",enableSorting:!0,enableCellEdit:!1,width:150,headerCellFilter:"translate",headerCellClass:"center",cellClass:"center"},{name:"mrNo",displayName:"billing.mrNo",enableSorting:!0,enableCellEdit:!1,width:150,headerCellFilter:"translate",aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center"},{name:"ipNo",displayName:"billing.visitNo",enableSorting:!0,enableCellEdit:!1,width:100,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.encNo.split(" ")[0]}}</div>',headerCellFilter:"translate",headerCellClass:"center",cellClass:"center"},{name:"billNo",displayName:"billing.billNo",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!1,width:150,headerCellFilter:"translate"},{name:"billRefId",displayName:"billing.originalBillNo",enableSorting:!0,enableCellEdit:!1,width:150,headerCellFilter:"translate"},{name:"taxInvoiceNo",displayName:"billing.taxInvoice",enableSorting:!0,enableCellEdit:!1,width:150,headerCellFilter:"translate"},{name:"admissionStatus",displayName:"Discharge Clearance Status",enableSorting:!1,enableCellEdit:!1,width:150,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="row.entity.admissionStatus!=undefined&&row.entity.admissionStatus">{{row.entity.admissionStatus==5||row.entity.admissionStatus==2?"Cleared":"Not Cleared"}}</span></div>'},{name:"billDate.$",displayName:"billing.billDateTime",enableSorting:!0,enableCellEdit:!1,width:150,sort:{direction:"desc"},headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.billDate.$|date:"dd/MM/yyyy hh:mm a"}}</div>'},{name:"payerName",displayName:"billing.payerName",enableSorting:!0,enableCellEdit:!1,width:100,headerCellFilter:"translate"},{name:"billAmount",displayName:"billing.billAmt",enableSorting:!0,enableCellEdit:!1,width:150,type:"number",headerCellFilter:"translate",cellFilter:"number: 2"},{name:"consessionAmt",displayName:"billing.concssionAmt",enableSorting:!0,enableCellEdit:!1,width:150,headerCellFilter:"translate",type:"number",cellFilter:"number: 2"},{name:"settledAmount",displayName:"billing.stltdAmt",enableSorting:!0,enableCellEdit:!1,width:200,headerCellFilter:"translate",type:"number",cellFilter:"number: 2"},{name:"tobePaidAmount",displayName:"billing.dueAmt",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:100,type:"number",cellFilter:"number: 2"},{name:"billPayStatusDesc",displayName:"billing.pymentStatus",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:120},{name:"invoiceStatus",displayName:"billing.inviceStatus",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:150},{name:"billStatusDesc",displayName:"billing.billStatus",enableSorting:!0,enableCellEdit:!1,width:150,headerCellFilter:"translate"},{name:"consStatus",displayName:"billing.c",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:50,cellTemplate:'<div class="ui-grid-cell-contents"><span><i class="fa" aria-hidden="true"  ng-class={"fa-minus":row.entity.consStatus==undefined||row.entity.consStatus==0,"fa-check":row.entity.consStatus==2,"fa-circle-o":row.entity.consStatus==1,"fa-times":row.entity.consStatus==3,"not-app-color":row.entity.consStatus==undefined||row.entity.consStatus==0,"approved-color":row.entity.consStatus==2,"progress-color":row.entity.consStatus==1,"rejected-color":row.entity.consStatus==3}></i></span></div>'},{name:"refundStaus",displayName:"billing.r",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:50,cellTemplate:'<div class="ui-grid-cell-contents"><span><i class="fa" aria-hidden="true"  ng-class={"fa-minus":row.entity.refundStaus==undefined,"fa-check":row.entity.refundStaus==2,"fa-circle-o":row.entity.refundStaus==1,"fa-times":row.entity.refundStaus==3,"not-app-color":row.entity.refundStaus==undefined,"approved-color":row.entity.refundStaus==2,"progress-color":row.entity.refundStaus==1,"rejected-color":row.entity.refundStaus==3}></i></span></div>'},{name:"splitStaus",displayName:"billing.s",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:50,cellTemplate:'<div class="ui-grid-cell-contents"><span><i class="fa" aria-hidden="true"  ng-class={"fa-minus":row.entity.splitStaus==undefined||row.entity.splitStaus==0,"fa-check":row.entity.splitStaus==2,"fa-circle-o":row.entity.splitStaus==1,"fa-times":row.entity.splitStaus==3,"not-app-color":row.entity.splitStaus==undefined||row.entity.splitStaus==0,"approved-color":row.entity.splitStaus==2,"progress-color":row.entity.splitStaus==1,"rejected-color":row.entity.splitStaus==3}></i></span></div>'}]}}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){t.loadModule("billing");var S=g.getLanguageToSet();t.changeLanguage(S);var v=this;v.changePyers=[],v.alertObj={},m.loadAlerts(S).then(function(e){v.alertObj=e,i.alertData={buttonText:v.alertObj.ok},i.alertFunction={buttonCallBack1:function(){}},i.closefun={buttonClose:function(){}}}),v.save=!0,v.self=0;var D=!1;if(v.selectBill=JSON.parse(p.selectBill),v.totalAmount=0,v.totalAmountTemp=v.selectBill[0].billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"],v.totalAmountTemp instanceof Array)for(var y=0;y<v.totalAmountTemp.length;y++)v.totalAmount=v.totalAmount+v.totalAmountTemp[y].payerAmount;else v.totalAmount=v.totalAmount+v.totalAmountTemp.payerAmount;e.getPatientBanner(v.selectBill[0],"2").then(function(e){i.patientGlobalDtls=e,null!=i.patientGlobalDtls.mrNo?i.patientShow=!0:i.patientShow=!1}),a.patientBannerDetail(v.selectBill[0].regSeqId).then(function(e){i.patientBannerDetails=e,i.patientRecordsDetail=i.patientBannerDetails.patientRecordsDetail,i.patientValue=i.patientBannerDetails.patientValue}),v.patientAmounttemp=0,v.payerAmounttemp=0,v.patientAmount=0,c.columnDefs[0].footerCellTemplate='<div class="ui-grid-cell-contents">Payer(s) Amount</div>',c.columnDefs[1].footerCellTemplate='<div class="ui-grid-cell-contents">{{grid.appScope.splitBill.payerAmounttemp}}</div>',v.splitBillGrid=angular.copy(c),v.date=s("date")(v.selectBill[0].billDate.$,"dd/MM/yyyy HH:MM:ss");var f={};f.url=r.HISCOMBOFILLING.URL,f.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"SPLIT_PAYER_DROP_DOWN",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pRgSeqId",value:v.selectBill[0].regSeqId}]}]}]}]}},o.sendRestRequest(f).then(function(e){if(v.PayerList=[],null!=e.data.HITService.message.queryList)if(v.temp=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"],null!=v.temp.length)angular.forEach(v.temp,function(e,t){for(var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={},r=0;r<a.length;r++)i[""+a[r].name.split(".")[1]]=a[r].data;v.PayerList.push(i)});else{for(var t=v.temp.columnList[0]["com.napier.core.service.vo.query.Column"],a={},i=0;i<t.length;i++)a[""+t[i].name.split(".")[1]]=t[i].data;v.PayerList.push(a)}}),v.corporatePayer=function(e,t){null==t?(v.copayper1=angular.copy(Math.round((e.payerAmount?e.payerAmount:0)/100*e.coPay)),v.serviceAmt1=angular.copy(Math.round((e.payerAmount?e.payerAmount:0)-v.copayper1)),v.patientAmount=v.patientAmount+v.copayper1,v.payerAmounttemp=v.payerAmounttemp+v.serviceAmt1,v.payerAmounttemp1=v.payerAmounttemp):1==t&&(v.copayper1=angular.copy(Math.round((v.splitData[0][e.companyName]?v.splitData[0][e.companyName]:0)/100*e.coPay)),v.serviceAmt1=angular.copy(Math.round((v.splitData[0][e.companyName]?v.splitData[0][e.companyName]:0)-v.copayper1)),v.patientAmount=v.patientAmount+v.copayper1,v.payerAmounttemp=v.payerAmounttemp+v.serviceAmt1,v.payerAmounttemp1=v.payerAmounttemp),c.columnDefs[1].footerCellTemplate='<div class="ui-grid-cell-contents">{{grid.appScope.splitBill.payerAmounttemp}}</div>',v.PayerObj={name:e.companyName,displayName:e.companyName,cellEditableCondition:function(e){return!1},type:"number",cellTemplate:'<div class="ui-grid-cell-contents"><input type="number" min="0" ng-class="{\'gray\':row.entity.billed_services == \'\'}" style="width: 99px;padding-left: 39px;height: 29px;margin-left: -7px;margin-top:-4px;" ng-model="MODEL_COL_FIELD" ng-change="grid.appScope.splitBill.calculateAmount(row,MODEL_COL_FIELD,col,grid)" ng-init="col.colDef.displayName=0"/></div>',aggregationType:l.aggregationTypes.sum,footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.aggregationValue}}</div>'},v.splitBillGrid.columnDefs.splice(2,0,v.PayerObj);var a=e.companyName+"1";v.coPayObj={name:a,displayName:"billing.coPay",headerCellFilter:"translate",cellEditableCondition:function(e){return!1}},v.splitBillGrid.columnDefs.splice(3,0,v.coPayObj)},v.getBillSplitDtls=function(e){var t={};t.url=n.HISIPINDENT.URL,t.requestData={operation:"getBillSplitDtls",messageId:"",destination:"com.napier.core.billgeneration.service.external.BillGenerationService",message:{"@class":"com.napier.core.billgeneration.vo.Bill",billSeqId:v.selectBill[0].billSeqId,billNo:v.selectBill[0].billNo,serviceName:{"java.lang.String":["%"+(null==e?"":e)+"%"]}}},o.sendRestRequest(t).then(function(t){if(v.self=0,v.splitDtlsList=[],v.genericObj=[],v.splitDtlsMsg=t.data.HITService.message,null!=t.data.HITService.message){if(v.payerObjTemp=t.data.HITService.message.billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"],null==e)if(v.payerObjTemp instanceof Array)for(var a=0;a<v.payerObjTemp.length;a++)4!=v.payerObjTemp[a].payerType&&(D=!0,v.payerObjCol=v.payerObjTemp[a],v.corporatePayer(v.payerObjCol));else 4!=v.payerObjTemp.payerType&&(D=!0,v.payerObjCol=v.payerObjTemp,v.corporatePayer(v.payerObjCol));if(v.splitDtlsList.push({billed_services:"",total_bill:v.totalAmount,self:v.totalAmount,enablePayer:!1}),1==D&&(v.splitDtlsList[0][v.payerObjCol.companyName]=v.payerObjCol.payerAmount,v.splitDtlsList[0][v.payerObjCol.companyName+"1"]=v.payerObjCol.coPay),v.splitDtls=t.data.HITService.message.billPayerServiceDetailVo[0]["com.napier.core.billgeneration.vo.BillPayerServiceDetailVo"],v.splitDtls instanceof Array)for(a=0;a<v.splitDtls.length;a++)null!=v.splitDtls[a+1]?v.splitDtls[a].blServDtlSeqId!=v.splitDtls[a+1].blServDtlSeqId&&(v.genericObj[v.genericObj.length]={blServDtlSeqId:v.splitDtls[a].blServDtlSeqId,billed_services:v.splitDtls[a].serviceName,total_bill:v.splitDtls[a].chargebleAmount,self:v.splitDtls[a].compNonPayableAmt,enablePayer:!0,gnStatus:v.splitDtls[a].gnStatus},1==D&&(v.genericObj[v.genericObj.length-1][v.payerObjCol.companyName]=v.splitDtls[a].payerAmount)):(v.genericObj[v.genericObj.length]={blServDtlSeqId:v.splitDtls[v.splitDtls.length-1].blServDtlSeqId,billed_services:v.splitDtls[v.splitDtls.length-1].serviceName,total_bill:v.splitDtls[v.splitDtls.length-1].chargebleAmount,self:v.splitDtls[v.splitDtls.length-1].compNonPayableAmt,enablePayer:!0,gnStatus:v.splitDtls[a].gnStatus},1==D&&(v.genericObj[v.genericObj.length-1][v.payerObjCol.companyName]=v.splitDtls[v.splitDtls.length-1].payerAmount));else v.genericObj.push({blServDtlSeqId:v.splitDtls.blServDtlSeqId,billed_services:v.splitDtls.serviceName,total_bill:v.splitDtls.chargebleAmount,self:v.splitDtls.compNonPayableAmt,enablePayer:!0,gnStatus:v.splitDtls.gnStatus}),1==D&&(v.genericObj[v.payerObjCol.companyName]=v.splitDtls.payerAmount);for(var i=0;i<v.genericObj.length;i++)v.splitDtlsList.push(v.genericObj[i]),v.self=v.self+v.genericObj[i].self;v.splitBillGrid.data=v.splitDtlsList,1==D&&(v.splitBillGrid.data[0].self=v.splitBillGrid.data[0].self-v.payerObjCol.payerAmount)}})},v.getBillSplitDtls(),v.patientAmounttemp=v.self+v.patientAmount,v.splitBillGrid=angular.copy(c),v.splitBillGrid.onRegisterApi=function(e){v.splitBillGridGridApi=e},v.splitBillGrid.cellEditableCondition=function(e){return e.row.entity.enablePayer};v.changePayer=function(e){v.changePyers=e,v.patientAmount=0,v.payerAmounttemp=0,v.patientAmounttemp=v.patientAmount+v.self,v.splitBillGrid.data[0].self=v.splitBillGrid.data[0].total_bill,v.splitData=v.splitBillGrid.data,v.splitBillGrid=angular.copy(c),i.splitVal=[],1==D&&v.corporatePayer(v.payerObjCol,v.reCall);for(var t=0;t<e.length;t++){if(null==e[t].COPAY)return d.warning(v.alertObj.alertTypeWarn,v.alertObj.cpayNotDfinePln),v.splitBillGrid.data=v.splitData,!1;v.PayerObj={name:e[t].INC_PLAN_NAME,displayName:e[t].INC_PLAN_NAME,cellEditableCondition:function(e){return!1},type:"number",default:0,cellTemplate:'<div class="ui-grid-cell-contents"><input ng-class="{\'gray\':row.entity.billed_services == \'\'}" type="number" min="0" style="width: 99px;padding-left: 39px;height: 29px;margin-left: -7px;margin-top:-4px;" ng-model="MODEL_COL_FIELD" ng-change="grid.appScope.splitBill.calculateAmount(row,MODEL_COL_FIELD,col,grid)" ng-init="col.colDef.displayName=0"/></div>',aggregationType:l.aggregationTypes.sum,footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.aggregationValue}}</div>'},v.splitBillGrid.columnDefs.splice(2,0,v.PayerObj);var a=e[t].INC_PLAN_NAME+"1";v.coPayObj={name:a,displayName:"billing.coPay",headerCellFilter:"translate",cellEditableCondition:function(e){return!1},type:"number"},v.splitBillGrid.columnDefs.splice(3,0,v.coPayObj),v.splitBillGrid.data=v.splitData;for(var r=0;r<v.splitBillGrid.data.length;r++)v.splitBillGrid.data[r][e[t].INC_PLAN_NAME]=0;v.splitBillGrid.data[0][a]=e[t].COPAY}v.splitBillGrid.data=v.splitData,1==D&&(v.splitBillGrid.data[0].self=v.splitBillGrid.data[0].self-v.payerObjCol.payerAmount)},v.calculateAmount=function(e,t,a,r){i.index=v.splitBillGrid.data.indexOf(e.entity),v.self=0,v.copayper=0,v.serviceAmt=0;for(var n=1;n<v.splitBillGrid.data.length;n++){n==i.index&&(v.splitBillGrid.data[n][a.field]=t);for(var l=0,s=1;s<v.splitBillGrid.data.length;s++)l+=parseInt(null==v.splitBillGrid.data[s][a.field]?0:v.splitBillGrid.data[s][a.field]),v.splitBillGrid.data[0][a.field]=l;for(var o=0;o<v.changePyers.length;o++)v.copayper=angular.copy(Math.round((v.splitBillGrid.data[0][v.changePyers[o].INC_PLAN_NAME]?v.splitBillGrid.data[0][v.changePyers[o].INC_PLAN_NAME]:0)/100*v.splitBillGrid.data[0][v.changePyers[o].INC_PLAN_NAME+"1"])),v.serviceAmt=angular.copy(Math.round((v.splitBillGrid.data[0][v.changePyers[o].INC_PLAN_NAME]?v.splitBillGrid.data[0][v.changePyers[o].INC_PLAN_NAME]:0)-v.copayper)),a.field==v.changePyers[o].INC_PLAN_NAME&&(v.changePyers[o].LIMIT_AMOUNT=v.serviceAmt,v.changePyers[o].COPAYAMT=v.copayper,a.aggregationType=v.serviceAmt,a.aggregationValue=v.serviceAmt);if(1==D&&a.field==v.payerObjCol.companyName){n==i.index&&(v.splitBillGrid.data[n][v.payerObjCol.companyName]=t);for(l=0,s=1;s<v.splitBillGrid.data.length;s++)l+=parseInt(null==v.splitBillGrid.data[s][a.field]?0:v.splitBillGrid.data[s][a.field]),v.splitBillGrid.data[0][a.field]=l;v.copayper=angular.copy(Math.round((v.splitBillGrid.data[0][v.payerObjCol.companyName]?v.splitBillGrid.data[0][v.payerObjCol.companyName]:0)/100*v.splitBillGrid.data[0][v.payerObjCol.companyName+"1"])),v.serviceAmt=angular.copy(Math.round((v.splitBillGrid.data[0][v.payerObjCol.companyName]?v.splitBillGrid.data[0][v.payerObjCol.companyName]:0)-v.copayper)),v.companyNameAmt=v.serviceAmt;for(var p=0;p<r.columns.length;p++)a.field==r.columns[p].field&&"self"!=a.field&&(a.aggregationType=v.serviceAmt,a.aggregationValue=v.serviceAmt)}v.self=v.self+(null==v.splitBillGrid.data[n].self?0:v.splitBillGrid.data[n].self),v.splitBillGrid.data[0].self=v.splitBillGrid.data[0].self-(v.splitBillGrid.data[0][a.field]?v.splitBillGrid.data[0][a.field]:0)}if(v.patientAmount=0,v.payerAmounttemp=0,v.splitBillGrid.data[0].self=v.totalAmount,null!=v.changePyers)for(o=0;o<v.changePyers.length;o++)v.copayper=angular.copy(Math.round((v.splitBillGrid.data[0][v.changePyers[o].INC_PLAN_NAME]?v.splitBillGrid.data[0][v.changePyers[o].INC_PLAN_NAME]:0)/100*v.splitBillGrid.data[0][v.changePyers[o].INC_PLAN_NAME+"1"])),v.serviceAmt=angular.copy(Math.round((v.splitBillGrid.data[0][v.changePyers[o].INC_PLAN_NAME]?v.splitBillGrid.data[0][v.changePyers[o].INC_PLAN_NAME]:0)-v.copayper)),v.patientAmount=v.patientAmount+v.copayper,v.payerAmounttemp=v.payerAmounttemp+v.serviceAmt;1==D&&(v.reCall=!0,v.copayper=angular.copy(Math.round((v.splitBillGrid.data[0][v.payerObjCol.companyName]?v.splitBillGrid.data[0][v.payerObjCol.companyName]:0)/100*v.splitBillGrid.data[0][v.payerObjCol.companyName+"1"])),v.serviceAmt=angular.copy(Math.round((v.splitBillGrid.data[0][v.payerObjCol.companyName]?v.splitBillGrid.data[0][v.payerObjCol.companyName]:0)-v.copayper)),v.patientAmount=v.patientAmount+v.copayper,v.payerAmounttemp=v.payerAmounttemp+v.serviceAmt),v.splitBillGrid.data[0].self=v.splitBillGrid.data[0].self-v.payerAmounttemp,v.patientAmounttemp=v.patientAmount+v.self,c.columnDefs[1].footerCellTemplate='<div class="ui-grid-cell-contents" >{{grid.appScope.splitBill.payerAmounttemp}}</div>';for(o=1;o<v.splitBillGrid.data.length;o++){var u=0;for(n=0;n<v.changePyers.length;n++)u+=null==v.splitBillGrid.data[o][v.changePyers[n].INC_PLAN_NAME]?0:v.splitBillGrid.data[o][v.changePyers[n].INC_PLAN_NAME];if(1==D&&(u+=null==v.splitBillGrid.data[o][v.payerObjCol.companyName]?0:v.splitBillGrid.data[o][v.payerObjCol.companyName]),!(v.splitBillGrid.data[o].total_bill>=u+v.splitBillGrid.data[o].self))return d.warning(v.alertObj.alertTypeWarn,v.alertObj.totalSplitAmtEqlServAmt+' at "'+v.splitBillGrid.data[o].billed_services+'"'),v.save=!1,!1;v.save=!0}},v.billPayerDtList=function(){return v.BillPayerDetailsList=[],v.BillPayerDetailsListArr=[],v.BillPayerDetailsList={"com.napier.core.billgeneration.vo.BillPayerDetails":v.BillPayerDetails()},v.BillPayerDetailsList},v.BillPayerDetails=function(){if(null!=v.changePyers)for(var e=0;e<v.changePyers.length;e++)v.changePyers[e].PAYER_ACC_SEQ_ID==(e+1==v.changePyers.length?"":v.changePyers[e+1].PAYER_ACC_SEQ_ID)?(v.BillPayerDetailsListArr.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:v.changePyers[e].PAYER_ACC_SEQ_ID,payerAmount:v.changePyers[e].LIMIT_AMOUNT+v.changePyers[e+1].LIMIT_AMOUNT,payerType:v.changePyers[e].PAYER_TYPE,billSeqId:v.splitDtlsMsg.billSeqId}),e+=1):v.BillPayerDetailsListArr.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:v.changePyers[e].PAYER_ACC_SEQ_ID,payerAmount:v.changePyers[e].LIMIT_AMOUNT,payerType:v.changePyers[e].PAYER_TYPE,billSeqId:v.splitDtlsMsg.billSeqId});var t=v.splitDtlsMsg.billPayerDtList[0]["com.napier.core.billgeneration.vo.BillPayerDetails"];if(t instanceof Array)for(e=0;e<t.length;e++)4==t[e].payerType&&(v.BillPayerDetailsListArr.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:t[e].accPayerSeqId,payerAmount:v.patientAmounttemp,payerType:t[e].payerType,billPayerSeqId:t[e].billPayerSeqId,billSeqId:v.splitDtlsMsg.billSeqId}),v.selfAcc=t[e].accPayerSeqId);else v.BillPayerDetailsListArr.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:t.accPayerSeqId,payerAmount:v.patientAmounttemp,payerType:t.payerType,billPayerSeqId:t.billPayerSeqId,billSeqId:v.splitDtlsMsg.billSeqId}),v.selfAcc=t.accPayerSeqId;if(1==D){var a=!1;for(e=0;e<v.BillPayerDetailsListArr.length;e++)v.BillPayerDetailsListArr[e].accPayerSeqId==v.payerObjCol.accPayerSeqId&&(a=!0,v.BillPayerDetailsListArr[e].payerAmount=v.BillPayerDetailsListArr[e].payerAmount+v.companyNameAmt);1!=a&&v.BillPayerDetailsListArr.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:v.payerObjCol.accPayerSeqId,payerAmount:v.companyNameAmt,payerType:v.payerObjCol.payerType,billPayerSeqId:v.payerObjCol.billPayerSeqId,billSeqId:v.splitDtlsMsg.billSeqId})}return v.BillPayerDetailsListArr},v.billPayerServiceDetail=function(){return v.BillPayerServiceDetailList=[],v.BillPayerServiceDetailArr=[],v.BillPayerServiceDetailList[0]={"com.napier.core.billgeneration.vo.BillPayerServiceDetailVo":v.PayerServiceDetail()},v.BillPayerServiceDetailList},v.PayerServiceDetail=function(){v.BillPayerServiceDetailArr1=[];for(var e=1;e<v.splitBillGrid.data.length;e++){for(var t=0;t<v.changePyers.length;t++)v.BillPayerServiceDetailArr[t]={"@class":"com.napier.core.billgeneration.vo.BillPayerServiceDetailVo",blServDtlSeqId:v.splitBillGrid.data[e].blServDtlSeqId,accPayerSeqId:v.changePyers[t].PAYER_ACC_SEQ_ID,payerType:v.changePyers[t].PAYER_TYPE,payerAmount:v.splitBillGrid.data[e][v.changePyers[t].INC_PLAN_NAME]?v.splitBillGrid.data[e][v.changePyers[t].INC_PLAN_NAME]:0,facilityId:"1",gnStatus:v.splitBillGrid.data[e].gnStatus},v.BillPayerServiceDetailArr1.push(v.BillPayerServiceDetailArr[t]);v.BillPayerServiceDetailArr[v.changePyers.length]={"@class":"com.napier.core.billgeneration.vo.BillPayerServiceDetailVo",blServDtlSeqId:v.splitBillGrid.data[e].blServDtlSeqId,accPayerSeqId:v.selfAcc,payerType:4,payerAmount:v.splitBillGrid.data[e].self?v.splitBillGrid.data[e].self:0,facilityId:"1",gnStatus:v.splitBillGrid.data[e].gnStatus},v.BillPayerServiceDetailArr1.push(v.BillPayerServiceDetailArr[v.changePyers.length]),1==D&&(v.BillPayerServiceDetailArr[v.changePyers.length]={"@class":"com.napier.core.billgeneration.vo.BillPayerServiceDetailVo",blServDtlSeqId:v.splitBillGrid.data[e].blServDtlSeqId,accPayerSeqId:v.payerObjCol.accPayerSeqId,payerType:v.payerObjCol.payerType,payerAmount:v.splitBillGrid.data[e][v.payerObjCol.companyName]?v.splitBillGrid.data[e][v.payerObjCol.companyName]:0,facilityId:"1",gnStatus:v.splitBillGrid.data[e].gnStatus},v.BillPayerServiceDetailArr1.push(v.BillPayerServiceDetailArr[v.changePyers.length]))}return v.BillPayerServiceDetailArr1},v.savefn=function(){if(null==v.splitBillGrid.data||0==v.splitBillGrid.data.length)return v.save,d.warning(v.alertObj.alertTypeWarn,v.alertObj.plzSpltBil),!1;for(var e=1;e<v.splitBillGrid.data.length;e++){for(var t=0,a=0;a<v.changePyers.length;a++)t+=null==v.splitBillGrid.data[e][v.changePyers[a].INC_PLAN_NAME]?0:v.splitBillGrid.data[e][v.changePyers[a].INC_PLAN_NAME];if(1==D&&(t+=null==v.splitBillGrid.data[e][v.payerObjCol.companyName]?0:v.splitBillGrid.data[e][v.payerObjCol.companyName]),v.splitBillGrid.data[e].total_bill!=t+v.splitBillGrid.data[e].self)return d.warning(v.alertObj.alertTypeWarn,v.alertObj.totalSplitAmtEqlServAmt+' at "'+v.splitBillGrid.data[e].billed_services+'"'),v.save=!1,!1;v.save=!0}for(a=0;a<v.changePyers.length;a++)if(null==v.splitBillGrid.data[0][v.changePyers[a].INC_PLAN_NAME]||0==v.splitBillGrid.data[0][v.changePyers[a].INC_PLAN_NAME])return d.warning(v.alertObj.alertTypeWarn,v.alertObj.splitBilSlctPln),v.save=!1,!1;if(v.totalAmount!=v.payerAmounttemp+v.patientAmounttemp)return d.warning(v.alertObj.alertTypeWarn,v.alertObj.totalBilEqlToPyrAmtPatAmt),v.save=!1,!1;if(v.save=!0,1==v.save){var i={};i.url=n.HISIPINDENT.URL,i.requestData={operation:"saveBillSplit",messageId:"",destination:"com.napier.core.billgeneration.service.external.BillGenerationService",message:{"@class":"com.napier.core.billgeneration.vo.Bill",billSeqId:v.splitDtlsMsg.billSeqId,billType:v.splitDtlsMsg.billType,subAccSeqId:v.splitDtlsMsg.subAccSeqId,billPayerDtList:v.billPayerDtList(),billPayerServiceDetailVo:v.billPayerServiceDetail(),isSeniorCitizen:!1,isPrimaryBill:v.splitDtlsMsg.isPrimaryBill,isBillClearedCheck:v.splitDtlsMsg.isBillClearedCheck,reviceBillPreAuthzFlag:v.splitDtlsMsg.reviceBillPreAuthzFlag,serviceLevlConsession:v.splitDtlsMsg.serviceLevlConsession,isEdit:v.selectBill[0].isEdit,isCompanySponsor:v.selectBill[0].isCompanySponsor,isDaPosted:v.selectBill[0].isDaPosted}},o.sendRestRequest(i).then(function(e){""!=e.data.HITService.message&&null!=e.data.HITService.message&&""!=e.data.HITService?(d.success(v.alertObj.alertTypeSucss,v.alertObj.rcdSvdScsfly),v.save=!1,u.go("index.billingSub.angularbillappwrklist")):d.warning(v.alertObj.alertTypeWarn,v.alertObj.faldToSve)})}}}e.$inject=["PatientBannerGlobal","hisTranslationsService","PatientBannerBilling","$scope","BILLING_APIS","IPINDENTAPIS","uiGridConstants","$filter","CallManager","splitBillGridDefinition","hisAlertService","$stateParams","$state","hisGenericAlertService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("splitBillController",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("claimsGridDef",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"PAT_NAME",displayName:"billing.patientName",enableSorting:!0,headerCellFilter:"translate"},{name:"RG_INT_MR_NO",displayName:"billing.patientId",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate"},{name:"BILL_NO",displayName:"billing.billNo",enableSorting:!0,headerCellFilter:"translate"},{name:"BILL_DATE",displayName:"billing.billDateAndTime",enableSorting:!0,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.BILL_DATE || "- -" |date:grid.appScope.cr.format + "&nbsp&nbsp" + "HH:mm:ss"}}</div>'},{name:"BILL_AMT",displayName:"Bill Amount",enableSorting:!0,headerCellFilter:"translate",cellFilter:"number: 2"},{name:"CORPORATE_DUE_AMT",displayName:"billing.corporateDueAmount",enableSorting:!0,headerCellFilter:"translate",cellFilter:"number: 2"},{name:"DENIED_AMT",displayName:"billing.dniedAmt",enableSorting:!0,headerCellFilter:"translate",cellFilter:"number: 2"}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("transactionSummGridDef",{showColumnFooter:!0,enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableGridMenu:!0,enablePaginationControls:!1,paginationPageSize:1e3,useExternalSorting:!1,enableColumnMenus:!1,enableHorizontalScrollbar:1,rowHeight:30,columnDefs:[{name:"DATE_TIME",displayName:"Date & Time",enableSorting:!0,enableCellEdit:!1,footerCellTemplate:'<div class="ui-grid-cell-contents"  row.entity.merge=true>{{grid.appScope.csc.total}}</div>',width:"90",pinnedLeft:!0},{name:"referenceNo",displayName:"Reference No",enableSorting:!0,enableCellEdit:!1,width:"100",pinnedLeft:!0},{name:"billNo",displayName:"Bill No",enableSorting:!0,enableCellEdit:!1,width:"100",pinnedLeft:!0},{name:"rgIntMrNo",displayName:"UHID",enableSorting:!0,enableCellEdit:!1,width:"100",pinnedLeft:!0},{name:"PatientName",displayName:"Patient Name",enableSorting:!0,enableCellEdit:!1,width:"100",pinnedLeft:!0},{name:"billAmount",displayName:"Bill Amount",enableSorting:!0,enableCellEdit:!1,footerCellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.csc.totalBillAmt | number}}</div>',width:"100",pinnedLeft:!0},{name:"paymentMode",displayName:"Mode of Payment",enableSorting:!0,enableCellEdit:!1,width:"130"},{name:"recievedAmount",displayName:"Received Amount",enableSorting:!0,enableCellEdit:!1,footerCellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.csc.totalReciveAmount | number}}</div>',width:"130"},{name:"paymentModeAmount",displayName:"Amount",enableSorting:!0,enableCellEdit:!1,visible:!1,width:"100"},{name:"depositAmt",displayName:"Deposit Amount",enableSorting:!0,enableCellEdit:!1,footerCellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.csc.totalDepositAmt | number}}</div>',width:"130"},{name:"discountAmount",displayName:"Discount Amount",enableSorting:!0,enableCellEdit:!1,footerCellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.csc.totalDiscountAmt | number}}</div>',width:"130"},{name:"depositAdjusted",displayName:"Deposit Adjusted",enableSorting:!0,enableCellEdit:!1,footerCellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.csc.totalDepositAdjusted | number}}</div>',width:"130"},{name:"depositRefund",displayName:"Deposit Refund",enableSorting:!0,enableCellEdit:!1,footerCellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.csc.totaldepositRefund}}</div>',width:"130"},{name:"refundAmt",displayName:"Refund Amount",enableSorting:!0,enableCellEdit:!1,footerCellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.csc.totalRefund}}</div>',width:"130"},{name:"balance",displayName:"Balance",enableSorting:!0,enableCellEdit:!1,footerCellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.csc.totalBalance |number}}</div>',width:"100"}]}).constant("colSummaryGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enablePaginationControls:!1,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableGridMenu:!0,paginationPageSizes:[10,25,50,100],paginationPageSize:10,useExternalSorting:!1,enableColumnMenus:!1,columnDefs:[{name:"paymentMode",displayName:"",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"cash",displayName:"Cash",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"creaditDebitCard",displayName:"Credit/Debit Card",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"cheque",displayName:"Cheque/DD",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"eWallet",displayName:"E-Wallet",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"netBanking",displayName:"Net Banking/Ecs",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"total",displayName:"Total",enableSorting:!0,enableCellEdit:!1,width:"*"}]})}(),function(){"use strict";function e(e,t,a){function i(e){return e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]}this.getTransactionSummary=function(){var i=JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID,r=e.defer(),n={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"COUNTER_MGMT_PAYMENT_SUMMERY",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"@pUsrSqId",value:i}]}]}]}]},l={};return l.url=t.HISGETTRANSACTIONSUMMARY.URL,l.requestData={operation:"ExecuteQuery",destination:"QueryService",message:n},a.sendRestRequest(l).then(function(e){var t=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"],a=[];if(null==t)return r.reject("No Transactions availble");var i={};if(Array.isArray(t))angular.forEach(t,function(e,t){var r=e.columnList[0]["com.napier.core.service.vo.query.Column"];angular.forEach(r,function(e,t){var a=e.name;1==a.includes(".",0)&&(i[e.name.substring(a.indexOf(".")+1)]=e.data)}),a.push(i),i={}});else{var n=t.columnList[0]["com.napier.core.service.vo.query.Column"];angular.forEach(n,function(e,t){var a=e.name;1==a.includes(".",0)&&(i[e.name.substring(a.indexOf(".")+1)]=e.data)}),a.push(i),i={}}var l=[],s=0,o=0,c=0,d=0,p=0,u=0,m=0,g=0;angular.forEach(a,function(e,t){if(null!=e.BILL_NO&&""!=e.BILL_NO)var a=(e.DEPOSIT_AMOUNT,i=e.RECIEVED_AMOUNT,e.Deposit_REFUND,r=e.REFUND_AMOUNT,n=e.BILL_AMOUNT,S=e.DISCOUNT_AMOUNT,v=e.DEPOSIT_ADJUSTED,(n=null!=n?n:0)-((S=null!=S?S:0)+(v=null!=v?v:0)+(i=null!=i?i:0)+(r=null!=r?r:0)));else a="";var i,r,n,S,v,D={billAmount:e.BILL_AMOUNT,billNo:e.BILL_NO,date_time:moment(e.DATE_TIME).format("DD/MM/YYYY HH:MM"),DATE_TIME:moment(e.DATE_TIME).format("DD/MM/YYYY"),discountAmount:e.DISCOUNT_AMOUNT,paymentMode:e.PAYMENT_MODE,PatientName:e.Patient_Name,recievedAmount:e.RECIEVED_AMOUNT?e.RECIEVED_AMOUNT:0,referenceNo:e.REFERENCE_NO,rgIntMrNo:e.RG_INT_MR_NO,depositAmt:e.DEPOSIT_AMOUNT,depositAdjusted:e.DEPOSIT_ADJUSTED,depositRefund:e.Deposit_REFUND,refundAmt:e.REFUND_AMOUNT,transactionSeqId:e.RECP_HD_SEQ_ID,balance:e.BALANCE_AMT};null!=e.DEPOSIT_AMOUNT&&e.DEPOSIT_AMOUNT>=0&&(s=parseFloat(s)+parseFloat(e.DEPOSIT_AMOUNT)),null!=e.BILL_AMOUNT&&e.BILL_AMOUNT>=0&&(o=parseFloat(o)+parseFloat(e.BILL_AMOUNT)),null!=e.DISCOUNT_AMOUNT&&e.DISCOUNT_AMOUNT>=0&&(c=parseFloat(c)+parseFloat(e.DISCOUNT_AMOUNT)),null!=e.DEPOSIT_ADJUSTED&&e.DEPOSIT_ADJUSTED>=0&&(d=parseFloat(d)+parseFloat(e.DEPOSIT_ADJUSTED)),null!=e.RECIEVED_AMOUNT&&e.RECIEVED_AMOUNT>=0&&(p=parseFloat(p)+parseFloat(e.RECIEVED_AMOUNT)),null!=e.Deposit_REFUND&&e.Deposit_REFUND>=0&&(u=parseFloat(u)+parseFloat(e.Deposit_REFUND)),null!=e.REFUND_AMOUNT&&e.REFUND_AMOUNT>=0&&(m=parseFloat(m)+parseFloat(e.REFUND_AMOUNT)),null!=a&&""!=a&&a>=0&&(g=parseFloat(g)+parseFloat(a)),l.push(D)});var S={total:"Total",totalDepositAmt:s,totalBillAmt:void 0,totalDiscountAmt:c,totalDepositAdjusted:d,totalReciveAmount:p,totaldepositRefund:u,totalRefund:m,totalBalance:void 0};l.push(S),r.resolve(l)}),r.promise},this.getCashHandOverCombo=function(){var r=e.defer(),n={};return n.url=t.HISCOLLSUMCASHHANDOVERCOMBO.URL,n.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"TRN003",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:"700107"},{ident:"2",value:"700107"}]}]}]}]}},a.sendRestRequest(n).then(function(e){var t=i(e),a=[];if(Array.isArray(t))angular.forEach(t,function(e,t){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={CODE:i[0].data,DESCRIPTION:i[1].data};a.push(r)});else if(null!=t.columnList){var n=t.columnList[0]["com.napier.core.service.vo.query.Column"],l={CODE:n[0].data,DESCRIPTION:n[1].data};a.push(l)}r.resolve(a)}),r.promise},this.cashierDropdown=function(){var r=JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID,n=(JSON.parse(sessionStorage.cashier),e.defer()),l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"CASH_DROPDOWN_001",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pFacility",value:1},{paramName:"pUsrSeqId",value:r}]}]}]}]},s={};return s.url=t.HISCOLLSUMCASHIERCOMBO.URL,s.requestData={operation:"ExecuteQuery",destination:"QueryService",message:l},a.sendRestRequest(s).then(function(e){var t=i(e),a=[];if(Array.isArray(t))angular.forEach(t,function(e,t){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={name:i[1].data,data:i[2].data,seqid:i[3].data};a.push(r)});else if(null!=t.columnList){var r=t.columnList[0]["com.napier.core.service.vo.query.Column"],l={name:r[1].data,data:r[2].data,seqid:r[3].data};a.push(l)}n.resolve(a)}),n.promise},this.getTransactionSummaryList=function(i,r){var n=e.defer(),l=(i=JSON.parse(sessionStorage.userContextObj).USER_SEQ_ID,JSON.parse(sessionStorage.cashier)),s={"@class":"string",$:i},o={};return o.url=t.HISGETTRANSACTIONSUMMARYLIST.URL,o.requestData={operation:"getTransactionSummayList",messageId:"",destination:"com.napier.core.collections.service.external.CounterService",message:s},a.sendRestRequest(o).then(function(e){var t=e.data.HITService.message[0]["com.napier.core.collections.vo.CollectionSummaryVo"],a=Array.isArray(t),i=[],s={paymentMode:"floatAmount",cash:l.floatamt};if(a)angular.forEach(t,function(e,t){var a=null!=e.total?e.total:0,r={paymentMode:null!=e.paymentMode?e.paymentMode:"",cash:null!=e.cash?e.cash:0,creaditDebitCard:null!=e.creaditDebitCard?e.creaditDebitCard:0,eWallet:null!=e.eWallet?e.eWallet:0,netBanking:null!=e.netBanking?e.netBanking:0,cheque:null!=e.cheque?e.cheque:0,total:a};i.push(r)});else{var o=null!=t.total?t.total:0,c={paymentMode:null!=t.paymentMode?t.paymentMode:"",cash:null!=t.cash?t.cash:0,creaditDebitCard:null!=t.creaditDebitCard?t.creaditDebitCard:0,eWallet:null!=t.eWallet?t.eWallet:0,netBanking:null!=t.netBanking?t.netBanking:0,cheque:null!=t.cheque?t.cheque:0,total:o};i.push(c)}var d=i.length;i.splice(d-1,0,s),"Finance Department"==r&&null!=l.floatamt&&l.floatamt>=0&&(null==i[d].cash&&(i[d].cash=0),i[d].cash=parseFloat(i[d].cash)+parseFloat(l.floatamt)),null==l.floatamt&&""==l.floatamt||(null==i[4].cash&&(i[4].cash=0),null==i[5].cash&&(i[5].cash=0),i[5].cash=parseFloat(i[4].cash)+parseFloat(i[5].cash)),n.resolve(i)}),n.promise},this.saveSummaryList=function(i,r){for(var n=moment(new Date).format("YYYY-MM-DDTHH:mm:ss")+".000Z",l=e.defer(),s=i.length,o=[],c=0;c<i.length;c++){var d={amtReceivedMod:null!=i[c].paymentMode?i[c].paymentMode:"",cashCol:null!=i[c].cash?i[c].cash:0,creditOrDebitCardCol:null!=i[c].creaditDebitCard?i[c].creaditDebitCard:0,eWalletCol:null!=i[c].eWallet?i[c].eWallet:0,netBankingCol:null!=i[c].netBanking?i[c].netBanking:0,total:null!=i[c].total?i[c].total:0,gnStatus:1};o.push(d),d={}}if("Cashier"==r.amount.cashHanded.DESCRIPTION)var p={"@class":"com.napier.core.collections.vo.SummaryListVO",dateAndTime:n,cashCol:null!=i[s-1].cash?i[s-1].cash:0,creditOrDebitCardCol:null!=i[s-1].creaditDebitCard?i[s-1].creaditDebitCard:0,netBankingCol:null!=i[s-1].netBanking?i[s-1].netBanking:0,eWalletCol:null!=i[s-1].eWallet?i[s-1].eWallet:0,colStatus:"submitted",gnStatus:1,totalFloatAmt:null!=r.amount.floatAmountHanded?r.amount.floatAmountHanded:0,amtHandOverTo:null!=r.amount.cashHanded.DESCRIPTION?r.amount.cashHanded.DESCRIPTION:"",netCashColl:null!=r.amount.netcash?r.amount.netcash:0,cashierHandedOverTo:null!=r.amount.cashier.seqid?r.amount.cashier.seqid:0,submittedBy:null!=r.userSeqId?r.userSeqId:0,receivedBy:null!=r.amount.cashier.seqid?r.amount.cashier.seqid:"",remarks:null!=r.amount.remarks?r.amount.remarks:"",tranSeqList:[{"com.napier.core.collections.vo.AllTransactionsSeqList":r.transarry}],summaryListDtVo:[{"com.napier.core.collections.vo.SummaryListDtVo":o}]};else p={"@class":"com.napier.core.collections.vo.SummaryListVO",dateAndTime:n,cashCol:null!=i[s-1].cash?i[s-1].cash:0,creditOrDebitCardCol:null!=i[s-1].creaditDebitCard?i[s-1].creaditDebitCard:0,netBankingCol:null!=i[s-1].netBanking?i[s-1].netBanking:0,eWalletCol:null!=i[s-1].eWallet?i[s-1].eWallet:0,colStatus:"submitted",gnStatus:1,totalFloatAmt:null!=r.amount.floatAmountHanded?r.amount.floatAmountHanded:0,amtHandOverTo:null!=r.amount.cashHanded.DESCRIPTION?r.amount.cashHanded.DESCRIPTION:"",netCashColl:null!=r.amount.netcash?r.amount.netcash:0,submittedBy:null!=r.userSeqId?r.userSeqId:0,remarks:null!=r.amount.remarks?r.amount.remarks:"",tranSeqList:[{"com.napier.core.collections.vo.AllTransactionsSeqList":r.transarry}],summaryListDtVo:[{"com.napier.core.collections.vo.SummaryListDtVo":o}]};var u={};return u.url=t.HISGETTRANSACTIONSUMMARYLIST.URL,u.requestData={operation:"saveOrUpdateSummaryList",messageId:"",destination:"com.napier.core.collections.service.external.CounterService",message:p},a.sendRestRequest(u).then(function(e){var t=[],a=e.data.HITService.message;if(!a)return l.reject("Not Saved");t.push(a),l.resolve(t)}),l.promise},this.floatAmount=function(r){var n=e.defer(),l={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"COUNTER_MGMT_FLOAT_AMT00",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pUserSeqId",value:r}]}]}]}]},s={};return s.url=t.HISGETTRANSACTIONSUMMARYLIST.URL,s.requestData={operation:"ExecuteQuery",destination:"QueryService",message:l},a.sendRestRequest(s).then(function(e){var t=[],a=i(e);if(null==a)return n.reject("No Data");if(Array.isArray(a))angular.forEach(a,function(e,a){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={name:i.name,data:i.data};t.push(r)});else if(null!=a.columnList){var r=a.columnList[0]["com.napier.core.service.vo.query.Column"],l={name:r.name,data:r.data};t.push(l)}n.resolve(t)}),n.promise}}e.$inject=["$q","BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("angCollectionSummaryService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("cmpnyStlGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1}).constant("coveringModalGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,columnDefs:[{name:"Bill Name",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:100},{name:"Bill Date",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:150},{name:"MR No",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:150},{name:"IP No",enableSorting:!0,enableCellEdit:!0,width:150},{name:"Patient Name",enableSorting:!0,enableCellEdit:!0,width:150},{name:"Corporate Due",enableSorting:!0,enableCellEdit:!0,width:150},{name:"Settled Amount",enableSorting:!0,enableCellEdit:!0,width:150},{name:"Balance Due",enableSorting:!0,enableCellEdit:!0,width:150}]})}(),function(){"use strict";function e(e,t,a){this.saveCmpnyStlService=function(i){for(var r=[],n=0;n<i.stlmntGridOptions.data.length;n++){parseFloat(i.stlmntGridOptions.data[n].onAccDep)+parseFloat(i.stlmntGridOptions.data[n].depAdjAmt)>0?parseFloat(i.stlmntGridOptions.data[n].onAccDep)+parseFloat(i.stlmntGridOptions.data[n].depAdjAmt):parseFloat(i.stlmntGridOptions.data[n].passedAmt);var l=[],s=[];if(null!=i.stlmntGridOptions.data[n].adjAccObj)for(var o=0;o<i.stlmntGridOptions.data[n].adjAccObj.length;o++)l.push({onaccdepSeqId:i.stlmntGridOptions.data[n].adjAccObj[o].ONACC_DEPOSIT_SQ_ID,adjustmentAmt:parseFloat(i.stlmntGridOptions.data[n].adjAccObj[o].adjAmt)});var c=0;if(null!=i.stlmntGridOptions.data[n].adjObj)for(o=0;o<i.stlmntGridOptions.data[n].adjObj.length;o++)s.push({adjustmentAmt:parseFloat(i.stlmntGridOptions.data[n].adjObj[o].adjAmt),depSeqId:i.stlmntGridOptions.data[n].adjObj[o].DEPOSIT_SEQ_ID,billSeqId:i.stlmntGridOptions.data[n].adjObj[o].BILL_SEQ_ID}),c+=parseInt(i.stlmntGridOptions.data[n].adjObj[o].adjAmt);var d=0;d=null==i.stlmntGridOptions.data[n].discAmt?0:parseFloat(i.stlmntGridOptions.data[n].discAmt),r.push({tpaDiscountAmount:d,invoiceDtSeqId:i.stlmntGridOptions.data[n].INVC_DT_SEQ_ID,setlAmount:0,passedAmount:parseFloat(i.stlmntGridOptions.data[n].passedAmt),taxAmount:parseFloat(i.stlmntGridOptions.data[n].tds),disallowedAmount:0,depositAdjustedAmount:c,gnTranStatus:1,adjustedAmount:i.stlmntGridOptions.data[n].onAccDep,deniedAmount:i.stlmntGridOptions.data[n].deniedAmt,denialReason:i.stlmntGridOptions.data[n].denialReason,accountDepositAdjustmentVoList:[{"com.napier.core.onaccountdeposit.vo.AccountDepositAdjustmentVo":l}],patientDepositAdjustmentVoList:[{"com.napier.core.invoicesettlement.vo.PatientDepositAdjustmentVo":s}]})}var p={};return p.url=a.HISIPINDENT.URL,p.requestData={operation:"saveInvoiceSettlement",messageId:"",destination:"com.napier.core.invoicesettlement.service.external.InvoiceService",message:{"@class":"com.napier.core.invoicesettlement.vo.InvoiceSettlementHeader",gnTranStatus:1,netAmount:i.netAmtTotal,remarks:i.remarks,invoiceSetlOn:t("date")(new Date,"yyyy-MM-dd hh:mm:ss.s"),invoiceSetlDtList:[{"com.napier.core.invoicesettlement.vo.InvoiceSettlementDetail":r}]}},e.sendRestRequest(p)},this.getGridColumnDefs=function(e){e.columnDefs=[{displayName:"billing.invoiceNo",headerCellFilter:"translate",name:"INVOICE_NO",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:100},{displayName:"billing.billNo",headerCellFilter:"translate",name:"BILL_NO",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:150},{displayName:"billing.visitType",headerCellFilter:"translate",name:"DESCRIPTION",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:150},{displayName:"billing.billDate",headerCellFilter:"translate",name:"BILL_DATE",enableSorting:!0,enableCellEdit:!0,width:150,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.BILL_DATE| date:"dd/MM/yyyy hh:mm a"}}</div>'},{displayName:"billing.mrNo",headerCellFilter:"translate",name:"MR_NO",enableSorting:!0,enableCellEdit:!0,width:150},{displayName:"billing.totalAmount",headerCellFilter:"translate",name:"BILL_AMT",enableSorting:!0,enableCellEdit:!0,width:150},{displayName:"billing.stltdAmt",headerCellFilter:"translate",name:"BL_SETTLED_AMT",enableSorting:!0,enableCellEdit:!0,width:150},{displayName:"billing.corprteOutStnding",headerCellFilter:"translate",name:"OUTSTANDING_AMT",enableSorting:!0,enableCellEdit:!0,width:170},{displayName:"billing.billStatus",headerCellFilter:"translate",name:"BILL_PAY_STATUS",enableSorting:!0,enableCellEdit:!0,width:100},{displayName:"Payer Query Status",headerCellFilter:"translate",name:"PAYER_QUERY_STATUS",enableSorting:!0,enableCellEdit:!0,width:150,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.PAYER_QUERY_STATUS!=undefined&&row.entity.PAYER_QUERY_STATUS==0?"Pending":row.entity.PAYER_QUERY_STATUS!=undefined&&row.entity.PAYER_QUERY_STATUS>0?"Completed":"--"}}</div>'}]}}e.$inject=["CallManager","$filter","BILLING_APIS"],angular.module("napierContainerUi").service("cmpnyService",e)}(),function(){"use strict";function e(e,t){this.getTPADiscounts=function(a){var i={};return i.url=t.HISIPINDENT.URL,i.requestData={operation:"getTPADiscounts",messageId:"",destination:"com.napier.core.invoicesettlement.service.external.InvoiceService",message:{"@class":"com.napier.core.invoicesettlement.vo.TPADetailsVo",corporateSeqId:a.COMPANY_SEQ_ID,invoiceDate:a.BILL_DATE,corporateAmount:a.PAYER_AMOUNT}},e.sendRestRequest(i)},this.getGridColumnDefs=function(e){e.enableRowHeaderSelection=!0,e.rowTemplate='<div ng-class="{ \'my-css-class\': grid.appScope.rowFormatter( row ) }">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ng-click="grid.appScope.inStl.EnableDeposit(col,colRenderIndex,row,rowRenderIndex)"  ui-grid-cell></div></div>',e.columnDefs=[{displayName:"billing.billNo",headerCellFilter:"translate",name:"BILL_NO",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0,width:130},{displayName:"billing.billDate",headerCellFilter:"translate",name:"BILL_DATE",enableSorting:!0,enableCellEdit:!1,width:150,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.BILL_DATE| date:"dd/MM/yyyy hh:mm a"}}</div>'},{displayName:"billing.billAmt",headerCellFilter:"translate",name:"BILL_AMT",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0,width:150},{displayName:"billing.visitNo",headerCellFilter:"translate",name:"IP_NO",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0,width:150},{displayName:"billing.mrNo",headerCellFilter:"translate",name:"RG_INT_MR_NO",enableSorting:!0,enableCellEdit:!1,width:150},{displayName:"billing.patientName",headerCellFilter:"translate",name:"payerName",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0,width:150},{displayName:"billing.corprteAMt",headerCellFilter:"translate",name:"PAYER_AMOUNT",enableSorting:!0,enableCellEdit:!1,width:150},{displayName:"billing.stltdAmt",headerCellFilter:"translate",name:"SETTLED_AMT",enableSorting:!0,enableCellEdit:!1,width:150},{displayName:"billing.corprteOutStnding",headerCellFilter:"translate",name:"OUTSTANDING_AMT",enableSorting:!0,enableCellEdit:!1,width:170},{displayName:"billing.pssdAmt",headerCellFilter:"translate",name:"passedAmt",enableSorting:!1,enableCellEdit:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" number-with-decimal ng-model="row.entity.passedAmt" ng-change="grid.appScope.inStl.passedAmtCal(row,rowRenderIndex)" ng-disabled="row.entity.disabledPasdAmt" ng-blur="grid.appScope.inStl.setTotalValue(row,rowRenderIndex)"></div>'},{displayName:"billing.dniedAmt",headerCellFilter:"translate",name:"deniedAmt",enableSorting:!1,enableCellEdit:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.deniedAmt|number:2}}</div>'},{displayName:"billing.dnialReason",headerCellFilter:"translate",name:"denialReason",enableSorting:!1,enableCellEdit:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents"><i style="color:#3596FF;" class="fa fa-pencil-square-o" ng-click="grid.appScope.inStl.addDenialReason(row.entity,rowRenderIndex)"></i></div>'},{displayName:"billing.discAmt",headerCellFilter:"translate",name:"discAmt",enableSorting:!1,enableCellEdit:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" ng-model="row.entity.discAmt" number-with-decimal ng-disabled="!row.entity.disableField" ng-change="grid.appScope.inStl.changeDisAmt(row,rowRenderIndex)"></div>'},{displayName:"billing.tds",headerCellFilter:"translate",name:"tds",enableSorting:!1,enableCellEdit:!1,width:80,cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" ng-model="row.entity.tds" number-with-decimal ng-change="grid.appScope.inStl.passedAmtCal(row,rowRenderIndex)" ng-blur="grid.appScope.inStl.setTotalValue(row,rowRenderIndex)"></div>'},{displayName:"billing.net.amount",headerCellFilter:"translate",name:"netAmt",enableSorting:!0,enableCellEdit:!1,width:120,type:"number"},{displayName:"billing.depositAdjAmt",headerCellFilter:"translate",name:"depAdjAmt",enableSorting:!0,enableCellEdit:!1,width:200,type:"number"},{displayName:"billing.onAccDepsitAmt",headerCellFilter:"translate",name:"onAccDep",enableSorting:!0,enableCellEdit:!1,width:180,type:"number"},{name:"disableField",visible:!1}]},this.getAccDepColumnDefs=function(e){e.columnDefs=[{displayName:"billing.drvDate",headerCellFilter:"translate",name:"RECP_DATE",enableSorting:!0,enableCellEdit:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.RECP_DATE| date:"dd/MM/yyyy HH:MM a"}}</div>'},{displayName:"billing.scrollNumber",headerCellFilter:"translate",name:"RECP_NO",enableSorting:!0,enableCellEdit:!1,width:150},{displayName:"billing.onAccDepsitNo",headerCellFilter:"translate",name:"ONACC_DEPOSIT_NO",enableSorting:!0,enableCellEdit:!1,width:150},{displayName:"billing.availDeposit",headerCellFilter:"translate",name:"BLANCE_AMT",enableSorting:!0,enableCellEdit:!1,width:150},{displayName:"billing.preAdjTotal",headerCellFilter:"translate",name:"preAdjTotal",enableSorting:!0,enableCellEdit:!1,width:150},{displayName:"billing.remainingBal",headerCellFilter:"translate",name:"remBal",enableSorting:!0,enableCellEdit:!1,width:150},{name:"temBal",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:150,visible:!1},{displayName:"billing.adjAmt",headerCellFilter:"translate",name:"adjAmt",enableSorting:!0,enableCellEdit:!1,width:150,cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" numbers-only ng-model="row.entity.adjAmt" ng-change="grid.appScope.accDep.changeAccAdj(row,rowRenderIndex)" ng-blur="grid.appScope.accDep.changedDep(row.entity,rowRenderIndex)"></div>'}]},this.getDepositColumnDef=function(e){e.columnDefs=[{displayName:"billing.depositNumber",headerCellFilter:"translate",name:"DEPOSIT_NO",enableSorting:!0,enableCellEdit:!1},{displayName:"billing.depositAmt",headerCellFilter:"translate",name:"DEPOSIT_AMOUNT",enableSorting:!0,enableCellEdit:!1,type:"number"},{displayName:"billing.prevAdj",headerCellFilter:"translate",name:"ADJUST_AMOUNT",enableSorting:!0,enableCellEdit:!1,type:"number"},{displayName:"billing.availDeposit",headerCellFilter:"translate",name:"REMAIN_AMOUNT",enableSorting:!0,enableCellEdit:!1,type:"number"},{displayName:"billing.preAdjTotal",headerCellFilter:"translate",name:"preAdjTotal",enableSorting:!0,enableCellEdit:!1,type:"number"},{displayName:"billing.remainingBal",headerCellFilter:"translate",name:"remBal",enableSorting:!0,enableCellEdit:!1,type:"number"},{name:"temBal",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:150,visible:!1},{displayName:"billing.adjAmt",headerCellFilter:"translate",name:"adjAmt",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" numbers-only ng-model="row.entity.adjAmt" ng-change="grid.appScope.accDep.changeAccAdj(row,rowRenderIndex)" ng-blur="grid.appScope.accDep.changedDep(row.entity,rowRenderIndex)" tabindex="1"></div>'}]}}e.$inject=["CallManager","BILLING_APIS"],angular.module("napierContainerUi").service("invStlService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("concessionTypeApproversRolesDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableExpandAll:!1,showExpandAllInHeader:!1,enableGridMenu:!0,showTreeRowHeader:!1,columnDefs:[{field:"Select All",enableSorting:!0,enableCellEdit:!1,width:"20",headerCellTemplate:'<div class="ui-grid-cell-contents ui-grid-header-cell-primary-focus"><input style="border-width: 0px;" type="checkbox" ng-click="grid.appScope.approvalRolesselectAll(grid.appScope.editmodeCheckAll)" ng-model="grid.appScope.editmodeCheckAll"/></div>'},{name:"select",displayName:"select",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents" ><input style="border-width: 0px;" type="checkbox" ng-click="grid.appScope.approvalRolesselect(row.entity,\'update\')"ng-disabled="row.entity.concessionApplicability == \'Not Applicable\'" ng-model="row.entity.editmode"/></div>',width:"100"},{field:"RL_NAME",displayName:"Role",enableSorting:!0,enableCellEdit:!1,width:"*"}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("concessionTypeDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,columnDefs:[{field:"CONC_NAME",displayName:"Concession Type",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"CONC_DESC",displayName:"Description",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"CONC_TYPE_DESC",displayName:"Category",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"Actions",displayName:"Actions",enableSorting:!0,enableCellEdit:!0,width:"100",cellTemplate:'<div class="action-layout actionRow ui-grid-cell-contents"><i class="fa fa-pencil edit-action " role="button" tabindex="0"  ng-click="grid.appScope.editClick(row.entity,\'update\')"></i></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("concessionTypeCreateNew1Definition",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1,multiSelect:!0,enableHorizontalScrollbar:0,enableRowSelection:!1,enableRowHeaderSelection:!0,showTreeExpandNoChildren:!0,columnDefs:[{field:"SERV_CODE",displayName:"Service Code",enableSorting:!0,enableCellEdit:!1,width:"100"},{field:"SERV_NAME",displayName:"Service Name",enableSorting:!0,enableCellEdit:!1,width:"*"}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("concessionTypeCreateNew2Definition",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1,multiSelect:!0,enableHorizontalScrollbar:0,enableRowSelection:!1,enableRowHeaderSelection:!0,showTreeExpandNoChildren:!0,columnDefs:[{field:"SERV_CODE",displayName:"Service Code",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"SERV_NAME",displayName:"Service Name",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"companyName",displayName:"Max Limit",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div><input type ="text" ng-model="row.entity.CONC_AMOUNT" ng-blur="grid.appScope.validatemaxlmt(row)" ng-keyup="grid.appScope.validatemaxlmtgrid(row)"></div>'}]})}(),function(){"use strict";function e(e,t,a,i,r){this.save=function(a,i,r,n){var l=e.defer(),s={"@class":"com.napier.core.service.vo.corebillingmasters.ConcessionMaster",concessionDesc:a.concessdescription,concessionName:a.concessType,facilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID,practiceId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID_DESC,gnConcessionType:a.ApplicableStatus,concessionDetail:i,concessionFacilityLinkList:r,concessionRole:n,concessionValidFrom:JSON.parse(sessionStorage.userContextObj).CURRENT_DATE,concessionValidTo:JSON.parse(sessionStorage.userContextObj).CURRENT_DATE,gnStatus:a.Status1,lastUpdatedOn:JSON.parse(sessionStorage.userContextObj).CURRENT_DATE},o={url:"HISServices/HITService"};return o.requestData={operation:"saveConcessionType",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:s},t.sendRestRequest(o).then(function(e){l.resolve(e)}),l.promise},this.update=function(a,i,r,n,l){var s=e.defer(),o={"@class":"com.napier.core.service.vo.corebillingmasters.ConcessionMaster",concessionHdSeqId:l,concessionDesc:a.concessdescription,concessionName:a.concessType,facilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID,practiceId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID_DESC,gnConcessionType:a.ApplicableStatus,concessionDetail:i,concessionFacilityLinkList:r,concessionRole:n,concessionValidFrom:JSON.parse(sessionStorage.userContextObj).CURRENT_DATE,concessionValidTo:JSON.parse(sessionStorage.userContextObj).CURRENT_DATE,gnStatus:a.Status1,lastUpdatedOn:JSON.parse(sessionStorage.userContextObj).CURRENT_DATE},c={url:"HISServices/HITService"};return c.requestData={operation:"updateConcessionType",messageId:"",destination:"com.napier.core.corebillingmasters.service.external.CoreBillingMasterService",message:o},t.sendRestRequest(c).then(function(e){s.resolve(e)}),s.promise}}e.$inject=["$q","CallManager","$log","IPINDENTAPIS","INVENTORYNEWAPIS"],angular.module("napierContainerUi").service("concessionTypeService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("AddInsuranceMCEGrid",{enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableCellEdit:!1,enableCellEditOnFocus:!0,enableGridMenu:!1,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,exporterLinkLabel:"get your csv here",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,multiSelect:!0,columnDefs:[{field:"MATERIALMAINGRPDESCRIPTION",displayName:"billing.mtrlMainGrp",headerCellFilter:"translate"},{field:"MATERIALMAINGRPCODE",displayName:"Material Main Group ID",visible:!1},{field:"MATERIALSUBGRPDESCRIPTION",displayName:"billing.mtrlSubGrp",headerCellFilter:"translate"},{field:"MATERIALSUBGRPCODE",displayName:"Material Sub Group ID",visible:!1},{field:"MATERIALDESCRIPTION",displayName:"billing.materialName",headerCellFilter:"translate"},{field:"MATERIALCODE",displayName:"billing.materialCode",headerCellFilter:"translate"},{field:"GN_STATUS",displayName:"gnStatus",visible:!1},{field:"iemSeqId",displayName:"iemSeqId",visible:!1},{field:"Action",displayName:"billing.actions",headerCellFilter:"translate",width:"20%",height:"15%",cellEditableCondition:!1,cellTemplate:'<div  class="ui-grid-cell-contents action-row" ng-show="row.entity.GN_STATUS"><md-switch  ng-click="grid.appScope.activeClick(row)" ng-change="grid.appScope.vm.activeMaterialExclusions(row.entity)" ng-true-value="1" ng-false-value="2" ng-model="row.entity.GN_STATUS" class=" md-primary actionSwitch wlabel" aria-label="Switch 1">{{(row.entity.GN_STATUS==1)?"Active":"Inactive" }}</md-switch></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("AddInsuranceMCIGrid",{enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableCellEdit:!1,enableCellEditOnFocus:!0,enableGridMenu:!1,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,exporterLinkLabel:"get your csv here",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,multiSelect:!0,rowTemplate:'<div ng-class="{\'grey\':row.entity.GN_STATUS==2}"><div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>',columnDefs:[{field:"MATERIALMAINGRPDESCRIPTION",displayName:"billing.mtrlMainGrp",headerCellFilter:"translate"},{field:"MATERIALMAINGRPCODE",displayName:"Material Main Group ID",visible:!1},{field:"MATERIALSUBGRPDESCRIPTION",displayName:"billing.mtrlSubGrp",headerCellFilter:"translate"},{field:"MATERIALSUBGRPCODE",displayName:"Material Sub Group ID",visible:!1},{field:"iimSeqId",displayName:"iimSeqId",visible:!1},{field:"MATERIALDESCRIPTION",displayName:"billing.materialName",headerCellFilter:"translate"},{field:"MATERIALCODE",displayName:"billing.materialCode",headerCellFilter:"translate"},{field:"GN_STATUS",displayName:"gnStatus",visible:!1},{field:"Action",displayName:"billing.actions",headerCellFilter:"translate",width:"20%",height:"15%",cellEditableCondition:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row" ng-class="{\'grey\':row.entity.GN_STATUS==2}"  ng-show="row.entity.GN_STATUS"><md-switch  ng-change="grid.appScope.vm.activeMaterialInclusions(row.entity)" ng-click="grid.appScope.activeClick(row)" ng-true-value="1" ng-false-value="2" ng-model="row.entity.GN_STATUS" class=" md-primary actionSwitch wlabel" aria-label="Switch 1">{{(row.entity.GN_STATUS==1)?"Active":"Inactive" }}</md-switch></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("AddInsuranceSEGrid",{enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableCellEdit:!1,enableCellEditOnFocus:!0,enableGridMenu:!1,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,exporterLinkLabel:"get your csv here",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,multiSelect:!0,columnDefs:[{field:"DEPARTMENTDESCRIPTION",displayName:"billing.department",headerCellFilter:"translate"},{field:"DEPARTMENTCODE",displayName:"Department Code",visible:!1},{field:"SUBDEPARTMENTCODE",displayName:"Sub-Department Code",visible:!1},{field:"SUBDEPARTMENTDESCRIPTION",displayName:"billing.subDepartment",headerCellFilter:"translate"},{field:"SERVICECODE",displayName:"billing.serviceCode",headerCellFilter:"translate"},{field:"SERV_SEQ_ID",displayName:"Service Seq Code",visible:!1},{field:"iesSeqID",displayName:"iesSeqID",visible:!1},{field:"SERVICENAME",displayName:"billing.serviceName",headerCellFilter:"translate"},{field:"ExaliasName",displayName:"Alias Name",visible:!1},{field:"ExaliasCode",displayName:"Alias Code",visible:!1},{field:"GN_STATUS",displayName:"gnStatus",visible:!1},{field:"Action",displayName:"billing.actions",headerCellFilter:"translate",width:"20%",height:"15%",cellEditableCondition:!1,cellTemplate:'<div  class="ui-grid-cell-contents action-row" ng-show="row.entity.GN_STATUS"><md-switch  ng-change="grid.appScope.vm.activeServiceExclusions(row.entity)" ng-click="grid.appScope.activeClick(row)" ng-true-value="1" ng-false-value="2" ng-model="row.entity.GN_STATUS" class=" md-primary actionSwitch wlabel" aria-label="Switch 1">{{(row.entity.GN_STATUS==1)?"Active":"Inactive" }}</md-switch></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("AddInsuranceSIGrid",{enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableCellEdit:!1,enableCellEditOnFocus:!0,enableGridMenu:!1,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,exporterLinkLabel:"get your csv here",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,multiSelect:!0,columnDefs:[{field:"DEPARTMENTNAME",displayName:"billing.department",headerCellFilter:"translate"},{field:"DEPARTMENTCODE",displayName:"Department Code",visible:!1},{field:"SUBDEPARTMENTNAME",displayName:"billing.subDepartment",headerCellFilter:"translate"},{field:"SUBDEPARTMENTCODE",displayName:"Sub-Department Code",visible:!1},{field:"SER_SEQ_ID",displayName:"billing.serviceCode",headerCellFilter:"translate"},{field:"SERV_SEQ_ID",displayName:"Service Seq Code",visible:!1},{field:"SERV_NAME",displayName:"billing.serviceName",headerCellFilter:"translate"},{field:"ALIAS_NAME",displayName:"billing.alias.name",headerCellFilter:"translate"},{field:"ALIAS_CODE",displayName:"billing.alias.code",headerCellFilter:"translate"},{field:"iisSeqId",displayName:"iisSeqId",visible:!1},{field:"GN_STATUS",displayName:"gnStatus",visible:!1},{field:"isFlagStatus",displayName:"isFlagStatus",visible:!1},{field:"Action",displayName:"billing.actions",headerCellFilter:"translate",width:"20%",height:"15%",cellEditableCondition:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row" ng-show="row.entity.GN_STATUS"><md-switch  ng-click="grid.appScope.activeClick(row)" ng-true-value="1" ng-false-value="2" ng-change="grid.appScope.vm.activeServiceInclusions(row.entity)" ng-model="row.entity.GN_STATUS" class=" md-primary actionSwitch wlabel" aria-label="Switch 1">{{(row.entity.GN_STATUS==1)?"Active":"Inactive" }}</md-switch></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("AddInsuranceTCEGrid",{enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableCellEdit:!1,enableCellEditOnFocus:!0,enableGridMenu:!1,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,multiSelect:!0,columnDefs:[{field:"DESCRIPTION",displayName:"billing.tariffclassname",headerCellFilter:"translate"},{field:"CODE",displayName:"billing.tariffclasscode",headerCellFilter:"translate"},{field:"GN_STATUS",displayName:"gnStatus",visible:!1},{field:"tarfiffExclSeqId",displayName:"tarfiffExclSeqId",visible:!1},{field:"Action",displayName:"billing.actions",headerCellFilter:"translate",width:"20%",height:"15%",cellEditableCondition:!1,cellTemplate:'<div  class="ui-grid-cell-contents action-row" ng-show="row.entity.GN_STATUS"><md-switch  ng-change="grid.appScope.vm.activeTariffExclusions(row.entity)" ng-click="grid.appScope.activeClick(row)" ng-true-value="1" ng-false-value="2" ng-model="row.entity.GN_STATUS" class=" md-primary actionSwitch wlabel" aria-label="Switch 1">{{(row.entity.GN_STATUS==1)?"Active":"Inactive" }}</md-switch></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("AddInsuranceTCIGrid",{enableHorizontalScrollbar:0,enableVerticalScrollbar:0,enableCellEdit:!1,enableCellEditOnFocus:!0,enableGridMenu:!1,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,multiSelect:!0,columnDefs:[{field:"DESCRIPTION",displayName:"billing.tariffclassname",headerCellFilter:"translate"},{field:"CODE",displayName:"billing.tariffclasscode",headerCellFilter:"translate"},{field:"GN_STATUS",displayName:"gnStatus",visible:!1},{field:"tarfiffInclSeqId",displayName:"tarfiffInclSeqId",visible:!1},{field:"Action",displayName:"billing.actions",headerCellFilter:"translate",width:"20%",height:"15%",cellEditableCondition:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row" ng-class="{ \'grey\':grid.appScope.rowFormatter( row ) }"  ng-show="row.entity.GN_STATUS"><md-switch  ng-change="grid.appScope.vm.activeTariffInclusions(row.entity)" ng-click="grid.appScope.activeClick(row)" ng-true-value="1" ng-false-value="2" ng-model="row.entity.GN_STATUS" class=" md-primary actionSwitch wlabel" aria-label="Switch 1">{{(row.entity.GN_STATUS==1)?"Active":"Inactive" }}</md-switch></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("coPayGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:0,columnDefs:[{name:"primayServiceGroup",displayName:"Primay Service Group",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div  class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.primayServiceGroup"  ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.vm.psgdwn_copay track by dept.CODE"><option selected hidden="" style="">Select One</option></select></div>'},{name:"department",displayName:"Department",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.department" ng-change="grid.appScope.vm.OnChangeDept(row.entity.department,rowRenderIndex)" ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.vm.deptdwn_copay track by dept.CODE"><option selected hidden="" style="">Select One</option></select></div>'},{name:"speciality",displayName:"Speciality",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.speciality" ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.vm.deptSpecicityService[rowRenderIndex] track by dept.CODE"><option selected hidden="" style="">Select One</option></select></div>'},{name:"service",displayName:"Service",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" class="form-control" ng-disabled="row.entity.isEditable"ng-model="row.entity.service" placeholder="service" uib-typeahead="suppliersList as suppliersList.SERV_NAME for suppliersList in grid.appScope.vm.serchOptimSpeciSerch($viewValue,rowRenderIndex)"  typeahead-on-select="grid.appScope.vm.setCopayService(row.entity.service,rowRenderIndex)" style="" typeahead-append-to-body=true ></div>'},{name:"copayment",displayName:"Copayment(%)",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" numbers-only my-maxlength="2" class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.copayment" placeholder="Enter" style=""></div>'},{name:"maxCap",displayName:"Max Cap",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" numbers-only  class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.maxCopay" placeholder="Enter" style=""></div>'},{name:"actions",displayName:"Actions",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents copay-grid-action-icons action-row"><i class="fa fa-check" ng-show="!row.entity.isFirstRow" ng-click="grid.appScope.vm.copayServiceGridList(row.entity,rowRenderIndex)"></i><i class="fa fa-pencil" ng-show="row.entity.isFirstRow" ng-click="grid.appScope.vm.setcopayGridEdit(row.entity,rowRenderIndex)"></i><i class="fa fa-trash" ng-show="row.entity.isFirstRow" ng-click="grid.appScope.vm.delete(row.entity,rowRenderIndex)"></i><i class="fa fa-ban" ng-show="!row.entity.isFirstRow" ng-click="grid.appScope.vm.clear()"></i></div>'}]}).constant("coPayGridDef2",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:0,columnDefs:[{name:"primayServiceGroup",displayName:"Primay Service Group",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div  class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.primayServiceGroup"  ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.psgdwn_copay track by dept.CODE"><option selected hidden="" style="">Select One</option></select></div>'},{name:"department",displayName:"Department",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.department" ng-change="grid.appScope.OnChangeDept(row.entity.department,rowRenderIndex)" ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.deptdwn_copay track by dept.CODE"><option selected hidden="" style="">Select One</option></select></div>'},{name:"speciality",displayName:"Speciality",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.speciality" ng-options="dept.CODE as dept.DESCRIPTION for dept in grid.appScope.deptSpecicityService[rowRenderIndex] "><option selected hidden="" style="">Select One</option></select></div>'},{name:"service",displayName:"Service",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" class="form-control" ng-disabled="row.entity.isEditable"ng-model="row.entity.service" placeholder="service" uib-typeahead="suppliersList as suppliersList.SERV_NAME for suppliersList in grid.appScope.serchOptimSpeciSerch($viewValue,rowRenderIndex)"  typeahead-on-select="grid.appScope.setCopayService(row.entity.service,rowRenderIndex)" style="" typeahead-append-to-body=true ></div>'},{name:"copayment",displayName:"Copayment(%)",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text"  numbers-only my-maxlength="2" class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.copayment" placeholder="Enter" style=""></div>'},{name:"actions",displayName:"Actions",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents action-row copay-grid-action-icons"><i class="fa fa-check" style="color: #62c129;" ng-show="!row.entity.isFirstRow" ng-click="grid.appScope.copayServiceGridList(row.entity,rowRenderIndex)"></i><i class="fa fa-pencil" ng-show="row.entity.isFirstRow" ng-click="grid.appScope.setcopayGridEdit(row.entity,rowRenderIndex)"></i><i class="fa fa-trash" ng-show="row.entity.isFirstRow" ng-click="grid.appScope.delete(row.entity,rowRenderIndex)"></i><i class="fa fa-ban" ng-show="!row.entity.isFirstRow" ng-click="grid.appScope.vm.clear()"></i></div>'}]})}(),function(){"use strict";function e(e,t){this.getGridData=function(a){var i={};return i.url=e.HISPLANSERVICEINCEXC.URL,i.requestData={operation:"getServiceMappingSearchService",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceServiceVo"}},angular.extend(i.requestData.message,a),t.sendRestRequest(i)}}e.$inject=["BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("InclusionExclusionService",e)}(),function(){"use strict";function e(e,t,a){this.combosFilling=function(i){var r={};return r.url=e.HISCOMBOFILLING.URL,r.requestData=angular.copy(a),angular.extend(r.requestData.message,i),t.sendRestRequest(r)}}e.$inject=["BILLING_APIS","CallManager","InsuranceDropdownQuery"],angular.module("napierContainerUi").service("InsuranceDropdownService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("coveringGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,enableColumnMenus:!0,enableGridMenu:!0}).constant("coveringModalGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,columnDefs:[{name:"Bill Name",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:100},{name:"Bill Date",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:150},{name:"MR No",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:150},{name:"IP No",enableSorting:!0,enableCellEdit:!0,width:150},{name:"Patient Name",enableSorting:!0,enableCellEdit:!0,width:150},{name:"Corporate Due",enableSorting:!0,enableCellEdit:!0,width:150},{name:"Settled Amount",enableSorting:!0,enableCellEdit:!0,width:150},{name:"Balance Due",enableSorting:!0,enableCellEdit:!0,width:150}]})}(),function(){"use strict";function e(e,t,a){this.generateCoverLetter=function(a){for(var i=[],r={},n=0;n<a.selectInvoice.length;n++)i.push({coverLetterAmt:a.selectInvoice[n].INVOICE_AMT,patientType:a.selectInvoice[n].GN_BILL_TYPE,invcHdSeqId:a.selectInvoice[n].INVC_HD_SEQ_ID,gnTranStatus:1}),n==a.selectInvoice.length-1&&(r={"@class":"com.napier.core.invoicesettlement.vo.CoverLetterHeader",compSeqId:a.selectInvoice[n].COMPANY_SEQ_ID,compType:1,coverLetterStatus:0,gnTranStatus:0,noOfInvoice:a.selectInvoice.length,coverLetterFromDate:a.frmDate,coverLetterToDate:a.toDate,coverLetterDetailList:[{"com.napier.core.invoicesettlement.vo.CoverLetterDetail":i}]});var l={};return l.url=t.HISIPINDENT.URL,l.requestData={operation:"saveCoveringLetter",messageId:"",destination:"com.napier.core.invoicesettlement.service.external.CoveringLetterService",message:r},e.sendRestRequest(l)},this.getGridColumnDefs=function(e){e.gridMenuTitleFilter=a.menuTranslate,e.columnDefs=[{displayName:"Invoice No",name:"INVOICE_NO",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,headerCellFilter:"translate",width:100},{displayName:"No of Bills",name:"NO_OF_BILLS",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:150},{displayName:"Visit Type",name:"DESCRIPTION",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:150},{displayName:"Payer Id",name:"COMPANY_ID",enableSorting:!0,enableCellEdit:!0,width:150},{displayName:"Payer",name:"COMPANY_NAME",enableSorting:!0,enableCellEdit:!0,width:150},{displayName:"Invoice Date & Time",name:"INVOICE_DATE",enableSorting:!0,enableCellEdit:!0,width:150,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.INVOICE_DATE| date:"dd/MM/yyyy hh:mm a"}}</div>'},{displayName:"Total Amount",name:"INVOICE_AMT",enableSorting:!0,enableCellEdit:!0,width:150,type:"number"},{displayName:"Corporate Due",name:"DUE_AMT",enableSorting:!0,enableCellEdit:!0,width:150,type:"number"},{displayName:"Covering Letter Status",name:"COVER_LETTER_STATUS_DESC",enableSorting:!0,enableCellEdit:!0,width:150}]}}e.$inject=["CallManager","BILLING_APIS","hisTranslationsService"],angular.module("napierContainerUi").service("coveringService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("inclusionGridConstants",{enableHorizontalScrollbar:0,columnDefs:[{field:"bedClassCode",displayName:"billing.bedClassCode",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0" class="form-group grid-input"><input type="text" class="form-control" ng-model="row.entity.bedClassCode"  placeholder="Enter" ng-disabled="row.entity.bedClassName.CODE || grid.appScope.cp.disableFieldsForTPA"></div><span ng-if="rowRenderIndex!=0">{{row.entity.bedClassCode}}</span></div>'},{field:"bedClassName",displayName:"billing.bedClassName",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group grid-input" ng-if="rowRenderIndex==0" ><div class="input-group"><input type="text" class="form-control" ng-model="row.entity.bedClassName" uib-typeahead="tariff as tariff.DESCRIPTION for tariff in grid.appScope.cp.tariffAutoSuggest($viewValue,1) " typeahead-min-length="3" typeahead-on-select="row.entity.bedClassCode=row.entity.bedClassName.CODE" placeholder="Enter" typeahead-append-to-body=true ng-disabled="grid.appScope.cp.disableFieldsForTPA"><span class="input-group-addon adv-search-addon"><img src="assets/adv-search-icon.png"></span></div></div><span ng-if="rowRenderIndex!=0">{{row.entity.bedClassName.DESCRIPTION}}</span></div>'},{field:"actions",displayName:"billing.action",headerCellFilter:"translate",cellTemplate:'<div ng-if="rowRenderIndex==0" class="ui-grid-cell-contents"><button ng-disabled="(grid.appScope.activeFirst==4&&grid.appScope.cp.planExclGridOptions.data.length>1)||(grid.appScope.activeFirst==2&&grid.appScope.cp.exclGridOptions.data.length>1)|| !row.entity.bedClassName.CODE || grid.appScope.cp.disableFieldsForTPA" ng-click="grid.appScope.cp.addInclusionBedClass(row.entity,1)" class="his-btn his-btn-info his-grid-btn"><i class="fa fa-plus"> Add</i></button></div><div ng-if="!rowRenderIndex==0" class="ui-grid-cell-contents action-row"><i ng-click="grid.appScope.cp.editGridList(row.entity,rowRenderIndex,1)" class="fa fa-pencil" ng-disabled="grid.appScope.cp.disableFieldsForTPA"></i><i ng-if="!row.entity.editGrid" ng-click="grid.appScope.cp.deleteGrid(row.entity,rowRenderIndex,1)" class="fa fa-trash" ng-disabled="grid.appScope.cp.disableFieldsForTPA"></i></div>'}],data:[{}]}).constant("bedClassGridConstants",{enableHorizontalScrollbar:0,columnDefs:[{field:"bedClassCode",displayName:"billing.bedClassCode",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0" class="form-group grid-input"><input type="text" ng-model="row.entity.bedClassCode" class="form-control" placeholder="Enter" ng-disabled="row.entity.bedClassName.CODE || grid.appScope.cp.disableFieldsForTPA" ></div><span ng-if="rowRenderIndex!=0">{{row.entity.bedClassCode}}</span></div>'},{field:"bedClassName",displayName:"billing.bedClassName",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0" class="form-group grid-input"><div class="input-group"><input type="text" ng-model="row.entity.bedClassName" uib-typeahead="tariff as tariff.DESCRIPTION for tariff in grid.appScope.cp.tariffAutoSuggest($viewValue,2) " typeahead-min-length="3" typeahead-on-select="row.entity.bedClassCode=row.entity.bedClassName.CODE" placeholder="Enter" typeahead-append-to-body=true class="form-control" placeholder="Enter" ng-disabled="grid.appScope.cp.disableFieldsForTPA"><span class="input-group-addon adv-search-addon"><img src="assets/adv-search-icon.png"></span></div></div><span ng-if="rowRenderIndex!=0">{{row.entity.bedClassName.DESCRIPTION}}</span></div>'},{field:"actions",displayName:"billing.action",headerCellFilter:"translate",cellTemplate:'<div ng-if="rowRenderIndex==0" class="ui-grid-cell-contents"><button ng-disabled="(grid.appScope.activeFirst==4&&grid.appScope.cp.planInclGridOptions.data.length>1)||(grid.appScope.activeFirst==2&&grid.appScope.cp.inclGridOptions.data.length>1) || !row.entity.bedClassName.CODE || grid.appScope.cp.disableFieldsForTPA" ng-click="grid.appScope.cp.addInclusionBedClass(row.entity,2)" class="his-btn his-btn-info his-grid-btn"><i class="fa fa-plus"> Add</i></button></div><div ng-if="!rowRenderIndex==0" class="ui-grid-cell-contents action-row"><i ng-click="grid.appScope.cp.editGridList(row.entity,rowRenderIndex,2)" class="fa fa-pencil" ng-disabled="grid.appScope.cp.disableFieldsForTPA"></i><i ng-if="!row.entity.editGrid" ng-click="grid.appScope.cp.deleteGrid(row.entity,rowRenderIndex,2)" class="fa fa-trash" ng-disabled="grid.appScope.cp.disableFieldsForTPA"></i></div>'}],data:[{}]}).constant("diagnosisGridConstants",{enableHorizontalScrollbar:0,columnDefs:[{field:"diagnosisCode",displayName:"billing.diagnosisCode",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0" class="form-group grid-input"><input type="text" ng-model="row.entity.diagnosisCode" uib-typeahead="tariff as tariff.ICDCODE for tariff in grid.appScope.cp.autoSearchOnDiagnosis($viewValue,2) " ng-change="row.entity.diagnosisName=\'\'" typeahead-min-length="3" typeahead-on-select="row.entity.diagnosisName=row.entity.diagnosisCode;row.entity.diagnosisCode=row.entity.diagnosisName.ICDCODE;" placeholder="Enter" typeahead-append-to-body=true ng-disabled="grid.appScope.cp.disableFieldsForTPA" class="form-control" placeholder="Enter"></div><span ng-if="rowRenderIndex!=0">{{row.entity.diagnosisCode}}</span></div>'},{field:"diagnosisName",displayName:"billing.diagnosisName",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0" class="form-group grid-input"><div class="input-group"><input type="text" ng-change="row.entity.diagnosisCode=\'\'" ng-model="row.entity.diagnosisName" uib-typeahead="tariff as tariff.DESCRIPTION for tariff in grid.appScope.cp.autoSearchOnDiagnosis($viewValue,1) " typeahead-min-length="3" typeahead-on-select="row.entity.diagnosisCode=row.entity.diagnosisName.ICDCODE;" placeholder="Enter" typeahead-append-to-body=true class="form-control" ng-disabled="grid.appScope.cp.disableFieldsForTPA"><span class="input-group-addon adv-search-addon"><img src="assets/adv-search-icon.png"></span></div></div><span ng-if="rowRenderIndex!=0">{{row.entity.diagnosisName.DESCRIPTION}}</span></div>'},{field:"actions",displayName:"billing.action",headerCellFilter:"translate",cellTemplate:'<div ng-if="rowRenderIndex==0" class="ui-grid-cell-contents"><button ng-disabled="(row.entity.type==2&&grid.appScope.cp.diagnosisInclGridOptions.data.length>1) || (row.entity.type==1&&grid.appScope.cp.diagnosisExclGridOptions.data.length>1) || !row.entity.diagnosisName.ICDCODE || grid.appScope.cp.disableFieldsForTPA" ng-click="grid.appScope.cp.addDiagnosisClass(row.entity,row.entity.type)" class="his-btn his-btn-info his-grid-btn"><i class="fa fa-plus"> Add</i></button></div><div ng-if="!rowRenderIndex==0" class="ui-grid-cell-contents action-row"><i ng-click="grid.appScope.cp.editGridDiagonisList(row.entity,rowRenderIndex)" class="fa fa-pencil" ng-disabled="grid.appScope.cp.disableFieldsForTPA"></i><i ng-if="!row.entity.editGrid" ng-click="grid.appScope.cp.deleteDigGrid(row.entity,rowRenderIndex,2)" class="fa fa-trash" ng-disabled="grid.appScope.cp.disableFieldsForTPA"></i></div>'}],data:[{}]}).constant("creditServiceGridConstants",{enableHorizontalScrollbar:0,columnDefs:[{field:"primServGroup",displayName:"billing.psGroup",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0"><div class="form-group grid-input"><select class="form-control " ng-model="row.entity.primServGroup" ng-disabled="grid.appScope.cp.disableFieldsForTPA" ng-options="dept as dept.DESCRIPTION for dept in (grid.appScope.activeFirst==3)?grid.appScope.cp.primaryServiceList:grid.appScope.cp.primaryServicePlanList track by dept.CODE" ><option>Select</option><option>Select</option></select></div></div><div ng-if="!rowRenderIndex==0">{{row.entity.primServGroup.DESCRIPTION}}</div></div>',visible:!0,pinnedLeft:!0},{field:"department",displayName:"billing.department",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0"><div class="form-group grid-input"><select class="form-control credit-payer-grid-input" ng-model="row.entity.department" ng-disabled="grid.appScope.cp.disableFieldsForTPA" ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.cp.departmentList track by dept.CODE"><option>Select</option><option>Select</option><option>Select</option></select></div></div><div ng-if="rowRenderIndex!=0">{{row.entity.department.DESCRIPTION}}</div></div>',visible:!1,pinnedLeft:!0},{field:"speciality",displayName:"billing.speciality",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0"><div class="form-group grid-input"><select class="form-control credit-payer-grid-input" ng-model="row.entity.speciality" ng-disabled="grid.appScope.cp.disableFieldsForTPA" ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.cp.specialityList track by dept.CODE" ><option>Select</option><option>Select</option></select></div></div><div ng-if="rowRenderIndex!=0">{{row.entity.speciality.DESCRIPTION}}</div></div>',visible:!1,pinnedLeft:!0},{field:"servCode",displayName:"billing.serviceCode",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0"><div class="form-group grid-input"><input type="text" class="form-control credit-payer-grid-input" placeholder="Select" ng-disabled="row.entity.disabled || grid.appScope.cp.disableFieldsForTPA" ng-model="row.entity.servCode" placeholder="service"  ></div></div><div ng-if="rowRenderIndex!=0">{{row.entity.servCode}}</div></div>',visible:!1,pinnedLeft:!0},{field:"servName",displayName:"billing.service",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0"><div class="form-group grid-input"><div class="input-group"><input type="text" class="form-control credit-payer-grid-input" placeholder="Enter" ng-model="row.entity.servName" uib-typeahead="suppliersList as suppliersList.SERV_NAME for suppliersList in grid.appScope.cp.serchOptimSpeciSerch($viewValue,row.entity,rowRenderIndex)" typeahead-min-length="3"  ng-change="(!row.entity.servName)?row.entity.disabled=false:\'\'" typeahead-on-select="row.entity.servCode=row.entity.servName.SERV_CODE;row.entity.disabled=true" typeahead-append-to-body=true ng-disabled="grid.appScope.cp.disableFieldsForTPA"><span class="input-group-addon adv-search-addon"><img src="assets/adv-search-icon.png"></span></div></div></div><div ng-if="rowRenderIndex!=0">{{row.entity.servName.SERV_NAME}}</div></div>',visible:!1,pinnedLeft:!0},{field:"applicability",displayName:"Applicability",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="row.entity.inclusion==1"><div class="form-group grid-input"><select  class="form-control" ng-model="row.entity.applicability" ng-disabled="grid.appScope.cp.disableFieldsForTPA"  ng-options="dept.DT_CODE as dept.DETAIL_DESC for dept in grid.appScope.cp.applicabilityList"></select></div></div><div ng-if="row.entity.inclusion==2">{{row.entity.applicability=undefined}}--</div></div>',visible:!1,pinnedLeft:!0},{field:"approvedQty",displayName:"Quantity",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="row.entity.inclusion==1"><div class="form-group grid-input"><input type="text"  class="form-control" numbers-only maxlength="13" ng-model="MODEL_COL_FIELD" ng-disabled="row.entity.apprIsAmtPercNl==3 || grid.appScope.cp.disableFieldsForTPA"></div></div><div ng-if="row.entity.inclusion==2">{{row.entity.approvedQty=undefined}}--</div></div>',visible:!1,pinnedLeft:!0},{field:"app_valueAmt",displayName:"Amount/NL/Percentage",width:140,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents" ng-if="row.entity.inclusion==1"><input type="text" ng-model="row.entity.approvedAmount" class="form-control" number-with-decimal my-maxlength="16" ng-change="(row.entity.apprIsAmtPercNl==2)?grid.appScope.cp.validateGrid(row,1):undefined" style="width:47% !important;float:left;" ng-disabled="row.entity.apprIsAmtPercNl==3 || grid.appScope.cp.disableFieldsForTPA" ><select ng-change="(row.entity.apprIsAmtPercNl==3)?[row.entity.approvedAmount=undefined,row.entity.approvedQty=undefined]:(row.entity.apprIsAmtPercNl==2)?grid.appScope.cp.changeBedAmt(row.entity[grid.appScope.cp.planInclGridOptions.data[1].bedClassName.CODE],row.entity,row):undefined" class="form-control" style="width:47% !important;float:left;" ng-model="row.entity.apprIsAmtPercNl" ng-disabled="grid.appScope.cp.disableFieldsForTPA"><option value="1">Amt</option><option value="2">%</option><option value="3">NL</option></select></div><div ng-if="row.entity.inclusion==2" class="ui-grid-cell-contents">{{row.entity.approvedAmount=undefined}}--</div>',visible:!1,pinnedLeft:!0},{field:"inclusion",displayName:"Included/Excluded",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents action-row"><div ><md-switch  ng-true-value="1" ng-false-value="2"  ng-model="row.entity.inclusion" class=" md-primary actionSwitch wlabel" aria-label="Switch 1"></md-switch></div>',pinnedLeft:!0,visible:!1},{field:"isRequired",displayName:"Approval Required",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents action-row"><div ng-if="row.entity.inclusion==1"><md-switch   ng-true-value="1" ng-false-value="2"  ng-model="row.entity.isRequired" class=" md-primary actionSwitch wlabel" aria-label="Switch 1"></md-switch></div><div ng-if="row.entity.inclusion==2">{{row.entity.isRequired=undefined}}--</div></div>',pinnedLeft:!0},{field:"actions",displayName:"billing.action",headerCellFilter:"translate",cellTemplate:'<div ng-if="rowRenderIndex==0" class="ui-grid-cell-contents"><button class="his-btn his-btn-info his-grid-btn" ng-disabled="(grid.appScope.activeFirst==4&&row.entity.inclusion!=2&&(((row.entity.apprIsAmtPercNl!=3&&!row.entity.approvedAmount)||(row.entity.apprIsAmtPercNl!=3&&!row.entity.approvedQty)||!row.entity.apprIsAmtPercNl||!row.entity.applicability)))||(!row.entity.department.CODE&&row.entity.level==2)||(!row.entity.primServGroup.CODE&&row.entity.level==1)||(!row.entity.speciality.CODE&&row.entity.level==3)||(!row.entity.servName.SERV_SEQ_ID&&row.entity.level==4) || grid.appScope.cp.disableFieldsForTPA" ng-click="grid.appScope.cp.addRecord(row.entity)"><i class="fa fa-plus" > Add</i></button></div><div ng-if="!rowRenderIndex==0" class="ui-grid-cell-contents action-row"><i ng-click="grid.appScope.cp.removeIncExcRcrd(row.entity,rowRenderIndex)" class="fa fa-trash" ng-disabled="grid.appScope.cp.disableFieldsForTPA || (grid.appScope.cp.data.payerCategory == 2)"></i></div>',pinnedRight:!0}],data:[{inclusion:1,isRequired:1,level:1,apprIsAmtPercNl:1,applicability:1}]}).constant("coPayGridConstants",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:0,columnDefs:[{name:"primayServiceGroup",displayName:"Primay Service Group",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div  class="credit-payer-grid-input ui-grid-cell-contents"><select class="form-control grid-input" ng-disabled="grid.appScope.cp.disableFieldsForTPA" ng-if="rowRenderIndex==0" ng-model="row.entity.primayServiceGroup"  ng-change="grid.appScope.cp.changePrimaryGroup(row.entity,rowRenderIndex)" ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.cp.primaryServiceList track by dept.CODE"><option selected hidden="" >Select One</option></select><span ng-if="rowRenderIndex!=0">{{row.entity.primayServiceGroup.DESCRIPTION}}</span></div>'},{name:"department",displayName:"Department",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="credit-payer-grid-input ui-grid-cell-contents "><select class="form-control grid-input" ng-disabled="grid.appScope.cp.disableFieldsForTPA" ng-if="rowRenderIndex==0" ng-model="row.entity.department" ng-change="grid.appScope.cp.OnChangeCopayDept(row.entity,rowRenderIndex)" ng-options="dept as dept.DESCRIPTION for dept in (row.entity.type==1)?grid.appScope.cp.deptdwn_default[rowRenderIndex]:(row.entity.type==2)?grid.appScope.cp.deptdwn_ip[rowRenderIndex]:(row.entity.type==3)?grid.appScope.cp.deptdwn_op[rowRenderIndex]:(row.entity.type==4)?grid.appScope.cp.deptdwn_discount[rowRenderIndex]:(row.entity.type==5)?grid.appScope.cp.deptdwn_opCoinsurance[rowRenderIndex]:grid.appScope.cp.deptdwn_ipCoinsurance[rowRenderIndex] track by dept.CODE"><option selected hidden="" >Select One</option></select><span ng-if="rowRenderIndex!=0">{{row.entity.department.DESCRIPTION}}</span></div>'},{name:"speciality",displayName:"Speciality",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="credit-payer-grid-input ui-grid-cell-contents"><select class="form-control grid-input" ng-disabled="grid.appScope.cp.disableFieldsForTPA" ng-if="rowRenderIndex==0" ng-model="row.entity.speciality" ng-options="dept as dept.DESCRIPTION for dept in (row.entity.type==1)?grid.appScope.cp.deptSpecicityDefaultService[rowRenderIndex]:(row.entity.type==2)?grid.appScope.cp.deptSpecicityIpService[rowRenderIndex]:(row.entity.type==3)?grid.appScope.cp.deptSpecicityOpService[rowRenderIndex]:(row.entity.type==4)?grid.appScope.cp.deptSpecicityDiscountService[rowRenderIndex]:(row.entity.type==5)?grid.appScope.cp.deptSpecicityOpCoInsuranceService[rowRenderIndex]: grid.appScope.cp.deptSpecicityIpCoInsuranceService[rowRenderIndex] track by dept.CODE" ng-change="grid.appScope.cp.changeSpeciality(row.entity,rowRenderIndex)"><option selected hidden="" >Select One</option></select><span ng-if="rowRenderIndex!=0">{{row.entity.speciality.DESCRIPTION}}</span></div>'},{name:"service",displayName:"Service",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="credit-payer-grid-input ui-grid-cell-contents"><input type="text" class="form-control grid-input" ng-disabled="grid.appScope.cp.disableFieldsForTPA" ng-if="rowRenderIndex==0" ng-model="row.entity.service" placeholder="service" uib-typeahead="suppliersList as suppliersList.SERV_NAME for suppliersList in grid.appScope.cp.serchOptimCopaySpeciSerch($viewValue,row.entity,rowRenderIndex)"  typeahead-on-select="grid.appScope.cp.setCopayService(row.entity,rowRenderIndex)"  typeahead-append-to-body=true typeahead-min-length="2"><span ng-if="rowRenderIndex!=0">{{row.entity.servName.SERV_NAME || row.entity.service.SERV_NAME}}</span></div>'},{field:"app_valueAmt",displayName:"Amount/NL/Percentage",width:140,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><input type="text" ng-model="row.entity.approvedAmount" ng-change="(row.entity.apprIsAmtPercNl==2)?grid.appScope.cp.validateGrid(row,1):undefined"  class="form-control" number-with-decimal my-maxlength="16" style="width:47%  !important;float:left; margin-right: 4px;" ng-disabled="row.entity.apprIsAmtPercNl==3||rowRenderIndex!=0 || grid.appScope.cp.disableFieldsForTPA" ><select  class="form-control" style="width:47% !important;float:left;" ng-model="row.entity.apprIsAmtPercNl" ng-disabled="rowRenderIndex!=0 ||grid.appScope.cp.disableFieldsForTPA" ng-change="(row.entity.apprIsAmtPercNl==3)?grid.appScope.cp.clearApprovedAmount(row):undefined;(row.entity.apprIsAmtPercNl==2)?grid.appScope.cp.validateGrid(row,1):undefined"><option value="1">Amt</option><option value="2">%</option><option value="3">NL</option></select></div>',visible:!1},{field:"quantity",displayName:"Quantity",width:70,cellTemplate:'<div class="ui-grid-cell-contents"><div><div class=""><input type="text" class="form-control" numbers-only ng-model="MODEL_COL_FIELD" maxlength="13" ng-disabled="row.entity.apprIsAmtPercNl==3||rowRenderIndex!=0 || grid.appScope.cp.disableFieldsForTPA"></div></div></div>',visible:!1},{field:"duration",displayName:"duration",cellTemplate:'<div class="ui-grid-cell-contents service-details-grid-contents"><input type="text" ng-model="row.entity.duration" class="form-control" ng-disabled="rowRenderIndex!=0 || grid.appScope.cp.disableFieldsForTPA" style="width:47% !important;float:left;margin-right: 4px;" validate-percentage decimal-upto="2"  my-maxlength="8" allow-negative="false"><select  class="form-control" style="width:47% !important;float:left;" ng-model="row.entity.durationType" ng-disabled="rowRenderIndex!=0 || grid.appScope.cp.disableFieldsForTPA" ng-options="dept.DT_CODE as dept.DETAIL_DESC for dept in grid.appScope.cp.applicabilityList" ></select></div>',visible:!1},{name:"copayment",displayName:"Copayment(Amt)",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" number-with-decimal my-maxlength="16" class="form-control credit-payer-grid-input"  ng-disabled="rowRenderIndex!=0 || grid.appScope.cp.disableFieldsForTPA" ng-model="row.entity.copayment" placeholder="Enter" style=""></div>',visible:!1},{name:"discount",displayName:"Discount",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents"><input type="text" numbers-only my-maxlength="3" class="form-control credit-payer-grid-input" ng-change="grid.appScope.cp.validateGrid(row,3)" ng-disabled="rowRenderIndex!=0 || grid.appScope.cp.disableFieldsForTPA" ng-model="row.entity.discount" placeholder="Enter" style=""></div>',visible:!1},{name:"coInsurance",displayName:"Co-Insurance(%)",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents"><input type="text" numbers-only  class="form-control credit-payer-grid-input" ng-disabled="rowRenderIndex!=0 || grid.appScope.cp.disableFieldsForTPA" ng-model="row.entity.coInsurance"  maxlength="3" ng-change="grid.appScope.cp.validateGrid(row,4)" placeholder="Enter" style=""></div>',visible:!1},{name:"actions",displayName:"Actions",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div ng-if="rowRenderIndex==0" class="ui-grid-cell-contents"><button class="his-btn his-btn-info his-grid-btn" ng-disabled="!row.entity.primayServiceGroup.CODE ||((row.entity.apprIsAmtPercNl != 3 && !row.entity.approvedAmount&&!row.entity.quantity&& row.entity.type == 1) ||(row.entity.type==4&& !row.entity.discount )||(( !row.entity.apprIsAmtPercNl || !row.entity.duration || !row.entity.durationType) && row.entity.type == 1)||(!row.entity.copayment&&(row.entity.type==2||row.entity.type==3))||(!row.entity.coInsurance&&(row.entity.type==5||row.entity.type==6)) || grid.appScope.cp.disableFieldsForTPA)" ng-click="grid.appScope.cp.copayServiceGridList(row.entity,rowRenderIndex)"><i class="fa fa-plus"> Add</i></button></div><div ng-if="rowRenderIndex!=0 && !row.entity.isEditable" class="ui-grid-cell-contents action-row"><i class="fa fa-pencil"  ng-click="grid.appScope.cp.setcopayGridEdit(row.entity,rowRenderIndex)" ng-disabled="grid.appScope.cp.disableFieldsForTPA"></i><i class="fa fa-trash" ng-if="rowRenderIndex!=0&&!row.entity.isEditable" ng-click="grid.appScope.cp.deleteCopy(row.entity,rowRenderIndex)" ng-disabled="grid.appScope.cp.disableFieldsForTPA"></i> </div>'}],data:[{}]}).constant("bedClassGridViewConstants",{enableHorizontalScrollbar:0,columnDefs:[{field:"bedClassCode",displayName:"billing.bedClassCode",headerCellFilter:"translate"},{field:"bedClassName",displayName:"billing.bedClassName",headerCellFilter:"translate"}],data:[]}).constant("diagnosisGridViewConstants",{enableHorizontalScrollbar:0,columnDefs:[{field:"diagnosisCode",displayName:"billing.diagnosisCode",headerCellFilter:"translate"},{field:"diagnosisName",displayName:"billing.diagnosisName",headerCellFilter:"translate"}],data:[]}).constant("creditServiceGridViewConstants",{enableHorizontalScrollbar:0,columnDefs:[{field:"primServGroup",displayName:"billing.psGroup",headerCellFilter:"translate",pinnedLeft:!0,cellTemplate:'<div class="grid-input ui-grid-cell-contents">{{row.entity.primServGroup.DESCRIPTION}}</div>'},{field:"department",displayName:"billing.department",headerCellFilter:"translate",pinnedLeft:!0,cellTemplate:'<div class="grid-input ui-grid-cell-contents">{{row.entity.department.DESCRIPTION}}</div>'},{field:"speciality",displayName:"billing.speciality",headerCellFilter:"translate",pinnedLeft:!0,cellTemplate:'<div class="grid-input ui-grid-cell-contents">{{row.entity.speciality.DESCRIPTION}}</div>'},{field:"servCode",displayName:"billing.serviceCode",headerCellFilter:"translate",pinnedLeft:!0},{field:"servName",displayName:"billing.service",headerCellFilter:"translate",pinnedLeft:!0,cellTemplate:'<div class="grid-input ui-grid-cell-contents">{{row.entity.servName.SERV_NAME}}</div>'},{field:"applicability",displayName:"Applicability",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.applicability}}</div>'},{field:"approvedQty",displayName:"Quantity"},{field:"actions",displayName:"Actions",width:90,pinnedRight:!0,cellTemplate:'<div class="ui-grid-cell-contents action-row"><i ng-if="row.entity.isRequired!=1" class="fa fa-check"></i> <img  ng-if="row.entity.isRequired==1" src="assets/stamp.png"></div>'}],data:[]}).constant("coPayGridViewConstants",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:0,columnDefs:[{name:"primayServiceGroup",displayName:"Primay Service Group",enableSorting:!0,enableCellEdit:!1},{name:"department",displayName:"Department",enableSorting:!0,enableCellEdit:!1},{name:"speciality",displayName:"Speciality",enableSorting:!0,enableCellEdit:!1},{name:"servName",displayName:"Service",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents">{{row.entity.servName}}</div>'},{field:"app_valueAmt",displayName:"Amount/NL/Percentage",cellTemplate:'<div class="ui-grid-cell-contents service-details-grid-contents">{{row.entity.approvedAmount}}{{row.entity.apprIsAmtPercNl}}</div>',visible:!1},{field:"quantity",displayName:"Quantity",width:70,visible:!1},{field:"duration",displayName:"duration",cellTemplate:'<div class="ui-grid-cell-contents service-details-grid-contents">{{row.entity.duration}}{{row.entity.durationType}}</div>',visible:!1},{name:"copayment",displayName:"Copayment(%)",enableSorting:!0,enableCellEdit:!1,visible:!1},{name:"discount",displayName:"Discount",enableSorting:!0,enableCellEdit:!1,visible:!1},{name:"coInsurance",displayName:"Co-Insurance",enableSorting:!0,enableCellEdit:!1,visible:!1}],data:[]})}(),function(){"use strict";function e(e,t,a){this.payerSearchAutoService=function(e){var t={url:"HISServices/InsuranceCompanyMasterService"};return t.requestData={operation:"getSearchService",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",inCompId:e.payerId,payerType:-999,payerFacilityLkVo:[{"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo":[{"@class":"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo",facilityId:e.facilityId?e.facilityId:""}]}]}},a.sendRestRequest(t)},this.payerSaveService=function(e){var t={url:"HISServices/InsuranceCompanyMasterService"};return t.requestData={operation:"saveOrUpdateInsuranceCompanyMaster",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:e},a.sendRestRequest(t)},this.deleteBedClass=function(e){var t={url:"HISServices/DeleteBedClass",requestData:{operation:"deletePayerBedClass",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",bedClassSeqId:e.bedClassSeqId,isBedClassInclOrExcl:e.bedClassType}}};return a.sendRestRequest(t)}}e.$inject=["$q","IPINDENTAPIS","CallManager"],angular.module("napierContainerUi").service("creditPayerService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("dependencyGridDefinition",{enableSorting:!1,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"DEPENDENT",displayName:"billing.Dependent",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:"*"},{name:"PARENT",displayName:"billing.parent",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:"*",cellTemplate:'<div  class="ui-grid-cell-contents custom-class"> <i class="fa fa-paperclip" aria-hidden="true" style="color: #7d7d7d; font-size: 14px;"></i>&nbsp;{{row.entity.PARENT}}</span></div>'},{name:"EFFETIVE_FROM",enableSorting:!0,displayName:"billing.effectiveFrm",headerCellFilter:"translate",enableCellEdit:!0,width:110,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.EFFETIVE_FROM|date:grid.appScope.dep.format}}</div>'},{name:"PERCENTAGE",enableSorting:!0,displayName:"billing.percentage",headerCellFilter:"translate",enableCellEdit:!0,width:95,cellTemplate:'<div  class="ui-grid-cell-contents custom-class" ><i ng-if="row.entity.Percentage_Increase_Decrease==1" class="fa fa-arrow-up" aria-hidden="true" style="color: #397551"></i > <i ng-if="row.entity.Percentage_Increase_Decrease==0" class = "fa fa-arrow-down"aria - hidden = "true" style="color: #bc4f54"></i>&nbsp;{{row.entity.PERCENTAGE}}&nbsp;%</div >'},{name:"ROUNDOFF",displayName:"billing.roundOff",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:85},{name:"GN_STATUS",displayName:"billing.action",headerCellFilter:"translate",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,width:90,cellTemplate:'<div class="ui-grid-cell-contents action-row"><i ng-if="!row.entity.isEditable" class="fa fa-pencil" ng-click="grid.appScope.dep.editGrid(row.entity,rowRenderIndex)" style="color: #7d7d7d; font-size: 14px;"></i><i ng-if="row.entity.isEdit" class="fa fa-check"></i> <md-switch ng-change="grid.appScope.dep.activeCheck=true;grid.appScope.dep.saveDependency(row.entity)"  ng-true-value="1" ng-false-value="2" ng-model="row.entity.GN_STATUS" class="md-primary" aria-label="Switch 1" style="margin:0px;display:inline;">{{ (row.entity.GN_STATUS==1)?"Active":"Inactive" }}</md-switch></div>'}]})}(),function(){"use strict";function e(e,t,a){this.saveDependencyService=function(e){var t={url:"HISServices/saveDependency"};return t.requestData={operation:"saveOrUpdateDependency",destination:"com.napier.core.ratecard.service.external.RateCardService",message:{"@class":"com.napier.core.service.vo.DependencyVo",dependencyVosList:[{"com.napier.core.service.vo.DependencyVo":e}]}},a.sendRestRequest(t)}}e.$inject=["$q","IPINDENTAPIS","CallManager"],angular.module("napierContainerUi").service("dependencyService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("depositMastersGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,columnDefs:[{name:"depositName",displayName:"billing.DepositName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",cellTooltip:function(e,t){return"Deposit Name: "+e.entity.depositName},width:"*"},{name:"description",displayName:"billing.descrption",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",cellTooltip:function(e,t){return"Description: "+e.entity.description},width:"*"},{name:"gnFlowDesc",displayName:"billing.Applicability",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"gnApplicableToDesc",displayName:"billing.Type",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row" ng-if="row.entity.actionsFlag"><span ng-blur="grid.appScope.depositMasters.blurDepositMasters()" ng-disabled="row.entity.gnStatus==2?true:false"  ng-click="row.entity.gnStatus==1?grid.appScope.depositMasters.editDepositMasters(row.entity):false" ng-if="grid.appScope.depositMasters.roleTask.T_BL_M_DEP_TYPE_U!=undefined"><i class="fa fa-pencil"></i></span><md-switch class="md-primary wlabel" ng-model="row.entity.actStatus"  ng-change="grid.appScope.depositMasters.activeInactive(row.entity)" ng-if="grid.appScope.depositMasters.roleTask.T_BL_M_DEP_TYPE_ACTV!=undefined"></md-switch><span style="">{{row.entity.gnStatusDesc}}</span></div>',width:"*"}],useExternalSorting:!1,enableColumnMenus:!1}).constant("depositMastersFormGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,columnDefs:[{name:"Department",displayName:"billing.department",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",cellTooltip:function(e,t){return"Department: "+e.entity.Department},width:"*"},{name:"SubDepartment",displayName:"billing.subDepartment",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",cellTooltip:function(e,t){return"Sub Department: "+e.entity.SubDepartment},width:"*"},{name:"ServiceCode",displayName:"billing.serviceCode",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",cellTooltip:function(e,t){return"Service Code: "+e.entity.ServiceCode},width:"*"},{name:"ServiceName",displayName:"billing.serviceName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",cellTooltip:function(e,t){return"Service Name: "+e.entity.ServiceName},width:"*"},{field:"TariffClass.name",displayName:"billing.tariffClass",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",cellTooltip:function(e,t){return"Tariff Class: "+e.entity.TariffClass.name},width:"*"},{name:"DepositAmount",displayName:"billing.depositAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-if="!row.entity.editable">{{row.entity.DepositAmount}}</div><div ng-if="row.entity.editable"><input class="form-control" ng-model="row.entity.DepositAmount" ng-focus="row.entity.editable" onkeypress="return event.charCode >= 48 && event.charCode <= 57||event.keyCode == 46" ng-blur="grid.appScope.depositMasters.depositRecordDesable(row)"/></div>',width:"*"},{name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row" ng-if="row.entity.actionsFlag"><span style="" ng-disabled="row.entity.gnStatus==2?true:false"  ng-click="row.entity.gnStatus==1?grid.appScope.depositMasters.editDepositRecord(row):false"><i class="fa fa-pencil"></i></span><md-switch class="md-primary wlabel" ng-model="row.entity.actStatus"  ng-change="grid.appScope.depositMasters.serviceGridActiveInactive(row.entity)"></md-switch><span style="">{{row.entity.gnStatusDesc}}</span></div>',width:"*"}],useExternalSorting:!1,enableColumnMenus:!1})}(),function(){"use strict";function e(e,t,a){var i=[],r=[];function n(e){return e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]}this.getGridData=function(i){var n=e.defer(),l={};l=null==i?{"@class":"com.napier.core.service.vo.deposits.DepositTypeVo",gnApplicableTo:-999,gnFlow:-999,gnStatus:-999,depositName:"",facilityId:-999}:{"@class":"com.napier.core.service.vo.deposits.DepositTypeVo",gnApplicableTo:i.servicetype?i.servicetype:-999,gnFlow:i.availableto?i.availableto:-999,gnStatus:i.status?i.status:-999,depositName:i.name?i.name:"",facilityId:-999};var s={};return s.url=t.HISDEPOSITSEARCH.URL,s.requestData={operation:"getDeposityTypeSearchList",messageId:"getDeposityTypeSearchList",destination:"com.napier.core.deposits.service.external.DepositsService",message:l},a.sendRestRequest(s).then(function(e){r=[];var t=e.data.HITService.message.depositTypes[0]["com.napier.core.service.vo.deposits.DepositTypeVo"];if(null==t){r.push({depositName:"No Records Found",actionsFlag:!1})}else{angular.isArray(t)?_.forEach(t,function(e,t){e.actStatus=!1,e.actionsFlag=!0,1==e.gnStatus&&(e.actStatus=!0),r.push(e)}):(t.actStatus=!1,1==t.gnStatus&&(t.actStatus=!0),t.actionsFlag=!0,r.push(t))}n.resolve(angular.copy(r))}),n.promise},this.getActiveInactive=function(i){var r=e.defer(),n={"@class":"com.napier.core.service.vo.deposits.DepositTypeVo",code:i.code,gnStatus:0==i.actStatus?2:1},l={};return l.url=t.HISDEPOSITSEARCH.URL,l.requestData={operation:"updateDeposityTypeStatus",messageId:"updateDeposityTypeStatus",destination:"com.napier.core.deposits.service.external.DepositsService",message:n},a.sendRestRequest(l).then(function(e){r.resolve(angular.copy(e.data.HITService.message))}),r.promise},this.getServiceGridActiveInactive=function(i){var r=e.defer(),n={"@class":"com.napier.core.service.vo.deposits.DepositeServiceMapVo",dtsaSeqId:i.dtsaSeqId,gnStatus:0==i.actStatus?2:1},l={};return l.url=t.HISDEPOSITSERVICEGRIDACTIVE.URL,l.requestData={operation:"setTariffClassActiveInactive",messageId:"",destination:"com.napier.core.deposits.service.external.DepositsService",message:n},a.sendRestRequest(l).then(function(e){r.resolve(angular.copy(e.data.HITService.message))}),r.promise},this.getEditServiceGridData=function(r){var n,l=e.defer();n={"@class":"com.napier.core.service.vo.deposits.DepositTypeVo",code:r};var s={};return s.url=t.HISDEPOSITSERVICEEDIT.URL,s.requestData={operation:"getServicesByDeposityType",messageId:"",destination:"com.napier.core.deposits.service.external.DepositsService",message:n},a.sendRestRequest(s).then(function(e){if(i=[],0==Object.keys(e.data.HITService.message).length){i.push({Department:"No Records Found",SubDepartment:"",ServiceCode:"",ServiceName:"",TariffClass:"",actionsFlag:!1,DepositAmount:""})}else{var t=e.data.HITService.message.depositeServiceMapVo[0]["com.napier.core.service.vo.deposits.DepositeServiceMapVo"];if(angular.isArray(t))_.forEach(t,function(e,t){var a={DEPARTMENT_CODE:e.deptCode,Department:e.deptCodeDesc,SUB_DEPT_CODE:e.subDeptCode,SubDepartment:e.subDeptCodeDesc,ServiceCode:e.serviceCode,ServiceName:e.serviceName,DepositAmount:e.depositAmt,ServiceSeqId:e.servSeqId,DtsaSeqId:e.dtsaSeqId,TariffClass:{id:e.bedClassCode,name:e.bedClassDesc},TariffCategoryName:e.tariffName,TariffCategoryCode:e.tariffCode,actionsFlag:!0,gnStatus:e.gnStatus,gnStatusDesc:e.gnStatusDesc,dtsaSeqId:e.dtsaSeqId,actStatus:1==e.gnStatus};i.push(a),a={}});else{var a={DEPARTMENT_CODE:t.deptCode,Department:t.deptCodeDesc,SUB_DEPT_CODE:t.subDeptCode,SubDepartment:t.subDeptCodeDesc,ServiceCode:t.serviceCode,ServiceName:t.serviceName,DepositAmount:t.depositAmt,ServiceSeqId:t.servSeqId,DtsaSeqId:t.dtsaSeqId,TariffClass:{id:t.bedClassCode,name:t.bedClassDesc},TariffCategoryName:t.tariffName,TariffCategoryCode:t.tariffCode,actionsFlag:!0,gnStatus:t.gnStatus,gnStatusDesc:t.gnStatusDesc,dtsaSeqId:t.dtsaSeqId,actStatus:1==t.gnStatus};i.push(a),a={}}}l.resolve(angular.copy(i))}),l.promise},this.cloneFromToShowGrid=function(r,l,s,o,c,d){var p,u=e.defer();p={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"MQ_TARIFF_CAT_FROM_CLONE_GRID",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:l},{ident:"2",value:l},{ident:"3",value:r||-999},{ident:"4",value:r||-999},{ident:"5",value:d},{ident:"6",value:d}]}]}]}]};var m={};return m.url=t.HISCOMBOFILLING.URL,m.requestData={operation:"ExecuteQuery",messageId:"",destination:"QueryService",message:p},a.sendRestRequest(m).then(function(e){var t=n(e);i=[],Array.isArray(t)&&angular.forEach(t,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={TariffCategoryCode:s,DEPARTMENT_CODE:a[2].data,Department:a[3].data,SUB_DEPT_CODE:a[4].data,SubDepartment:a[5].data,ServiceCode:a[7].data,ServiceSeqId:a[6].data,ServiceName:a[8].data,TariffClass:{id:a[9].data,name:a[10].data},DepositAmount:a[11].data,actionsFlag:!0,gnStatus:a[12].data,gnStatusDesc:"1"==a[12].data?"Active":"Inactive",actStatus:"1"==a[12].data,rcvSeqId:a[15].data};i.push(r)}),u.resolve(angular.copy(i))}),u.promise},this.addDetailsToServiceGrid=function(r,l,s,o,c,d,p){var u,m=e.defer();u={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"MQ_SERVICES",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:l},{ident:"2",value:s||""},{ident:"3",value:o||-999},{ident:"4",value:c||-999}]}]}]}]};var g={};return g.url=t.HISCOMBOFILLING.URL,g.requestData={operation:"ExecuteQuery",messageId:"",destination:"QueryService",message:u},a.sendRestRequest(g).then(function(e){i=[];var t=n(e);if(Array.isArray(t))angular.forEach(t,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],n={DEPARTMENT_CODE:a[3].data,Department:a[4].data,SUB_DEPT_CODE:a[5].data,SubDepartment:a[6].data,ServiceCode:a[0].data,ServiceName:a[2].data,DepositAmount:"0",ServiceSeqId:a[1].data,actionsFlag:!0,gnStatus:p,gnStatusDesc:"1"==p?"Active":"Inactive",actStatus:"1"==p};r&&(n.TariffCategoryCode=r.CODE,n.rcvSeqId=r.rcvSeqId,n.editable=!1),d?angular.forEach(d,function(e,t){var a=angular.copy(n);a.TariffClass=e,i.push(a)}):i.push(n)});else{var a=t.columnList[0]["com.napier.core.service.vo.query.Column"],l={DEPARTMENT_CODE:a[3].data,Department:a[4].data,SUB_DEPT_CODE:a[5].data,SubDepartment:a[6].data,ServiceCode:a[0].data,ServiceName:a[2].data,DepositAmount:"0",ServiceSeqId:a[1].data,actionsFlag:!0,gnStatus:p,gnStatusDesc:"1"==p?"Active":"Inactive",actStatus:"1"==p};r&&(l.TariffCategoryCode=r.CODE,l.rcvSeqId=r.rcvSeqId,l.editable=!1),d&&angular.forEach(d,function(e,t){var a=angular.copy(l);a.TariffClass=e,i.push(a)})}m.resolve(angular.copy(i))}),m.promise},this.saveDepositMastersForm=function(i){var r=e.defer(),n={};if(2!=i.servicetype)n={"@class":"com.napier.core.service.vo.deposits.DepositTypeVo",depositName:i.depositName,description:i.description,gnApplicableTo:i.servicetype,gnFlow:i.availableto,gnStatus:i.typeStatus,remarks:i.remarks,facilityList:[{"com.napier.core.service.vo.deposits.DepositTypeFacilityLinkVo":{facilityId:i.facility,gnStatus:i.typeStatus}}]};else if(2==i.servicetype){var l=[];angular.forEach(i.formGridOptions.data,function(e,t){var a={tariffCode:e.TariffCategoryCode,bedClassCode:e.TariffClass.id,depositAmt:""==e.DepositAmount?0:e.DepositAmount,rcvSeqId:e.rcvSeqId,servSeqId:e.ServiceSeqId,gnStatus:e.gnStatus};l.push(a)}),n={"@class":"com.napier.core.service.vo.deposits.DepositTypeVo",depositName:i.depositName,description:i.description,gnApplicableTo:i.servicetype,gnFlow:i.availableto,gnStatus:i.typeStatus,remarks:i.remarks,facilityList:[{"com.napier.core.service.vo.deposits.DepositTypeFacilityLinkVo":{facilityId:i.facility,gnStatus:i.typeStatus}}],depositeServiceMapVo:[{"com.napier.core.service.vo.deposits.DepositeServiceMapVo":l}]}}var s={};return s.url=t.HISDEPOSITHITSERVICE.URL,s.requestData={operation:"saveDeposityType",messageId:"",destination:"com.napier.core.deposits.service.external.DepositsService",message:n},a.sendRestRequest(s).then(function(e){null==e.data.HITService.message&&0==Object.keys(e.data.HITService.message).length?r.reject(e.data.HITService):r.resolve(e.data.HITService.message)},function(e){r.reject("")}),r.promise},this.editDepositMastersForm=function(i){var r=e.defer(),n={};if(2!=i.servicetype)n={"@class":"com.napier.core.service.vo.deposits.DepositTypeVo",code:i.code,depositName:i.depositName,description:i.description,gnApplicableTo:i.servicetype,gnFlow:i.availableto,gnStatus:i.typeStatus,remarks:i.remarks,facilityList:[{"com.napier.core.service.vo.deposits.DepositTypeFacilityLinkVo":{facilityId:i.facility,gnStatus:i.typeStatus}}]};else if(2==i.servicetype){var l=[];angular.forEach(i.formGridOptions.data,function(e,t){var a={dtsaSeqId:e.DtsaSeqId,tariffCode:e.TariffCategoryCode,servSeqId:e.ServiceSeqId,rcvSeqId:null==e.rcvSeqId?i.tariffCategoryForRCV[0].rcvSeqId:e.rcvSeqId,bedClassCode:e.TariffClass.id,depositAmt:""==e.DepositAmount?0:e.DepositAmount,gnStatus:e.gnStatus};l.push(a)}),n={"@class":"com.napier.core.service.vo.deposits.DepositTypeVo",code:i.code,depositName:i.depositName,description:i.description,gnApplicableTo:i.servicetype,gnFlow:i.availableto,gnStatus:i.typeStatus,remarks:i.remarks,facilityList:[{"com.napier.core.service.vo.deposits.DepositTypeFacilityLinkVo":{facilityId:i.facility,gnStatus:i.typeStatus}}],depositeServiceMapVo:[{"com.napier.core.service.vo.deposits.DepositeServiceMapVo":l}]}}var s={};return s.url=t.HISDEPOSITHITSERVICE.URL,s.requestData={operation:"updateDeposityType",messageId:"",destination:"com.napier.core.deposits.service.external.DepositsService",message:n},a.sendRestRequest(s).then(function(e){null==e.data.HITService.message&&0==Object.keys(e.data.HITService.message).length?r.reject(e.data.HITService):r.resolve(e.data.HITService.message)},function(e){r.reject("")}),r.promise},this.comboBoxFetch=function(i,r,l,s){var o=e.defer(),c={},d=i;if("MQ_TARIFF_CAT_FROM_CLONE"==d&&(c={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:d,idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:r},{ident:"2",value:r},{ident:"3",value:l},{ident:"4",value:l},{ident:"5",value:"1"},{ident:"6",value:"1"},{ident:"7",value:s},{ident:"8",value:s}]}]}]}]}),"MQ_FACILITY_USER_PERMITED"==d&&(c={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:d,idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:r},{ident:"2",value:r}]}]}]}]}),"MQ_DEPT"==d&&(c={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:d,idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:r},{ident:"2",value:r}]}]}]}]}),"MQ_SUB_DEPT"==d&&(c={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:d,idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:r},{ident:"2",value:r}]}]}]}]}),"MQ_SERVICES_COMBO"==d){[{ident:"1",value:r},{ident:"2",value:l},{ident:"3",value:s},{ident:"4",value:-999}],c={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"MQ_SERVICES_COMBO",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:r},{ident:"2",value:l},{ident:"3",value:s},{ident:"4",value:"-999"}]}]}]}]}}"MQ_BED_CLASS"==d&&(c={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"MQ_BED_CLASS",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:r},{ident:"2",value:r}]}]}]}]}),"TRN003"==d&&41002==r&&(c={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:d,idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:r},{ident:"2",value:r}]}]}]}]}),"TRN003"==d&&41003==r&&(c={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:d,idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:r},{ident:"2",value:r}]}]}]}]}),"MQ_TARIFF_CAT"==d&&(c={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:d,idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:r},{ident:"2",value:r},{ident:"3",value:s?-999:l||-999},{ident:"4",value:s?-999:l||-999},{ident:"5",value:s?-999:l||-999},{ident:"6",value:s?-999:l||-999}]}]}]}]});var p={};return p.url=t.HISCOMBOFILLING.URL,p.requestData={operation:"ExecuteQuery",destination:"QueryService",message:c},a.sendRestRequest(p).then(function(e){if("MQ_TARIFF_CAT_FROM_CLONE"==d){var t=[],a=n(e);angular.forEach(a,function(e,a){if(e&&""!=e){if(e.columnList)var i=e.columnList[0]["com.napier.core.service.vo.query.Column"];else i=e[0]["com.napier.core.service.vo.query.Column"];var r={CODE:i[0].data,DESCRIPTION:i[1].data};t.push(r)}}),o.resolve(t)}if("MQ_DEPT"==d){var i=[],l=n(e);angular.forEach(l,function(e,t){if(e&&""!=e){if(e.columnList)var a=e.columnList[0]["com.napier.core.service.vo.query.Column"];else a=e[0]["com.napier.core.service.vo.query.Column"];var r={CODE:a[0].data,DESCRIPTION:a[1].data};i.push(r)}}),o.resolve(i)}if("MQ_SERVICES_COMBO"==d){var s=[],c=n(e);angular.forEach(c,function(e,t){if(e&&""!=e){if(e.columnList)var a=e.columnList[0]["com.napier.core.service.vo.query.Column"];else a=e[0]["com.napier.core.service.vo.query.Column"];var i={id:a[1].data,name:a[2].data};s.push(i)}}),o.resolve(s)}if("MQ_BED_CLASS"==d){var p=[],u=n(e);angular.forEach(u,function(e,t){if(e&&""!=e){if(e.columnList)var a=e.columnList[0]["com.napier.core.service.vo.query.Column"];else a=e[0]["com.napier.core.service.vo.query.Column"];var i={id:a[0].data,name:a[1].data};p.push(i)}}),o.resolve(p)}if("MQ_SUB_DEPT"==d){var m=[],g=n(e);angular.forEach(g,function(e,t){if(e&&""!=e){if(e.columnList)var a=e.columnList[0]["com.napier.core.service.vo.query.Column"];else a=e[0]["com.napier.core.service.vo.query.Column"];var i={id:a[0].data,name:a[1].data};m.push(i)}}),o.resolve(m)}if("MQ_FACILITY_USER_PERMITED"==d){var S=[],v=n(e);if(angular.isArray(v))angular.forEach(v,function(e,t){if(e&&""!=e){if(e.columnList)var a=e.columnList[0]["com.napier.core.service.vo.query.Column"];else a=e[0]["com.napier.core.service.vo.query.Column"];var i={CODE:a[0].data,DESCRIPTION:a[1].data};S.push(i)}}),o.resolve(S);else{if(v&&""!=v){if(v.columnList)var D=v.columnList[0]["com.napier.core.service.vo.query.Column"];else D=v[0]["com.napier.core.service.vo.query.Column"];var y={CODE:D[0].data,DESCRIPTION:D[1].data};S.push(y)}o.resolve(S)}}if("MQ_TARIFF_CAT"==d){var f=[];u=n(e);angular.forEach(u,function(e,t){if(e&&""!=e){if(e.columnList)var a=e.columnList[0]["com.napier.core.service.vo.query.Column"];else a=e[0]["com.napier.core.service.vo.query.Column"];var i={CODE:a[0].data,DESCRIPTION:a[1].data,rcvSeqId:a[2].data};f.push(i)}}),o.resolve(f)}if("TRN003"==d&&41002==r){var C=[],I=n(e);angular.forEach(I,function(e,t){if(e&&""!=e){if(e.columnList)var a=e.columnList[0]["com.napier.core.service.vo.query.Column"];else a=e[0]["com.napier.core.service.vo.query.Column"];var i={CODE:a[0].data,DESCRIPTION:a[1].data};C.push(i)}}),o.resolve(C)}if("TRN003"==d&&41003==r){var A=[],E=n(e);angular.forEach(E,function(e,t){if(e&&""!=e){if(e.columnList)var a=e.columnList[0]["com.napier.core.service.vo.query.Column"];else a=e[0]["com.napier.core.service.vo.query.Column"];var i={CODE:a[0].data,DESCRIPTION:a[1].data};A.push(i)}}),o.resolve(A)}}),o.promise}}e.$inject=["$q","BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("angdepositMastersService",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){var S=this;m.loadModule("billing");var v=g.getLanguageToSet();function D(t){var a;S.showPatientBanner=!0,S.selectedadmitpat=t;let i={regSeqId:S.selectedadmitpat[0].RG_SEQ_ID?S.selectedadmitpat[0].RG_SEQ_ID:S.selectedadmitpat[0].regSeqId,admissionSeqid:S.selectedadmitpat[0].admissionSeqid?S.selectedadmitpat[0].admissionSeqid:S.selectedadmitpat[0].IPADM_SEQ_ID};e.rgSeqId=S.selectedadmitpat[0].RG_SEQ_ID?S.selectedadmitpat[0].RG_SEQ_ID:S.selectedadmitpat[0].regSeqId,a=null==i.admissionSeqid?"2":"1",s.getPatientBanner(i,a).then(function(t){e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=1,e.accSeqId=t.accSeqId,e.mrNo=t.mrNo,e.regSeqId=i.regSeqId,e.subAccSeqId=t.subAccSeqId,e.ischeckDepositAs=1,3==S.depositAs&&y(t.accSeqId),1==S.depositAs&&(y(t.accSeqId),function(e,t){S.demonadnote=[],S.demandNoteNo={1:S.demonadnote};var a=c.executeQueryURLReset(),i=new Array;c.prepareParamListWithParam("pPracticeId",S.contextInfo.CLIENT_REF_ID,i),c.prepareParamListWithParam("pFacilityId",S.contextInfo.FACILITY_ID,i),c.prepareParamListWithParam("pAccSeqId",e,i),c.prepareParamListWithParam("pRgSeqId",t,i),c.executeQueryInput("DEPOSIT_AND_DEMAND_NOTE",i,S.demandNoteNo,!0,!0,a,"popUp",{}).then(function(e){S.demandNoteNo=e[1],S.addDepoReqObj.demandNoteno=S.demandNoteNo[0].DEMAND_NOTE_NO,S.addDepoReqObj.depoAmnt=S.demandNoteNo[0].DEMAND_NOTE_AMT})}(t.accSeqId,i.regSeqId))}),o.patientBannerDetail(i.regSeqId).then(function(t){e.patientBannerDetails=t,e.patFirstName=e.patientBannerDetails.patientRecordsDetail.firstName,e.patMiddleName=e.patientBannerDetails.patientRecordsDetail.middleName,e.patLastName=e.patientBannerDetails.patientRecordsDetail.lastName,e.refSeqId=e.patientBannerDetails.patientReferral.refSeqId})}function y(e){var t={"@class":"com.napier.core.service.vo.deposits.DepositsVo",accSeqId:e};d.getDepositAmount(t).then(function(e){if(""!==e.data.HITService.message.deposits[0])if(e.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"].length>0){for(var t=e.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"],a=0,i=0;i<t.length;i++)a+=t[i].availableAmount;S.addDepoReqObj.outDepo=a}else{var r=e.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"].availableAmount;S.addDepoReqObj.outDepo=r}})}m.changeLanguage(v),S.contextInfo=JSON.parse(sessionStorage.getItem("userContextObj")),S.addDepoReqObj={},S.showPatientBanner=!1,function(){S.depsitype=[],S.depsitypeList={1:S.depsitype};var e=c.executeQueryURLReset(),t=new Array;c.prepareParamListWithParam("pPracticeId",S.contextInfo.CLIENT_REF_ID,t),c.prepareParamListWithParam("pStatus",-999,t),c.prepareParamListWithParam("pDepositTypeName","",t),c.prepareParamListWithParam("pFlow",-999,t),c.prepareParamListWithParam("pApplicableTo",-999,t),c.prepareParamListWithParam("pFacilityId",S.contextInfo.FACILITY_ID,t),c.executeQueryInput("ANSC_DEPOSIT_TYPE_001",t,S.depsitypeList,!0,!0,e,"popUp",{}).then(function(e){S.depsitypeList=e[1]})}(),S.isoutDepositdisabled=!0,S.isDemandNoteNodisabled=!0,S.isAmntDepositdisabled=!1,e.ischeckDepositAs=0,S.typegeneralpatSearch=function(e){return r.paitentAutoSearchWithOutStatus(e).then(function(e){if(e){return(e instanceof Array?e:[e]).map(function(e){return e})}})},S.typeSearch=function(e){if(e.length>2){var t=[{ident:"1",value:e},{ident:"2",value:e},{ident:"3",value:e},{ident:"4",value:e},{ident:"5",value:e},{ident:"6",value:e},{ident:"7",value:e},{ident:"8",value:e},{ident:"9",value:e},{ident:"10",value:e}];return i.getList("ADT_IP_SEARCH",t).then(function(e){S.typeSearchList=[];var t=n.getQryComboList(e);return angular.forEach(t,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={PATIENT_NAME:a[0].data,IP_NO:a[1].data,RG_INT_MR_NO:a[2].data,AGE:a[3].data,DOB:a[4].data,RG_MOBILE_NO:a[5].data,GENDER:a[6].data,IPADM_SEQ_ID:a[7].data,ADMISSION_STATUS:a[8].data,RG_SEQ_ID:a[9].data};S.typeSearchList.push(i)}),(S.typeSearchList instanceof Array?S.typeSearchList:[S.typeSearchList]).map(function(e){return e})})}},S.patientSearchModalpopUp=function(e,t){l.open("IP PATIENT SEARCH",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/depositRequests/partials/deposit.request.patient.search.modal.html",size:t,controller:"deporeqpatientSearchCtrl",controllerAs:"PatSearchCtrl"}).result.then(function(e){S.searchByAdmittedpatient=e[0].RG_INT_MR_NO,D(e)})},S.onSelectregPat=function(e,t,a){D([t]),S.searchByAdmittedpatient=t.RG_INT_MR_NO},S.onSelectgeneralpatSearch=function(e,t,a){t.RG_SEQ_ID=t.rgSeqId,D([t]),S.searchByGeneralpatient=t.uhId?t.uhId:t.mrNo},S.generalpatientSearchModalpopUp=function(e,t){l.open("PATIENT SEARCH",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/depositRequests/partials/depreq.patient.search.modal.html",size:t,controller:"generalDepreqpatientSearchCtrl",controllerAs:"GenSearchCtrl"}).result.then(function(e){S.searchByGeneralpatient=e[0].INT_MR_NO,e[0].RG_SEQ_ID=e[0].PAT_SEQ_ID,D(e)})},S.clear=function(){S.addDepoReqObj={},S.showPatientBanner=!1,e.ischeckDepositAs=0,S.searchByGeneralpatient="",S.searchByAdmittedpatient=""},S.checkDepositType=function(e){3==e&&(S.isAmntDepositdisabled=!1),1==e&&(S.isAmntDepositdisabled=!0),S.clear()},S.save=function(){if(null==S.addDepoReqObj.depoType.DEPOSIT_TYPE_CODE||null==S.addDepoReqObj.depoAmnt||""==S.addDepoReqObj.depoType.DEPOSIT_TYPE_CODE||""==S.addDepoReqObj.depoAmnt)p.warning("Warning","Please Fill Mandatory Fields",!1,!1,u.time);else{var t=0;if(1==S.depositAs?null==S.searchByAdmittedpatient||""==S.searchByAdmittedpatient?(p.warning("Warning","Please Enter Patient ID",!1,!1,u.time),t=0):t=1:3==S.depositAs&&(null==S.searchByGeneralpatient||""==S.searchByGeneralpatient?(p.warning("Warning","Please Enter Patient ID",!1,!1,u.time),t=0):t=1),1==t){var i={"@class":"com.napier.core.service.vo.deposits.DepositsVo",accSeqId:e.accSeqId,gnDepositStatus:0,depositAmount:S.addDepoReqObj.depoAmnt,depositTypeCode:S.addDepoReqObj.depoType.DEPOSIT_TYPE_CODE,colReqTypeFlow:S.addDepoReqObj.depoType.FLOW_CODE,adjustAmount:0,facilityId:S.contextInfo.FACILITY_ID,gnTranStatus:1,subAccSeqId:e.subAccSeqId,depositAgainst:S.depositAs,refSeqId:e.refSeqId,mrNo:e.mrNo,rgSeqId:e.rgSeqId,patFirstName:e.patFirstName,patMiddleName:e.patMiddleName,patLastName:e.patLastName,billDepositReasonsList:[{"com.napier.core.service.vo.deposits.DepositsReasonVo":[{depositReason:"",gnDepositStatus:0,depositTranType:0}]}]};d.saveDepositReq(i).then(function(e){void 0!==e.data.HITService.message.depositNo?(p.success("Success","Saved Sucessfully",!1,!1,u.time),a.close()):p.warning("Warning",e.data.HITService.message.errorMessage,!1,!1,u.time)})}}}}e.$inject=["$scope","hisCalDefConstant","$uibModalInstance","dropdownQueryService","PatientGlobal","otComService","hisModalService","PatientBannerGlobal","PatientBannerBilling","QueryService","depositRequestService","hisAlertService","hisAlertConstants","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("addDepoReqModalCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){var S=this;m.loadModule("billing");var v,D=g.getLanguageToSet();m.changeLanguage(D),S.contextInfo=JSON.parse(sessionStorage.getItem("userContextObj")),S.canwbDepoReqObj=u.editedPat,S.pageMode=u.pageMode,S.newreqObj={},S.depositAgainst=S.canwbDepoReqObj.depositAgainst,S.pageMode=u.pageMode,S.showPatientBanner=!1,v={"@class":"com.napier.core.service.vo.deposits.DepositsVo",depositAgainst:S.canwbDepoReqObj.depositAgainst,depositSeqId:S.canwbDepoReqObj.depositSeqId,gnDepositStatus:S.canwbDepoReqObj.gnDepositStatus,gnTranStatus:1,isBillDepositAdj:S.canwbDepoReqObj.isBillDepositAdj,refSeqId:S.canwbDepoReqObj.refSeqId},c.getdepositbyId(v).then(function(e){if(""!==e.data.HITService.message){var t=e.data.HITService.message.depositTypeCode;S.canwbDepoReqObj.depositTypeCode=t;var a=e.data.HITService.message.depositAmount;S.newreqObj.depositAmount=a,"cancel"==u.pageMode||"writeback"==u.pageMode?S.canwbDepoReqObj.reason="":S.canwbDepoReqObj.reason=e.data.HITService.message.depositReason}}),function(){S.depsitype=[],S.depsitypeList={1:S.depsitype};var e=o.executeQueryURLReset(),t=new Array;o.prepareParamListWithParam("pPracticeId",S.contextInfo.CLIENT_REF_ID,t),o.prepareParamListWithParam("pStatus",-999,t),o.prepareParamListWithParam("pDepositTypeName","",t),o.prepareParamListWithParam("pFlow",-999,t),o.prepareParamListWithParam("pApplicableTo",-999,t),o.prepareParamListWithParam("pFacilityId",S.contextInfo.FACILITY_ID,t),o.executeQueryInput("ANSC_DEPOSIT_TYPE_001",t,S.depsitypeList,!0,!0,e,"popUp",{}).then(function(e){S.depsitypeList=e[1]})}(),S.reasonforCancel=!1,S.reasonforWriteback=!1,"cancel"==u.pageMode&&(S.isCancel=!0,S.iswriteback=!1,S.canwbDepoReqObj.reason="",S.reasonforCancel=!0),"writeback"==u.pageMode&&(S.isCancel=!1,S.iswriteback=!0,S.canwbDepoReqObj.reason="",S.reasonforWriteback=!0),"view"==S.pageMode&&(S.isEdit=!1,S.isReasonEnable=!0),function(t){var a;S.showPatientBanner=!0,S.selectedadmitpat=t;let i={regSeqId:S.selectedadmitpat[0].RG_SEQ_ID,admissionSeqid:S.selectedadmitpat[0].IPADM_SEQ_ID};a=null==i.admissionSeqid?"2":"1",l.getPatientBanner(i,a).then(function(t){var a,r;e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=1,e.accSeqId=t.accSeqId,e.regSeqId=i.regSeqId,e.subAccSeqId=t.subAccSeqId,a=e.accSeqId,r={"@class":"com.napier.core.service.vo.deposits.DepositsVo",accSeqId:a},c.getDepositAmount(r).then(function(e){""!==e.data.HITService.message.deposits[0]&&e.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"].depositTypeCode}),function(e,t){S.demonadnote=[],S.demandNoteNo={1:S.demonadnote};var a=o.executeQueryURLReset(),i=new Array;o.prepareParamListWithParam("pPracticeId",S.contextInfo.CLIENT_REF_ID,i),o.prepareParamListWithParam("pFacilityId",S.contextInfo.FACILITY_ID,i),o.prepareParamListWithParam("pAccSeqId",e,i),o.prepareParamListWithParam("pRgSeqId",t,i),o.executeQueryInput("DEPOSIT_AND_DEMAND_NOTE",i,S.demandNoteNo,!0,!0,a,"popUp",{}).then(function(e){S.demandNoteNo=e[1],S.canwbDepoReqObj.demandNoteno=S.demandNoteNo[0].DEMAND_NOTE_NO})}(e.accSeqId,e.regSeqId)}),s.patientBannerDetail(i.regSeqId).then(function(t){e.patientBannerDetails=t,e.refSeqId=e.patientBannerDetails.patientReferral.refSeqId})}([{RG_SEQ_ID:u.editedPat.rgSeqId,IPADM_SEQ_ID:u.editedPat.ipAdmnSeqId}]),S.cancel=function(){if(null==S.canwbDepoReqObj.reason||""==S.canwbDepoReqObj.reason)d.warning("Warning","Please enter Reason for cancel",!1,!1,p.time);else if(null==S.canwbDepoReqObj.depositNo||""==S.canwbDepoReqObj.depositNo||null==S.canwbDepoReqObj.depositTypeCode||""==S.canwbDepoReqObj.depositTypeCode||null==S.newreqObj.depositAmount||""==S.newreqObj.depositAmount)d.warning("Warning","Please Fill Mandatory Fields",!1,!1,p.time);else{var e={"@class":"com.napier.core.service.vo.deposits.DepositsVo",depositSeqId:S.canwbDepoReqObj.depositSeqId,depositAmount:S.newreqObj.depositAmount,depositTypeCode:S.canwbDepoReqObj.depositTypeCode,facilityId:S.contextInfo.FACILITY_ID,gnDepositStatus:S.canwbDepoReqObj.gnDepositStatus,gnTranStatus:1,isBillDepositAdj:S.canwbDepoReqObj.isBillDepositAdj,practiceId:S.contextInfo.CLIENT_REF_ID,billDepositReasonsList:[{"com.napier.core.service.vo.deposits.DepositsReasonVo":[{depositReason:S.canwbDepoReqObj.reason,depositRsnSeqId:S.canwbDepoReqObj.reasonSeqId,gnDepositStatus:S.canwbDepoReqObj.gnDepositStatus,depositTranType:0,gnTranStatus:0}]}]};c.cancelDepositReq(e).then(function(e){void 0!==e.data.HITService.message.depositSeqId&&(d.success("Success","Cancel Sucessfully",!1,!1,p.time),a.close())})}},S.writeback=function(){if(null==S.canwbDepoReqObj.reason||""==S.canwbDepoReqObj.reason)d.warning("Warning","Please enter Reason",!1,!1,p.time);else if(null==S.canwbDepoReqObj.depositNo||""==S.canwbDepoReqObj.depositNo||null==S.canwbDepoReqObj.depositTypeCode||""==S.canwbDepoReqObj.depositTypeCode||null==S.newreqObj.depositAmount||""==S.newreqObj.depositAmount)d.warning("Warning","Please Fill Mandatory Fields",!1,!1,p.time);else{var e={"@class":"com.napier.core.service.vo.deposits.DepositsVo",depositSeqId:S.canwbDepoReqObj.depositSeqId,depositAmount:S.canwbDepoReqObj.depositAmount,depositTypeCode:S.canwbDepoReqObj.depositTypeCode,facilityId:S.contextInfo.FACILITY_ID,gnDepositStatus:S.canwbDepoReqObj.gnDepositStatus,gnTranStatus:1,isBillDepositAdj:S.canwbDepoReqObj.isBillDepositAdj,practiceId:S.contextInfo.CLIENT_REF_ID,billDepositReasonsList:[{"com.napier.core.service.vo.deposits.DepositsReasonVo":[{depositReason:S.canwbDepoReqObj.reason,depositRsnSeqId:S.canwbDepoReqObj.reasonSeqId,gnDepositStatus:S.canwbDepoReqObj.gnDepositStatus,depositTranType:0,gnTranStatus:0}]}]};c.writeBackDepositReq(e).then(function(e){void 0!==e.data.HITService.message.depositSeqId&&(d.success("Success","Writeback Sucessfully",!1,!1,p.time),a.close())})}},S.close=function(){a.close()}}e.$inject=["$scope","hisCalDefConstant","$uibModalInstance","dropdownQueryService","otComService","hisModalService","PatientBannerGlobal","PatientBannerBilling","QueryService","depositRequestService","hisAlertService","hisAlertConstants","patObj","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("cancelWritebackDepoReqModalCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l){var s=this;n.loadModule("adt");var o=l.getLanguageToSet();n.changeLanguage(o);var c=angular.copy(a).dateOnly.format;s.admittedpatientgridOpts=angular.copy(i),s.optionsnewBornDOB={format:c},s.gendercomboList=[],e.getList("MQ0002",[{ident:"1",value:"A"},{ident:"2",value:"A"},{ident:"3",value:"A"}]).then(function(e){s.gendercomboList=[];var a=t.getQryComboList(e);angular.forEach(a,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={CODE:a[0].data,DESCRIPTION:a[1].data};s.gendercomboList.push(i)})}),s.regtypecomboList=[],e.getList("TRN003",[{paramName:"pMasterSqId",value:"6"}]).then(function(e){s.regtypecomboList=[];var a=t.getQryComboList(e);angular.forEach(a,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={DT_CODE:a[0].data,DETAIL_DESC:a[1].data};s.regtypecomboList.push(i)})}),s.payercomboList=[],e.getList("NH_ADT_PAYER_TYPE_DROPDOWN",[]).then(function(e){s.payercomboList=[];var a=t.getQryComboList(e);angular.forEach(a,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={DT_CODE:a[0].data,DETAIL_DESC:a[1].data};s.payercomboList.push(i)})}),s.srhObj={pname:"",mrno:"",gender:"",dob:"",mobile:"",regtype:"",payer:"",ipno:"",QueryId:""},s.srhClear=function(){s.srhObj={pname:"",mrno:"",gender:"",dob:"",mobile:"",regtype:"",payer:"",ipno:"",QueryId:""},s.admittedpatientgridOpts.data=[]},s.srhResult=function(){if(""!=s.srhObj.QueryId&&null!=s.srhObj.QueryId)var a="ADT_GET_CURRENT_OCCUPIED_PATIENT";else a="ADT_GET_CURRENT_ADMITTED_PATIENT";var i=[{ident:"1",value:""!==s.srhObj.pname?s.srhObj.pname:""},{ident:"2",value:""!==s.srhObj.pname?s.srhObj.pname:""},{ident:"3",value:""!==s.srhObj.pname?s.srhObj.pname:""},{ident:"4",value:""!==s.srhObj.pname?s.srhObj.pname:""},{ident:"5",value:""!==s.srhObj.mrno?s.srhObj.mrno:""},{ident:"6",value:""!==s.srhObj.mrno?s.srhObj.mrno:""},{ident:"7",value:""!==s.srhObj.mobile?s.srhObj.mobile:""},{ident:"8",value:""!==s.srhObj.mobile?s.srhObj.mobile:""},{ident:"9",value:""!==s.srhObj.regtype?s.srhObj.regtype:""},{ident:"10",value:""!==s.srhObj.regtype?s.srhObj.regtype:""},{ident:"11",value:""!==s.srhObj.dob?moment(s.srhObj.dob).format("YYYY-MM-DD"):""},{ident:"12",value:""!==s.srhObj.dob?moment(s.srhObj.dob).format("YYYY-MM-DD"):""},{ident:"13",value:""!==s.srhObj.payer?s.srhObj.payer:-999},{ident:"14",value:""!==s.srhObj.payer?s.srhObj.payer:-999},{ident:"15",value:""!==s.srhObj.gender?s.srhObj.gender:""},{ident:"16",value:""!==s.srhObj.gender?s.srhObj.gender:""},{ident:"17",value:""!==s.srhObj.ipno?s.srhObj.ipno:""},{ident:"18",value:""!==s.srhObj.ipno?s.srhObj.ipno:""}];e.getList(a,i).then(function(e){s.motherList=[];var a=t.getQryComboList(e);if(angular.forEach(a,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={PATIENT_NAME:a[0].data,IP_NO:a[1].data,RG_INT_MR_NO:a[2].data,AGE:a[3].data,DOB:a[4].data,RG_MOBILE_NO:a[5].data,GENDER:a[6].data,IPADM_SEQ_ID:a[7].data,ADMISSION_STATUS:a[8].data,RG_SEQ_ID:a[9].data};s.motherList.push(i)}),0==a.length){s.motherList.push({PATIENT_NAME:"No Records Found"})}s.admittedpatientgridOpts.data=s.motherList})},s.admittedpatientgridOpts.onRegisterApi=function(e){s.gridApipatmot=e,e.selection.on.rowSelectionChanged(s,function(e){e.isSelected})},s.addSelectedpat=function(){s.rowsSelected=s.gridApipatmot.selection.getSelectedRows(),0!=s.rowsSelected.length&&("No Records Found"==s.rowsSelected[0].PATIENT_NAME?s.rowsSelected=[]:r.close(s.rowsSelected))},s.initsearch=function(){""==s.srhObj.pname&&""==s.srhObj.ipno||s.srhResult()},s.initsearch()}e.$inject=["dropdownQueryService","otComService","hisCalDefConstant","newBornGridDef","$uibModalInstance","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("deporeqpatientSearchCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s){var o=this;n.loadModule("adt");var c=l.getLanguageToSet();n.changeLanguage(c);var d=angular.copy(a).dateOnly.format;o.depreqGeneralpatientgridOpts=angular.copy(i),o.optionsnewBornDOB={format:d},o.gendercomboList=[],e.getList("MQ0002",[{ident:"1",value:"A"},{ident:"2",value:"A"},{ident:"3",value:"A"}]).then(function(e){o.gendercomboList=[];var a=t.getQryComboList(e);angular.forEach(a,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={CODE:a[0].data,DESCRIPTION:a[1].data};o.gendercomboList.push(i)})}),o.regtypecomboList=[],e.getList("TRN003",[{paramName:"pMasterSqId",value:"6"}]).then(function(e){o.regtypecomboList=[];var a=t.getQryComboList(e);angular.forEach(a,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={DT_CODE:a[0].data,DETAIL_DESC:a[1].data};o.regtypecomboList.push(i)})}),o.payercomboList=[],e.getList("TRN003",[{paramName:"pMasterSqId",value:"901"}]).then(function(e){o.payercomboList=[];var a=t.getQryComboList(e);angular.forEach(a,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={DT_CODE:a[0].data,DETAIL_DESC:a[1].data};o.payercomboList.push(i)})}),o.srhObj={pname:"",mrno:"",gender:"",dob:"",mobile:"",regtype:"",payer:"",QueryId:""},o.srhClear=function(){o.srhObj={pname:"",mrno:"",gender:"",dob:"",mobile:"",regtype:"",payer:"",QueryId:""},o.depreqGeneralpatientgridOpts.data=[]},o.srhResult=function(){o.srhList=[],o.gridSearchList={1:o.srhList};var e=s.executeQueryURLReset(),t=new Array;return s.prepareParamListWithParam("pFirstName",""!==o.srhObj.pname?o.srhObj.pname:"",t),s.prepareParamListWithParam("pMRNo",""!==o.srhObj.mrno?o.srhObj.mrno:"",t),s.prepareParamListWithParam("pGender",""!==o.srhObj.gender?o.srhObj.gender:"",t),s.prepareParamListWithParam("pDOB",""!==o.srhObj.dob?moment(o.srhObj.dob).format("YYYY-MM-DD"):"",t),s.prepareParamListWithParam("pMobileNo",""!==o.srhObj.mobile?o.srhObj.mobile:"",t),s.prepareParamListWithParam("pRegType",""!==o.srhObj.regtype?o.srhObj.regtype:"",t),s.prepareParamListWithParam("pRegPayerType",""!==o.srhObj.payer?o.srhObj.payer:"",t),s.executeQueryInput("ADV_REG_PAT_SER_PID_01",t,o.gridSearchList,!0,!0,e,"popUp",{}).then(function(e){var t=Array.isArray(e[1])?e[1]:[e[1]];o.depreqGeneralpatientgridOpts.data=t})},o.depreqGeneralpatientgridOpts.onRegisterApi=function(e){o.gridApipatmot=e,e.selection.on.rowSelectionChanged(o,function(e){e.isSelected})},o.addSelectedpat=function(){o.rowsSelected=o.gridApipatmot.selection.getSelectedRows(),0!=o.rowsSelected.length&&("No Records Found"==o.rowsSelected[0].PATIENT_NAME?o.rowsSelected=[]:r.close(o.rowsSelected))},o.initsearch=function(){""==o.srhObj.pname&&""==o.srhObj.ipno||o.srhResult()},o.initsearch()}e.$inject=["dropdownQueryService","otComService","hisCalDefConstant","depReqGeneralPatSearchGridDefn","$uibModalInstance","hisTranslationsService","hisTranslationsGlobalLang","QueryService"],angular.module("napierContainerUi").controller("generalDepreqpatientSearchCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){var S=this;m.loadModule("billing");var v,D=g.getLanguageToSet();m.changeLanguage(D),S.contextInfo=JSON.parse(sessionStorage.getItem("userContextObj")),S.editDepoReqObj=u.editedPat,S.newreqObj={},S.showPatientBanner=!1,S.pageMode=u.pageMode,S.depositAgainst=u.editedPat.depositAgainst,function(){S.depsitype=[],S.depsitypeList={1:S.depsitype};var e=o.executeQueryURLReset(),t=new Array;o.prepareParamListWithParam("pPracticeId",S.contextInfo.CLIENT_REF_ID,t),o.prepareParamListWithParam("pStatus",-999,t),o.prepareParamListWithParam("pDepositTypeName","",t),o.prepareParamListWithParam("pFlow",-999,t),o.prepareParamListWithParam("pApplicableTo",-999,t),o.prepareParamListWithParam("pFacilityId",S.contextInfo.FACILITY_ID,t),o.executeQueryInput("ANSC_DEPOSIT_TYPE_001",t,S.depsitypeList,!0,!0,e,"popUp",{}).then(function(e){S.depsitypeList=e[1]})}(),v={"@class":"com.napier.core.service.vo.deposits.DepositsVo",depositAgainst:S.editDepoReqObj.depositAgainst,depositSeqId:S.editDepoReqObj.depositSeqId,gnDepositStatus:S.editDepoReqObj.gnDepositStatus,gnTranStatus:1,isBillDepositAdj:S.editDepoReqObj.isBillDepositAdj,refSeqId:S.editDepoReqObj.refSeqId},c.getdepositbyId(v).then(function(e){if(""!==e.data.HITService.message){var t=e.data.HITService.message.depositTypeCode;S.editDepoReqObj.depositTypeCode=t;var a=e.data.HITService.message.depositAmount;S.newreqObj.depositAmount=a,e.data.HITService.message.depositReason&&(S.editDepoReqObj.reason=e.data.HITService.message.depositReason)}}),"view"==u.pageMode&&(S.isEdit=!1,S.isReasonEnable=!0,S.isAmntDepositdisabled=!0),"edit"==u.pageMode&&(S.isEdit=!0,S.isReasonEnable=!1,S.isAmntDepositdisabled=!1),S.isoutDepositdisabled=!0,S.isDemandNoteNodisabled=!0,function(t){var a;S.showPatientBanner=!0,S.selectedadmitpat=t;let i={regSeqId:S.selectedadmitpat[0].RG_SEQ_ID,admissionSeqid:S.selectedadmitpat[0].IPADM_SEQ_ID};a=null==i.admissionSeqid?"2":"1",l.getPatientBanner(i,a).then(function(t){var a,r;e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=1,e.accSeqId=t.accSeqId,e.regSeqId=i.regSeqId,e.subAccSeqId=t.subAccSeqId,a=e.accSeqId,r={"@class":"com.napier.core.service.vo.deposits.DepositsVo",accSeqId:a},c.getDepositAmount(r).then(function(e){""!==e.data.HITService.message.deposits[0]&&e.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"].depositTypeCode}),function(e,t){S.demonadnote=[],S.demandNoteNo={1:S.demonadnote};var a=o.executeQueryURLReset(),i=new Array;o.prepareParamListWithParam("pPracticeId",S.contextInfo.CLIENT_REF_ID,i),o.prepareParamListWithParam("pFacilityId",S.contextInfo.FACILITY_ID,i),o.prepareParamListWithParam("pAccSeqId",e,i),o.prepareParamListWithParam("pRgSeqId",t,i),o.executeQueryInput("DEPOSIT_AND_DEMAND_NOTE",i,S.demandNoteNo,!0,!0,a,"popUp",{}).then(function(e){S.demandNoteNo=e[1],S.editDepoReqObj.demandNoteno=S.demandNoteNo[0].DEMAND_NOTE_NO})}(e.accSeqId,e.regSeqId)}),s.patientBannerDetail(i.regSeqId).then(function(t){e.patientBannerDetails=t,e.refSeqId=e.patientBannerDetails.patientReferral.refSeqId})}([{RG_SEQ_ID:u.editedPat.rgSeqId,IPADM_SEQ_ID:u.editedPat.ipAdmnSeqId}]),S.update=function(){if(null==S.newreqObj.depositAmount||""==S.newreqObj.depositAmount)d.warning("Warning","Please enter Amount to be deposit",!1,!1,p.time);else if(null==S.editDepoReqObj.reason||""==S.editDepoReqObj.reason)d.warning("Warning","Please enter Reason",!1,!1,p.time);else if(null==S.editDepoReqObj.depositNo||null==S.editDepoReqObj.depositTypeCode||null==S.editDepoReqObj.gnDepositStatusDesc||""==S.editDepoReqObj.depositNo||""==S.editDepoReqObj.depositTypeCode||""==S.editDepoReqObj.gnDepositStatusDesc)d.warning("Warning","Please Fill Mandatory Fields",!1,!1,p.time);else{var e={"@class":"com.napier.core.service.vo.deposits.DepositsVo",depositNo:S.editDepoReqObj.depositNo,depositSeqId:S.editDepoReqObj.depositSeqId,depositAmount:S.newreqObj.depositAmount,gnDepositStatus:S.editDepoReqObj.gnDepositStatus,depositTypeCode:S.editDepoReqObj.depositTypeCode,facilityId:S.contextInfo.FACILITY_ID,gnTranStatus:1,isBillDepositAdj:S.editDepoReqObj.isBillDepositAdj,practiceId:S.contextInfo.CLIENT_REF_ID,billDepositReasonsList:[{"com.napier.core.service.vo.deposits.DepositsReasonVo":[{depositReason:S.editDepoReqObj.reason,depositRsnSeqId:S.editDepoReqObj.reasonSeqId,gnDepositStatus:S.editDepoReqObj.gnDepositStatus,depositTranType:0,gnTranStatus:0}]}]};c.updateDepositReq(e).then(function(e){void 0!==e.data.HITService.message.depositNo&&(d.success("Success","Updated Sucessfully",!1,!1,p.time),a.close())})}},S.close=function(){a.close()}}e.$inject=["$scope","hisCalDefConstant","$uibModalInstance","dropdownQueryService","otComService","hisModalService","PatientBannerGlobal","PatientBannerBilling","QueryService","depositRequestService","hisAlertService","hisAlertConstants","patObj","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("editDepoReqModalCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){var S=this;m.loadModule("billing");var v,D=g.getLanguageToSet();m.changeLanguage(D),S.contextInfo=JSON.parse(sessionStorage.getItem("userContextObj")),S.refreqReqObj=u.editedPat,S.refreqReqObj.availableAmount=u.editedPat.depositAvailableAmt,S.pageMode=u.pageMode,S.newreqObj={},S.depositAgainst=S.refreqReqObj.depositAgainst,console.log("refreqCtrl.refreqReqObj",S.refreqReqObj),S.showPatientBanner=!1,v={"@class":"com.napier.core.service.vo.deposits.DepositsVo",depositAgainst:S.refreqReqObj.depositAgainst,depositSeqId:S.refreqReqObj.depositSeqId,gnDepositStatus:S.refreqReqObj.gnDepositStatus,gnTranStatus:1,isBillDepositAdj:S.refreqReqObj.isBillDepositAdj,refSeqId:S.refreqReqObj.refSeqId},c.getdepositbyId(v).then(function(e){if(""!==e.data.HITService.message){var t=e.data.HITService.message.depositTypeCode;S.refreqReqObj.depositTypeCode=t;var a=e.data.HITService.message.depositRefundList[0]["com.napier.core.service.vo.deposits.DepositRefundVo"].depRefundAmount;e.data.HITService.message.depositAmount,"view"==S.pageMode?(S.refreqReqObj.reason=e.data.HITService.message.depositReason,S.refreqReqObj.refAmount=a):S.refreqReqObj.reason=""}}),function(){S.depsitype=[],S.depsitypeList={1:S.depsitype};var e=o.executeQueryURLReset(),t=new Array;o.prepareParamListWithParam("pPracticeId",S.contextInfo.CLIENT_REF_ID,t),o.prepareParamListWithParam("pStatus",-999,t),o.prepareParamListWithParam("pDepositTypeName","",t),o.prepareParamListWithParam("pFlow",-999,t),o.prepareParamListWithParam("pApplicableTo",-999,t),o.prepareParamListWithParam("pFacilityId",S.contextInfo.FACILITY_ID,t),o.executeQueryInput("ANSC_DEPOSIT_TYPE_001",t,S.depsitypeList,!0,!0,e,"popUp",{}).then(function(e){S.depsitypeList=e[1]})}(),"view"==S.pageMode&&(S.isEdit=!1,S.isReasonEnable=!0,S.isRefundAmt=!0),function(t){var a;S.showPatientBanner=!0,S.selectedadmitpat=t;let i={regSeqId:S.selectedadmitpat[0].RG_SEQ_ID,admissionSeqid:S.selectedadmitpat[0].IPADM_SEQ_ID};a=null==i.admissionSeqid?"2":"1",l.getPatientBanner(i,a).then(function(t){var a,r;e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=1,e.accSeqId=t.accSeqId,e.regSeqId=i.regSeqId,e.subAccSeqId=t.subAccSeqId,a=e.accSeqId,r={"@class":"com.napier.core.service.vo.deposits.DepositsVo",accSeqId:a},c.getDepositAmount(r).then(function(e){if(""!==e.data.HITService.message.deposits[0]){var t=e.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"];angular.isArray(t)?S.newreqObj.depositAmount=_.find(e.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"],function(e){return e.gQDataCode==S.newreqObj.depositNo}).availableAmount:S.newreqObj.depositAmount=t.availableAmount}}),function(e,t){S.demonadnote=[],S.demandNoteNo={1:S.demonadnote};var a=o.executeQueryURLReset(),i=new Array;o.prepareParamListWithParam("pPracticeId",S.contextInfo.CLIENT_REF_ID,i),o.prepareParamListWithParam("pFacilityId",S.contextInfo.FACILITY_ID,i),o.prepareParamListWithParam("pAccSeqId",e,i),o.prepareParamListWithParam("pRgSeqId",t,i),o.executeQueryInput("DEPOSIT_AND_DEMAND_NOTE",i,S.demandNoteNo,!0,!0,a,"popUp",{}).then(function(e){S.demandNoteNo=e[1],S.refreqReqObj.demandNoteno=S.demandNoteNo[0].DEMAND_NOTE_NO})}(e.accSeqId,e.regSeqId)}),s.patientBannerDetail(i.regSeqId).then(function(t){e.patientBannerDetails=t,e.refSeqId=e.patientBannerDetails.patientReferral.refSeqId})}([{RG_SEQ_ID:u.editedPat.rgSeqId,IPADM_SEQ_ID:u.editedPat.ipAdmnSeqId}]),S.reqrefund=function(){if(null==S.refreqReqObj.refAmount||""==S.refreqReqObj.refAmount)d.warning("Warning","Please enter Refund Amount",!1,!1,p.time);else if(null==S.refreqReqObj.reason||""==S.refreqReqObj.reason)d.warning("Warning","Please enter Reason",!1,!1,p.time);else if(null==S.refreqReqObj.depositNo||""==S.refreqReqObj.depositNo||null==S.refreqReqObj.depositTypeCode||""==S.refreqReqObj.depositTypeCode||null==S.refreqReqObj.depositAmount||""==S.refreqReqObj.depositAmount)d.warning("Warning","Please Fill Mandatory Fields",!1,!1,p.time);else{var e={"@class":"com.napier.core.service.vo.deposits.DepositsVo",depositSeqId:S.refreqReqObj.depositSeqId,depositAmount:S.refreqReqObj.depositAmount,depositTypeCode:S.refreqReqObj.depositTypeCode,facilityId:S.contextInfo.FACILITY_ID,gnDepositStatus:S.refreqReqObj.gnDepositStatus,gnTranStatus:1,isBillDepositAdj:S.refreqReqObj.isBillDepositAdj,practiceId:S.contextInfo.CLIENT_REF_ID,totalDepositAmount:0,billDepositReasonsList:[{"com.napier.core.service.vo.deposits.DepositsReasonVo":[{depositReason:S.refreqReqObj.reason,depositRsnSeqId:S.refreqReqObj.reasonSeqId,gnDepositStatus:S.refreqReqObj.gnDepositStatus,depositTranType:0,gnTranStatus:0}]}],depositRefundList:[{"com.napier.core.service.vo.deposits.DepositRefundVo":[{depRefundAmount:parseInt(S.refreqReqObj.refAmount),tranType:0}]}]};c.refreqDepositReq(e).then(function(e){void 0!==e.data.HITService.message.depositSeqId&&(d.success("Success","Refund Request Saved Successfully",!1,!1,p.time),a.close())})}},S.close=function(){a.close()}}e.$inject=["$scope","hisCalDefConstant","$uibModalInstance","dropdownQueryService","otComService","hisModalService","PatientBannerGlobal","PatientBannerBilling","QueryService","depositRequestService","hisAlertService","hisAlertConstants","patObj","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("refreqDepoReqModalCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){var S=this;m.loadModule("billing");var v,D=g.getLanguageToSet();m.changeLanguage(D),S.contextInfo=JSON.parse(sessionStorage.getItem("userContextObj")),S.skipReqObj=u.editedPat,S.newreqObj={},S.showPatientBanner=!1,v={"@class":"com.napier.core.service.vo.deposits.DepositsVo",depositAgainst:S.skipReqObj.depositAgainst,depositSeqId:S.skipReqObj.depositSeqId,gnDepositStatus:S.skipReqObj.gnDepositStatus,gnTranStatus:1,isBillDepositAdj:S.skipReqObj.isBillDepositAdj,refSeqId:S.skipReqObj.refSeqId},c.getdepositbyId(v).then(function(e){if(""!==e.data.HITService.message){var t=e.data.HITService.message.depositTypeCode;S.skipReqObj.depositTypeCode=t;var a=e.data.HITService.message.depositAmount;S.newreqObj.depositAmount=a}}),function(){S.depsitype=[],S.depsitypeList={1:S.depsitype};var e=o.executeQueryURLReset(),t=new Array;o.prepareParamListWithParam("pPracticeId",S.contextInfo.CLIENT_REF_ID,t),o.prepareParamListWithParam("pStatus",-999,t),o.prepareParamListWithParam("pDepositTypeName","",t),o.prepareParamListWithParam("pFlow",-999,t),o.prepareParamListWithParam("pApplicableTo",-999,t),o.prepareParamListWithParam("pFacilityId",S.contextInfo.FACILITY_ID,t),o.executeQueryInput("ANSC_DEPOSIT_TYPE_001",t,S.depsitypeList,!0,!0,e,"popUp",{}).then(function(e){S.depsitypeList=e[1]})}(),function(t){var a;S.showPatientBanner=!0,S.selectedadmitpat=t;let i={regSeqId:S.selectedadmitpat[0].RG_SEQ_ID,admissionSeqid:S.selectedadmitpat[0].IPADM_SEQ_ID};a=null==i.admissionSeqid?"2":"1",l.getPatientBanner(i,a).then(function(t){var a,r;e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=1,e.accSeqId=t.accSeqId,e.regSeqId=i.regSeqId,e.subAccSeqId=t.subAccSeqId,a=e.accSeqId,r={"@class":"com.napier.core.service.vo.deposits.DepositsVo",accSeqId:a},c.getDepositAmount(r).then(function(e){""!==e.data.HITService.message.deposits[0]&&e.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"].depositTypeCode})}),s.patientBannerDetail(i.regSeqId).then(function(t){e.patientBannerDetails=t,e.refSeqId=e.patientBannerDetails.patientReferral.refSeqId})}([{RG_SEQ_ID:u.editedPat.rgSeqId,IPADM_SEQ_ID:u.editedPat.ipAdmnSeqId}]),S.skipDeposit=function(){if(null==S.skipReqObj.skippedAmount||""==S.skipReqObj.skippedAmount)d.warning("Warning","Please enter Skip Amount",!1,!1,p.time);else if(null==S.skipReqObj.reason||""==S.skipReqObj.reason)d.warning("Warning","Please enter Reason",!1,!1,p.time);else if(null==S.skipReqObj.depositNo||""==S.skipReqObj.depositNo||null==S.skipReqObj.depositTypeCode||""==S.skipReqObj.depositTypeCode||null==S.newreqObj.depositAmount||""==S.newreqObj.depositAmount)d.warning("Warning","Please Fill Mandatory Fields",!1,!1,p.time);else{var e={"@class":"com.napier.core.service.vo.deposits.DepositsVo",depositSeqId:S.skipReqObj.depositSeqId,depositAmount:S.newreqObj.depositAmount,depositTypeCode:S.skipReqObj.depositTypeCode,facilityId:S.contextInfo.FACILITY_ID,gnDepositStatus:S.skipReqObj.gnDepositStatus,gnTranStatus:1,isBillDepositAdj:S.skipReqObj.isBillDepositAdj,practiceId:S.contextInfo.CLIENT_REF_ID,billDepositReasonsList:[{"com.napier.core.service.vo.deposits.DepositsReasonVo":[{depositReason:S.skipReqObj.reason,depositRsnSeqId:S.skipReqObj.reasonSeqId,gnDepositStatus:S.skipReqObj.gnDepositStatus,depositTranType:0,gnTranStatus:0}]}],depositSkipList:[{"com.napier.core.service.vo.deposits.DepositSkipVo":[{depSkipAmount:S.skipReqObj.skippedAmount,tranType:0}]}]};c.skipDepositReq(e).then(function(e){void 0!==e.data.HITService.message.depositSeqId&&(d.success("Success","Cancel Sucessfully",!1,!1,p.time),a.close())})}},S.close=function(){a.close()}}e.$inject=["$scope","hisCalDefConstant","$uibModalInstance","dropdownQueryService","otComService","hisModalService","PatientBannerGlobal","PatientBannerBilling","QueryService","depositRequestService","hisAlertService","hisAlertConstants","patObj","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("skipDepDepoReqModalCtrl",e)}(),function(){"use strict";angular.module("napierContainerUi").service("PackageServices",["CallManager","IPINDENTAPIS",function(e,t){this.searchPackageDetails=function(a,i,r){var n={};return n.url=t.HISIPINDENT.URL,n.requestData={operation:"getPackageDtls",messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillPackageDtlsVo",strPackCode:null==a||null==a?"":a,bedClassId:i,seqId:null==r||null==r||""==r?void 0:r}},e.sendRestRequest(n)},this.searchCPTCodeDetails=function(a){var i={};return i.url=t.HISIPINDENT.URL,i.requestData={operation:"getCptCodeDtls",messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillPackageDtlsVo",cptCode:null==a||null==a?"00100":a.toString()}},e.sendRestRequest(i)}}])}(),function(){"use strict";angular.module("napierContainerUi").service("SaveServices",["CallManager","IPINDENTAPIS",function(e,t){this.saveEstimateAllDetails=function(a,i,r,n,l){var s={};return s.url=t.HISIPINDENT.URL,s.requestData={operation:"saveEstimateAllDetails",messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillList",approxBillVos:[{"com.napier.core.billgeneration.vo.ApproxBillVo":[{approxBillHdSeqId:a.approxBillHdSeqId?a.approxBillHdSeqId:void 0,regSeqId:a.regSeqId?a.regSeqId:void 0,visitOrIpNo:a.visitOrIpNo?a.visitOrIpNo:void 0,accountSeqId:a.accountSeqId?a.accountSeqId:void 0,subAccSeqId:a.subAccSeqId?a.subAccSeqId:void 0,patientType:a.patientType,bedClassSeqId:a.bedClassSeqId,titleCode:a.titleCode,emailId:a.emailId,address:a.address,patientFirstName:a.patientFirstName,patientLastName:a.patientLastName?a.patientLastName:void 0,mobileNo:a.mobileNo,dob:a.dob,strPatientAge:a.strPatientAge,patientcategorySeqId:a.patientcategorySeqId,strPatientGender:a.strPatientGender,tariffSeqId:a.tariffSeqId,gnTranStatus:a.gnTranStatus,gnFlow:a.gnFlow,incSeqId:a.incSeqId,incPlanSeqId:a.incPlanSeqId,policyNumber:a.policyNumber,cardNumber:a.cardNumber,planValidFromDate:a.planValidFromDate,planValidToDate:a.planValidToDate,reasonForAdmission:a.reasonForAdmission,estLos:a.estLos,losType:a.losType,isDraft:a.isDraft,payerType:a.payerType,chiefComplaints:a.chiefComplaints,expAdmDate:a.expAdmDate,approxBillDate:a.approxBillDate,grossAmt:a.grossAmt,discountAmt:a.discountAmt,approxBillServiceDtlsVoList:[{"com.napier.core.billgeneration.vo.ApproxBillServiceDtlsVo":i}],materialVosList:[{"com.napier.core.billgeneration.vo.MaterialVo":r}],diagonsisVos:[{"com.napier.core.billgeneration.vo.DiagnosisDetailsVo":n}],procedureDetailsVos:[{"com.napier.core.billgeneration.vo.ApproxProcedureDetailsVo":l}]}]}]}},e.sendRestRequest(s)}}])}(),function(){"use strict";function e(e){this.setDiagProc=function(t){var a=e.defer(),i=t.selectDiag,r=t.selectProc;t=t[0]?t[0]:t;return i?1==i?(t.STANDARD=t.ICDCODE+"-"+t.DESCRIPTION,t.HOSDEFNIED=t.HOSP_DIAG_CODE?t.HOSP_DIAG_CODE+"-"+t.HOSP_DIAG_DESC:"--",t.APPROX_DIAG_SEQ_ID=t.APPROX_DIAG_SEQ_ID?t.APPROX_DIAG_SEQ_ID:void 0):2==i&&(t.STANDARD=t.ICDCODE+"-"+t.DESCRIPTION,t.HOSDEFNIED=t.HOSP_DIAG_CODE+"-"+t.HOSP_DIAG_DESC,t.APPROX_DIAG_SEQ_ID=t.APPROX_DIAG_SEQ_ID?t.APPROX_DIAG_SEQ_ID:void 0):r&&(1==r?(t.STANDARD=t.CODE+"-"+t.DESCRIPTION,t.HOSDEFNIED=t.SUR_CODE?t.SUR_CODE+"-"+t.SUR_NAME:"--",t.APPROX_PROC_SEQ_ID=t.APPROX_PROC_SEQ_ID?t.APPROX_PROC_SEQ_ID:void 0):2==r&&(t.STANDARD=t.CODE+"-"+t.DESCRIPTION,t.HOSDEFNIED=t.SUR_CODE+"-"+t.SUR_NAME,t.APPROX_PROC_SEQ_ID=t.APPROX_PROC_SEQ_ID?t.APPROX_PROC_SEQ_ID:void 0)),a.resolve(t),a.promise}}e.$inject=["$q"],angular.module("napierContainerUi").service("estimateBillService",e)}(),function(){"use strict";angular.module("napierContainerUi").service("SearchServices",["CallManager","IPINDENTAPIS",function(e,t){this.searchServiceSelection=function(a,i,r,n){var l={};return l.url=t.HISIPINDENT.URL,l.requestData={operation:"getServiceDtls",messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillServiceDtlsVo",practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,serviceCode:null!=a&&(null!=a.code||null!=a.code)?a.code:"%%",serviceName:null!=a&&(null!=a.description||null!=a.description)?a.description:"%%",pServStatus:"1",pServDefStatus:"1",pServDesign:-999,pPriServTypeCode:null!=a&&(null!=a.priServType||null!=a.priServType)?a.priServType.gQDataCode:-999,pSecServTypeCode:null!=a&&(null!=a.secServType||null!=a.secServType)?a.secServType.gQDataCode:-999,pServTypeCode:null!=a&&(null!=a.servType||null!=a.servType)?a.servType.gQDataCode:-999,pDepartment:-999,pIsEmergency:-999,pFlowElement:"1",serviceSearch:null!=n||null!=n?n:"",bedClassId:i instanceof Object?i.bedCode:i,seqId:null==r||null==r?-999:r,planSequenceId:i instanceof Object&&null!=i.planSequenceId?i.planSequenceId:null==r||null==r?void 0:-999}},e.sendRestRequest(l)}}])}(),function(){"use strict";angular.module("napierContainerUi").constant("groupDiscountDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,multiSelect:!1,columnDefs:[{field:"companyId",displayName:"Group Name",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"companyName",displayName:"Payer",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"refundReqStatusDesc",displayName:"Discount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"}],enablePaginationControls:!1,useExternalSorting:!1,enableColumnMenus:!1,paginationPageSize:1})}(),function(){"use strict";angular.module("napierContainerUi").constant("groupDiscountnewDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,multiSelect:!1,columnDefs:[{field:"companyId",displayName:"Service Code",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"refundReqStatusDesc",displayName:"Service Name",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"}],enablePaginationControls:!1,useExternalSorting:!1,enableColumnMenus:!1,paginationPageSize:1})}(),function(){"use strict";function e(e,t,a,i,r){var n=sessionStorage.getItem("rawUserName");this.showGridDataService=function(a){var i=e.defer(),r={"@class":"com.napier.core.onaccountdeposit.vo.OnAccDepsRefundWorkList",pOnAccDepNo:"",pFromDate:a.frmDate,pToDate:a.toDate,companyId:a.ccode,companyName:a.cname,accType:1,tranStatus:a.paymentStatus},n={url:"HISServices/HITService"};return n.requestData={operation:"onAccDepsRefundWorkList",messageId:"",destination:"com.napier.core.onaccountdeposit.service.external.OnAccountDepositService",message:r},t.sendRestRequest(n).then(function(e){var t=e.data.HITService,a=(e.data,e.data.HITService.message,t?e.data.HITService.message.onAccDepsRefundWorkLst[0]["com.napier.core.onaccountdeposit.vo.OnAccDepsRefundReqVO"]:[]),r=getArrayObjects(a);i.resolve(r)}).then(function(e){i.reject(e)}),i.promise},this.saveRefundProceedService=function(a){var i=e.defer(),r={"@class":"com.napier.core.onaccountdeposit.vo.OnAccDepsRefundReqVO",appRefundAmt:null!=a.refApp&&null!=a.refApp&&""!==a.refApp?parseFloat(a.refApp):0,availableAmt:a.availableAmt,depositedAmt:a.dAmt,deprefundSeqId:a.deprefundSeqId,onaccdepNo:a.dno,onaccdepSeqId:a.onaccdepSeqId,payerAccSeqId:a.payerAccSeqId,reasonDisapprove:a.reasonDis,reasonRefund:a.rReq,refundReqAmt:a.rAmt,remarks:a.remark,requestedBy:a.reqBy},n={url:"HISServices/HITService"};return n.requestData={operation:"0"==a.approval?"onAccDepsRefundReqApproval":"onAccDepsRefundReqDisApproval",messageId:"",destination:"com.napier.core.onaccountdeposit.service.external.OnAccountDepositService",message:r},t.sendRestRequest(n).then(function(e){i.resolve(e)}),i.promise},this.printCoverService=function(e){var t=new Array;r.prepareParamList("pOnaccDepseqId",e.onaccdepSeqId,t),r.prepareParamList("preparedBy",n,t);var a={paramsList:t,reportId:"OnAccountRefundRequestReportId"};i.printReportModal("PrintTypeSelection","sm").then(function(e){i.printReportModal("acountRefPrint","lg",e,a)})}}e.$inject=["$q","CallManager","$log","PrintService","QueryService"],angular.module("napierContainerUi").service("onAccountDepositRefundService",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d){e.healthCheckPack={};e.apportionData=[{code:1,desc:"apportion"},{code:2,desc:"%"}],e.taskIdPermission=c.rolePermission("T_BL_M_HEALTH_CHECKUP_PACKAGE"),e.taskIdPermission_N=e.taskIdPermission.T_BL_M_HEALTH_CHECKUP_PACKAGE_N,e.taskIdPermission_U=e.taskIdPermission.T_BL_M_HEALTH_CHECKUP_PACKAGE_U,e.saveButton=e.taskIdPermission_N,e.updateButton=!1,e.packageChecklistScreen=!0,e.packageCheckListGrid=angular.copy(o),e.showUpdateButton=!1;for(var p=[],u=1;u<=10;u++)10==u?p.push({checkListItemPriority:u,hideShowRow:!0}):p.push({checkListItemPriority:u,hideShowRow:!1});e.packageCheckListGrid.data=p,t.loadCombos("SCM_SERV_001_1").then(function(t){e.primaryServiceCombo=t[1]}),e.pkgComboInputs={},i.loadCombos("GET_PACKAGE_SERVICE",e.pkgComboInputs).then(function(t){var a=t[1];e.pkgCombo=a}),i.loadCombos("GET_SAVED_PACKAGE_SERVICES",e.pkgComboInputs).then(function(t){var a=t[1];e.extPkgCombo=a}),e.tariffCategoryInputs={pFacilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID},i.loadCombos("TARIFF_CARG",e.tariffCategoryInputs).then(function(t){var a=t[1];e.tariffCategoryData=a});var m=r.getLanguageToSet();if(n.loadAlerts(m).then(function(t){e.alertObj=t,e.alertData={buttonText:e.alertObj.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}},function(e){}),e.packageRowsArr=[],e.healthCheckPack.fromDateOptions={format:"DD-MM-YYYY"},e.healthCheckPack.toDateOptions={format:"DD-MM-YYYY"},e.healthCheckPack.toDateOptions.minDate=e.healthCheckPack.fromdate,e.healthCheckPack.fromDateOptions.maxDate=e.healthCheckPack.todate,e.checkServiceAvailable=function(t,a){var r=e.healthCheckPack.packName?e.healthCheckPack.packName:a,n=e.healthCheckPack.tariffCate?e.healthCheckPack.tariffCate:a;r&&n&&(e.pkgServiceInputs={pServSeqId:r.SERV_SEQ_ID,pTarrifCatCode:n.CODE?n.CODE:n.TARIFF_CODE,pInflSeqId:a&&a.INFL_SEQ_ID?a.INFL_SEQ_ID:void 0},i.loadCombos("GET_HEALTH_CHECKUP_PACK",e.pkgServiceInputs).then(function(a){var s=a[1];if(s.length>0){if(!e.editFlagDetails){var o={buttonText:e.alertData.buttonText};return l.hisAlertMulti("warning","Warning","Package already exit with tariff",o,e.alertFunction,e.close),!1}1==t?(e.healthCheckPack.packName="",e.taskIdPermission_N&&(e.saveButton=!0,e.updateButton=!1)):e.taskIdPermission_U&&(e.saveButton=!1,e.updateButton=!0),e.healthCheckPack.tariffCate={},e.healthCheckPack.tariffCate.CODE=s[0].TARRIF_CATG_CODE,e.healthCheckPack.packPrice=s[0].VALUE,e.healthCheckPack.rcvSeqId=s[0].RCV_SEQ_ID,e.healthCheckPack.inflSeqId=s[0].INFL_SEQ_ID,e.healthCheckPack.priServTypeCode=s[0].PRI_SERV_TYPE_CODE,e.healthCheckPack.fromdate=s[0].EFFECTIVE_FROM,e.healthCheckPack.todate=s[0].EFFECTIVE_TO,e.packageRowsArr=[],angular.forEach(s,function(t,a){var i={primaryCombo:t.DESCRIPTION,primaryComboCode:t.PRI_SERV_TYPE_CODE,deptCode:t.DEPT_CODE,subDeptCode:t.SUB_DEPT_ID,serviceSeqId:t.INCL_SERV_SEQ_ID,serviceName:t.SERV_NAME,serviceCode:t.SERV_CODE,servicePrice:t.INCL_ORG_VALUE,effectiveDetails:t.INCL_AMOUNT,displayRate:!0,startEdit:!1,effectiveUpdateValue:t.INCL_AMOUNT,fixed:"1"==t.FIXED_VAL_FLAG};e.packageRowsArr.push(i)}),e.calculateSum(),e.checkListInputs={pServSeqId:r.SERV_SEQ_ID},i.loadCombos("GET_CHECK_LIST_FOR_PACKAGE",e.checkListInputs).then(function(t){var a=t[1],i=0;angular.forEach(a,function(t,a){if(i<10)e.packageCheckListGrid.data[i].checkListItemPriority=t.CHECK_LIST_ITEM_PRIORITY,e.packageCheckListGrid.data[i].pkgCheckListItemDesc=t.PKG_CHECK_LIST_ITEM_DESC,e.packageCheckListGrid.data[i].waitingArea=t.WAITING_AREA;else{var r={checkListItemPriority:t.CHECK_LIST_ITEM_PRIORITY,pkgCheckListItemDesc:t.PKG_CHECK_LIST_ITEM_DESC,waitingArea:t.WAITING_AREA};e.packageCheckListGrid.data.push(r)}i++})})}else e.taskIdPermission_N?(e.saveButton=!0,e.updateButton=!1):(e.saveButton=!1,e.updateButton=!1),e.clearPartial(t),e.getTariffRates(r,n)}))},e.getTariffRates=function(t,a){t&&a&&(e.tariffRatesInputs={pTariffSeqId:a.CODE,pServSeqId:t.SERV_SEQ_ID},i.loadCombos("GET_TARIFF_AMOUNT_FOR_SERVICE",e.tariffRatesInputs).then(function(t){var a=t[1][0];if(a&&a.VALUE>0)e.healthCheckPack.packPrice=a.VALUE,e.healthCheckPack.rcvSeqId=a.RCV_SEQ_ID,e.healthCheckPack.inflSeqId=a.INFL_SEQ_ID,e.healthCheckPack.priServTypeCode=a.PRI_SERV_TYPE_CODE;else{e.clearPartial(!0);var i={buttonText:e.alertData.buttonText};l.hisAlertMulti("warning","Warning","Tariff Rate is not defined for the selected Package",i,e.alertFunction,e.close)}}))},e.checkEditMode=function(){var t=!1;return angular.forEach(e.packageRowsArr,function(e,a){e.startEdit&&(t=!0)}),t},e.loadServiceData=function(){if(e.checkEditMode()){var t="Please update the record which is in edit mode",a={buttonText:e.alertData.buttonText};return l.hisAlertMulti("warning","Warning",t,a,e.alertFunction,e.close),e.healthCheckPack.primaryCombo="",!1}var r=e.healthCheckPack.apportionPercent,n=e.healthCheckPack.apportionSelect;if(!n){t="Please select the apportion before selecting the service",a={buttonText:e.alertData.buttonText};return l.hisAlertMulti("warning","Warning",t,a,e.alertFunction,e.close),!1}if(2==n.code&&!r){var t="Please enter the apportion percentage",a={buttonText:e.alertData.buttonText};return l.hisAlertMulti("warning","Warning",t,a,e.alertFunction,e.close),!1}var s=e.healthCheckPack.primaryCombo,o="GET_SERVICE_BASEDON_PRIMARY_SERV_TYPE";1!=s.NH_OP_REASON_SEQ_ID?e.serviceInputs={pPrimaryServTypeCode:s.CODE}:(o="GET_SERVICE_FOR_CONSULTATION",e.serviceInputs={}),i.loadCombos(o,e.serviceInputs).then(function(t){var a=t[1];a?e.serviceNameCombo=a:(e.serviceNameCombo=[],e.healthCheckPack.serviceDetailsCode="")})},e.retriveTariffRate=function(t){if(t){e.healthCheckPack.serviceDetailsCode=t.SERV_CODE;var a=t.SERV_SEQ_ID,r=e.healthCheckPack.tariffCate.CODE,n=t.SEC_SERV_TYPE_CODE?t.SEC_SERV_TYPE_CODE:e.healthCheckPack.primaryCombo.CODE;e.retriveTariffInputs={pServSeqId:a,pTariffSeqId:r,pPriServTypeCode:n},i.loadCombos("GET_TARIFF_AMOUNT_FOR_SERVICE",e.retriveTariffInputs).then(function(t){var a=t[1];if(a&&a[0]){var i=a[0].VALUE;if(e.healthCheckPack.serviceDetailsPrice=i,e.healthCheckPack.deptCode=a[0].DEPARTMENT,e.healthCheckPack.subDeptCode=a[0].SUB_DEPARTMENT,1==e.healthCheckPack.apportionSelect.code){var r=e.getApportionAmount(i);e.healthCheckPack.effectiveDetails=Math.round(r),e.healthCheckPack.originalEffectivePrice=Math.round(r)}else{var n=e.healthCheckPack.apportionPercent,s=0;n>0&&(s=i*n/100),e.healthCheckPack.effectiveDetails=Math.round(s),e.healthCheckPack.originalEffectivePrice=Math.round(s)}}else{e.healthCheckPack.serviceDetailsPrice="",e.healthCheckPack.effectiveDetails="";var o={buttonText:e.alertData.buttonText};l.hisAlertMulti("warning","Warning","Tariff Rate is not defined for the selected Service",o,e.alertFunction,e.close)}})}},e.getApportionAmount=function(t){var a=t;return angular.forEach(e.packageRowsArr,function(e,t){e.fixed||(a+=e.servicePrice)}),e.healthCheckPack.packPrice/a*t},e.getTotalServiceAmount=function(){var t=0;angular.forEach(e.packageRowsArr,function(e,a){1!=e.fixed&&(t+=e.servicePrice)});var a=0,i=e.healthCheckPack.fixedDetails;return e.healthCheckPack.serviceDetailsPrice&&(a=e.healthCheckPack.serviceDetailsPrice,t+=a),i&&e.packageRowsArr.length>0&&(t-=a),t},e.getTotalPkgAmount=function(){var t=0,a=e.healthCheckPack.packPrice;angular.forEach(e.packageRowsArr,function(e,a){1==e.fixed&&(t+=e.effectiveDetails)});var i=0,r=e.healthCheckPack.fixedDetails;return e.healthCheckPack.effectiveDetails&&(i=parseInt(e.healthCheckPack.effectiveDetails)),r&&(t+=i),a-t},e.setApportionAmount=function(){if(e.packageRowsArr.length>0){var t=e.getTotalPkgAmount();if(t>=0){var a=e.getTotalServiceAmount();angular.forEach(e.packageRowsArr,function(e,i){e.fixed||(e.effectiveDetails=Math.round(t/a*e.servicePrice),e.effectiveUpdateValue=e.effectiveDetails)}),e.calculateSum()}else{var i={buttonText:e.alertData.buttonText};l.hisAlertMulti("warning","Warning","The total fixed amount is exceeding the package price. Please change it.",i,e.alertFunction,e.close)}}},e.changeFromDate=function(t){var a=e.healthCheckPack.todate;if(t>a){var i={buttonText:e.alertData.buttonText};l.hisAlertMulti("warning","Warning","From Date connot be more than To Date",i,e.alertFunction,e.close),t=a,e.healthCheckPack.toDateOptions.minDate=e.healthCheckPack.fromdate,e.healthCheckPack.fromDateOptions.maxDate=e.healthCheckPack.todate}},e.changeToDate=function(t){var a=e.healthCheckPack.fromdate;if(t<a){var i={buttonText:e.alertData.buttonText};l.hisAlertMulti("warning","Warning","To Date connot be less than From Date",i,e.alertFunction,e.close),t=a,e.healthCheckPack.toDateOptions.minDate=e.healthCheckPack.fromdate,e.healthCheckPack.fromDateOptions.maxDate=e.healthCheckPack.todate}},e.fixPackagePrice=function(t){1==t.code&&(e.healthCheckPack.apportionPercent=""),e.healthCheckPack.primaryCombo&&e.loadServiceData()},e.resetFixedValueByPrice=function(t,a){a.effectiveUpdateValue&&(a.fixed=!0,a.effectiveUpdateValue=parseInt(a.effectiveUpdateValue),a.effectiveDetails=Math.round(a.effectiveUpdateValue));e.healthCheckPack.apportionPercent;e.calculateSum()},e.resetFixedValue=function(t,a){if(!a.startEdit)return a.fixed=!a.fixed,!1;a.fixed&&(a.effectiveDetails=Math.round(a.servicePrice)),e.calculateSum()},e.applyPercentage=function(t){if(e.packageRowsArr.length>0){if(1==e.healthCheckPack.apportionSelect.code)e.setApportionAmount();else if(angular.forEach(e.packageRowsArr,function(e,a){if(1!=e.fixed){var i;i=e.servicePrice*t/100,e.effectiveDetails=Math.round(i),e.effectiveUpdateValue=e.effectiveDetails}}),!e.healthCheckPack.fixedDetails){var a;a=e.healthCheckPack.serviceDetailsPrice*t/100,e.healthCheckPack.effectiveDetails=Math.round(a)}e.calculateSum()}else{var i={buttonText:e.alertData.buttonText};l.hisAlertMulti("warning","Warning","Please add Services to apply apportion",i,e.alertFunction,e.close)}},e.addServiceRecord=function(){if(e.getTotalPkgAmount()<0){var t={buttonText:e.alertData.buttonText};return l.hisAlertMulti("warning","Warning","The total fixed amount is exceeding the package price. Please change it.",t,e.alertFunction,e.close),!1}if(!e.healthCheckPack.primaryCombo)return!1;var a=angular.copy(e.healthCheckPack);if(e.checkDuplicateRecord(a)){t={buttonText:"No",buttonText2:"Yes"};var i={buttonCallBack1:function(){e.healthCheckPack.primaryCombo="",e.healthCheckPack.serviceName="",e.healthCheckPack.serviceDetailsCode="",e.healthCheckPack.serviceDetailsPrice="",e.healthCheckPack.effectiveDetails="",e.healthCheckPack.fixedDetails=""},buttonCallBack2:function(){e.addNewRecord(a),e.calculateSum()}};l.hisAlertMulti("information","Information","Selected Service already Exists. Are you sure you want to add?",t,i,!1)}else e.addNewRecord(a),e.calculateSum()},e.addNewRecord=function(t){e.pkgServiceRecord={primaryCombo:t.primaryCombo.DESCRIPTION,primaryComboCode:t.primaryCombo.CODE,deptCode:t.deptCode,subDeptCode:t.subDeptCode,serviceSeqId:t.serviceName.SERV_SEQ_ID,serviceName:t.serviceName.SERV_NAME,serviceCode:t.serviceName.SERV_CODE,specialtyCode:t.serviceName.CODE,servicePrice:t.serviceDetailsPrice,effectiveDetails:parseInt(t.effectiveDetails),originalEffectivePrice:parseInt(t.originalEffectivePrice),effectiveUpdateValue:parseInt(t.effectiveDetails),displayRate:!0,startEdit:!1,fixed:"1"==t.fixedDetails},e.packageRowsArr.unshift(e.pkgServiceRecord),e.healthCheckPack.primaryCombo="",e.healthCheckPack.serviceName="",e.healthCheckPack.serviceDetailsCode="",e.healthCheckPack.serviceDetailsPrice="",e.healthCheckPack.effectiveDetails="",e.healthCheckPack.fixedDetails=""},e.calculateSum=function(){var t=0,a=0;angular.forEach(e.packageRowsArr,function(e,i){t+=parseInt(e.servicePrice),a+=parseFloat(e.effectiveDetails)==parseFloat(e.effectiveUpdateValue)?parseFloat(e.effectiveDetails):parseFloat(e.effectiveUpdateValue)}),e.healthCheckPack.totalService=t,e.healthCheckPack.totalEffective=Math.round(a)},e.checkDuplicateRecord=function(t){var a=!1;return angular.forEach(e.packageRowsArr,function(e,i){e.primaryComboCode==t.primaryCombo.CODE&&e.serviceSeqId==t.serviceName.SERV_SEQ_ID&&(a=!0)}),a},e.editServiceRecord=function(t,i,r){if("viewPack"==a.actionName)return!1;if(e.checkEditMode()){var n="Please update the record which is in edit mode";return l.hisAlertMulti("warning","Warning",n,!1,!1,e.close),!1}if(!e.healthCheckPack.apportionSelect){n="Please enter the apportion percentage";return l.hisAlertMulti("warning","Warning",n,!1,!1,e.close),!1}r.displayRate=!1,r.startEdit=!0},e.updateServiceRecord=function(t,i,r){if("viewPack"==a.actionName)return!1;if(e.getTotalPkgAmount()<0){return l.hisAlertMulti("warning","Warning","Total Effective price should not exceeding package price.",!1,!1,e.close),!1}r.startEdit=!1,r.displayRate=!0,r.effectiveDetails=r.effectiveUpdateValue;e.healthCheckPack.apportionPercent;e.calculateSum()},e.DeleteServiceRecords=function(t,i){if("viewPack"==a.actionName)return!1;e.packageRowsArr.splice(t,1);e.healthCheckPack.apportionPercent;e.calculateSum()},e.checkFixedOrNot=function(t,a){if(e.healthCheckPack.fixedDetails="1",e.getTotalPkgAmount()<0){l.hisAlertMulti("warning","Warning","Total Effective price should not exceeding package price.",!1,!1,e.close)}},e.setEffectivePrice=function(t){e.healthCheckPack.apportionPercent},e.clear=function(){e.packageRowsArr=[],e.healthCheckPack.packName="",e.healthCheckPack.tariffCate="",e.healthCheckPack.packPrice="",e.healthCheckPack.apportionSelect="",e.healthCheckPack.apportionPercent="",e.healthCheckPack.fromdate=new Date,e.healthCheckPack.todate=new Date,e.healthCheckPack.clone="",e.healthCheckPack.primaryCombo="",e.healthCheckPack.serviceName="",e.healthCheckPack.serviceDetailsCode="",e.healthCheckPack.serviceDetailsPrice="",e.healthCheckPack.effectiveDetails="",e.healthCheckPack.fixedDetails="",e.healthCheckPack.totalService="",e.healthCheckPack.totalEffective="",e.clearCheckListGrid()},e.clearCheckListGrid=function(){e.packageCheckListGrid.data=[];for(var t=1;t<=10;t++)e.packageCheckListGrid.data.push({checkListItemPriority:t})},e.clearRecord=function(){e.healthCheckPack.primaryCombo="",e.healthCheckPack.serviceName="",e.healthCheckPack.serviceDetailsCode="",e.healthCheckPack.serviceDetailsPrice="",e.healthCheckPack.effectiveDetails="",e.healthCheckPack.fixedDetails="",e.setEffectivePrice()},e.clearPartial=function(t){e.packageRowsArr=[],t&&(e.healthCheckPack.tariffCate=""),e.healthCheckPack.packPrice="",e.healthCheckPack.apportionSelect="",e.healthCheckPack.apportionPercent="",e.healthCheckPack.fromdate=new Date,e.healthCheckPack.todate=new Date,e.healthCheckPack.clone="",e.healthCheckPack.primaryCombo="",e.healthCheckPack.serviceName="",e.healthCheckPack.serviceDetailsCode="",e.healthCheckPack.serviceDetailsPrice="",e.healthCheckPack.effectiveDetails="",e.healthCheckPack.fixedDetails="",e.healthCheckPack.totalService="",e.healthCheckPack.totalEffective="",e.clearCheckListGrid()},e.deleteRecord=function(e,t,a){a.pkgCheckListItemDesc="",a.waitingArea=""},e.addExtraRow=function(t){try{e.packageCheckListGrid.data[e.packageCheckListGrid.data.length-1].hideShowRow=!1,e.packageCheckListGrid.data.push({checkListItemPriority:e.packageCheckListGrid.data.length+1,hideShowRow:!0})}catch(e){}},e.prepareCheckListModel=function(){var t=e.packageCheckListGrid.data,a=1;e.packageCheckListGridVoModel=[];for(var i=0;i<t.length;i++)""!==t[i].pkgCheckListItemDesc&&void 0!==t[i].pkgCheckListItemDesc&&(e.packageCheckListGridVo={checkListItemPriority:a,pkgCheckListItemDesc:t[i].pkgCheckListItemDesc,waitingArea:t[i].waitingArea},e.packageCheckListGridVoModel.push(e.packageCheckListGridVo),a++)},e.savePkg=function(){if(0==e.packageRowsArr.length){var t="Please add atleast one service to save package",a={buttonText:e.alertData.buttonText};return l.hisAlertMulti("warning","Warning",t,a,e.alertFunction,e.close),!1}var i=e.healthCheckPack.packPrice,r=e.healthCheckPack.totalEffective;if(parseFloat(i)!=parseFloat(r)){t="Package Price and Total Effective Price is not equal",a={buttonText:e.alertData.buttonText};return l.hisAlertMulti("warning","Warning",t,a,e.alertFunction,e.close),!1}e.prepareCheckListModel();for(var n=[],o=e.packageRowsArr,c=0;c<o.length;c++){var d={packageSerSeqId:e.healthCheckPack.packName?e.healthCheckPack.packName.SERV_SEQ_ID:e.editPackName,PrimaryServiceGroup:o[c].primaryComboCode,ServiceCode:o[c].serviceSeqId,deptCode:o[c].deptCode,subDeptCodeId:o[c].subDeptCode,ServicePrice:o[c].servicePrice,effectivePrice:o[c].effectiveDetails,specialtyCode:o[c].specialtyCode,fixedValue:o[c].fixed?1:2};n.push(d)}var p={url:"HISServices/HISServices"},u={inflSeqId:e.healthCheckPack.inflSeqId,rcvSeqId:e.healthCheckPack.rcvSeqId,patType:2,servPriority:1,tarrifCatgCode:e.healthCheckPack.tariffCate?e.healthCheckPack.tariffCate.CODE:e.editTariffCate,servSeqId:e.healthCheckPack.packName?e.healthCheckPack.packName.SERV_SEQ_ID:e.editPackName,value:e.healthCheckPack.packPrice,priServTypeCode:e.healthCheckPack.priServTypeCode,effectiveFrom:moment(e.healthCheckPack.fromdate).format("YYYY-MM-DD")+"T00:00:00.000Z",effectiveTo:moment(e.healthCheckPack.todate).format("YYYY-MM-DD")+"T23:59:59.000Z",gnStatus:1,facilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID,practiceId:JSON.parse(sessionStorage.userContextObj).CLIENT_REF_ID};p.requestData={operation:"saveHealthCheckPackage",messageId:"",destination:"com.napier.core.ratecard.service.external.RateCardService",message:{"@class":"com.napier.core.service.vo.TariffRateMasterVo",tariffRateCardVo:{"@class":"com.napier.core.service.vo.TariffRateCardVo",rcvSeqId:e.healthCheckPack.rcvSeqId,effectiveFrom:moment(e.healthCheckPack.fromdate).format("YYYY-MM-DD")+"T"+moment().format("HH:mm:ss.SSS")+"Z",effectiveTo:moment(e.healthCheckPack.todate).format("YYYY-MM-DD")+"T"+moment().format("HH:mm:ss.SSS")+"Z",forTarrifCatgCode:e.healthCheckPack.tariffCate?e.healthCheckPack.tariffCate.CODE:e.editTariffCate,servSeqId:e.healthCheckPack.packName?e.healthCheckPack.packName.SERV_SEQ_ID:e.editPackName,serviceCode:e.healthCheckPack.packName?e.healthCheckPack.packName.SERV_CODE:e.editSercode,serviceName:e.healthCheckPack.packName?e.healthCheckPack.packName.SERV_NAME:e.editSername,gnStatus:1},tariffInfluencerVoList:[{"com.napier.core.service.vo.TariffInfluencerVo":u}],packageDetailsVo:[{"com.napier.core.service.vo.PackageDetailsVo":n}],packageCheckListVo:[{"com.napier.core.masters.vo.PackageCheckListVo":e.packageCheckListGridVoModel}]}},s.sendRestRequest(p).then(function(t){t.data.HITService.message.errorCode?l.warning("Failure","Health check package Saving Failed"):(l.success("Success","Health check package Saved Successfully"),e.clear(),e.closePackage())})},"editPack"==a.actionName){e.packageEditDisable=!0,e.packageEditHide=!0;var g=!1,S=angular.fromJson(a.PackData);e.checkServiceAvailable(g,S),e.editTariffCate=S.TARIFF_CODE,e.editPackName=S.SERV_SEQ_ID,e.editSercode=S.SERV_CODE,e.editSername=S.SERV_NAME,e.healthCheckPack.packName={SERV_NAME:S.SERV_NAME,SERV_CODE:S.SERV_CODE,SERV_SEQ_ID:S.SERV_SEQ_ID},e.editFlagDetails=!0}if("viewPack"==a.actionName){g=!1;e.packageViewDisable=!0;var v=angular.fromJson(a.PackData);e.checkServiceAvailable(g,v),e.healthCheckPack.packName={SERV_NAME:v.SERV_NAME,SERV_CODE:v.SERV_CODE,SERV_SEQ_ID:v.SERV_SEQ_ID},e.editFlagDetails=!0}"New"==a.actionName&&(e.healthCheckPack.todate=new Date,e.healthCheckPack.fromdate=new Date,e.editFlagDetails=!1),e.closePackage=function(){d.go("index.masters.healthCheckPackageMaster",{reload:!0})}}e.$inject=["$scope","orderReportService","$stateParams","adtDailyReportComboQueryservice","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","CallManager","packageCheckListGridColumnsData","RoleTaskService","$state"],angular.module("napierContainerUi").controller("healthCheckPackageController",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("packageViewGridList",{enableSorting:!1,enenableRowHeaderSelection:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableHorizontalScrollbar:0,multiSelect:!1,showGridFooter:!1,enableFullRowSelection:!1,paginationPageSizes:[10,16,32,64],paginationPageSize:10,columnDefs:[{field:"SERV_CODE",displayName:"Package Code",width:"10%",enableSorting:!0,enableCellEdit:!0},{field:"SERV_NAME",displayName:"Package Name",width:"50%",enableSorting:!0,enableCellEdit:!0},{field:"TARIFF_DESCRIPTION",displayName:"Tariff Category",width:"20%",enableSorting:!0,enableCellEdit:!0},{field:"GN_STATUS",displayName:"Status",cellTemplate:'<div style="" class="ui-grid-cell-contents">{{(row.entity.GN_STATUS==1)?"Active":"Inactive"}}</div>',width:"10%",enableSorting:!0,enableCellEdit:!0},{displayName:"Actions",field:"actions",cellTemplate:'<div style="" class="ui-grid-cell-contents action-row"><i class="fa fa-pencil" ng-if="row.entity.GN_STATUS==1?true:false" style="padding-right:5px;" ng-show="grid.appScope.editPermission" ng-click="grid.appScope.editPackageRow(row.entity,rowRenderIndex)"></i><i class="fa fa-eye" ng-show="grid.appScope.viewPermission" ng-click="grid.appScope.editPackageView(row.entity,rowRenderIndex)"></i></div>',width:"10%",enableSorting:!0,enableCellEdit:!0}]})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s){e.packageMasterList={};var o=l.rolePermission("T_BL_M_HEALTH_CHECKUP_PACKAGE");e.createPermission=o.T_BL_M_HEALTH_CHECKUP_PACKAGE_N,e.editPermission=o.T_BL_M_HEALTH_CHECKUP_PACKAGE_U,e.viewPermission=o.T_BL_M_HEALTH_CHECKUP_PACKAGE_V,e.packageMasterGrid=angular.copy(i),e.addPackage=function(){a.go("index.masters.healthCheckPackage",{reload:!0,actionName:"New"})},e.pkgComboInputsList={},t.loadCombos("NHIS_GET_PACKAGE_SERVICES",e.pkgComboInputsList).then(function(t){var a=t[1];e.packageComboList=angular.copy(a)}),e.packageSearch=function(){e.bigTotalItems=0,e.packageListMaster=[],e.healthPackageMaster={1:e.packageListMaster};var t=s.executeQueryURLReset();return e.healthPackageMasterList=new Array,s.prepareParamListWithParam("pServcode",e.packageMasterList.packageCode?e.packageMasterList.packageCode.SERV_CODE:"",e.healthPackageMasterList),s.prepareParamListWithParam("pServname",e.packageMasterList.packageName?e.packageMasterList.packageName.SERV_NAME:"",e.healthPackageMasterList),s.prepareParamListWithParam("pStatus",e.packageMasterList.status,e.healthPackageMasterList),s.executeQueryInput("NHIS_GET_PACKAGE_SERVICES",e.healthPackageMasterList,e.healthPackageMaster,!0,!0,t,"popUp",{}).then(function(t){var a=Array.isArray(t[1])?t[1]:[t[1]];e.packageMasterGrid.data=a,e.bigTotalItems=10*Math.ceil(e.packageMasterGrid.data.length/e.packageMasterGrid.paginationPageSize)})},e.packageSearch(),e.packageClaear=function(){e.packageMasterList.packageCode="",e.packageMasterList.packageName="",e.packageMasterGrid.data=[],e.bigTotalItems=0},e.getTableHeight=function(){var t;return e.packageMasterGrid.data.length>=10?(t=400,t+="px"):0==e.packageMasterGrid.data.length?t="200px !important":(t=30*e.packageMasterGrid.data.length+30+70,t+="px"),{height:t}};var c={pageNumber:1,pageSize:8,sort:null};e.packageMasterGrid.onRegisterApi=function(t){t.pagination.on.paginationChanged(e,function(e,t){c.pageNumber=e,c.pageSize=t})},e.editPackageRow=function(e,t){var i=JSON.stringify(angular.copy(e));a.go("healthCheckPackage",{reload:!0,actionName:"editPack",PackData:i})},e.editPackageView=function(e,t){var i=JSON.stringify(angular.copy(e));a.go("healthCheckPackage",{reload:!0,actionName:"viewPack",PackData:i})}}e.$inject=["$scope","adtDailyReportComboQueryservice","$state","packageViewGridList","hisTranslationsGlobalLang","hisGenericAlertService","RoleTaskService","QueryService"],angular.module("napierContainerUi").controller("healthCheckPackageMasterController",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("LabCostAnalysisReportGridColumnData",{multiSelect:!0,enableHorizontalScrollbar:1,enableVerticalScrollbar:0,enableColumnMenus:!1,enableSorting:!0,paginationPageSize:10,showGridFooter:!0,enableFiltering:!1,columnDefs:[{field:"SL_No",displayName:"SL No",enableColumnMenu:!1,enableCellEdit:!1,minWidth:60},{field:"PAT_NAME",displayName:"Patient Name",enableColumnMenu:!1,enableCellEdit:!1,minWidth:200},{field:"RG_INT_MR_NO",displayName:"MR No",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150},{field:"ACCOUNT_NO",displayName:"Visit No/Admission No",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150},{field:"SERVICE_CODE",displayName:"Service Code",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150},{field:"SERVICE_NAME",displayName:"Service Name",enableColumnMenu:!1,enableCellEdit:!1,minWidth:200},{field:"ORD_DATE",displayName:"Order Date",enableColumnMenu:!1,enableCellEdit:!1,cellFilter:"date:'dd-MM-yyyy'",minWidth:150},{field:"VISIT_DEPARTMENT",displayName:"Visit Department",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150},{field:"COST",displayName:"Cost",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100,cellFilter:" number : 2"}]})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c){var d=this;d.contextInfo=JSON.parse(sessionStorage.getItem("userContextObj")),d.billSearchgridOpts=angular.copy(s),d.billSearchgridOpts.data=[],e.popup1={opened:!1},e.popup2={opened:!1},e.open1=function(){e.popup1.opened=!0},e.open2=function(){e.popup2.opened=!0},d.iscategoryDisabled=!1,d.search={pid:"",fromDate:new Date,toDate:new Date,patName:"",billNo:"",payer:""},"IP"==c.ptype?(d.iscategoryDisabled=!0,d.search.category=1):d.search.category="",d.payercomboList=[],function(){d.billCat=[],d.billCategory={1:d.billCat};var e=a.executeQueryURLReset(),t=new Array;a.prepareParamListWithParam("pMasterSqId",6512,t),a.prepareParamListWithParam("pMasterDesc","",t),a.prepareParamListWithParam("pDetailCode",-999,t),a.prepareParamListWithParam("pDetailDesc","",t),a.executeQueryInput("TRN003",t,d.billCategory,!0,!0,e,"popUp",{}).then(function(e){d.billCategory=e[1]})}(),d.typeSearch=function(e){if(e.length>2){var t=[{ident:"1",value:e},{ident:"2",value:e},{ident:"3",value:e},{ident:"4",value:e},{ident:"5",value:e},{ident:"6",value:e},{ident:"7",value:e},{ident:"8",value:e},{ident:"9",value:e},{ident:"10",value:e}];return n.getList("ADT_IP_SEARCH",t).then(function(e){d.typeSearchList=[];var t=l.getQryComboList(e);return angular.forEach(t,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={PATIENT_NAME:a[0].data,IP_NO:a[1].data,RG_INT_MR_NO:a[2].data,AGE:a[3].data,DOB:a[4].data,RG_MOBILE_NO:a[5].data,GENDER:a[6].data,IPADM_SEQ_ID:a[7].data,ADMISSION_STATUS:a[8].data,RG_SEQ_ID:a[9].data};d.typeSearchList.push(i)}),(d.typeSearchList instanceof Array?d.typeSearchList:[d.typeSearchList]).map(function(e){return e})})}},d.onSelectregPat=function(e,t,a){d.search.pid=t.RG_INT_MR_NO},d.patientSearchModalpopUp=function(e){o.open("IP PATIENT SEARCH",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/depositRequests/partials/deposit.request.patient.search.modal.html",size:e,controller:"deporeqpatientSearchCtrl",controllerAs:"PatSearchCtrl"}).result.then(function(e){console.log("selectedItem",e),d.search.pid=e[0].RG_INT_MR_NO})},e.payerSearch=function(t){var i="%"+t+"%";e.payerName=[],d.multipleComboDataForList={1:e.payerName};var r=a.executeQueryURLReset();return d.payerNameList=new Array,a.prepareParamListWithParam("pCompCode",i,d.payerNameList),a.prepareParamListWithParam("pCompCode",i,d.payerNameList),a.prepareParamListWithParam("pCompName",i,d.payerNameList),a.prepareParamListWithParam("pCompName",i,d.payerNameList),a.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,d.payerNameList),a.executeQueryInput("GET_COPMANY_ACC_DTLS",d.payerNameList,d.multipleComboDataForList,!0,!0,r,"popUp",{}).then(function(e){return e[1]instanceof Array?e[1]:[e[1]]})},d.clksearch=function(){if(d.search.payer)var e=d.search.payer.REF_SEQ_ID,t=d.search.payer.INS_SEQ_ID;else e=-999,t=-999;""==d.search.category&&(d.search.category=-999);var i=moment(d.search.fromDate).format("YYYY-MM-DD HH:mm:ss"),r=moment(d.search.toDate).format("YYYY-MM-DD HH:mm:ss");d.billsrch=[],d.searchList={1:d.billsrch};var n=a.executeQueryURLReset(),l=new Array;return a.prepareParamListWithParam("pPracticeId",d.contextInfo.CLIENT_REF_ID,l),a.prepareParamListWithParam("pFacilityId",d.contextInfo.FACILITY_ID,l),a.prepareParamListWithParam("pFromDate",i,l),a.prepareParamListWithParam("pToDate",r,l),a.prepareParamListWithParam("pPatientId",d.search.pid,l),a.prepareParamListWithParam("pFirstName",d.search.patName,l),a.prepareParamListWithParam("pBllNo",d.search.billNo,l),a.prepareParamListWithParam("pPayerType",t,l),a.prepareParamListWithParam("pCategory",d.search.category,l),a.prepareParamListWithParam("pPayerSeqId",e,l),a.prepareParamListWithParam("pBillSeqId",-999,l),a.executeQueryInput("BILLING_POPUP_BILL_SEARCH",l,d.searchList,!0,!0,n,"popUp",{}).then(function(e){d.billSearchgridOpts.data=e[1]instanceof Array?e[1]:[e[1]]})},d.clear=function(){d.search={pid:"",fromDate:new Date,toDate:new Date,patName:"",billNo:"",payer:""},d.billSearchgridOpts.data=[]},d.billSearchgridOpts.onRegisterApi=function(e){d.gridApi=e,e.selection.on.rowSelectionChanged(d,function(e){e.isSelected})},d.addSelectedpat=function(){d.rowsSelected=d.gridApi.selection.getSelectedRows(),0!=d.rowsSelected.length&&t.close(d.rowsSelected)}}e.$inject=["$scope","$uibModalInstance","QueryService","hisAlertService","hisAlertConstants","dropdownQueryService","otComService","billSearchGridDefn","hisModalService","patObj"],angular.module("napierContainerUi").controller("mergeBillSrchModalCtrl",e)}(),function(){"use strict";function e(e){return{exportToExcel:function(n,l,s,o,c,d,p){var u=null!=c&&c.length>0?c:l.grid.options.showHeader?e.getColumnHeaders(l.grid,o):[],m=null!=d&&d.length>0?d:e.getData(l.grid,s,o),g=null!=p?p:l.grid.options.exporterExcelFilename?l.grid.options.exporterExcelFilename:"Napier Document";g+=".xlsx";var S=new t,v=function(e,t){var a={},n={s:{c:1e7,r:1e7},e:{c:0,r:0}},l=0;t.forEach(function(e){var s=e.displayName||e.value||t[i].name;r(n,s,0,l,a),l++},this);var s=1;e.forEach(function(e){l=0,e.forEach(function(e){var t=e.value;r(n,t,s,l,a),l++}),s++},this),n.s.c<1e7&&(a["!ref"]=XLSX.utils.encode_range(n));return a}(m,u);S.SheetNames.push(n),S.Sheets[n]=v;var D=XLSX.write(S,{bookType:"xlsx",bookSST:!0,type:"binary"});saveAs(new Blob([a(D)],{type:"application/octet-stream"}),g)}};function t(){if(!(this instanceof t))return new t;this.SheetNames=[],this.Sheets={}}function a(e){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),i=0;i!=e.length;++i)a[i]=255&e.charCodeAt(i);return t}function r(e,t,a,i,r){e.s.r>a&&(e.s.r=a),e.s.c>i&&(e.s.c=i),e.e.r<a&&(e.e.r=a),e.e.c<i&&(e.e.c=i);var n={v:t};null==n.v&&(n.v="-");var l,s,o=XLSX.utils.encode_cell({c:i,r:a});"number"==typeof n.v?n.t="n":"boolean"==typeof n.v?n.t="b":n.v instanceof Date?(n.t="n",n.z=XLSX.SSF._table[14],n.v=(l=n.v,s&&(l+=1462),(Date.parse(l)-new Date(Date.UTC(1899,11,30)))/864e5)):n.t="s",r[o]=n}}e.$inject=["uiGridExporterService"],angular.module("napierContainerUi").factory("exportUiGridService",e),e.inject=["uiGridExporterService"]}(),function(){"use strict";angular.module("napierContainerUi").constant("newTariffRateGridConstant",{enableSorting:!1,enableCellEditOnFocus:!1,showColumnFooter:!1,enableHorizontalScrollbar:1,enableVerticalScrollbar:1,exporterExcelFilename:"Tariff Rate Document",multiSelect:!0,enableFiltering:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("tariffRateModalGridDef",{enableSorting:!1,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScollbar:0,columnDefs:[{name:"Serve_name",displayName:"Service Name",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,headerCellFilter:"translate"},{name:"PAT_TYPE_DESC",displayName:"Patient Type",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,headerCellFilter:"translate"},{name:"BED_CLASS_DESC",displayName:"Bed Class",enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate"},{name:"rateObj",displayName:"Current Rate",enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:160,cellTemplate:'<div class="ui-grid-cell-contents"><div class="green-status"><span class="value">1000</span></div><div class="green-status"><span class="value" ng-if="false">{{row.entity.FUTURE_VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Min." ng-if="true" ng-model="row.entity.currentMinVal" ></div><div class="green-status"><span class="value" ng-if="false">{{row.entity.FUTURE_VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Max." ng-if="true" ng-model="row.entity.currentMaxVal" ></div></div>'},{name:"newRate",displayName:"New Rate",enableSorting:!0,enableCellEdit:!0,width:160,cellTemplate:'<div class="ui-grid-cell-contents"><div class="green-status"><span class="value">1000</span></div><div class="green-status"><span class="value" ng-if="false">{{row.entity.FUTURE_VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Min." ng-if="true" ng-model="row.entity.futureMinVal" ></div><div class="green-status"><span class="value" ng-if="false">{{row.entity.FUTURE_VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Max." ng-if="true" ng-model="row.entity.futureMaxVal" ></div></div>'}]})}(),function(){"use strict";function e(e,t,a,i){let r=function(e,t){let a="";for(let i=0;i<e.length;i++)a+=e[i][t],i!=e.length-1&&(a+=",");return a};this.getSplitDataValue=function(e,t){return r(e,t)};let n=function(e,t){let a=!0;for(let i=0;i<e.length;i++){if(e[i].name==t){a=!1;break}i==e.length-1&&(a=!0)}return a};this.getTariffDataServiceWise=function(l,s,o,c,d,p,u){let m=[],g={1:m},S=t.executeQueryURLReset(),v=new Array;t.prepareParamListWithParam("pPriServCode",null!=l&&null!=l.primarySrvGrp&&null!=l.primarySrvGrp.CODE?l.primarySrvGrp.CODE:-999,v),t.prepareParamListWithParam("pDeptCode",null!=l&&null!=l.department&&null!=l.department.DEPARTMENTCODE?l.department.DEPARTMENTCODE:-999,v),t.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,v),t.prepareParamListWithParam("pSpecialityCode",null!=l&&null!=l.speciality&&null!=l.speciality.CODE?l.speciality.CODE:-999,v),t.prepareParamListWithParam("pPatTypeCode",p?null!=u&&null!=u.patientType&&u.patientType.length>0?r(u.patientType,"DT_CODE"):r(s.prtList,"DT_CODE"):null!=l&&null!=l.patientType&&l.patientType.length>0?r(l.patientType,"DT_CODE"):r(s.prtList,"DT_CODE"),v),t.prepareParamListWithParam("pBedClassCode",p?null!=u&&null!=u.slctBed&&u.slctBed.length>0?r(u.slctBed,"CODE"):r(s.tariffClsList,"CODE"):null!=l&&null!=l.slctBed&&l.slctBed.length>0?r(l.slctBed,"CODE"):r(s.tariffClsList,"CODE"),v),10008==l.primarySrvGrp.CODE&&(t.prepareParamListWithParam("pDoctorSeqId",-999,v),t.prepareParamListWithParam("pIsDocOrSpec",l.is_slot,v)),s.serviceItemFlag?t.prepareParamListWithParam("pProrityCode",-999,v):o&&t.prepareParamListWithParam("pProrityCode",1,v),o?t.prepareParamListWithParam("pServSeqId",null!=l&&null!=l.serviceItem?l.serviceItem:-999,v):t.prepareParamListWithParam("pServSeqId",p?u.SERV_SEQ_ID:s.serviceItemFlag&&null!=l&&null!=l.serviceItem&&null!=l.serviceItem.SERV_SEQ_ID?l.serviceItem.SERV_SEQ_ID:-999,v),t.prepareParamListWithParam("pTariffCatCode",null!=l&&null!=l.assignTariffCat&&null!=l.assignTariffCat.CODE?l.assignTariffCat.CODE:-999,v),t.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,v);let D=s.serviceItemFlag||o?10008==l.primarySrvGrp.CODE?"GET_TARIFF_RATES_CONSULTATION_ITEM_LEVEL":"GET_SERVICE_ITEM_WISE_TARIFF_RATES":"GET_SERVICE_GROUP_WISE_TARIFF_RATES";t.executeQueryInput(D,v,g,!0,!0,S,"popUp",{}).then(function(t){if(s.flagSave=!0,m.length>0)if(s.serviceItemFlag||o){m&&m[0]&&null!=m[0].FA_IS_RATE_EDITABLE&&1==m[0].FA_IS_RATE_EDITABLE?(s.serviceItmsWiseGrid.columnDefs[5].visible=!0,s.serviceItmsWiseGrid.columnDefs[9].visible=!0):(s.serviceItmsWiseGrid.columnDefs[5].visible=!1,s.serviceItmsWiseGrid.columnDefs[9].visible=!1);let e=[];for(let t=0;t<m.length;t++)if(null!=m[t].FUTURE_EFFECTIVE_FROM&&null!=s.format&&(m[t].FUTURE_EFFECTIVE_FROM=new Date(m[t].FUTURE_EFFECTIVE_FROM)),null!=m[t].VALUE&&(s.flagSave=!0,m[t].flagHistory=!0),null!=m[t].FUTURE_VALUE&&(m[t].editShow=!0,s.flagSave=!0),null==m[t].DOCT_SHARE_VALUE&&(m[t].DOCT_SHARE_VALUE=0),null==m[t].DOCT_SHARE_TYPE?m[t].DOCT_SHARE_TYPE="1":m[t].DOCT_SHARE_TYPE=m[t].DOCT_SHARE_TYPE+"",2==m[t].SERV_PRIORITY){e[e.length-1].ASAP=m[t]}else if(3==m[t].SERV_PRIORITY){e[e.length-1].STAT=m[t]}else e.push(m[t]);s.srchObj.doctor&&s.autoCompletedFlag||(o?c.serviceItmsWiseGridData.data=e:s.serviceItmsWiseGrid.data=e,s.autoserviceWiseData=s.serviceItmsWiseGrid.data);var r=null!=e[0]&&e[0].SLOT?"SLOT":1==s.srchObj.is_slot?"DOCT_NAME":"SPL_NAME";if(null!=e[0]&&null!=e[0][r]){s.srchObj.assignTariffCat&&10008==s.srchObj.primarySrvGrp.CODE?(s.serviceItmsWiseGrid.columnDefs[11].visible=!0,s.serviceItmsWiseGrid.columnDefs[11].displayName=1==s.srchObj.is_slot?"By Doctor/Speciality":"By Speciality",s.gridApiItem.core.notifyDataChange(i.dataChange.COLUMN),s.serviceItmsWiseGrid.columnDefs[1].visible=!1):(s.serviceItmsWiseGrid.columnDefs[11].visible=!1,s.serviceItmsWiseGrid.columnDefs[1].visible=!0);for(let t=0;t<e.length;t++)if(0==t||null==e[t+1]||e[t][r]!=e[t+1][r]){let a=0;for(let i=0;i<s.serviceItmsWiseGrid.data.length;i++)e[t][r]==s.serviceItmsWiseGrid.data[i][r]&&(a+=1,s.serviceItmsWiseGrid.data[i].$$treeLevel=a>1?1:0)}o&&(c.serviceItmsWiseGridData.columnDefs[0].visible=!0,c.serviceItmsWiseGridData.columnDefs[4].visible=!1,c.serviceItmsWiseGridData.columnDefs[5].visible=!0,c.serviceItmsWiseGridData.columnDefs[6].visible=!1,c.serviceItmsWiseGridData.columnDefs[7].visible=!1,c.serviceItmsWiseGridData.columnDefs[8].visible=!1,c.serviceItmsWiseGridData.columnDefs[9].visible=!0,c.serviceItmsWiseGridData.columnDefs[10].visible=!1)}else o?(c.serviceItmsWiseGridData.columnDefs[0].visible=!1,c.serviceItmsWiseGridData.columnDefs[4].visible=!1,c.serviceItmsWiseGridData.columnDefs[5].visible=!0,c.serviceItmsWiseGridData.columnDefs[6].visible=!1,c.serviceItmsWiseGridData.columnDefs[7].visible=!1,c.serviceItmsWiseGridData.columnDefs[8].visible=!1,c.serviceItmsWiseGridData.columnDefs[9].visible=!0,c.serviceItmsWiseGridData.columnDefs[10].visible=!1):(s.serviceItmsWiseGrid.columnDefs[0].visible=!1,s.serviceItmsWiseGrid.columnDefs[1].visible=!1,s.serviceItmsWiseGrid.columnDefs[11].visible=!1);if(o)for(let e=0;e<c.serviceItmsWiseGridData.data.length;e++)if(1!=c.serviceItmsWiseGridData.data[e].PAT_TYPE_CODE)for(let t=0;t<s.groupWiseGrid.category.length;t++){let a=!1;if(null!=d.entity[s.groupWiseGrid.category[t].name])for(let i=0;i<s.groupWiseGrid.columnDefs.length;i++)if(null!=d.entity[s.groupWiseGrid.category[t].name][s.groupWiseGrid.columnDefs[i].name]&&null!=c.serviceItmsWiseGridData.data[e].BED_CLASS_CODE&&null!=d.entity[s.groupWiseGrid.category[t].name][s.groupWiseGrid.columnDefs[i].name].BED_CLASS_CODE&&c.serviceItmsWiseGridData.data[e].BED_CLASS_CODE==d.entity[s.groupWiseGrid.category[t].name][s.groupWiseGrid.columnDefs[i].name].BED_CLASS_CODE){c.serviceItmsWiseGridData.data[e].VALUE=d.entity[s.groupWiseGrid.category[t].name][s.groupWiseGrid.columnDefs[i].name].VALUE,c.serviceItmsWiseGridData.data[e].FUTURE_VALUE=d.entity[s.groupWiseGrid.category[t].name][s.groupWiseGrid.columnDefs[i].name].FUTURE_VALUE,a=!0;break}if(a)break}else c.serviceItmsWiseGridData.data[e].VALUE=d.entity.VALUE,c.serviceItmsWiseGridData.data[e].FUTURE_VALUE=d.entity.FUTURE_VALUE;if(p)for(let e=0;e<u.dataVal.length;e++)if(null!=u.dataVal[e][s.exportGrid[5].displayName]&&s.serviceItmsWiseGrid.data[e].PAT_TYPE_DESC==u.dataVal[e][s.exportGrid[5].displayName])for(let t=0;t<s.exportGrid.length;t++)null!=u.dataVal[e][s.exportGrid[t].displayName]&&"-"!=u.dataVal[e][s.exportGrid[t].displayName]&&("ASAP"==s.exportGrid[t].name?8==t?s.serviceItmsWiseGrid.data[e][s.exportGrid[t].name].VALUE=u.dataVal[e][s.exportGrid[t].displayName]:14==t&&(s.serviceItmsWiseGrid.data[e][s.exportGrid[t].name].FUTURE_VALUE=u.dataVal[e][s.exportGrid[t].displayName],u.dataVal[e]["Effective From"]&&(s.serviceItmsWiseGrid.data[e][s.exportGrid[t].name].FUTURE_EFFECTIVE_FROM=u.dataVal[e]["Effective From"])):"STAT"==s.exportGrid[t].name?9==t?s.serviceItmsWiseGrid.data[e][s.exportGrid[t].name].VALUE=u.dataVal[e][s.exportGrid[t].displayName]:15==t&&(s.serviceItmsWiseGrid.data[e][s.exportGrid[t].name].FUTURE_VALUE=u.dataVal[e][s.exportGrid[t].displayName],u.dataVal[e]["Effective From"]&&(s.serviceItmsWiseGrid.data[e][s.exportGrid[t].name].FUTURE_EFFECTIVE_FROM=u.dataVal[e]["Effective From"])):"FUTURE_EFFECTIVE_FROM"==s.exportGrid[t].name?s.serviceItmsWiseGrid.data[e][s.exportGrid[t].name]=new Date(u.dataVal[e][s.exportGrid[t].displayName]):s.serviceItmsWiseGrid.data[e][s.exportGrid[t].name]=u.dataVal[e][s.exportGrid[t].displayName])}else{a.newTariffRateGetColDef(s.groupWiseGrid);let e=[];for(let t=0;t<m.length;t++){let a=!0;if(s.groupWiseGrid.category.length>0){for(let e=0;e<s.groupWiseGrid.category.length;e++){if(s.groupWiseGrid.category[e].name==m[t].PAT_TYPE_DESC){a=!1;break}s.groupWiseGrid.category.length-1==e&&(a=!0)}a&&s.groupWiseGrid.category.push({name:m[t].PAT_TYPE_DESC,visible:!0})}if(null==m[t].BED_CLASS_DESC&&(null!=m[t+1]&&m[t].PAT_TYPE_DESC==m[t+1].PAT_TYPE_DESC||null==m[t+1]&&null!=m[t-1]&&m[t].PAT_TYPE_DESC==m[t-1].PAT_TYPE_DESC||null!=m[t].PAT_TYPE_DESC)){let e=m[t].PAT_TYPE_DESC+"VALUE";n(s.groupWiseGrid.columnDefs,e)&&s.groupWiseGrid.columnDefs.push({name:m[t].PAT_TYPE_DESC+"VALUE",displayName:"Current Rate",category:m[t].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"80",cellTemplate:'<div class="ui-grid-cell-contents"><div><span class="value" ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+".VALUE!=undefined&&!row.entity."+[m[t].PAT_TYPE_DESC]+'.currentRateChange" tooltip-placement="bottom" uib-tooltip="Applicable From {{row.entity.'+[m[t].PAT_TYPE_DESC]+'.EFFECTIVE_FROM|date :grid.appScope.trf.format}}" tooltip-class="customClass" tooltip-append-to-body=true>{{row.entity.'+[m[t].PAT_TYPE_DESC]+'.VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Enter" number-with-decimal ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+".VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+'.currentRateChange" ng-disabled="row.entity.'+[m[t].PAT_TYPE_DESC]+'.SERV_SEQ_ID==undefined" ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+'.VALUE" ng-change="row.entity.'+[m[t].PAT_TYPE_DESC]+".currentRateChange=true;row.entity."+[m[t].PAT_TYPE_DESC]+".docFlag=true;grid.appScope.trf.changeValue(row.entity."+[m[t].PAT_TYPE_DESC]+",grid.appScope.trf,rowRenderIndex);grid.appScope.trf.saveValidtion();grid.appScope.trf.changeDocShare(row.entity."+[m[t].PAT_TYPE_DESC]+",grid.appScope.trf,rowRenderIndex);grid.appScope.trf.doctValid(row.entity."+[m[t].PAT_TYPE_DESC]+')" ></div></div>'},{name:"DOCT_SHARE_VALUE"+t,displayName:"Dr. Share",category:m[t].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"120",cellTemplate:'<div class="ui-grid-cell-contents"><span class="value" ng-if="(row.entity.'+[m[t].PAT_TYPE_DESC]+".DOCT_SHARE_VALUE!=undefined&&!row.entity."+[m[t].PAT_TYPE_DESC]+'.docFlag)">{{row.entity.'+[m[t].PAT_TYPE_DESC]+'.DOCT_SHARE_VALUE}}<span ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+'.DOCT_SHARE_VALUE!=undefined">{{row.entity.'+[m[t].PAT_TYPE_DESC]+'.DOCT_SHARE_TYPE==\'1\'?"%":"Amt"}}</span></span><div ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+".SERV_PRIORITY==1&&(row.entity."+[m[t].PAT_TYPE_DESC]+".DOCT_SHARE_VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+'.docFlag)"><input type="text" class="tr-grid-textbox" ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+'.DOCT_SHARE_VALUE" ng-disabled="row.entity.'+[m[t].PAT_TYPE_DESC]+".SERV_PRIORITY!=1||(row.entity."+[m[t].PAT_TYPE_DESC]+".VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+".VALUE=='')\" ng-change=\"row.entity."+[m[t].PAT_TYPE_DESC]+".docFlag=true;grid.appScope.trf.changeDocShare(row.entity."+[m[t].PAT_TYPE_DESC]+',grid.appScope.trf,rowRenderIndex)" style="width:50%" number-with-decimal ng-blur="grid.appScope.trf.doctValid(row.entity.'+[m[t].PAT_TYPE_DESC]+')"><select class="tr-grid-textbox"   ng-disabled="row.entity.'+[m[t].PAT_TYPE_DESC]+".SERV_PRIORITY!=1||(row.entity."+[m[t].PAT_TYPE_DESC]+".VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+".VALUE=='')\" ng-model=\"row.entity."+[m[t].PAT_TYPE_DESC]+'.DOCT_SHARE_TYPE" style="width:50%;padding-left:0px !important; padding-right:0px !important;" ng-change="row.entity.'+[m[t].PAT_TYPE_DESC]+".docFlag=true;grid.appScope.trf.changeDocShareType(row.entity."+[m[t].PAT_TYPE_DESC]+',grid.appScope.trf,rowRenderIndex)"><option value="1"><span class="tr-addon">%</span></option><option value="2"><span class="tr-addon">Amt</span></option></select></div><div  ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+".SERV_PRIORITY!=1&&(row.entity."+[m[t].PAT_TYPE_DESC]+".DOCT_SHARE_VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+'.docFlag)"><input type="text" class="tr-grid-textbox" ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+'.DOCT_SHARE_VALUE" ng-disabled="row.entity.'+[m[t].PAT_TYPE_DESC]+'.SERV_PRIORITY!=1"  style="width:100%" number-with-decimal></div></div>'},{name:"FUTURE_VALUE"+t,displayName:"New Rate",category:m[t].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"80",cellTemplate:'<div class="ui-grid-cell-contents"><span class="value" ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+".FUTURE_VALUE!=undefined&&!row.entity."+[m[t].PAT_TYPE_DESC]+'.editFlag">{{row.entity.'+[m[t].PAT_TYPE_DESC]+'.FUTURE_VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Enter" ng-disabled="row.entity.'+[m[t].PAT_TYPE_DESC]+'.SERV_SEQ_ID==undefined"  ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+".FUTURE_VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+'.editFlag" ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+'.FUTURE_VALUE" ng-change="row.entity.'+[m[t].PAT_TYPE_DESC]+".editFlag=true;grid.appScope.trf.saveValidtion();grid.appScope.trf.changeFutureValue(row.entity."+[m[t].PAT_TYPE_DESC]+',grid.appScope.trf,rowRenderIndex);" number-with-decimal></div>'},{name:"FUTURE_EFFECTIVE_FROM"+t,displayName:"Effective From",category:m[t].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"150",cellTemplate:'<div class=""><span ng-if="(row.entity.'+[m[t].PAT_TYPE_DESC]+".FUTURE_EFFECTIVE_FROM!=undefined&&!row.entity."+[m[t].PAT_TYPE_DESC]+'.editFlag)">{{row.entity.'+[m[t].PAT_TYPE_DESC]+'.FUTURE_EFFECTIVE_FROM|date:grid.appScope.trf.format}}</span><div class="input-group" ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+".SERV_PRIORITY==1&&(row.entity."+[m[t].PAT_TYPE_DESC]+".FUTURE_EFFECTIVE_FROM==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+'.editFlag)"><input type="text" class="form-control" uib-datepicker-popup="{{grid.appScope.trf.format}}" ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+'.FUTURE_EFFECTIVE_FROM" ng-disabled="row.entity.'+[m[t].PAT_TYPE_DESC]+".FUTURE_VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+'.FUTURE_VALUE==\'\'" is-open="grid.appScope.trf.opened1[rowRenderIndex]"  ng-focus="grid.appScope.trf.opened1[rowRenderIndex]=true"   show-button-bar="false" datepicker-options="grid.appScope.trf.dateOptions" ng-change="row.entity.'+[m[t].PAT_TYPE_DESC]+".editFlag=true;row.entity."+[m[t].PAT_TYPE_DESC]+".colorRed=false;grid.appScope.trf.changeFutureDate(row.entity."+[m[t].PAT_TYPE_DESC]+",grid.appScope.trf,rowRenderIndex);row.entity."+[m[t].PAT_TYPE_DESC]+".docFlag=true;\"  ng-class=\"{'colorRedTariff': row.entity."+[m[t].PAT_TYPE_DESC]+'.colorRed}"  datepicker-append-to-body=true /><div class="input-group-btn"><button type="button"  class="btn btn-default" ng-click="grid.appScope.trf.opened1[rowRenderIndex]=true" style="padding: 3px 10px 2px 10px;"><i class="fa fa-calendar"></i></button></div></div><div ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+".SERV_PRIORITY!=1&&(row.entity."+[m[t].PAT_TYPE_DESC]+".FUTURE_EFFECTIVE_FROM==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+'.editFlag)"><input type="text" style="position: relative; top:2px; height: 24px;" ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+'.FUTURE_EFFECTIVE_FROM" uib-datepicker-popup="{{grid.appScope.trf.format}}" ng-disabled="true"></div></div>'})}else if(null!=m[t].BED_CLASS_DESC&&(null!=m[t+1]&&null!=m[t+1].BED_CLASS_DESC&&m[t].BED_CLASS_DESC==m[t+1].BED_CLASS_DESC||null==m[t+1]&&null!=m[t-1].BED_CLASS_DESC&&m[t].BED_CLASS_DESC==m[t-1].BED_CLASS_DESC||null!=m[t+1]&&m[t].PAT_TYPE_DESC==m[t+1].PAT_TYPE_DESC||null==m[t+1]&&m[t].PAT_TYPE_DESC==m[t-1].PAT_TYPE_DESC||null!=m[t].BED_CLASS_DESC)){let e=m[t].PAT_TYPE_DESC+m[t].BED_CLASS_CODE;n(s.groupWiseGrid.columnDefs,e)&&s.groupWiseGrid.columnDefs.push({name:null!=m[t].BED_CLASS_CODE?m[t].PAT_TYPE_DESC+m[t].BED_CLASS_CODE:"VALUE"+t,displayName:m[t].BED_CLASS_DESC?m[t].BED_CLASS_DESC:"Current Rate",category:m[t].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"80",cellTemplate:'<div class="ui-grid-cell-contents"><div><span class="value" ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".VALUE!=undefined&&!row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.currentRateChange" tooltip-placement="bottom" uib-tooltip="Applicable From {{row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.EFFECTIVE_FROM|date :grid.appScope.trf.format}}" tooltip-class="customClass" tooltip-append-to-body=true>{{row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.VALUE|number:2}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Enter" ng-disabled="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.SERV_SEQ_ID==undefined"  ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.currentRateChange" number-with-decimal ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.VALUE" ng-change="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".currentRateChange=true;row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".docFlag=true;grid.appScope.trf.changeValue(row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+",grid.appScope.trf,rowRenderIndex);grid.appScope.trf.saveValidtion();grid.appScope.trf.doctValid(row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+')"></div></div>'},{name:"DOCT_SHARE_VALUE"+t,displayName:"Dr. Share",category:m[t].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"120",cellTemplate:'<div class="ui-grid-cell-contents"><span class="value" ng-if="(row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".DOCT_SHARE_VALUE!=undefined&&!row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.docFlag)">{{row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.DOCT_SHARE_VALUE|number:2}}<span ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.DOCT_SHARE_VALUE!=undefined">{{row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.DOCT_SHARE_TYPE==\'1\'?"%":"Amt"}}</span></span><div ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".SERV_PRIORITY==1&&(row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".DOCT_SHARE_VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.docFlag)"><input type="text" class="tr-grid-textbox" style="width:50%"  ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.DOCT_SHARE_VALUE" ng-disabled="(row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".VALUE=='')\" number-with-decimal ng-change=\"row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".docFlag=true;grid.appScope.trf.changeDocShare(row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+',grid.appScope.trf,rowRenderIndex)" ng-blur="grid.appScope.trf.doctValid(row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+')"><select class="tr-grid-textbox" ng-disabled="(row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".VALUE=='')\" ng-if=\"row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".DOCT_SHARE_VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.docFlag" ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.DOCT_SHARE_TYPE" style="width:50%;padding-left:0px !important; padding-right:0px !important;" ng-init="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".DOCT_SHARE_TYPE==undefined?row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".DOCT_SHARE_TYPE='1':undefined\" ng-change=\"row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".docFlag=true;grid.appScope.trf.changeDocShareType(row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+',grid.appScope.trf,rowRenderIndex)"><option value="1"><span class="tr-addon">%</span></option><option value="2"><span class="tr-addon">Amt</span></option></select></div><div  ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".SERV_PRIORITY!=1&&(row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".DOCT_SHARE_VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.docFlag)"><input type="text" class="tr-grid-textbox" ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.DOCT_SHARE_VALUE" ng-disabled="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.SERV_PRIORITY!=1"  style="width:100%" number-with-decimal></div></div>'},{name:"FUTURE_VALUE"+t,displayName:"New Rate",category:m[t].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"80",cellTemplate:'<div class="ui-grid-cell-contents"><div><span class="value" ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".FUTURE_VALUE!=undefined&&!row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.editFlag">{{row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.FUTURE_VALUE|number:2}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Enter" ng-disabled="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.SERV_SEQ_ID==undefined"  ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".FUTURE_VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.editFlag" number-with-decimal ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.FUTURE_VALUE"  ng-change="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".editFlag=true;grid.appScope.trf.changeFutureValue(row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+',grid.appScope.trf,rowRenderIndex);grid.appScope.trf.saveValidtion();"></div></div>'},{name:"FUTURE_EFFECTIVE_FROM"+t,displayName:"Effective From",category:m[t].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"150",cellTemplate:'<div class=""><span ng-if="(row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".FUTURE_EFFECTIVE_FROM!=undefined&&!row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.editFlag)">{{row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.FUTURE_EFFECTIVE_FROM|date:grid.appScope.trf.format}}</span><div class="input-group" ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".SERV_PRIORITY==1&&(row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".FUTURE_EFFECTIVE_FROM==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.editFlag)"><input type="text" class="form-control" ng-disabled="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".FUTURE_VALUE==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".FUTURE_VALUE==''\" ng-class=\"{'colorRedTariff': row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.colorRed}" uib-datepicker-popup="{{grid.appScope.trf.format}}" ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.FUTURE_EFFECTIVE_FROM" is-open="grid.appScope.trf.opened'+t+'[rowRenderIndex]"  ng-focus="grid.appScope.trf.opened'+t+'[rowRenderIndex]=true"  show-button-bar="false" datepicker-options="grid.appScope.trf.dateOptions" ng-change="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".colorRed=false;row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".editFlag=true;grid.appScope.trf.changeFutureDate(row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+",grid.appScope.trf,rowRenderIndex);row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.docFlag=true;"  datepicker-append-to-body=true /><div class="input-group-btn"><button type="button" style="padding: 3px 10px 2px 10px;" class="btn btn-default" ng-click="grid.appScope.trf.opened'+t+'[rowRenderIndex]=true"><i class="fa fa-calendar"></i></button></div></div><div ng-if="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".SERV_PRIORITY!=1&&(row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+".FUTURE_EFFECTIVE_FROM==undefined||row.entity."+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.editFlag)"><input type="text" style="position: relative; top:2px; height: 24px;" ng-model="row.entity.'+[m[t].PAT_TYPE_DESC]+"."+[m[t].PAT_TYPE_DESC]+[m[t].BED_CLASS_CODE]+'.FUTURE_EFFECTIVE_FROM" uib-datepicker-popup="{{grid.appScope.trf.format}}" ng-disabled="true"></div></div>'})}if(null!=m[t].FUTURE_EFFECTIVE_FROM&&null!=s.format&&(m[t].FUTURE_EFFECTIVE_FROM=new Date(m[t].FUTURE_EFFECTIVE_FROM)),null==m[t].DOCT_SHARE_TYPE?m[t].DOCT_SHARE_TYPE="1":null!=m[t].DOCT_SHARE_TYPE&&(m[t].DOCT_SHARE_TYPE=m[t].DOCT_SHARE_TYPE+""),null!=m[t].VALUE&&(s.flagSave=!0,m[t].flagHistory=!0),null!=m[t].FUTURE_VALUE&&(m[t].editShow=!0,s.flagSave=!0),e.length>0)for(let a=0;a<e.length;a++){if(e[a].SERV_CODE==m[t].SERV_CODE&&e[a].SERV_PRIORITY==m[t].SERV_PRIORITY){if(null!=m[t].BED_CLASS_CODE){null==e[a][m[t].PAT_TYPE_DESC]&&(e[a][m[t].PAT_TYPE_DESC]={});let i=[m[t].PAT_TYPE_DESC]+""+[m[t].BED_CLASS_CODE];e[a][m[t].PAT_TYPE_DESC][i]={},e[a][m[t].PAT_TYPE_DESC][i]=m[t]}else null==e[a][m[t].PAT_TYPE_DESC]&&(e[a][m[t].PAT_TYPE_DESC]={}),e[a][m[t].PAT_TYPE_DESC]=m[t];break}if(e.length-1==a){if(e.push(m[t]),null!=m[t].BED_CLASS_CODE){null==e[a+1][m[t].PAT_TYPE_DESC]&&(e[a+1][m[t].PAT_TYPE_DESC]={});let i=[m[t].PAT_TYPE_DESC]+""+[m[t].BED_CLASS_CODE];e[a+1][m[t].PAT_TYPE_DESC][i]={},e[a+1][m[t].PAT_TYPE_DESC][i]=m[t]}else null==e[a+1][m[t].PAT_TYPE_DESC]&&(e[a+1][m[t].PAT_TYPE_DESC]={}),e[a+1][m[t].PAT_TYPE_DESC]=m[t];break}}else if(e.push(m[t]),null!=m[t].BED_CLASS_CODE){null==e[0][m[t].PAT_TYPE_DESC]&&(e[0][m[t].PAT_TYPE_DESC]={});let a=[m[t].PAT_TYPE_DESC]+""+[m[t].BED_CLASS_CODE];e[0][m[t].PAT_TYPE_DESC][a]={},e[0][m[t].PAT_TYPE_DESC][a]=m[t]}else null==e[0][m[t].PAT_TYPE_DESC]&&(e[0][m[t].PAT_TYPE_DESC]={}),e[0][m[t].PAT_TYPE_DESC]=m[t]}if(s.groupWiseGrid.columnDefs.push({name:"Action",displayName:"billing.action",enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",pinnedRight:!0,width:"100",cellTemplate:'<div class="ui-grid-cell-contents grid-actions"><i class="fa fa-pencil" ng-click="grid.appScope.trf.editRecord(row.entity,rowRenderIndex);" ng-if="row.entity.editShow&&grid.appScope.trf.roleTask.T_BL_M_TARIFF_RATE_U!=undefined"></i><i ng-click="grid.appScope.trf.getTariffHistory(row.entity);" class="fa fa-refresh"></i><i class="fa fa-arrows-h" ng-if="row.entity.FA_IS_RATE_EDITABLE==1&&row.entity.SERV_PRIORITY==1" ng-click="grid.appScope.trf.minAndMaxPopUp(row,rowRenderIndex);"></i></div>'}),s.groupWiseGrid.data=[],p){for(let t=0;t<u.dataVal.length;t++)for(let a=0;a<s.groupWiseGrid.category.length;a++)if(null!=e[t][s.groupWiseGrid.category[a].name])for(let i=0;i<s.groupWiseGrid.columnDefs.length;i++)if(null!=e[t][s.groupWiseGrid.category[a].name]&&null!=e[t][s.groupWiseGrid.category[a].name][s.groupWiseGrid.columnDefs[i].name]&&null!=e[t][s.groupWiseGrid.category[a].name][s.groupWiseGrid.columnDefs[i].name].BED_CLASS_CODE)for(let r=5;r<u.headerNames.length;r++)if(s.groupWiseGrid.columnDefs[i].displayName==u.headerNames[r]){if(null!=u.dataVal[t][u.headerNames[r]]){null!=u.dataVal[t][u.headerNames[r]]&&"-"!=u.dataVal[t][u.headerNames[r]]&&(e[t][s.groupWiseGrid.category[a].name][s.groupWiseGrid.columnDefs[i].name].VALUE=u.dataVal[t][u.headerNames[r]]),null!=u.dataVal[t][u.headerNames[r+1]]&&"-"!=u.dataVal[t][u.headerNames[r+1]]&&(e[t][s.groupWiseGrid.category[a].name][s.groupWiseGrid.columnDefs[i].name].DOCT_SHARE_VALUE=u.dataVal[t][u.headerNames[r+1]]),null!=u.dataVal[t][u.headerNames[r+2]]&&"-"!=u.dataVal[t][u.headerNames[r+2]]&&(e[t][s.groupWiseGrid.category[a].name][s.groupWiseGrid.columnDefs[i].name].FUTURE_VALUE=u.dataVal[t][u.headerNames[r+2]]),null!=e[t][s.groupWiseGrid.category[a].name][s.groupWiseGrid.columnDefs[i].name].FUTURE_VALUE&&(e[t].editShow=!0),null!=u.dataVal[t][u.headerNames[r+3]]&&"-"!=u.dataVal[t][u.headerNames[r+3]]&&(e[t][s.groupWiseGrid.category[a].name][s.groupWiseGrid.columnDefs[i].name].FUTURE_EFFECTIVE_FROM=new Date(u.dataVal[t][u.headerNames[r+3]]));break}}else r+=3;else if(null!=e[t][s.groupWiseGrid.category[a].name]&&null!=e[t][s.groupWiseGrid.category[a].name].SERV_SEQ_ID&&s.groupWiseGrid.columnDefs[i].category==s.groupWiseGrid.category[a].name)for(let r=5;r<u.headerNames.length;r++)if(s.groupWiseGrid.columnDefs[i].displayName==u.headerNames[r]){if(null!=u.dataVal[t][u.headerNames[r]]){null!=u.dataVal[t][u.headerNames[r]]&&"-"!=u.dataVal[t][u.headerNames[r]]&&(e[t][s.groupWiseGrid.category[a].name].VALUE=u.dataVal[t][u.headerNames[r]]),null!=u.dataVal[t][u.headerNames[r+1]]&&"-"!=u.dataVal[t][u.headerNames[r+1]]&&(e[t][s.groupWiseGrid.category[a].name].DOCT_SHARE_VALUE=u.dataVal[t][u.headerNames[r+1]]),null!=u.dataVal[t][u.headerNames[r+2]]&&"-"!=u.dataVal[t][u.headerNames[r+2]]&&(e[t][s.groupWiseGrid.category[a].name].FUTURE_VALUE=u.dataVal[t][u.headerNames[r+2]]),null!=e[t][s.groupWiseGrid.category[a].name].FUTURE_VALUE&&(e[t].editShow=!0),null!=u.dataVal[t][u.headerNames[r+3]]&&"-"!=u.dataVal[t][u.headerNames[r+3]]&&(e[t][s.groupWiseGrid.category[a].name].FUTURE_EFFECTIVE_FROM=new Date(u.dataVal[t][u.headerNames[r+3]]));break}}else r+=3;s.groupWiseGrid.data=e}else s.groupWiseGrid.data=e}else s.serviceItemFlag||o?o?c.serviceItmsWiseGridData.data=[]:s.serviceItmsWiseGrid.data=[]:s.groupWiseGrid.data=[],e.information("Information","No Record(s) Found")})},this.getTariffDataForHistory=function(e,a){let i=[],r={1:i},l=t.executeQueryURLReset(),s=new Array;t.prepareParamListWithParam("pPriSerType",null!=e&&null!=e.primarySrvGrp&&null!=e.primarySrvGrp.CODE?e.primarySrvGrp.CODE:-999,s),t.prepareParamListWithParam("pRevSevId",null!=e&&null!=e.RCV_SEQ_ID?e.RCV_SEQ_ID:-999,s),t.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,s),t.prepareParamListWithParam("pPriority",null!=e&&null!=e.SERV_PRIORITY?e.SERV_PRIORITY:-999,s),t.prepareParamListWithParam("pPatType",e.PAT_TYPE_CODE,s),t.prepareParamListWithParam("pSerSeqId",e.SERV_SEQ_ID?e.SERV_SEQ_ID:-999,s),t.prepareParamListWithParam("pTariffCode",null!=e&&null!=e.assignTariffCat&&null!=e.assignTariffCat.CODE?e.assignTariffCat.CODE:-999,s),t.executeQueryInput("GET_TARIFF_HISTORY",s,r,!0,!0,l,"popUp",{}).then(function(e){a.gridOptions.category=[];let t=[];for(let e=0;e<i.length;e++){let r=!0;if(a.gridOptions.category.length>0){for(let t=0;t<a.gridOptions.category.length;t++){if(a.gridOptions.category[t].name==i[e].PAT_TYPE_DESC){r=!1;break}a.gridOptions.category.length-1==t&&(r=!0)}r&&a.gridOptions.category.push({name:i[e].PAT_TYPE_DESC,visible:!0})}else a.gridOptions.category.push({name:i[e].PAT_TYPE_DESC,visible:!0});if(""==i[e].BED_CLASS_DESC||null==i[e].BED_CLASS_DESC&&(null!=i[e+1]&&i[e].PAT_TYPE_DESC==i[e+1].PAT_TYPE_DESC||null==i[e+1]&&null!=i[e-1]&&i[e].PAT_TYPE_DESC==i[e-1].PAT_TYPE_DESC)){let t=i[e].PAT_TYPE_DESC+"VALUE";n(a.gridOptions.columnDefs,t)&&a.gridOptions.columnDefs.push({name:i[e].PAT_TYPE_DESC+"VALUE",displayName:"Rate",category:i[e].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"60",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.VALUE}}</span></div>'},{name:"FUTURE_EFFECTIVE_FROM"+e,displayName:"Effective Date",category:i[e].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"150",cellTemplate:'<div class="input-group"><div style="padding-top: 6px; float:left;" ng-if="grid.appScope.trf.format" >{{row.entity.EFFECTIVE_FROM | date:grid.appScope.trf.format}}</div><div style="padding-top: 6px; float:left;" ng-if="row.entity.EFFECTIVE_TO"> - {{row.entity.EFFECTIVE_TO | date:grid.appScope.trf.format}}</div></div>'})}else if(null!=i[e].BED_CLASS_DESC&&(null!=i[e+1]&&null!=i[e+1].BED_CLASS_DESC&&i[e].BED_CLASS_DESC==i[e+1].BED_CLASS_DESC||null!=i[e-1]&&null!=i[e-1].BED_CLASS_DESC&&i[e].BED_CLASS_DESC==i[e-1].BED_CLASS_DESC||null!=i[e+1]&&i[e].PAT_TYPE_DESC==i[e+1].PAT_TYPE_DESC||null!=i[e+1]&&i[e].PAT_TYPE_DESC==i[e-1].PAT_TYPE_DESC||null==i[e+1]&&null==i[e-1])){let t=i[e].PAT_TYPE_DESC+i[e].BED_CLASS_CODE;n(a.gridOptions.columnDefs,t)&&a.gridOptions.columnDefs.push({name:null!=i[e].BED_CLASS_CODE?i[e].PAT_TYPE_DESC+i[e].BED_CLASS_CODE:"VALUE"+e,displayName:i[e].BED_CLASS_DESC?i[e].BED_CLASS_DESC:"Current Rate",category:i[e].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"80",cellTemplate:'<div class="ui-grid-cell-contents"><div><span class="value" ng-if="row.entity.'+[i[e].PAT_TYPE_DESC]+"."+[i[e].PAT_TYPE_DESC]+[i[e].BED_CLASS_CODE]+'.VALUE!=undefined">{{row.entity.'+[i[e].PAT_TYPE_DESC]+"."+[i[e].PAT_TYPE_DESC]+[i[e].BED_CLASS_CODE]+".VALUE}}</span></div></div>"},{name:"FUTURE_EFFECTIVE_FROM"+e,displayName:"Effective Date",category:i[e].PAT_TYPE_DESC,enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"150",cellTemplate:'<div class="input-group"><div style="padding-top: 6px; float:left;" ng-if="grid.appScope.trf.format" >{{row.entity.EFFECTIVE_FROM | date:grid.appScope.trf.format}}</div> - <div style="padding-top: 6px; float:left;" ng-if="row.entity.EFFECTIVE_TO">{{row.entity.EFFECTIVE_TO | date:grid.appScope.trf.format}}</div></div>'})}if(t.length>0)for(let a=0;a<t.length;a++){if(t[a].SERV_CODE==i[e].SERV_CODE&&t[a].SERV_PRIORITY==i[e].SERV_PRIORITY){if(null!=i[e].BED_CLASS_CODE){null==t[a][i[e].PAT_TYPE_DESC]&&(t[a][i[e].PAT_TYPE_DESC]={});let r=[i[e].PAT_TYPE_DESC]+""+[i[e].BED_CLASS_CODE];t[a][i[e].PAT_TYPE_DESC][r]={},t[a][i[e].PAT_TYPE_DESC][r]=i[e]}break}t.length-1==a&&t.push(i[e])}else t.push(i[e])}a.gridOptions.data=t})},this.getMaxMinData=function(e,t,a){for(let t=0;t<e.length;t++)null!=trf.groupWiseGrid.data[a]&&(null!=trf.groupWiseGrid.data[a][e[t].PAT_TYPE_DESC][e[t].PAT_TYPE_DESC+e[t].BED_CLASS_CODE]?trf.groupWiseGrid.data[a][e[t].PAT_TYPE_DESC][e[t].PAT_TYPE_DESC+e[t].BED_CLASS_CODE].BED_CLASS_CODE==e[t].BED_CLASS_CODE&&(trf.groupWiseGrid.data[a][e[t].PAT_TYPE_DESC][e[t].PAT_TYPE_DESC+e[t].BED_CLASS_CODE].MIN_VALUE=e[t].MIN_VALUE,trf.groupWiseGrid.data[a][e[t].PAT_TYPE_DESC][e[t].PAT_TYPE_DESC+e[t].BED_CLASS_CODE].MAX_VALUE=e[t].MAX_VALUE,trf.groupWiseGrid.data[a][e[t].PAT_TYPE_DESC][e[t].PAT_TYPE_DESC+e[t].BED_CLASS_CODE].FUTURE_MIN_VALUE=e[t].FUTURE_MIN_VALUE,trf.groupWiseGrid.data[a][e[t].PAT_TYPE_DESC][e[t].PAT_TYPE_DESC+e[t].BED_CLASS_CODE].FUTURE_MAX_VALUE=e[t].FUTURE_MAX_VALUE):null!=trf.groupWiseGrid.data[a][e[t].PAT_TYPE_DESC]&&(trf.groupWiseGrid.data[a][e[t].PAT_TYPE_DESC].MIN_VALUE=e[t].MIN_VALUE,trf.groupWiseGrid.data[a][e[t].PAT_TYPE_DESC].MAX_VALUE=e[t].MAX_VALUE,trf.groupWiseGrid.data[a][e[t].PAT_TYPE_DESC].FUTURE_MIN_VALUE=e[t].FUTURE_MIN_VALUE,trf.groupWiseGrid.data[a][e[t].PAT_TYPE_DESC].FUTURE_MAX_VALUE=e[t].FUTURE_MAX_VALUE))},this.updateDependencyTariff=function(e){let a=[],i={1:a},r=t.executeQueryURLReset(),n=new Array;t.prepareParamListWithParam("pTariffCode",null!=e&&null!=e.assignTariffCat&&null!=e.assignTariffCat.CODE?e.assignTariffCat.CODE:-999,n),t.executeQueryInput("GET_DEPID_USING_TARRIF",n,i,!0,!0,r,"popUp",{}).then(function(e){let i=function(e,a){let r={1:[]},n=t.executeQueryURLReset(),l=new Array;t.prepareParamListWithParam("pDepTarrifId",e[a].TARIFF_PRICE_DEPID,l),t.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,l),t.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,l),t.executeQueryInput("SP_USP_UPDATE_INFLUENCER_TARIFF_RATE",l,r,!0,!0,n,"popUp",{}).then(function(t){(a+=1)<e.length&&i(e,a)})};if(a.length>0){i(a,0)}})}}e.$inject=["hisAlertService","QueryService","newTariffRateServiceGrid","uiGridConstants"],angular.module("napierContainerUi").service("GetGridDataService",e)}(),function(){"use strict";angular.module("napierContainerUi").service("newTariffRateServiceGrid",function(){this.newTariffRateGetColDef=function(e){e.exporterFieldCallback=function(e,t,a,i){return a.name,i},e.headerTemplate="app/consumer/his17_1/billing/screens/newTariffRates/sections/header-template.html",e.category=[{name:"Item",visible:!0}],e.columnDefs=[{name:"PRIORITY_DESC",displayName:" ",category:"Item",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,pinnedLeft:!0,headerCellFilter:"translate",width:"10",cellTemplate:"<div class=\"ui-grid-cell-contents grid-actions\" ng-class=\"{'routinePriority':row.entity.SERV_PRIORITY==1,'asapPriority':row.entity.SERV_PRIORITY==2,'statPriority':row.entity.SERV_PRIORITY==3}\"></div>"},{name:"SERV_NAME",displayName:"Service Name",category:"Item",enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:"120",pinnedLeft:!0}]},this.serviceWiseGridColDef=function(e){e.showTreeExpandNoChildren=!1,e.exporterFieldCallback=function(e,t,a,i){return"rateObj"==a.name?i:(a.name,i)},e.columnDefs=[{name:"SERV_NAME",displayName:"Service Name",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,headerCellFilter:"translate",visible:!1},{name:"SLOT",displayName:"Fixed Slot",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,headerCellFilter:"translate",visible:!1},{name:"PAT_TYPE_DESC",displayName:"Patient Type",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,headerCellFilter:"translate"},{name:"BED_CLASS_DESC",displayName:"Bed Class",enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate"},{name:"rateObj",displayName:"Current Rate",enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:160,cellTemplate:'<div class=""><div class="green-status"><span class="value" ng-if="row.entity.VALUE!=undefined&&!row.entity.currentRateChange" tooltip-placement="bottom" uib-tooltip="Applicable From {{row.entity.EFFECTIVE_FROM|date :grid.appScope.trf.format}}" tooltip-class="customClass" tooltip-append-to-body=true>{{row.entity.VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Enter"  ng-if="row.entity.VALUE==undefined||row.entity.currentRateChange" ng-model="row.entity.VALUE" ng-change="row.entity.currentRateChange=true;row.entity.docEditFlag=true;grid.appScope.trf.saveValidtion();" number-with-decimal></div><div class="grey-status" ng-if="row.entity.ASAP.SERV_SEQ_ID!=undefined"><span class="value" ng-if="row.entity.ASAP.VALUE!=undefined&&!row.entity.currentRateChange">{{row.entity.ASAP.VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Enter" ng-if="row.entity.VALUE==undefined||row.entity.currentRateChange" ng-model="row.entity.ASAP.VALUE" ng-change="row.entity.currentRateChange=true" ng-disabled="row.entity.VALUE==undefined||row.entity.VALUE==\'\'" number-with-decimal></div><div class="red-status" ng-if="row.entity.STAT.SERV_SEQ_ID!=undefined"><span class="value" ng-if="row.entity.STAT.VALUE!=undefined&&!row.entity.currentRateChange">{{row.entity.STAT.VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Enter" ng-if="row.entity.VALUE==undefined||row.entity.currentRateChange" ng-model="row.entity.STAT.VALUE" ng-change="row.entity.currentRateChange=true" ng-disabled="row.entity.VALUE==undefined||row.entity.VALUE==\'\'" number-with-decimal></div></div>'},{name:"rateObjOne",displayName:"Current Rate Min / Max",enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:160,visible:!0,cellTemplate:'<div class=""><div class="green-status" ng-if="!grid.appScope.trf.serviceItemFlag"><span class="value" ng-if="row.entity.VALUE!=undefined">{{row.entity.VALUE}}</span></div><div class="green-status"><input type="text" class="form-control tr-grid-textbox" placeholder="Min." ng-model="row.entity.MIN_VALUE" ng-blur="grid.appScope.fieldValidation(row,row.entity.MAX_VALUE,row.entity.MIN_VALUE,row.entity.VALUE,1)"  ng-if="!grid.appScope.trf.serviceItemFlag||row.entity.VALUE==undefined||row.entity.currentRateChange" ng-change="grid.appScope.trf.serviceItemFlag?row.entity.currentRateChange=true:undefined" number-with-decimal><span class="value" ng-if="grid.appScope.trf.serviceItemFlag&&row.entity.VALUE!=undefined&&!row.entity.currentRateChange">{{row.entity.MIN_VALUE}}</span></div><div class="green-status"><input type="text" class="form-control tr-grid-textbox" placeholder="Max." ng-blur="grid.appScope.fieldValidation(row,row.entity.MAX_VALUE,row.entity.MIN_VALUE,row.entity.VALUE,1)" ng-model="row.entity.MAX_VALUE" ng-if="!grid.appScope.trf.serviceItemFlag||row.entity.VALUE==undefined||row.entity.currentRateChange" ng-change="grid.appScope.trf.serviceItemFlag?row.entity.currentRateChange=true:undefined" number-with-decimal><span class="value" ng-if="grid.appScope.trf.serviceItemFlag&&row.entity.VALUE!=undefined&&!row.entity.currentRateChange">{{row.entity.MAX_VALUE}}</span></div></div>'},{name:"DOCT_SHARE_VALUE",displayName:"Dr. Share",enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:80,cellTemplate:'<div class=""><span ng-if="row.entity.VALUE==undefined||row.entity.docEditFlag"><input type="text" class="form-control dr-share-textbox" style="padding-left:2px; padding-right:1px;width:40%;" ng-model="row.entity.DOCT_SHARE_VALUE" ng-change="row.entity.docEditFlag=true;grid.appScope.trf.changeDocShareItem(row.entity,grid.appScope.trf,rowRenderIndex)" ng-disabled="row.entity.VALUE==undefined||row.entity.VALUE==\'\'" number-with-decimal><select class="tr-grid-textbox"   ng-disabled="row.entity.SERV_PRIORITY!=1||(row.entity.VALUE==undefined||row.entity.VALUE==\'\')" ng-model="row.entity.DOCT_SHARE_TYPE" style="width:60%;padding-left:0px !important; padding-right:0px !important;position: relative; top:0px;margin-left:0px !important;" ng-change="row.entity.docEditFlag=true;grid.appScope.trf.changeDocShareItem(row.entity,grid.appScope.trf,rowRenderIndex,true)"  ng-disabled="row.entity.VALUE==undefined||row.entity.VALUE==\'\'"><option value="1"><span class="tr-addon">%</span></option><option value="2"><span class="tr-addon">&nbsp;Amt</span></option></select></span><div style="padding-top:6px;" ng-if="row.entity.VALUE!=undefined&&!row.entity.docEditFlag">{{row.entity.DOCT_SHARE_VALUE}} {{row.entity.DOCT_SHARE_TYPE==\'1\'?"%":"&nbsp;Amt"}}</div></div>'},{name:"newRate",displayName:"New Rate",enableSorting:!0,enableCellEdit:!0,width:160,cellTemplate:'<div class=""><div class="green-status"><span class="value" ng-if="row.entity.FUTURE_VALUE!=undefined&&!row.entity.editFlag">{{row.entity.FUTURE_VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Enter" ng-if="row.entity.FUTURE_VALUE==undefined||row.entity.editFlag" ng-model="row.entity.FUTURE_VALUE" ng-change="row.entity.editFlag=true" number-with-decimal></div><div class="grey-status" ng-if="row.entity.ASAP.SERV_SEQ_ID!=undefined"><span class="value" ng-if="row.entity.ASAP.FUTURE_VALUE!=undefined&&!row.entity.editFlag">{{row.entity.ASAP.FUTURE_VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Enter" ng-if="row.entity.ASAP.FUTURE_VALUE==undefined||row.entity.editFlag" ng-model="row.entity.ASAP.FUTURE_VALUE" ng-change="row.entity.editFlag=true" ng-disabled="row.entity.FUTURE_VALUE==undefined||row.entity.FUTURE_VALUE==\'\'" number-with-decimal></div><div class="red-status" ng-if="row.entity.STAT.SERV_SEQ_ID!=undefined"><span class="value" ng-if="row.entity.STAT.FUTURE_VALUE!=undefined&&!row.entity.editFlag">{{row.entity.STAT.FUTURE_VALUE}}</span><input type="text" class="form-control tr-grid-textbox" placeholder="Enter" ng-if="row.entity.STAT.FUTURE_VALUE==undefined||row.entity.editFlag" ng-model="row.entity.STAT.FUTURE_VALUE" ng-change="row.entity.editFlag=true" ng-disabled="row.entity.FUTURE_VALUE==undefined||row.entity.FUTURE_VALUE==\'\'" number-with-decimal></div></div>'},{name:"FUTURE_EFFECTIVE_FROM",displayName:"Effective From",enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",width:120,cellTemplate:'<div class=""><div ng-if="row.entity.FUTURE_EFFECTIVE_FROM!=undefined&&!row.entity.editFlag" style="width: 100%;">{{row.entity.FUTURE_EFFECTIVE_FROM|date:grid.appScope.trf.format}}</div><div class="input-group" ng-if="row.entity.FUTURE_EFFECTIVE_FROM==undefined||row.entity.editFlag"><input type="text" class="form-control" uib-datepicker-popup="{{grid.appScope.trf.format}}" ng-model="row.entity.FUTURE_EFFECTIVE_FROM" is-open="grid.appScope.trf.opened[rowRenderIndex]"  ng-focus="grid.appScope.trf.opened[rowRenderIndex]=true"  show-button-bar="false" datepicker-options="grid.appScope.trf.dateOptions" ng-disabled="row.entity.FUTURE_VALUE==undefined||row.entity.FUTURE_VALUE==\'\'" ng-change="row.entity.editFlag=true;row.entity.ASAP.FUTURE_EFFECTIVE_FROM=row.entity.FUTURE_EFFECTIVE_FROM;row.entity.STAT.FUTURE_EFFECTIVE_FROM=row.entity.FUTURE_EFFECTIVE_FROM;row.entity.colorRed=false;row.entity.docEditFlag=true;" ng-class="{\'colorRedTariff\': row.entity.colorRed}" datepicker-append-to-body=true /><div class="input-group-btn"><button type="button" style="padding: 3px 10px 2px 10px;" class="btn btn-default" ng-click="grid.appScope.trf.opened[rowRenderIndex]=true" ng-disabled="row.entity.FUTURE_VALUE==undefined||row.entity.FUTURE_VALUE==\'\'"><i class="fa fa-calendar"></i></button></div></div></div>'},{name:"newRateOne",displayName:"New Rate Min / Max",enableSorting:!0,enableCellEdit:!0,width:160,visible:!0,cellTemplate:'<div class=""><div class="green-status" ng-if="!grid.appScope.trf.serviceItemFlag"><span class="value" ng-if="row.entity.FUTURE_VALUE!=undefined">{{row.entity.FUTURE_VALUE}}</span></div><div class="green-status"><input type="text" class="form-control tr-grid-textbox" placeholder="Min." ng-model="row.entity.FUTURE_MIN_VALUE" ng-blur="grid.appScope.fieldValidation(row,row.entity.FUTURE_MAX_VALUE,row.entity.FUTURE_MIN_VALUE,row.entity.FUTURE_VALUE,2)" ng-if="!grid.appScope.trf.serviceItemFlag||row.entity.FUTURE_VALUE==undefined||row.entity.editFlag" ng-change="grid.appScope.trf.serviceItemFlag?row.entity.editFlag=true:undefined" number-with-decimal><span class="value" ng-if="grid.appScope.trf.serviceItemFlag&&row.entity.FUTURE_VALUE!=undefined&&!row.entity.editFlag">{{row.entity.FUTURE_MIN_VALUE}}</span></div><div class="green-status"><input type="text" class="form-control tr-grid-textbox" placeholder="Max." ng-model="row.entity.FUTURE_MAX_VALUE" ng-blur="grid.appScope.fieldValidation(row,row.entity.FUTURE_MAX_VALUE,row.entity.FUTURE_MIN_VALUE,row.entity.FUTURE_VALUE,2)" ng-if="!grid.appScope.trf.serviceItemFlag||row.entity.FUTURE_VALUE==undefined||row.entity.editFlag" ng-change="grid.appScope.trf.serviceItemFlag?row.entity.editFlag=true:undefined" number-with-decimal><span class="value" ng-if="grid.appScope.trf.serviceItemFlag&&row.entity.FUTURE_VALUE!=undefined&&!row.entity.editFlag">{{row.entity.FUTURE_MAX_VALUE}}</span></div></div>'},{name:"Action",displayName:"billing.action",enableSorting:!1,enableCellEdit:!1,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents grid-actions"><i ng-if="row.entity.editShow&&grid.appScope.trf.roleTask.T_BL_M_TARIFF_RATE_U!=undefined" class="fa fa-pencil" ng-click="row.entity.editFlag=true;row.entity.docEditFlag=true;"></i><i ng-click="grid.appScope.trf.getTariffHistory(row.entity);" class="fa fa-refresh"></i></div>'},{name:"DOCT_NAME",displayName:"By Doctor/Speciality",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,headerCellFilter:"translate",visible:!1,pinnedLeft:!0,cellTemplate:'<div class="ui-grid-cell-contents "><span ng-if="grid.appScope.trf.srchObj.is_slot==\'1\'">{{row.entity.DOCT_NAME}}/{{row.entity.SPL_NAME}}</span><span ng-if="grid.appScope.trf.srchObj.is_slot==\'2\'">{{row.entity.SPL_NAME}}</span></div>'}]},this.exportGridForServiceWise=function(e){return[{name:"TARIFF_CATEGORY",displayName:"Tariff Category",width:"*",align:"left"},{name:"PRI_SERV_DESC",displayName:"Primary Service Group",width:"*",align:"left"},{name:"SERV_CODE",displayName:"Service Code",width:"*",align:"left"},{name:"SERV_NAME",displayName:"Service Name",width:"*",align:"left"},{name:"SLOT",displayName:"Fixed Slot",width:"*",align:"left"},{name:"PAT_TYPE_DESC",displayName:"Patient Type",width:"*",align:"left"},{name:"BED_CLASS_DESC",displayName:"Bed Class",width:"*",align:"left"},{name:"VALUE",displayName:"Routine Rate",width:"*",align:"right"},{name:"ASAP",displayName:"ASAP Rate",width:"*",align:"right"},{name:"STAT",displayName:"STAT Rate",width:160,align:"right"},{name:"MIN_VALUE",displayName:"Min Rate",width:"*",align:"right"},{name:"MAX_VALUE",displayName:"Max Rate",width:"*",align:"right"},{name:"DOCT_SHARE_VALUE",displayName:"Dr. Share",align:"right",width:80},{name:"FUTURE_VALUE",displayName:"Routine Future Rate",width:"*",align:"right"},{name:"ASAP",displayName:"ASAP Future Rate",width:"*",align:"right"},{name:"STAT",displayName:"STAT Future Rate",align:"right",width:160},{name:"FUTURE_MIN_VALUE",displayName:"Future Min Rate",width:"*",align:"right"},{name:"FUTURE_MAX_VALUE",displayName:"Future Max Rate",width:"*",align:"right"},{name:"FUTURE_EFFECTIVE_FROM",displayName:"Effective From",width:"*",align:"right"}]}})}(),function(){"use strict";function e(e,t,a){this.saveTariffForServiceWise=function(i,r){var n={};return n.url=t.HISIPINDENT.URL,n.requestData={operation:"saveOrUpdateIteamTariff",messageId:"",destination:"com.napier.core.ratecard.service.external.RateCardService",message:{"@class":"com.napier.core.service.vo.TariffRateMasterVo",tariffRateCardVo:{"@class":"com.napier.core.service.vo.TariffRateCardVo",approvedBy:void 0,baseRateCardVersion:void 0,baseVersionSeqId:void 0,createdBy:1,createdOn:a("date")(new Date,"yyyy-MM-ddTHH:mm:ss.sZ"),effectiveFrom:a("date")(new Date,"yyyy-MM-ddTHH:mm:ss.sZ"),effectiveTo:"9999-12-21T23:00:00.000000+0530",forTarrifCatgCode:r.srchObj.assignTariffCat.CODE,fromTarrifCatgCode:r.srchObj.assignTariffCat.CODE,gnStatus:1,gnVersionStatus:1,lastUpdatedOn:a("date")(new Date,"yyyy-MM-ddTHH:mm:ss.sZ"),practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,rateCardVersion:void 0,rcvSeqId:r.srchObj.rcvSeqId},tariffInfluencerVoList:[{"com.napier.core.service.vo.TariffInfluencerVo":i.infulencerList}]}},e.sendRestRequest(n)}}e.$inject=["CallManager","IPINDENTAPIS","$filter"],angular.module("napierContainerUi").service("saveCallServiceTariff",e)}(),function(){"use strict";function e(e){this.createSaveObjForServiceWise=function(t,a,i,r){let n={},l=[],s=!0,o=function(t,a,i){let r="",n="";null==t.BED_CLASS_CODE?(r="4="+t.SERV_SEQ_ID,n="SERVICE="+t.SERV_NAME):null!=t.BED_CLASS_CODE&&(r="5="+t.BED_CLASS_CODE,n="BEDCLASS="+t.BED_CLASS_DESC),a.rcvSeqId=i?i.RCV_SEQ_ID:t.RCV_SEQ_ID,(null!=i&&null!=i.FUTURE_EFFECTIVE_FROM&&new Date(i.FUTURE_EFFECTIVE_FROM).getDate()==(new Date).getDate()||null!=t.FUTURE_EFFECTIVE_FROM&&new Date(t.FUTURE_EFFECTIVE_FROM).getDate()==(new Date).getDate())&&(null!=i&&null!=i.FUTURE_VALUE&&""!=i.FUTURE_VALUE?(i.VALUE=angular.copy(i.FUTURE_VALUE),i.FUTURE_VALUE=void 0):null!=t.FUTURE_VALUE&&""!=t.FUTURE_VALUE&&(t.VALUE=angular.copy(t.FUTURE_VALUE),t.FUTURE_VALUE=void 0),null!=i?i.FUTURE_EFFECTIVE_FROM=void 0:t.FUTURE_EFFECTIVE_FROM=void 0,null!=i&&null!=i.FUTURE_MIN_VALUE&&""!=i.FUTURE_MIN_VALUE?(i.MIN_VALUE=angular.copy(i.FUTURE_MIN_VALUE),i.FUTURE_MIN_VALUE=void 0):null!=t.FUTURE_MIN_VALUE&&""!=t.FUTURE_MIN_VALUE&&(t.MIN_VALUE=angular.copy(t.FUTURE_MIN_VALUE),t.FUTURE_MIN_VALUE=void 0),null!=i&&null!=i.FUTURE_MAX_VALUE&&""!=i.FUTURE_MAX_VALUE?(i.MAX_VALUE=angular.copy(i.FUTURE_MAX_VALUE),i.FUTURE_MAX_VALUE=void 0):null!=t.FUTURE_MAX_VALUE&&""!=t.FUTURE_MAX_VALUE&&(t.MAX_VALUE=angular.copy(t.FUTURE_MAX_VALUE),t.FUTURE_MAX_VALUE=void 0)),null!=t.DOCT_SHARE_VALUE&&""!=t.DOCT_SHARE_VALUE||(t.DOCT_SHARE_VALUE=0);let s={facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,gnRuleType:null!=t.BED_CLASS_CODE?2:1,gnStatus:1,gnValueDependent:1,gnValueOn:1,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,priServTypeCode:t.PRI_SERV_CODE,rcvSeqId:i?i.RCV_SEQ_ID:t.RCV_SEQ_ID,ruleBusinessName:void 0,ruleCatgCode:void 0,ruleSubCatgCode:void 0,ruleSysName:t.PRI_SERV_CODE+"-"+void 0+"-"+void 0+"-"+t.SERV_NAME,ruleWithCode:r,ruleWithDesc:n,secServTypeCode:void 0,servSeqId:t.SERV_SEQ_ID,servTypeCode:void 0,tarrifCatgCode:a.assignTariffCat.CODE,value:null!=i?i.VALUE?parseFloat(i.VALUE):void 0:t.VALUE?parseFloat(t.VALUE):void 0,effectiveFrom:e("date")(new Date,"yyyy-MM-ddTHH:mm:ss.sZ"),effectiveTo:"9999-12-21T23:00:00.000000+0530",gnVersionStatus:5,remarks:"",tariffClassCode:t.BED_CLASS_CODE,maxValue:i?null==i.MAX_VALUE||""==i.MAX_VALUE||null==i.MAX_VALUE?void 0:parseFloat(i.MAX_VALUE):null==t.MAX_VALUE||""==t.MAX_VALUE||null==t.MAX_VALUE?void 0:parseFloat(t.MAX_VALUE),minValue:i?null==i.MIN_VALUE||""==i.MIN_VALUE||null==i.MIN_VALUE?void 0:parseFloat(i.MIN_VALUE):null==t.MIN_VALUE||""==t.MIN_VALUE||null==t.MIN_VALUE?void 0:parseFloat(t.MIN_VALUE),bedClassSeqId:t.BED_CLASS_CODE,bedClassName:t.BED_CLASS_DESC,rcSeqId:void 0,isSelected:!0,bedCode:void 0,serviceId:void 0,baseVersionRate:void 0,hospitalRate:null!=i?1==parseFloat(t.DOCT_SHARE_TYPE)&&i.VALUE?parseFloat(i.VALUE)-parseFloat(i.VALUE)*parseFloat(t.DOCT_SHARE_VALUE)/100:parseFloat(i.VALUE)-parseFloat(t.DOCT_SHARE_VALUE):1==parseFloat(t.DOCT_SHARE_TYPE)&&t.VALUE?parseFloat(t.VALUE)-parseFloat(t.VALUE)*parseFloat(t.DOCT_SHARE_VALUE)/100:t.VALUE?parseFloat(t.VALUE)-parseFloat(t.DOCT_SHARE_VALUE):t.DOCT_SHARE_VALUE,doctorRate:null!=i?1==parseFloat(t.DOCT_SHARE_TYPE)&&i.VALUE?parseFloat(i.VALUE)*parseFloat(t.DOCT_SHARE_VALUE)/100:parseFloat(t.DOCT_SHARE_VALUE):1==parseFloat(t.DOCT_SHARE_TYPE)?parseFloat(t.VALUE)*parseFloat(t.DOCT_SHARE_VALUE)/100:parseFloat(t.DOCT_SHARE_VALUE),technicianRate:0,inflSeqId:null!=i?i.INFL_SEQ_ID:t.INFL_SEQ_ID,hospitalRateSeqId:null!=i&&null!=i.DOCT_SHARE_SEQ_ID?i.DOCT_SHARE_SEQ_ID.split[0]:null!=t.DOCT_SHARE_SEQ_ID?parseInt(t.DOCT_SHARE_SEQ_ID.split(",")[0]):void 0,doctorRateSeqId:null!=i&&null!=i.DOCT_SHARE_SEQ_ID?i.DOCT_SHARE_SEQ_ID.split[1]:null!=t.DOCT_SHARE_SEQ_ID?parseInt(t.DOCT_SHARE_SEQ_ID.split(",")[1]):void 0,technicianRateSeqId:null!=i&&null!=i.DOCT_SHARE_SEQ_ID?i.DOCT_SHARE_SEQ_ID.split[2]:null!=t.DOCT_SHARE_SEQ_ID?parseInt(t.DOCT_SHARE_SEQ_ID.split(",")[2]):void 0,code:t.SHARE_TARRIF_SERV_CODE,tariffSeqId:void 0,distributeRevenue:void 0,futureValue:null!=i?i.FUTURE_VALUE?parseFloat(i.FUTURE_VALUE):void 0:t.FUTURE_VALUE?parseFloat(t.FUTURE_VALUE):void 0,futureEffectiveFrom:t.FUTURE_EFFECTIVE_FROM?e("date")(t.FUTURE_EFFECTIVE_FROM,"yyyy-MM-ddTHH:mm:ss.sZ"):void 0,doctShareType:null==t.DOCT_SHARE_TYPE?parseFloat(1):parseFloat(t.DOCT_SHARE_TYPE),doctShareValue:null==t.DOCT_SHARE_VALUE?parseFloat(0):parseFloat(t.DOCT_SHARE_VALUE),patType:t.PAT_TYPE_CODE,slotSeqId:t.SERV_SLOT_ID,futureMaxValue:i?null==i.FUTURE_MAX_VALUE||""==i.FUTURE_MAX_VALUE||null==i.FUTURE_MAX_VALUE?void 0:parseFloat(i.FUTURE_MAX_VALUE):null==t.FUTURE_MAX_VALUE||""==t.FUTURE_MAX_VALUE||null==t.FUTURE_MAX_VALUE?void 0:parseFloat(t.FUTURE_MAX_VALUE),futureMinValue:i?null==i.FUTURE_MIN_VALUE||""==i.FUTURE_MIN_VALUE||null==i.FUTURE_MIN_VALUE?void 0:parseFloat(i.FUTURE_MIN_VALUE):null==t.FUTURE_MIN_VALUE||""==t.FUTURE_MIN_VALUE||null==t.FUTURE_MIN_VALUE?void 0:parseFloat(t.FUTURE_MIN_VALUE),servPriority:null!=i?i.SERV_PRIORITY:t.SERV_PRIORITY,createdOn:e("date")(new Date,"yyyy-MM-ddTHH:mm:ss.sZ"),doctSeqId:1==a.is_slot?t.DOCT_SEQ_ID:void 0,specialityCode:t.SPECIALITY_CODE};_.isNaN(s.hospitalRate)&&(s.hospitalRate=0),_.isNaN(s.doctorRate)&&(s.doctorRate=0),l.push(s)};if(i)for(let e=0;e<t.length;e++)null!=t[e].FUTURE_VALUE&&""!=t[e].FUTURE_VALUE?null!=t[e].FUTURE_EFFECTIVE_FROM&&""!=t[e].FUTURE_EFFECTIVE_FROM?o(t[e],a):(s=!1,t[e].colorRed=!0):null!=t[e].VALUE&&""!=t[e].VALUE&&o(t[e],a),null!=t[e].STAT&&null!=t[e].STAT.FUTURE_VALUE&&""!=t[e].STAT.FUTURE_VALUE?null!=t[e].STAT.FUTURE_EFFECTIVE_FROM&&""!=t[e].STAT.FUTURE_EFFECTIVE_FROM?o(t[e],a,t[e].STAT):(s=!1,t[e].STAT.colorRed=!0):null!=t[e].STAT&&null!=t[e].STAT.VALUE&&""!=t[e].STAT.VALUE&&o(t[e],a,t[e].STAT),null!=t[e].ASAP&&null!=t[e].ASAP.FUTURE_VALUE&&""!=t[e].ASAP.FUTURE_VALUE?null!=t[e].ASAP.FUTURE_EFFECTIVE_FROM&&""!=t[e].ASAP.FUTURE_EFFECTIVE_FROM?o(t[e],a,t[e].ASAP):(s=!1,t[e].ASAP.colorRed=!0):null!=t[e].ASAP&&null!=t[e].ASAP.VALUE&&""!=t[e].ASAP.VALUE&&o(t[e],a,t[e].ASAP);else for(let e=0;e<t.length;e++)for(let i=0;i<r.category.length;i++)if(null!=t[e][r.category[i].name]){let n=t[e][r.category[i].name];null!=n.FUTURE_VALUE&&""!=n.FUTURE_VALUE?null!=n.FUTURE_EFFECTIVE_FROM&&""!=n.FUTURE_EFFECTIVE_FROM?o(n,a):(s=!1,n.colorRed=!0):null!=n.VALUE&&""!=n.VALUE&&o(n,a);for(let l=0;l<r.columnDefs.length;l++){let c=r.columnDefs[l].name;if(null!=n[c]){let l=n[c];null!=l.FUTURE_VALUE&&""!=l.FUTURE_VALUE?null!=l.FUTURE_EFFECTIVE_FROM&&""!=l.FUTURE_EFFECTIVE_FROM?o(l,a):(s=!1,t[e][r.category[i].name][c].colorRed=!0):null!=l.VALUE&&""!=l.VALUE&&o(l,a)}}}return s?n={infulencerList:l}:s}}e.$inject=["$filter"],angular.module("napierContainerUi").service("SaveObjPreServiceTariff",e)}(),function(){"use strict";function e(e,t){var a=function(e,t){if(null!=t.roundOffValue&&""!=t.roundOffValue&&parseFloat(t.roundOffValue)>0){var a=parseFloat(e)%parseFloat(t.roundOffValue);return a>parseFloat(t.roundOffValue)/2?parseFloat(e)+(t.roundOffValue-a):parseFloat(e)-a==0?parseFloat(e):parseFloat(e)-a}},i=function(e,t){null!=e.VALUE&&(null!=t.updObj.updateVal&&""!=t.updObj.updateVal&&null!=t.updObj.effectiveDate&&("up"==t.updObj.updateFlag?e.FUTURE_VALUE=parseFloat(e.VALUE)+parseFloat(e.VALUE)*parseFloat(t.updObj.updateVal)/100:"down"==t.updObj.updateFlag&&(e.FUTURE_VALUE=parseFloat(e.VALUE)-parseFloat(e.VALUE)*parseFloat(t.updObj.updateVal)/100),e.FUTURE_EFFECTIVE_FROM=new Date(t.updObj.effectiveDate)),null!=e.VALUE&&""!=e.VALUE&&null!=t.roundOffValue&&""!=t.roundOffValue&&parseFloat(t.roundOffValue)>0&&(e.VALUE=a(e.VALUE,t)),null!=e.FUTURE_VALUE&&""!=e.FUTURE_VALUE&&null!=t.roundOffValue&&""!=t.roundOffValue&&parseFloat(t.roundOffValue)>0&&(e.FUTURE_VALUE=a(e.FUTURE_VALUE,t)))};this.docShareApply=function(e,t,a,i){if(null==a.BED_CLASS_CODE&&null!=e[t+1]&&e[t+1].SERV_SEQ_ID==a.SERV_SEQ_ID){if(null!=e[t+1].VALUE&&""!=e[t+1].VALUE){if("2"==a.DOCT_SHARE_TYPE){let i=parseFloat(a.DOCT_SHARE_VALUE)/parseFloat(a.VALUE)*100;e[t+1].DOCT_SHARE_VALUE=parseFloat(e[t+1].VALUE)*i/100}else e[t+1].DOCT_SHARE_VALUE=a.DOCT_SHARE_VALUE;e[t+1].DOCT_SHARE_TYPE=a.DOCT_SHARE_TYPE}i.changeDocShare(a,i,t+1)}else{if(null==a.BED_CLASS_CODE||null==e[t+1]||null==e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE]||e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE].SERV_SEQ_ID!=a.SERV_SEQ_ID)return!1;if(null!=e[t+1][a.PAT_TYPE_DESC]&&null!=e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE]&&null!=e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE].VALUE&&""!=e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE].VALUE){if("2"==a.DOCT_SHARE_TYPE){let i=parseFloat(a.DOCT_SHARE_VALUE)/parseFloat(a.VALUE)*100;e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE].DOCT_SHARE_VALUE=parseFloat(e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE].VALUE)*i/100}else e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE].DOCT_SHARE_VALUE=a.DOCT_SHARE_VALUE;e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE].DOCT_SHARE_TYPE=a.DOCT_SHARE_TYPE}i.changeDocShare(a,i,t+1)}},this.changeFutureDate=function(e,t,a,i){if(null==a.BED_CLASS_CODE&&null!=e[t+1]&&e[t+1].SERV_SEQ_ID==a.SERV_SEQ_ID)null!=e[t+1].FUTURE_VALUE&&""!=e[t+1].FUTURE_VALUE&&(e[t+1].FUTURE_EFFECTIVE_FROM=a.FUTURE_EFFECTIVE_FROM),i.changeFutureDate(a,i,t+1);else{if(null==a.BED_CLASS_CODE||null==e[t+1]||null==e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE]||e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE].SERV_SEQ_ID!=a.SERV_SEQ_ID)return!1;null!=e[t+1][a.PAT_TYPE_DESC]&&null!=e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE]&&null!=e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE].FUTURE_VALUE&&""!=e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE].FUTURE_VALUE&&(e[t+1][a.PAT_TYPE_DESC][a.PAT_TYPE_DESC+a.BED_CLASS_CODE].FUTURE_EFFECTIVE_FROM=a.FUTURE_EFFECTIVE_FROM),i.changeFutureDate(a,i,t+1)}},this.updateDataOnClick=function(e){if(null!=e.roundOffValue||null!=e.updObj&&null!=e.updObj.updateFlag&&null!=e.updObj.updateVal)if(1==e.serviceItemFlag)for(let t=0;t<e.serviceItmsWiseGrid.data.length;t++)null!=e.serviceItmsWiseGrid.data[t].VALUE&&""!=e.serviceItmsWiseGrid.data[t].VALUE&&i(e.serviceItmsWiseGrid.data[t],e),null!=e.serviceItmsWiseGrid.data[t].ASAP&&null!=e.serviceItmsWiseGrid.data[t].ASAP.VALUE&&""!=e.serviceItmsWiseGrid.data[t].ASAP.VALUE&&i(e.serviceItmsWiseGrid.data[t].ASAP,e),null!=e.serviceItmsWiseGrid.data[t].STAT&&null!=e.serviceItmsWiseGrid.data[t].STAT.VALUE&&""!=e.serviceItmsWiseGrid.data[t].STAT.VALUE&&i(e.serviceItmsWiseGrid.data[t].STAT,e);else for(let t=0;t<e.groupWiseGrid.data.length;t++)for(let i=0;i<e.groupWiseGrid.category.length;i++){let r=e.groupWiseGrid.category[i].name;if(null!=e.groupWiseGrid.data[t][r]){null!=e.groupWiseGrid.data[t][r]&&null!=e.groupWiseGrid.data[t][r].VALUE&&(null==e.groupWiseGrid.data[t][r].FUTURE_VALUE&&""==e.groupWiseGrid.data[t][r].FUTURE_VALUE&&(e.groupWiseGrid.data[t][r].editFlag=!0),null!=e.updObj&&"up"==e.updObj.updateFlag&&null!=e.updObj.updateVal&&null!=e.updObj.effectiveDate?(e.groupWiseGrid.data[t][r].FUTURE_VALUE=parseFloat(e.groupWiseGrid.data[t][r].VALUE)+parseFloat(e.groupWiseGrid.data[t][r].VALUE)*parseFloat(e.updObj.updateVal)/100,e.groupWiseGrid.data[t][r].FUTURE_EFFECTIVE_FROM=new Date(e.updObj.effectiveDate)):null!=e.updObj&&"down"==e.updObj.updateFlag&&null!=e.updObj.updateVal&&null!=e.updObj.effectiveDate&&(e.groupWiseGrid.data[t][r].FUTURE_VALUE=parseFloat(e.groupWiseGrid.data[t][r].VALUE)-parseFloat(e.groupWiseGrid.data[t][r].VALUE)*parseFloat(e.updObj.updateVal)/100,e.groupWiseGrid.data[t][r].FUTURE_EFFECTIVE_FROM=new Date(e.updObj.effectiveDate)),null!=e.roundOffValue&&""!=e.roundOffValue&&parseFloat(e.roundOffValue)>0&&(e.groupWiseGrid.data[t][r].VALUE=a(e.groupWiseGrid.data[t][r].VALUE,e)));for(let i=0;i<e.groupWiseGrid.columnDefs.length;i++){let n=e.groupWiseGrid.columnDefs[i].name;if(null!=e.groupWiseGrid.data[t][r][n]){let i=e.groupWiseGrid.data[t][r][n];null!=i.VALUE&&(null!=i.FUTURE_VALUE&&""!=i.FUTURE_VALUE||(i.editFlag=!0),null!=e.updObj&&"up"==e.updObj.updateFlag&&null!=e.updObj.updateVal&&null!=e.updObj.effectiveDate?(i.FUTURE_VALUE=parseFloat(i.VALUE)+parseFloat(i.VALUE)*parseFloat(e.updObj.updateVal)/100,i.FUTURE_EFFECTIVE_FROM=new Date(e.updObj.effectiveDate)):null!=e.updObj&&"down"==e.updObj.updateFlag&&null!=e.updObj.updateVal&&null!=e.updObj.effectiveDate&&(i.FUTURE_VALUE=parseFloat(i.VALUE)-parseFloat(i.VALUE)*parseFloat(e.updObj.updateVal)/100,i.FUTURE_EFFECTIVE_FROM=new Date(e.updObj.effectiveDate)),null!=e.roundOffValue&&""!=e.roundOffValue&&parseFloat(e.roundOffValue)>0&&(i.VALUE=a(i.VALUE,e)))}}}}},this.getSaveValid=function(e){if(e.serviceItemFlag)for(let t=0;t<e.serviceItmsWiseGrid.data.length;t++){if(null!=e.serviceItmsWiseGrid.data[t].VALUE&""!=e.serviceItmsWiseGrid.data[t].VALUE)return!0;if(null!=e.serviceItmsWiseGrid.data[t].FUTURE_VALUE&&""!=e.serviceItmsWiseGrid.data[t].FUTURE_VALUE)return!0;if(t==e.serviceItmsWiseGrid.data.length-1)return!1}else for(let t=0;t<e.groupWiseGrid.data.length;t++){if(null!=e.groupWiseGrid.data[t].VALUE&""!=e.groupWiseGrid.data[t].VALUE)return!0;if(null!=e.groupWiseGrid.data[t].FUTURE_VALUE&&""!=e.groupWiseGrid.data[t].FUTURE_VALUE)return!0;if(e.groupWiseGrid.data[t])for(let a=0;a<e.groupWiseGrid.category.length;a++){let i=e.groupWiseGrid.category[a].name;if(null!=e.groupWiseGrid.data[t][i])for(let a=0;a<e.groupWiseGrid.columnDefs.length;a++){let r=e.groupWiseGrid.columnDefs[a].name;if(null!=e.groupWiseGrid.data[t][i][r]){let a=e.groupWiseGrid.data[t][i][r];if(null!=a.VALUE&&""!=a.VALUE)return!0;if(null!=a.FUTURE_VALUE&&""!=a.FUTURE_VALUE)return!0}}}else if(t==e.groupWiseGrid.data.length-1)return!1}},this.getExcelDataGrid=function(a,i,r,n){n||(a.exportGrid=[],a.exportGrid=e.exportGridForServiceWise(a.exportGrid));let l={patientType:[],slctBed:[],priObj:{},dataVal:i,headerNames:r};if(a.serviceItemFlag)for(let e=0;e<i.length;e++){if(null!=i[e][a.exportGrid[2].displayName])for(let e=0;e<a.serviceList.length;e++)if(a.serviceList[e].SERV_CODE==i[0][a.exportGrid[2].displayName]){l.SERV_SEQ_ID=a.serviceList[e].SERV_SEQ_ID;break}if(null!=i[e][a.exportGrid[4].displayName])for(let t=0;t<a.prtList.length;t++)if(null!=i[e][a.exportGrid[4].displayName]&&a.prtList[t].DETAIL_DESC==i[e][a.exportGrid[4].displayName]){if(0==l.patientType.length){l.patientType.push(a.prtList[t]);break}for(let e=0;e<l.patientType.length&&l.patientType[e].DT_CODE!=a.prtList[t].DT_CODE;e++)if(l.patientType.length-1==e){l.patientType.push(a.prtList[t]);break}break}if(null!=i[e][a.exportGrid[5].displayName])for(let t=0;t<a.tariffClsList.length;t++)if(null!=i[e][a.exportGrid[5].displayName]&&a.tariffClsList[t].DESCRIPTION==i[e][a.exportGrid[5].displayName]){if(0==l.slctBed.length){l.slctBed.push(a.tariffClsList[t]);break}for(let e=0;e<l.slctBed.length&&l.slctBed[e].CODE!=a.tariffClsList[t].CODE;e++)if(l.slctBed.length-1==e){l.slctBed.push(a.tariffClsList[t]);break}break}}else{for(let e=0;e<a.primServGrupList.length;e++)if(i[0][r[1]]==a.primServGrupList[e].DESCRIPTION){l.priObj=a.primServGrupList[e];break}for(let e=5;e<r.length;e++){let t=!1;for(let i=0;i<a.tariffClsList.length;i++)if(r[e]==a.tariffClsList[i].DESCRIPTION){if(0==l.slctBed.length){l.slctBed.push(a.tariffClsList[i]),t=!0;break}for(let e=0;e<l.slctBed.length;e++){if(l.slctBed[e].CODE==a.tariffClsList[i].CODE){t=!0;break}if(l.slctBed.length-1==e){t=!0,l.slctBed.push(a.tariffClsList[i]);break}}break}t||(l.patientType=angular.copy(a.prtList)),e+=3}}t.getTariffDataServiceWise(a.srchObj,a,!1,!1,!1,!0,l)}}e.$inject=["newTariffRateServiceGrid","GetGridDataService"],angular.module("napierContainerUi").service("TariffRateValidCalService",e)}(),function(){"use strict";function e(e,t,a,i){var r=this;r.prtList=[],e.srchObj.PAT_TYPE_CODE=[],e.srchObj.PAT_TYPE_CODE.push(e.PAT_TYPE_CODE),e.srchObj.BED_CLASS_CODE=[],r.format=angular.copy(i.uibDateOnly.format);let n=function(e,t,a){let i=!0;if(e.srchObj[t].length>0)for(let r=0;r<e.srchObj[t].length;r++){if(e.srchObj[t][r]==a[t]){i=!1;break}r==e.srchObj[t].length-1&&(i=!0)}i&&null!=a[t]&&e.srchObj[t].push(a[t])};for(let t=0;t<e.groupWiseGrid.category.length;t++)if(null!=e[e.groupWiseGrid.category[t].name])for(let a=0;a<e.groupWiseGrid.columnDefs.length;a++)null!=e[e.groupWiseGrid.category[t].name][e.groupWiseGrid.columnDefs[a].name]&&null!=e[e.groupWiseGrid.category[t].name][e.groupWiseGrid.columnDefs[a].name].BED_CLASS_CODE&&n(e,"PAT_TYPE_CODE",e[e.groupWiseGrid.category[t].name][e.groupWiseGrid.columnDefs[a].name]);e.srchObj.SERV_SEQ_ID=e.SERV_SEQ_ID,e.srchObj.SERV_PRIORITY=e.SERV_PRIORITY,e.srchObj.RCV_SEQ_ID=e.RCV_SEQ_ID,e.srchObj.PAT_TYPE_CODE=_.toString(e.srchObj.PAT_TYPE_CODE),r.gridOptions=angular.copy(a),r.gridOptions.headerTemplate="app/consumer/his17_1/billing/screens/newTariffRates/sections/header-template.html",t.getTariffDataForHistory(e.srchObj,r),r.gridOptions.onRegisterApi=function(e){r.gridApiGroup=e}}e.$inject=["data","GetGridDataService","newTariffRateGridConstant","hisCalDefConstant"],angular.module("napierContainerUi").controller("tariffHistoryController",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("onaccountDepositsDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,multiSelect:!1,enableHorizontalScrollbar:0,columnDefs:[{field:"onaccdepNo",displayName:"billing.depositAccNo",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"payerName",displayName:"billing.companyNameid",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"depositedAmt",displayName:"billing.depositAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"adjustedAmt",displayName:"billing.adjAmt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"balAmt",displayName:"billing.availDeposit",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"onaccDepositStatusDesc",displayName:"billing.PaymentStatus",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"}],enablePaginationControls:!1,useExternalSorting:!1,enableColumnMenus:!1,paginationPageSize:1})}(),function(){"use strict";function e(e,t,a,i,r){this.showGridDataService=function(t){var i=e.defer(),r={"@class":"com.napier.core.onaccountdeposit.vo.OnAccountDepositRetrieveList",onAccDepNo:t.onaccdepNo,pFromDate:t.frmDate,pToDate:t.toDate,pPaymentStatus:t.payStatus,payerSeqId:t.payerId},n={url:"HISServices/HITService"};return n.requestData={operation:"onAccountDepositRetrieve",messageId:"",destination:"com.napier.core.onaccountdeposit.service.external.OnAccountDepositService",message:r},a.sendRestRequest(n).then(function(e){var t=e.data.HITService.message?e.data.HITService.message.onAccDepLst[0]["com.napier.core.onaccountdeposit.vo.OnAccountDepositVO"]:[],a=getArrayObjects(t);i.resolve(a)}).then(function(e){i.reject(e)}),i.promise},this.saveAmountService=function(t){var i=e.defer(),r={"@class":"com.napier.core.onaccountdeposit.vo.OnAccountDepositVO",depositedAmt:t.dAmt,paymentDate:t.frmDate,depositedBy:10974,payerAccSeqId:t.companyName.PAYER_ACC_SEQ_ID,payerSeqId:t.companyName.INS_SEQ_ID,payMode:t.payStatus.DT_CODE,remarks:t.remark},n={url:"HISServices/HITService"};return n.requestData={operation:"OnAccountDepositSave",messageId:"",destination:"com.napier.core.onaccountdeposit.service.external.OnAccountDepositService",message:r},a.sendRestRequest(n).then(function(e){i.resolve(e)}),i.promise},this.cancelAmountService=function(t,i){var r=e.defer(),n={"@class":"com.napier.core.onaccountdeposit.vo.OnAccountDepositVO",onaccdepSeqId:t.onaccdepSeqId,cancelReason:i},l={url:"HISServices/HITService"};return l.requestData={operation:"cancelOnAccountDeposit",messageId:"",destination:"com.napier.core.onaccountdeposit.service.external.OnAccountDepositService",message:n},a.sendRestRequest(l).then(function(e){r.resolve(e)}),r.promise},this.saveRefundRequestService=function(t){var i=parseFloat(t.dAmt),r=parseFloat(t.reqrefundAmt),n=e.defer(),l={"@class":"com.napier.core.onaccountdeposit.vo.OnAccDepsRefundReqVO",appRefundAmt:0,availableAmt:t.avAm,depositedAmt:i,requestedBy:t.reqBy,onaccdepSeqId:t.onAccountDepositNo,reasonRefund:t.reasonRefund,refundReqAmt:r},s={url:"HISServices/HITService"};return s.requestData={operation:"onAccDepsRefundReqSave",messageId:"",destination:"com.napier.core.onaccountdeposit.service.external.OnAccountDepositService",message:l},a.sendRestRequest(s).then(function(e){n.resolve(e)}),n.promise}}e.$inject=["$q","BILLING_APIS","CallManager","$log","onaccountDepositsDefinition"],angular.module("napierContainerUi").service("onAccountDepositsService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("onaccountDepositRefundDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableHorizontalScrollbar:0,multiSelect:!1,columnDefs:[{field:"companyId",displayName:"billing.comID",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"companyName",displayName:"billing.comName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"deprefundNo",displayName:"billing.onaccdepositreqno",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"depositedAmt",displayName:"billing.depositAmount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{field:"refundReqStatusDesc",displayName:"billing.pymentStatus",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"}],enablePaginationControls:!1,useExternalSorting:!1,enableColumnMenus:!1,paginationPageSize:1})}(),function(){"use strict";function e(e,t,a,i,r){var n=sessionStorage.getItem("rawUserName");this.showGridDataService=function(a){var i=e.defer(),r={"@class":"com.napier.core.onaccountdeposit.vo.OnAccDepsRefundWorkList",pOnAccDepNo:"",pFromDate:a.frmDate,pToDate:a.toDate,companyId:a.ccode,companyName:a.cname,accType:1,tranStatus:a.paymentStatus,payerSeqId:a.payerId},n={url:"HISServices/HITService"};return n.requestData={operation:"onAccDepsRefundWorkList",messageId:"",destination:"com.napier.core.onaccountdeposit.service.external.OnAccountDepositService",message:r},t.sendRestRequest(n).then(function(e){var t=e.data.HITService,a=(e.data,e.data.HITService.message,t?e.data.HITService.message.onAccDepsRefundWorkLst[0]["com.napier.core.onaccountdeposit.vo.OnAccDepsRefundReqVO"]:[]),r=getArrayObjects(a);i.resolve(r)}).then(function(e){i.reject(e)}),i.promise},this.saveRefundProceedService=function(a){var i=e.defer(),r={"@class":"com.napier.core.onaccountdeposit.vo.OnAccDepsRefundReqVO",appRefundAmt:null!=a.refApp&&null!=a.refApp&&""!==a.refApp?parseFloat(a.refApp):0,availableAmt:a.availableAmt,depositedAmt:a.dAmt,deprefundSeqId:a.deprefundSeqId,onaccdepNo:a.dno,onaccdepSeqId:a.onaccdepSeqId,payerAccSeqId:a.payerAccSeqId,reasonDisapprove:a.reasonDis,reasonRefund:a.rReq,refundReqAmt:a.rAmt,remarks:a.remark,requestedBy:a.reqBy},n={url:"HISServices/HITService"};return n.requestData={operation:"0"==a.approval?"onAccDepsRefundReqApproval":"onAccDepsRefundReqDisApproval",messageId:"",destination:"com.napier.core.onaccountdeposit.service.external.OnAccountDepositService",message:r},t.sendRestRequest(n).then(function(e){i.resolve(e)}),i.promise},this.printCoverService=function(e){var t=new Array;r.prepareParamList("pOnaccDepseqId",e.onaccdepSeqId,t),r.prepareParamList("preparedBy",n,t);var a={paramsList:t,reportId:"OnAccountRefundRequestReportId"};i.printReportModal("PrintTypeSelection","sm").then(function(e){i.printReportModal("acountRefPrint","lg",e,a)})}}e.$inject=["$q","CallManager","$log","PrintService","QueryService"],angular.module("napierContainerUi").service("onAccountDepositRefundService",e)}(),function(){"use strict";angular.module("napierContainerUi").service("PackageSaveRequestPrepare",["CallManager","QueryService",function(e,t){function a(e,t,a,i,r,n,l,s){return"com.napier.core.masters.vo.CompositeIncludeServiceVo"==e["@class"]?(e.cisSeqId=s.packageObj.clonePackage&&1==a.packageCoverType?void 0:t.cisSeqId,e.isPre=1!=a.packageCoverType?void 0:2,e.isPost=1!=a.packageCoverType?void 0:2,e.inclServSeqId=1!=a.packageCoverType?void 0:t.srchObj.SERV_SEQ_ID,e.isPrint=t.isMaterial?void 0:1!=a.packageCoverType?void 0:2,e.subDeptSeqId=null==r?void 0:r.isMaterial?void 0:parseFloat(r.srchObj.CODE),e.amount=1!=a.packageCoverType?void 0:null!=t.amount?parseFloat(t.amount):void 0,e.qty=1!=a.packageCoverType?void 0:null!=t.quantity&&""!==t.quantity?parseFloat(t.quantity):void 0,e.specialtyCode=null==n?void 0:n.isMaterial?void 0:parseFloat(n.srchObj.CODE),e.applicabilityType=1!=a.packageCoverType?void 0:parseFloat(t.applicability)):"com.napier.core.masters.vo.CompositeExculdeServiceVo"==e["@class"]?(e.cesSeqId=t.isMaterial?void 0:s.packageObj.clonePackage?void 0:1!=t.packageCoverType?t.cisSeqId:void 0,e.exclServSeqId=t.isMaterial?void 0:2==a.packageCoverType?t.srchObj.SERV_SEQ_ID:void 0,e.subDeptSeqId=null==r?void 0:r.isMaterial?void 0:parseFloat(r.srchObj.CODE),e.specialtyCode=null==n?void 0:n.isMaterial?void 0:parseFloat(n.srchObj.CODE),e.subDeptSeqId=null==r?void 0:r.isMaterial?void 0:parseFloat(r.srchObj.CODE)):"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo"==e["@class"]?(e.isPre=1!=a.packageCoverType?void 0:2,e.isPost=1!=a.packageCoverType?void 0:2,e.mtrlCode=t.isMaterial?t.srchObj.SERV_SEQ_ID:void 0,e.cimSeqId=t.isMaterial?t.cisSeqId:void 0,e.mtrlGrpSeqId=null==r?void 0:r.isMaterial?parseFloat(r.srchObj.CODE):void 0,e.mtrlGrpSubSeqId=null==n?void 0:n.isMaterial?parseFloat(n.srchObj.CODE):void 0,e.amount=1!=a.packageCoverType?void 0:null!=t.amount?parseFloat(t.amount):void 0,e.qty=1!=a.packageCoverType?void 0:null!=t.quantity&&""!==t.quantity?parseFloat(t.quantity):void 0,e.applicabilityType=1!=a.packageCoverType?void 0:parseFloat(t.applicability),t.materialFlag=!0):"com.napier.core.masters.vo.CompositeServiceExcludeMaterialVo"==e["@class"]&&(e.cemSeqId=t.isMaterial?s.packageObj.clonePackage?void 0:1!=a.packageCoverType?t.cisSeqId:void 0:void 0,e.mtrlCode=t.isMaterial?t.srchObj.SERV_SEQ_ID:void 0,e.mtrlGrpSeqId=null==r?void 0:r.isMaterial?parseFloat(r.srchObj.CODE):void 0,e.mtrlGrpSubSeqId=3!=l?void 0:listServ.isMaterial?parseFloat(listServ.srchObj.CODE):void 0,e.mtrlGrpSubSeqId=null==n?void 0:n.isMaterial?parseFloat(n.srchObj.CODE):void 0),e.priServTypCode=parseFloat(i.srchObj.CODE),e.serHierarchyLevel=l,e.gnStatus=1,e.bedClassWiseLimitsListVo=t.isMaterial?void 0:1!=a.packageCoverType?void 0:[{"com.napier.core.masters.vo.BedClassLimitVo":s.getBedClassListPrepare(t)}],e.mtrlPackBedClassLimitVoList=t.isMaterial?1!=a.packageCoverType?void 0:[{"com.napier.core.masters.vo.MtrlPackBedClassLimitVo":s.getBedClassListPrepare(t)}]:void 0,e}this.prepareSaveRequestForPackage=function(e){if(e.servInclusionArr=[],e.applicablePayerArr=[],e.autoTriggerArr=[],e.bedClassLinkArr=[],e.servExculsiveArr=[],e.servInclusionMaterrialArr=[],e.servExculsiveMaterrialArr=[],!e.packageObj.selfFlag&&null!=e.packageObj.applicablePayer&&null!=e.packageObj.applicablePayer&&e.packageObj.applicablePayer.length>0)for(var t=0;t<e.packageObj.applicablePayer.length;t++)e.applicablePayerArr.push({"@class":"com.napier.core.masters.vo.PackageLimitPayerLinkVo",cslSeqId:e.packageObj.clonePackage?void 0:e.packageObj.applicablePayer[t].cslSeqId,payerSeqId:e.packageObj.applicablePayer[t].INC_SEQ_ID,tariffSeqId:e.packageObj.applicablePayer[t].TARIFF_SEQ_ID,payerType:parseInt(e.packageObj.applicablePayer[t].PAYER_TYPE),cslPayerLinkSeqId:e.packageObj.clonePackage?void 0:e.packageObj.applicablePayer[t].cslPayerLinkSeqId});else e.packageObj.selfFlag&&e.applicablePayerArr.push({"@class":"com.napier.core.masters.vo.PackageLimitPayerLinkVo",cslSeqId:e.packageObj.clonePackage?void 0:e.selfTariff[0].cslSeqId,payerSeqId:void 0,tariffSeqId:e.selfTariff[0].TARIFFCATG,payerType:4,cslPayerLinkSeqId:e.packageObj.clonePackage?void 0:e.selfTariff[0].cslPayerLinkSeqId});if(null!=e.getTempApplPyrData&&e.getTempApplPyrData.length>0&&!e.packageObj.clonePackage)for(let t=0;t<e.getTempApplPyrData.length;t++)if(null!=e.getTempApplPyrData[t].CSLL_SEQ_ID)for(let a=0;a<e.applicablePayerArr.length;a++)e.applicablePayerArr[a].payerSeqId==e.getTempApplPyrData[t].INC_SEQ_ID&&(e.applicablePayerArr[a].cslPayerLinkSeqId=e.getTempApplPyrData[t].CSLL_SEQ_ID);for(t=1;t<e.bedClassGrid.data.length;t++)e.bedClassLinkArr.push({"@class":"com.napier.core.masters.vo.PackageLimitBedClassLinkVo",cslSeqId:e.packageObj.clonePackage?void 0:e.bedClassGrid.data[t].cslSeqId,cslBedSeqId:e.packageObj.clonePackage?void 0:e.bedClassGrid.data[t].cslBedSeqId,bedClassSeqId:parseFloat(e.bedClassGrid.data[t].bedClass.CODE),amount:null!=e.bedClassGrid.data[t].amount?parseFloat(e.bedClassGrid.data[t].amount):void 0});if(null!=e.packageObj.autoTriggerServices&&null!=e.packageObj.autoTriggerServices&&e.packageObj.autoTriggerServices.length>0)for(t=0;t<e.packageObj.autoTriggerServices.length;t++)e.autoTriggerArr.push({"@class":"com.napier.core.masters.vo.PackageLimitServiceAutoTriggerLinkVo",serviceSeqId:e.packageObj.autoTriggerServices[t].SERV_SEQ_ID,cslAutoTriggerSeqId:e.packageObj.clonePackage?void 0:e.packageObj.autoTriggerServices[t].CSLA_SEQ_ID});if(null!=e.getTempAutoServData&&e.getTempAutoServData.length>0&&!e.packageObj.clonePackage)for(let t=0;t<e.getTempAutoServData.length;t++)if(null!=e.getTempAutoServData[t].CSLL_SEQ_ID)for(let a=0;a<e.autoTriggerArr.length;a++)if(e.autoTriggerArr[a].serviceSeqId==e.autoTriggerArr[a].SERV_SEQ_ID)null==e.autoTriggerArr[a].cslAutoTriggerSeqId&&(e.autoTriggerArr[a].cslAutoTriggerSeqId=e.getTempAutoServData[t].CSLA_SEQ_ID);else if(a==e.autoTriggerArr.length-1){e.autoTriggerArr.push({"@class":"com.napier.core.masters.vo.PackageLimitServiceAutoTriggerLinkVo",serviceSeqId:e.getTempAutoServData[t].SERV_SEQ_ID,cslAutoTriggerSeqId:e.getTempAutoServData[t].CSLA_SEQ_ID,gnStatus:2});break}if(null!=e.treeViewData&&null!=e.treeViewData)for(var i=0;i<e.treeViewData.length;i++){let t={"@class":e.treeViewData[i].isMaterial?1!=e.treeViewData[0].packageCoverType?"com.napier.core.masters.vo.CompositeServiceExcludeMaterialVo":"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo":1!=e.treeViewData[0].packageCoverType?"com.napier.core.masters.vo.CompositeExculdeServiceVo":"com.napier.core.masters.vo.CompositeIncludeServiceVo",cesSeqId:e.treeViewData[i].isMaterial?void 0:e.packageObj.clonePackage?void 0:1!=e.treeViewData[0].packageCoverType?e.treeViewData[i].cisSeqId:void 0,cisSeqId:e.treeViewData[i].isMaterial?void 0:e.packageObj.clonePackage?void 0:1!=e.treeViewData[0].packageCoverType?void 0:e.treeViewData[i].cisSeqId,cimSeqId:e.treeViewData[i].isMaterial?e.packageObj.clonePackage?void 0:1!=e.treeViewData[0].packageCoverType?void 0:e.treeViewData[i].cisSeqId:void 0,cemSeqId:e.treeViewData[i].isMaterial?e.packageObj.clonePackage?void 0:1!=e.treeViewData[0].packageCoverType?e.treeViewData[i].cisSeqId:void 0:void 0,priServTypCode:parseFloat(e.treeViewData[i].srchObj.CODE),isPost:1!=e.treeViewData[0].packageCoverType?void 0:2,isPre:1!=e.treeViewData[0].packageCoverType?void 0:2,isPrint:e.treeViewData[i].isMaterial?void 0:1!=e.treeViewData[0].packageCoverType?void 0:2,amount:1!=e.treeViewData[0].packageCoverType?void 0:null!=e.treeViewData[i].amount?parseFloat(e.treeViewData[i].amount):void 0,qty:1!=e.treeViewData[0].packageCoverType?void 0:null!=e.treeViewData[i].quantity&&""!==e.treeViewData[i].quantity?parseFloat(e.treeViewData[i].quantity):void 0,serHierarchyLevel:1,applicabilityType:1!=e.treeViewData[0].packageCoverType?void 0:parseFloat(e.treeViewData[i].applicability),bedClassWiseLimitsListVo:e.treeViewData[i].isMaterial?void 0:1!=e.treeViewData[0].packageCoverType?void 0:[{"com.napier.core.masters.vo.BedClassLimitVo":e.getBedClassListPrepare(e.treeViewData[i])}],mtrlPackBedClassLimitVoList:e.treeViewData[i].isMaterial?1!=e.treeViewData[0].packageCoverType?void 0:[{"com.napier.core.masters.vo.MtrlPackBedClassLimitVo":e.getBedClassListPrepare(e.treeViewData[i])}]:void 0};if(1==e.treeViewData[0].packageCoverType?e.treeViewData[i].isMaterial?e.servInclusionMaterrialArr.push(t):e.servInclusionArr.push(t):e.treeViewData[i].isMaterial?e.servExculsiveMaterrialArr.push(t):e.servExculsiveArr.push(t),null!=e.treeViewData[i].srivceTreeList&&10012==e.treeViewData[i].srchObj.CODE){let t=e.treeViewData[i].srivceTreeList;for(let r=0;r<t.length;r++){let n={"@class":t[r].isMaterial?1!=t[0].packageCoverType?"com.napier.core.masters.vo.CompositeServiceExcludeMaterialVo":"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo":1!=t[0].packageCoverType?"com.napier.core.masters.vo.CompositeExculdeServiceVo":"com.napier.core.masters.vo.CompositeIncludeServiceVo"};1==t[0].packageCoverType?t[r].isMaterial?(e.servInclusionMaterrialArr.push(n),a(n,t[r],t[0],e.treeViewData[i],void 0,void 0,4,e)):(e.servInclusionArr.push(n),a(n,t[r],t[0],e.treeViewData[i],void 0,void 0,4,e)):t[r].isMaterial?(e.servExculsiveMaterrialArr.push(n),a(n,t[r],t[0],e.treeViewData[i],void 0,void 0,4,e)):(e.servExculsiveArr.push(n),a(n,t[r],t[0],e.treeViewData[i],void 0,void 0,4,e))}}else if(null!=e.treeViewData[i].departTreeList){let t=e.treeViewData[i].departTreeList;for(let r=0;r<t.length;r++){let n={"@class":t[r].isMaterial?1!=t[0].packageCoverType?"com.napier.core.masters.vo.CompositeServiceExcludeMaterialVo":"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo":1!=t[0].packageCoverType?"com.napier.core.masters.vo.CompositeExculdeServiceVo":"com.napier.core.masters.vo.CompositeIncludeServiceVo",cesSeqId:t[r].isMaterial?void 0:e.packageObj.clonePackage?void 0:1!=t[0].packageCoverType?t[r].cisSeqId:void 0,cisSeqId:t[r].isMaterial?void 0:e.packageObj.clonePackage?void 0:1!=t[0].packageCoverType?void 0:t[r].cisSeqId,cimSeqId:t[r].isMaterial?e.packageObj.clonePackage?void 0:1!=t[0].packageCoverType?void 0:t[r].cisSeqId:void 0,cemSeqId:t[r].isMaterial?e.packageObj.clonePackage?void 0:1!=t[0].packageCoverType?t[r].cisSeqId:void 0:void 0,priServTypCode:parseFloat(e.treeViewData[i].srchObj.CODE),isPost:1!=t[0].packageCoverType?void 0:2,isPre:1!=t[0].packageCoverType?void 0:2,isPrint:t[r].isMaterial?void 0:1!=t[0].packageCoverType?void 0:2,mtrlGrpSeqId:t[r].isMaterial?parseFloat(t[r].srchObj.CODE):void 0,subDeptSeqId:t[r].isMaterial?void 0:parseFloat(t[r].srchObj.CODE),amount:1!=t[0].packageCoverType?void 0:null!=t[r].amount?parseFloat(t[r].amount):void 0,qty:1!=t[0].packageCoverType?void 0:null!=t[r].quantity&&""!==t[r].quantity?parseFloat(t[r].quantity):void 0,serHierarchyLevel:2,applicabilityType:1!=t[0].packageCoverType?void 0:parseFloat(t[r].applicability),bedClassWiseLimitsListVo:t[r].isMaterial?void 0:1!=t[0].packageCoverType?void 0:[{"com.napier.core.masters.vo.BedClassLimitVo":e.getBedClassListPrepare(t[r])}],mtrlPackBedClassLimitVoList:t[r].isMaterial?1!=t[0].packageCoverType?void 0:[{"com.napier.core.masters.vo.MtrlPackBedClassLimitVo":e.getBedClassListPrepare(t[r])}]:void 0};if(1==t[0].packageCoverType?t[r].isMaterial?e.servInclusionMaterrialArr.push(n):e.servInclusionArr.push(n):t[r].isMaterial?e.servExculsiveMaterrialArr.push(n):e.servExculsiveArr.push(n),null!=t[r].srivceTreeList&&10021==t[r].srchObj.CODE){let n=t[r].srivceTreeList;for(let t=0;t<n.length;t++){let r={"@class":n[t].isMaterial?1!=n[0].packageCoverType?"com.napier.core.masters.vo.CompositeServiceExcludeMaterialVo":"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo":1!=n[0].packageCoverType?"com.napier.core.masters.vo.CompositeExculdeServiceVo":"com.napier.core.masters.vo.CompositeIncludeServiceVo"};1==n[0].packageCoverType?n[t].isMaterial?(e.servInclusionMaterrialArr.push(r),a(r,n[t],n[0],e.treeViewData[i],void 0,void 0,4,e)):(e.servInclusionArr.push(r),a(r,n[t],n[0],e.treeViewData[i],void 0,void 0,4,e)):n[t].isMaterial?(e.servExculsiveMaterrialArr.push(r),a(r,n[t],n[0],e.treeViewData[i],void 0,void 0,4,e)):(e.servExculsiveArr.push(r),a(r,n[t],n[0],e.treeViewData[i],void 0,void 0,4,e))}}else if(null!=t[r].specltyTreeList){let n=t[r].specltyTreeList;for(let l=0;l<n.length;l++){let s={"@class":n[l].isMaterial?1!=n[0].packageCoverType?"com.napier.core.masters.vo.CompositeServiceExcludeMaterialVo":"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo":1!=n[0].packageCoverType?"com.napier.core.masters.vo.CompositeExculdeServiceVo":"com.napier.core.masters.vo.CompositeIncludeServiceVo",cesSeqId:n[l].isMaterial?void 0:e.packageObj.clonePackage?void 0:1!=n[0].packageCoverType?n[l].cisSeqId:void 0,cisSeqId:n[l].isMaterial?void 0:e.packageObj.clonePackage?void 0:1!=n[0].packageCoverType?void 0:n[l].cisSeqId,cimSeqId:n[l].isMaterial?e.packageObj.clonePackage?void 0:1!=n[0].packageCoverType?void 0:n[l].cisSeqId:void 0,cemSeqId:n[l].isMaterial?e.packageObj.clonePackage?void 0:1!=n[0].packageCoverType?n[l].cisSeqId:void 0:void 0,priServTypCode:parseFloat(e.treeViewData[i].srchObj.CODE),isPost:1!=n[0].packageCoverType?void 0:2,isPre:1!=n[0].packageCoverType?void 0:2,isPrint:n[l].isMaterial?void 0:1!=n[0].packageCoverType?void 0:2,specialtyCode:n[l].isMaterial?void 0:parseFloat(n[l].srchObj.CODE),mtrlGrpSeqId:t[r].isMaterial?parseFloat(t[r].srchObj.CODE):void 0,mtrlGrpSubSeqId:n[l].isMaterial?parseFloat(n[l].srchObj.CODE):void 0,subDeptSeqId:t[r].isMaterial?void 0:parseFloat(t[r].srchObj.CODE),amount:1!=n[0].packageCoverType?void 0:null!=n[l].amount?parseFloat(n[l].amount):void 0,qty:1!=n[0].packageCoverType?void 0:null!=n[l].quantity&&""!==n[l].quantity?parseFloat(n[l].quantity):void 0,serHierarchyLevel:3,applicabilityType:1!=n[0].packageCoverType?void 0:parseFloat(n[l].applicability),bedClassWiseLimitsListVo:n[l].isMaterial?void 0:1!=n[0].packageCoverType?void 0:[{"com.napier.core.masters.vo.BedClassLimitVo":e.getBedClassListPrepare(n[l])}],mtrlPackBedClassLimitVoList:n[l].isMaterial?1!=n[0].packageCoverType?void 0:[{"com.napier.core.masters.vo.MtrlPackBedClassLimitVo":e.getBedClassListPrepare(n[l])}]:void 0};if(1==n[0].packageCoverType?n[l].isMaterial?e.servInclusionMaterrialArr.push(s):e.servInclusionArr.push(s):n[l].isMaterial?e.servExculsiveMaterrialArr.push(s):e.servExculsiveArr.push(s),null!=n[l].srivceTreeList){let s=n[l].srivceTreeList;for(let o=0;o<s.length;o++){let c={"@class":s[o].isMaterial?1!=s[0].packageCoverType?"com.napier.core.masters.vo.CompositeServiceExcludeMaterialVo":"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo":1!=s[0].packageCoverType?"com.napier.core.masters.vo.CompositeExculdeServiceVo":"com.napier.core.masters.vo.CompositeIncludeServiceVo"};1==s[0].packageCoverType?s[o].isMaterial?(e.servInclusionMaterrialArr.push(c),a(c,s[o],s[0],e.treeViewData[i],t[r],n[l],4,e)):(e.servInclusionArr.push(c),a(c,s[o],s[0],e.treeViewData[i],t[r],n[l],4,e)):s[o].isMaterial?(e.servExculsiveMaterrialArr.push(c),a(c,s[o],s[0],e.treeViewData[i],t[r],n[l],4,e)):(e.servExculsiveArr.push(c),a(c,s[o],s[0],e.treeViewData[i],t[r],n[l],4,e))}}}}}}}}}])}(),function(){"use strict";angular.module("napierContainerUi").service("PackageMasterService",["CallManager","QueryService",function(e,t){this.getPackageHeaderDetails=function(e){let a,i={1:a=[]},r=t.executeQueryURLReset(),n=new Array;return t.prepareParamListWithParam("pServSeqId",e.SERV_SEQ_ID,n),t.executeQueryInput("PACKAGE_HEADER_DETAILS",n,i,!0,!0,r,"popUp",{})},this.getPackageAutoServiceData=function(e,a){let i,r={1:a.tempAutoTriggerList=[],2:i=[]},n=t.executeQueryURLReset();t.executeQueryInput("PACKAGE_AUTO_TRIGGER_SERVICE_DROP_DOWN",[],r,!0,!1,n,"popUp",{});let l=new Array;t.prepareParamListWithParam("pCSLSeqId",e.CSL_SEQ_ID,l),t.executeQueryInput("PACKAGE_ASSIGNED_AUTO_TRIGGER_SERVICE",l,r,!0,!0,n,"popUp",{}).then(function(e){a.getTempAutoServData=angular.copy(i),a.packageObj.autoTriggerServices=i,a.autoTriggerServiceList=a.tempAutoTriggerList;for(var t=0;t<i.length;t++)a.autoTriggerServiceList.push(i[t])})},this.getPackageBedClassDetails=function(e,a){let i,r={1:a.bedClassList=[],2:i=[]},n=t.executeQueryURLReset(),l=new Array;t.prepareParamListWithParam("@pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,l),t.executeQueryInput("SP_USP_BL_GET_TARIFF_CLASS",l,r,!0,!1,n,"popUp",{});let s=new Array;t.prepareParamListWithParam("pCSLSeqId",e.CSL_SEQ_ID,s),t.executeQueryInput("PACKAGE_BED_CLASS_DETAILS",s,r,!0,!0,n,"popUp",{}).then(function(e){a.bedClassGrid.data=[],a.bedClassGrid.data.push({isFirstrow:!0});for(let e=0;e<a.bedClassList.length;e++)for(let t=0;t<i.length;t++)a.bedClassList[e].CODE==i[t].BED_CLASS_ID&&a.bedClassGrid.data.push({bedClass:a.bedClassList[e],amount:i[t].AMOUNT,cslSeqId:i[t].CSL_SEQ_ID,cslBedSeqId:i[t].CSLB_SEQ_ID});for(let e=1;e<a.bedClassGrid.data.length;e++)a.addRmovColumnCoverGrid(a.bedClassGrid.data[e])})},this.getPackageApplicablePayerDetails=function(e,a){let i,r={1:i=[]},n=t.executeQueryURLReset(),l=new Array;t.prepareParamListWithParam("pCSLSeqId",e.CSL_SEQ_ID,l),t.executeQueryInput("PACKAGE_APPLICABLE_PAYER_DETAILS",l,r,!0,!0,n,"popUp",{}).then(function(e){a.packageObj.applicablePayer=[],a.getTempApplPyrData=angular.copy(i);for(let e=0;e<i.length;e++)for(let t=0;t<a.tempListApplPyr.length;t++)if(a.tempListApplPyr[t].INC_SEQ_ID==i[e].PAYER_SEQ_ID){angular.extend(a.tempListApplPyr[t],{cslSeqId:i[e].CSL_SEQ_ID,cslPayerLinkSeqId:i[e].CSLL_SEQ_ID}),a.packageObj.applicablePayer.push(a.tempListApplPyr[t]);break}a.applicablePayerList=a.tempListApplPyr,a.applicablePayerChange(),0==a.packageObj.applicablePayer.length&&i.length>0&&(a.packageObj.selfFlag=!0,null!=a.selfTariff[0]&&(a.selfTariff[0].cslSeqId=i[0].CSL_SEQ_ID,a.selfTariff[0].cslPayerLinkSeqId=i[0].CSLL_SEQ_ID))})};var a=function(e,t){let a="";return t||(t=0),a="1"==e?t:"2"==e?t+" %":"N/L"},i=function(e,t,i,r,n){if(null==t.srivceTreeList)t.srivceTreeList=[],t.srivceTreeList.push({srchObj:n[i],packageCoverType:n[i].TYPE?n[i].TYPE:1,applicability:_.toString(n[i].APPLICABILITY_TYPE),amtNlPer:n[i].SERV_INCL_TYPE?n[i].SERV_INCL_TYPE+"":"1",quantity:n[i].QTY,cisSeqId:n[i].CIS_SEQ_ID,isMaterial:n[i].IS_MATERIAL,chargableAmount:n[i].CHARGEABLE_AMT,nonChargableAmount:n[i].NONCHARGEABLE_AMT,amount:n[i].ACTUAL_RATE,limit:a(n[i].SERV_INCL_TYPE?n[i].SERV_INCL_TYPE+"":"1",n[i].BED_CLASS_AMT)}),t.srivceTreeList[0][n[i].BED_CLASS_CODE]=n[i].BED_CLASS_AMT,t.srivceTreeList[0]["sbclimitSeqId"+n[i].BED_CLASS_CODE]=n[i].SBCLM_SEQ_ID;else for(let e=0;e<t.srivceTreeList.length;e++){if(t.srivceTreeList[e].cisSeqId==n[i].CIS_SEQ_ID&&!sessionStorage.getItem("packageSeqId")&&!angular.fromJson(sessionStorage.getItem("packageServiceList"))){t.srivceTreeList[e][n[i].BED_CLASS_CODE]=n[i].BED_CLASS_AMT,t.srivceTreeList[e]["sbclimitSeqId"+n[i].BED_CLASS_CODE]=n[i].SBCLM_SEQ_ID;break}if(e==t.srivceTreeList.length-1){t.srivceTreeList.push({srchObj:n[i],packageCoverType:n[i].TYPE?n[i].TYPE:1,applicability:_.toString(n[i].APPLICABILITY_TYPE),amtNlPer:n[i].SERV_INCL_TYPE?n[i].SERV_INCL_TYPE+"":"1",quantity:n[i].QTY,cisSeqId:n[i].CIS_SEQ_ID,chargableAmount:n[i].CHARGEABLE_AMT,nonChargableAmount:n[i].NONCHARGEABLE_AMT,amount:n[i].ACTUAL_RATE,isMaterial:n[i].IS_MATERIAL,limit:a(n[i].SERV_INCL_TYPE?n[i].SERV_INCL_TYPE+"":"1",n[i].BED_CLASS_AMT)}),t.srivceTreeList[e+1][n[i].BED_CLASS_CODE]=n[i].BED_CLASS_AMT,t.srivceTreeList[e+1]["sbclimitSeqId"+n[i].BED_CLASS_CODE]=n[i].SBCLM_SEQ_ID;break}}};this.getPackageIncExcDetails=function(e,r,n){let l,s={1:l=[]},o=t.executeQueryURLReset(),c=new Array;if(sessionStorage.getItem("packageSeqId")&&!angular.fromJson(sessionStorage.getItem("packageServiceList"))){t.prepareParamListWithParam("pParentSpSeqId",parseInt(sessionStorage.getItem("spSeqId")),c),t.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,c),t.prepareParamListWithParam("pBedClassId",parseInt(sessionStorage.getItem("bedClassId")),c),t.prepareParamListWithParam("pParentSeriveSeqId",parseInt(sessionStorage.getItem("packageSeqId")),c);var d="VIEW_PACKAGE_CALCULATION_DETAILS"}else{t.prepareParamListWithParam("pPackServSeqId",e.SERV_SEQ_ID,c),t.prepareParamListWithParam("pBedClassId",null!=e.bedClassId&&null!=e.bedClassId&&""!==e.bedClassId?e.bedClassId:-999,c);d="PACKAGE_INC_EXC_DETAILS_WITH_BED_DETAILS"}return t.executeQueryInput(d,c,s,!0,!0,o,"popUp",{}).then(function(e){r.treeViewData=[];for(let e=0;e<l.length;e++)if(1==l[e].SER_HIERARCHY_LEVEL)if(0==r.treeViewData.length)r.treeViewData.push({srchObj:{DESCRIPTION:l[e].PRI_DESC,CODE:l[e].PRI_CODE},packageCoverType:l[e].TYPE?l[e].TYPE:1,applicability:l[e].APPLICABILITY_TYPE+"",amtNlPer:l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",quantity:l[e].QTY,cisSeqId:l[e].CIS_SEQ_ID,chargableAmount:l[e].CHARGEABLE_AMT,nonChargableAmount:l[e].NONCHARGEABLE_AMT,amount:l[e].ACTUAL_RATE,isMaterial:l[e].IS_MATERIAL,limit:a(l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",l[e].BED_CLASS_AMT)}),r.treeViewData[0][l[e].BED_CLASS_CODE]=l[e].BED_CLASS_AMT,r.treeViewData[0]["sbclimitSeqId"+l[e].BED_CLASS_CODE]=l[e].SBCLM_SEQ_ID;else for(let t=0;t<r.treeViewData.length;t++){if(r.treeViewData[t].cisSeqId==l[e].CIS_SEQ_ID&&!sessionStorage.getItem("packageSeqId")&&!angular.fromJson(sessionStorage.getItem("packageServiceList"))){r.treeViewData[t][l[e].BED_CLASS_CODE]=l[e].BED_CLASS_AMT,r.treeViewData[t]["sbclimitSeqId"+l[e].BED_CLASS_CODE]=l[e].SBCLM_SEQ_ID;break}if(t==r.treeViewData.length-1){r.treeViewData.push({srchObj:{DESCRIPTION:l[e].PRI_DESC,CODE:l[e].PRI_CODE},packageCoverType:l[e].TYPE?l[e].TYPE:1,applicability:l[e].APPLICABILITY_TYPE+"",amtNlPer:l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",quantity:l[e].QTY,cisSeqId:l[e].CIS_SEQ_ID,isMaterial:l[e].IS_MATERIAL,limit:a(l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",l[e].BED_CLASS_AMT),chargableAmount:l[e].CHARGEABLE_AMT,nonChargableAmount:l[e].NONCHARGEABLE_AMT,amount:l[e].ACTUAL_RATE}),r.treeViewData[t+1][l[e].BED_CLASS_CODE]=l[e].BED_CLASS_AMT,r.treeViewData[t+1]["sbclimitSeqId"+l[e].BED_CLASS_CODE]=l[e].SBCLM_SEQ_ID;break}}else if(2==l[e].SER_HIERARCHY_LEVEL){for(let t=0;t<r.treeViewData.length;t++)if(r.treeViewData[t].srchObj.CODE==l[e].PRI_CODE)if(null==r.treeViewData[t].departTreeList)r.treeViewData[t].departTreeList=[],r.treeViewData[t].departTreeList.push({srchObj:{DESCRIPTION:10006==r.treeViewData[t].srchObj.CODE?1==l[e].DEPT_CODE?"ICU":"NON-ICU":l[e].DEPT_DESC,CODE:l[e].DEPT_CODE},packageCoverType:l[e].TYPE?l[e].TYPE:1,applicability:l[e].APPLICABILITY_TYPE+"",amtNlPer:l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",quantity:l[e].QTY,cisSeqId:l[e].CIS_SEQ_ID,isMaterial:l[e].IS_MATERIAL,chargableAmount:l[e].CHARGEABLE_AMT,nonChargableAmount:l[e].NONCHARGEABLE_AMT,amount:l[e].ACTUAL_RATE,limit:a(l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",l[e].BED_CLASS_AMT)}),r.treeViewData[t].departTreeList[0][l[e].BED_CLASS_CODE]=l[e].BED_CLASS_AMT,r.treeViewData[t].departTreeList[0]["sbclimitSeqId"+l[e].BED_CLASS_CODE]=l[e].SBCLM_SEQ_ID;else for(let i=0;i<r.treeViewData[t].departTreeList.length;i++){if(r.treeViewData[t].departTreeList[i].cisSeqId==l[e].CIS_SEQ_ID&&!sessionStorage.getItem("packageSeqId")&&!angular.fromJson(sessionStorage.getItem("packageServiceList"))){r.treeViewData[t].departTreeList[i][l[e].BED_CLASS_CODE]=l[e].BED_CLASS_AMT,r.treeViewData[t].departTreeList[i]["sbclimitSeqId"+l[e].BED_CLASS_CODE]=l[e].SBCLM_SEQ_ID;break}if(i==r.treeViewData[t].departTreeList.length-1){r.treeViewData[t].departTreeList.push({srchObj:{DESCRIPTION:10006==r.treeViewData[t].srchObj.CODE?1==l[e].DEPT_CODE?"ICU":"NON-ICU":l[e].DEPT_DESC,CODE:l[e].DEPT_CODE},packageCoverType:l[e].TYPE?l[e].TYPE:1,chargableAmount:l[e].CHARGEABLE_AMT,nonChargableAmount:l[e].NONCHARGEABLE_AMT,amount:l[e].ACTUAL_RATE,applicability:l[e].APPLICABILITY_TYPE+"",amtNlPer:l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",quantity:l[e].QTY,cisSeqId:l[e].CIS_SEQ_ID,isMaterial:l[e].IS_MATERIAL,limit:a(l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",l[e].BED_CLASS_AMT)}),r.treeViewData[t].departTreeList[i+1][l[e].BED_CLASS_CODE]=l[e].BED_CLASS_AMT,r.treeViewData[t].departTreeList[i+1]["sbclimitSeqId"+l[e].BED_CLASS_CODE]=l[e].SBCLM_SEQ_ID;break}}}else if(3==l[e].SER_HIERARCHY_LEVEL){for(let t=0;t<r.treeViewData.length;t++)if(r.treeViewData[t].srchObj.CODE==l[e].PRI_CODE)for(let i=0;i<r.treeViewData[t].departTreeList.length;i++)if(r.treeViewData[t].departTreeList[i].srchObj.CODE==l[e].DEPT_CODE)if(null==r.treeViewData[t].departTreeList[i].specltyTreeList)r.treeViewData[t].departTreeList[i].specltyTreeList=[],r.treeViewData[t].departTreeList[i].specltyTreeList.push({srchObj:{DESCRIPTION:l[e].SPECIALITY_DESC,CODE:l[e].SPECIALITY_CODE},packageCoverType:l[e].TYPE?l[e].TYPE:1,applicability:_.toString(l[e].APPLICABILITY_TYPE),amtNlPer:l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",quantity:l[e].QTY,cisSeqId:l[e].CIS_SEQ_ID,isMaterial:l[e].IS_MATERIAL,chargableAmount:l[e].CHARGEABLE_AMT,nonChargableAmount:l[e].NONCHARGEABLE_AMT,amount:l[e].ACTUAL_RATE,limit:a(l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",l[e].BED_CLASS_AMT)}),r.treeViewData[t].departTreeList[i].specltyTreeList[0][l[e].BED_CLASS_CODE]=l[e].BED_CLASS_AMT,r.treeViewData[t].departTreeList[i].specltyTreeList[0]["sbclimitSeqId"+l[e].BED_CLASS_CODE]=l[e].SBCLM_SEQ_ID;else for(let n=0;n<r.treeViewData[t].departTreeList[i].specltyTreeList.length;n++){if(r.treeViewData[t].departTreeList[i].specltyTreeList[n].cisSeqId==l[e].CIS_SEQ_ID&&!sessionStorage.getItem("packageSeqId")&&!angular.fromJson(sessionStorage.getItem("packageServiceList"))){r.treeViewData[t].departTreeList[i].specltyTreeList[n][l[e].BED_CLASS_CODE]=l[e].BED_CLASS_AMT,r.treeViewData[t].departTreeList[i].specltyTreeList[n]["sbclimitSeqId"+l[e].BED_CLASS_CODE]=l[e].SBCLM_SEQ_ID;break}if(n==r.treeViewData[t].departTreeList[i].specltyTreeList.length-1){r.treeViewData[t].departTreeList[i].specltyTreeList.push({srchObj:{DESCRIPTION:l[e].SPECIALITY_DESC,CODE:l[e].SPECIALITY_CODE},packageCoverType:l[e].TYPE?l[e].TYPE:1,applicability:l[e].APPLICABILITY_TYPE,chargableAmount:l[e].CHARGEABLE_AMT,nonChargableAmount:l[e].NONCHARGEABLE_AMT,amount:l[e].ACTUAL_RATE,amtNlPer:l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",quantity:l[e].QTY,cisSeqId:l[e].CIS_SEQ_ID,isMaterial:l[e].IS_MATERIAL,limit:a(l[e].SERV_INCL_TYPE?l[e].SERV_INCL_TYPE+"":"1",l[e].BED_CLASS_AMT)}),r.treeViewData[t].departTreeList[i].specltyTreeList[n+1][l[e].BED_CLASS_CODE]=l[e].BED_CLASS_AMT,r.treeViewData[t].departTreeList[i].specltyTreeList[n+1]["sbclimitSeqId"+l[e].BED_CLASS_CODE]=l[e].SBCLM_SEQ_ID;break}}}else if(4==l[e].SER_HIERARCHY_LEVEL)for(let t=0;t<r.treeViewData.length;t++)if(r.treeViewData[t].srchObj.CODE==l[e].PRI_CODE&&10012==l[e].PRI_CODE)i(0,r.treeViewData[t],e,0,l);else if(r.treeViewData[t].srchObj.CODE==l[e].PRI_CODE)for(let a=0;a<r.treeViewData[t].departTreeList.length;a++)if(r.treeViewData[t].departTreeList[a].srchObj.CODE==l[e].DEPT_CODE&&10021==l[e].PRI_CODE)i(0,r.treeViewData[t].departTreeList[a],e,0,l);else if(r.treeViewData[t].departTreeList[a].srchObj.CODE==l[e].DEPT_CODE)for(let n=0;n<r.treeViewData[t].departTreeList[a].specltyTreeList.length;n++)r.treeViewData[t].departTreeList[a].specltyTreeList[n].srchObj.CODE==l[e].SPECIALITY_CODE&&i(0,r.treeViewData[t].departTreeList[a].specltyTreeList[n],e,0,l);if("1"==n)return r.treeViewData})}}])}(),function(){"use strict";function e(e,t,a){this.editIPServicefun=function(i,r,n,l,s,o,c){var d=e.defer(),p={};return p.url=t.HISSCMSERVICE.URL,p.requestData={operation:"saveService",messageId:"",destination:"com.napier.core.masters.service.external.PackageMasterService",message:{"@class":"com.napier.core.masters.vo.ServiceVo",gnServDesign:"1",gnServStatus:"1",gnTranStatus:"1",practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilitySeqId:i.facilitySeqId,defDeptCode:i.defDeptCode,subDeptSeqId:i.subDeptSeqId,packageType:i.packageType,packgSeqId:i.packgSeqId,servName:i.servName,gender:i.gender,encntrDays:i.encntrDays,packgDays:i.packgDays,servAltName:i.servAltName,servFromDate:i.servFromDate,servToDate:i.servToDate,notEdit:"0",compositeIncludeServiceVoList:[{"com.napier.core.masters.vo.CompositeIncludeServiceVo":n}],compositeServiceIncludeMaterialVoList:[{"com.napier.core.masters.vo.CompositeServiceIncludeMaterialVo":l}],compositeExculdeServiceVoList:[{"com.napier.core.masters.vo.CompositeExculdeServiceVo":s}],compositeServiceExcludeMaterialVoList:[{"com.napier.core.masters.vo.CompositeServiceExcludeMaterialVo":o}],compositeServiceLimitVoList:[{"com.napier.core.masters.vo.CompositeServiceLimitVo":r}],packageCheckListVo:[{"com.napier.core.masters.vo.PackageCheckListVo":c}]}},a.sendRestRequest(p).then(function(e){d.resolve(e)},function(e){d.reject(e)}),d.promise}}e.$inject=["$q","BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("editIPService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("discountModelGridDef",{enableHorizontalScrollbar:0,columnDefs:[{name:"radio_row",displayName:"",width:"35",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align: center;"><input type="radio" name="discountRadio" ng-init="discountRow=0" ng-value="true" ng-model="discountRow" ng-click="grid.appScope.onRadioBtnClick(row)" style="border:none"></div>'},{name:"DISCOUNT_NAME",displayName:"Discount Type"},{name:"IS_BILL_OR_SERVICE_LEVEL",displayName:"Applicability"},{name:"STATUS",displayName:"Status"}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("discountSaveGridDef",{enableHorizontalScrollbar:0,columnDefs:[{field:"requestNumber",displayName:"Request Number"},{field:"discount",displayName:"Discount"},{field:"applicability",displayName:"Applicability"},{field:"disValue",displayName:"Discount Value"},{field:"disAmt",displayName:"Total Discount Amount"},{field:"disStatus",displayName:"Discount Status"},{field:"actions",displayName:"Actions",width:90,cellTemplate:'<div class="ui-grid-cell-contents action-row" ><i class="fa fa-eye"  ng-click="grid.appScope.pbd.viewDiscountDetilas(row.entity,rowRenderIndex)"></i><i class="fa fa-trash" ng-disabled="row.entity.DT_CODE!=1" ng-click="grid.appScope.pbd.deleteDiscount(row.entity,rowRenderIndex)"></i></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("patientBillDiscountServiceGridDef",{enableSorting:!1,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:0,showGridFooter:!0,showColumnFooter:!1,gridFooterTemplate:"<div style='text-align: center;background-color: #d9e2f1;color: #6a6d72;font-weight: 600;padding-top: 4px;padding-bottom: 8px;'> <span style='float: right;padding-right: 18%;'>Total Discount Amt: <span style='font-weight: bolder;'>{{grid.appScope.pbd.totalAppliedDiscount|number:2}}</span></span><div class='clear-fix'></div></div>",columnDefs:[{name:"primayServiceGroup",displayName:"Primay Service Group",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div  class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.primayServiceGroup"  ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.pbd.psgdwn_copay track by dept.CODE" ng-change="grid.appScope.pbd.loadDeptDropdown(row.entity.primayServiceGroup,rowRenderIndex)"><option selected hidden="" style="">Select One</option></select></div>'},{name:"department",displayName:"Department",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.department" ng-change="grid.appScope.pbd.OnChangeDept(row.entity,rowRenderIndex)" ng-options="dept as dept.DESCRIPTION for dept in grid.appScope.pbd.deptdwn_copay[rowRenderIndex] track by dept.CODE"><option selected hidden="" style="">Select One</option></select></div>'},{name:"speciality",displayName:"Speciality",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.speciality" ng-options="spe as spe.DESCRIPTION for spe in grid.appScope.pbd.deptSpecicityService[rowRenderIndex] track by spe.CODE"><option selected hidden="" style="">Select One</option></select></div>'},{name:"service",displayName:"Service",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" class="form-control" ng-disabled="row.entity.isEditable"ng-model="row.entity.service" placeholder="service" uib-typeahead="suppliersList as suppliersList.SERV_NAME for suppliersList in grid.appScope.pbd.serchOptimSpeciSerch($viewValue,rowRenderIndex,row.entity)"  typeahead-on-select="grid.appScope.pbd.setdWData(row.entity.service,rowRenderIndex)" style="" typeahead-append-to-body=true ></div>'},{name:"amount",displayName:"Amount",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" class="form-control" ng-disabled="row.entity.isEditable" number-with-decimal decimal-upto="2" allow-negative="false"  my-maxlength="15" ng-model="row.entity.amount" ng-change="grid.appScope.pbd.calActualAmt(row,rowRenderIndex)" placeholder="Enter" style=""></div>'},{name:"discountType",displayName:"Discount",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><select class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.discountType" ng-change="grid.appScope.pbd.calActualAmt(row,rowRenderIndex)" ng-options="dept as dept.DETAIL_DESC for dept in grid.appScope.pbd.discountTypeList track by dept.DT_CODE"></select></div>'},{name:"discountValue",displayName:"Value",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" class="form-control" ng-disabled="row.entity.isEditable" number-with-decimal decimal-upto="2" allow-negative="false"  my-maxlength="15" ng-model="row.entity.discountValue" ng-change="grid.appScope.pbd.calActualAmt(row,rowRenderIndex)" placeholder="Enter" style=""></div>'},{name:"appliedDiscount",displayName:"Applied Discount",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" class="form-control" ng-disabled="true" number-with-decimal decimal-upto="2" allow-negative="false" my-maxlength="15" ng-model="row.entity.appliedDiscount" placeholder="Enter" style=""></div>'},{name:"approvedDiscount",displayName:"Approved Discount",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" class="form-control" ng-disabled="true" number-with-decimal decimal-upto="2" allow-negative="false" my-maxlength="15" ng-model="row.entity.approvedDiscount" placeholder="Enter" style=""></div>'},{name:"approvalAppliedDiscount",displayName:"Applied Discount",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" class="form-control" ng-disabled="true" number-with-decimal decimal-upto="2" allow-negative="false" my-maxlength="15" ng-model="row.entity.approvalAppliedDiscount" placeholder="Enter" style=""></div>'},{name:"actions",displayName:"Actions",enableSorting:!1,enableCellEdit:!0,visible:!0,cellTemplate:'<div class="ui-grid-cell-contents action-row copay-grid-action-icons" ng-if="row.entity.isFirstRow"><i class="fa fa-pencil" ng-click="grid.appScope.pbd.editRow(row.entity,rowRenderIndex)"></i><i class="fa fa-trash" ng-click="grid.appScope.pbd.deleteRow(row.entity,rowRenderIndex)"></i></div><div class="ui-grid-cell-contents"><button ng-if="(!row.entity.isFirstRow && !grid.appScope.editRowFlag)" class="his-btn his-btn-info his-grid-btn" ng-click="grid.appScope.pbd.discountMasterServiceGridList(row.entity,rowRenderIndex)" style="position: relative; top: -4px;"><i class="fa fa-plus"></i> Add</button><button ng-if="grid.appScope.editRowFlag"class="his-btn his-btn-info his-grid-btn" ng-click="grid.appScope.pbd.updateDiscountServiceGrid(row.entity,rowRenderIndex)"><i class="fa fa-plus"></i> Update</button></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("approvalDiscountServiceGridDef",{enableSorting:!1,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:0,showGridFooter:!0,showColumnFooter:!1,gridFooterTemplate:"<div style='text-align: center;background-color: #d9e2f1;color: #6a6d72;font-weight: 600;padding-top: 4px;padding-bottom: 8px;'>  <span style='float: right;padding-right: 8%;font-weight: bolder;'>{{grid.appScope.pbd.totalApprovalDiscount|number:2}}</span> <span style='float: right;padding-right: 19%;font-weight: bolder;'>{{grid.appScope.pbd.totalApReqlDiscount|number:2}}</span><div class='clear-fix'></div></div>",columnDefs:[{name:"select",displayName:"billing.reject",headerCellFilter:"translate",headerCellTemplate:'<div class="ui-grid-cell-contents" style="text-align: center;"><input style="z-index:99999" type="checkbox" ng-model="grid.appScope.headerCheckBox" id="check-all-jobs" ng-disabled="grid.appScope.rejectAllDisable" ng-click="grid.appScope.toogleAllCheckBox(grid.appScope.gridOptionsApprovalDiscountSerivce.data,grid.appScope.headerCheckBox)"><span style="color: #ffffff;">Reject</span></input></div>',enableSorting:!0,enableCellEdit:!1,width:"7%",cellTemplate:'<div class="ui-grid-cell-contents"><input style="border:none;" type="checkbox" ng-model="row.entity.select" ng-disabled="row.entity.rejectDisable" ng-change="grid.appScope.pbd.isChecked(row.entity)"/></div>'},{name:"primayServiceGroup",displayName:"Primay Service Group",enableSorting:!1,enableCellEdit:!1},{name:"department",displayName:"Department",enableSorting:!1,enableCellEdit:!1},{name:"speciality",displayName:"Speciality",enableSorting:!1,enableCellEdit:!1},{name:"service",displayName:"Service",enableSorting:!1,enableCellEdit:!1},{name:"amount",displayName:"Amount",enableSorting:!1,enableCellEdit:!1},{name:"defination",displayName:"Defination",enableSorting:!1,enableCellEdit:!1},{name:"reqDiscount",displayName:"Req Discount",enableSorting:!1,enableCellEdit:!1},{name:"approvedDiscountValue",displayName:"Approved Discount",enableSorting:!1,enableCellEdit:!1,visible:!0},{name:"approvedDiscount",displayName:"Approved Discount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,visible:!0,cellTemplate:'<div class="ui-grid-cell-contents"><select style="width:55px;margin-left:3px;float:left" ng-disabled="row.entity.select" class="form-control" ng-options="dept as dept.DETAIL_DESC for dept in grid.appScope.pbd.discountTypeList track by dept.DT_CODE" ng-model="row.entity.approvalAmountType" ng-change="grid.appScope.pbd.changePerAmtValue(row.entity,rowRenderIndex);grid.appScope.pbd.approvalCalActualAmt(row,rowRenderIndex);grid.appScope.pbd.sumTotalDisCountValues(grid.appScope.gridOptionsApprovalDiscountSerivce.data,\'ApprovalGrid\',row)"></select><input id="g" ng-disabled="row.entity.select" number-with-decimal decimal-upto="2" allow-negative="false" my-maxlength="15" style="width:55px;float:left;padding: 3px;position:relative;top: -4px;" class="form-control" ng-model="row.entity.approvalAmountValue" ng-change="grid.appScope.pbd.changePerAmtValue(row.entity,rowRenderIndex);grid.appScope.pbd.approvalCalActualAmt(row,rowRenderIndex);grid.appScope.pbd.sumTotalDisCountValues(grid.appScope.gridOptionsApprovalDiscountSerivce.data,\'ApprovalGrid\',row)"/></div>',width:"130"},{name:"appliedDiscount",displayName:"Applied Discount",enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="grid-input ui-grid-cell-contents action-row"><input type="text" class="form-control" ng-disabled="true" number-with-decimal decimal-upto="2" allow-negative="false" my-maxlength="15" ng-model="row.entity.appliedDiscount" placeholder="Enter" style=""></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("patientBillViewGridDef",{enableSorting:!1,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:0,showGridFooter:!0,showColumnFooter:!1,gridFooterTemplate:"<div style='text-align: center;background-color: #d9e2f1;color: #6a6d72;font-weight: 600;padding-top: 4px;padding-bottom: 8px;'> <span style='float: right;padding-right: 18%;'>Total Discount Amt: <span style='font-weight: bolder;'>{{grid.appScope.pbd.totalAppliedDiscount|number:2}}</span></span><div class='clear-fix'></div></div>",columnDefs:[{name:"primayServiceGroup",displayName:"Primay Service Group",enableSorting:!1,enableCellEdit:!1},{name:"department",displayName:"Department",enableSorting:!1,enableCellEdit:!1},{name:"speciality",displayName:"Speciality",enableSorting:!1,enableCellEdit:!1},{name:"service",displayName:"Service",enableSorting:!1,enableCellEdit:!1},{name:"amount",displayName:"Amount",enableSorting:!1,enableCellEdit:!1},{name:"defination",displayName:"Defination",enableSorting:!1,enableCellEdit:!1},{name:"appliedDiscount",displayName:"Req Discount",enableSorting:!1,enableCellEdit:!1},{name:"approvedDiscount",displayName:"Approved Discount",enableSorting:!1,enableCellEdit:!1},{name:"approvalAppliedDiscount",displayName:"Applied Discount",enableSorting:!1,enableCellEdit:!1}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("billDetailsForGridConstantMain",{enableHorizontalScrollbar:0,expandableRowTemplate:'<div><div ng-repeat="subGrid in row.entity.subGridList" ui-grid="subGrid" class="his-grid-150" ui-grid-auto-resize ui-grid-resize-columns ui-grid-selection ></div></div>',expandableRowHeight:180,expandableRowScope:{subGridVariable:"subGridScopeVariable"},columnDefs:[{field:"details",displayName:"Details"},{field:"chargeableAmt",displayName:"Amount",width:120,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.chargeableAmt|number:2}}</span></div>'},{field:"payerAmount",displayName:"Payer Amt.",width:120,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.payerAmount|number:2}}</span></div>'},{field:"patientAmount",displayName:"Patient Amt.",width:120,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.patientAmount|number:2}}</span></div>'},{field:"selfAmount",displayName:"Self Amt.",width:100,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.selfAmount|number:2}}</span></div>'},{field:"nonChargableAmt",displayName:"Covered Amount",visible:!1,width:200,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.nonChargableAmt|number:2}}</span></div>'},{field:"exceededAmt",displayName:"Exceeded Amount",visible:!1,width:220,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.exceededAmt|number:2}}</span></div>'}]}).constant("billDetailsForGridConstantInvestigations",{enableHorizontalScrollbar:0,disableRowExpandable:!1,columnDefs:[{displayName:"Service Name",field:"serviceVo.servName"},{displayName:"Order number",field:"orderNo",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.orderNo}}</div>'},{displayName:"Order date",field:"orderDate",cellTemplate:'<div  class="ui-grid-cell-contents"><span>{{row.entity.orderDate!=undefined&&row.entity.orderDate.$!=undefined?(row.entity.orderDate.$|date:"dd/MM/yyyy"):row.entity.orderDate|date:"dd/MM/yyyy"}}</span></div>'},{displayName:"Billing bed class",field:"Billing_Bed_Class_Desc"},{displayName:"Quantity",field:"quantity",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.quantity}}</div>'},{field:"chargeableAmt",displayName:"Amount",width:113,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.chargeableAmt|number:2}}</span></div>'},{displayName:"Payer Amt.",width:113,field:"payerAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.payerAmount|number:2}}</span></div>'},{displayName:"Patient Amt.",width:113,field:"patientAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.patientAmount|number:2}}</span></div>'},{displayName:"Self Amt.",width:83,field:"selfAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.selfAmount|number:2}}</span></div>'},{field:"nonChargableAmt",displayName:"Covered Amount",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.nonChargableAmt|number:2}}</span></div>'},{field:"exceededAmt",displayName:"Exceeded Amount",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.exceededAmt|number:2}}</span></div>'}]}).constant("billDetailsForGridConstantBedRental",{enableHorizontalScrollbar:0,disableRowExpandable:!1,columnDefs:[{displayName:"Bed details",field:"serviceVo.servName"},{displayName:"From date",field:"FROM_DATE",cellTemplate:'<div  class="ui-grid-cell-contents"><span>{{row.entity.startTime!=undefined&&row.entity.startTime.$!=undefined?(row.entity.startTime.$|date:"dd/MM/yyyy"):row.entity.startTime|date:"dd/MM/yyyy"}}</span></div>'},{displayName:"To Date",field:"TO_DATE",cellTemplate:'<div  class="ui-grid-cell-contents"><span>{{row.entity.endTime!=undefined&&row.entity.endTime.$!=undefined?(row.entity.endTime.$|date:"dd/MM/yyyy"):row.entity.endTime|date:"dd/MM/yyyy"}}</span></div>'},{displayName:"Billing bed class",field:"Billing_Bed_Class_Desc"},{displayName:"Duration",field:"Duration"},{field:"chargeableAmt",displayName:"Amount",width:113,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.chargeableAmt|number:2}}</span></div>'},{displayName:"Payer Amt.",width:113,field:"payerAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.payerAmount|number:2}}</span></div>'},{displayName:"Patient Amt.",width:113,field:"patientAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.patientAmount|number:2}}</span></div>'},{displayName:"Self Amt.",width:83,field:"selfAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.selfAmount|number:2}}</span></div>'},{field:"nonChargableAmt",displayName:"Covered Amount",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.nonChargableAmt|number:2}}</span></div>'},{field:"exceededAmt",displayName:"Exceeded Amount",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.exceededAmt|number:2}}</span></div>'}]}).constant("billDetailsForGridConstantOT",{enableHorizontalScrollbar:0,disableRowExpandable:!1,columnDefs:[{displayName:"OT details",field:"serviceVo.servName"},{displayName:"From date",field:"FROM_DATE",cellTemplate:'<div  class="ui-grid-cell-contents"><span>{{row.entity.startTime!=undefined&&row.entity.startTime.$!=undefined?(row.entity.startTime.$|date:"dd/MM/yyyy"):row.entity.startTime|date:"dd/MM/yyyy"}}</span></div>'},{displayName:"To Date",field:"TO_DATE",cellTemplate:'<div  class="ui-grid-cell-contents"><span>{{row.entity.endTime!=undefined&&row.entity.endTime.$!=undefined?(row.entity.endTime.$|date:"dd/MM/yyyy"):row.entity.endTime|date:"dd/MM/yyyy"}}</span></div>'},{displayName:"Billing bed class",field:"Billing_Bed_Class_Desc"},{displayName:"Duration",field:"Duration"},{field:"chargeableAmt",displayName:"Amount",width:113,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.chargeableAmt|number:2}}</span></div>'},{displayName:"Payer Amt.",width:113,field:"payerAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.payerAmount|number:2}}</span></div>'},{displayName:"Patient Amt.",width:113,field:"patientAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.patientAmount|number:2}}</span></div>'},{displayName:"Self Amt.",width:83,field:"selfAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.selfAmount|number:2}}</span></div>'},{field:"nonChargableAmt",displayName:"Covered Amount",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.nonChargableAmt|number:2}}</span></div>'},{field:"exceededAmt",displayName:"Exceeded Amount",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.exceededAmt|number:2}}</span></div>'}]}).constant("billDetailsForGridConstantEquipment",{enableHorizontalScrollbar:0,disableRowExpandable:!1,columnDefs:[{displayName:"Equipment details",field:"serviceVo.servName"},{displayName:"From date",field:"FROM_DATE",cellTemplate:'<div  class="ui-grid-cell-contents"><span>{{row.entity.startTime!=undefined&&row.entity.startTime.$!=undefined?(row.entity.startTime.$|date:"dd/MM/yyyy"):row.entity.startTime|date:"dd/MM/yyyy"}}</span></div>'},{displayName:"To Date",field:"TO_DATE",cellTemplate:'<div  class="ui-grid-cell-contents"><span>{{row.entity.endTime!=undefined&&row.entity.endTime.$!=undefined?(row.entity.endTime.$|date:"dd/MM/yyyy"):row.entity.endTime|date:"dd/MM/yyyy"}}</span></div>'},{displayName:"Billing bed class",field:"Billing_Bed_Class_Desc"},{displayName:"Duration",field:"Duration"},{field:"chargeableAmt",displayName:"Amount",width:113,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.chargeableAmt|number:2}}</span></div>'},{displayName:"Payer Amt.",width:113,field:"payerAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.payerAmount|number:2}}</span></div>'},{displayName:"Patient Amt.",width:113,field:"patientAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.patientAmount|number:2}}</span></div>'},{displayName:"Self Amt.",width:83,field:"selfAmount",cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.selfAmount|number:2}}</span></div>'},{field:"nonChargableAmt",displayName:"Covered Amount",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.nonChargableAmt|number:2}}</span></div>'},{field:"exceededAmt",displayName:"Exceeded Amount",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span class="pull-right">{{row.entity.exceededAmt|number:2}}</span></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("requestAndHistoryGridDef",{enableHorizontalScrollbar:0,showGridFooter:!0,columnDefs:[{name:"radio_row",displayName:"",headerCellFilter:"translate",width:20,visible:!0,headerCellTemplate:"<div><div>",cellTemplate:'<div class="ngSelectionCell selector-group"><label class="radio-inline"><input type="radio" name="reqList" ng-value="true" ng-disabled="!grid.appScope.payment.disableType" ng-model="releaseAction" ng-click="grid.appScope.payment.requestSelect(row)"></label></div>'},{field:"deptranDate.$",displayName:"Request Date",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.deptranDate.$ | date :"dd-MM-yyyy hh:mm a"}}</div>'},{field:"depositTypeDesc",displayName:"Request Type"},{field:"depositAmount",displayName:"Request Amount"},{field:"depositAmount",displayName:"Balance Amount",visible:!0}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("paymentGridDef",{enableHorizontalScrollbar:0,showGridFooter:!0,columnDefs:[{field:"PayMode",displayName:"Payment Mode"},{field:"amtPaid",displayName:"Amount Paid"},{field:"ACTION",displayName:"Action",cellTemplate:'<div class="ui-grid-cell-contents action-row"><i class="fa fa-pencil role="button" ng-click="grid.appScope.payment.editPayment(row.entity,rowRenderIndex)"></i><i class="fa fa-trash" role="button" ng-click="grid.appScope.payment.deletePayment(row.entity,rowRenderIndex)"></i></div>',width:100}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("patReceiptDetailsGridDef",{enableHorizontalScrollbar:0,showGridFooter:!0,columnDefs:[{field:"DEPOSIT_NO",displayName:"Deposit Number"},{field:"RECEIPT_NO",displayName:"Receipt Number"},{field:"DEPOSIT_DATE",displayName:"Deposit Date",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.DEPOSIT_DATE | date :"dd-MM-yyyy hh:mm a"}}</div>'},{field:"DEPOSIT_AMT",displayName:"Deposit Amount"},{field:"ADJUSTED_AMT",displayName:"Adjusted Amount"},{field:"REFUND_AMT",displayName:"Refund Amount"},{field:"BALANCE_AMT",displayName:"Balance Amount"},{field:"RECEIVED_FROM",displayName:"Received From"},{field:"RECEIVED_BY",displayName:"Received By"},{field:"action",displayName:"Action",cellTemplate:'<div class="ui-grid-cell-contents action-row"><div><i class="fa fa-print" role="button" ng-click="grid.appScope.payment.printReceipt(row.entity,rowRenderIndex)"></i></div></div>'}]})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o){this.loadDepositTypeCombo=function(e){var t=i.defer();e.depositTypeArr=[],e.depsitypeList={1:e.depositTypeArr};var a=r.executeQueryURLReset(),n=new Array;return r.prepareParamListWithParam("pPracticeId",JSON.parse(sessionStorage.userContextObj).CLIENT_REF_ID,n),r.prepareParamListWithParam("pStatus",-999,n),r.prepareParamListWithParam("pdepositTypeName","",n),r.prepareParamListWithParam("pFlow",-999,n),r.prepareParamListWithParam("pApplicableTo",-999,n),r.prepareParamListWithParam("pFacilityId",JSON.parse(sessionStorage.userContextObj).FACILITY_ID,n),r.executeQueryInput("ANSC_DEPOSIT_TYPE_001",n,e.depsitypeList,!0,!0,a,"popUp",{}).then(function(e){return t.resolve(e[1])})},this.loadPaymentReceipt=function(e,t){e.receiptTypeArr=[],e.receiptList={1:e.receiptTypeArr};var a=r.executeQueryURLReset(),i=new Array;return r.prepareParamListWithParam("pSubAccSeqId",t,i),r.executeQueryInput("PATIENT_BILLING_PAYMENT_RECEIPTS",i,e.receiptList,!0,!0,a,"popUp",{}).then(function(t){var a=Array.isArray(t[1])?t[1]:[t[1]];angular.forEach(a,function(e){e.BALANCE_AMT=e.DEPOSIT_AMT-e.ADJUSTED_AMT-e.REFUND_AMT}),e.gridOptionsReceiptDetails.data=a})},this.savePaymentDataList=function(e,t,a){i.defer();var r=[];return angular.forEach(t,function(t){var a;""!=t.chequeDDDate&&t.chequeDDDate&&(a=moment(t.chequeDDDate).format("YYYY-MM-DD")+"T"+moment(t.chequeDDDate).format("HH:mm:ss.SSS")+"Z");var i={"@class":"com.napier.core.collections.vo.ReceiptDetails",amount:null!=t.actualValue?t.actualValue:t.amtPaid,bankAccSeqId:e.depBankSeqId,gnTranStatus:1,payMode:t.PayModeCode,cardBank:t.bank,cardNo:t.cardNumber,cardTranNo:t.cardTranId,chequeDDNo:t.chequeDDno,chequeqDDDate:a,chequeType:t.chequeType,payMobileNo:t.mobileNumber,ecsTranType:t.paymentTranType,cardExpiryDate:t.cardExpiryDate,cardType:t.cardType};r.push(i)}),{"@class":"com.napier.core.collections.vo.ReceiptHeader",bank:e.depBankDesc,partialRequestSeqId:e.partialRequestSeqId,counterCode:"2",gnTranStatus:1,billSeqId:e.billSeqId,receiptDetailsList:[{"com.napier.core.collections.vo.ReceiptDetails":r}],depositVo:[{"com.napier.core.service.vo.deposits.DepositsVo":[]}],creditNoteAdjList:[{"com.napier.core.billgeneration.vo.CreditNoteAdjustVo":a}],receiptTranType:e.tranReqType,receivedFrom:e.rcvdFrmName,recpSingleOrMultiple:0,remarks:"",scrollAdmin:166,shiftCode:"3001",gnPayerType:e.gnPayerType?e.gnPayerType:void 0}}}e.$inject=["SCHEDULERAPIS","$timeout","CallManager","$q","QueryService","BILLING_APIS","IPINDENTAPIS","$filter","hisAlertService"],angular.module("napierContainerUi").service("patientBillDepositService",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s){this.deleteAdocData=function(t){var i={};return i.url=e.HISSERVICETYPES.URL,i.requestData={operation:"deleteAdocData",messageId:"",destination:"com.napier.core.corebillingconcession.service.external.CoreBillingConcessionService",message:{"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionRequest",concessionReqSeqId:t.seqId}},a.sendRestRequest(i)};var o=5*Math.pow(1024,2);this.getDocument=function(e){e.getDoc=[],e.multipleComboDataForList={1:e.getDoc};var t=r.executeQueryURLReset();return e.getDocList=new Array,r.prepareParamList(1,e.collectionSeqId,e.getDocList),r.executeQueryInput("GET_PREAUTH_UPLOAD_DOCS",e.getDocList,e.multipleComboDataForList,!0,!0,t,"popUp",o).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})},this.removeUploadedFile=function(e,t){!function(e,t){for(var a=0;a<t.filesUploaded.length;a++)if(t.filesUploaded[a].docName==e.docName||t.filesUploaded[a].docName==e){t.filesUploaded.splice(a,1),t.uploadedfileNames.splice(a,1);break}}(e,t)};var c=function(e,t){var a=[];if(1==e.applicability){var i=[];e&&e.statusOfSave&&"Approve"==e.statusOfSave?i=2:e&&e.statusOfSave&&"Reject"==e.statusOfSave?i=3:e&&e.statusOfSave&&"Apply"==e.statusOfSave&&(i=1);var r=void 0;if(e.pbc.discountValue&&0!=e.pbc.discountValue&&null==e.collectionSeqId)r=e.pbc.discountValue.split(" ")[0];else null!=e.pbc.discountText&&null!=e.pbc.discountText&&""!=e.pbc.discountText&&(r=e.pbc.discountText);if(1==i)var n={facilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID,requestedAmount:e.pbc.totalDiscountAmt&&null!=e.pbc.totalDiscountAmt&&""!=e.pbc.totalDiscountAmt?parseFloat(e.pbc.totalDiscountAmt):void 0,gnAmtType:null!=e.discountType.DT_CODE?e.discountType.DT_CODE:void 0,gnConcStatus:i,gnTranStatus:1,reqConAmt:r?parseFloat(r):void 0};else n={concessionReqDetailSeqId:e.pbc.dtlSeqIdhidden&&null!=e.pbc.dtlSeqIdhidden&&""!=e.pbc.dtlSeqIdhidden?e.pbc.dtlSeqIdhidden:void 0,gnConcStatus:i,approvedConc:e.approvalDiscountTextVal&&null!=e.approvalDiscountTextVal?e.approvalDiscountTextVal:void 0,approvedAmount:e.approvedTotalAmtTextVal&&null!=e.approvedTotalAmtTextVal?e.approvedTotalAmtTextVal:void 0,approveGnAmtType:e.approvalDiscountValueTextVal&&e.approvalDiscountValueTextVal.DT_CODE?e.approvalDiscountValueTextVal.DT_CODE:void 0};a.push(n)}else{var l=t instanceof Array?t:[t];angular.forEach(l,function(t,i){if(t.primayServiceGroup){var r=t.primayServiceGroup?t.primayServiceGroup.CODE:void 0,n=t.department?t.department.CODE:void 0,l=t.speciality?t.speciality.CODE:void 0,s=t.service?t.service.SERV_SEQ_ID:void 0,o=void 0;r&&n&&l&&s?o=4:r&&n&&l?o=3:r&&n?o=2:r&&(o=1);var c=[];if(null==t.select&&null==t.select?c=1:t.select?c=3:0==t.select&&(c=2),e&&e.statusOfSave&&"Approve"==e.statusOfSave||e&&e.statusOfSave&&"Reject"==e.statusOfSave)var d={concessionReqDetailSeqId:t.BL_CONC_DTL_SEQ_ID&&null!=t.BL_CONC_DTL_SEQ_ID?t.BL_CONC_DTL_SEQ_ID:void 0,gnConcStatus:c,approvedConc:t.approvalAmountValue&&null!=t.approvalAmountValue?parseFloat(t.approvalAmountValue):void 0,approvedAmount:t.appliedDiscount&&null!=t.appliedDiscount?parseFloat(t.appliedDiscount):void 0,approveGnAmtType:t.approvalAmountType&&null!=t.approvalAmountType&&t.approvalAmountType.DT_CODE&&null!=t.approvalAmountType.DT_CODE?parseFloat(t.approvalAmountType.DT_CODE):void 0,billServiceDetailsSeqId:t.BL_SERV_DTL_SEQ_ID?t.BL_SERV_DTL_SEQ_ID:void 0};else if(e&&e.statusOfSave&&"Apply"==e.statusOfSave)d={facilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID,servRate:t.amount?t.amount:void 0,gnConcStatus:c,gnTranStatus:1,reqConAmt:t.discountValue?t.discountValue:void 0,servSeqId:t.service?t.service.SERV_SEQ_ID:void 0,psgCode:t.primayServiceGroup?t.primayServiceGroup.CODE:void 0,deptCode:t.department?t.department.CODE:void 0,splCode:t.speciality?t.speciality.CODE:void 0,gnAmtType:t.discountType?t.discountType.DT_CODE:void 0,requestedAmount:t.appliedDiscount?t.appliedDiscount:void 0,serviceHierarchyLevel:o,billServiceDetailsSeqId:t.BL_SERV_DTL_SEQ_ID?t.BL_SERV_DTL_SEQ_ID:void 0};a.push(d)}})}return a};this.saveDiscountMasterData=function(t,i){var r=[];t.concStatusFlag&&t&&t.statusOfSave&&("Reject"==t.statusOfSave&&t||t.statusOfSave&&"Approve"==t.statusOfSave)?t&&t.statusOfSave&&"Reject"==t.statusOfSave?r=3:t&&t.statusOfSave&&"Approve"==t.statusOfSave&&(r=2):r=1;var n={},l=JSON.parse(sessionStorage.userContextObj).CURRENT_DATE,s=moment(l).format("YYYY-MM-DD")+"T"+moment(l).format("HH:mm:ss.SSS")+"Z";if(t&&t.statusOfSave&&"Apply"==t.statusOfSave)var o={"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionRequest",billSeqId:t.billSeqId,concessionReqSeqId:t.pbc.seqIdhidden&&null!=t.pbc.seqIdhidden&&""!=t.pbc.seqIdhidden?t.pbc.seqIdhidden:void 0,concessionReqDate:s,concessionReqNo:t.connectionNumber,concessionStatus:r,remarks:null!=t.pbc.remarks?t.pbc.remarks:void 0,reasonForConcession:null!=t.pbc.discountRemarks?t.pbc.discountRemarks:void 0,facilityId:JSON.parse(sessionStorage.userContextObj).FACILITY_ID,concCatg:null!=t.pbc.isPredefine?parseInt(t.pbc.isPredefine):void 0,isBillOrSerLevel:null!=t.pbc.applicability?parseInt(t.pbc.applicability):void 0,concAmount:t.pbc.totalDiscountAmt&&null!=t.pbc.totalDiscountAmt&&""!=t.pbc.totalDiscountAmt?parseFloat(t.pbc.totalDiscountAmt):t.pbc.totalAppliedDiscount&&null!=t.pbc.totalAppliedDiscount&&""!=t.pbc.totalAppliedDiscount?parseFloat(t.pbc.totalAppliedDiscount):void 0,billAmt:null!=t.pbc.billAmt?t.pbc.billAmt:void 0,gnTranStatus:1,subAccSeqId:t.subAccSeqId&&null!=t.subAccSeqId?t.subAccSeqId:void 0,concessionSeqId:t.discount&&null!=t.discount&&t.discount.CONC_SEQ_ID&&null!=t.discount.CONC_SEQ_ID?t.discount.CONC_SEQ_ID:void 0,requestComingFrom:t.statusOfSave,concessionRequestDetailsList:[{"com.napier.core.service.vo.corebillingconcession.ConcessionRequestDetails":c(t,i)}]};else o={"@class":"com.napier.core.service.vo.corebillingconcession.ConcessionRequest",billSeqId:void 0,concessionReqSeqId:t.pbc.seqIdhidden&&null!=t.pbc.seqIdhidden&&""!=t.pbc.seqIdhidden?t.pbc.seqIdhidden:void 0,concessionStatus:r,concessionReqNo:t.connectionNumber,approveRemarks:t.pbc&&t.pbc.approvalRemarks?t.pbc.approvalRemarks:"",concAmount:t.pbc.totalApprovalDiscount?parseFloat(t.pbc.totalApprovalDiscount):t.pbc.approvedTotalAmtTextVal?parseFloat(t.pbc.approvedTotalAmtTextVal):void 0,concessionRequestDetailsList:[{"com.napier.core.service.vo.corebillingconcession.ConcessionRequestDetails":c(t,i)}]};return n.url=e.HISSERVICETYPES.URL,n.requestData={operation:"saveAdhocPreDefineDetails",destination:"com.napier.core.corebillingconcession.service.external.CoreBillingConcessionService",message:o},a.sendRestRequest(n)}}e.$inject=["SCHEDULERAPIS","$timeout","CallManager","$q","QueryService","IPINDENTAPIS","$filter","hisAlertService"],angular.module("napierContainerUi").service("patientBillDiscountService",e)}(),function(){"use strict";function e(e,t,a,i,r){this.addDynamicClassForRightAlign=function(e,t,a,i){var r=function(e,t,a,i){return"ui-grid-header-custom-right"};e.columnDefs[5].headerCellClass=r,e.columnDefs[6].headerCellClass=r,e.columnDefs[7].headerCellClass=r,e.columnDefs[8].headerCellClass=r,e.columnDefs[9].headerCellClass=r,e.columnDefs[10].headerCellClass=r,t.columnDefs[5].headerCellClass=r,t.columnDefs[6].headerCellClass=r,t.columnDefs[7].headerCellClass=r,t.columnDefs[8].headerCellClass=r,t.columnDefs[9].headerCellClass=r,t.columnDefs[10].headerCellClass=r,a.columnDefs[5].headerCellClass=r,a.columnDefs[6].headerCellClass=r,a.columnDefs[7].headerCellClass=r,a.columnDefs[8].headerCellClass=r,a.columnDefs[9].headerCellClass=r,a.columnDefs[10].headerCellClass=r,i.columnDefs[5].headerCellClass=r,i.columnDefs[6].headerCellClass=r,i.columnDefs[7].headerCellClass=r,i.columnDefs[8].headerCellClass=r,i.columnDefs[9].headerCellClass=r,i.columnDefs[10].headerCellClass=r},this.getBillDetailsData=function(e,t,a,i,n,l,s,o){null!=t&&t.length>0&&null!=t[0]&&(s.billDetailList=_.concat(s.billDetailList,t)),this.addDynamicClassForRightAlign(a,i,n,l),null!=s.billOrPackage.SP_SEQ_ID?(s.billDetailGrid.columnDefs[2].visible=!1,s.billDetailGrid.columnDefs[3].visible=!1,s.billDetailGrid.columnDefs[4].visible=!1,s.billDetailGrid.columnDefs[5].visible=!0,s.billDetailGrid.columnDefs[6].visible=!0,a.columnDefs[6].visible=!1,a.columnDefs[7].visible=!1,a.columnDefs[8].visible=!1,a.columnDefs[9].visible=!0,a.columnDefs[10].visible=!0,i.columnDefs[6].visible=!1,i.columnDefs[7].visible=!1,i.columnDefs[8].visible=!1,i.columnDefs[9].visible=!0,i.columnDefs[10].visible=!0,n.columnDefs[6].visible=!1,n.columnDefs[7].visible=!1,n.columnDefs[8].visible=!1,n.columnDefs[9].visible=!0,n.columnDefs[10].visible=!0,l.columnDefs[6].visible=!1,l.columnDefs[7].visible=!1,l.columnDefs[8].visible=!1,l.columnDefs[9].visible=!0,l.columnDefs[10].visible=!0):null!=s.billOrPackage.GN_PAYER_TYPE&&2==s.billOrPackage.GN_PAYER_TYPE?(s.billDetailGrid.columnDefs[2].visible=!0,s.billDetailGrid.columnDefs[3].visible=!0,s.billDetailGrid.columnDefs[4].visible=!1,s.billDetailGrid.columnDefs[5].visible=!1,s.billDetailGrid.columnDefs[6].visible=!1,a.columnDefs[6].visible=!0,a.columnDefs[7].visible=!0,a.columnDefs[8].visible=!1,a.columnDefs[9].visible=!1,a.columnDefs[10].visible=!1,i.columnDefs[6].visible=!0,i.columnDefs[7].visible=!0,i.columnDefs[8].visible=!1,i.columnDefs[9].visible=!1,i.columnDefs[10].visible=!1,n.columnDefs[6].visible=!0,n.columnDefs[7].visible=!0,n.columnDefs[8].visible=!1,n.columnDefs[9].visible=!1,n.columnDefs[10].visible=!1,l.columnDefs[6].visible=!0,l.columnDefs[7].visible=!0,l.columnDefs[8].visible=!1,l.columnDefs[9].visible=!1,l.columnDefs[10].visible=!1):null!=s.billOrPackage.GN_PAYER_TYPE&&4==s.billOrPackage.GN_PAYER_TYPE?(s.billDetailGrid.columnDefs[2].visible=!1,s.billDetailGrid.columnDefs[3].visible=!1,s.billDetailGrid.columnDefs[4].visible=!0,s.billDetailGrid.columnDefs[5].visible=!1,s.billDetailGrid.columnDefs[6].visible=!1,a.columnDefs[6].visible=!1,a.columnDefs[7].visible=!1,a.columnDefs[8].visible=!0,a.columnDefs[9].visible=!1,a.columnDefs[10].visible=!1,i.columnDefs[6].visible=!1,i.columnDefs[7].visible=!1,i.columnDefs[8].visible=!0,i.columnDefs[9].visible=!1,i.columnDefs[10].visible=!1,n.columnDefs[6].visible=!1,n.columnDefs[7].visible=!1,n.columnDefs[8].visible=!0,n.columnDefs[9].visible=!1,n.columnDefs[10].visible=!1,l.columnDefs[6].visible=!1,l.columnDefs[7].visible=!1,l.columnDefs[8].visible=!0,l.columnDefs[9].visible=!1,l.columnDefs[10].visible=!1):(s.billDetailGrid.columnDefs[2].visible=!0,s.billDetailGrid.columnDefs[3].visible=!0,s.billDetailGrid.columnDefs[4].visible=!0,s.billDetailGrid.columnDefs[5].visible=!1,s.billDetailGrid.columnDefs[6].visible=!1,a.columnDefs[6].visible=!0,a.columnDefs[7].visible=!0,a.columnDefs[8].visible=!0,a.columnDefs[9].visible=!1,a.columnDefs[10].visible=!1,i.columnDefs[6].visible=!0,i.columnDefs[7].visible=!0,i.columnDefs[8].visible=!0,i.columnDefs[9].visible=!1,i.columnDefs[10].visible=!1,n.columnDefs[6].visible=!0,n.columnDefs[7].visible=!0,n.columnDefs[8].visible=!0,n.columnDefs[9].visible=!1,n.columnDefs[10].visible=!1,l.columnDefs[6].visible=!0,l.columnDefs[7].visible=!0,l.columnDefs[8].visible=!0,l.columnDefs[9].visible=!1,l.columnDefs[10].visible=!1),s.getSelectedRowSubGrid=[];let c=[];if(null!=s.billDetailList[0]&&null!=s.billDetailList[0].serviceVo){let e=["serviceVo.primaryServiceCode","serviceVo.deptCode","serviceVo.specilityCode"];s.billDetailList=r("orderBy")(s.billDetailList,e)}for(let e=0;e<s.billDetailList.length;e++)if(s.billDetailList[e].Billing_Bed_Class_Desc=s.patientDataBedPlan[0].BILLING_BED_CLASS,s.billDetailList[e].Billing_Bed_Class_Code=s.patientDataBedPlan[0].BILLING_BC_SEQ_ID,(null==s.billDetailList[e].packApplyType&&null!=s.billOrPackage.GN_BILL_STATUS||null==s.billOrPackage.SP_SEQ_ID&&2!=s.billDetailList[e].packApplyType||null!=s.billOrPackage.SP_SEQ_ID&&4!=s.billDetailList[e].packApplyType)&&(null!=s.billDetailList[e].serviceVo&&null!=s.billDetailList[e].serviceVo.primaryServiceCode&&10031!=s.billDetailList[e].serviceVo.primaryServiceCode||null==s.billDetailList[e].serviceVo&&null!=s.billDetailList[e].PRIMARY_CODE&&10031!=s.billDetailList[e].PRIMARY_CODE))if(null==s.billDetailList[e].serviceVo&&(s.billDetailList[e].serviceVo={},s.billDetailList[e].serviceVo.primaryServiceCode=s.billDetailList[e].PRIMARY_CODE,s.billDetailList[e].serviceVo.primaryServiceDesc=s.billDetailList[e].PRIMARY_GROUP,s.billDetailList[e].serviceVo.deptCode=s.billDetailList[e].DEPT_CODE,s.billDetailList[e].serviceVo.deptDesc=s.billDetailList[e].DEPT_NAME,s.billDetailList[e].serviceVo.specilityCode=s.billDetailList[e].SPEC_CODE,s.billDetailList[e].serviceVo.specialityDesc=s.billDetailList[e].SPEC_NAME,s.billDetailList[e].serviceVo.servSeqId=s.billDetailList[e].SERV_SEQ_ID,s.billDetailList[e].serviceVo.servName=s.billDetailList[e].SERV_NAME,s.billDetailList[e].quantity=s.billDetailList[e].SERV_QTY,s.billDetailList[e].serviceRate=s.billDetailList[e].SERVICE_RATE,s.billDetailList[e].chargeableAmt=s.billDetailList[e].CHARGEABLE_AMT,s.billDetailList[e].payerAmount=s.billDetailList[e].PAYER_AMT,s.billDetailList[e].patientAmount=s.billDetailList[e].PATIENT_AMT,s.billDetailList[e].selfAmount=s.billDetailList[e].SELF_AMT,s.billDetailList[e].nonChargableAmt=s.billDetailList[e].NON_CHARGABLE_AMT),s.billDetailList[e].exceededAmt=angular.copy(s.billDetailList[e].chargeableAmt),null!=s.billOrPackage.SP_SEQ_ID&&(s.billDetailList[e].chargeableAmt=parseFloat(angular.copy(s.billDetailList[e].serviceRate*s.billDetailList[e].quantity))),0==c.length){c[0]={},c[0]=angular.copy(s.billDetailList[e]),c[0].$$treeLevel=0,c[0].detailCode=angular.copy(s.billDetailList[e].serviceVo.primaryServiceCode),c[0].details=angular.copy(s.billDetailList[e].serviceVo.primaryServiceDesc),c[0].serviceRate=0,c[0].payerAmount=0,c[0].patientAmount=0,c[0].selfAmount=0,c[0].chargeableAmt=0,c[0].nonChargableAmt=0,c[0].exceededAmt=0,c[1]={},c[1]=angular.copy(s.billDetailList[e]),c[1].$$treeLevel=1,c[1].detailCode=angular.copy(s.billDetailList[e].serviceVo.deptCode),c[1].details=angular.copy(s.billDetailList[e].serviceVo.deptDesc),c[1].serviceRate=0,c[1].payerAmount=0,c[1].patientAmount=0,c[1].selfAmount=0,c[1].chargeableAmt=0,c[1].nonChargableAmt=0,c[1].exceededAmt=0,c[2]={},c[2]=angular.copy(s.billDetailList[e]),c[2].$$treeLevel=2,c[2].detailCode=angular.copy(s.billDetailList[e].serviceVo.specilityCode),c[2].details=angular.copy(s.billDetailList[e].serviceVo.specialityDesc),c[2].serviceRate=0,c[2].payerAmount=0,c[2].patientAmount=0,c[2].selfAmount=0,c[2].chargeableAmt=0,c[2].nonChargableAmt=0,c[2].exceededAmt=0,c[2].subGridList=[],c[2].subGridList.push(10006==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(i):10018==s.billDetailList[e].serviceVo.primaryServiceCode||10023==s.billDetailList[e].serviceVo.primaryServiceCode||10024==s.billDetailList[e].serviceVo.primaryServiceCode||10004==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(n):10012==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(l):(s.billDetailList[e].serviceVo.primaryServiceCode,angular.copy(a))),c[2].subGridList[0].data=[],c[2].subGridList[0].data.push(s.billDetailList[e]);for(let t=2;t>=0;t--){if(0==c[t].$$treeLevel){c[t].serviceRate=c[t].serviceRate+s.billDetailList[e].serviceRate,c[t].payerAmount=c[t].payerAmount+s.billDetailList[e].payerAmount,c[t].patientAmount=c[t].patientAmount+s.billDetailList[e].patientAmount,c[t].selfAmount=c[t].selfAmount+s.billDetailList[e].selfAmount,c[t].chargeableAmt=c[t].chargeableAmt+s.billDetailList[e].chargeableAmt,c[t].nonChargableAmt=c[t].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[t].exceededAmt=c[t].exceededAmt+s.billDetailList[e].exceededAmt;break}1==c[t].$$treeLevel?(c[t].serviceRate=c[t].serviceRate+s.billDetailList[e].serviceRate,c[t].payerAmount=c[t].payerAmount+s.billDetailList[e].payerAmount,c[t].patientAmount=c[t].patientAmount+s.billDetailList[e].patientAmount,c[t].selfAmount=c[t].selfAmount+s.billDetailList[e].selfAmount,c[t].chargeableAmt=c[t].chargeableAmt+s.billDetailList[e].chargeableAmt,c[t].nonChargableAmt=c[t].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[t].exceededAmt=c[t].exceededAmt+s.billDetailList[e].exceededAmt):2==c[t].$$treeLevel&&(c[t].serviceRate=c[t].serviceRate+s.billDetailList[e].serviceRate,c[t].payerAmount=c[t].payerAmount+s.billDetailList[e].payerAmount,c[t].patientAmount=c[t].patientAmount+s.billDetailList[e].patientAmount,c[t].selfAmount=c[t].selfAmount+s.billDetailList[e].selfAmount,c[t].chargeableAmt=c[t].chargeableAmt+s.billDetailList[e].chargeableAmt,c[t].nonChargableAmt=c[t].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[t].exceededAmt=c[t].exceededAmt+s.billDetailList[e].exceededAmt)}c[2].subGridList[0].onRegisterApi=function(e){c[2].subGridList[0].gridApi=e,c[2].subGridList[0].gridApi.selection.on.rowSelectionChanged(o,function(e){if(e.isSelected)if(s.getSelectedRowSubGrid.length>0)for(let t=0;t<s.getSelectedRowSubGrid.length;t++){if(s.getSelectedRowSubGrid[t].serviceVo.servSeqId==e.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[t].quantity=s.getSelectedRowSubGrid[t].quantity+e.entity.quantity,s.getSelectedRowSubGrid[t].serviceRate=s.getSelectedRowSubGrid[t].serviceRate+e.entity.serviceRate,s.getSelectedRowSubGrid[t].chargeableAmt=s.getSelectedRowSubGrid[t].chargeableAmt+e.entity.chargeableAmt;break}if(t==s.getSelectedRowSubGrid.length-1){let t=angular.copy(e.entity);s.getSelectedRowSubGrid.push(t);break}}else{let t=angular.copy(e.entity);s.getSelectedRowSubGrid.push(t)}else if(s.getSelectedRowSubGrid.length>0)for(let t=0;t<s.getSelectedRowSubGrid.length;t++)if(s.getSelectedRowSubGrid[t].serviceVo.servSeqId==e.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[t].quantity=s.getSelectedRowSubGrid[t].quantity-e.entity.quantity,s.getSelectedRowSubGrid[t].serviceRate=s.getSelectedRowSubGrid[t].serviceRate-e.entity.serviceRate,s.getSelectedRowSubGrid[t].chargeableAmt=s.getSelectedRowSubGrid[t].chargeableAmt-e.entity.chargeableAmt,0==s.getSelectedRowSubGrid[t].quantity&&s.getSelectedRowSubGrid.splice(0,1);break}}),c[2].subGridList[0].gridApi.selection.on.rowSelectionChangedBatch(o,function(e){for(var t=0;t<e.length;t++){var a=e[t];if(a.isSelected)if(s.getSelectedRowSubGrid.length>0)for(let e=0;e<s.getSelectedRowSubGrid.length;e++){if(s.getSelectedRowSubGrid[e].serviceVo.servSeqId==a.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[e].quantity=s.getSelectedRowSubGrid[e].quantity+a.entity.quantity,s.getSelectedRowSubGrid[e].serviceRate=s.getSelectedRowSubGrid[e].serviceRate+a.entity.serviceRate,s.getSelectedRowSubGrid[e].chargeableAmt=s.getSelectedRowSubGrid[e].chargeableAmt+a.entity.chargeableAmt;break}if(e==s.getSelectedRowSubGrid.length-1){let e=angular.copy(a.entity);s.getSelectedRowSubGrid.push(e);break}}else{let e=angular.copy(a.entity);s.getSelectedRowSubGrid.push(e)}else if(s.getSelectedRowSubGrid.length>0)for(let e=0;e<s.getSelectedRowSubGrid.length;e++)if(s.getSelectedRowSubGrid[e].serviceVo.servSeqId==a.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[e].quantity=s.getSelectedRowSubGrid[e].quantity-a.entity.quantity,s.getSelectedRowSubGrid[e].serviceRate=s.getSelectedRowSubGrid[e].serviceRate-a.entity.serviceRate,s.getSelectedRowSubGrid[e].chargeableAmt=s.getSelectedRowSubGrid[e].chargeableAmt-a.entity.chargeableAmt,0==s.getSelectedRowSubGrid[e].quantity&&s.getSelectedRowSubGrid.splice(0,1);break}}})}}else{let t=!1,r=!1,d=!1,p=!1;for(let u=0;u<c.length;u++){null!=c[u].serviceVo&&c[u].serviceVo.primaryServiceCode==s.billDetailList[e].serviceVo.primaryServiceCode&&(t=!0,null!=c[u].serviceVo&&c[u].serviceVo.deptCode==s.billDetailList[e].serviceVo.deptCode&&(r=!0,null!=c[u].serviceVo&&c[u].serviceVo.specilityCode==s.billDetailList[e].serviceVo.specilityCode&&(d=!0)));let m=angular.copy(c.length),g=!1,S=!1;if(!t&&m-1==u){let t=c.length;c[t]={},c[t]=angular.copy(s.billDetailList[e]),c[t].$$treeLevel=0,c[t].detailCode=angular.copy(s.billDetailList[e].serviceVo.primaryServiceCode),c[t].details=angular.copy(s.billDetailList[e].serviceVo.primaryServiceDesc),c[t].serviceRate=0,c[t].payerAmount=0,c[t].patientAmount=0,c[t].selfAmount=0,c[t].chargeableAmt=0,c[t].nonChargableAmt=0,c[t].exceededAmt=0,p=!0,g=!0}if(!r&&t&&0==c[u].$$treeLevel||g){let a=!1;if(!r&&t)for(let t=u;t<c.length;t++)if(c[t].detailCode==s.billDetailList[e].serviceVo.deptCode&&null!=c[t].serviceVo&&c[t].serviceVo.primaryServiceCode==s.billDetailList[e].serviceVo.primaryServiceCode){a=!0;break}if(a){if(!r||!d)continue}else{let t=g&&null!=c[c.length-1]?c.length:u;g&&null!=c[c.length-1]?(c[t]={},S=!0):(S=!0,r=!0,t+=1,c.splice(t,0,{})),c[t]=angular.copy(s.billDetailList[e]),c[t].$$treeLevel=1,c[t].detailCode=angular.copy(s.billDetailList[e].serviceVo.deptCode),c[t].details=angular.copy(s.billDetailList[e].serviceVo.deptDesc),c[t].serviceRate=0,c[t].payerAmount=0,c[t].patientAmount=0,c[t].selfAmount=0,c[t].chargeableAmt=0,c[t].nonChargableAmt=0,c[t].exceededAmt=0}p=!0}if(!d&&t&&r&&1==c[u].$$treeLevel||S){if(!!1){let t=S&&!r&&null!=c[c.length-1]?s.billDetailList[e].serviceVo.specialityDesc?c.length:c.length-1:S&&r?u+1:u;if(S&&!r&&null!=c[c.length-1]?c[t]=s.billDetailList[e].serviceVo.specialityDesc?{}:c[t]:(t+=1,c.splice(t,0,{})),null!=s.billDetailList[e].serviceVo.specialityDesc&&(c[t]=angular.copy(s.billDetailList[e]),c[t].$$treeLevel=2,c[t].detailCode=angular.copy(s.billDetailList[e].serviceVo.specilityCode),c[t].details=angular.copy(s.billDetailList[e].serviceVo.specialityDesc),c[t].serviceRate=0,c[t].payerAmount=0,c[t].patientAmount=0,c[t].selfAmount=0,c[t].chargeableAmt=0,c[t].nonChargableAmt=0,c[t].exceededAmt=0),p=!0,null!=c[t].subGridList){let r=!1;for(let a=0;a<c[t].subGridList.length;a++)if(null!=c[t].subGridList[a].data)for(let i=0;i<c[t].subGridList[a].data.length;i++){let n=c[t].subGridList[a].data[i];if(n.serviceVo.primaryServiceCode==s.billDetailList[e].serviceVo.primaryServiceCode&&n.serviceVo.deptCode==s.billDetailList[e].serviceVo.deptCode&&n.serviceVo.specilityCode==s.billDetailList[e].serviceVo.specilityCode){c[t].subGridList[a].data.push(s.billDetailList[e]),r=!0,c[t].serviceRate=c[t].serviceRate+s.billDetailList[e].serviceRate,c[t].payerAmount=c[t].payerAmount+s.billDetailList[e].payerAmount,c[t].patientAmount=c[t].patientAmount+s.billDetailList[e].patientAmount,c[t].selfAmount=c[t].selfAmount+s.billDetailList[e].selfAmount,c[t].chargeableAmt=c[t].chargeableAmt+s.billDetailList[e].chargeableAmt,c[t].nonChargableAmt=c[t].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[t].exceededAmt=c[t].exceededAmt+s.billDetailList[e].exceededAmt;for(let a=t;a>=0;a--){if(0==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.primaryServiceCode){c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt;break}1==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.deptCode&&(c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt)}break}}if(!r){c[t].subGridList.push(10006==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(i):10018==s.billDetailList[e].serviceVo.primaryServiceCode||10023==s.billDetailList[e].serviceVo.primaryServiceCode||10024==s.billDetailList[e].serviceVo.primaryServiceCode||10004==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(n):10012==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(l):angular.copy(a)),c[t].subGridList[c[t].subGridList.length-1].data=[],c[t].subGridList[c[t].subGridList.length-1].data.push(s.billDetailList[e]);for(let a=t;a>=0;a--){if(0==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.primaryServiceCode){c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt;break}1==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.deptCode?(c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt):2==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.specilityCode&&(c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt)}c[t].subGridList[c[t].subGridList.length-1].onRegisterApi=function(e){c[t].subGridList[c[t].subGridList.length-1].gridApi=e,c[t].subGridList[c[t].subGridList.length-1].gridApi.selection.on.rowSelectionChanged(o,function(e){if(e.isSelected)if(s.getSelectedRowSubGrid.length>0)for(let t=0;t<s.getSelectedRowSubGrid.length;t++){if(s.getSelectedRowSubGrid[t].serviceVo.servSeqId==e.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[t].quantity=s.getSelectedRowSubGrid[t].quantity+e.entity.quantity,s.getSelectedRowSubGrid[t].serviceRate=s.getSelectedRowSubGrid[t].serviceRate+e.entity.serviceRate,s.getSelectedRowSubGrid[t].chargeableAmt=s.getSelectedRowSubGrid[t].chargeableAmt+e.entity.chargeableAmt;break}if(t==s.getSelectedRowSubGrid.length-1){let t=angular.copy(e.entity);s.getSelectedRowSubGrid.push(t);break}}else{let t=angular.copy(e.entity);s.getSelectedRowSubGrid.push(t)}else if(s.getSelectedRowSubGrid.length>0)for(let t=0;t<s.getSelectedRowSubGrid.length;t++)if(s.getSelectedRowSubGrid[t].serviceVo.servSeqId==e.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[t].quantity=s.getSelectedRowSubGrid[t].quantity-e.entity.quantity,s.getSelectedRowSubGrid[t].serviceRate=s.getSelectedRowSubGrid[t].serviceRate-e.entity.serviceRate,s.getSelectedRowSubGrid[t].chargeableAmt=s.getSelectedRowSubGrid[t].chargeableAmt-e.entity.chargeableAmt,0==s.getSelectedRowSubGrid[t].quantity&&s.getSelectedRowSubGrid.splice(0,1);break}}),c[t].subGridList[c[t].subGridList.length-1].gridApi.selection.on.rowSelectionChangedBatch(o,function(e){for(var t=0;t<e.length;t++){var a=e[t];if(a.isSelected)if(s.getSelectedRowSubGrid.length>0)for(let e=0;e<s.getSelectedRowSubGrid.length;e++){if(s.getSelectedRowSubGrid[e].serviceVo.servSeqId==a.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[e].quantity=s.getSelectedRowSubGrid[e].quantity+a.entity.quantity,s.getSelectedRowSubGrid[e].serviceRate=s.getSelectedRowSubGrid[e].serviceRate+a.entity.serviceRate,s.getSelectedRowSubGrid[e].chargeableAmt=s.getSelectedRowSubGrid[e].chargeableAmt+a.entity.chargeableAmt;break}if(e==s.getSelectedRowSubGrid.length-1){let e=angular.copy(a.entity);s.getSelectedRowSubGrid.push(e);break}}else{let e=angular.copy(a.entity);s.getSelectedRowSubGrid.push(e)}else if(s.getSelectedRowSubGrid.length>0)for(let e=0;e<s.getSelectedRowSubGrid.length;e++)if(s.getSelectedRowSubGrid[e].serviceVo.servSeqId==a.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[e].quantity=s.getSelectedRowSubGrid[e].quantity-a.entity.quantity,s.getSelectedRowSubGrid[e].serviceRate=s.getSelectedRowSubGrid[e].serviceRate-a.entity.serviceRate,s.getSelectedRowSubGrid[e].chargeableAmt=s.getSelectedRowSubGrid[e].chargeableAmt-a.entity.chargeableAmt,0==s.getSelectedRowSubGrid[e].quantity&&s.getSelectedRowSubGrid.splice(0,1);break}}})}}}else{c[t].subGridList=[],c[t].subGridList.push(10006==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(i):10018==s.billDetailList[e].serviceVo.primaryServiceCode||10023==s.billDetailList[e].serviceVo.primaryServiceCode||10024==s.billDetailList[e].serviceVo.primaryServiceCode||10004==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(n):10012==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(l):angular.copy(a)),c[t].subGridList[0].data=[],c[t].subGridList[0].data.push(s.billDetailList[e]);for(let a=t;a>=0;a--){if(0==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.primaryServiceCode){c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt;break}1==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.deptCode?(c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt):2==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.specilityCode&&(c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt)}c[t].subGridList[0].onRegisterApi=function(e){c[t].subGridList[0].gridApi=e,c[t].subGridList[0].gridApi.selection.on.rowSelectionChanged(o,function(e){if(e.isSelected)if(s.getSelectedRowSubGrid.length>0)for(let t=0;t<s.getSelectedRowSubGrid.length;t++){if(s.getSelectedRowSubGrid[t].serviceVo.servSeqId==e.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[t].quantity=s.getSelectedRowSubGrid[t].quantity+e.entity.quantity,s.getSelectedRowSubGrid[t].serviceRate=s.getSelectedRowSubGrid[t].serviceRate+e.entity.serviceRate,s.getSelectedRowSubGrid[t].chargeableAmt=s.getSelectedRowSubGrid[t].chargeableAmt+e.entity.chargeableAmt;break}if(t==s.getSelectedRowSubGrid.length-1){let t=angular.copy(e.entity);s.getSelectedRowSubGrid.push(t);break}}else{let t=angular.copy(e.entity);s.getSelectedRowSubGrid.push(t)}else if(s.getSelectedRowSubGrid.length>0)for(let t=0;t<s.getSelectedRowSubGrid.length;t++)if(s.getSelectedRowSubGrid[t].serviceVo.servSeqId==e.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[t].quantity=s.getSelectedRowSubGrid[t].quantity-e.entity.quantity,s.getSelectedRowSubGrid[t].serviceRate=s.getSelectedRowSubGrid[t].serviceRate-e.entity.serviceRate,s.getSelectedRowSubGrid[t].chargeableAmt=s.getSelectedRowSubGrid[t].chargeableAmt-e.entity.chargeableAmt,0==s.getSelectedRowSubGrid[t].quantity&&s.getSelectedRowSubGrid.splice(0,1);break}}),c[t].subGridList[0].gridApi.selection.on.rowSelectionChangedBatch(o,function(e){for(var t=0;t<e.length;t++){var a=e[t];if(a.isSelected)if(s.getSelectedRowSubGrid.length>0)for(let e=0;e<s.getSelectedRowSubGrid.length;e++){if(s.getSelectedRowSubGrid[e].serviceVo.servSeqId==a.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[e].quantity=s.getSelectedRowSubGrid[e].quantity+a.entity.quantity,s.getSelectedRowSubGrid[e].serviceRate=s.getSelectedRowSubGrid[e].serviceRate+a.entity.serviceRate,s.getSelectedRowSubGrid[e].chargeableAmt=s.getSelectedRowSubGrid[e].chargeableAmt+a.entity.chargeableAmt;break}if(e==s.getSelectedRowSubGrid.length-1){let e=angular.copy(a.entity);s.getSelectedRowSubGrid.push(e);break}}else{let e=angular.copy(a.entity);s.getSelectedRowSubGrid.push(e)}else if(s.getSelectedRowSubGrid.length>0)for(let e=0;e<s.getSelectedRowSubGrid.length;e++)if(s.getSelectedRowSubGrid[e].serviceVo.servSeqId==a.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[e].quantity=s.getSelectedRowSubGrid[e].quantity-a.entity.quantity,s.getSelectedRowSubGrid[e].serviceRate=s.getSelectedRowSubGrid[e].serviceRate-a.entity.serviceRate,s.getSelectedRowSubGrid[e].chargeableAmt=s.getSelectedRowSubGrid[e].chargeableAmt-a.entity.chargeableAmt,0==s.getSelectedRowSubGrid[e].quantity&&s.getSelectedRowSubGrid.splice(0,1);break}}})}}}}if(d&&2==c[u].$$treeLevel){let t=u;if(null!=c[t].subGridList){let r=!1;for(let a=0;a<c[t].subGridList.length;a++)if(null!=c[t].subGridList[a].data)for(let i=0;i<c[t].subGridList[a].data.length;i++){let n=c[t].subGridList[a].data[i];if(n.serviceVo.primaryServiceCode==s.billDetailList[e].serviceVo.primaryServiceCode&&n.serviceVo.deptCode==s.billDetailList[e].serviceVo.deptCode&&n.serviceVo.specilityCode==s.billDetailList[e].serviceVo.specilityCode){c[t].subGridList[a].data.push(s.billDetailList[e]),r=!0,c[t].serviceRate=c[t].serviceRate+s.billDetailList[e].serviceRate,c[t].payerAmount=c[t].payerAmount+s.billDetailList[e].payerAmount,c[t].patientAmount=c[t].patientAmount+s.billDetailList[e].patientAmount,c[t].selfAmount=c[t].selfAmount+s.billDetailList[e].selfAmount,c[t].chargeableAmt=c[t].chargeableAmt+s.billDetailList[e].chargeableAmt,c[t].nonChargableAmt=c[t].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[t].exceededAmt=c[t].exceededAmt+s.billDetailList[e].exceededAmt;for(let a=t;a>=0;a--){if(0==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.primaryServiceCode){c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt;break}1==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.deptCode&&(c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt)}break}}if(!r){c[t].subGridList.push(10006==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(i):10018==s.billDetailList[e].serviceVo.primaryServiceCode||10023==s.billDetailList[e].serviceVo.primaryServiceCode||10024==s.billDetailList[e].serviceVo.primaryServiceCode||10004==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(n):10012==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(l):angular.copy(a)),c[t].subGridList[c[t].subGridList.length-1].data=[],c[t].subGridList[c[t].subGridList.length-1].data.push(s.billDetailList[e]);for(let a=t;a>=0;a--){if(0==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.primaryServiceCode){c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt;break}1==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.deptCode?(c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt):2==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.specilityCode&&(c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt)}c[t].subGridList[c[t].subGridList.length-1].onRegisterApi=function(e){c[t].subGridList[c[t].subGridList.length-1].gridApi=e,c[t].subGridList[c[t].subGridList.length-1].gridApi.selection.on.rowSelectionChanged(o,function(e){if(e.isSelected)if(s.getSelectedRowSubGrid.length>0)for(let t=0;t<s.getSelectedRowSubGrid.length;t++){if(s.getSelectedRowSubGrid[t].serviceVo.servSeqId==e.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[t].quantity=s.getSelectedRowSubGrid[t].quantity+e.entity.quantity,s.getSelectedRowSubGrid[t].serviceRate=s.getSelectedRowSubGrid[t].serviceRate+e.entity.serviceRate,s.getSelectedRowSubGrid[t].chargeableAmt=s.getSelectedRowSubGrid[t].chargeableAmt+e.entity.chargeableAmt;break}if(t==s.getSelectedRowSubGrid.length-1){let t=angular.copy(e.entity);s.getSelectedRowSubGrid.push(t);break}}else{let t=angular.copy(e.entity);s.getSelectedRowSubGrid.push(t)}else if(s.getSelectedRowSubGrid.length>0)for(let t=0;t<s.getSelectedRowSubGrid.length;t++)if(s.getSelectedRowSubGrid[t].serviceVo.servSeqId==e.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[t].quantity=s.getSelectedRowSubGrid[t].quantity-e.entity.quantity,s.getSelectedRowSubGrid[t].serviceRate=s.getSelectedRowSubGrid[t].serviceRate-e.entity.serviceRate,s.getSelectedRowSubGrid[t].chargeableAmt=s.getSelectedRowSubGrid[t].chargeableAmt-e.entity.chargeableAmt,0==s.getSelectedRowSubGrid[t].quantity&&s.getSelectedRowSubGrid.splice(0,1);break}}),c[t].subGridList[c[t].subGridList.length-1].gridApi.selection.on.rowSelectionChangedBatch(o,function(e){for(var t=0;t<e.length;t++){var a=e[t];if(a.isSelected)if(s.getSelectedRowSubGrid.length>0)for(let e=0;e<s.getSelectedRowSubGrid.length;e++){if(s.getSelectedRowSubGrid[e].serviceVo.servSeqId==a.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[e].quantity=s.getSelectedRowSubGrid[e].quantity+a.entity.quantity,s.getSelectedRowSubGrid[e].serviceRate=s.getSelectedRowSubGrid[e].serviceRate+a.entity.serviceRate,s.getSelectedRowSubGrid[e].chargeableAmt=s.getSelectedRowSubGrid[e].chargeableAmt+a.entity.chargeableAmt;break}if(e==s.getSelectedRowSubGrid.length-1){let e=angular.copy(a.entity);s.getSelectedRowSubGrid.push(e);break}}else{let e=angular.copy(a.entity);s.getSelectedRowSubGrid.push(e)}else if(s.getSelectedRowSubGrid.length>0)for(let e=0;e<s.getSelectedRowSubGrid.length;e++)if(s.getSelectedRowSubGrid[e].serviceVo.servSeqId==a.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[e].quantity=s.getSelectedRowSubGrid[e].quantity-a.entity.quantity,s.getSelectedRowSubGrid[e].serviceRate=s.getSelectedRowSubGrid[e].serviceRate-a.entity.serviceRate,s.getSelectedRowSubGrid[e].chargeableAmt=s.getSelectedRowSubGrid[e].chargeableAmt-a.entity.chargeableAmt,0==s.getSelectedRowSubGrid[e].quantity&&s.getSelectedRowSubGrid.splice(0,1);break}}})}}}else{c[t].subGridList=[],c[t].subGridList.push(10006==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(i):10018==s.billDetailList[e].serviceVo.primaryServiceCode||10023==s.billDetailList[e].serviceVo.primaryServiceCode||10024==s.billDetailList[e].serviceVo.primaryServiceCode||10004==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(n):10012==s.billDetailList[e].serviceVo.primaryServiceCode?angular.copy(l):angular.copy(a)),c[t].subGridList[0].data=[],c[t].subGridList[0].data.push(s.billDetailList[e]);for(let a=t;a>=0;a--){if(0==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.primaryServiceCode){c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt;break}1==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.deptCode?(c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt):2==c[a].$$treeLevel&&c[a].detailCode==s.billDetailList[e].serviceVo.specilityCode&&(c[a].serviceRate=c[a].serviceRate+s.billDetailList[e].serviceRate,c[a].payerAmount=c[a].payerAmount+s.billDetailList[e].payerAmount,c[a].patientAmount=c[a].patientAmount+s.billDetailList[e].patientAmount,c[a].selfAmount=c[a].selfAmount+s.billDetailList[e].selfAmount,c[a].chargeableAmt=c[a].chargeableAmt+s.billDetailList[e].chargeableAmt,c[a].nonChargableAmt=c[a].nonChargableAmt+s.billDetailList[e].nonChargableAmt,c[a].exceededAmt=c[a].exceededAmt+s.billDetailList[e].exceededAmt)}c[t].subGridList[0].onRegisterApi=function(e){c[t].subGridList[0].gridApi=e,c[t].subGridList[0].gridApi.selection.on.rowSelectionChanged(o,function(e){if(e.isSelected)if(s.getSelectedRowSubGrid.length>0)for(let t=0;t<s.getSelectedRowSubGrid.length;t++){if(s.getSelectedRowSubGrid[t].serviceVo.servSeqId==e.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[t].quantity=s.getSelectedRowSubGrid[t].quantity+e.entity.quantity,s.getSelectedRowSubGrid[t].serviceRate=s.getSelectedRowSubGrid[t].serviceRate+e.entity.serviceRate,s.getSelectedRowSubGrid[t].chargeableAmt=s.getSelectedRowSubGrid[t].chargeableAmt+e.entity.chargeableAmt;break}if(t==s.getSelectedRowSubGrid.length-1){let t=angular.copy(e.entity);s.getSelectedRowSubGrid.push(t);break}}else{let t=angular.copy(e.entity);s.getSelectedRowSubGrid.push(t)}else if(s.getSelectedRowSubGrid.length>0)for(let t=0;t<s.getSelectedRowSubGrid.length;t++)if(s.getSelectedRowSubGrid[t].serviceVo.servSeqId==e.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[t].quantity=s.getSelectedRowSubGrid[t].quantity-e.entity.quantity,s.getSelectedRowSubGrid[t].serviceRate=s.getSelectedRowSubGrid[t].serviceRate-e.entity.serviceRate,s.getSelectedRowSubGrid[t].chargeableAmt=s.getSelectedRowSubGrid[t].chargeableAmt-e.entity.chargeableAmt,0==s.getSelectedRowSubGrid[t].quantity&&s.getSelectedRowSubGrid.splice(0,1);break}}),c[t].subGridList[0].gridApi.selection.on.rowSelectionChangedBatch(o,function(e){for(var t=0;t<e.length;t++){var a=e[t];if(a.isSelected)if(s.getSelectedRowSubGrid.length>0)for(let e=0;e<s.getSelectedRowSubGrid.length;e++){if(s.getSelectedRowSubGrid[e].serviceVo.servSeqId==a.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[e].quantity=s.getSelectedRowSubGrid[e].quantity+a.entity.quantity,s.getSelectedRowSubGrid[e].serviceRate=s.getSelectedRowSubGrid[e].serviceRate+a.entity.serviceRate,s.getSelectedRowSubGrid[e].chargeableAmt=s.getSelectedRowSubGrid[e].chargeableAmt+a.entity.chargeableAmt;break}if(e==s.getSelectedRowSubGrid.length-1){let e=angular.copy(a.entity);s.getSelectedRowSubGrid.push(e);break}}else{let e=angular.copy(a.entity);s.getSelectedRowSubGrid.push(e)}else if(s.getSelectedRowSubGrid.length>0)for(let e=0;e<s.getSelectedRowSubGrid.length;e++)if(s.getSelectedRowSubGrid[e].serviceVo.servSeqId==a.entity.serviceVo.servSeqId){s.getSelectedRowSubGrid[e].quantity=s.getSelectedRowSubGrid[e].quantity-a.entity.quantity,s.getSelectedRowSubGrid[e].serviceRate=s.getSelectedRowSubGrid[e].serviceRate-a.entity.serviceRate,s.getSelectedRowSubGrid[e].chargeableAmt=s.getSelectedRowSubGrid[e].chargeableAmt-a.entity.chargeableAmt,0==s.getSelectedRowSubGrid[e].quantity&&s.getSelectedRowSubGrid.splice(0,1);break}}})}}break}if(p)break}}s.billDetailGrid.data=c}}e.$inject=["CallManager","QueryService","IPINDENTAPIS","hisAlertService","$filter"],angular.module("napierContainerUi").service("patientBillingGridDataVald",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l){this.printUnbilled=function(e,t,a){let i=[];i.reportId="BillingPostingSheetReceiptReport",i.subAccSeqId=null!=e&&e.subAccSeqId?e.subAccSeqId:void 0,i.admissionSeqid=null!=a&&a.admissionSeqid?a.admissionSeqid:void 0,i.ipNo=null!=e&&e.ipNo?e.ipNo:void 0;let r=angular.isArray(t)?angular.copy(t):angular.copy([t]),s=[];for(let e=0;e<r.length;e++)if(null!=r[e].packApplyType&&2!=r[e].packApplyType){let t=null!=r[e].spDate&&null!=r[e].spDate.$?r[e].spDate.$:r[e].spDate;r[e].servCode=r[e].serviceVo.servCode,r[e].servName=r[e].serviceVo.servName,r[e].spDate=n("date")(t,"yyyy-MM-dd HH:MM:ss"),r[e].chargeableAmt=r[e].chargeableAmt,r[e].taxAmt=r[e].selfTax+r[e].patientTax+r[e].payerTax,r[e].discountAmt=r[e].selfDiscount+r[e].patientDiscount+r[e].payerDiscount,r[e].companyNonPayingAmt=r[e].patientAmount+r[e].selfAmount,r[e].companyPayingAmt=r[e].payerAmount,s.push(r[e])}i.serviceListString=s;l.printReportModal("patientBillingPrintController","lg","PDF",i)}}e.$inject=["CallManager","QueryService","IPINDENTAPIS","hisAlertService","$uibModal","$filter","PrintService"],angular.module("napierContainerUi").service("patientBillingPrintService",e)}(),function(){"use strict";function e(e,t,a,i){this.getCalculateBillData=function(t,i,r){var n={};return n.url=a.HISIPINDENT.URL,n.requestData={operation:"calculateBill",messageId:"",destination:"calculateBillService",message:{"@class":"com.napier.core.scm.serviceposting.vo.CalculateBillVo",subAccountSequenceId:t.subAccSeqId,planSequenceId:t.insurancePlanSeqId,bedClassSequenceId:t.billingBedClassCode?t.billingBedClassCode:t.bedClassCode,encounterSequenceId:t.encounterSeqId,patientType:1,preAuthIds:t.insurancePlanSeqId&&null!=i&&null!=i.preAuthIds?i.preAuthIds:"",checkFor:t.checkFor,admissionDate:t.admissionDate,packageSPSequenceId:r}},e.sendRestRequest(n)},this.getBillDetailsViewPostBill=function(e,a){a.billDetailList=[],a.cancelBillDetails=[],a.billDetailsDataForPatient=[],a.multipleBillDataForList={1:a.billDetailsDataForPatient,2:a.cancelBillDetails,3:a.billDetailList};var i=t.executeQueryURLReset();a.billDataList=new Array,t.prepareParamListWithParam("pBILLSEQID",e,a.billDataList),t.executeQueryInput("GET_BILL_SUMMARY_DETAILVIEW_POST_BILL",a.billDataList,a.multipleBillDataForList,!0,!1,i,"popUp",{});let r=[];return t.prepareParamListWithParam("pBillSeqId",e,r),t.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,r),t.executeQueryInput("PATIENT_BILLING_CANCEL_BILL_REASON_AND_REMARKS_DTL",r,a.multipleBillDataForList,!0,!1,i,"popUp",{}),t.executeQueryInput("GET_BILL_DETAILVIEW_POST_BILL",a.billDataList,a.multipleBillDataForList,!0,!0,i,"popUp",{}).then(function(e){})},this.getPackageViewPostBill=function(t,i){var r={};return r.url=a.HISIPINDENT.URL,r.requestData={operation:"viewPackageDistribution",messageId:"",destination:"calculateBillService",message:{"@class":"com.napier.core.scm.serviceposting.vo.CalculateBillVo",billSequenceId:t,packageSPSequenceId:i}},e.sendRestRequest(r)},this.getPayerAccountBillAndClaim=function(e){var a=[],i={1:a},r=t.executeQueryURLReset(),n=new Array;return t.prepareParamListWithParam("pSubSeqId",e,n),t.executeQueryInput("GET_BILL_PAYER_CLAIM_ACC_DETAILS",n,i,!0,!0,r,"popUp",{}).then(function(e){return a})},this.patientSearchBilling=function(e){if(null!=e&&null!=e&&""!==e&&e.length>2){e="%"+e+"%";let a=[],i={1:a},r=t.executeQueryURLReset(),n=new Array;return t.prepareParamListWithParam("pPatient_Search",e,n),t.prepareParamListWithParam("pFACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n),t.executeQueryInput("SP_USE_PATIENT_SEARCH_IP_BILLING",n,i,!0,!0,r,"popUp",{}).then(function(e){return a})}return[]}}e.$inject=["CallManager","QueryService","IPINDENTAPIS","hisAlertService"],angular.module("napierContainerUi").service("patientBillingService",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o){r.loadModule("billing");var c=n.getLanguageToSet();r.changeLanguage(c),e.alertData={},l.loadAlerts(c).then(function(t){e.myObj=t,e.alertData={buttonText:e.myObj.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}});var d=this;e.selectedData=[],d.oneAtATime=!1,d.gridOptions=angular.copy(i),d.gridOptions.onRegisterApi=function(t){e.gridApi=t,t.selection.on.rowSelectionChanged(e,function(t){e.selectedData=e.gridApi.selection.getSelectedRows()})},e.roleTask=o.rolePermission("T_BL_M_PAYER_RANKING"),e.newStatePayer=function(){t.go("index.masters.payerRankNew",{object:JSON.stringify(e.selectedData)})},e.updateStatePayer=function(){if(0==d.gridOptions.data.length){var a=e.myObj.noRcrdFoundUpdate;s.hisAlertMulti("information",e.myObj.alertTypeInfo,a,a,!1,!1,e.close,2e3)}if(e.selectedData.length>0)t.go("index.masters.payerRankUpdate",{object:JSON.stringify(e.selectedData),payerData:JSON.stringify(d.payerData)});else{a=e.myObj.plzSlctRcdUpdate;s.hisAlertMulti("information",e.myObj.alertTypeInfo,a,!1,!1,e.close,2e3)}},e.viewStatePayer=function(){if(0==d.gridOptions.data.length){var a=e.myObj.noRcrdFoundView;s.hisAlertMulti("information",e.myObj.alertTypeInfo,a,!1,!1,e.close,2e3)}if(e.selectedData.length>0)t.go("index.masters.payerRankView",{object:JSON.stringify(e.selectedData),payerData:JSON.stringify(d.payerData)});else{a=e.myObj.plzSlctRcdView;s.hisAlertMulti("information",e.myObj.alertTypeInfo,a,!1,!1,e.close,2e3)}},d.payerData=[],d.rankList=function(){d.payerRankingGridDetls=[],d.multipleComboDataForpayerRankingList={1:d.payerRankingGridDetls};var e=a.executeQueryURLReset();d.payerRankingGridDetlsLIst=new Array,a.prepareParamList(1," ",d.payerRankingGridDetlsLIst),a.executeQueryInput("PAYER_TYPE",d.payerRankingGridDetlsLIst,d.multipleComboDataForpayerRankingList,!0,!0,e,"popUp",d.gridOptions).then(function(e){d.payerData=d.payerRankingGridDetls})},d.rankList(),d.payerData1=[],d.getpayerRankAssignment=function(e){d.gridOptions.data=[],d.payerCode=e.CODE,d.payerRankingGridDetls1=[],d.multipleComboDataForpayerRankingList1={1:d.payerRankingGridDetls1};var t=a.executeQueryURLReset();d.payerRankingGridDetlsLIst1=new Array,a.prepareParamList(1,d.payerCode,d.payerRankingGridDetlsLIst1),a.executeQueryInput("PAYER_LIST",d.payerRankingGridDetlsLIst1,d.multipleComboDataForpayerRankingList1,!0,!0,t,"popUp",d.gridOptions).then(function(e){d.payerData1=d.payerRankingGridDetls1,d.gridOptions.data=d.payerRankingGridDetls1})},d.listOnLoad=function(){d.payerRankingLoadList=[],d.multipleComboLoadList={1:d.payerRankingLoadList};var e=a.executeQueryURLReset();d.payerRankingDataList=new Array,a.prepareParamList(1,"",d.payerRankingDataList),a.executeQueryInput("PAYER_LIST",d.payerRankingDataList,d.multipleComboLoadList,!0,!0,e,"popUp",d.gridOptions).then(function(e){d.gridOptions.data=[];for(var t=0;t<d.payerRankingLoadList.length;t++)d.gridOptions.data.push({SNo:t+1,DESCRIPTION:d.payerRankingLoadList[t].PAYER_DESC,PAYER_SEQ_ID:d.payerRankingLoadList[t].PAYER_SEQ})})},d.listOnLoad()}e.$inject=["$scope","$state","QueryService","payerRankAssignmentGridDefinition","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","RoleTaskService"],angular.module("napierContainerUi").controller("payerRankAssignmentController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c){n.loadModule("billing");var d=l.getLanguageToSet();n.changeLanguage(d),e.alertData={},s.loadAlerts(d).then(function(t){e.myObj=t,e.alertData={buttonText:e.myObj.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}});var p=this;p.defDate=new Date,p.oneAtATime=!1,p.gridOptions=angular.copy(r),p.addStatePayer=function(){p.gridOptions.data.push({})},p.payerRankNewDeleteObj={name:"Action",displayName:"billing.action",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents action-row"><span ng-class="{\'pointer\':grid.appScope.payerRankAssignmentNew.newPayerBtn == true}" style="" class="fa fa-trash-o glyf" ng-click="grid.appScope.payerRankAssignmentNew.delRow(row)"> </span></div>',width:"10%"},p.gridOptions.columnDefs.push(p.payerRankNewDeleteObj),p.gridOptions.data=[{}],e.listStatePayer=function(){t.go("index.masters.payerRankAssignment")},p.delRow=function(e){var t;0==p.newPayerBtn&&(t=p.gridOptions.data.indexOf(e.entity),p.gridOptions.data.splice(t,1))},p.payerData=[],p.rankNew=function(){p.payerRankingGridDetls=[],p.multipleComboDataForpayerRankingList={1:p.payerRankingGridDetls};var e=a.executeQueryURLReset();p.payerRankingGridDetlsLIst=new Array,a.prepareParamList(1," ",p.payerRankingGridDetlsLIst),a.executeQueryInput("PAYER_TYPE",p.payerRankingGridDetlsLIst,p.multipleComboDataForpayerRankingList,!0,!0,e,"popUp",p.gridOptions).then(function(e){p.payerData=p.payerRankingGridDetls})},p.rankNew(),p.getModelByCode=function(e,t){if(null!=t&&null!=t)for(var a=0;a<e.length;a++)if(e[a].CODE.toString().trim()==t.toString().trim())return e[a]},p.payerData1=[],p.getpayerRankNew=function(e){p.gridOptions.data=[],p.payerCode=e.CODE,p.payerRankingGridDetls1=[],p.multipleComboDataForpayerRankingList1={1:p.payerRankingGridDetls1};var t=a.executeQueryURLReset();p.payerRankingGridDetlsLIst1=new Array,a.prepareParamList(1,p.payerCode,p.payerRankingGridDetlsLIst1),a.executeQueryInput("PAYER_RANKING",p.payerRankingGridDetlsLIst1,p.multipleComboDataForpayerRankingList1,!0,!0,t,"popUp",p.gridOptions).then(function(e){p.payerData1=p.payerRankingGridDetls1;for(var t=0;t<p.payerData1.length;t++)p.payerData1[t].SEC_PAYER_SEQ_ID=p.getModelByCode(p.payerData,p.payerData1[t].PAYER_TYPE),p.payerData1[t].VALID_FROM_DATE=new Date(moment(p.payerData1[t].VALID_FROM_DATE).format("YYYY-MM-DD")),p.payerData1[t].VALID_TO_DATE=null==p.payerData1[t].VALID_TO_DATE?"":new Date(moment(p.payerData1[t].VALID_TO_DATE).format("YYYY-MM-DD"));p.gridOptions.data=p.payerData1,0!=p.payerData1.length?p.newPayerBtn=!0:p.newPayerBtn=!1})},e.toDateOptions={showWeeks:!1,minDate:new Date},e.fromDateOptions={showWeeks:!1,minDate:new Date},p.indx=[],p.checkErr=function(t,a,i,r){if(t.entity.VALID_TO_DATE){if(t.entity.VALID_FROM_DATE>t.entity.VALID_TO_DATE){p.saveBtn=!0;var n=e.myObj.ValidDtShntBLsThnFromDate;return o.hisAlertMulti("warning",e.myObj.alertTypeWarn,n,!1,!1,e.close,2e3),!1}p.saveBtn=!1}},p.payerRankingList=[],p.checkIfArrayIsUnique=function(t,a,i,r){var n,l=t,s=a,d=i,p=r,u="",m="",g="",S="",v="";if(1!=s[0]){var D=e.myObj.rankingStart;return o.hisAlertMulti("warning",e.myObj.alertTypeWarn,D,!1,!1,e.close,2e3),!0}for(var y=0;y<s.length;y++){if(s[y+1]-s[y]==1);else if(c("date")(d[y],"yyyy-MM-dd")==c("date")(d[y+1],"yyyy-MM-dd")){D=e.myObj.notValdRak;return o.hisAlertMulti("failure",e.myObj.alertTypeFail,D,!1,!1,e.close,2e3),!0}}for(n=0;n<t.length;n++){if(u=l[n],m=s[n],g=d[n],S=p[n],m>t.length){D=e.myObj.notValdRak;return o.hisAlertMulti("warning",e.myObj.alertTypeWarn,D,!1,!1,e.close,2e3),!0}for(var f=0;f<l.length;f++){if(u==l[f]&&n!=f){D=e.myObj.payerNmeAldyExt;return o.hisAlertMulti("failure",e.myObj.alertTypeFail,D,!1,!1,e.close,2e3),!0}if(m==s[f]&&u!=l[f]){if(""==v){v=S;break}if(v>=g){v="";D=e.myObj.rankAldyExt;return o.hisAlertMulti("failure",e.myObj.alertTypeFail,D,!1,!1,e.close,2e3),!0}}}}return!1},p.saveStatePayer=function(){if(null==p.payerCode){var a=e.myObj.plzFilMandFild;return o.hisAlertMulti("warning",e.myObj.alertTypeWarn,a,!1,!1,e.close,2e3),!1}p.insArray=[],p.rankArray=[],p.fromDate=[],p.toDate=[];for(var r=0;r<p.gridOptions.data.length;r++){if(angular.isUndefined(p.gridOptions.data[r].SEC_PAYER_SEQ_ID)){a=e.myObj.assignPayerRequire;return o.hisAlertMulti("warning",e.myObj.alertTypeWarn,a,!1,!1,e.close,2e3),!1}if(p.insArray.push(p.gridOptions.data[r].SEC_PAYER_SEQ_ID.DESCRIPTION),null==p.gridOptions.data[r].RANK_SEQ_ID||""==p.gridOptions.data[r].RANK_SEQ_ID||null==p.gridOptions.data[r].RANK_SEQ_ID){var a=e.myObj.rankRequire;return o.hisAlertMulti("warning",e.myObj.alertTypeWarn,a,!1,!1,e.close,2e3),!1}if(p.rankArray.push(p.gridOptions.data[r].RANK_SEQ_ID),null==p.gridOptions.data[r].VALID_FROM_DATE||""==p.gridOptions.data[r].VALID_FROM_DATE||null==p.gridOptions.data[r].VALID_FROM_DATE){a=e.myObj.validfdateRequire;return o.hisAlertMulti("warning",e.myObj.alertTypeWarn,a,!1,!1,e.close,2e3),!1}p.fromDate.push(p.gridOptions.data[r].VALID_FROM_DATE),p.toDate.push(p.gridOptions.data[r].VALID_TO_DATE)}if(p.checkIfArrayIsUnique(p.insArray,p.rankArray,p.fromDate,p.toDate));else{p.payerRankingList=[];for(r=0;r<p.gridOptions.data.length;r++)p.payerRankingList.push({payrRankSeqId:p.gridOptions.data[r].payrRankSeqId?p.gridOptions.data[r].payrRankSeqId:void 0,primPayrSeqId:p.payerCode,secPayrSeqId:p.gridOptions.data[r].SEC_PAYER_SEQ_ID.CODE,rank:p.gridOptions.data[r].RANK_SEQ_ID,payerType:p.gridOptions.data[r].SEC_PAYER_SEQ_ID.CODE,validFrom:p.gridOptions.data[r].VALID_FROM_DATE}),"Invalid Date"!=p.gridOptions.data[r].VALID_TO_DATE&&null!=p.gridOptions.data[r].VALID_TO_DATE&&(p.payerRankingList[r].validTo=p.gridOptions.data[r].VALID_TO_DATE);var n={url:"HISServices/PayerRankingService"};n.requestData={operation:"saveOrUpdatePayerRanking",messageId:"",destination:"com.napier.core.billing.service.external.PayerRankingService",message:{"@class":"com.napier.core.service.vo.billing.PayerRankingList",payerRankingList:[{"com.napier.core.service.vo.billing.PayerRanking":p.payerRankingList}]}},i.sendRestRequest(n).then(function(a){if(a.data.HITService.message.payerRankingList.length>0){var i=e.myObj.savdSucesFuly;o.hisAlertMulti("success",e.myObj.alertTypeSucss,i,!1,!1,e.close,2e3),t.go("index.masters.payerRankAssignment")}else{i=e.myObj.saveFail;o.hisAlertMulti("failure",e.myObj.alertTypeFail,i,!1,!1,e.close,2e3)}},function(e){})}}}e.$inject=["$scope","$state","QueryService","CallManager","payerRankNewGridDefinition","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService","$filter"],angular.module("napierContainerUi").controller("payerRankNewController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d){l.loadModule("billing");var p=o.getLanguageToSet();l.changeLanguage(p),e.alertData={},c.loadAlerts(p).then(function(t){e.myObj=t,e.alertData={buttonText:e.myObj.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}});var u=this;u.oneAtATime=!1,u.gridOptions=angular.copy(n),u.addStatePayer=function(){u.gridOptions.data.push({})},u.gridOptions.data=[{},{},{}],u.getModelByCode=function(e,t){if(null!=t&&null!=t)for(var a=0;a<e.length;a++)if(e[a].CODE.toString().trim()==t.toString().trim())return e[a]},u.callMyFunction=function(e){e.entity.SEC_PAYER_SEQ_ID=u.getModelByCode(u.payerData,e.entity.SEC_PAYER_SEQ_ID)},u.payerData1=[],u.getpayerRankAssignmentUpdate=function(t){u.gridOptions.data=[],u.payerCode=t.CODE;var r={url:"HISServices/PayerRankingService"};r.requestData={operation:"ExecuteQuery",destination:"QueryService",voclass:"com.napier.core.service.vo.query.QueryData",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"PAYER_RANKING",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pPayrSeqId",value:u.payerCode}]}]}]}]}},i.sendRestRequest(r).then(function(t){var i=t.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"];u.payerData1=[];var r=JSON.parse(a.payerData);if(null!=i.length)angular.forEach(i,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"];e.gridRecord=[];for(var n=0;n<i.length;n++)e.gridRecord[i[n].name.split(".")[1]]=i[n].data;e.gridRecord.SEC_PAYER_SEQ_ID=u.getModelByCode(r,e.gridRecord.PAYER_TYPE),u.payerUpdate=u.getModelByCode(r,e.gridRecord.PAYER_SEQ_ID),u.payerData1.push(e.gridRecord)});else{var n=i.columnList[0]["com.napier.core.service.vo.query.Column"];e.gridRecord=[];for(var l=0;l<n.length;l++)e.gridRecord[n[l].name.split(".")[1]]=n[l].data;e.gridRecord.SEC_PAYER_SEQ_ID=u.getModelByCode(r,e.gridRecord.PAYER_TYPE),u.payerUpdate=u.getModelByCode(r,e.gridRecord.PAYER_SEQ_ID),u.payerData1.push(e.gridRecord)}for(l=0;l<u.payerData1.length;l++)u.payerData1[l].VALID_FROM_DATE=new Date(moment(u.payerData1[l].VALID_FROM_DATE).format("YYYY-MM-DD")),u.payerData1[l].VALID_TO_DATE=null==u.payerData1[l].VALID_TO_DATE?"":new Date(moment(u.payerData1[l].VALID_TO_DATE).format("YYYY-MM-DD"));u.gridOptions.data=u.payerData1,0!=u.payerData1.length?u.newPayerBtn=!0:u.newPayerBtn=!1},function(e){})},u.defDate=new Date,e.toDateOptions={showWeeks:!1,minDate:new Date},e.fromDateOptions={showWeeks:!1,minDate:new Date},u.checkErr=function(t,a,i,r){if(t.entity.VALID_TO_DATE){if(t.entity.VALID_FROM_DATE>t.entity.VALID_TO_DATE){u.saveBtn=!0;var n=e.myObj.ValidDtShntBLsThnFromDate;return d.hisAlertMulti("warning",e.myObj.alertTypeWarn,n,!1,!1,e.close,2e3),!1}u.saveBtn=!1}},u.payerRankingList=[],u.checkIfArrayIsUnique=function(t,a,i,r){var n,l=t,o=a,c=i,p=r,u="",m="",g="",S="",v="";if(1!=o[0]){var D=e.myObj.rankingStart;return d.hisAlertMulti("warning",e.myObj.alertTypeWarn,D,!1,!1,e.close,2e3),!0}for(var y=0;y<o.length;y++){if(o[y+1]-o[y]==1);else if(s("date")(c[y],"yyyy-MM-dd")==s("date")(c[y+1],"yyyy-MM-dd")){D=e.myObj.notValdRak;return d.hisAlertMulti("failure",e.myObj.alertTypeFail,D,!1,!1,e.close,2e3),!0}}for(n=0;n<t.length;n++){if(u=l[n],m=o[n],g=c[n],S=p[n],m>t.length){D=e.myObj.notValdRak;return d.hisAlertMulti("warning",e.myObj.alertTypeWarn,D,!1,!1,e.close,2e3),!0}for(var f=0;f<l.length;f++){if(u==l[f]&&n!=f){D=e.myObj.payerNmeAldyExt;return d.hisAlertMulti("failure",e.myObj.alertTypeFail,D,!1,!1,e.close,2e3),!0}if(m==o[f]&&u!=l[f]){if(""==v){v=S;break}if(v>=g){v="";D=e.myObj.rankAldyExt;return d.hisAlertMulti("warning",e.myObj.alertTypeWarn,D,!1,!1,e.close,2e3),!0}}}}return!1},u.UpdateStatePayer=function(){u.insArray=[],u.rankArray=[],u.fromDate=[],u.toDate=[];for(var a=0;a<u.gridOptions.data.length;a++){if(angular.isUndefined(u.gridOptions.data[a].SEC_PAYER_SEQ_ID)){r=e.myObj.assignPayerRequire;return d.hisAlertMulti("warning",e.myObj.alertTypeWarn,r,!1,!1,e.close,2e3),!1}if(u.insArray.push(u.gridOptions.data[a].SEC_PAYER_SEQ_ID.CODE),null==u.gridOptions.data[a].RANK_SEQ_ID||""==u.gridOptions.data[a].RANK_SEQ_ID||null==u.gridOptions.data[a].RANK_SEQ_ID){var r=e.myObj.rankRequire;return d.hisAlertMulti("warning",e.myObj.alertTypeWarn,r,!1,!1,e.close,2e3),!1}if(u.rankArray.push(u.gridOptions.data[a].RANK_SEQ_ID),null==u.gridOptions.data[a].VALID_FROM_DATE||""==u.gridOptions.data[a].VALID_FROM_DATE||null==u.gridOptions.data[a].VALID_FROM_DATE){var r=e.myObj.validfdateRequire;return d.hisAlertMulti("warning",e.myObj.alertTypeWarn,r,!1,!1,e.close,2e3),!1}u.fromDate.push(u.gridOptions.data[a].VALID_FROM_DATE),u.toDate.push(u.gridOptions.data[a].VALID_TO_DATE)}if(!u.checkIfArrayIsUnique(u.insArray,u.rankArray,u.fromDate,u.toDate)){u.payerRankingList=[];for(a=0;a<u.gridOptions.data.length;a++)u.payerRankingList.push({payrRankSeqId:u.gridOptions.data[a].PAYER_RANK_SEQ_ID?u.gridOptions.data[a].PAYER_RANK_SEQ_ID:void 0,primPayrSeqId:u.payerCode,secPayrSeqId:u.gridOptions.data[a].SEC_PAYER_SEQ_ID.CODE,rank:u.gridOptions.data[a].RANK_SEQ_ID,payerType:u.gridOptions.data[a].SEC_PAYER_SEQ_ID.CODE,validFrom:u.gridOptions.data[a].VALID_FROM_DATE}),"Invalid Date"!=u.gridOptions.data[a].VALID_TO_DATE&&null!=u.gridOptions.data[a].VALID_TO_DATE&&""!=u.gridOptions.data[a].VALID_TO_DATE&&(u.payerRankingList[a].validTo=u.gridOptions.data[a].VALID_TO_DATE);var n={url:"HISServices/PayerRankingService"};n.requestData={operation:"saveOrUpdatePayerRanking",messageId:"",destination:"com.napier.core.billing.service.external.PayerRankingService",message:{"@class":"com.napier.core.service.vo.billing.PayerRankingList",payerRankingList:[{"com.napier.core.service.vo.billing.PayerRanking":u.payerRankingList}]}},i.sendRestRequest(n).then(function(a){if(a.data.HITService.message.payerRankingList.length>0){var i=e.myObj.updatedSucsfuly;d.hisAlertMulti("success",e.myObj.alertTypeSucss,i,!1,!1,e.close,2e3),t.go("index.masters.payerRankAssignment")}else{i=e.myObj.updateFail;d.hisAlertMulti("failure",e.myObj.alertTypeFail,i,!1,!1,e.close,2e3)}},function(e){})}},u.payerData=[],u.rankUpdate=function(){u.payerRankingGridDetls=[],u.multipleComboDataForpayerRankingList={1:u.payerRankingGridDetls};var e=r.executeQueryURLReset();u.payerRankingGridDetlsLIst=new Array,r.prepareParamList(1," ",u.payerRankingGridDetlsLIst),r.executeQueryInput("PAYER_TYPE",u.payerRankingGridDetlsLIst,u.multipleComboDataForpayerRankingList,!0,!0,e,"popUp",u.gridOptions).then(function(e){u.payerData=u.payerRankingGridDetls;var t={};t.CODE=JSON.parse(a.object)[0].PAYER_SEQ_ID,u.getpayerRankAssignmentUpdate(t)})},u.rankUpdate()}e.$inject=["$scope","$state","$stateParams","CallManager","QueryService","payerRankAssignmentUpdateGridDefinition","hisTranslationsService","$filter","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService"],angular.module("napierContainerUi").controller("payerRankAssignmentUpdateController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o){s.loadModule("billing"),s.changeLanguage("en"),(r=this).oneAtATime=!1,r.gridOptions=angular.copy(a),n.getGridData().then(function(e){r.gridOptions.data=e}),n.options=!0,t.newStatePayer=function(){i.go("index.masters.payerRankNew")}}e.$inject=["$log","$scope","payerRankListGridDefinition","$state","payerRankList","payerRankListService","toastr","hisTranslationsService","$filter"],angular.module("napierContainerUi").controller("payerRankListController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s){l.loadModule("billing");var o=a.getLanguageToSet();l.changeLanguage(o);var c=this;c.oneAtATime=!1,c.gridOptions=angular.copy(n),e.updateStatePayer=function(){t.go("index.masters.payerRankUpdate",{object:i.object,payerData:i.payerData})},c.payerData=[],c.rankView=function(){c.payerRankingGridDetls=[],c.multipleComboDataForpayerRankingList={1:c.payerRankingGridDetls};var e=r.executeQueryURLReset();c.payerRankingGridDetlsLIst=new Array,r.prepareParamList(1," ",c.payerRankingGridDetlsLIst),r.executeQueryInput("PAYER_TYPE",c.payerRankingGridDetlsLIst,c.multipleComboDataForpayerRankingList,!0,!0,e,"popUp",c.gridOptions).then(function(e){c.payerData=c.payerRankingGridDetls})},c.rankView(),c.getModelByCode=function(e,t){if(null!=t&&null!=t)for(var a=0;a<e.length;a++)if(e[a].CODE.toString().trim()==t.toString().trim())return e[a]},c.payerData1=[],c.getpayerRankView=function(e){c.gridOptions.data=[],c.payerCode=e.CODE,c.payerRankingGridDetls1=[],c.multipleComboDataForpayerRankingList1={1:c.payerRankingGridDetls1};var t=r.executeQueryURLReset();c.payerRankingGridDetlsLIst1=new Array,r.prepareParamList(1,c.payerCode,c.payerRankingGridDetlsLIst1),r.executeQueryInput("PAYER_RANKING",c.payerRankingGridDetlsLIst1,c.multipleComboDataForpayerRankingList1,!0,!0,t,"popUp",c.gridOptions).then(function(e){var t=JSON.parse(i.payerData);c.payerData1=c.payerRankingGridDetls1;for(var a=0;a<e[1].length;a++)e[1][a].assignedPayer=c.getModelByCode(t,e[1][a].PAYER_TYPE),c.payerView=c.getModelByCode(t,e[1][a].PAYER_SEQ_ID);c.gridOptions.data=e[1]})};var d={};d.CODE=JSON.parse(i.object)[0].PAYER_SEQ_ID,c.getpayerRankView(d)}e.$inject=["$scope","$state","hisTranslationsGlobalLang","$stateParams","QueryService","payerRankViewGridDefinition","hisTranslationsService","$filter"],angular.module("napierContainerUi").controller("payerRankViewController",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("paymentGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,columnDefs:[{name:"billDtls",displayName:"billing.details",pinnedLeft:!0,cellTemplate:'<div class="ui-grid-cell-contents"><div class="his-info-link" ng-if="row.entity.billDtls == \'Receipts\'"><a href ng-click="grid.appScope.payment.receiptsmode()">{{row.entity.billDtls}}</a></div> <div class="his-sub-link" ng-if="row.entity.billDtls != \'Receipts\'">{{row.entity.billDtls}}</div></div>',headerCellFilter:"translate"},{name:"payerAmt",displayName:"billing.cmpnypayingAmt",pinnedLeft:!0,headerCellFilter:"translate"},{name:"patientAmt",displayName:"billing.cmpnyNonPayingAmt",pinnedLeft:!0,headerCellFilter:"translate"}]}).constant("crNoteGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,showColumnFooter:!0,columnDefs:[{name:"CR_NOTE_DATE",displayName:"billing.date",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.CR_NOTE_DATE|date:grid.appScope.payment.format}}</div>',headerCellFilter:"translate"},{name:"COL_REQ_NO",displayName:"billing.refNo",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate"},{name:"CR_NOTE_AMT",displayName:"billing.depAmount",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",cellFilter:"number: 2",footerCellClass:"center",headerCellFilter:"translate",footerCellFilter:"number: 2"},{name:"CNH_ADJ_AMT",displayName:"billing.appliedAmt",enableSorting:!0,enableCellEdit:!1,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center",cellFilter:"number: 2",headerCellFilter:"translate",footerCellFilter:"number: 2"},{name:"balanceAmt",displayName:"billing.balance",enableSorting:!0,enableCellEdit:!1,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",cellFilter:"number: 2",footerCellClass:"center",headerCellFilter:"translate",footerCellFilter:"number: 2"},{name:"action",displayName:"billing.action",cellTemplate:'<div class="ui-grid-cell-contents"><div class="his-btn-group" style="position: relative; top: -4px;"><button class="his-btn his-btn-info his-grid-btn" ng-click="grid.appScope.payment.adjustCreditNote(row.entity)">Adjust</button><button class="his-btn his-btn-info his-grid-btn" ng-click="grid.appScope.payment.refundCreditNote(row.entity)">Refund</button></div></div>',headerCellFilter:"translate",visible:!1}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("paymentTabGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,columnDefs:[{name:"PayMode",displayName:"billing.payMode",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,headerCellFilter:"translate"},{name:"amtPaid",displayName:"billing.amtPaid",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,headerCellFilter:"translate"},{name:"payerRadType",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"refNo",displayName:"Ref No.",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,headerCellFilter:"translate"},{name:"Receivedfrom",displayName:"Received from",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,headerCellFilter:"translate"},{name:"Action",displayName:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="pay-tab-grid"><div class="actionRow"><i class="fa fa-trash" ng-click="grid.appScope.removePayGriRow(row,rowRenderIndex)"></i></div></div>',pinnedRight:!0,width:60,headerCellFilter:"translate"},{name:"paymentDate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"chequeType",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"chequeDDno",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"chequeDDDate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"cardNumber",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"cardTranId",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"bank",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"paymentTranType",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"PayModeCode",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"mobileNumber",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("receiptTabGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScrollbar:1,columnDefs:[{name:"RECP_NO",displayName:"billing.receiptNo",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:170,headerCellFilter:"translate"},{name:"AMOUNT",displayName:"billing.amtPaid",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:140,headerCellFilter:"translate"},{name:"PAY_TYPE_DESC",displayName:"billing.payMode",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1,width:100,headerCellFilter:"translate"},{name:"RECP_DATE",displayName:"billing.scrollDate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:170,headerCellFilter:"translate"},{name:"EN_SEQ_ID",displayName:"billing.encounterId",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:120,headerCellFilter:"translate"},{name:"RECEIVED_FROM",displayName:"billing.receivedFromRefundTo",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:"*",headerCellFilter:"translate"},{name:"RECEIVED_BY",displayName:"billing.receivedBy",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1,width:"*",headerCellFilter:"translate"},{name:"PAYM_DATE",displayName:"billing.paymentDate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1,width:100,headerCellFilter:"translate"},{name:"chequeType",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"chequeDDno",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"chequeDDDate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"cardNumber",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"cardTranId",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"bank",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"paymentTranType",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{name:"PayModeCode",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,visible:!1},{field:"action",displayName:"Action",visible:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row"><div><i class="fa fa-print" role="button" ng-click="grid.appScope.payment.printReceipt(row.entity,rowRenderIndex)"></i></div></div>'}]})}(),function(){"use strict";function e(e,t,a){this.savePaymentDataList=function(i,r,n){var l=e.defer(),s=[];angular.forEach(r,function(e){var t;""!=e.chequeDDDate&&e.chequeDDDate&&(t=moment(e.chequeDDDate).format("YYYY-MM-DD")+"T"+moment(e.chequeDDDate).format("HH:mm:ss.SSS")+"Z");var a={"@class":"com.napier.core.collections.vo.ReceiptDetails",amount:null!=e.actualValue?e.actualValue:e.amtPaid,bankAccSeqId:i.depBankSeqId,gnTranStatus:1,payMode:e.PayModeCode,cardBank:e.bank,cardNo:e.cardNumber,cardTranNo:e.cardTranId,chequeDDNo:e.chequeDDno,chequeqDDDate:t,chequeType:e.chequeType,payMobileNo:e.mobileNumber,ecsTranType:e.paymentTranType,cardExpiryDate:e.cardExpiryDate,cardType:e.cardType};s.push(a)});var o={};return o.url=a.HISIPINDENT.URL,o.requestData={operation:"savePaymentRefund",messageId:"savePaymentRefund",destination:"com.napier.core.collections.service.external.PaymentRefundService",message:{"@class":"com.napier.core.collections.vo.ReceiptHeader",bank:i.depBankDesc,colReqSeqId:i.collSeqId,partialRequestSeqId:i.partialRequestSeqId,counterCode:"2",gnTranStatus:1,receiptAmount:i.rcpAmt,billSeqId:i.billSeqId,receiptDetailsList:[{"com.napier.core.collections.vo.ReceiptDetails":s}],depositVo:[{"com.napier.core.service.vo.deposits.DepositsVo":[]}],creditNoteAdjList:[{"com.napier.core.billgeneration.vo.CreditNoteAdjustVo":n}],receiptTranType:i.tranReqType,receivedFrom:i.rcvdFrmName,recpSingleOrMultiple:0,remarks:"",requestAmount:i.reqAmt,scrollAdmin:166,shiftCode:"3001",totalAmt:i.ttlAmt,gnPayerType:i.gnPayerType?i.gnPayerType:void 0}},t.sendRestRequest(o).then(function(e){l.resolve(e)},function(e){}),l.promise},this.checkPreLogin=function(i){var r=e.defer(),n={};return n.url=a.HISIPINDENT.URL,n.requestData={operation:"preLogin",messageId:"",destination:"securityService",message:{"@class":"com.napier.core.service.vo.security.AuthenticationRequest",userName:i.authuserName,passWord:i.authUserPwd,authenticationType:1,isLDAPEnable:"Y"}},t.sendRestRequest(n).then(function(e){r.resolve(e)},function(e){}),r.promise},this.savePaymentBillAuth=function(i){var r=e.defer(),n={};return n.url=a.HISIPINDENT.URL,n.requestData={operation:"savePartialPaymentAuth",messageId:"savePartialPaymentAuth",destination:"com.napier.core.collections.service.external.PaymentRefundService",message:{"@class":"com.napier.core.collections.vo.PartialPaymentAuthVo",billSeqId:i.billSeqId,colReqSeqId:i.colSeqId,authPersonName:i.authName,remarks:i.authRemarks}},t.sendRestRequest(n).then(function(e){r.resolve(e)},function(e){}),r.promise},this.receiptPrintService=function(i){var r=e.defer(),n={};return n.url=a.HISIPINDENT.URL,n.requestData={operation:"processReport",messageId:"",destination:"reportingServiceImpl",message:{"@class":"com.napier.report.vo.ReportRequest",reportId:"PaymentReceipt_GenerationPdf_Report",filterParams:[{"com.napier.report.model.ReportIndex":[{ident:"pBillSeqId",value:i}]}],reportType:{id:4,desc:"PDF"}}},t.sendRestRequest(n).then(function(e){r.resolve(e)},function(e){}),r.promise},this.receiptRefundPrintService=function(i,r,n,l){var s=e.defer(),o="",c=[];switch(12==r||17==r||18==r||21==r||24==r||25==r?1:7==r||10==r||11==r||20==r||27==r?2:26==r?3:4){case 1:o="HSC_Patient_PaymentRefundRequestDetailsReportId",c.push({ident:"pPaymentRefundReceiptId",value:i});break;case 2:o="DepositTaxInvoiceReportForHSC",c.push({ident:"pColrequestSeqId",value:i});break;case 3:o="HSC_PATIENT_PAYMENT_RECEIPT_GENERATION_REPORT",c.push({ident:"pBillSeqId",value:i},{ident:"pReceptSeqId",value:l},{ident:"pReceptDtSeqId",value:-999});break;default:o="PaymentReceipt_GenerationPdf_Report",i=n,c.push({ident:"pBillSeqId",value:i})}var d={};return d.url=a.HISIPINDENT.URL,d.requestData={operation:"processReport",messageId:"",destination:"reportingServiceImpl",message:{"@class":"com.napier.report.vo.ReportRequest",reportId:o,filterParams:[{"com.napier.report.model.ReportIndex":c}],reportType:{id:4,desc:"PDF"}}},t.sendRestRequest(d).then(function(e){s.resolve(e)},function(e){}),s.promise}}e.$inject=["$q","CallManager","IPINDENTAPIS"],angular.module("napierContainerUi").service("paymentService",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S){a.loadModule("billing");var v=m.getLanguageToSet();a.changeLanguage(v);var D=this;D.filesUploaded=[],D.uploadedfileNames=[],D.uploadingFile=!1,D.preAuthHeaderObj={},D.preAuthCopyServAmt=0,D.alertData={},g.loadAlerts(v).then(function(t){D.alertData=t,e.alertData={buttonText:D.alertData.ok},e.alertFunction={buttonCallBack1:function(){D.messageReq=!1}},e.close={buttonClose:function(){D.messageReq=!1}}},function(e){}),D.CD=angular.copy(o),D.reqDateOptions={format:D.CD.dateOnly.format},e.estimateCost=e.discounts=e.grossAmount=e.preAuthValue=0,D.strBedId,D.listSelectData=JSON.parse(i.id),null!=D.listSelectData[0][0].preauthRefSeqId?e.hideAprv=!1:e.hideAprv=!0,D.patientDetails={approxBillHdSeqId:D.listSelectData[0][0].approxBillHdSeqId,regSeqId:null==D.listSelectData[0][0].regSeqId?D.listSelectData[1].regSeqId:D.listSelectData[0][0].regSeqId,admissionSeqid:null==D.listSelectData[0][0].ipAdmSeqId?D.listSelectData[1].ipAdmSeqId:D.listSelectData[0][0].ipAdmSeqId},D.saveObjectReady=null==D.listSelectData[1]?D.listSelectData[0][0]:D.listSelectData[1],null!=D.listSelectData[1]&&null!=D.listSelectData[1]&&null!=D.listSelectData[1].ListBedDtls&&(D.strBedId=D.listSelectData[1].ListBedDtls[0]["com.napier.core.billgeneration.vo.BedDetailsVo"][0].strBedId),D.approxBillDate=n("date")(D.listSelectData[0][0].approxBillDate.$,"yyyy-MM-dd HH:mm:ss.s");var y="1",f=D.patientDetails;y=null!=f.admissionSeqid?"1":"2",u.getPatientBanner(f,y).then(function(t){e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=12}),r.patientBannerDetail(D.patientDetails.regSeqId).then(function(t){e.patientBannerDetails=t,e.patBanShow=!0,e.patientRecordsDetail=e.patientBannerDetails.patientRecordsDetail,e.patientValue=e.patientBannerDetails.patientValue,e.patientAddress=e.patientBannerDetails.patientAddress,e.bloodGroupName=e.patientBannerDetails.bloodGroupName,e.insurance=e.patientBannerDetails.insurance}),D.uploadFile=function(t){p.fileUploadCheck(t,D,e)},D.preAuthFile=function(e){p.removeUploadedFile(e,D)},s.serviceGridData(D,"preAppEn",!0),D.changePriServ=function(e,t,a,i){S.getDepartment(D,e,t,a,i)},D.changeDept=function(e,t,a,i){S.getSpeciltyData(D,e,t,a,i)},D.serviceSearch=function(e,t){return S.getServiceList(t,e)},D.changeSpecialty=function(e,t){t.inActiveVal&&(t.service=void 0)},D.addRowGrid=function(t){let a={};if(a.priServGroup=t.entity.priServGroup,a.department=t.entity.department,a.specialty=t.entity.specialty,a.service=t.entity.service,a.valueAmt=t.entity.valueAmt,a.isAmtNlPercFlag=t.entity.isAmtNlPercFlag,a.qty=t.entity.qty,a.approvedDetails=t.entity.approvedDetails,a.remarks=t.entity.remarks,a.approvedAmount=t.entity.approvedAmount,a.approvedQty=t.entity.approvedQty,null!=a.priServGroup||null!=a.department||null!=a.specialty||null!=a.service&&""!=a.service){let i=!0;if(3!=a.isAmtNlPercFlag?i=null!=a.valueAmt&&""!==a.valueAmt||null!=a.qty&&""!==a.qty:3==a.isAmtNlPercFlag&&(i=!0),i&&3!=a.isAmtNlPercFlag&&(null!=a.valueAmt&&""!=a.valueAmt&&parseFloat(a.valueAmt)>0||null==a.valueAmt||""===a.valueAmt)&&(null!=a.qty&&""!=a.qty&&parseFloat(a.qty)>0||null==a.qty||""===a.qty)||3==a.isAmtNlPercFlag)if(i&&!t.entity.editable){if(S.validDuplicate(D,a)){D.preAuthDetailsGridOtions.data.push(a),D.preAuthDetailsGridOtions.data[0]=[],D.clearRecordFirst(t),D.preAuthValue=S.calPreAuthAmt(D.preAuthDetailsGridOtions.data),D.preAuthForServ=angular.copy(D.preAuthValue),D.preAuthHeaderObj.GROSS_AMT=angular.copy(D.preAuthValue);let i=0;i=e.calTempAmt(D.preAuthDetailsGridOtions,i),D.initialAuthAmount=i,D.preAuthCopyServAmt=angular.copy(i)}else c.hisAlertMulti("information",D.alertData.alertTypeInfo,"Already Same Record Exist(s), Kindly Update The Value.",e.alertData,e.alertFunction,e.close)}else if(t.entity.editable){D.preAuthDetailsGridOtions.data[t.entity.recordIndex]=a,D.preAuthDetailsGridOtions.data[t.entity.recordIndex].deleteDisble=!1,e.toggleText="",D.preAuthDetailsGridOtions.data[0]=[],D.clearRecordFirst(t),D.preAuthValue=S.calPreAuthAmt(D.preAuthDetailsGridOtions.data),D.preAuthForServ=angular.copy(D.preAuthValue),D.preAuthHeaderObj.GROSS_AMT=angular.copy(D.preAuthValue);let i=0;i=e.calTempAmt(D.preAuthDetailsGridOtions,i),D.initialAuthAmount=i,D.preAuthCopyServAmt=angular.copy(i)}else c.hisAlertMulti("information",D.alertData.alertTypeInfo,"Please Enter Amount or Qty.",e.alertData,e.alertFunction,e.close);else c.hisAlertMulti("information",D.alertData.alertTypeInfo,"Amount or Qty Can't be zero value",e.alertData,e.alertFunction,e.close)}else c.hisAlertMulti("information",D.alertData.alertTypeInfo,"PPlease Select Any Group or Service With Amount or Qty.",e.alertData,e.alertFunction,e.close)},D.editGridData=function(t,a){null!=D.prevoisIndex&&D.prevoisIndex!=a&&null!=D.preAuthDetailsGridOtions.data[D.prevoisIndex]&&(D.preAuthDetailsGridOtions.data[D.prevoisIndex].deleteDisble=!1),t.entity.deleteDisble=!0,D.prevoisIndex=a;let i={};i.priServGroup=t.entity.priServGroup,i.department=t.entity.department,i.specialty=t.entity.specialty,i.service=t.entity.service,i.valueAmt=t.entity.valueAmt,i.isAmtNlPercFlag=t.entity.isAmtNlPercFlag,i.qty=t.entity.qty,i.approvedDetails=t.entity.approvedDetails,i.remarks=t.entity.remarks,i.approvedAmount=t.entity.approvedAmount,i.approvedQty=t.entity.approvedQty,D.preAuthDetailsGridOtions.data[0]=i,D.preAuthDetailsGridOtions.data[0].editable=!0,D.preAuthDetailsGridOtions.data[0].recordIndex=a,e.toggleText="UPDATE",D.changePriServ(t.entity.priServGroup,D.preAuthDetailsGridOtions.data[0],t.entity,!0)},D.clearRecordFirst=function(t){null!=t&&t.entity.editable&&(D.preAuthDetailsGridOtions.data[t.entity.recordIndex].deleteDisble=!1,t.entity.editable=!1,e.toggleText=""),D.preAuthDetailsGridOtions.data[0]=[],D.preAuthDetailsGridOtions.data[0].isAmtNlPercFlag="1",D.preAuthDetailsGridOtions.data[0].valueAmt="",D.preAuthDetailsGridOtions.data[0].qty="",D.preAuthDetailsGridOtions.data[0].deleteDisble=!1,D.speciltyList=[],D.deptList=[]},D.deleteRecord=function(t,a){let i={buttonText:D.alertData.no,buttonText2:D.alertData.yes},r={buttonCallBack1:function(){},buttonCallBack2:function(){D.preAuthDetailsGridOtions.data.splice(a,1),D.preAuthValue=S.calPreAuthAmt(D.preAuthDetailsGridOtions.data),D.preAuthForServ=angular.copy(D.preAuthValue),D.preAuthHeaderObj.GROSS_AMT=angular.copy(D.preAuthValue);let t=0;t=e.calTempAmt(D.preAuthDetailsGridOtions,t),D.initialAuthAmount=t,D.preAuthCopyServAmt=angular.copy(t)}};c.hisAlertMulti("information",D.alertData.alertTypeInfo,"Do You Want To Delete The Record?",i,r,{buttonClose:function(){}})},D.getPreAuth=function(t){if(2==t){D.preAuthValue=S.calPreAuthAmt(D.preAuthDetailsGridOtions.data),D.preAuthForServ=angular.copy(D.preAuthValue),D.preAuthHeaderObj.GROSS_AMT=D.preAuthForServ;let t=0;t=e.calTempAmt(D.preAuthDetailsGridOtions,t),D.initialAuthAmount=t,D.preAuthCopyServAmt=angular.copy(t)}else D.preAuthForServ=void 0,D.preAuthValue=0,D.preAuthHeaderObj.GROSS_AMT=D.grossAmt,D.initialAuthAmount=0},D.onSelected=function(e,t){S.getDropDownBasedService(e,t,D)},D.downloadFile=function(e){p.downloadDocument(e)},D.isChangedVal=function(e){null!=e&&""!=e&&"."!=e?null!=D.preAuthForServ&&parseFloat(e)<parseFloat(D.preAuthForServ)&&(D.preAuthValue=angular.copy(D.preAuthForServ)):D.preAuthValue=0},D.amountOrPercBlur=function(e){2==e.isAmtNlPercFlag&&null!=e.valueAmt&&null!=e.valueAmt&&""!=e.valueAmt&&parseFloat(e.valueAmt)>parseFloat(100)&&(e.valueAmt=100),"AP"==e.approvedDetails?e.approvedAmount=e.valueAmt:"PA"==e.approvedDetails?(null!=e.valueAmt&&null!=e.valueAmt&&""!=e.valueAmt&&null!=e.approvedAmount&&""!=e.approvedAmount&&(parseFloat(e.approvedAmount),parseFloat(e.valueAmt)),e.approvedAmount=e.valueAmt):"NA"==e.approvedDetails&&null!=e.valueAmt&&null!=e.valueAmt&&""!=e.valueAmt&&(e.approvedAmount=0)},e.expectedDate=function(e){return e.entity.expcServDate=e.entity.expcServDate.$,n("date")(e.entity.expcServDate,"yyyy-MM-dd")},e.expectedDrugDate=function(e){e.entity.expcServDate="2017-04-10 11:52:37.37"},t.getPreAuthDataHeader(D.patientDetails,D).then(function(e){D.preAuthHeaderList.length>0&&(D.isBillOrServiceFlag=D.preAuthHeaderList[0].IS_BILL_OR_SERVE_LEVEL+"",D.isCoPayAvl=null!=D.preAuthHeaderList[0].IS_COPAY_AVAILABLE?D.preAuthHeaderList[0].IS_COPAY_AVAILABLE+"":"3",D.coPayVal=D.preAuthHeaderList[0].COPAY_VALUE,D.maxCap=null!=D.preAuthHeaderList[0].IS_MAX_COPAY_AVAILABLE?D.preAuthHeaderList[0].IS_MAX_COPAY_AVAILABLE+"":"3",D.maxCapOnCopay=D.preAuthHeaderList[0].MAX_COPAY_VALUE,D.isDedctibleAvl=null!=D.preAuthHeaderList[0].IS_DEDUCTABLE_AVAILABLE?D.preAuthHeaderList[0].IS_DEDUCTABLE_AVAILABLE+"":"3",D.deductbleValue=D.preAuthHeaderList[0].DEDUCTABLE_VALUE,D.initialAuthAmount=D.preAuthHeaderList[0].APPROVED_AMNT,D.grossAmt=D.preAuthHeaderList[0].GROSS_AMT,D.preAuthHeaderObj=D.preAuthHeaderList[0]),p.getDocument(D).then(function(e){for(var t=0;t<e.length;t++)D.filesUploaded.push({"@class":"com.napier.core.service.vo.uploadfile.NapierDocument",docName:e[t].DOC_NAME,docSeqId:e[t].DOC_SEQ_ID,status:2,machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,fileSize:e[t].FILE_SIZE,trimFileName:p.trimFile(e[t].DOC_NAME),fSize:e[t].FILE_SIZE}),D.uploadedfileNames.push(e[t].DOC_NAME)}),t.getPreAuthData(D.patientDetails,D).then(function(e){if(D.preAuthServiceList.length>0){D.preAuthDetailsGridOtions.data[0]=[],D.preAuthDetailsGridOtions.data[0].isAmtNlPercFlag="1",D.preAuthDetailsGridOtions.data[0].valueAmt="",D.preAuthDetailsGridOtions.data[0].qty="";for(let e=0;e<D.preAuthServiceList.length;e++)D.preAuthDetailsGridOtions.data.push({isAmtNlPercFlag:D.preAuthServiceList[e].IS_AMT_PERC_NL_CODE+"",approxBillDtSeqId:D.preAuthServiceList[e].PREAUTH_BILL_DT_SEQ_ID,valueAmt:D.preAuthServiceList[e].CHARGEABLE_AMT,qty:D.preAuthServiceList[e].SERV_QTY,priServGroup:{DESCRIPTION:D.preAuthServiceList[e].PRI_SERV_DESC,CODE:D.preAuthServiceList[e].PRI_SERV_CODE},department:{DESCRIPTION:D.preAuthServiceList[e].DEPT_DESC,CODE:D.preAuthServiceList[e].DEPT_CODE},specialty:{DESCRIPTION:D.preAuthServiceList[e].SPL_DESC,CODE:D.preAuthServiceList[e].SPL_CODE},service:{SERV_NAME:D.preAuthServiceList[e].SERV_NAME,SERV_SEQ_ID:D.preAuthServiceList[e].SERV_SEQ_ID},preAuthApp:!0,approvedDetails:D.preAuthServiceList[e].APPROVD_DTLS,approvedAmount:D.preAuthServiceList[e].APPROVED_AMNT,approvedQty:D.preAuthServiceList[e].APPROVED_QTY,remarks:D.preAuthServiceList[e].APPROVE_REMARKS});D.preAuthValue=S.calPreAuthAmt(D.preAuthDetailsGridOtions.data),D.preAuthForServ=angular.copy(D.preAuthValue)}})}),e.valueCheck=function(t){var a;null!=t.entity.approvedDetails&&null!=t.entity.approvedDetails&&(null!=t.entity.valueAmt&&""!=t.entity.valueAmt&&(a=t.entity.valueAmt),"PA"==t.entity.approvedDetails&&(e.disableAmount=!1,t.entity.approvedAmount>a?t.entity.approvedAmount=a-1:t.entity.approvedAmount<=0?t.entity.approvedAmount=null:t.entity.approvedAmount=t.entity.approvedAmount))},D.initialAuthAmount=0,D.validAppAmt=function(e){2==D.isBillOrServiceFlag&&(null!=e&&""!=e&&(parseFloat(e)<parseFloat(D.preAuthCopyServAmt)||0==parseFloat(e))?D.initialAuthAmount=D.preAuthCopyServAmt:null!=e&&""!=e||(D.initialAuthAmount=D.preAuthCopyServAmt))},e.calTempAmt=function(e,t,a){t=0;for(var i=1;i<e.data.length;i++)null!=e.data[i].approvedAmount&&""!=e.data[i].approvedAmount&&1==e.data[i].isAmtNlPercFlag&&(t+=parseFloat(e.data[i].approvedAmount));return t},e.amountChange=function(t,a,i,r,n){let l=0,s=0;if(null!=t.entity.approvedDetails&&null!=t.entity.approvedDetails){null!=t.entity.valueAmt&&""!=t.entity.valueAmt&&(l=t.entity.valueAmt),null!=t.entity.qty&&""!=t.entity.qty&&(s=t.entity.qty),"AP"==t.entity.approvedDetails?(t.entity.editable=!1,D.pASave=!1,null!=t.entity.valueAmt&&""!=t.entity.valueAmt&&(t.entity.approvedAmount=parseFloat(l)),null!=t.entity.qty&&""!=t.entity.qty&&(t.entity.approvedQty=parseFloat(s)),3==t.entity.isAmtNlPercFlag&&(t.entity.approvedAmount=void 0,t.entity.approvedQty=void 0)):"PA"==t.entity.approvedDetails?(D.pASave=!0,e.disableAmount=!1,t.entity.editable=!0,null!=t.entity.valueAmt&&""!=t.entity.valueAmt&&(t.entity.approvedAmount=0),null!=t.entity.qty&&""!=t.entity.qty&&(t.entity.approvedQty=0)):"NA"==t.entity.approvedDetails&&(D.pASave=!1,null!=t.entity.valueAmt&&""!=t.entity.valueAmt&&(t.entity.approvedAmount=0),null!=t.entity.qty&&""!=t.entity.qty&&(t.entity.approvedQty=0),t.entity.editable=!1,3==t.entity.isAmtNlPercFlag&&(t.entity.approvedAmount=void 0,t.entity.approvedQty=0));let a=0;a=e.calTempAmt(D.preAuthDetailsGridOtions,a),D.initialAuthAmount=a,D.preAuthCopyServAmt=angular.copy(a),e.prevAmt=t.entity.approvedAmount}},D.preAuthValue=0,e.getPreAuthValue=function(t){var a=0;if(D.pASave=!1,D.messageReq||"PA"!=t.entity.approvedDetails||null==t.entity.valueAmt||""==t.entity.valueAmt||null==t.entity.qty||""==t.entity.qty||null!=t.entity.approvedAmount&&null!=t.entity.approvedAmount&&""!=t.entity.approvedAmount&&0!=parseFloat(t.entity.approvedAmount)&&null!=t.entity.approvedQty&&null!=t.entity.approvedQty&&""!=t.entity.approvedQty&&0!=parseFloat(t.entity.approvedQty))if("PA"!=t.entity.approvedDetails||null==t.entity.valueAmt||""==t.entity.valueAmt||null!=t.entity.qty&&""!=t.entity.qty||null!=t.entity.approvedAmount&&null!=t.entity.approvedAmount&&""!=t.entity.approvedAmount&&0!=parseFloat(t.entity.approvedAmount))if("PA"!=t.entity.approvedDetails||null!=t.entity.valueAmt&&""!=t.entity.valueAmt||null==t.entity.qty||""==t.entity.qty||null!=t.entity.approvedQty&&null!=t.entity.approvedQty&&""!=t.entity.approvedQty&&0!=parseFloat(t.entity.approvedQty))if("PA"!=t.entity.approvedDetails||3!=t.entity.isAmtNlPercFlag||null!=t.entity.approvedQty&&null!=t.entity.approvedQty&&""!=t.entity.approvedQty&&0!=parseFloat(t.entity.approvedQty)){if("PA"==t.entity.approvedDetails&&null!=t.entity.valueAmt&&""!=t.entity.valueAmt&&parseFloat(t.entity.approvedAmount)>parseFloat(t.entity.valueAmt)&&(t.entity.approvedAmount=parseFloat(t.entity.valueAmt)),"PA"==t.entity.approvedDetails&&null!=t.entity.qty&&""!=t.entity.qty&&parseFloat(t.entity.approvedQty)>parseFloat(t.entity.qty)&&(t.entity.approvedQty=parseFloat(t.entity.qty)),t.entity.approvedAmount==t.entity.valueAmt&&t.entity.approvedQty==t.entity.qty){D.pASaveD=!0;i="Approved Amount Or Approved Qty. Can't Be Equal With Request Amount Or Requested Qty.";c.hisAlertMulti("information",D.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.close)}else D.pASaveD=!1;D.pASave=!1,a=e.calTempAmt(D.preAuthDetailsGridOtions,a,!0),D.initialAuthAmount=a,D.preAuthCopyServAmt=angular.copy(a)}else{D.pASave=!0;i=D.alertData.plzFilPAamtMreZero;c.hisAlertMulti("information",D.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.close)}else{D.pASave=!0;var i=D.alertData.plzFilPAamtMreZero;c.hisAlertMulti("information",D.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.close)}else{D.pASave=!0;var i=D.alertData.plzFilPAamtMreZero;c.hisAlertMulti("information",D.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.close)}else{D.pASave=!0;var i="Please Fill PA Amount or Qty. Value As More Than Zero.";D.messageReq=!0,c.hisAlertMulti("information",D.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.close)}},D.validCoPay=function(e){null!=e&&""!=e&&parseFloat(e)>parseFloat(100)&&(D.coPayVal=100)},D.getPatrialApprovalValid=function(){for(let a=1;a<D.preAuthDetailsGridOtions.data.length;a++)if("PA"==D.preAuthDetailsGridOtions.data[a].approvedDetails){let i=D.preAuthDetailsGridOtions.data[a];if("PA"!=i.approvedDetails||null==i.valueAmt||""==i.valueAmt||null==i.qty||""==i.qty||null!=i.approvedAmount&&null!=i.approvedAmount&&""!=i.approvedAmount&&0!=parseFloat(i.approvedAmount)&&null!=i.approvedQty&&null!=i.approvedQty&&""!=i.approvedQty&&0!=parseFloat(i.approvedQty)){if("PA"!=i.approvedDetails||null==i.valueAmt||""==i.valueAmt||null!=i.qty&&""!=i.qty||null!=i.approvedAmount&&null!=i.approvedAmount&&""!=i.approvedAmount&&0!=parseFloat(i.approvedAmount)){if("PA"!=i.approvedDetails||null!=i.valueAmt&&""!=i.valueAmt||null==i.qty||""==i.qty||null!=i.approvedQty&&null!=i.approvedQty&&""!=i.approvedQty&&0!=parseFloat(i.approvedQty)){if("PA"!=i.approvedDetails||3!=i.isAmtNlPercFlag||null!=i.approvedQty&&null!=i.approvedQty&&""!=i.approvedQty&&0!=parseFloat(i.approvedQty)){if(i.approvedAmount==i.valueAmt&&i.approvedQty==i.qty){t="Approved Amount Or Approved Qty. Can't Be Equal With Request Amount Or Requested Qty.";return c.hisAlertMulti("information",D.alertData.alertTypeInfo,t,e.alertData,e.alertFunction,e.close),!0}return D.pASaveD=!1,D.pASave=!1,!1}t=D.alertData.plzFilPAamtMreZero;return c.hisAlertMulti("information",D.alertData.alertTypeInfo,t,e.alertData,e.alertFunction,e.close),!0}var t=D.alertData.plzFilPAamtMreZero;return c.hisAlertMulti("information",D.alertData.alertTypeInfo,t,e.alertData,e.alertFunction,e.close),!0}var t=D.alertData.plzFilPAamtMreZero;return c.hisAlertMulti("information",D.alertData.alertTypeInfo,t,e.alertData,e.alertFunction,e.close),!0}var t="Please Fill PA Amount or Qty. Value As More Than Zero.";return c.hisAlertMulti("information",D.alertData.alertTypeInfo,t,e.alertData,e.alertFunction,e.close),!0}},D.save=function(){if(1==D.maxCap&&(null==D.maxCapOnCopay||""==D.maxCapOnCopay||parseFloat(D.maxCapOnCopay)<=0))c.hisAlertMulti("information",D.alertData.alertTypeInfo,"max Copay Value Can't be zero or empty.",e.alertData,e.alertFunction,e.close);else if(1==D.isDedctibleAvl&&(null==D.deductbleValue||""==D.deductbleValue||parseFloat(D.deductbleValue)<=0)||1==D.isCoPayAvl&&(null==D.coPayVal||""==D.coPayVal||parseFloat(D.coPayVal)<=0))c.hisAlertMulti("information",D.alertData.alertTypeInfo,"Deductible Amount or Co-Pay Percentage Can't be zero or empty.",e.alertData,e.alertFunction,e.close);else if(null==D.initialAuthAmount||""==D.initialAuthAmount||0==parseFloat(D.initialAuthAmount))c.hisAlertMulti("information",D.alertData.alertTypeInfo,"Auth Amount Can't be zero or empty.",e.alertData,e.alertFunction,e.close);else if(D.pASaveD){let t="Approved Amount Or Approved Qty. Can't Be Equal With Request Amount Or Requested Qty.";c.hisAlertMulti("information",D.alertData.alertTypeInfo,t,e.alertData,e.alertFunction,e.close)}else{if(D.getPatrialApprovalValid())return!1;if(D.pASave){var t=D.alertData.plzFilPAamtMreZero;c.hisAlertMulti("information",D.alertData.alertTypeInfo,t,e.alertData,e.alertFunction,e.close)}else{if(D.patientDetails.approvedAmount=null!=D.preAuthHeaderObj.APPROVED_AMNT&&null!=D.preAuthHeaderObj.APPROVED_AMNT?D.preAuthHeaderObj.APPROVED_AMNT:0,D.saveDetails=[],2==D.isBillOrServiceFlag)for(var a=1;a<D.preAuthDetailsGridOtions.data.length;a++)D.saveDetails.push({serviceCode:null!=D.preAuthDetailsGridOtions.data[a].service?D.preAuthDetailsGridOtions.data[a].service.SERV_CODE:void 0,serviceSeqId:null!=D.preAuthDetailsGridOtions.data[a].service&&null!=D.preAuthDetailsGridOtions.data[a].service.SERV_SEQ_ID?D.preAuthDetailsGridOtions.data[a].service.SERV_SEQ_ID:void 0,serviceName:null!=D.preAuthDetailsGridOtions.data[a].service?D.preAuthDetailsGridOtions.data[a].service.SERV_NAME:void 0,serviceRate:void 0,serviceQty:null!=D.preAuthDetailsGridOtions.data[a].qty&&""!=D.preAuthDetailsGridOtions.data[a].qty?parseFloat(D.preAuthDetailsGridOtions.data[a].qty):void 0,serviceTax:void 0,serviceDiscountAmt:void 0,chargeableAmt:null!=D.preAuthDetailsGridOtions.data[a].valueAmt&&""!=D.preAuthDetailsGridOtions.data[a].valueAmt&&3!=D.preAuthDetailsGridOtions.data[a].isAmtNlPercFlag?parseFloat(D.preAuthDetailsGridOtions.data[a].valueAmt):void 0,expcServDate:"9999-03-05 00:00:00.000",gnTranStatus:2,serviceType:null!=D.preAuthDetailsGridOtions.data[a].service&&null!=D.preAuthDetailsGridOtions.data[a].service.SERV_SEQ_ID?parseFloat(1):null!=D.preAuthDetailsGridOtions.data[a].specialty&&null!=D.preAuthDetailsGridOtions.data[a].specialty.CODE?parseFloat(2):null!=D.preAuthDetailsGridOtions.data[a].department&&null!=D.preAuthDetailsGridOtions.data[a].department.CODE?parseFloat(3):null!=D.preAuthDetailsGridOtions.data[a].priServGroup&&null!=D.preAuthDetailsGridOtions.data[a].priServGroup.CODE?parseFloat(4):void 0,isAmtPercNl:null!=D.preAuthDetailsGridOtions.data[a].isAmtNlPercFlag&&""!=D.preAuthDetailsGridOtions.data[a].isAmtNlPercFlag?parseFloat(D.preAuthDetailsGridOtions.data[a].isAmtNlPercFlag):void 0,primaryServCode:null!=D.preAuthDetailsGridOtions.data[a].priServGroup&&null!=D.preAuthDetailsGridOtions.data[a].priServGroup.CODE?D.preAuthDetailsGridOtions.data[a].priServGroup.CODE:void 0,deptCode:null!=D.preAuthDetailsGridOtions.data[a].department&&null!=D.preAuthDetailsGridOtions.data[a].department.CODE?D.preAuthDetailsGridOtions.data[a].department.CODE:void 0,specilityCode:null!=D.preAuthDetailsGridOtions.data[a].specialty&&null!=D.preAuthDetailsGridOtions.data[a].specialty.CODE?D.preAuthDetailsGridOtions.data[a].specialty.CODE:void 0,remarks:D.preAuthDetailsGridOtions.data[a].remarks,approvedAmount:null!=D.preAuthDetailsGridOtions.data[a].approvedAmount&&""!=D.preAuthDetailsGridOtions.data[a].approvedAmount?parseFloat(D.preAuthDetailsGridOtions.data[a].approvedAmount):void 0,approvedDetails:D.preAuthDetailsGridOtions.data[a].approvedDetails,approvedQty:null!=D.preAuthDetailsGridOtions.data[a].approvedQty&&""!=D.preAuthDetailsGridOtions.data[a].approvedQty?parseFloat(D.preAuthDetailsGridOtions.data[a].approvedQty):void 0,approxBillDtSeqId:D.preAuthDetailsGridOtions.data[a].approxBillDtSeqId});p.saveDocument(D),D.patientDetails.grossAmt=parseFloat(D.preAuthHeaderObj.GROSS_AMT),D.patientDetails.isBillOrServeLevel=parseFloat(D.isBillOrServiceFlag),D.patientDetails.approvalRefNo=D.preAuthHeaderObj.APPREFNO,D.patientDetails.approvedAmount=parseFloat(D.initialAuthAmount),D.patientDetails.isDeductableAvailable=parseFloat(D.isDedctibleAvl),D.patientDetails.deductableValue=null!=D.deductbleValue&&""!=D.deductbleValue?parseFloat(D.deductbleValue):void 0,D.patientDetails.isCopayAvailable=parseFloat(D.isCoPayAvl),D.patientDetails.copayValue=null!=D.coPayVal&&""!=D.coPayVal?parseFloat(D.coPayVal):void 0,D.patientDetails.isMaxCopayAvailable=parseFloat(D.maxCap),D.patientDetails.maxCopayValue=null!=D.maxCapOnCopay&&""!=D.maxCapOnCopay?parseFloat(D.maxCapOnCopay):void 0,D.patientDetails.remarks=D.preAuthHeaderObj.REMARKS,D.patientDetails.tariffSeqId=null==D.listSelectData[0][0].tariffSeqId?4:D.listSelectData[0][0].tariffSeqId;l.savePreAuthForReg(D.patientDetails,D.saveDetails,[],[],[],[],[]).then(function(t){if(null!=t.data.HITService.message){var a={buttonText:D.alertData.ok},i={buttonCallBack1:function(){e.patientRecordsDetail.mrNo;d.go("index.billingSub.preAuthList",{id:e.patientRecordsDetail.mrNo})}},r=(i.buttonCallBack1(),D.alertData.savdSucesFuly);c.hisAlertMulti("success",D.alertData.alertTypeSucss,r,a,i,!1,2e3)}})}}}}e.$inject=["$scope","PreAuthViewServices","hisTranslationsService","$stateParams","PatientBannerBilling","$filter","PreAuthSaveServices","ServiceGet","hisCalDefConstant","hisAlertService","$state","gridDefApproval","PatientBannerGlobal","hisTranslationsGlobalLang","hisGenericAlertService","CommonForServiceData"],angular.module("napierContainerUi").controller("preAuthApprovalDtlsCtrl",e)}(),function(){"use strict";angular.module("napierContainerUi").service("gridDefApproval",["CallManager","$filter","IPINDENTAPIS","$translate","hisTranslationsService","hisAlertService","QueryService",function(e,t,a,i,r,n,l){this.gridServiceAppr=function(e,t){e.gridMenuTitleFilter=r.menuTranslate,e.columnDefs=[{field:"serviceCode",displayName:"billing.serviceCode",headerCellFilter:"translate",enableCellEdit:!1},{field:"serviceName",displayName:"billing.serviceName",headerCellFilter:"translate",enableCellEdit:!1,width:200,cellTemplate:'<div class="ui-grid-cell-contents"><span uib-tooltip="{{row.entity.serviceName}}" tooltip-placement="left">{{row.entity.serviceName}}</span></div>'},{field:"serviceRate",displayName:"billing.servicePrice",headerCellFilter:"translate",enableCellEdit:!1},{field:"serviceDiscountAmt",displayName:"billing.discount",headerCellFilter:"translate",enableCellEdit:!1},{field:"serviceQty",displayName:"billing.quantity",headerCellFilter:"translate",enableCellEdit:!1},{field:"chargeableAmt",displayName:"billing.amt",headerCellFilter:"translate",enableCellEdit:!1},{field:"serviceTax",displayName:"billing.taxAplicable",headerCellFilter:"translate",enableCellEdit:!1,width:120},{field:"approvedDetails",displayName:"billing.approvaldetails",visible:!0,headerCellFilter:"translate",width:130,cellTemplate:'<div class="ui-grid-cell-contents" ><select class="custom-style" ui-grid-editor ng-model="MODEL_COL_FIELD" ng-change="grid.appScope.amountChange(row,grid,rowRenderIndex,col,rows)"><option  value="" selected></option><option value="AP">{{\'billing.AP\'| translate}}</option><option value="PA">{{\'billing.PA\'| translate}}</option><option value="NA">{{\'billing.NAAuth\'| translate}}</option></select></div>'},{field:"approxBillDtSeqId",visible:!1},{field:"remarks",headerCellFilter:"translate",enableCellEditOnFocus:!1,enableCellEdit:!1,width:200,displayName:"billing.remarks",cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" class="custom-style" ng-model="MODEL_COL_FIELD"  my-maxlength="100"></div>',editType:"text"},{field:"approvedAmount",visible:!0,displayName:"billing.value",headerCellFilter:"translate",enableCellEditOnFocus:!1,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-if="!row.entity.editable" >{{row.entity.approvedAmount}}</div><div ng-if="row.entity.editable" class="ui-grid-cell-contents"><input type="number"  ng-model="MODEL_COL_FIELD" class="custom-style" ng-change="grid.appScope.valueCheck(row)" ng-disabled="grid.appScope.disableAmount" ng-blur="grid.appScope.getPreAuthValue(row)"></div>',editableCellTemplate:'<input type="number" placeholder="Value" ng-class="\'colt\' + col.uid" ui-grid-editor ng-model="MODEL_COL_FIELD" ng-change="grid.appScope.valueCheck(row)" ng-disabled="grid.appScope.disableAmount" ng-blur="grid.appScope.getPreAuthValue(row)">',editType:"number"},{field:"expcServDate",visible:!1},{name:"facilityId",visible:!1},{name:"practiceId",visible:!1},{name:"gnTranStatus",visible:!1}]};var s=5*Math.pow(1024,2),o=function(e){if(null!=e){var t=e.split("."),a=t[t.length-1];if(t[0].length>8)var i=t[0].slice(0,5)+"..."+a;else i=e;return i}};function c(e,t){for(var a=0;a<t.filesUploaded.length;a++)if(t.filesUploaded[a].docName==e.docName||t.filesUploaded[a].docName==e){t.filesUploaded.splice(a,1),t.uploadedfileNames.splice(a,1);break}}this.trimFile=function(e){return o(e)};var d=function(e,a,i){if(null==e.name)return!1;var r=e.name;if(!/(\.pdf|\.xls|\.xlsx|\.jpg|\.jpeg|\.png|\.doc|\.docx)$/i.exec(r))return n.warning("Warning","Incorrect File Format <br> Valid formats(pdf,xls,xlsx,jpg,jpeg,png,doc,docx)"),angular.element("input[type='file']").val(null),!1;if(e.size>s){var l={buttonCallBack1:function(){angular.element("input[type='file']").val(null)},buttonCallBack2:function(){c(e.name,a),angular.element("input[type='file']").val(null)}};n.confirmation("Information","Total limit (5mb) exceeded Do you still want to continue?",{buttonText:"Yes",buttonText2:"No"},l)}var d=new FileReader;d.onload=function(r){var n=r.target.result,l=function(e,t){if(0==e)return"0 Bytes";var a=t||2,i=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,i)).toFixed(a))+" "+["Bytes","KB","MB"][i]}(e.size);e.name;a.uploadingFile=!0;var s={"@class":"com.napier.core.service.vo.uploadfile.NapierDocument",docName:e.name,docExtension:"jpg",context:1,contextDetailMaster:{"@class":"com.napier.core.service.vo.uploadfile.ContextDetailMaster",code:20,description:"Pre Auth Upload File"},referenceId:null!=a.patientDetails&&null!=a.patientDetails.approxBillHdSeqId?a.patientDetails.approxBillHdSeqId:void 0,prmryEntityId:null!=a.patientDetails&&null!=a.patientDetails.approxBillHdSeqId?a.patientDetails.approxBillHdSeqId:void 0,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,uploadDocumnt:n.split("base64,")[1],docUploadedDate:t("date")(new Date,"yyyy-MM-dd HH:MM:ss.s"),documentDescription:"Pre Auth",identifier:"PreAuth",docTypeSeqId:20,createdBy:1,modifiedDate:t("date")(new Date,"yyyy-MM-dd HH:MM:ss.s"),modifiedBy:1,status:1,machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,fileSize:l,trimFileName:o(e.name),fSize:e.size};return a.filesUploaded.push(s),a.uploadedfileNames.push(e.name),a.uploadingFile=!1,i.$$phase||i.$digest(),!0},d.readAsDataURL(e)};this.fileUploadCheck=function(e,t,a){if(t.uploadedfileNames&&t.uploadedfileNames.length>0&&t.uploadedfileNames.indexOf(e.name)>-1){t.removeDuplicate=function(){var i=t.uploadedfileNames.indexOf(e.name);t.filesUploaded.splice(i,1),t.uploadedfileNames.splice(i,1),d(e,t,a)},t.closeConfimation=function(){angular.element("input[type='file']").val(null)};var i={buttonCallBack1:t.removeDuplicate,buttonCallBack2:t.closeConfimation};n.confirmation("Information","Already same file exists, do you want to replace?",{buttonText:"Yes",buttonText2:"No"},i)}else d(e,t,a)},this.removeUploadedFile=function(e,t){null==e.docSeqId&&c(e,t)},this.getDocument=function(e){e.getDoc=[],e.multipleComboDataForList={1:e.getDoc};var t=l.executeQueryURLReset();return e.getDocList=new Array,l.prepareParamList(1,e.patientDetails.approxBillHdSeqId,e.getDocList),l.executeQueryInput("GET_PREAUTH_UPLOAD_DOCS",e.getDocList,e.multipleComboDataForList,!0,!0,t,"popUp",s).then(function(e){return(e[1]instanceof Array?e[1]:[e[1]]).map(function(e){return e})})},this.saveDocument=function(t){for(var i=[],r=0;r<t.filesUploaded.length;r++)null!=t.filesUploaded[r].trimFileName&&(t.filesUploaded[r].trimFileName=void 0),null!=t.filesUploaded[r].fSize&&(t.filesUploaded[r].fSize=void 0),null==t.filesUploaded[r].docSeqId&&i.push(t.filesUploaded[r]);var n={};return n.url=a.HISIPINDENT.URL,n.requestData={operation:"storeDocumentList",messageId:"",destination:"com.napier.core.fileupload.service.external.FileUploadService",message:{"@class":"com.napier.core.service.vo.uploadfile.NapierDocumentList",napierDocumentList:[{"com.napier.core.service.vo.uploadfile.NapierDocument":i}]}},e.sendRestRequest(n)},this.downloadDocument=function(t){if(null==t.docSeqId){var i="data:application/octet-stream;base64,"+t.uploadDocumnt,r=document.createElement("a");r.download=t.docName,r.href=i,r.click(),r.remove()}else{var n={};n.url=a.HISIPINDENT.URL,n.requestData={operation:"getDocument",messageId:"",destination:"com.napier.core.fileupload.service.external.FileUploadService",message:{"@class":"com.napier.core.service.vo.uploadfile.DocumentSearch",context:1,contextDetail:20,entityId:t.regSeqId,primaryEntityId:t.regSeqId,subContextId:1}},e.sendRestRequest(n).then(function(e){if(null!=e.data.HITService.message.napierDocumentList[0]&&null!=e.data.HITService.message.napierDocumentList[0]&&""!=e.data.HITService.message.napierDocumentList[0]){var a=e.data.HITService.message.napierDocumentList[0]["com.napier.core.service.vo.uploadfile.NapierDocument"],i=function(e,t){if(!(t instanceof Array))return t;for(var a=0;a<t.length;a++)if(t[a].docSeqId==e)return t[a]}(t.docSeqId,a);if(null!=i.uploadDocumnt&&null!=i.uploadDocumnt[0]&&null!=i.uploadDocumnt[0]&&""!=i.uploadDocumnt[0]){var r="data:application/octet-stream;base64,"+i.uploadDocumnt[0],n=document.createElement("a");n.download=t.docName,n.href=r,n.click(),n.remove()}}})}}}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v){t.loadModule("billing");var D=p.getLanguageToSet();t.changeLanguage(D);var y=this;y.filesUploaded=[],y.uploadedfileNames=[],y.uploadingFile=!1,y.saveDisable=!1,y.preAuthValue=0,y.alertData={},u.loadAlerts(D).then(function(t){y.alertData=t,e.alertData={buttonText:y.alertData.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}}),y.CD=angular.copy(s),e.reminderDetails=JSON.parse(sessionStorage.userContextObj).LOGIN_NAME,e.estimateCost=0,e.grossAmount=0,e.discounts=0,y.reminderStatus="Approved",y.listSelectData=JSON.parse(i.id),y.patientDetails={approxBillHdSeqId:y.listSelectData[0][0].approxBillHdSeqId,regSeqId:null==y.listSelectData[0][0].regSeqId?y.listSelectData[1].regSeqId:y.listSelectData[0][0].regSeqId,admissionSeqid:null==y.listSelectData[0][0].ipAdmSeqId?y.listSelectData[1].ipAdmSeqId:y.listSelectData[0][0].ipAdmSeqId},y.patientDetailsSearch=null==y.listSelectData[1]?y.listSelectData[0][0]:y.listSelectData[1],null!=y.listSelectData[0][0]&&null!=y.listSelectData[0][0]&&null!=y.listSelectData[0][0].bedClassSeqId&&""!=y.listSelectData[0][0].bedClassSeqId?e.bedClassName=y.listSelectData[0][0].bedClassSeqId:e.bedClassName=null,y.remOptions={format:y.CD.dateOnly.format,minDate:new Date(y.listSelectData[0][0].approxBillDate.$)},y.reminderDate=new Date;var f="1",C=y.patientDetails;f=null!=C.admissionSeqid?"1":"2",y.getAccSeqList=[];let I={1:y.getAccSeqList},A=g.executeQueryURLReset();y.getAccSeqListArr=[],g.prepareParamListWithParam("pRegSeqId",y.patientDetails.regSeqId,y.getAccSeqListArr),g.executeQueryInput("GET_ACCOUNT_AND_SUB_ACCOUNT_PHARMACY",y.getAccSeqListArr,I,!0,!0,A,"popUp",{}),y.estimateNumber=[],y.multipleComboData={1:y.estimateNumber};var E=g.executeQueryURLReset();y.estimateNumberList=new Array,g.prepareParamList(1,y.patientDetails.regSeqId,y.estimateNumberList),g.executeQueryInput("PREAUTH_PAT_BL_LIST",y.estimateNumberList,y.multipleComboData,!0,!0,E,"popUp",{}),c.getPatientBanner(C,f).then(function(t){e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=12}),r.patientBannerDetail(y.patientDetails.regSeqId).then(function(t){e.patientBannerDetails=t,e.patientRecordsDetail=e.patientBannerDetails.patientRecordsDetail,e.patientValue=e.patientBannerDetails.patientValue}),y.uploadFile=function(t){m.fileUploadCheck(t,y,e)},y.preAuthFile=function(e){m.removeUploadedFile(e,y)},y.changeEstimate=function(t){if(null!=t&&null!=t&&null!=t.BC_SEQ_ID)if("NO"==t.Pre_AuthGenerated){y.isBillOrServiceFlag=2,y.preAuthDetailsGridOtions.data=[],y.filesUploaded=[],y.preAuthValue=0,e.remarks=void 0,y.preAuthDetailsGridOtions.data=[],y.preAuthDetailsGridOtions.data[0]=[],y.preAuthDetailsGridOtions.data[0].isAmtNlPercFlag="1",y.preAuthDetailsGridOtions.data[0].valueAmt="",y.preAuthDetailsGridOtions.data[0].qty="",y.speciltyList=[],y.deptList=[];let a=t.APPROX_BILL_HD_SEQ_ID;v.getQueryForEstimate(y.preAuthDetailsGridOtions,e,a,y.patientDetails.regSeqId,y,!0,!0)}else{let a="Already Pre-Authorization Generated For This "+t.EstimateBillNumber+". Do You Want To Continue?",i={buttonText:y.alertData.no,buttonText2:y.alertData.yes},r={buttonCallBack1:function(){y.estimateSct=void 0},buttonCallBack2:function(){y.isBillOrServiceFlag=2,y.preAuthDetailsGridOtions.data=[],y.filesUploaded=[],y.preAuthValue=0,e.remarks=void 0,y.preAuthDetailsGridOtions.data=[],y.preAuthDetailsGridOtions.data[0]=[],y.preAuthDetailsGridOtions.data[0].isAmtNlPercFlag="1",y.preAuthDetailsGridOtions.data[0].valueAmt="",y.preAuthDetailsGridOtions.data[0].qty="",y.speciltyList=[],y.deptList=[];let a=t.APPROX_BILL_HD_SEQ_ID;v.getQueryForEstimate(y.preAuthDetailsGridOtions,e,a,y.patientDetails.regSeqId,y,!0,!0)}},n={buttonClose:function(){y.estimateSct=void 0}};d.hisAlertMulti("information",y.alertData.alertTypeInfo,a,i,r,n)}},l.serviceGridData(y,"limEnh",!1),y.changePriServ=function(e,t,a,i){S.getDepartment(y,e,t,a,i)},y.changeDept=function(e,t,a,i){S.getSpeciltyData(y,e,t,a,i)},y.serviceSearch=function(e,t){return S.getServiceList(t,e)},y.changeSpecialty=function(e,t){t.inActiveVal&&(t.service=void 0)},y.addRowGrid=function(t){let a={};if(a.priServGroup=t.entity.priServGroup,a.department=t.entity.department,a.specialty=t.entity.specialty,a.service=t.entity.service,a.valueAmt=t.entity.valueAmt,a.isAmtNlPercFlag=t.entity.isAmtNlPercFlag,a.qty=t.entity.qty,null!=a.priServGroup||null!=a.department||null!=a.specialty||null!=a.service&&""!=a.service){let i=!0;if(3!=a.isAmtNlPercFlag?i=null!=a.valueAmt&&""!==a.valueAmt||null!=a.qty&&""!==a.qty:3==a.isAmtNlPercFlag&&(i=!0),i&&3!=a.isAmtNlPercFlag&&(null!=a.valueAmt&&""!=a.valueAmt&&parseFloat(a.valueAmt)>0||null==a.valueAmt||""===a.valueAmt)&&(null!=a.qty&&""!=a.qty&&parseFloat(a.qty)>0||null==a.qty||""===a.qty)||3==a.isAmtNlPercFlag)if(i&&!t.entity.editable){S.validDuplicate(y,a)?(y.preAuthDetailsGridOtions.data.push(a),y.preAuthDetailsGridOtions.data[0]=[],y.clearRecordFirst(t),y.preAuthValue=S.calPreAuthAmt(y.preAuthDetailsGridOtions.data),y.preAuthForServ=angular.copy(y.preAuthValue)):d.hisAlertMulti("information",y.alertData.alertTypeInfo,"Already Same Record Exist(s), Kindly Update The Value.",e.alertData,e.alertFunction,e.close)}else t.entity.editable?(y.preAuthDetailsGridOtions.data[t.entity.recordIndex]=a,y.preAuthDetailsGridOtions.data[t.entity.recordIndex].deleteDisble=!1,e.toggleText="",y.preAuthDetailsGridOtions.data[0]=[],y.clearRecordFirst(t),y.preAuthValue=S.calPreAuthAmt(y.preAuthDetailsGridOtions.data),y.preAuthForServ=angular.copy(y.preAuthValue)):d.hisAlertMulti("information",y.alertData.alertTypeInfo,"Please Enter Amount or Qty.",e.alertData,e.alertFunction,e.close);else d.hisAlertMulti("information",y.alertData.alertTypeInfo,"Amount or Qty Can't be zero value",e.alertData,e.alertFunction,e.close)}else d.hisAlertMulti("information",y.alertData.alertTypeInfo,"Please Select Any Group or Service With Amount or Qty.",e.alertData,e.alertFunction,e.close)},y.editGridData=function(t,a){null!=y.prevoisIndex&&y.prevoisIndex!=a&&null!=y.preAuthDetailsGridOtions.data[y.prevoisIndex]&&(y.preAuthDetailsGridOtions.data[y.prevoisIndex].deleteDisble=!1),t.entity.deleteDisble=!0,y.prevoisIndex=a;let i={};i.priServGroup=t.entity.priServGroup,i.department=t.entity.department,i.specialty=t.entity.specialty,i.service=t.entity.service,i.valueAmt=t.entity.valueAmt,i.isAmtNlPercFlag=t.entity.isAmtNlPercFlag,i.qty=t.entity.qty,y.preAuthDetailsGridOtions.data[0]=i,y.preAuthDetailsGridOtions.data[0].editable=!0,y.preAuthDetailsGridOtions.data[0].recordIndex=a,e.toggleText="UPDATE",y.changePriServ(t.entity.priServGroup,y.preAuthDetailsGridOtions.data[0],t.entity,!0)},y.clearRecordFirst=function(t){null!=t&&t.entity.editable&&(y.preAuthDetailsGridOtions.data[t.entity.recordIndex].deleteDisble=!1,t.entity.editable=!1,e.toggleText=""),y.preAuthDetailsGridOtions.data[0]=[],y.preAuthDetailsGridOtions.data[0].isAmtNlPercFlag="1",y.preAuthDetailsGridOtions.data[0].valueAmt="",y.preAuthDetailsGridOtions.data[0].qty="",y.preAuthDetailsGridOtions.data[0].deleteDisble=!1,y.speciltyList=[],y.deptList=[]},y.deleteRecord=function(e,t){let a={buttonText:y.alertData.no,buttonText2:y.alertData.yes},i={buttonCallBack1:function(){},buttonCallBack2:function(){y.preAuthDetailsGridOtions.data.splice(t,1),y.preAuthValue=S.calPreAuthAmt(y.preAuthDetailsGridOtions.data),y.preAuthForServ=angular.copy(y.preAuthValue)}};d.hisAlertMulti("information",y.alertData.alertTypeInfo,"Do You Want To Delete The Record?",a,i,{buttonClose:function(){}})},y.getPreAuth=function(e){2==e?(y.preAuthValue=S.calPreAuthAmt(y.preAuthDetailsGridOtions.data),y.preAuthForServ=angular.copy(y.preAuthValue)):(y.preAuthForServ=void 0,y.preAuthValue=0,null!=y.estimateSct&&null!=y.estimateSct.APPROX_BILL_HD_SEQ_ID&&(y.preAuthDetailsGridOtions.data=[],y.clearRecordFirst(),y.estimateSct=void 0))},y.onSelected=function(e,t){S.getDropDownBasedService(e,t,y)},y.isChangedVal=function(e){null!=e&&""!=e&&"."!=e?null!=y.preAuthForServ&&parseFloat(e)<parseFloat(y.preAuthForServ)&&(y.preAuthValue=angular.copy(y.preAuthForServ)):y.preAuthValue=0},y.amountOrPercBlur=function(e){2==e.isAmtNlPercFlag&&null!=e.valueAmt&&null!=e.valueAmt&&""!=e.valueAmt&&parseFloat(e.valueAmt)>parseFloat(100)&&(e.valueAmt=100)},y.downloadFile=function(e){m.downloadDocument(e)},y.clear=function(){e.patBanShow=!1,y.isBillOrServiceFlag=2,y.preAuthDetailsGridOtions.data=[],y.clearRecordFirst(),y.filesUploaded=[],y.preAuthValue=0,e.remarks=void 0,y.estimateSct=void 0,y.patientId=void 0},y.update=function(){if("UPDATE"==e.toggleText||"UPDATE"==e.toggleTextPackage){var t=y.alertData.plzUpdteRcrd;d.hisAlertMulti("information",y.alertData.alertTypeInfo,t,e.alertData,e.alertFunction)}else if(null==y.preAuthValue||""==y.preAuthValue||null==y.preAuthValue||0==parseFloat(y.preAuthValue)){t="Pre Auth Value Can't Be Zero";d.hisAlertMulti("information",y.alertData.alertTypeInfo,t,e.alertData,e.alertFunction,e.close)}else{if(y.saveDataInput=[],y.serviceData=[],y.saveDataInput.push({bedClassSeqId:null==e.bedClassName?void 0:e.bedClassName,regSeqId:null!=y.patientDetailsSearch.regSeqId?y.patientDetailsSearch.regSeqId:y.patientDetails.regSeqId,patientcategorySeqId:null==y.patientDetailsSearch.patientcategorySeqId?691702168:y.patientDetailsSearch.patientcategorySeqId,remarks:y.remarks,approxHdSeqId:null==y.estimateSct||null==y.estimateSct?void 0:y.estimateSct.APPROX_BILL_HD_SEQ_ID,enAmnt:e.estimateCost,enBillNmbr:y.enhanceNum,approxBillDate:n("date")(new Date,"yyyy-MM-dd hh:mm:ss.s"),grossAmt:null!=y.preAuthValue&&null!=y.preAuthValue&&""!=y.preAuthValue?parseFloat(y.preAuthValue):0,approxBillHdSeqId:y.patientDetails.approxBillHdSeqId,subAccSeqId:null!=y.getAccSeqList[0]&&null!=y.getAccSeqList[0].SUB_ACC_SEQ_ID?y.getAccSeqList[0].SUB_ACC_SEQ_ID:void 0,isBillOrServeLevel:parseFloat(y.isBillOrServiceFlag),isCopayAvailable:void 0,copayValue:void 0,isDeductableAvailable:void 0,deductableValue:void 0}),2==y.isBillOrServiceFlag)for(var i=1;i<y.preAuthDetailsGridOtions.data.length;i++)y.serviceData.push({serviceCode:null!=y.preAuthDetailsGridOtions.data[i].service?y.preAuthDetailsGridOtions.data[i].service.SERV_CODE:void 0,serviceSeqId:null!=y.preAuthDetailsGridOtions.data[i].service&&null!=y.preAuthDetailsGridOtions.data[i].service.SERV_SEQ_ID?y.preAuthDetailsGridOtions.data[i].service.SERV_SEQ_ID:void 0,serviceName:null!=y.preAuthDetailsGridOtions.data[i].service?y.preAuthDetailsGridOtions.data[i].service.SERV_NAME:void 0,serviceRate:void 0,serviceQty:null!=y.preAuthDetailsGridOtions.data[i].qty&&""!=y.preAuthDetailsGridOtions.data[i].qty?parseFloat(y.preAuthDetailsGridOtions.data[i].qty):void 0,serviceTax:void 0,serviceDiscountAmt:void 0,chargeableAmt:null!=y.preAuthDetailsGridOtions.data[i].valueAmt&&""!=y.preAuthDetailsGridOtions.data[i].valueAmt&&3!=y.preAuthDetailsGridOtions.data[i].isAmtNlPercFlag?parseFloat(y.preAuthDetailsGridOtions.data[i].valueAmt):void 0,expcServDate:"9999-03-05 00:00:00.000",gnTranStatus:2,serviceType:null!=y.preAuthDetailsGridOtions.data[i].service&&null!=y.preAuthDetailsGridOtions.data[i].service.SERV_CODE?parseFloat(1):null!=y.preAuthDetailsGridOtions.data[i].specialty&&null!=y.preAuthDetailsGridOtions.data[i].specialty.CODE?parseFloat(2):null!=y.preAuthDetailsGridOtions.data[i].department&&null!=y.preAuthDetailsGridOtions.data[i].department.CODE?parseFloat(3):null!=y.preAuthDetailsGridOtions.data[i].priServGroup&&null!=y.preAuthDetailsGridOtions.data[i].priServGroup.CODE?parseFloat(4):void 0,isAmtPercNl:null!=y.preAuthDetailsGridOtions.data[i].isAmtNlPercFlag&&""!=y.preAuthDetailsGridOtions.data[i].isAmtNlPercFlag?parseFloat(y.preAuthDetailsGridOtions.data[i].isAmtNlPercFlag):void 0,primaryServCode:null!=y.preAuthDetailsGridOtions.data[i].priServGroup&&null!=y.preAuthDetailsGridOtions.data[i].priServGroup.CODE?y.preAuthDetailsGridOtions.data[i].priServGroup.CODE:void 0,deptCode:null!=y.preAuthDetailsGridOtions.data[i].department&&null!=y.preAuthDetailsGridOtions.data[i].department.CODE?y.preAuthDetailsGridOtions.data[i].department.CODE:void 0,specilityCode:null!=y.preAuthDetailsGridOtions.data[i].specialty&&null!=y.preAuthDetailsGridOtions.data[i].specialty.CODE?y.preAuthDetailsGridOtions.data[i].specialty.CODE:void 0});a.savePreAuthUpdate(y.saveDataInput[0],y.serviceData,[],[],[]).then(function(t){if(null!=t.data.HITService.message.approxBillVos&&null!=t.data.HITService.message.approxBillVos&&""!=t.data.HITService.message.approxBillVos){var a=t.data.HITService.message.approxBillVos;if(null!=a&&null!=a[0]&&null!=a[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxBillNo){y.saveDisable=!0;for(var i=0;i<y.filesUploaded.length;i++)y.filesUploaded[i].referenceId=a[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxHdSeqId,y.filesUploaded[i].prmryEntityId=a[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxHdSeqId;m.saveDocument(y).then(function(t){y.saveDisable=!1;var a={buttonText:y.alertData.ok},i={buttonCallBack1:function(){e.patientRecordsDetail.mrNo;o.go("index.billingSub.preAuthList",{id:e.patientRecordsDetail.mrNo})}},r={buttonClose:i.buttonCallBack1()},n=y.alertData.savdSucesFuly;d.hisAlertMulti("success",y.alertData.alertTypeSucss,n,a,i,r,2e3)})}}})}}}e.$inject=["$scope","hisTranslationsService","PreAuthUpdateServices","$stateParams","PatientBannerBilling","$filter","ServiceGet","hisCalDefConstant","$state","PatientBannerGlobal","hisAlertService","hisTranslationsGlobalLang","hisGenericAlertService","gridDefApproval","QueryService","CommonForServiceData","GetEstimateQuery"],angular.module("napierContainerUi").controller("preAuthLimitEnhCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g){i.loadModule("billing");var S=d.getLanguageToSet();i.changeLanguage(S);var v=this;v.alertData={},m.loadAlerts(S).then(function(t){v.alertData=t,e.alertData={buttonText:v.alertData.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}},function(e){}),e.newPreAuth=function(e){l.go("index.billingSub.preAuthNew")},e.updatePreAuth=function(t){var a=[];a.push(e.selectService),a.push(e.srchPatient),l.go("index.billingSub.preAuthUpdate",{id:JSON.stringify(a)}),r.path(t)},e.viewPreAuth=function(t){var a=[];a.push(e.selectService),a.push(v.srchPatient),l.go("index.billingSub.preAuthView",{id:JSON.stringify(a)})},e.preAuthApprovalDtls=function(t,a){var i=[];i.push(e.selectService),i.push(v.srchPatient),l.go("index.billingSub.preAuthApprovalDtls",{id:JSON.stringify(i)})},e.preAuthLimitEnh=function(t){var a=[];a.push(e.selectService),a.push(v.srchPatient),l.go("index.billingSub.preAuthLimitEnh",{id:JSON.stringify(a)})},e.roleValue=g.rolePermission("T_BL_PRE_AUTHORIZATION"),e.fromDateOptions={maxDate:new Date,startingDay:1},e.toDateOptions={minDate:new Date,startingDay:1},e.formDateChange=function(){e.fromDateOptions.maxDate=v.toDate},e.toDateChange=function(){e.toDateOptions.minDate=v.fromDate},e.formats=["dd-MMMM-yyyy","dd/MM/yyyy","dd.MM.yyyy","shortDate"],e.format=e.formats[1],e.altInputFormats=["M!/d!/yyyy"],e.expectedDateService=function(){e.popup2.opened=!0},e.toDateCAL=function(){e.popup1.opened=!0},e.popup2={opened:!1},e.popup1={opened:!1},e.toDateCAL(),c(function(){e.popup1.opened=!1},600),e.gridSearchResult=[],e.gridJSONWrapper={1:e.gridSearchResult},e.preAuthListSearch=function(i,r,l){if(null!==i&&""!==i&&void 0!==i||null!=r&&null!=r||null!=l)if(null!=i&&null!=i&&null!=r&&null!=r&&null==l){o=v.alertData.plzSlctToDate;p.hisAlertMulti("information",v.alertData.alertTypeInfo,o,e.alertData,e.alertFunction,e.close)}else if(null!=i&&null!=i&&null!=l&&null==r){o=v.alertData.plzSlctFromDate;p.hisAlertMulti("information",v.alertData.alertTypeInfo,o,e.alertData,e.alertFunction,e.close)}else if(null==i&&null==i&&null!=r&&null!=r&&null==l){o=v.alertData.plzSlctToDate;p.hisAlertMulti("information",v.alertData.alertTypeInfo,o,e.alertData,e.alertFunction,e.close)}else{var s={};s.url=n.HISIPINDENT.URL,s.requestData={operation:"getPreAuthDtls",messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillVo",mrNo:null==i||null==i?e.notReady:null==i.mrNo?""==i?e.notReady:i:i.mrNo,approxBillFromDate:null!=r?a("date")(r,"yyyy-MM-dd")+" 00:00:00.000":e.dontNeed,approxBillToDate:null!=l?a("date")(l,"yyyy-MM-dd")+" 11:59:59.000":e.dontNeed}},t.sendRestRequest(s).then(function(t){var a=t.data.HITService.message.approxBillsList[0]["com.napier.core.billgeneration.vo.ApproxBillVo"];if(e.gridOptions.data=[],null==a||null==a||" "==a){e.gridOptions.data=[],e.gridOptions.enableVerticalScrollbar=0;var i=v.alertData.noRcrdFound;p.hisAlertMulti("information",v.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.close)}else a instanceof Array?(e.gridOptions.data=a,e.gridOptions.data.length>5?e.gridOptions.enableVerticalScrollbar=1:e.gridOptions.enableVerticalScrollbar=0):(e.gridOptions.data.push(a),e.gridOptions.enableVerticalScrollbar=0)})}else{var o=v.alertData.patientIdSlct;p.hisAlertMulti("information",v.alertData.alertTypeInfo,o,e.alertData,e.alertFunction,e.close)}},e.searchPatient=function(t){if(t.length>0){var a=t;return o.patientSearchService(a,"getEstimatePatientServiceDetails").then(function(t){return e.patientResult=t.data.HITService.message.approxBillsList[0]["com.napier.core.billgeneration.vo.ApproxBillVo"],null!=e.patientResult?e.testVal=Array.isArray(e.patientResult)?e.patientResult:[e.patientResult]:e.testVal=null,e.testVal.map(function(e){return e})})}},e.gridOptions={enableRowSelection:!0,enableSelectAll:!1,enableSorting:!1,enableColumnMenus:!1,enableCellEdit:!1,enableRowHeaderSelection:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,multiSelect:!1,enableCellEditOnFocus:!1,enableFiltering:!1,columnDefs:[{name:"approxBillDate",displayName:"billing.dateofcreate",width:"14%",height:"15%",headerCellFilter:"translate",cellFilter:'date:"yyyy/MM/dd "',cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.approxBillDate.$|date:"dd/MM/yyyy"}}</div>'},{name:"approxBillNo",displayName:"billing.preAuthNumber",width:"14%",height:"15%",headerCellFilter:"translate"},{name:"payerName",displayName:"billing.payerName",width:"13%",height:"14%",headerCellFilter:"translate"},{name:"planName",displayName:"billing.planName",width:"13%",height:"15%",headerCellFilter:"translate"},{name:"StrIpNmbr",displayName:" billing.ipNum",width:"15%",height:"15%",headerCellFilter:"translate"},{name:"patientName",displayName:"billing.patientName ",width:"17%",height:"15%",headerCellFilter:"translate"},{name:"mobileNo",displayName:"billing.mobileNum",width:"17%",height:"15%",headerCellFilter:"translate"}]},e.disableButton=!1,e.gridOptions.onRegisterApi=function(t){e.grid=t,t.selection.on.rowSelectionChanged(e,function(t){t.isSelected;e.selectService=e.grid.selection.getSelectedRows(),e.countRowsRadio=e.grid.selection.getSelectedRows().length,1==e.countRowsRadio?e.disableButton=!0:e.disableButton=!1,null!=e.selectService[0].preauthRefSeqId&&null!=e.selectService[0].preauthRefSeqId?e.displayEnh=!0:e.displayEnh=!1})},e.clear=function(t,a,i){v.srchPatient=null,v.fromDate=null,v.toDate=null,e.disableButton=!1,e.gridOptions.data=[],e.gridOptions.enableVerticalScrollbar=0},null==s.id&&"id"==s.id||e.preAuthListSearch(s.id),v.billPrint=function(){var t={regSeqId:e.selectService[0].regSeqId,encSeqId:e.selectService[0].encSeqId,approxBillHdSeqId:e.selectService[0].approxBillHdSeqId,reportId:"CLAIM_FORM_TEMPLATE_PRE_AUTH"};u.printReportModal("printPreAuthController","lg","PDF",t)},v.claimFormPrint=function(){var t={regSeqId:e.selectService[0].regSeqId,encSeqId:e.selectService[0].encSeqId,reportId:"CLAIM_FORM_TEMPLATE"};u.printReportModal("printPreAuthController","lg","PDF",t)}}e.$inject=["$scope","CallManager","$filter","hisTranslationsService","$location","IPINDENTAPIS","$state","$stateParams","PatientSearch","$timeout","hisTranslationsGlobalLang","hisAlertService","PrintService","hisGenericAlertService","RoleTaskService"],angular.module("napierContainerUi").controller("preAuthListController",e),angular.module("napierContainerUi").controller("printPreAuthController",["returnObj","$uibModalInstance","selectedPrintType","QueryService","PrintService","$sce","$rootScope","$scope","CallManager","IPINDENTAPIS","APIS","$window",function(e,t,a,i,r,n,l,s,o,c,d,p){s.pageName="PRE AUTHORIZATION PRINT",s.cancel=function(){t.dismiss("cancel")},s.printParameterList=new Array,"CLAIM_FORM_TEMPLATE"==e.reportId||"CLAIM_FORM_TEMPLATE_PRE_AUTH"==e.reportId?(s.pageName="CLAIM_FORM_TEMPLATE"==e.reportId?"CLAIM FORM PRINT":"AUTHORIZATION PRINT",i.prepareParamList("pRgSeqId",e.regSeqId,s.printParameterList),i.prepareParamList("pEnSeqId",e.encSeqId?e.encSeqId:-999,s.printParameterList),"CLAIM_FORM_TEMPLATE_PRE_AUTH"==e.reportId&&i.prepareParamList("pPreAuthHDSeqId",e.approxBillHdSeqId,s.printParameterList)):i.prepareParamList("pBillNo",e.approxBillNo,s.printParameterList),s.printObject={},s.printObject.reportId=e.reportId,s.printObject.reportType={id:"PDF"==a?4:5,desc:a},s.printObject.paramsList=s.printParameterList,s.printObject.destination="reportingServiceImpl",r.printReportFunction(s.printObject,s)}])}(),function(){"use strict";angular.module("napierContainerUi").service("GetEstimateQuery",["QueryService","showEstDtlsPreAuth","CommonForServiceData",function(e,t,a){this.getQueryForEstimate=function(i,r,n,l,s,o,c,d,p){r.approxBillDtls=[],r.approxBillDtls2=[],r.approxBillDtls3=[],r.approxBillDtls4=[],r.multipleComboDataForListBill={1:r.approxBillDtls,2:r.approxBillDtls2,3:r.approxBillDtls3,4:r.approxBillDtls4};var u=e.executeQueryURLReset();r.approxBillDtlsList=new Array,null!=l?(e.prepareParamListWithParam("pRegSeqId",l,r.approxBillDtlsList),e.prepareParamListWithParam("pBillSeqId",n,r.approxBillDtlsList),e.executeQueryInput("NH_APPROX_DTLS_Q1",r.approxBillDtlsList,r.multipleComboDataForListBill,!0,!0,u,"popUp",r.serviceDetailsGridOtions).then(function(e){p||t.getPatientDetails(r,s,!1)})):(e.prepareParamList(1,n,r.approxBillDtlsList),e.executeQueryInput("GET_UNREG_PAT_BIL_DTLS",r.approxBillDtlsList,r.multipleComboDataForListBill,!0,!0,u,"popUp",r.serviceDetailsGridOtions).then(function(e){p||t.getPatientDetails(r,s,!0,d)})),r.multipleComboDataForListBill3={1:r.approxBillDtls3};var m=e.executeQueryURLReset();if(r.approxBillDtlsList3=new Array,e.prepareParamListWithParam("pEstimateHdSeqId",n,r.approxBillDtlsList3),e.executeQueryInput("GET_ESTIMATE_SERVICE_DETAILS",r.approxBillDtlsList3,r.multipleComboDataForListBill3,!0,!0,m,"popUp",{}).then(function(t){r.netAmount=0;for(let t=0;t<r.approxBillDtls3.length;t++){let a=e.getObjectByAnyValue(s.priServGroupList,r.approxBillDtls3[t].PRI_SERV_CODE,"CODE");s.preAuthDetailsGridOtions.data.push({isAmtNlPercFlag:r.approxBillDtls3[t].IS_AMT_PERC_NL_CODE+"",approxBillDtSeqId:r.approxBillDtls3[t].APPROX_BILL_DT_SEQ_ID,valueAmt:r.approxBillDtls3[t].CHARGEABLE_AMT,qty:r.approxBillDtls3[t].SERV_QTY,serviceAmt:r.approxBillDtls3[t].SERVICE_RATE,priServGroup:a,department:{DESCRIPTION:r.approxBillDtls3[t].DEPT_DESC,CODE:r.approxBillDtls3[t].DEPT_CODE},specialty:{DESCRIPTION:r.approxBillDtls3[t].SPL_DESC,CODE:r.approxBillDtls3[t].SPL_CODE},service:{SERV_NAME:r.approxBillDtls3[t].SERV_NAME,SERV_SEQ_ID:r.approxBillDtls3[t].SERV_SEQ_ID},status:r.approxBillDtls3[t].STATUS}),r.netAmount=r.netAmount+r.approxBillDtls3[t].CHARGEABLE_AMT}s.preAuthValue=a.calPreAuthAmt(s.preAuthDetailsGridOtions.data),s.preAuthForServ=angular.copy(s.preAuthValue)}),!p){r.diagnosisCombo=[],r.diagnosisDtlsList={1:r.diagnosisCombo};var g=e.executeQueryURLReset();r.diagnosisComboList=new Array,e.prepareParamList(1,n,r.diagnosisComboList),e.executeQueryInput("GET_EST_DIAG_DTLS",r.diagnosisComboList,r.diagnosisDtlsList,!0,!0,g,"popUp",r.serviceDetailsGridOtions).then(function(e){if(c){for(var t=[],a=0;a<r.diagnosisCombo.length;a++)t.push({StrDiagnosisCode:r.diagnosisCombo[a].CODE,StrDiagnosisName:r.diagnosisCombo[a].DIAG_NAME});s.dignsisModel=t}})}}}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o){var c=this;c.gridOptionsLimitEnh=angular.copy(t.gridOptionsServiceLimitEnhancement),c.gridOptionsLimitEnh.data=[],c.limitEnhtype=1,s.loadModule("billing");var d=o.getLanguageToSet();s.changeLanguage(d),l.loadAlerts(d).then(function(t){c.alertData=t,e.alertData={buttonText:c.alertData.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}}),a&&a.length>0&&angular.forEach(a,function(e,t){c.gridOptionsLimitEnh.data[t]=e}),c.gridOptionsLimitEnh.onRegisterApi=function(e){c.gridOptionsLimitEnhApi=e},c.onServiceSelect=function(){let t=c.gridOptionsLimitEnhApi.selection.getSelectedRows();if(0==t.length){n.hisAlertMulti("warning",c.alertData.alertTypeWarn,"Please select at least one service to create Enhancement",!1,!1,e.close,2e3)}else t.length>0&&r.close(t)},c.createEnhancement=function(){r.close([])}}e.$inject=["$scope","PreAuthConstants","service","submitStatus","$uibModalInstance","hisAlertService","hisGenericAlertService","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("limitEnhnmntCtrl",e)}(),function(){"use strict";angular.module("napierContainerUi").service("PreAuthApprovalServices",["CallManager","IPINDENTAPIS","QueryService","hisAlertService",function(e,t,a,i){this.preAuthApprovalInit=function(e){e.coInsGrid.data=[],e.coInsGrid.data[0]=[],e.coPayGrid.data=[],e.coPayGrid.data[0]=[],e.deleteDataCoPay=[],e.deleteDataCoIns=[]},this.preAuthApprovalOOPGridValidtion=function(e,t,a,r,n){let l={buttonClose:function(){}};if(null==e.value||null==e.value||""===e.value||parseFloat(0==e.value))return i.hisAlertMulti("information",n.alertData.alertTypeInfo,n.alertData.pleaseEnterCoPayCoInsValue,!1,!1,l,2e3),!1;if(null!=e.service&&null!=e.service&&""!==e.service&&null==e.service.SERV_SEQ_ID)return i.hisAlertMulti("information",n.alertData.alertTypeInfo,n.alertData.pleaseSelectService,!1,!1,l,2e3),!1;if(null==e.priServGroup&&null==e.department&&null==e.specialty&&null==e.service)return i.hisAlertMulti("information",n.alertData.alertTypeInfo,n.alertData.pleaseSelectService,!1,!1,l,2e3),!1;if("add"==a){let t=[];"coPay"==r?t=n.coPayGrid.data:"coIns"==r&&(t=n.coInsGrid.data);for(let a=1;a<t.length;a++){if((null==n.prevoisIndex||n.prevoisIndex!=a)&&null!=e.priServGroup&&null!=e.priServGroup.CODE&&null!=e.department&&null!=e.department.CODE&&null!=e.specialty&&null!=e.specialty.CODE&&null!=e.service&&null!=e.service.SERV_SEQ_ID&&null!=t[a].service&&null!=t[a].service.SERV_SEQ_ID&&t[a].service.SERV_SEQ_ID==e.service.SERV_SEQ_ID)return i.hisAlertMulti("information",n.alertData.alertTypeInfo,n.alertData.alreadySameRcrdExistUpdateValue,!1,!1,l,2e3),!1;if(!(null!=n.prevoisIndex&&n.prevoisIndex==a||null==e.priServGroup||null==e.priServGroup.CODE||null==e.department||null==e.department.CODE||null==e.specialty||null==e.specialty.CODE||null!=e.service&&null!=e.service.SERV_SEQ_ID||null==t[a].specialty||null==t[a].specialty.CODE||t[a].specialty.CODE!=e.specialty.CODE||null!=t[a].service&&null!=t[a].service.SERV_SEQ_ID))return i.hisAlertMulti("information",n.alertData.alertTypeInfo,n.alertData.alreadySameRcrdExistUpdateValue,!1,!1,l,2e3),!1;if(!(null!=n.prevoisIndex&&n.prevoisIndex==a||null==e.priServGroup||null==e.priServGroup.CODE||null==e.department||null==e.department.CODE||null!=e.specialty&&null!=e.specialty.CODE||null!=e.service&&null!=e.service.SERV_SEQ_ID||null!=t[a].specialty&&null!=t[a].specialty.CODE||null!=t[a].service&&null!=t[a].service.SERV_SEQ_ID||null==t[a].department||null==t[a].department.CODE||t[a].department.CODE!=e.department.CODE))return i.hisAlertMulti("information",n.alertData.alertTypeInfo,n.alertData.alreadySameRcrdExistUpdateValue,!1,!1,l,2e3),!1;if(!(null!=n.prevoisIndex&&n.prevoisIndex==a||null==e.priServGroup||null==e.priServGroup.CODE||null!=e.department&&null!=e.department.CODE||null!=e.specialty&&null!=e.specialty.CODE||null!=e.service&&null!=e.service.SERV_SEQ_ID||null!=t[a].specialty&&null!=t[a].specialty.CODE||null!=t[a].service&&null!=t[a].service.SERV_SEQ_ID||null!=t[a].department&&null!=t[a].department.CODE||null==t[a].priServGroup||null==t[a].priServGroup.CODE||t[a].priServGroup.CODE!=e.priServGroup.CODE))return i.hisAlertMulti("information",n.alertData.alertTypeInfo,n.alertData.alreadySameRcrdExistUpdateValue,!1,!1,l,2e3),!1}}if("add"==a)"coPay"==r?(e.deleteDisble&&null!=n.prevoisIndex?(e.deleteDisble=!1,n.coPayGrid.data[n.prevoisIndex]=e,n.prevoisIndex=void 0):n.coPayGrid.data.push(e),n.coPayGrid.data[0]=[]):"coIns"==r&&(e.deleteDisble&&null!=n.prevoisIndex?(e.deleteDisble=!1,n.coInsGrid.data[n.prevoisIndex]=e,n.prevoisIndex=void 0):n.coInsGrid.data.push(e),n.coInsGrid.data[0]=[]);else if("edit"==a){let a="";"coPay"==r?a="coPayGrid":"coIns"==r&&(a="coInsGrid"),null!=n.prevoisIndex&&n.prevoisIndex!=t&&null!=n[a].data[n.prevoisIndex]&&(n[a].data[n.prevoisIndex].deleteDisble=!1),e.deleteDisble=!0,n.prevoisIndex=t;let i={},l=_.find(n.priServGroupList,function(t){return t.CODE==e.priServGroup.CODE});i.priServGroup=l,i.department=e.department,i.specialty=e.specialty,i.service=e.service,i.value=e.value,i.deleteDisble=e.deleteDisble,n[a].data[0]=i,n[a].data[0].recordIndex=t,n.changePriServ(e.priServGroup,n[a].data[0],e,!0)}else"delete"==a&&(null!=e.pdcopaySeqId&&(e.gnStatus=2,"coPay"==r?n.deleteDataCoPay.push(e):"coIns"==r&&n.deleteDataCoIns.push(e)),"coPay"==r?n.coPayGrid.data.splice(t,1):"coIns"==r&&n.coInsGrid.data.splice(t,1))};var r=function(e,t,a){return null!=a&&null!=a&&""!==a?parseFloat(e)>parseFloat(t)?parseFloat(e)-parseFloat(t)+parseFloat(a):parseFloat(t)-parseFloat(e)+parseFloat(a):void 0};this.approvalSaveRequestPrepartion=function(e,t,a,i,n){let l=[],s=[],o=[];null!=e.delAuthApprovalGrid&&e.delAuthApprovalGrid.length>0&&(t=_.concat(t,e.delAuthApprovalGrid)),1==e.directApproval&&(e.preAuthDetailsGridOtions.data=[],e.preAuthDetailsGridOtions.data[0]={});for(let a=1;a<t.length;a++){t[a].ismaterial=null!=t[a].ismaterial&&null!=t[a].ismaterial&&""!==t[a].ismaterial?t[a].ismaterial:"N",null==t[a].serviceType&&(t[a].serviceType=null!=t[a].service&&null!=t[a].service.SERV_SEQ_ID?parseFloat(4):null!=t[a].specialty&&null!=t[a].specialty.CODE?parseFloat(3):null!=t[a].department&&null!=t[a].department.CODE?parseFloat(2):null!=t[a].priServGroup&&null!=t[a].priServGroup.CODE?parseFloat(1):void 0),o.push({preAuthBillAprDtSeqId:t[a].preAuthBillAprDtSeqId,primaryServCode:t[a].priServGroup.CODE,deptCode:null!=t[a].department&&null!=t[a].department.CODE?t[a].department.CODE:void 0,specilityCode:null!=t[a].specialty&&null!=t[a].specialty.CODE?t[a].specialty.CODE:void 0,serSeqId:null!=t[a].service&&null!=t[a].service.SERV_SEQ_ID?t[a].service.SERV_SEQ_ID:void 0,serQty:null!=t[a].qty&&null!=t[a].qty&&""!==t[a].qty?t[a].qty:void 0,actualRate:null!=t[a].valueAmt&&null!=t[a].valueAmt&&""!==t[a].valueAmt?t[a].valueAmt:void 0,isAmtPercNL:1,approvedDetails:parseInt(t[a].approvedDetails),approvedAmt:null!=t[a].approvedAmount&&null!=t[a].approvedAmount&&""!==t[a].approvedAmount?parseFloat(t[a].approvedAmount):void 0,approvedQty:null!=t[a].approvedQty&&null!=t[a].approvedQty&&""!==t[a].approvedQty?parseInt(t[a].approvedQty):void 0,serviceType:t[a].serviceType,isOrderFrom:t[a].isOrderFrom,gnStatus:null!=t[a].gnStatus?t[a].gnStatus:1,apprIsAmtPercNl:parseInt(t[a].apprIsAmtPercNl),servApprStatus:t[a].serviceApprovalStatus,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,isMaterial:null!=t[a].ismaterial&&null!=t[a].ismaterial&&""!==t[a].ismaterial?t[a].ismaterial:"N",applicabilityType:null!=t[a].applicabilityType&&null!=t[a].applicabilityType&&""!==t[a].applicabilityType?parseInt(t[a].applicabilityType.DT_CODE):void 0});for(let i=0;i<e.preAuthDetailsGridOtions.data.length;i++){let n=!1;if(e.preAuthDetailsGridOtions.data[i].serviceType==t[a].serviceType){if(4==e.preAuthDetailsGridOtions.data[i].serviceType&&null!=t[a].service&&null!=t[a].service.SERV_SEQ_ID&&null!=e.preAuthDetailsGridOtions.data[i].service&&null!=e.preAuthDetailsGridOtions.data[i].service.SERV_SEQ_ID&&e.preAuthDetailsGridOtions.data[i].service.SERV_SEQ_ID==t[a].service.SERV_SEQ_ID?n=!0:3==e.preAuthDetailsGridOtions.data[i].serviceType&&null!=t[a].specialty&&null!=t[a].specialty.CODE&&null!=e.preAuthDetailsGridOtions.data[i].specialty&&null!=e.preAuthDetailsGridOtions.data[i].specialty.CODE&&e.preAuthDetailsGridOtions.data[i].specialty.CODE==t[a].specialty.CODE?n=!0:2==e.preAuthDetailsGridOtions.data[i].serviceType&&null!=t[a].department&&null!=t[a].department.CODE&&null!=e.preAuthDetailsGridOtions.data[i].department&&null!=e.preAuthDetailsGridOtions.data[i].department.CODE&&e.preAuthDetailsGridOtions.data[i].department.CODE==t[a].department.CODE?n=!0:1==e.preAuthDetailsGridOtions.data[i].serviceType&&null!=t[a].priServGroup&&null!=t[a].priServGroup.CODE&&null!=e.preAuthDetailsGridOtions.data[i].priServGroup&&null!=e.preAuthDetailsGridOtions.data[i].priServGroup.CODE&&e.preAuthDetailsGridOtions.data[i].priServGroup.CODE==t[a].priServGroup.CODE&&(n=!0),n){e.preAuthDetailsGridOtions.data[i].qty=t[a].qty,e.preAuthDetailsGridOtions.data[i].valueAmt=t[a].valueAmt,e.preAuthDetailsGridOtions.data[i].applicabilityType=t[a].applicabilityType,3==t[a].apprIsAmtPercNl?(e.preAuthDetailsGridOtions.data[i].approvedDetails=parseInt(t[a].approvedDetails),e.preAuthDetailsGridOtions.data[i].approvedAmount=void 0):2==t[a].apprIsAmtPercNl?(e.preAuthDetailsGridOtions.data[i].approvedDetails=parseInt(t[a].approvedDetails),e.preAuthDetailsGridOtions.data[i].approvedAmount=t[a].approvedAmount):1==t[a].apprIsAmtPercNl&&(e.preAuthDetailsGridOtions.data[i].approvedDetails=parseInt(t[a].approvedDetails),e.preAuthDetailsGridOtions.data[i].approvedAmount=null!=e.preAuthDetailsGridOtions.data[i].approvedAmount&&null!=e.preAuthDetailsGridOtions.data[i].approvedAmount&&""!==e.preAuthDetailsGridOtions.data[i].approvedAmount?null!=t[a].previousApprovedAmount&&null!=t[a].previousApprovedAmount&&""!==t[a].previousApprovedAmount?r(t[a].previousApprovedAmount,e.preAuthDetailsGridOtions.data[i].approvedAmount,t[a].approvedAmount):null!=t[a].approvedAmount&&null!=t[a].approvedAmount&&""!==t[a].approvedAmount?parseFloat(e.preAuthDetailsGridOtions.data[i].approvedAmount)+parseFloat(t[a].approvedAmount):void 0:t[a].approvedAmount),e.preAuthDetailsGridOtions.data[i].apprIsAmtPercNl=parseFloat(t[a].apprIsAmtPercNl),e.preAuthDetailsGridOtions.data[i].approvedQty=null!=e.preAuthDetailsGridOtions.data[i].approvedQty&&null!=e.preAuthDetailsGridOtions.data[i].approvedQty&&""!==e.preAuthDetailsGridOtions.data[i].approvedQty?null!=t[a].previousApprovedQty&&null!=t[a].previousApprovedQty&&""!==t[a].previousApprovedQty?r(t[a].previousApprovedQty,e.preAuthDetailsGridOtions.data[i].approvedQty,t[a].approvedQty):null!=t[a].approvedQty&&null!=t[a].approvedQty&&""!==t[a].approvedQty?parseFloat(e.preAuthDetailsGridOtions.data[i].approvedQty)+parseFloat(t[a].approvedQty):void 0:t[a].approvedQty;break}if(!n&&e.preAuthDetailsGridOtions.data.length-1==i){e.preAuthDetailsGridOtions.data.push(t[a]);var c=e.preAuthDetailsGridOtions.data.length;e.preAuthDetailsGridOtions.data[c-1].qty=t[a].qty,e.preAuthDetailsGridOtions.data[c-1].valueAmt=t[a].valueAmt;break}}else if(!n&&e.preAuthDetailsGridOtions.data.length-1==i){e.preAuthDetailsGridOtions.data.push(t[a]);c=e.preAuthDetailsGridOtions.data.length;e.preAuthDetailsGridOtions.data[c-1].qty=t[a].qty,e.preAuthDetailsGridOtions.data[c-1].valueAmt=t[a].valueAmt;break}}}l.push({preAuthBillAprHdSeqId:a.addNewApp?void 0:null!=a.authApproval&&""!==a.authApproval&&null!=a.authApproval.PREAUTH_BILL_APR_SEQ_ID?a.authApproval.PREAUTH_BILL_APR_SEQ_ID:void 0,approvalNo:a.addNewApp?a.authApprovalNo:null!=a.authApproval&&""!==a.authApproval&&null!=a.authApproval.APPROVAL_NO?a.authApproval.APPROVAL_NO:"",approvalDate:a.authApprovalDate,totlApprovalAmt:null!=a.authApprovalAmt&&null!=a.authApprovalAmt&&""!==a.authApprovalAmt?parseFloat(a.authApprovalAmt):void 0,apprValidFrom:a.authApprovalVaildFrom,apprValidTo:a.authApprovalValidTo,gnStatus:1,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,billLevel:null!=e.authAprBillLevel&&1==e.authAprBillLevel?1:null!=a.authApproval&&null!=a.authApproval.PREAUTH_BILL_APR_SEQ_ID&&null!=e.authAprBillLevel&&0==e.authAprBillLevel?3:void 0,billLevelAmt:e.authAprBillLevel?parseFloat(e.authAprBillAmt):void 0,serviceLevel:null!=e.authAprServiceLevel&&1==e.authAprServiceLevel?2:null!=a.authApproval&&null!=a.authApproval.PREAUTH_BILL_APR_SEQ_ID&&null!=e.authAprServiceLevel&&0==e.authAprServiceLevel?3:void 0,preAuthApprovalDtlVoList:[{"com.napier.core.billgeneration.vo.PreAuthApprovalDtlVo":e.authAprServiceLevel?o:[]}]});let d=[];if(2==a.authCoPayLevel){i=_.concat(i,e.deleteDataCoPay);for(let e=1;e<i.length;e++)d.push({pdcopaySeqId:i[e].pdcopaySeqId,serSeqId:null!=i[e].service&&null!=i[e].service.SERV_SEQ_ID?i[e].service.SERV_SEQ_ID:void 0,priServSeqId:i[e].priServGroup.CODE,deptCode:null!=i[e].department&&null!=i[e].department.CODE?i[e].department.CODE:void 0,seplCode:null!=i[e].specialty&&null!=i[e].specialty.CODE?i[e].specialty.CODE:void 0,value:null!=i[e].value&&null!=i[e].value&&""!==i[e].value?parseFloat(i[e].value):void 0,isCopayOrCoinsurance:1,serviceHierarchyLevel:null!=i[e].service&&null!=i[e].service.SERV_SEQ_ID?4:null!=i[e].specialty&&null!=i[e].specialty.CODE?3:null!=i[e].department&&null!=i[e].department.CODE?2:1,gnStatus:1,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,editedBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,isMaterial:null!=i[e].IS_MATERIAL&&null!=i[e].IS_MATERIAL&&""!==i[e].IS_MATERIAL?i[e].IS_MATERIAL:"N"})}if(2==a.authCoInsLevel){n=_.concat(n,e.deleteDataCoIns);for(let e=1;e<n.length;e++)d.push({pdcopaySeqId:n[e].pdcopaySeqId,serSeqId:null!=n[e].service&&null!=n[e].service.SERV_SEQ_ID?n[e].service.SERV_SEQ_ID:void 0,priServSeqId:n[e].priServGroup.CODE,deptCode:null!=n[e].department&&null!=n[e].department.CODE?n[e].department.CODE:void 0,seplCode:null!=n[e].specialty&&null!=n[e].specialty.CODE?n[e].specialty.CODE:void 0,value:null!=n[e].value&&null!=n[e].value&&""!==n[e].value?parseFloat(n[e].value):void 0,isCopayOrCoinsurance:2,serviceHierarchyLevel:null!=n[e].service&&null!=n[e].service.SERV_SEQ_ID?4:null!=n[e].specialty&&null!=n[e].specialty.CODE?3:null!=n[e].department&&null!=n[e].department.CODE?2:1,gnStatus:1,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,editedBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,isMaterial:null!=n[e].IS_MATERIAL&&null!=n[e].IS_MATERIAL&&""!==n[e].IS_MATERIAL?n[e].IS_MATERIAL:"N"})}return s.push({hdCopaySeqId:a.hdCopaySeqId,copayType:parseInt(a.authCoPayApplicble),coinsuranceType:parseInt(a.authCoInsApplicable),copayIsServiceOrBillLevel:1==a.authCoPayApplicble?parseInt(a.authCoPayLevel):void 0,coinsuarnceIsServiceOrBillLevel:1==a.authCoInsApplicable?parseInt(a.authCoInsLevel):void 0,copayBillLevelAmount:1==a.authCoPayLevel&&1==a.authCoPayApplicble?parseFloat(a.authCoPayBillAmt):void 0,coinsuranceBillLevelAmount:1==a.authCoInsLevel&&1==a.authCoInsApplicable?parseFloat(a.authCoInsBillAmt):void 0,deductableAmount:null!=a.authAppDeductibleAmt&&null!=a.authAppDeductibleAmt&&""!==a.authAppDeductibleAmt?parseFloat(a.authAppDeductibleAmt):void 0,maxOutOfPocket:null!=a.authAppMaxOutPocket&&null!=a.authAppMaxOutPocket&&""!==a.authAppMaxOutPocket?parseFloat(a.authAppMaxOutPocket):void 0,gnStatus:1,gnMachineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,createdBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,editedBy:angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,preAuthOutOfPocketDtlVo:[{"com.napier.core.billgeneration.vo.PreAuthOutOfPocketDtlVo":d}]}),{approvalHeaderData:l,approvalOutOfPocketData:s}},this.getPreAuthApprovalHeaderData=function(e,t){e.preAuthApprovalHeaderList=[];let i={1:e.preAuthApprovalHeaderList},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pPreAuthHdSeqId",t,n),a.executeQueryInput("GET_PREAUTH_APPROVAL_HEADER_DTLS",n,i,!0,!0,r,"popUp",{})},this.getPreAuthApprovalServiceData=function(e,t){e.preAuthApprovalServiceData=[];let i={1:e.preAuthApprovalServiceData},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pPreAuthAprHdSeqId",t,n),a.executeQueryInput("GET_PREAUTH_APPROVAL_SERVICE_LEVEL_DTLS",n,i,!0,!0,r,"popUp",{})},this.validateAndAppendInGridApproval=function(e,t){e.authApprovalGrid.data=[],e.approvalFooterTotalAmt=0,e.requestFooterTotalAmt=0;for(let a=0;a<t.length;a++)e.authApprovalGrid.data.push({isAmtNlPercFlag:t[a].IS_AMT_PERC_NL_CODE,apprIsAmtPercNl:null!=t[a].APPR_IS_AMT_PERC_NL?t[a].APPR_IS_AMT_PERC_NL+"":"1",previousApprIsAmtPercNl:null!=t[a].APPR_IS_AMT_PERC_NL?t[a].APPR_IS_AMT_PERC_NL+"":"1",preAuthBillAprDtSeqId:t[a].PREAUTH_BILL_APR_DT_SEQ_ID,valueAmt:t[a].CHARGEABLE_AMT,ismaterial:t[a].IS_MATERIAL,qty:t[a].SERV_QTY,serviceApprovalStatus:t[a].SERV_APPR_STSTUS,isOrderFrom:t[a].IS_ORDER_FROM,serviceType:t[a].SERVICE_TYPE,priServGroup:{DESCRIPTION:t[a].PRI_SERV_DESC,CODE:t[a].PRI_SERV_CODE},department:{DESCRIPTION:t[a].DEPT_DESC,CODE:t[a].DEPT_CODE},specialty:{DESCRIPTION:t[a].SPL_DESC,CODE:t[a].SPL_CODE},service:{SERV_NAME:t[a].SERV_NAME,SERV_SEQ_ID:t[a].SERV_SEQ_ID},applicabilityType:{DETAIL_DESC:e.preAuthApprovalServiceData[a].APPLICABILITY_TYPE_DESC,DT_CODE:e.preAuthApprovalServiceData[a].APPLICABILITY_TYPE},approvedDetails:t[a].APPROVD_DTLS+"",approvedAmount:t[a].APPROVED_AMNT,approvedQty:t[a].APPROVED_QTY,previousApprovedAmount:t[a].APPROVED_AMNT,previousApprovedQty:t[a].APPROVED_QTY,remarks:t[a].APPROVE_REMARKS}),null==t[a].APPROVED_AMNT||null==t[a].APPROVED_AMNT||""===t[a].APPROVED_AMNT||1!=t[a].APPR_IS_AMT_PERC_NL||1!=t[a].APPROVD_DTLS&&2!=t[a].APPROVD_DTLS||(e.approvalFooterTotalAmt=e.approvalFooterTotalAmt+parseFloat(t[a].APPROVED_AMNT)),null!=t[a].CHARGEABLE_AMT&&null!=t[a].CHARGEABLE_AMT&&""!==t[a].CHARGEABLE_AMT&&(e.requestFooterTotalAmt=e.requestFooterTotalAmt+parseFloat(t[a].CHARGEABLE_AMT));this.calTotalViewApprovalAmt(e.authApprovalGrid.data,e.appr,e,0)},this.setApprovalHeaderData=function(e,t,a){e.fromOptions={},e.toOptions={},a.authApprovalDate=new Date(t.APPROVAL_DATE),a.authApprovalAmt=t.TOTAL_APPROVAL_AMOUNT,a.authApprovalAmtView=t.TOTAL_APPROVAL_AMOUNT,a.authApprovalVaildFrom=new Date(t.APPR_VALID_FROM),e.toOptions.minDate=new Date(t.APPR_VALID_FROM),a.authApprovalValidTo=new Date(t.APPR_VALID_TO),e.fromOptions.maxDate=new Date(t.APPR_VALID_TO),e.authAprServiceLevel=2==t.SERVICE_LEVEL,e.authAprBillLevel=1==t.BILL_LEVEL,e.authAprBillAmt=1==t.BILL_LEVEL?t.BILL_LEVEL_AMT:"",e.prevAuthAprBillAmt=1==t.BILL_LEVEL?t.BILL_LEVEL_AMT:void 0},this.getPreAuthOutOfPocketHeaderData=function(e,t){e.preAuthOutOfPocketHeaderData=[];let i={1:e.preAuthOutOfPocketHeaderData},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pPreAuthAprHdSeqId",t,n),a.executeQueryInput("GET_PREAUTH_OUT_OF_POCKET_HEADER_DTLS",n,i,!0,!0,r,"popUp",{})},this.getPreAuthOutOfPocketServiceData=function(e,t){e.preAuthOutOfPocketServiceData=[];let i={1:e.preAuthOutOfPocketServiceData},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pPreAuthCoPaySeqId",t,n),a.executeQueryInput("GET_PREAUTH_OUT_OF_POCKET_SERVICE_LEVEL_DTLS",n,i,!0,!0,r,"popUp",{})},this.validateAndAppendInGridOutOfPocket=function(e,t){e.coPayGrid.data=[],e.coInsGrid.data=[],(e.updateApproval||e.firstApproval)&&(e.coPayGrid.data[0]={},e.coInsGrid.data[0]={});for(let a=0;a<t.length;a++){let i={pdcopaySeqId:t[a].PDCOPAY_SEQ_ID,value:t[a].CHARGEABLE_AMT,serviceHierarchyLevel:t[a].SERVICE_HIERARCHY_LEVEL,isMaterial:t[a].IS_MATERIAL,priServGroup:null==t[a].PRI_SERV_CODE?void 0:{DESCRIPTION:t[a].PRI_SERV_DESC,CODE:t[a].PRI_SERV_CODE},department:null==t[a].DEPT_CODE?void 0:{DESCRIPTION:t[a].DEPT_DESC,CODE:t[a].DEPT_CODE},specialty:null==t[a].SEPL_CODE?void 0:{DESCRIPTION:t[a].SPL_DESC,CODE:t[a].SEPL_CODE},service:null==t[a].SERV_SEQ_ID?void 0:{SERV_NAME:t[a].SERV_NAME,SERV_SEQ_ID:t[a].SERV_SEQ_ID}};1==t[a].IS_COPAY_OR_COINSURANCE?e.coPayGrid.data.push(i):2==t[a].IS_COPAY_OR_COINSURANCE&&e.coInsGrid.data.push(i)}},this.setOutOfPocketHeaderData=function(e,t,a){a.authCoPayApplicble=t.COPAY_TYPE+"",a.authCoPayLevel=1==t.COPAY_TYPE?t.COPAY_IS_SERVICE_OR_BILL_LEVEL+"":"1",a.authCoPayBillAmt=t.COPAY_BILL_LEVEL_AMOUNT,a.hdCopaySeqId=t.PCOPAY_SEQ_ID,a.authCoInsApplicable=t.COINSURANCE_TYPE+"",a.authCoInsLevel="1",a.authCoInsBillAmt=t.COINSURNACE_BILL_LEVEL_AMOUNT,a.authAppDeductibleAmt=t.DEDUCATBLE_AMOUNT,a.authAppMaxOutPocket=t.MAX_OUT_OF_POCKET},this.approvalDetailsChangeCal=function(e){1==e.approvedDetails?(e.approvedQty=e.qty,e.approvedAmount=e.valueAmt,e.apprIsAmtPercNl="1",e.previousApprIsAmtPercNl="1"):2==e.approvedDetails?(e.approvedQty=void 0,e.approvedAmount=void 0,e.apprIsAmtPercNl="1",e.previousApprIsAmtPercNl="1"):3==e.approvedDetails?(e.approvedQty=void 0,e.approvedAmount=void 0,e.apprIsAmtPercNl="1",e.previousApprIsAmtPercNl="1"):4==e.approvedDetails&&(e.approvedQty=void 0,e.approvedAmount=void 0,e.apprIsAmtPercNl="1",e.previousApprIsAmtPercNl="1")},this.approvalValueTypeChangeCal=function(e,t){for(let a=0;a<t.preAuthDetailsGridOtions.data.length;a++){let r=!1;if(t.preAuthDetailsGridOtions.data[a].serviceType==e.serviceType&&(4==t.preAuthDetailsGridOtions.data[a].serviceType&&null!=e.service&&null!=e.service.SERV_SEQ_ID&&null!=t.preAuthDetailsGridOtions.data[a].service&&null!=t.preAuthDetailsGridOtions.data[a].service.SERV_SEQ_ID&&t.preAuthDetailsGridOtions.data[a].service.SERV_SEQ_ID==e.service.SERV_SEQ_ID?r=!0:3==t.preAuthDetailsGridOtions.data[a].serviceType&&null!=e.specialty&&null!=e.specialty.CODE&&null!=t.preAuthDetailsGridOtions.data[a].specialty&&null!=t.preAuthDetailsGridOtions.data[a].specialty.CODE&&t.preAuthDetailsGridOtions.data[a].specialty.CODE==e.specialty.CODE?r=!0:2==t.preAuthDetailsGridOtions.data[a].serviceType&&null!=e.department&&null!=e.department.CODE&&null!=t.preAuthDetailsGridOtions.data[a].department&&null!=t.preAuthDetailsGridOtions.data[a].department.CODE&&t.preAuthDetailsGridOtions.data[a].department.CODE==e.department.CODE?r=!0:1==t.preAuthDetailsGridOtions.data[a].serviceType&&null!=e.priServGroup&&null!=e.priServGroup.CODE&&null!=t.preAuthDetailsGridOtions.data[a].priServGroup&&null!=t.preAuthDetailsGridOtions.data[a].priServGroup.CODE&&t.preAuthDetailsGridOtions.data[a].priServGroup.CODE==e.priServGroup.CODE&&(r=!0),r)){if(3==e.apprIsAmtPercNl&&null!=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl&&3!=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl){let a={buttonText:t.alertData.no,buttonText2:t.alertData.yes},r={buttonCallBack1:function(){e.apprIsAmtPercNl=e.previousApprIsAmtPercNl+"",e.approvedAmount=null!=e.previousapprovedAmount&&3!=e.apprIsAmtPercNl?e.previousapprovedAmount:void 0,e.approvedQty=null!=e.previousapprovedQty&&3!=e.apprIsAmtPercNl?e.previousapprovedQty:void 0},buttonCallBack2:function(){e.previousApprIsAmtPercNl=angular.copy(e.apprIsAmtPercNl)}},n={buttonClose:function(){e.apprIsAmtPercNl=e.previousApprIsAmtPercNl+"",e.approvedAmount=null!=e.previousapprovedAmount&&3!=e.apprIsAmtPercNl?e.previousapprovedAmount:void 0,e.approvedQty=null!=e.previousapprovedQty&&3!=e.apprIsAmtPercNl?e.previousapprovedQty:void 0}};i.hisAlertMulti("information",t.alertData.alertTypeInfo,t.alertData.NlWillOvridePrevApprl,a,r,n),e.previousapprovedAmount=null!=e.approvedAmount?e.approvedAmount:void 0,e.previousapprovedQty=null!=e.approvedQty?e.approvedQty:void 0;break}if(2==e.apprIsAmtPercNl&&null!=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl&&(2!=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl||2==t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl)){let r,n={buttonText:t.alertData.no,buttonText2:t.alertData.yes},l={buttonCallBack1:function(){2!=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl?e.apprIsAmtPercNl==e.previousApprIsAmtPercNl?e.approvedAmount=void 0:(e.apprIsAmtPercNl=e.previousApprIsAmtPercNl+"",e.approvedAmount=null!=e.previousapprovedAmount&&3!=e.apprIsAmtPercNl?e.previousapprovedAmount:void 0):e.previousApprIsAmtPercNl=angular.copy(e.apprIsAmtPercNl)},buttonCallBack2:function(){e.previousApprIsAmtPercNl=angular.copy(e.apprIsAmtPercNl)}},s={buttonClose:function(){2!=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl?e.apprIsAmtPercNl==e.previousApprIsAmtPercNl?e.approvedAmount=void 0:(e.apprIsAmtPercNl=e.previousApprIsAmtPercNl+"",e.approvedAmount=null!=e.previousapprovedAmount&&3!=e.apprIsAmtPercNl?e.previousapprovedAmount:void 0):e.previousApprIsAmtPercNl=angular.copy(e.apprIsAmtPercNl)}};1==t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl||3==t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl?r=t.alertData.percentageOvrideAppTotal:2==t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl&&null!=t.preAuthDetailsGridOtions.data[a].approvedAmount&&""!==t.preAuthDetailsGridOtions.data[a].approvedAmount&&null!=e.approvedAmount&&""!==e.approvedAmount&&t.preAuthDetailsGridOtions.data[a].approvedAmount!=e.approvedAmount&&(n={buttonText:t.alertData.ok},r=t.alertData.precntageNotMacthingWithCuurentPercntage),r?(i.hisAlertMulti("information",t.alertData.alertTypeInfo,r,n,l,s),e.previousapprovedAmount=null!=e.approvedAmount?e.approvedAmount:void 0):(e.previousApprIsAmtPercNl=e.apprIsAmtPercNl,e.previousapprovedAmount=null!=e.approvedAmount?e.approvedAmount:void 0);break}if(1==e.apprIsAmtPercNl&&null!=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl&&1!=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl){let r,n={buttonText:t.alertData.no,buttonText2:t.alertData.yes},l={buttonCallBack1:function(){e.previousApprIsAmtPercNl==e.apprIsAmtPercNl&&null!=e.appflow?(e.appflow=void 0,e.apprIsAmtPercNl=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl+"",e.previousApprIsAmtPercNl=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl+"",e.approvedAmount=null!=e.previousapprovedAmount&&3!=e.apprIsAmtPercNl?e.previousapprovedAmount:void 0):e.previousApprIsAmtPercNl==e.apprIsAmtPercNl&&null==e.appflow?e.approvedAmount=void 0:(e.apprIsAmtPercNl=e.previousApprIsAmtPercNl+"",e.approvedAmount=null!=e.previousapprovedAmount&&3!=e.apprIsAmtPercNl?e.previousapprovedAmount:void 0,e.appflow=void 0)},buttonCallBack2:function(){e.previousApprIsAmtPercNl!=e.apprIsAmtPercNl&&(e.previousApprIsAmtPercNl=angular.copy(e.apprIsAmtPercNl),e.approvedAmount=void 0,e.appflow=void 0)}},s={buttonClose:function(){e.previousApprIsAmtPercNl==e.apprIsAmtPercNl&&null!=e.appflow?(e.appflow=void 0,e.apprIsAmtPercNl=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl+"",e.previousApprIsAmtPercNl=t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl+"",e.approvedAmount=null!=e.previousapprovedAmount&&3!=e.apprIsAmtPercNl?e.previousapprovedAmount:void 0):e.previousApprIsAmtPercNl==e.apprIsAmtPercNl&&null==e.appflow?e.approvedAmount=void 0:(e.apprIsAmtPercNl=e.previousApprIsAmtPercNl+"",e.approvedAmount=null!=e.previousapprovedAmount&&3!=e.apprIsAmtPercNl?e.previousapprovedAmount:void 0,e.appflow=void 0)}};3==t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl?r=t.alertData.enterAmtPercntageWillOverrideDoYouWannContinue:2==t.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl&&(r=t.alertData.enterAmtNLWillOverrideDoYouWannContinue),r&&i.hisAlertMulti("information",t.alertData.alertTypeInfo,r,n,l,s);break}e.previousapprovedAmount=null!=e.approvedAmount?e.approvedAmount:void 0,e.approvedAmount=e.previousApprIsAmtPercNl==e.apprIsAmtPercNl?e.approvedAmount:void 0,e.previousApprIsAmtPercNl=e.apprIsAmtPercNl}}},this.approvalAmtChangeCal=function(e,t){2==e.apprIsAmtPercNl&&null!=e.approvedAmount&&""!==e.approvedAmount&&parseFloat(e.approvedAmount)>100&&(e.approvedAmount=100),null!=e.approvedAmount&&""!==e.approvedAmount&&0==parseFloat(e.approvedAmount)&&(e.approvedAmount=void 0)},this.approvalValidationCheck=function(e,t){e.alertData.no,e.alertData.yes;let a={buttonClose:function(){}};if(null!=e.appr){if(e.appr.addNewApp&&(null==e.appr.authApprovalNo||null==e.appr.authApprovalNo||""===e.appr.authApprovalNo))return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzFilMandFild,!1,!1,a,2e3),!1;if(e.appr.addNewApp&&null!=e.appr.authApprovalNo&&null!=e.appr.authApprovalNo&&""!==e.appr.authApprovalNo&&null!=e.preAuthApprovalHeaderList&&e.preAuthApprovalHeaderList.length>0)for(let t=0;t<e.preAuthApprovalHeaderList.length;t++)if(e.preAuthApprovalHeaderList[t].APPROVAL_NO==e.appr.authApprovalNo)return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.AuthApprvlNoAlrdyExstTryAnthrNo,!1,!1,a,2e3),!1;if(!e.appr.addNewApp&&(null==e.appr.authApproval||null==e.appr.authApproval||""===e.appr.authApproval||null==e.appr.authApproval.APPROVAL_NO))return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzFilMandFild,!1,!1,a,2e3),!1;if(null==e.appr.authApprovalDate||null==e.appr.authApprovalDate||""===e.appr.authApprovalDate)return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzFilMandFild,!1,!1,a,2e3),!1;if(null==e.appr.authApprovalAmt||null==e.appr.authApprovalAmt||""===e.appr.authApprovalAmt)return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzFilMandFild,!1,!1,a,2e3),!1;if(null==e.appr.authApprovalVaildFrom||null==e.appr.authApprovalVaildFrom||""===e.appr.authApprovalVaildFrom)return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzFilMandFild,!1,!1,a,2e3),!1;if(null==e.appr.authApprovalValidTo||null==e.appr.authApprovalValidTo||""===e.appr.authApprovalValidTo)return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzFilMandFild,!1,!1,a,2e3),!1;if(e.authAprBillLevel&&(null==e.authAprBillAmt||null==e.authAprBillAmt||""===e.authAprBillAmt))return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzFillBillAppAmt,!1,!1,a,2e3),!1;if(e.authAprBillLevel&&0==e.authAprBillAmt)return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.appBillAmtCantZero,!1,!1,a,2e3),!1;if(e.authAprServiceLevel){if(null==e.authApprovalGrid.data||0==e.authApprovalGrid.data.length)return i.hisAlertMulti("information",e.alertData.alertTypeInfo,"Required Service Details!",!1,!1,a,2e3),!1;if(e.authApprovalGrid.data.length>0)for(let t=1;t<e.authApprovalGrid.data.length;t++){if(null==e.authApprovalGrid.data[t].approvedDetails||null==e.authApprovalGrid.data[t].approvedDetails||""===e.authApprovalGrid.data[t].approvedDetails)return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzSlctAppDetails,!1,!1,a,2e3),!1;if(1==e.authApprovalGrid.data[t].approvedDetails||2==e.authApprovalGrid.data[t].approvedDetails){if(!(null==e.authApprovalGrid.data[t].qty&&null==e.authApprovalGrid.data[t].valueAmt||null==e.authApprovalGrid.data[t].apprIsAmtPercNl||3==e.authApprovalGrid.data[t].apprIsAmtPercNl||null!=e.authApprovalGrid.data[t].approvedQty&&null!=e.authApprovalGrid.data[t].approvedQty&&""!==e.authApprovalGrid.data[t].approvedQty||null!=e.authApprovalGrid.data[t].approvedAmount&&null!=e.authApprovalGrid.data[t].approvedAmount&&""!==e.authApprovalGrid.data[t].approvedAmount))return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzEnterAppAmtQty,!1,!1,a,2e3),!1;if((null!=e.authApprovalGrid.data[t].qty||null!=e.authApprovalGrid.data[t].valueAmt)&&0==e.authApprovalGrid.data[t].approvedQty&&0==e.authApprovalGrid.data[t].approvedAmount)return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.appAmtQtyCantBeZero,!1,!1,a,2e3),!1}}}if(1==e.appr.authCoPayApplicble){if(null==e.appr.authCoPayLevel||null==e.appr.authCoPayLevel||""===e.appr.authCoPayLevel)return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzSlctLvlCoPayCoInsBillLvlSerLvl,!1,!1,a,2e3),!1;if(1==e.appr.authCoPayLevel&&(null==e.appr.authCoPayBillAmt||null==e.appr.authCoPayBillAmt||""===e.appr.authCoPayBillAmt))return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzFillCoPayCoInsBillLvlAmt,!1,!1,a,2e3),!1;if(2==e.appr.authCoPayLevel&&(null==e.coPayGrid.data||0==e.coPayGrid.data.length))return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzAddRcrdSrviceLvlGrdCoPayCoIns,!1,!1,a,2e3),!1}if(1==e.appr.authCoInsApplicable){if(null==e.appr.authCoInsLevel||null==e.appr.authCoInsLevel||""===e.appr.authCoInsLevel)return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzSlctLvlCoPayCoInsBillLvlSerLvl,!1,!1,a,2e3),!1;if(1==e.appr.authCoInsLevel&&(null==e.appr.authCoInsBillAmt||null==e.appr.authCoInsBillAmt||""===e.appr.authCoInsBillAmt))return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzFillCoPayCoInsBillLvlAmt,!1,!1,a,2e3),!1;if(2==e.appr.authCoInsLevel&&(null==e.coInsGrid.data||0==e.coInsGrid.data.length))return i.hisAlertMulti("information",e.alertData.alertTypeInfo,e.alertData.plzAddRcrdSrviceLvlGrdCoPayCoIns,!1,!1,a,2e3),!1}return!0}if(null==e.appr)return!1},this.calTotalApprovalAmt=function(e,t,a){!a.authAprBillLevel&&a.authAprServiceLevel&&(t.authApprovalAmt=0),a.approvalFooterTotalAmt=0;for(let i=1;i<e.length;i++)null==e[i].approvedDetails||1!=e[i].approvedDetails&&2!=e[i].approvedDetails||1!=e[i].apprIsAmtPercNl||null==e[i].approvedAmount||null==e[i].approvedAmount||""===e[i].approvedAmount||(!a.authAprBillLevel&&a.authAprServiceLevel&&(t.authApprovalAmt=t.authApprovalAmt+parseFloat(e[i].approvedAmount)),a.approvalFooterTotalAmt=a.approvalFooterTotalAmt+parseFloat(e[i].approvedAmount))},this.calTotalViewApprovalAmt=function(e,t,a,i){let r=!1,n=!1,l=void 0!==i?i:1;for(!a.authAprBillLevel&&a.authAprServiceLevel&&(t.authApprovalAmtView=0);l<e.length;l++)null==e[l].approvedDetails||1!=e[l].approvedDetails&&2!=e[l].approvedDetails||1!=e[l].apprIsAmtPercNl||null==e[l].approvedAmount||null==e[l].approvedAmount||""===e[l].approvedAmount?null==e[l].approvedDetails||1!=e[l].approvedDetails&&2!=e[l].approvedDetails||2!=e[l].apprIsAmtPercNl||null==e[l].approvedAmount||null==e[l].approvedAmount||""===e[l].approvedAmount?null==e[l].approvedDetails||1!=e[l].approvedDetails&&2!=e[l].approvedDetails||3!=e[l].apprIsAmtPercNl||!a.authAprBillLevel&&a.authAprServiceLevel&&(n=!0):!a.authAprBillLevel&&a.authAprServiceLevel&&(r=!0):!a.authAprBillLevel&&a.authAprServiceLevel&&(t.authApprovalAmtView=t.authApprovalAmtView+parseFloat(e[l].approvedAmount));0==t.authApprovalAmtView?r?(t.authApprovalAmtView="%",n&&(t.authApprovalAmtView=t.authApprovalAmtView+" + NL")):n&&(t.authApprovalAmtView="NL"):0!==t.authApprovalAmtView&&(r?(t.authApprovalAmtView=t.authApprovalAmtView+" + %",n&&(t.authApprovalAmtView=t.authApprovalAmtView+" + NL")):n&&(t.authApprovalAmtView=t.authApprovalAmtView+" + NL"))}}])}(),function(){"use strict";angular.module("napierContainerUi").service("PreAuthConstants",["PreAuthService","uiGridConstants",function(e,t){this.loadServiceLevelGrid=function(t,a,i){e.commonServiceOnLoad(t),t.preAuthDetailsGridOtions={enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!1,showGridFooter:!0,showColumnFooter:!1,multiSelect:!1,enableSelectAll:!1,enableSorting:!1,enableVerticalScrollbar:2,gridFooterTemplate:'<div style="text-align: center;background-color: #d9e2f1;color: #6a6d72;font-weight: 600;padding-top: 4px;padding-bottom: 8px;"><span ng-class="{ \'viewmode\':(grid.appScope.preNew.approvalActive), \'editmode\' :(!grid.appScope.preNew.approvalActive)}" >Requested Amt: <span style="font-weight: bolder;">{{grid.appScope.preNew.requestScrFooterTotalAmt}}</span></span></div>',columnDefs:[{name:"status",displayName:" ",category:"Item",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,pinnedLeft:!0,visible:!0,headerCellFilter:"translate",width:"4",cellTemplate:'<div class="ui-grid-cell-contents grid-actions" ng-if="rowRenderIndex!=0||grid.appScope.'+a+".approvalActive\" ng-class=\"{'routinePriority':row.entity.manualFlag , 'asapPriority' :!row.entity.manualFlag}\"></div>"},{field:"priServGroup",displayName:"billing.psGroup",headerCellFilter:"translate",width:120,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&!grid.appScope.'+a+'.approvalActive"><div class="form-group grid-input pre-auth-grid-input"><select class="form-control" ng-model="row.entity.priServGroup" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+a+'.priServGroupList" ng-change="grid.appScope.'+a+'.changePriServ(row.entity.priServGroup,row.entity);"><option value="" selected>Select</option></select></div></div><div ng-if="rowRenderIndex!=0||grid.appScope.'+a+'.approvalActive">{{row.entity.priServGroup.DESCRIPTION}}</div></div>'},{field:"department",displayName:"billing.department",headerCellFilter:"translate",width:125,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&!grid.appScope.'+a+'.approvalActive"><div class="form-group grid-input pre-auth-grid-input"><select class="form-control" ng-model="row.entity.department" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+a+'.deptList" ng-change="grid.appScope.'+a+'.changeDept(row.entity.priServGroup,row.entity.department,row.entity);"><option value="" selected>Select </option></select></div></div><div ng-if="rowRenderIndex!=0||grid.appScope.'+a+'.approvalActive">{{row.entity.department.DESCRIPTION}}</div></div>'},{field:"specialty",displayName:"billing.speciality",headerCellFilter:"translate",width:125,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&!grid.appScope.'+a+'.approvalActive"><div class="form-group grid-input pre-auth-grid-input"><select class="form-control" ng-model="row.entity.specialty" ng-click="row.entity.inActiveVal = true;" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+a+'.speciltyList" ng-change="grid.appScope.'+a+'.changeSpecialty(row.entity.specialty,row.entity);"><option value="" selected>Select </option></select></div></div><div ng-if="rowRenderIndex!=0||grid.appScope.'+a+'.approvalActive">{{row.entity.specialty.DESCRIPTION}}</div></div>'},{field:"service",displayName:"billing.service",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&!grid.appScope.'+a+'.approvalActive"><div class="form-group grid-input pre-auth-grid-input watermark-addon"><div class="input-group"><input type="text" class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.service" placeholder="Enter" uib-typeahead="item as item.SERV_NAME+\' - \'+item.SPL_DESC for item in grid.appScope.'+a+'.serviceSearch($viewValue,row.entity)" style="" typeahead-on-select="grid.appScope.'+a+'.onSelected($item,row.entity);" typeahead-append-to-body=true ><span class="input-group-addon" style="position: relative; top: -4px;"><i class="fa fa-search"></i></span></div></div></div><div ng-if="rowRenderIndex!=0||grid.appScope.'+a+'.approvalActive">{{row.entity.service.SERV_NAME}}</div></div>'},{field:"qty",displayName:"billing.qty",headerCellFilter:"translate",width:50,cellTemplate:'<div class="ui-grid-cell-contents "><div ng-if="rowRenderIndex==0&&!grid.appScope.'+a+'.approvalActive"><div class="form-group grid-input pre-auth-grid-input"><input type="text"  class="form-control" ng-change="(!grid.appScope.'+a+".generatePreAuthFlag)?grid.appScope."+a+'.changeAmount(row.entity,rowRenderIndex):\'\'" numbers-only maxlength="3" ng-model="MODEL_COL_FIELD" ng-disabled="(!row.entity.service.SERV_SEQ_ID && grid.appScope.'+a+'.estimate)"></div></div><div ng-if="grid.appScope.'+a+'.approvalActive||rowRenderIndex!=0">{{row.entity.qty}}</div></div>'},{field:"valueAmt",displayName:"billing.amt",headerCellFilter:"translate",width:110,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><span ng-if="grid.appScope.'+a+'.approvalActive||rowRenderIndex!=0">{{row.entity.valueAmt}}</span><input type="text" ng-if="rowRenderIndex==0&&!grid.appScope.'+a+'.approvalActive" ng-model="row.entity.valueAmt" class="form-control" style="width:47% !important;float:left;" maxlength="15" number-with-decimal></div>'},{field:"applicabilityType",displayName:"billing.applicable",headerCellFilter:"translate",width:70,cellTemplate:'<div class="ui-grid-cell-contents action-row"><div class="" ng-if="rowRenderIndex==0&&!grid.appScope.'+a+'.approvalActive"><select class="form-control" ng-model="row.entity.applicabilityType" ng-options="item as item.DETAIL_DESC for item in grid.appScope.preNew.applicabilityList" ng-init="row.entity.applicabilityType=grid.appScope.preNew.applicabilityList[0]"></select></div><div ng-if="grid.appScope.'+a+'.approvalActive||rowRenderIndex!=0">{{row.entity.applicabilityType.DETAIL_DESC}}</div></div>'},{field:"approvedQty",displayName:"billing.appQty",headerCellFilter:"translate",width:50,visible:!1},{field:"approvedDetails",displayName:"billing.appDetails",headerCellFilter:"translate",visible:!1,width:85,cellTemplate:'<div class="ui-grid-cell-contents"><div><span>{{row.entity.approvedAmount}} {{row.entity.apprIsAmtPercNl==2&&row.entity.approvedAmount !==undefined?"%":row.entity.apprIsAmtPercNl==3?"NL":""}}</span></div></div>'},{field:"inclDetails",displayName:"billing.inculdedWithSymbol",headerCellFilter:"translate",width:75,cellTemplate:'<div class="ui-grid-cell-contents action-row" style="text-align: center;"><span ng-show="rowRenderIndex==0&&!grid.appScope.'+a+'.approvalActive">--</span><span ng-if="grid.appScope.'+a+'.approvalActive||rowRenderIndex!=0"><i class="fa fa-times" ng-show="row.entity.isApprovalRequired==3"></i><i class="fa fa-check" ng-show="row.entity.isApprovalRequired==2"></i><img src="assets/stamp.png" aria-hidden="true" ng-show="row.entity.isApprovalRequired==1"></span></div>'},{field:"actions",displayName:"billing.actions",headerCellFilter:"translate",width:90,cellTemplate:'<div class="ui-grid-cell-contents" ng-class="{\'disabled-section\':(grid.appScope.preNew.approvalActive)}"><div ng-if="!row.entity.preAuthApp && row.entity.CONSUMABLE_AMOUNT==undefined && row.entity.CONSUMABLE_QTY==undefined"><div ng-if="rowRenderIndex==0" ><button class="his-btn his-btn-info his-grid-btn" style="position: relative; top: -4px;" ng-click="grid.appScope.'+a+'.addRowGrid(row)" ng-disabled="!grid.appScope.'+a+'.isServiceLevelFlag"><i class="fa fa-plus"> Add</i></button>&nbsp;<i class="fa fa-eraser"  ng-click="grid.appScope.'+a+'.clearRecordFirst(row,false)"></i></div><div ng-if="rowRenderIndex!=0" class=" action-row"><i class="fa fa-pencil" ng-click="grid.appScope.'+a+'.editGridData(row,rowRenderIndex)"></i><i class="fa fa-trash" ng-click="grid.appScope.'+a+'.deleteRecord(row,rowRenderIndex)" ng-if="!row.entity.deleteDisble"></i></div></div></div>'}]},t.preAuthDetailsGridOtions.data=[],t.preAuthDetailsGridOtions.data[0]=[]},this.gridOptionsDiagnosis={enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!1,multiSelect:!1,enableSelectAll:!1,enableVerticalScrollbar:2,columnDefs:[{field:"standardICD",displayName:"billing.standardIcd",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents action-row"><span ng-if="!row.entity.ICDCODE">--</span><span ng-if="row.entity.ICDCODE">{{row.entity.ICDCODE}}-{{row.entity.DESCRIPTION}}</span></div>'},{field:"hosDefined",displayName:"billing.hospDef",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents action-row"><span ng-if="!row.entity.HOSP_DIAG_CODE">--</span><span ng-if="row.entity.HOSP_DIAG_CODE">{{row.entity.HOSP_DIAG_CODE}}-{{row.entity.HOSP_DIAG_DESC}}</span></div>'},{field:"actions",displayName:"billing.actions",headerCellFilter:"translate",width:70,cellTemplate:'<div class="ui-grid-cell-contents action-row"><i class="fa fa-trash" ng-click="grid.appScope.preNew.deleteDiagnosis(rowRenderIndex)"></i></div>'}]},this.gridOptionsProcedure={enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!1,multiSelect:!1,enableSelectAll:!1,enableVerticalScrollbar:2,columnDefs:[{field:"standardICD",displayName:"billing.standardIcd",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents action-row"><span ng-if="!row.entity.ICD9">--</span><span ng-if="row.entity.ICD9">{{row.entity.CODE}}-{{row.entity.DESCRIPTION}}</span></div>'},{field:"hosDefined",displayName:"billing.hospDef",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents action-row"><span ng-if="!row.entity.SUR_CODE">--</span><span ng-if="row.entity.SUR_CODE">{{row.entity.SUR_CODE}}-{{row.entity.SUR_NAME}}</span></div>'},{field:"actions",displayName:"billing.actions",headerCellFilter:"translate",width:70,cellTemplate:'<div class="ui-grid-cell-contents action-row"><i class="fa fa-trash" ng-click="grid.appScope.preNew.deleteProcedure(rowRenderIndex)"></i></div>'}]},this.searchListGridOptions={enableRowSelection:!1,enableSelectAll:!1,enableSorting:!1,enableColumnMenus:!1,enableCellEdit:!1,enableRowHeaderSelection:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,multiSelect:!1,enableCellEditOnFocus:!1,enableFiltering:!1,columnDefs:[{name:"radio_row",displayName:"",headerCellFilter:"translate",width:20,headerCellTemplate:"<div><div>",cellTemplate:'<div class="ui-grid-cell-contents"><div class="ngSelectionCell selector-group"><label class="radio-inline"><input ng-init="releaseAction=0" type="radio" name="rdUserList" ng-value="true"  ng-model="releaseAction" ng-click="grid.appScope.prereqsearch.advSearchRowClick(row)"></label></div></div>'},{field:"PREAUTH_BILL_NO",displayName:"billing.authNo",headerCellFilter:"translate"},{field:"PAYER_NAME",displayName:"billing.payer",headerCellFilter:"translate"},{field:"PLAN_NAME",displayName:"billing.Plan",headerCellFilter:"translate"},{field:"PREAUTH_BIL_DATE",displayName:"billing.dateofcreate",headerCellFilter:"translate",cellFilter:'date:"yyyy/MM/dd "',cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.PREAUTH_BIL_DATE | date:"dd/MM/yyyy"}}</div>'},{field:"VISIT_NO",displayName:"billing.visitadmnumber",headerCellFilter:"translate"},{field:"PAT_NAME",displayName:"billing.patientName",headerCellFilter:"translate"},{field:"RG_MOBILE_NO",displayName:"billing.mobNo",headerCellFilter:"translate"}]},this.payerDetailsGridOtions={enableHorizontalScrollbar:0,enableCellEdit:!1,enableRowHeaderSelection:!1,enableRowSelection:!1,multiSelect:!1,enableSelectAll:!1,enableCellEditOnFocus:!1,enableVerticalScrollbar:2,enableSorting:!1,columnDefs:[{name:"radio_row",displayName:"",headerCellFilter:"translate",width:20,headerCellTemplate:"<div><div>",cellTemplate:'<div ng-if="rowRenderIndex==0" class="ui-grid-cell-contents"></div><div class="ngSelectionCell selector-group ui-grid-cell-contents" ng-if="rowRenderIndex!=0" style="height: 30px;padding-top: 7px;padding-left: 7px;"><label class="radio-inline"><input ng-init="" type="radio" name="rdUserList" ng-value="true"  ng-model="row.entity.prePay.selectFlag" ng-click="grid.appScope.prePay.advSearchRowClick(row)"></label></div>'},{field:"prePay.payer",displayName:"billing.payer",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0"><div class="form-group grid-input" style="margin-top: -3px;"><input type="text" class="form-control his-typeahead" placeholder="" name="payer_name" ng-model="row.entity.prePay.payer" ng-change="showError=false" autocomplete="off" uib-typeahead="item as item.inCompName for item in grid.appScope.prePay.payerSearch($viewValue) " typeahead-min-length="3" typeahead-no-results="noResults" maxlength="60"></div></div><div ng-if="rowRenderIndex!=0">{{row.entity.prePay.payer}}</div></div>'},{field:"prePay.plan",displayName:"billing.Plan",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0"><div class="form-group grid-input" style="margin-top: -3px;"><input type="text" class="form-control his-typeahead" placeholder="" name="plan_name" ng-model="row.entity.prePay.plan" ng-change="showError=false" autocomplete="off" uib-typeahead="item as item.INC_PLAN_NAME for item in grid.appScope.prePay.fillPlans(row,$viewValue)" typeahead-no-results="noResults" maxlength="50"></div></div><div ng-if="rowRenderIndex!=0">{{row.entity.prePay.plan}}</div></div>'},{field:"prePay.policyno",displayName:"billing.policyNo",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0"><div class="form-group grid-input" style="margin-top: -3px;"><input type="text"  class="form-control" ng-model="row.entity.prePay.policyno" alphabets-pattern-numeric maxlength="15" ></div></div><div ng-if="rowRenderIndex!=0">{{row.entity.prePay.policyno}}</div></div>'},{field:"prePay.cardno",displayName:"billing.cardNo",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0"><div class="form-group grid-input" style="margin-top: -3px;"><input type="text"  class="form-control" ng-model="row.entity.prePay.cardno" alphabets-pattern-numeric maxlength="30"></div></div><div ng-if="rowRenderIndex!=0">{{row.entity.prePay.cardno}}</div></div>'},{field:"prePay.fromdate",displayName:"billing.validfrom",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0" style="margin-top: -3px;"><div class="form-group" style="padding: 0px;"><div class="input-group"><input type="text" class="form-control" placeholder="" style="top: 0px;" uib-datepicker-popup="{{grid.appScope.prePay.format}}" ng-model="row.entity.prePay.fromDate" is-open="grid.appScope.prePay.popup2.opened" datepicker-options="grid.appScope.prePay.fromDateOptions" ng-required="true" close-text="Close" ng-click="grid.appScope.prePay.expectedDateService()" ng-change="grid.appScope.prePay.toDateChange(row.entity)" datepicker-append-to-body=true readonly/><span class="input-group-addon"><i class="fa fa-calendar" ng-click="grid.appScope.prePay.expectedDateService();"></i></span></div></div></div><div ng-if="rowRenderIndex!=0">{{row.entity.prePay.viewfromDate}}</div></div>'},{field:"prePay.todate",displayName:"billing.validto",headerCellFilter:"translate",cellFilter:'date:"yyyy/MM/dd "',cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0" style="margin-top: -3px;"><div class="form-group" style="padding: 0px;"><div class="input-group"><input type="text" class="form-control" placeholder="" style="top: 0px;" uib-datepicker-popup="{{grid.appScope.prePay.format}}" ng-model="row.entity.prePay.toDate" is-open="grid.appScope.prePay.popup1.opened" datepicker-options="grid.appScope.prePay.toDateOptions" ng-required="true" close-text="Close" ng-click="grid.appScope.prePay.toDateCAL()" ng-change="grid.appScope.prePay.fromDateChange(row.entity)" datepicker-append-to-body=true readonly/><span class="input-group-addon"><i class="fa fa-calendar" ng-click="grid.appScope.prePay.toDateCAL();"></i></span></div></div></div><div ng-if="rowRenderIndex!=0">{{row.entity.prePay.viewtoDate}}</div></div>'},{field:"prePay.actions",displayName:"billing.actions",headerCellFilter:"translate",width:90,cellTemplate:'<div class="ui-grid-cell-contents" ><div ng-if="rowRenderIndex==0" ><button class="his-btn his-btn-info his-grid-btn" style="position: relative; top: -4px;" ng-click="grid.appScope.prePay.addRowGrid(row)"><i class="fa fa-plus"> Add</i></button></div></div>'}]},this.preAuthApprovalTabGridDefination=function(e,t){e.authApprovalGrid={enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!1,showGridFooter:!0,showColumnFooter:!1,gridFooterTemplate:'<div  style="text-align: center;background-color: #d9e2f1;color: #6a6d72;font-weight: 600;padding-top: 4px;padding-bottom: 8px;"><span ng-class="{ \'viewmodeleft\':(!grid.appScope.preNew.firstApproval&&!grid.appScope.preNew.updateApproval), \'editmodeleft\' :(grid.appScope.preNew.firstApproval||grid.appScope.preNew.updateApproval)}" >Requested Amt: <span style="font-weight: bolder;">{{grid.appScope.preNew.requestFooterTotalAmt}}</span></span>   <span ng-class="{\'viewmoderight\':(!grid.appScope.preNew.firstApproval&&!grid.appScope.preNew.updateApproval), \'editmoderight\' :(grid.appScope.preNew.firstApproval||grid.appScope.preNew.updateApproval)}" style="float: right;"">Approved Amt: <span style="font-weight: bolder;"">{{grid.appScope.preNew.approvalFooterTotalAmt}}</span></span></div>',multiSelect:!1,enableSelectAll:!1,enableSorting:!1,enableVerticalScrollbar:2,columnDefs:[{name:"status",displayName:" ",headerCellFilter:"translate",category:"Item",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,pinnedLeft:!0,visible:!0,width:"4",cellTemplate:"<div class=\"ui-grid-cell-contents grid-actions\" ng-class=\"{'routinePriority':row.entity.isOrderFrom==1, 'asapPriority' :row.entity.isOrderFrom==2}\"></div>"},{field:"priServGroup.DESCRIPTION",displayName:"billing.psGroup",headerCellFilter:"translate",width:110,cellTooltip:!0,headerTooltip:!0,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group pre-auth-grid-input"><select class="form-control" ng-model="row.entity.priServGroup" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.priServGroupList" ng-disabled="row.entity.approxBillDtSeqId || row.entity.preAuthBillAprDtSeqId" ng-change="grid.appScope.'+t+'.changePriServ(row.entity.priServGroup,row.entity);"><option value="" selected>Select</option></select></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.priServGroup.DESCRIPTION}}</div></div>'},{field:"department.DESCRIPTION",displayName:"billing.department",headerCellFilter:"translate",width:110,cellTooltip:!0,headerTooltip:!0,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group pre-auth-grid-input"><select class="form-control" ng-model="row.entity.department" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.deptList" ng-change="grid.appScope.'+t+'.changeDept(row.entity.priServGroup,row.entity.department,row.entity);" ng-disabled="row.entity.approxBillDtSeqId || row.entity.preAuthBillAprDtSeqId"><option value="" selected>Select </option></select></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.department.DESCRIPTION}}</div></div>'},{field:"specialty.DESCRIPTION",displayName:"billing.speciality",headerCellFilter:"translate",width:110,cellTooltip:!0,headerTooltip:!0,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group pre-auth-grid-input"><select class="form-control" ng-model="row.entity.specialty" ng-click="row.entity.inActiveVal = true;" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.speciltyList" ng-change="grid.appScope.'+t+'.changeSpecialty(row.entity.specialty,row.entity);" ng-disabled="row.entity.approxBillDtSeqId || row.entity.preAuthBillAprDtSeqId"><option value="" selected>Select </option></select></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.specialty.DESCRIPTION}}</div></div>'},{field:"service.SERV_NAME",displayName:"billing.service",headerCellFilter:"translate",cellTooltip:!0,headerTooltip:!0,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group pre-auth-grid-input"><div class="input-group"><input type="text" class="form-control" ng-disabled="row.entity.isEditable ||row.entity.approxBillDtSeqId || row.entity.preAuthBillAprDtSeqId" ng-model="row.entity.service" placeholder="Enter" uib-typeahead="item as item.SERV_NAME+\' - \'+item.SPL_DESC for item in grid.appScope.'+t+'.serviceSearch($viewValue,row.entity)" style="width:80%; margin-left:8px;" typeahead-on-select="grid.appScope.'+t+'.onSelected($item,row.entity);" typeahead-append-to-body=true ></div></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.service.SERV_NAME}}</div></div>'},{field:"qty",displayName:"billing.qty",headerCellFilter:"translate",width:50,cellTooltip:!0,headerTooltip:!0,cellTemplate:'<div class="ui-grid-cell-contents "><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group pre-auth-grid-input"><input type="text"  class="form-control" ng-change="(!grid.appScope.'+t+".generatePreAuthFlag)?grid.appScope."+t+'.changeAmount(row.entity,rowRenderIndex):\'\'" numbers-only ng-model="MODEL_COL_FIELD" ng-disabled="row.entity.approxBillDtSeqId || row.entity.preAuthBillAprDtSeqId"></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.qty}}</div></div>'},{field:"valueAmt",displayName:"billing.amt",headerCellFilter:"translate",width:60,cellTooltip:!0,headerTooltip:!0,cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.valueAmt}}</span><input type="text" ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)" ng-model="row.entity.valueAmt" class="form-control"  maxlength="15" decimal-upto="2" allow-negative="false" ng-disabled="row.entity.approxBillDtSeqId || row.entity.preAuthBillAprDtSeqId" ng-change="grid.appScope.'+t+'.checkZero(row.entity,1)"></div>'},{field:"approvedDetails",displayName:"billing.Approve",headerCellFilter:"translate",width:50,cellTooltip:!0,headerTooltip:!0,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="grid.appScope.preNew.updateApproval||grid.appScope.preNew.firstApproval"><div class="grid-input"><select  class="form-control" ng-model="row.entity.approvedDetails" ng-change="grid.appScope.'+t+'.changeApprovedDetails(row.entity);row.entity.approvedAmount=row.entity.approvedDetails==3?undefined:row.entity.approvedDetails==4?undefined:row.entity.approvedAmount;row.entity.approvedQty=row.entity.approvedDetails==3?undefined:row.entity.approvedDetails==4?undefined:row.entity.approvedQty;"><option value="1" selected>AP</option><option value="2">PA</option><option value="3">PE</option><option value="4">RE</option></select></div></div><span ng-if="!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval">{{row.entity.approvedDetails==1?"AP":row.entity.approvedDetails==2?"PA":row.entity.approvedDetails==3?"PE":row.entity.approvedDetails==4?"RE":""}}</span></div>'},{field:"applicabilityType",displayName:"billing.applicable",headerCellFilter:"translate",width:70,cellTooltip:!0,headerTooltip:!0,cellTemplate:'<div class="ui-grid-cell-contents action-row"><div class="" ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><select class="form-control" ng-model="row.entity.applicabilityType" ng-options="item as item.DETAIL_DESC for item in grid.appScope.preNew.applicabilityList"  ng-init="row.entity.applicabilityType=grid.appScope.preNew.applicabilityList[0]"></select></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.applicabilityType.DETAIL_DESC}}</div></div>'},{field:"approvedQty",displayName:"billing.qty",headerCellFilter:"translate",width:50,cellTooltip:!0,headerTooltip:!0,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="grid.appScope.preNew.updateApproval||grid.appScope.preNew.firstApproval"><div class="grid-input"><input type="text"  class="form-control" numbers-only ng-model="MODEL_COL_FIELD" ng-disabled="row.entity.apprIsAmtPercNl==3||row.entity.approvedDetails==3||row.entity.approvedDetails==4" my-maxlength="15"  ng-change="grid.appScope.'+t+'.checkZero(row.entity,2)" ></div></div><span ng-if="!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval">{{row.entity.approvedQty==undefined?"--":row.entity.approvedQty}}</span></div>'},{field:"app_valueAmt",displayName:"billing.amountNlPercentage",headerCellFilter:"translate",width:110,cellTooltip:!0,headerTooltip:!0,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><div ng-if="grid.appScope.preNew.updateApproval||grid.appScope.preNew.firstApproval"><input type="text" ng-model="row.entity.approvedAmount" class="form-control" ng-change="grid.appScope.'+t+'.changedApproveAmt(row.entity)" ng-blur="grid.appScope.'+t+'.changedValueType(row.entity)" style="width:47% !important;float:left;" ng-disabled="row.entity.apprIsAmtPercNl==3||row.entity.approvedDetails==3||row.entity.approvedDetails==4" my-maxlength="15" number-with-decimal ><select  class="form-control" style="width:47% !important;float:left;" ng-model="row.entity.apprIsAmtPercNl" ng-change="grid.appScope.'+t+'.changedValueType(row.entity);row.entity.approvedAmount=row.entity.apprIsAmtPercNl==3?undefined:row.entity.apprIsAmtPercNl==2?undefined:row.entity.approvedAmount;row.entity.approvedQty=row.entity.apprIsAmtPercNl==3?undefined:row.entity.approvedQty;" ng-disabled="row.entity.approvedDetails==3||row.entity.approvedDetails==4"><option value="1" selected>Amt</option><option value="2">%</option><option value="3">NL</option></select></div><span ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)">{{row.entity.approvedAmount==undefined?"":row.entity.approvedAmount}}  {{row.entity.apprIsAmtPercNl==2&&row.entity.approvedAmount !==undefined?"%":row.entity.apprIsAmtPercNl==3?"NL":""}}</span></div>'},{field:"inclDetails",displayName:"billing.inculdedWithSymbol",headerCellFilter:"translate",width:70,cellTooltip:!0,headerTooltip:!0,cellTemplate:'<div class="ui-grid-cell-contents action-row" style="text-align: center;"><div class="" ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0"><img src="assets/stamp.png" aria-hidden="true" ng-show="row.entity.serviceApprovalStatus==1"></i><i class="fa fa-check" ng-show="row.entity.serviceApprovalStatus==2"></i><i class="fa fa-times" aria-hidden="true" ng-show="(row.entity.serviceApprovalStatus==undefined || row.entity.serviceApprovalStatus==null)||row.entity.serviceApprovalStatus==3"></i></div>'},{field:"actions",displayName:"billing.actions",headerCellFilter:"translate",width:60,visible:!0,cellTemplate:'<div class="ui-grid-cell-contents" ><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+".firstApproval||grid.appScope."+t+'.directApproval)" ><button class="his-btn his-btn-info his-grid-btn" style="position: relative; top: -4px;" ng-click="grid.appScope.'+t+'.addRowGrid(row,true)"><i class="fa fa-plus"> Add</i></button><i class="fa fa-eraser"  ng-click="grid.appScope.'+t+'.clearRecordFirst(row,true)"></i></div><div ng-if="rowRenderIndex!=0" class=" action-row"><i class="fa fa-pencil" ng-click="grid.appScope.'+t+'.editGridData(row,rowRenderIndex,true)"></i><i class="fa fa-trash" ng-click="grid.appScope.'+t+'.deleteRecord(row,rowRenderIndex,true)" ng-if="!row.entity.deleteDisble && !(row.entity.approxBillDtSeqId || row.entity.preAuthBillAprDtSeqId)"></i></div></div'}]},e.coPayGrid={enableHorizontalScrollbar:0,columnDefs:[{field:"priServGroup",displayName:"billing.psGroup",headerCellFilter:"translate",width:130,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group grid-input"><select class="form-control pre-auth-grid-input" ng-model="row.entity.priServGroup" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.priServGroupList" ng-change="grid.appScope.'+t+'.changePriServ(row.entity.priServGroup,row.entity);"><option value="" selected>Select</option></select></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.priServGroup.DESCRIPTION}}</div></div>'},{field:"department",displayName:"billing.department",headerCellFilter:"translate",width:130,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group grid-input"><select class="form-control pre-auth-grid-input" ng-model="row.entity.department" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.deptList" ng-change="grid.appScope.'+t+'.changeDept(row.entity.priServGroup,row.entity.department,row.entity);"><option value="" selected>Select </option></select></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.department.DESCRIPTION}}</div></div>'},{field:"specialty",displayName:"billing.speciality",headerCellFilter:"translate",width:130,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group grid-input"><select class="form-control pre-auth-grid-input" ng-model="row.entity.specialty" ng-click="row.entity.inActiveVal = true;" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.speciltyList" ng-change="grid.appScope.'+t+'.changeSpecialty(row.entity.specialty,row.entity);"><option value="" selected>Select </option></select></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.specialty.DESCRIPTION}}</div></div>'},{field:"service",displayName:"billing.service",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group grid-input watermark-addon pre-auth-grid-input"><div class="input-group"><input type="text" class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.service" placeholder="Enter" uib-typeahead="item as item.SERV_NAME+\' - \'+item.SPL_DESC for item in grid.appScope.'+t+'.serviceSearch($viewValue,row.entity)" style="margin-left:8px;" typeahead-on-select="grid.appScope.'+t+'.onSelected($item,row.entity);" typeahead-append-to-body=true ><span class="input-group-addon" style="position: relative; top: -4px;"><i class="fa fa-search"></i></span></div></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.service.SERV_NAME}}</div></div>'},{field:"value",displayName:"billing.coPayWithAmtIndication",headerCellFilter:"translate",width:100,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group grid-input pre-auth-grid-input"><div class="input-group"><input type="text" class="form-control" ng-model="MODEL_COL_FIELD" number-with-decimal></div></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.value}}</div></div>'},{field:"actions",displayName:"billing.actions",headerCellFilter:"translate",width:90,cellTemplate:'<div class="ui-grid-cell-contents" ng-if="grid.appScope.preNew.updateApproval||grid.appScope.preNew.firstApproval"><div ng-if="rowRenderIndex==0" ><button class="his-btn his-btn-info his-grid-btn" style="position: relative; top: -4px;" ng-click="grid.appScope.'+t+'.actionGridOOP(row.entity,rowRenderIndex,\'add\',\'coPay\')"><i class="fa fa-plus" ng-if="!row.entity.deleteDisble">Add</i><span ng-if="row.entity.deleteDisble">Update</span></button></div><div ng-if="rowRenderIndex!=0" class="ui-grid-cell-contents action-row"><i class="fa fa-pencil" ng-click="grid.appScope.'+t+".actionGridOOP(row.entity,rowRenderIndex,'edit','coPay')\"></i><i class=\"fa fa-trash\" ng-click=\"grid.appScope."+t+".actionGridOOP(row.entity,rowRenderIndex,'delete','coPay')\" ng-if=\"!row.entity.deleteDisble\"></i></div></div"}]},e.coInsGrid={enableHorizontalScrollbar:0,columnDefs:[{field:"priServGroup",displayName:"billing.psGroup",headerCellFilter:"translate",width:130,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group grid-input"><select class="form-control pre-auth-grid-input" ng-model="row.entity.priServGroup" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.priServGroupList" ng-change="grid.appScope.'+t+'.changePriServ(row.entity.priServGroup,row.entity);"><option value="" selected>Select</option></select></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.priServGroup.DESCRIPTION}}</div></div>'},{field:"department",displayName:"billing.department",headerCellFilter:"translate",width:130,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group grid-input"><select class="form-control pre-auth-grid-input" ng-model="row.entity.department" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.deptList" ng-change="grid.appScope.'+t+'.changeDept(row.entity.priServGroup,row.entity.department,row.entity);"><option value="" selected>Select </option></select></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.department.DESCRIPTION}}</div></div>'},{field:"specialty",displayName:"billing.speciality",headerCellFilter:"translate",width:130,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group grid-input"><select class="form-control pre-auth-grid-input" ng-model="row.entity.specialty" ng-click="row.entity.inActiveVal = true;" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.speciltyList" ng-change="grid.appScope.'+t+'.changeSpecialty(row.entity.specialty,row.entity);"><option value="" selected>Select </option></select></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.specialty.DESCRIPTION}}</div></div>'},{field:"service",displayName:"billing.service",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group watermark-addon grid-input pre-auth-grid-input"><div class="input-group"><input type="text" class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.service" placeholder="Enter" uib-typeahead="item as item.SERV_NAME+\' - \'+item.SPL_DESC for item in grid.appScope.'+t+'.serviceSearch($viewValue,row.entity)" style="" typeahead-on-select="grid.appScope.'+t+'.onSelected($item,row.entity);" typeahead-append-to-body=true ><span class="input-group-addon" style="position: relative; top: -4px;"><i class="fa fa-search"></i></span></div></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.service.SERV_NAME}}</div></div>'},{field:"value",displayName:"billing.coInsuranceWithPercntageSymbol",headerCellFilter:"translate",width:100,cellTemplate:'<div class="ui-grid-cell-contents"><div ng-if="rowRenderIndex==0&&(grid.appScope.'+t+".updateApproval||grid.appScope."+t+'.firstApproval)"><div class="form-group grid-input pre-auth-grid-input"><div class="input-group"><input type="text" class="form-control" ng-model="MODEL_COL_FIELD" number-with-decimal ng-change="row.entity.value=row.entity.value>100?100:row.entity.value"></div></div></div><div ng-if="(!grid.appScope.preNew.updateApproval&&!grid.appScope.preNew.firstApproval)||rowRenderIndex!=0">{{row.entity.value}}</div></div>'},{field:"actions",displayName:"billing.actions",headerCellFilter:"translate",width:90,cellTemplate:'<div class="ui-grid-cell-contents" ng-if="grid.appScope.preNew.updateApproval||grid.appScope.preNew.firstApproval"><div ng-if="rowRenderIndex==0" ><button class="his-btn his-btn-info his-grid-btn" style="position: relative; top: -4px;" ng-click="grid.appScope.'+t+'.actionGridOOP(row.entity,rowRenderIndex,\'add\',\'coIns\')"><i class="fa fa-plus" ng-if="!row.entity.deleteDisble">Add</i><span ng-if="row.entity.deleteDisble">Update</span></button></div><div ng-if="rowRenderIndex!=0" class="ui-grid-cell-contents action-row"><i class="fa fa-pencil" ng-click="grid.appScope.'+t+".actionGridOOP(row.entity,rowRenderIndex,'edit','coIns')\"></i><i class=\"fa fa-trash\" ng-click=\"grid.appScope."+t+".actionGridOOP(row.entity,rowRenderIndex,'delete','coIns')\" ng-if=\"!row.entity.deleteDisble\"></i></div></div"}]},this.gridOptionsServiceLimitEnhancement={enableHorizontalScrollbar:0,enableSelectAll:!0,columnDefs:[{name:"status",displayName:" ",category:"Item",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,pinnedLeft:!0,visible:!0,headerCellFilter:"translate",width:"4",cellTemplate:"<div class=\"ui-grid-cell-contents grid-actions\" ng-class=\"{'routinePriority':row.entity.manualFlag , 'asapPriority' :!row.entity.manualFlag}\"></div>"},{field:"primaryServGroup",displayName:"billing.psGroup",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.priServGroup.DESCRIPTION}}</div>'},{field:"dept",displayName:"billing.department",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.department.DESCRIPTION}}</div>'},{field:"speciality",displayName:"billing.speciality",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.specialty.DESCRIPTION}}</div>'},{field:"service",displayName:"billing.service",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.service.SERV_NAME}}</div>'},{field:"actions",displayName:"billing.actions",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents action-row"><i class="fa fa-check" ng-show="row.entity.isApprovalRequired==1"></i><i class="fa fa-times" ng-show="row.entity.isApprovalRequired==3"></i><img src="assets/stamp.png" ng-show="row.entity.isApprovalRequired==2"></div>'}]}}}])}(),function(){"use strict";angular.module("napierContainerUi").service("showEstDtlsPreAuth",function(){this.getServiceDetails=function(e,t,a,i){null!=t.approxBillDtls3&&null!=t.approxBillDtls3&&t.approxBillDtls3!=[]&&(t.approxBillDtls3=t.approxBillDtls3 instanceof Array?t.approxBillDtls3:[t.approxBillDtls3],angular.forEach(t.approxBillDtls3,function(a,r){var n=!1;if(null!=e.data&&e.data.length>0)for(var l=0;l<e.data.length;l++){if(e.data[l].serviceSeqId==a.SERV_SEEQ_ID){n=!1;break}l==e.data.length-1&&(n=!0)}else n=!0;if(n){e.data.push({gnTranStatus:1,serviceDiscountAmt:null==a.DISCOUNT_AMT?0:a.DISCOUNT_AMT,approxBillDtSeqId:i?void 0:a.APPROX_BILL_DT_SEQ_ID,serviceTax:a.APPROX_TAX,chargeableAmt:a.CHARGEABLE_AMT,expcServDate:"9999-03-05 00:00:00.000",serviceRate:a.SERVICE_RATE,serviceCode:a.SERV_CODE,serviceName:a.SERV_NAME,serviceQty:a.SERV_QTY,serviceSeqId:a.SERV_SEEQ_ID}),t.estimateCost=t.estimateCost+a.CHARGEABLE_AMT,null!=a.DISCOUNT_AMT&&(t.discounts=t.discounts+a.DISCOUNT_AMT),t.grossAmount=t.grossAmount+a.SERVICE_RATE*a.SERV_QTY,t.netAmount=t.netAmount+a.SERVICE_RATE*a.SERV_QTY}}))},this.getDrugDetails=function(e,t,a,i){null!=t.approxBillDtls2&&null!=t.approxBillDtls2&&t.approxBillDtls2!=[]&&(t.approxBillDtls2=t.approxBillDtls2 instanceof Array?t.approxBillDtls2:[t.approxBillDtls2],angular.forEach(t.approxBillDtls2,function(a,r){null!=a.MTRL_NAME&&(e.data.push({materialName:a.MTRL_NAME,approxBillDtSeqId:i?void 0:a.APPROX_BILL_DT_SEQ_ID,price:a.MTRL_RATE/a.MTRL_QTY,quantaty:a.MTRL_QTY,totalPrice:a.MTRL_RATE,expcMtrlDate:"9999-12-27T00:00:00.000000+0530",gnTranStatus:1}),t.estimateCost=t.estimateCost+a.MTRL_RATE,t.grossAmount=t.grossAmount+a.MTRL_RATE,t.netAmount=t.netAmount+a.MTRL_RATE)}))},this.getPackageDetails=function(e,t,a,i){if(null!=t.approxBillDtls4&&null!=t.approxBillDtls4&&t.approxBillDtls4!=[]){t.approxBillDtls4=t.approxBillDtls4 instanceof Array?t.approxBillDtls4:[t.approxBillDtls4];angular.forEach(t.approxBillDtls4,function(a,r){var n=null==a.LIMIT_AMOUNT?0:a.LIMIT_AMOUNT,l=null==a.strPackCode?a.SERV_CODE:a.strPackCode;e.data.push({strPackCode:l,primaryServiceTypeCode:a.PRI_SERV_TYPE_CODE,primaryServiceTypeAliasName:a.PRI_SERV_TYPE_ALIAS_NAME,approxPackBillSeqId:i?void 0:a.APPROX_PACK_BILL_SEQ_ID,cptCode:a.CPTCode,limitAmt:n,remarks:a.REMARKS,gnTranStatus:1}),t.estimateCost=t.estimateCost+n,t.grossAmount=t.grossAmount+n,t.netAmount=t.netAmount+n})}},this.getPatientDetails=function(e,t,a,i){if(null!=e.approxBillDtls&&null!=e.approxBillDtls&&e.approxBillDtls!=[]&&e.approxBillDtls.length>0&&!a){if(e.approxBillDtls=e.approxBillDtls instanceof Array?e.approxBillDtls:[e.approxBillDtls],t.patientDetailsSearch.LOS=e.approxBillDtls[0].ExpectedLOS,t.ICDCodeValue=e.approxBillDtls[0].ICDCode,e.expectedDate=new Date(e.approxBillDtls[0].EXPECTED_SER_DATE),e.remarks=e.approxBillDtls[0].REMARKS,t.patientDetailsSearch.remarks=e.approxBillDtls[0].REMARKS,null!=e.approxBillDtls[0].BC_SEQ_ID)for(var r=0;r<t.bedClass.length;r++)if(e.approxBillDtls[0].BC_SEQ_ID==t.bedClass[r].gQDataCode){t.bedClassName=t.bedClass[r];break}if(null!=e.approxBillDtls[0].PAYER_TYPE)for(var n=0;n<t.payerTypeList.length;n++)if(t.payerTypeList[n].gQDataCode==e.approxBillDtls[0].PAYER_TYPE){t.patientDetailsSearch.payerType=t.payerTypeList[n];break}}else if(null!=e.approxBillDtls&&null!=e.approxBillDtls&&e.approxBillDtls!=[]&&e.approxBillDtls.length>0&&i){if(e.approxBillDtls=e.approxBillDtls instanceof Array?e.approxBillDtls:[e.approxBillDtls],t.unRegistered.firstName=e.approxBillDtls[0].PAT_FIRST_NAME,t.unRegistered.lastName=e.approxBillDtls[0].PAT_LAST_NAME,t.unRegistered.mobileNo=e.approxBillDtls[0].REG_MOBILE,null!=e.approxBillDtls[0].RG_TMP_MIDDLE_NAME&&(t.unRegistered.middleName=e.approxBillDtls[0].RG_TMP_MIDDLE_NAME),null!=e.approxBillDtls[0].RG_TMP_SEX)for(n=0;n<t.genderName.length;n++)if(t.genderName[n].gQDataCode==e.approxBillDtls[0].RG_TMP_SEX){t.unRegistered.genderValue=t.genderName[n];break}if(null!=e.approxBillDtls[0].PCATG_SEQ_ID)for(n=0;n<t.patientCategoryName.length;n++)if(t.patientCategoryName[n].gQDataCode==e.approxBillDtls[0].PCATG_SEQ_ID){t.patientDetailsSearch.patientCategory=t.patientCategoryName[n];break}if(null!=e.approxBillDtls[0].PAYER_TYPE)for(n=0;n<t.payerTypeList.length;n++)if(t.payerTypeList[n].gQDataCode==e.approxBillDtls[0].PAYER_TYPE){t.patientDetailsSearch.payerType=t.payerTypeList[n];break}if(null!=e.approxBillDtls[0].RG_TMP_DOB){var l=parseInt(e.approxBillDtls[0].RG_TMP_DOB.split("T")[0].split("-")[0]),s=parseInt(e.approxBillDtls[0].RG_TMP_DOB.split("T")[0].split("-")[1]),o=parseInt(e.approxBillDtls[0].RG_TMP_DOB.split("T")[0].split("-")[2]),c=new Date,d=parseInt(c.getFullYear());t.unRegistered.age=d-l;for(var p=0;p<t.yearResult.length;p++)if(t.yearResult[p].year==l){t.unRegistered.yearSelectd=t.yearResult[p];break}for(var u=0;u<t.monthResult.length;u++)if(t.monthResult[u].month==s){t.unRegistered.monthSelectd=t.monthResult[u];break}for(var m=0;m<t.dayResult.length;m++)if(t.dayResult[m].day==o){t.unRegistered.daySelectd=t.dayResult[m];break}}if(t.regSeqId=e.approxBillDtls[0].TMP_REG_SEQ_ID,t.patientDetailsSearch.LOS=e.approxBillDtls[0].ExpectedLOS,t.ICDCodeValue=e.approxBillDtls[0].ICDCode,e.expectedDate=new Date(e.approxBillDtls[0].EXPECTED_SER_DATE),e.remarks=e.approxBillDtls[0].REMARKS,t.patientDetailsSearch.remarks=e.approxBillDtls[0].REMARKS,null!=e.approxBillDtls[0].BC_SEQ_ID)for(r=0;r<t.bedClass.length;r++)if(e.approxBillDtls[0].BC_SEQ_ID==t.bedClass[r].gQDataCode){t.bedClassName=t.bedClass[r];break}}}})}(),function(){"use strict";angular.module("napierContainerUi").controller("PreAutoNewRegController",["$scope","QueryService","$timeout","PatientSearch","$filter","PackageServices","PreAuthSaveServices","$location","PatientBannerBilling","ServiceGet","PatientGlobal","GetEstimateQuery","PatientBannerGlobal","hisAlertService","hisTranslationsGlobalLang","hisTranslationsService","hisGenericAlertService","CommonForServiceData","gridDefApproval","$state","PreAuthService","hisModalService","CallManager","PreAuthConstants","$uibModal","EMRAPIS","PreAuthApprovalServices","PreAuthViewServices","$log","uploadFileService","$stateParams","uibDatepickerConfig",function(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C,I,A,E,h,b,T,L,P,O,R,N){S.loadModule("billing"),S.loadModule("ot"),S.loadModule("adt");var w=g.getLanguageToSet();S.changeLanguage(w),delete N.ngModelOptions.timezone;var F=this;function M(e){F.authactive=!1,F.mrnoactive=!1,F.vnactive=!1,F.ipactive=!1,1==e?F.ipactive=!0:2==e?F.vnactive=!0:3==e?F.authactive=!0:4==e&&(F.mrnoactive=!0)}function G(){let e;null!=F.patientId?e=F.patientId:null!=F.visitno?e=F.visitno:null!=F.patientipno&&(e=F.patientipno),F.searchPatientResult(e,!0)}function x(a){F.approxBillHdSeqId=a.APPROX_BILL_HD_SEQ_ID,F.dupapproxBillHdSeqId=a.APPROX_BILL_HD_SEQ_ID,F.patRegList={1:F.patDtls=[],2:F.diagDtls=[],3:F.procDtls=[],4:F.servDtls=[],5:F.mtlDtls=[]};var i=t.executeQueryURLReset();F.etbDtlsList=new Array,t.prepareParamListWithParam("pBilHdSeqId",F.approxBillHdSeqId,F.etbDtlsList),t.prepareParamListWithParam("pEstimateHdSeqId",F.approxBillHdSeqId,F.etbDtlsList),t.prepareParamListWithParam("pIs_extimate_or_preauth",1,F.etbDtlsList),t.executeQueryInput("GET_UNREG_PAT_BIL_DTLS",F.etbDtlsList,F.patRegList,!0,!1,i,"popUp",{}).then(function(e){}),t.executeQueryInput("GET_EST_DIAG_DTLS",F.etbDtlsList,F.patRegList,!0,!1,i,"popUp",{}).then(function(e){}),t.executeQueryInput("GET_EST_PROC_DTLS",F.etbDtlsList,F.patRegList,!0,!1,i,"popUp",{}).then(function(e){}),t.executeQueryInput("GET_ESTIMATE_SERVICE_DETAILS",F.etbDtlsList,F.patRegList,!0,!1,i,"popUp",{}).then(function(e){}),t.executeQueryInput("GET_EST_MATERIAL_DTLS",F.etbDtlsList,F.patRegList,!0,!0,i,"popUp",{}).then(function(t){console.log(t);var a=t[1][0];F.selfdataflag=!1,F.flow=6,F.visitdisableflag=!0,2==a.PAYER_TYPE?F.selfdataflag=!0:2!=a.PAYER_TYPE&&(F.selfdataflag=!1,F.tempplanobj={},F.temppayerobj={},F.payerName=a.INC_COMP_NAME,F.planName=a.INC_PLAN_NAME,F.policyNumber=a.POLICY_NO,F.cardNumber=a.CARD_NUMBER,H(a,F.flow),F.payerseqid=a.INC_SEQ_ID,F.planseqid=a.INC_PLAN_SEQ_ID,F.tempplanobj.planName=F.planName,F.tempplanobj.INC_PLAN_SEQ_ID=F.planseqid,F.temppayerobj.payerName=F.payerName,F.temppayerobj.incSeqId=F.payerseqid,F.validTo=moment(a.PLAN_VALID_TO).format("DD/MM/YYYY"),F.validFrom=moment(a.PLAN_VALID_FROM).format("DD/MM/YYYY"),F.savevalidFrom=a.PLAN_VALID_FROM,F.savevalidTo=a.PLAN_VALID_TO,F.tariffSeqId=a.TARIFF_SEQ_ID,F.loadBedClass(F.temppayerobj,F.tempplanobj)),F.chiefComplaints=a.CHIEF_COMPLAINTS,F.expDate=a.EXP_ADM_DATE?new Date(a.EXP_ADM_DATE):void 0,F.admReason=a.REASON_FOR_ADMISSION,1==a.GN_FLOW?(F.visitType=1,F.estLengthStay=a.EST_LOS?a.EST_LOS:void 0,F.expLengthUnit=a.LOS_TYPE?a.LOS_TYPE:void 0,F.tempclinicalBedClass=a.BC_SEQ_ID):2==a.GN_FLOW&&(F.visitType=2,F.clinicalBedClass=void 0,F.expLengthUnit=void 0);let i={};var r=t[2];angular.forEach(r,function(e){i.ICDCODE=e.STANDARD_CODE,i.DESCRIPTION=e.STANDARD_NAME,e.HOSP_CODE&&(i.HOSP_DIAG_CODE=e.HOSP_CODE,i.HOSP_DIAG_DESC=e.HOSP_NAME),F.gridOptionsDiagnosis.data.push(i),i={}});var n=t[3];angular.forEach(n,function(e){i.ICD9=e.STANDARD_CODE,i.CODE=e.STANDARD_CODE,i.DESCRIPTION=e.STANDARD_NAME,e.HOSP_CODE&&(i.SUR_CODE=e.HOSP_CODE,i.SUR_NAME=e.HOSP_NAME),F.gridOptionsProcedure.data.push(i),i={}});var l=t[4];angular.forEach(l,function(e){F.authApprovalGrid.data=[];var t={specialty:e.SPL_CODE&&e.SPL_DESC?{CODE:e.SPL_CODE,DESCRIPTION:e.SPL_DESC}:void 0,department:e.DEPT_CODE&&e.DEPT_DESC?{CODE:e.DEPT_CODE,DESCRIPTION:e.DEPT_DESC}:void 0,priServGroup:{CODE:e.PRI_SERV_CODE?e.PRI_SERV_CODE:void 0,DESCRIPTION:e.PRI_SERV_DESC?e.PRI_SERV_DESC:void 0,IS_MATERIAL:"N"},service:e.SERV_SEQ_ID?{DEPT_CODE:e.DEPT_CODE?e.DEPT_CODE:void 0,PRI_SERV_CODE:e.PRI_SERV_CODE?e.PRI_SERV_CODE:void 0,PRI_SERV_DESC:e.PRI_SERV_DESC?e.PRI_SERV_DESC:void 0,SEPT_DESC:e.DEPT_DESC?e.DEPT_DESC:void 0,SERV_NAME:e.SERV_NAME?e.SERV_NAME:void 0,SERV_SEQ_ID:e.SERV_SEQ_ID}:void 0,serviceAmt:e.SERVICE_RATE?e.SERVICE_RATE:void 0,valueAmt:e.CHARGEABLE_AMT?e.CHARGEABLE_AMT:void 0,qty:e.SERV_QTY?e.SERV_QTY:void 0,ismaterial:"N",isAmtNlPercFlag:e.IS_AMT_PERC_NL_CODE,serviceApprovalStatus:e.IS_APPROVAL_REQUIRED,isOrderFrom:e.IS_ORDER_FROM,manualFlag:1==e.IS_ORDER_FROM,isApprovalRequired:e.IS_APPROVAL_REQUIRED,applicabilityType:{DETAIL_DESC:F.applicabilityList[0].DETAIL_DESC,DT_CODE:F.applicabilityList[0].DT_CODE}};let a=angular.copy(t);a.approvedDetails="",a.approvedAmount="",a.approvedQty="",a.remarks="",a.apprIsAmtPercNl="",a.previousApprIsAmtPercNl=1,1==F.selfdataflag?(F.temppreAuthDetailsGridOtions.push(t),F.tempapprovalDataList.push(a)):(F.preAuthDetailsGridOtions.data.push(t),F.isServiceLevelFlag=!0,F.approvalDataList.push(a))});var s=t[5];if(angular.forEach(s,function(e){var t={department:e.MAT_GROUP_CODE?{CODE:e.MAT_GROUP_CODE,DESCRIPTION:e.MAT_GROUP_DESC,METERIAL_CATID:e.MAT_CATG_CODE}:void 0,priServGroup:{CODE:e.MAT_CATG_CODE?e.MAT_CATG_CODE:void 0,DESCRIPTION:e.MAT_CATG_DESC?e.MAT_CATG_DESC:void 0,IS_MATERIAL:"Y"},service:e.MTRL_SEQ_ID?{MRP:0!=e.MTRL_QTY?e.MTRL_RATE/e.MTRL_QTY:e.MTRL_RATE,SERV_NAME:e.MTRL_NAME?e.MTRL_NAME:void 0,SERV_SEQ_ID:e.MTRL_SEQ_ID}:void 0,specialty:e.MAT_SUB_GROUP_CODE?{CODE:e.MAT_SUB_GROUP_CODE,DESCRIPTION:e.MAT_SUB_GROUP_DESC?e.MAT_SUB_GROUP_DESC:void 0,MTRL_MAIN_GRP_CODE:e.MAT_GROUP_CODE?e.MAT_GROUP_CODE:void 0}:void 0,valueAmt:e.MTRL_RATE?e.MTRL_RATE:void 0,serviceAmt:0!=e.MTRL_QTY?e.MTRL_RATE/e.MTRL_QTY:e.MTRL_RATE,qty:e.MTRL_QTY?e.MTRL_QTY:1,ismaterial:"Y",serviceApprovalStatus:e.IS_APPROVAL_REQUIRED,isOrderFrom:e.IS_ORDER_FROM,manualFlag:1==e.IS_ORDER_FROM,isApprovalRequired:e.IS_APPROVAL_REQUIRED,applicabilityType:{DETAIL_DESC:F.applicabilityList[0].DETAIL_DESC,DT_CODE:F.applicabilityList[0].DT_CODE}};let a=angular.copy(t);a.approvedDetails="",a.approvedAmount="",a.approvedQty="",a.remarks="",a.apprIsAmtPercNl="",a.previousApprIsAmtPercNl=1,F.selfdataflag?(F.temppreAuthDetailsGridOtions.push(t),F.tempapprovalDataList.push(a)):(F.preAuthDetailsGridOtions.data.push(t),F.isServiceLevelFlag=!0,F.approvalDataList.push(a))}),F.selfdataflag){var o=F.alertData.pleaseSelectPayer;m.hisAlertMulti("warning",F.alertData.alertTypeWarn,o,!1,!1,e.close,2e3)}else B(F.preAuthDetailsGridOtions.data)})}function q(e){let t={},a={};F.cardNumber=e.CARD_NUMBER,F.policyNumber=e.POLICY_NO,F.payerName=e.COMP_NAME,F.payerseqid=e.INC_SEQ_ID,F.planName=e.PLAN_NAME,F.planseqid=e.IN_PLC_SEQ_CD,F.validFrom=moment(new Date(e.PI_FROM_DATE)).format("DD/MM/YYYY"),F.validTo=moment(new Date(e.PI_TO_DATE)).format("DD/MM/YYYY"),a.payerName=F.payerName,a.incSeqId=F.payerseqid,t.planName=F.planName,t.INC_PLAN_SEQ_ID=F.planseqid,F.loadBedClass(a,t),F.savevalidFrom=e.PI_FROM_DATE,F.savevalidTo=e.PI_TO_DATE,F.tariffSeqId=e.TARIFF_CATG_CODE}F.filesUploaded=[],F.uploadedfileNames=[],F.uploadingFile=!1,F.preAuthValue=0,F.alertData={},F.procedure={},F.procedure.type=1,F.procedure.desc="",F.procedure.code="",F.procedureList=[],F.diagnosis={},F.diagnosis.type=1,F.diagnosis.desc="",F.diagnosis.code="",F.diagnosisList=[],F.ExpectedlengthList=[],F.gridOptionsDiagnosis=angular.copy(E.gridOptionsDiagnosis),F.gridOptionsProcedure=angular.copy(E.gridOptionsProcedure),F.chiefComplaintsGridOptions=angular.copy(E.gridOptionsChiefComplaints),F.gridOptionsDiagnosis.data=[],F.gridOptionsProcedure.data=[],F.preAuthDetailsGridOtions={},F.preAuthDetailsGridOtions.data=[],F.visitType=2,F.serviceApprovalStatus=1,F.isBillLevelFlag=!1,F.isServiceLevelFlag=!1,F.opPatData=[],F.opProcedureData=[],F.opDiagnosisData=[],F.ipPatData=[],F.PatPayerData=[],F.ipProcedureData=[],F.ipDiagnosisData=[],F.opPatClinicalData=[],F.ipPatClinicalData=[],F.expLengthUnit={},F.clinicalBedClass={},F.tempclinicalBedClass=void 0,F.expLengthUnitdesc=" ",F.PatClinicalData=[],F.preauthbillseqid=void 0,F.submitted="N",F.preAuthFlag=2,F.DiagnosisData=[],F.payerArr=[],F.subAccSeqId={},F.totalmrtlprice=[],F.flow=void 0,F.enseqid=void 0,F.mrNo={},F.epSeqId={},F.temppreAuthDetailsGridOtions=[],F.tempapprovalDataList=[],F.approvalDataList=[],F.delpreAuthDetailsGridOtions=[],F.visitdisableflag=!1,F.delgridOptionsDiagnosis=[],F.delgridOptionsProcedure=[],F.prevoisIndex=void 0,F.Enhanceflag=!1,F.updateEnhanceflag=!1,F.currentvisitflag=!1,F.approxBillNo=void 0,F.isPreauthorLimit=void 0,F.isCurrentorFuture=void 0,F.preAuthList=[],F.LimitList=[],F.currentdata=void 0,F.futuredata=void 0,F.duppreAuthDetailsGridOtions=[],F.preAuthNoList=[],F.payerchange=!1,F.preAuthserviceDetails=[],F.directApproval=!1,F.updateApproval=!1,F.authAprServiceLevel=!1,F.authAprBillLevel=!1,F.ServiceStatus=2,F.ServiceStatusDesc="InActive",F.tempauthApprovalGrid=[],F.dupapproxBillHdSeqId=void 0,F.requestScrFooterTotalAmt=0,F.inactivateApp=!0,F.authactive=!1,F.mrnoactive=!1,F.vnactive=!1,F.ipactive=!1,e.preNew={},F.savepayerinfo=[],F.disabledate=!1,F.patientBillingServiceData=[],v.loadAlerts(w).then(function(t){F.alertData=t,e.alertData={buttonText:F.alertData.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}}),e.open1=function(){e.popup1.opened=!0},e.popup1={opened:!1},e.open2=function(){e.popup2.opened=!0},e.popup2={opened:!1},F.DateOptions={minDate:new Date,startingDay:1},C.loadExpectedlength().then(function(e){F.ExpectedlengthList=e,F.ExpectedlengthList.length>0&&(F.expLengthUnit=F.ExpectedlengthList[0].DT_CODE)}),F.estData=JSON.parse(sessionStorage.getItem("estPatInfo")),null!=F.estData&&(F.estData.mrno&&d.paitentAutoSearchWithOutStatus(F.estData.mrno).then(function(e){F.visitType=F.estData.visitType,F.flow=4,F.searchPatientResult(e[0]),null!=F.estData.APPROX_BILL_HD_SEQ_ID&&x(F.estData)}),sessionStorage.removeItem("estPatInfo")),F.dataSetter=function(e,t,a){F.flow=e,4==e?F.searchPatientResult(t):2==e?(F.searchPatientResult(t),F.onVisitorIPFlow(a,t)):1==e&&(F.searchPatientResult(t),F.onVisitorIPFlow(a,t))},F.onBedChange=function(e){1!=F.flow&&2!=F.flow||function(e,t,a,i){if(e&&t&&a)C.getEnBasedServiceDetails(t,e,a,i).then(function(e){null!=F.patientBillingServiceData&&F.patientBillingServiceData.length>0&&(e=angular.copy(F.patientBillingServiceData),F.patientBillingServiceData=[]);if(F.preAuthDetailsGridOtions.data=[],F.preAuthDetailsGridOtions.data[0]=[],F.preAuthDetailsGridOtions.data[0].applicabilityType=F.applicabilityList[0],e.length>0){F.authApprovalGrid.data=[];for(let t=0;t<e.length;t++){let a={valueAmt:e[t].SERVICE_RATE,qty:e[t].QTY,serviceApprovalStatus:e[t].SERV_APPRV_STATUS,isOrderFrom:e[t].IS_SERVICE_FROM,manualFlag:1==e[t].IS_ORDER_FROM,isApprovalRequired:e[t].SERV_APPRV_STATUS,priServGroup:{DESCRIPTION:e[t].PSRVGRP,CODE:e[t].PSRVGRPCODE,IS_MATERIAL:e[t].IS_MATERIAL},department:{DESCRIPTION:e[t].DEPTDESC,CODE:e[t].DEPTCODE},specialty:{DESCRIPTION:e[t].SPCLDESC,CODE:e[t].SPCLCODE},service:{SERV_NAME:e[t].SERV_NAME,SERV_SEQ_ID:e[t].SERV_SEQ_ID},ismaterial:e[t].IS_MATERIAL,totalamount:e[t].TOTALAMOUNT,applicabilityType:{DETAIL_DESC:F.applicabilityList[0].DETAIL_DESC,DT_CODE:F.applicabilityList[0].DT_CODE}};F.preAuthDetailsGridOtions.data.push(a),F.isServiceLevelFlag=!0;let i=angular.copy(a);i.approvedDetails="",i.approvedAmount="",i.approvedQty="",i.remarks="",F.authApprovalGrid.data.push(i)}B(F.preAuthDetailsGridOtions.data),1==F.directApproval&&F.authApprovalGrid.data.splice(0,0,{applicabilityType:F.applicabilityList[0]})}})}(F.visitType,F.enseqid,F.planseqid,F.clinicalBedClass),null==e&&(e=!1),3!=F.flow||1!=F.payerchange&&1!=e||C.getPreAuthonPayerChangeServiceDetails(F.enseqid,F.preauthbillseqid,F.planseqid,F.clinicalBedClass).then(function(e){!function(e){if(F.preAuthDetailsGridOtions.data=[],F.preAuthDetailsGridOtions.data[0]=[],F.preAuthserviceDetails=[],e.length>0)for(let t=0;t<e.length;t++){let a={isAmtNlPercFlag:e[t].IS_AMT_PERC_NL_CODE,apprIsAmtPercNl:null!=e[t].APPR_IS_AMT_PERC_NL?e[t].APPR_IS_AMT_PERC_NL+"":"",approxBillDtSeqId:e[t].PREAUTH_BILL_DT_SEQ_ID,valueAmt:e[t].CHARGEABLE_AMT?e[t].CHARGEABLE_AMT:e[t].CHARGABLE_AMT,qty:e[t].SERV_QTY,serviceApprovalStatus:e[t].SERV_APPR_STSTUS,isOrderFrom:e[t].IS_ORDER_FROM,serviceType:e[t].SERVICE_HIERARCHY_LEVEL,manualFlag:1==e[t].IS_ORDER_FROM,isApprovalRequired:e[t].SERV_APPR_STSTUS,priServGroup:{DESCRIPTION:e[t].PRI_SERV_DESC,CODE:e[t].PRI_SERV_CODE,IS_MATERIAL:e[t].IS_MATERIAL},department:{DESCRIPTION:e[t].DEPT_DESC,CODE:e[t].DEPT_CODE},specialty:{DESCRIPTION:e[t].SPL_DESC,CODE:e[t].SPL_CODE},service:{SERV_NAME:e[t].SERV_NAME,SERV_SEQ_ID:e[t].SERV_SEQ_ID},approvedDetails:e[t].APPROVD_DTLS,approvedAmount:e[t].APPROVED_AMNT,approvedQty:e[t].APPROVED_QTY,remarks:e[t].APPROVE_REMARKS,ismaterial:e[t].IS_MATERIAL,applicabilityType:{DETAIL_DESC:e[t].APPLICABILITY_TYPE_DESC,DT_CODE:e[t].APPLICABILITY_TYPE}};F.preAuthserviceDetails.push(a),F.isServiceLevelFlag=!0}angular.forEach(F.preAuthserviceDetails,function(e,t){j(e)})}(e)})},F.loadBedClass=function(e,t){C.bedClassSearch(e,t).then(function(e){F.bedClassList=e,F.bedClassList.length>0&&(1==F.visitType?F.tempclinicalBedClass?F.clinicalBedClass=F.tempclinicalBedClass:F.clinicalBedClass=F.bedClassList[0].CODE:F.clinicalBedClass=void 0),F.onBedChange()})},F.visitTypechange=function(){if(1==F.visitType){let e={},t={};e.planName=F.planName,e.INC_PLAN_SEQ_ID=F.planseqid,t.payerName=F.payerName,t.incSeqId=F.payerseqid,F.loadBedClass(t,e),F.expLengthUnit=F.ExpectedlengthList[0].DT_CODE}else 2==F.visitType&&(F.clinicalBedClass=void 0,F.expLengthUnit=void 0)},F.patientDetailsSearch={ListDiagonsis:[]},F.estimateCost=0,e.estimateCost=0,e.grossAmount=0,e.discounts=0,F.discounts=0,F.netAmount=0,e.patBanShow=!1,e.checkLogicBedCLass=function(t){if(null!=e.bedClassName&&null!=e.bedClassName&&null!=e.bedClassName.gQDataName&&null!=e.preNew.estimateSct&&null!=e.preNew.estimateSct&&null!=e.preNew.estimateSct.gQDataName&&e.preNew.estimateSct.gQDataName==e.bedClassName.gQDataCode);else if(null!=e.preNew.estimateSct&&null!=e.preNew.estimateSct&&null!=e.preNew.estimateSct.gQDataName&&null!=e.bedClassName&&null!=e.bedClassName&&null!=e.bedClassName.gQDataName){var a=F.alertData.plzChangeTrifClsEstNo;m.hisAlertMulti("information",F.alertData.alertTypeInfo,a,e.alertData,e.alertFunction,e.close)}},F.checkBedClass=function(t){if(null!=t&&null!=t)if("NO"==t.Pre_AuthGenerated)G(),x(t);else{let a="Already Pre-Authorization Generated For This "+t.EstimateBillNumber+". Do You Want To Continue?",i={buttonText:F.alertData.no,buttonText2:F.alertData.yes},r={buttonCallBack1:function(){e.preNew.estimateSct=void 0},buttonCallBack2:function(){G(),x(t)}},n={buttonClose:function(){e.preNew.estimateSct=void 0}};m.hisAlertMulti("information",F.alertData.alertTypeInfo,a,i,r,n)}},F.onVisitorIPFlow=function(e,t){F.enseqid=t.EN_SEQ_ID,F.epSeqId=t.EP_SEQ_ID,1==e?F.flow=1:2==e&&(F.flow=2),F.visitdisableflag=!0,function(e,t){C.getVisitorIPBasedClinicalDetails(e,t).then(function(t){2==e?(F.opPatClinicalData=t,F.expDate=new Date(F.opPatClinicalData[0].ADMITTED_DT),F.admReason=F.opPatClinicalData[0].REASON_FOR_VISIT,F.tempclinicalBedClass=void 0):1==e&&(F.ipPatClinicalData=t,F.expDate=new Date(F.ipPatClinicalData[0].ADMITTED_DT),F.estLengthStay=F.ipPatClinicalData[0].LOS,F.expLengthUnit=F.ipPatClinicalData[0].LOS_TYPE,F.admReason=F.ipPatClinicalData[0].REASON_FOR_VISIT,F.tempclinicalBedClass=0!=F.ipPatClinicalData[0].BED_CLASS_CODE?F.ipPatClinicalData[0].BED_CLASS_CODE:void 0)})}(e,t.VISIT_NO),function(e,t){C.getVisitorIPBasedPayerDetails(e,t).then(function(t){2==e?(F.PatPayerData=t,F.PatPayerData.length>0&&angular.forEach(F.PatPayerData,function(e,t){null!=e.INC_SEQ_ID&&(H(e,F.flow),0==t&&q(e))})):1==e&&(F.PatPayerData=t,F.PatPayerData.length>0&&angular.forEach(F.PatPayerData,function(e,t){null!=e.INC_SEQ_ID&&(H(e,F.flow),0==t&&q(e))}))})}(e,t.VISIT_NO),function(e,t){C.getEnBasedProcedureDetails(t).then(function(t){let a={};2==e?(F.opProcedureData=t,angular.forEach(F.opProcedureData,function(e,t){a.ICD9=e.STANDARD_CODE,a.CODE=e.STANDARD_CODE,a.DESCRIPTION=e.STANDARD_NAME,a.SUR_CODE=e.HOSP_CODE,a.SUR_NAME=e.HOSP_NAME,F.gridOptionsProcedure.data.push(a),a={}})):1==e&&(F.ipProcedureData=t,angular.forEach(F.ipProcedureData,function(e,t){a.ICD9=e.STANDARD_CODE,a.CODE=e.STANDARD_CODE,a.DESCRIPTION=e.STANDARD_NAME,a.SUR_CODE=e.HOSP_CODE,a.SUR_NAME=e.HOSP_NAME,F.gridOptionsProcedure.data.push(a),a={}}))})}(e,t.EN_SEQ_ID),function(e,t){C.getEnBasedDiagnosisDetails(t).then(function(t){let a={};2==e?(F.opDiagnosisData=t,angular.forEach(F.opDiagnosisData,function(e,t){a.ICDCODE=e.STANDARD_CODE,a.DESCRIPTION=e.STANDARD_NAME,a.HOSP_DIAG_CODE=e.HOSP_CODE,a.HOSP_DIAG_DESC=e.HOSP_NAME,F.gridOptionsDiagnosis.data.push(a),a={}})):1==e&&(F.ipDiagnosisData=t,angular.forEach(F.ipDiagnosisData,function(e,t){a.ICDCODE=e.STANDARD_CODE,a.DESCRIPTION=e.STANDARD_NAME,a.HOSP_DIAG_CODE=e.HOSP_CODE,a.HOSP_DIAG_DESC=e.HOSP_NAME,F.gridOptionsDiagnosis.data.push(a),a={}}))})}(e,t.EN_SEQ_ID)},e.changeCatCode=function(t){null!=t&&null!=t.gQDataCode?e.showErrorPatCat=!1:e.showErrorPatCat=!0},F.getPreAuthNoList=function(e){F.preAuthNoList=[],F.multipleListObj={1:F.preAuthNoList};var a=t.executeQueryURLReset();F.paramArray=new Array,t.prepareParamList(1,e,F.paramArray),t.executeQueryInput("GET_PRE_AUTH_NUMBER_LIST",F.paramArray,F.multipleListObj,!0,!0,a,"popUp",{}).then(function(e){if(e[1][0])for(var t=0;t<F.preAuthNoList.length;t++){if(F.getAuthList)for(var a=_.split(F.getAuthList),i=0;i<a.length;i++)a[i]==F.preAuthNoList[t].PREAUTH_BILL_HD_SEQ_ID&&(F.preAuthNoList[t].preAuthCheck=!0);1==F.preAuthNoList[t].IS_CHECK_PREAUTH&&(F.preAuthNoList[t].preAuthCheck=!0)}})},e.getPatientDetails=function(a){F.estimateNumber=[],F.multipleComboData={1:F.estimateNumber};var i=t.executeQueryURLReset();F.estimateNumberList=new Array,t.prepareParamList(1,a.regSeqId,F.estimateNumberList),t.executeQueryInput("PREAUTH_PAT_BL_LIST",F.estimateNumberList,F.multipleComboData,!0,!0,i,"popUp",{}).then(function(a){console.log(F.estimateNumber),F.dupapproxBillHdSeqId&&(e.preNew.estimateSct=t.getObjectByAnyValue(F.estimateNumber,F.dupapproxBillHdSeqId,"APPROX_BILL_HD_SEQ_ID"),null==e.preNew.estimateSct&&(F.dupapproxBillHdSeqId=void 0))}),F.getAccSeqList=[];F.getAccSeqList;if(!angular.isUndefined(a.StrPatientCategory)&&!angular.isUndefined(a.StrPayer)&&null!=F.payerTypeList)for(var r=0;r<F.payerTypeList.length;r++)F.payerTypeList[r].gQDataCode==parseInt(a.StrPayer)&&(F.patientDetailsSearch.payerType=F.payerTypeList[r]);e.regSqId=a.regSeqId;var n="1",l=a;n=null!=l.admissionSeqid?"1":"2",u.getPatientBanner(l,n).then(function(t){e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=12,F.subAccSeqId=t.subAccSeqId,F.mrNo=t.mrNo,3!=F.flow&&F.getPreAuthNoList(a.regSeqId),t.visitNO&&(null==F.authorizationreqno||F.authorizationreqno.PREAUTH_BILL_HD_SEQ_ID)&&3!=F.flow?F.visitType=2:t.ipNo&&(null==F.authorizationreqno||F.authorizationreqno.PREAUTH_BILL_HD_SEQ_ID)&&3!=F.flow&&(F.visitType=1),t.ipNo&&(F.fromOptions.maxDate=new Date(null!=t.admissionDate.$?t.admissionDate.$:t.admissionDate),F.toOptions.minDate=F.fromOptions.maxDate)}),o.patientBannerDetail(a.regSeqId).then(function(t){e.patientBannerDetails=t,e.patBanShow=!0,e.patientRecordsDetail=e.patientBannerDetails.patientRecordsDetail})},F.searchPatientByMRNO=function(e){return d.paitentAutoSearchWithOutStatus(e).then(function(e){return e})},F.searchPatientResult=function(t,a){let i=angular.copy(F.flow),r=angular.copy(F.visitType);angular.copy(t);F.clear(),null==a&&(F.dupapproxBillHdSeqId=void 0),F.flow=i,F.visitType=r,2==i?(M(F.flow),F.visitno=t):4==i?(M(F.flow),F.patientId=t):1==i?(M(F.flow),F.patientipno=t):6==i&&(null!=t.mrNo?F.patientId=t:1==F.visitType?F.patientipno=t:2==F.visitType&&(F.visitno=t)),null!=t&&null!=t&&""!=t&&null==t.mrNo&&null==t.RG_INT_MR_NO&&null==t.uhId?d.paitentAutoSearchWithOutStatus(t).then(function(t){F.patientDetailsSearch=t[0],e.getPatientDetails(t[0])}):null!=t&&null!=t&&""!=t&&null==t.mrNo&&(t.RG_INT_MR_NO||t.uhId)?(null!=t.RG_INT_MR_NO?t=t.RG_INT_MR_NO:null!=t.uhId&&(t=t.uhId),d.paitentAutoSearchWithOutStatus(t).then(function(t){F.patientDetailsSearch=t[0],e.getPatientDetails(t[0])})):(4==F.flow&&C.getPayerBasedMrNo(t.mrNo).then(function(e){angular.forEach(e,function(e,t){H(e,F.flow)})}),F.patientDetailsSearch=t,e.getPatientDetails(t))},F.dignsisModel=[],F.dignsisSettings={scrollable:!0,scrollableHeight:"200px",enableSearch:!0,enableStringLimit:!0,limitCharLength:20,smartButtonMaxItems:2};var V=r("translate")("billing.slctDig");function B(e){let t=1;"Y"==F.submitted&&(t=0),F.requestScrFooterTotalAmt=0;for(let a=t;a<e.length;a++)null!=e[a].valueAmt&&null!=e[a].valueAmt&&""!==e[a].valueAmt&&(F.requestScrFooterTotalAmt=F.requestScrFooterTotalAmt+parseFloat(e[a].valueAmt))}function U(t,a,i,r){1==i?(r.approvedDetails=t.entity.approvedDetails,r.approvedQty=t.entity.approvedQty,r.approvedAmount=t.entity.approvedAmount,r.previousApprovedQty=t.entity.previousApprovedQty,r.previousApprovedAmount=t.entity.previousApprovedAmount,r.apprIsAmtPercNl=t.entity.apprIsAmtPercNl+"",r.preAuthBillAprDtSeqId=t.entity.preAuthBillAprDtSeqId,F.authApprovalGrid.data[0]=r,F.authApprovalGrid.data[0].editable=!0,F.authApprovalGrid.data[0].recordIndex=a,e.toggleText="UPDATE",F.changePriServ(t.entity.priServGroup,F.authApprovalGrid.data[0],t.entity,!0)):(F.preAuthDetailsGridOtions.data[0]=r,F.preAuthDetailsGridOtions.data[0].editable=!0,F.preAuthDetailsGridOtions.data[0].recordIndex=a,e.toggleText="UPDATE",F.changePriServ(t.entity.priServGroup,F.preAuthDetailsGridOtions.data[0],t.entity,!0))}function k(e){var t;return e.service&&e.service.SERV_SEQ_ID&&e.priServGroup&&e.priServGroup.CODE&&e.department&&e.department.CODE&&e.specialty&&e.specialty.CODE?t=4:e.specialty&&e.priServGroup&&e.department&&e.priServGroup.CODE&&e.department.CODE&&e.specialty.CODE?t=3:e.priServGroup&&e.department&&e.priServGroup.CODE&&e.department.CODE?t=2:e.priServGroup&&e.priServGroup.CODE&&(t=1),t}function Q(e,t,a){return 0==e.filter(function(e){if(1==a){if(e.ICDCODE==t.ICDCODE)return!0}else if(2==a&&e.CODE==t.CODE)return!0}).length}function j(e){let t,a,i,r,n=null==F.planName||null==F.planName?-999:F.planName.INC_PLAN_SEQ_ID?F.payerName.incSeqId:F.planseqid?F.planseqid:-999,l={};null==e.priServGroup?(t="",a=-999):(t=e.priServGroup.IS_MATERIAL,a=e.priServGroup.CODE),i=null==e.department?-999:e.department.CODE,r=null==e.specialty?-999:e.specialty.CODE,l=null==e.service?-999:e.service.SERV_SEQ_ID,C.getInclusiveStatus(t,n,a,i,l,r).then(function(t){t.length>0&&(e.isApprovalRequired=t[0].INCLUSION_STATUS),F.preAuthDetailsGridOtions.data.push(e),B(F.preAuthDetailsGridOtions.data),console.log(t)})}function H(e,t){let a={};2==t||1==t||4==t||3==t?(a.CARD_NUMBER=e.CARD_NUMBER,a.POLICY_NO=e.POLICY_NO,a.COMP_NAME=e.COMP_NAME,a.INC_SEQ_ID=e.INC_SEQ_ID,a.PLAN_NAME=e.PLAN_NAME,a.IN_PLC_SEQ_CD=e.IN_PLC_SEQ_CD,a.PI_FROM_DATE=new Date(e.PI_FROM_DATE),a.PI_TO_DATE=new Date(e.PI_TO_DATE),F.payerArr.push(a),a={}):5==t?(a.CARD_NUMBER=e.cardNumber,a.POLICY_NO=e.policyNumber,a.COMP_NAME=e.payerName,a.INC_SEQ_ID=e.payerseqid,a.PLAN_NAME=e.planName,a.IN_PLC_SEQ_CD=e.planseqid,a.PI_FROM_DATE=new Date(e.savevalidFrom),a.PI_TO_DATE=new Date(e.savevalidTo),F.payerArr.push(a),a={}):6==t&&(a.CARD_NUMBER=e.CARD_NUMBER,a.POLICY_NO=e.POLICY_NO,a.COMP_NAME=e.INC_COMP_NAME,a.INC_SEQ_ID=e.INC_SEQ_ID,a.PLAN_NAME=e.INC_PLAN_NAME,a.IN_PLC_SEQ_CD=e.INC_PLAN_SEQ_ID,a.PI_FROM_DATE=new Date(e.PLAN_VALID_FROM),a.PI_TO_DATE=new Date(e.PLAN_VALID_TO),F.payerArr.push(a),a={})}F.dignsisTexts={buttonDefaultText:V+"....",dynamicButtonTextSuffix:r("translate")("billing.digSlctd"),showDynamicButtonSelectedLength:4},F.digansisData=[],F.diagnosisDtls=function(){i.diagnosisDtlsService().then(function(t){e.diagnosisDtls=t.data.HITService.message.listDiagonsis[0]["com.napier.core.billgeneration.vo.DiagnosisDetailsVo"]})},F.diagnosisDtls(),e.diagnosisValue=function(t){t.length>2?F.digansisData=e.diagnosisDtls:F.digansisData=F.dignsisModel},e.loadDigns=function(){return a(function(){e.searchTerm="",F.digansisData=F.dignsisModel})},F.changeICD=function(e){if(e.length>0){for(var t=" ",a=0;a<e.length;a++)a==e.length-1?t+=e[a].StrDiagnosisCode:t=t+e[a].StrDiagnosisCode+" , ";F.ICDCodeValue=t}else F.ICDCodeValue=""},F.uploadFile=function(t){y.fileUploadCheck(t,F,e)},F.preAuthFile=function(e){y.removeUploadedFile(e,F)},E.loadServiceLevelGrid(F,"preNew",!1),F.changePriServ=function(e,t,a,i){C.getDepartment(F,e,t,a,i)},F.changeDept=function(e,t,a,i,r){C.getSpeciltyData(F,e,t,a,i,r)},F.serviceSearch=function(e,t){return C.getServiceList(t,e,F)},F.changeSpecialty=function(e,t){t.inActiveVal&&(t.service=void 0,t.valueAmt="",t.qty="",t.applicabilityType=F.applicabilityList[0],t.approvedDetails=void 0,t.approvedAmount=void 0,t.approvedQty=void 0,t.apprIsAmtPercNl=void 0)},F.addRowGrid=function(t,a){let i,r,n,l,s=null==F.planName||null==F.planName?-999:F.planName.INC_PLAN_SEQ_ID?F.payerName.incSeqId:F.planseqid?F.planseqid:-999,o={};if(null==t.entity.priServGroup?(i="",r=-999):(i=t.entity.priServGroup.IS_MATERIAL,r=t.entity.priServGroup.CODE),n=null==t.entity.department?-999:t.entity.department.CODE,l=null==t.entity.specialty?-999:t.entity.specialty.CODE,null==t.entity.service)o=-999;else{if(null==t.entity.service.SERV_SEQ_ID){t.entity.service=void 0,t.entity.valueAmt="",t.entity.qty="",t.entity.applicabilityType=F.applicabilityList[0],t.entity.approvedDetails=void 0,t.entity.approvedAmount=void 0,t.entity.approvedQty=void 0,t.entity.apprIsAmtPercNl=void 0;let a="Please select valid Service";return void m.hisAlertMulti("warning",F.alertData.alertTypeWarn,a,!1,!1,e.close,2e3)}o=t.entity.service.SERV_SEQ_ID}C.getInclusiveStatus(i,s,r,n,o,l).then(function(i){let r={};if(r.priServGroup=t.entity.priServGroup,r.department=t.entity.department,r.specialty=t.entity.specialty,r.service=t.entity.service,r.valueAmt=t.entity.valueAmt,r.applicabilityType=t.entity.applicabilityType,r.approvedDetails=t.entity.approvedDetails,r.approvedQty=t.entity.approvedQty,r.approvedAmount=t.entity.approvedAmount,r.isAmtNlPercFlag=t.entity.isAmtNlPercFlag,r.apprIsAmtPercNl=t.entity.apprIsAmtPercNl,r.previousApprovedQty=t.entity.previousApprovedQty,r.previousApprovedAmount=t.entity.previousApprovedAmount,r.qty=t.entity.qty,r.ismaterial=t.entity.priServGroup.IS_MATERIAL,r.manualFlag=null==t.entity.manualFlag||t.entity.manualFlag,r.isOrderFrom=r.manualFlag?1:2,r.approxBillDtSeqId=t.entity.approxBillDtSeqId?t.entity.approxBillDtSeqId:void 0,r.preAuthBillAprDtSeqId=t.entity.preAuthBillAprDtSeqId?t.entity.preAuthBillAprDtSeqId:void 0,r.dupvalueAmt=null!=t.entity.dupvalueAmt?t.entity.dupvalueAmt:void 0,i.length>0&&(r.isApprovalRequired=i[0].INCLUSION_STATUS,r.serviceApprovalStatus=i[0].INCLUSION_STATUS),null!=r.priServGroup||null!=r.department||null!=r.specialty||null!=r.service&&""!=r.service){let i=!0;if((i=null!=r.valueAmt&&""!==r.valueAmt||null!=r.qty&&""!==r.qty)&&null!=r.valueAmt&&""!=r.valueAmt&&parseFloat(r.valueAmt)>0||null!=r.qty&&""!=r.qty&&parseFloat(r.qty)>0)if(i&&!t.entity.editable){D.validDuplicate(F,r,a)?(a?F.authApprovalGrid.data.push(r):F.preAuthDetailsGridOtions.data.push(r),a?F.authApprovalGrid.data[0]=[]:F.preAuthDetailsGridOtions.data[0]=[],a?T.calTotalApprovalAmt(F.authApprovalGrid.data,F.appr,F):B(F.preAuthDetailsGridOtions.data),a?T.calTotalViewApprovalAmt(F.authApprovalGrid.data,F.appr,F):B(F.preAuthDetailsGridOtions.data),F.clearRecordFirst(t,a),F.preAuthValue=D.calPreAuthAmt(F.preAuthDetailsGridOtions.data),F.preAuthForServ=angular.copy(F.preAuthValue)):m.hisAlertMulti("information",F.alertData.alertTypeInfo,F.alertData.alreadySameRcrdExistUpdateValue,e.alertData,e.alertFunction,e.close)}else t.entity.editable?(a?F.authApprovalGrid.data[t.entity.recordIndex]=r:F.preAuthDetailsGridOtions.data[t.entity.recordIndex]=r,a?F.authApprovalGrid.data[t.entity.recordIndex].deleteDisble=!1:F.preAuthDetailsGridOtions.data[t.entity.recordIndex].deleteDisble=!1,a?T.calTotalApprovalAmt(F.authApprovalGrid.data,F.appr,F):B(F.preAuthDetailsGridOtions.data),a?T.calTotalViewApprovalAmt(F.authApprovalGrid.data,F.appr,F):B(F.preAuthDetailsGridOtions.data),e.toggleText="",a?F.authApprovalGrid.data[0]=[]:F.preAuthDetailsGridOtions.data[0]=[],F.clearRecordFirst(t,a),F.preAuthValue=D.calPreAuthAmt(F.preAuthDetailsGridOtions.data),F.preAuthForServ=angular.copy(F.preAuthValue)):m.hisAlertMulti("information",F.alertData.alertTypeInfo,F.alertData.pleaseEnterAmtOrQty,e.alertData,e.alertFunction,e.close);else m.hisAlertMulti("information",F.alertData.alertTypeInfo,F.alertData.amtQtyCantBeZero,e.alertData,e.alertFunction,e.close)}else m.hisAlertMulti("information",F.alertData.alertTypeInfo,F.alertData.pleaseSelectAnyGroupOrServiceAmtQty,e.alertData,e.alertFunction,e.close)})},F.editGridData=function(e,a,i){null!=F.prevoisIndex&&F.prevoisIndex!=a&&null!=F.preAuthDetailsGridOtions.data[F.prevoisIndex]&&(F.preAuthDetailsGridOtions.data[F.prevoisIndex].deleteDisble=!1),e.entity.deleteDisble=!0,F.prevoisIndex=a;let r={},n=_.find(F.priServGroupList,function(t){return t.CODE==e.entity.priServGroup.CODE});r.priServGroup=n,r.department=e.entity.department,r.specialty=e.entity.specialty,r.service=null!=e.entity.service&&null!=e.entity.service.SERV_SEQ_ID?e.entity.service:void 0,r.valueAmt=e.entity.valueAmt,r.approxBillDtSeqId=e.entity.approxBillDtSeqId?e.entity.approxBillDtSeqId:void 0,r.applicabilityType=t.getObjectByAnyValue(F.applicabilityList,e.entity.applicabilityType.DT_CODE,"DT_CODE"),r.isAmtNlPercFlag=e.entity.isAmtNlPercFlag+"",r.qty=e.entity.qty,r.manualFlag=null==e.entity.manualFlag||e.entity.manualFlag,r.inActiveVal=!0,null==e.entity.dupvalueAmt&&"N"==e.entity.ismaterial?null!=e.entity.service?C.getRateBasedonPlan(e.entity.service.SERV_SEQ_ID,F.tariffSeqId,F.clinicalBedClass,F.planseqid).then(function(t){t.length>0&&(r.dupvalueAmt=t[0].VALUE),U(e,a,i,r)}):null==e.entity.service&&U(e,a,i,r):null==e.entity.dupvalueAmt&&"Y"==e.entity.ismaterial?null!=e.entity.service?C.getServiceList(e.entity,e.entity.service.SERV_NAME).then(function(t){t.length>0&&(r.dupvalueAmt=t[0].MRP),U(e,a,i,r)}):null==e.entity.service&&U(e,a,i,r):null!=e.entity.dupvalueAmt&&(r.dupvalueAmt=e.entity.dupvalueAmt,U(e,a,i,r))},F.clearRecordFirst=function(t,a){null!=t&&t.entity.editable&&(1==a?F.authApprovalGrid.data[t.entity.recordIndex].deleteDisble=!1:F.preAuthDetailsGridOtions.data[t.entity.recordIndex].deleteDisble=!1,t.entity.editable=!1,e.toggleText="");var i={valueAmt:"",qty:"",deleteDisble:!1};i.applicabilityType=F.applicabilityList[0],F.speciltyList=[],F.deptList=[],1==a?F.authApprovalGrid.data[0]=i:F.preAuthDetailsGridOtions.data[0]=i},F.deleteRecord=function(e,t,a){let i={buttonText:F.alertData.no,buttonText2:F.alertData.yes},r={buttonCallBack1:function(){},buttonCallBack2:function(){a?(null!=F.authApprovalGrid.data[t].preAuthBillAprDtSeqId&&(F.authApprovalGrid.data[t].gnStatus=2,F.delAuthApprovalGrid.push(F.authApprovalGrid.data[t])),F.authApprovalGrid.data.splice(t,1),T.calTotalApprovalAmt(F.authApprovalGrid.data,F.appr,F),T.calTotalViewApprovalAmt(F.authApprovalGrid.data,F.appr,F)):(F.delpreAuthDetailsGridOtions.push(F.preAuthDetailsGridOtions.data[t]),F.preAuthDetailsGridOtions.data.splice(t,1),B(F.preAuthDetailsGridOtions.data),F.preAuthValue=D.calPreAuthAmt(F.preAuthDetailsGridOtions.data),F.preAuthForServ=angular.copy(F.preAuthValue))}};m.hisAlertMulti("information",F.alertData.alertTypeInfo,F.alertData.doYouWantDelRcrd,i,r,{buttonClose:function(){}})},F.getPreAuth=function(t){2==t?(F.preAuthValue=D.calPreAuthAmt(F.preAuthDetailsGridOtions.data),F.preAuthForServ=angular.copy(F.preAuthValue)):(F.preAuthForServ=void 0,F.preAuthValue=0,null!=e.preNew.estimateSct&&null!=e.preNew.estimateSct.APPROX_BILL_HD_SEQ_ID&&(F.preAuthDetailsGridOtions.data=[],F.clearRecordFirst(),e.preNew.estimateSct=void 0))},F.onSelected=function(t,a){if(C.getDropDownBasedService(t,a,F),F.tariffSeqId&&"N"==a.priServGroup.IS_MATERIAL)C.getRateBasedonPlan(t.SERV_SEQ_ID,F.tariffSeqId,F.clinicalBedClass,F.planseqid).then(function(t){if(console.log(a),t.length>0)a.valueAmt=t[0].VALUE,a.dupvalueAmt=t[0].VALUE,a.qty=1,a.applicabilityType=F.applicabilityList[0],a.approvedDetails=void 0,a.approvedAmount=void 0,a.approvedQty=void 0,a.apprIsAmtPercNl=void 0;else{a.valueAmt="",a.dupvalueAmt="",a.qty="",a.applicabilityType=F.applicabilityList[0],a.approvedDetails=void 0,a.approvedAmount=void 0,a.approvedQty=void 0,a.apprIsAmtPercNl=void 0,m.hisAlertMulti("warning",F.alertData.alertTypeWarn,"Rate not defined",!1,!1,e.close,2e3)}});else if(F.tariffSeqId&&"Y"==a.priServGroup.IS_MATERIAL)if(null==a.service.MRP){a.valueAmt="",a.dupvalueAmt="",a.qty="",a.applicabilityType=F.applicabilityList[0],a.approvedDetails=void 0,a.approvedAmount=void 0,a.approvedQty=void 0,a.apprIsAmtPercNl=void 0,m.hisAlertMulti("warning",F.alertData.alertTypeWarn,"Rate not defined",!1,!1,e.close,2e3)}else a.valueAmt=a.service.MRP,a.dupvalueAmt=a.service.MRP,a.qty=1,a.applicabilityType=F.applicabilityList[0],a.approvedDetails=void 0,a.approvedAmount=void 0,a.approvedQty=void 0,a.apprIsAmtPercNl=void 0},F.isChangedVal=function(e){null!=e&&""!=e&&"."!=e?null!=F.preAuthForServ&&parseFloat(e)<parseFloat(F.preAuthForServ)&&(F.preAuthValue=angular.copy(F.preAuthForServ)):F.preAuthValue=0},F.downloadFile=function(e){y.downloadDocument(e)},F.close=function(){f.go("index.billingSub.preAuthList",{id:void 0})},F.expDatechange=function(){let e=document.getElementById("expDateId").className;console.log(e),!e.includes("ng-invalid-date")||e.includes("ng-valid-date-add")&&e.includes("ng-valid-date")?F.disabledate=!1:F.disabledate=!0},F.clear=function(){e.patBanShow=!1,F.inactivateApp=!0,F.preAuthDetailsGridOtions.columnDefs[11].visible=!0,F.preAuthDetailsGridOtions.columnDefs[9].visible=!1,F.preAuthDetailsGridOtions.columnDefs[8].visible=!1,F.preAuthDetailsGridOtions.data=[],F.preAuthDetailsGridOtions.data[0]=[],F.clearRecordFirst(),F.filesUploaded=[],F.preAuthValue=0,e.remarks=void 0,e.preNew.estimateSct=void 0,F.patientId=void 0,F.patientipno=void 0,F.filesUploaded=[],F.uploadedfileNames=[],F.uploadingFile=!1,F.gridOptionsDiagnosis.data=[],F.gridOptionsProcedure.data=[],F.visitType=2,F.serviceApprovalStatus=1,F.isBillLevelFlag=!1,F.isServiceLevelFlag=!1,F.opPatData=[],F.opProcedureData=[],F.opDiagnosisData=[],F.ipPatData=[],F.PatPayerData=[],F.ipProcedureData=[],F.ipDiagnosisData=[],F.opPatClinicalData=[],F.ipPatClinicalData=[],F.expLengthUnit={},F.clinicalBedClass=void 0,F.tempclinicalBedClass=void 0,F.authorizationreqno=void 0,F.visitno=void 0,F.chiefComplaints=void 0,F.admReason=void 0,F.procedure={},F.procedure.type=1,F.procedure.desc="",F.procedure.code="",F.procedureList=[],F.diagnosis={},F.diagnosis.type=1,F.diagnosis.desc="",F.diagnosis.code="",F.diagnosisList=[],F.expDate=new Date,F.estLengthStay=void 0,F.billLevelCap=void 0,F.remarks=void 0,F.expLengthUnit=null!=F.ExpectedlengthList&&null!=F.ExpectedlengthList[0]&&null!=F.ExpectedlengthList[0].DT_CODE?F.ExpectedlengthList[0].DT_CODE:void 0,F.payerName=void 0,F.planName=void 0,F.policyNumber=void 0,F.cardNumber=void 0,F.validFrom=void 0,F.validTo=void 0,F.approvalActive=!1,e.preNew.activefirst=1,F.preauthbillseqid=void 0,F.submitted="N",F.subAccSeqId={},F.totalmrtlprice=[],F.flow=void 0,F.enseqid=void 0,F.mrNo={},F.epSeqId={},F.payerArr=[],F.preNewFiles=[],F.deleteFiles=[],F.numOffiles=0,F.totalFileSize=0,F.payerseqid={},F.planseqid={},F.fromOptions={},F.toOptions={},F.expDate=void 0,F.apprvalSaveData=void 0,F.temppreAuthDetailsGridOtions=[],F.tempapprovalDataList=[],F.approvalDataList=[],F.delpreAuthDetailsGridOtions=[],F.delAuthApprovalGrid=[],F.visitdisableflag=!1,F.delgridOptionsDiagnosis=[],F.delgridOptionsProcedure=[],F.appr={},F.prevoisIndex=void 0,F.tariffSeqId=void 0,F.Enhanceflag=!1,F.updateEnhanceflag=!1,F.currentvisitflag=!1,F.approxBillNo=void 0,F.isPreauthorLimit=void 0,F.isCurrentorFuture=void 0,F.preAuthList=[],F.LimitList=[],F.currentdata=void 0,F.futuredata=void 0,F.duppreAuthDetailsGridOtions=[],F.updateApproval=!1,F.firstApproval=!1,F.payerchange=!1,e.toggleText="",F.preAuthserviceDetails=[],F.estimateNumber=[],F.directApproval=!1,F.authAprServiceLevel=!1,F.authAprBillLevel=!1,F.appr.authApproval=void 0,F.appr.authApprovalNo=void 0,F.appr.authApprovalDate=void 0,F.appr.authApprovalAmt=void 0,F.appr.authApprovalAmtView=void 0,F.appr.authApprovalVaildFrom=void 0,F.appr.authApprovalValidTo=void 0,F.authAprBillAmt=void 0,F.authApprovalGrid.data=[],F.appr.authCoPayApplicble="3",F.appr.authCoPayLevel="1",F.appr.authCoInsApplicable="3",F.appr.authCoInsLevel="1",F.appr.addNewApp=!0,F.approvalFooterTotalAmt=0,F.requestFooterTotalAmt=0,F.appr.authCoPayBillAmt=void 0,F.appr.authCoInsBillAmt=void 0,F.appr.authAppDeductibleAmt=void 0,F.appr.authAppMaxOutPocket=void 0,F.coInsGrid.data=[],F.coPayGrid.data=[],F.ServiceStatus=2,F.ServiceStatusDesc="InActive",F.tempauthApprovalGrid=[],F.requestScrFooterTotalAmt=0,e.preNew.activeSecond=1,F.coPayGrid.data=[],F.coPayGrid.data[0]={},F.coInsGrid.data=[],F.coInsGrid.data[0]={},F.tempAuthApprovalGridRemove=void 0,F.savepayerinfo=[],e.patientGlobalDtls=void 0,F.patientDetailsSearch=void 0,F.totalApprovedBillLevelAmt=void 0,F.prevAuthAprBillAmt=void 0,F.authactive=!1,F.mrnoactive=!1,F.vnactive=!1,F.ipactive=!1,F.disabledate=!1},F.changeAmount=function(e,t){null!=e.dupvalueAmt&&0!=e.qty&&null!=e.qty&&(e.valueAmt=e.qty*e.dupvalueAmt),0==e.qty&&(e.qty=void 0)},F.checkZero=function(e,t){0==e.valueAmt&&1==t?e.valueAmt=void 0:0==e.approvedQty&&2==t&&(e.approvedQty=void 0)},F.savePreAuth=function(t){if(!e.hideField||null!=F.patientDetailsSearch&&null!=F.patientDetailsSearch.mrNo&&null!=F.patientDetailsSearch.LOS&&null!=e.expectedDate&&null!=F.dignsisModel&&0!=F.dignsisModel.length&&null!=e.bedClassName&&0!=e.bedClassName.length)if(0==F.gridOptionsDiagnosis.data.length){s=F.alertData.pleaseSelectDiagnosis;m.hisAlertMulti("information",F.alertData.alertTypeInfo,s,e.alertData,e.alertFunction,e.close)}else if(null==F.payerseqid||null==F.planseqid||null==F.policyNumber){s="Please fill Payer details";m.hisAlertMulti("information",F.alertData.alertTypeInfo,s,e.alertData,e.alertFunction,e.close)}else if(1!=F.visitType||null!=F.clinicalBedClass&&null!=F.clinicalBedClass)if(F.approvalActive||null!=F.preAuthDetailsGridOtions.data&&null!=F.preAuthDetailsGridOtions.data&&1!=F.preAuthDetailsGridOtions.data.length||null!=F.billLevelCap&&""!=F.billLevelCap&&null!=F.billLevelCap)if(F.disabledate)m.hisAlertMulti("warning",F.alertData.alertTypeWarn,F.alertData.Plzentexpdat,!1,!1,e.close,2e3);else if("UPDATE"==e.toggleText||"UPDATE"==e.toggleTextPackage){s=F.alertData.plzUpdteRcrd;m.hisAlertMulti("information",F.alertData.alertTypeInfo,s,e.alertData,e.alertFunction,e.close)}else{{F.saveDataInput=[];F.expLengthUnit&&angular.forEach(F.ExpectedlengthList,function(e,t){e.DT_CODE==F.expLengthUnit&&(F.expLengthUnitdesc=e.DETAIL_DESC)});for(let e=0;e<F.preAuthDetailsGridOtions.data.length;e++)"Y"==F.preAuthDetailsGridOtions.data[e].ismaterial&&(F.preAuthDetailsGridOtions.data[e].valueAmt&&F.preAuthDetailsGridOtions.data[e].qty?F.totalmrtlprice[e]=F.preAuthDetailsGridOtions.data[e].valueAmt*F.preAuthDetailsGridOtions.data[e].qty:F.totalmrtlprice[e]=void 0);if(F.saveDataInput.push({bedClassSeqId:F.clinicalBedClass?F.clinicalBedClass:void 0,regSeqId:F.patientDetailsSearch.regSeqId,approxBillHdSeqId:F.preauthbillseqid,approxHdSeqId:null!=e.preNew.estimateSct&&""!==e.preNew.estimateSct&&null!=e.preNew.estimateSct.APPROX_BILL_HD_SEQ_ID?e.preNew.estimateSct.APPROX_BILL_HD_SEQ_ID:F.approxBillHdSeqId?F.approxBillHdSeqId:void 0,icdCode:null==F.ICDCodeValue||null==F.ICDCodeValue?"":F.ICDCodeValue,patientcategorySeqId:null==e.patientGlobalDtls.patCatSeqId||null==e.patientGlobalDtls.patCatSeqId?691702168:e.patientGlobalDtls.patCatSeqId,tariffSeqId:null==F.tariffSeqId?void 0:F.tariffSeqId,remarks:null==F.remarks||null==F.remarks?"":F.remarks,gnTranStatus:1,approxBillDate:null==F.expDate||null==F.expDate?r("date")(new Date,"yyyy-MM-dd hh:mm:ss.s"):r("date")(F.expDate,"yyyy-MM-dd hh:mm:ss.s"),grossAmt:null!=F.billLevelCap&&null!=F.billLevelCap&&""!=F.billLevelCap&&1==F.isBillLevelFlag?parseFloat(F.billLevelCap):0,subAccSeqId:4==F.flow||null==F.subAccSeqId||1!=F.isCurrentorFuture&&null!=F.isCurrentorFuture?void 0:F.subAccSeqId,isBillLevel:1==F.isBillLevelFlag?1:2,isServiceLevel:1==F.isServiceLevelFlag?2:1,isCopayAvailable:void 0,copayValue:void 0,isDeductableAvailable:void 0,deductableValue:void 0,insuranceSeqId:null==F.payerName||null==F.payerName?void 0:F.payerName.incSeqId?F.payerName.incSeqId:F.payerseqid?F.payerseqid:void 0,insurancePlanSeqId:null==F.planName||null==F.planName?void 0:F.planName.INC_PLAN_SEQ_ID?F.payerName.incSeqId:F.planseqid?F.planseqid:void 0,admissionReason:null==F.admReason||null==F.admReason||" "==F.admReason?" ":F.admReason,policyNumber:null==F.policyNumber||null==F.policyNumber?void 0:F.policyNumber,cardNumber:null==F.cardNumber||null==F.cardNumber?void 0:F.cardNumber,gnFlow:F.visitType,StrExpectedDays:null==F.estLengthStay||null==F.estLengthStay?" ":" "!=F.expLengthUnitdesc?F.estLengthStay+" "+F.expLengthUnitdesc:" ",chiefComplaints:F.chiefComplaints,isSubmitted:null!=F.submitted&&null!=F.submitted||F.directApproval?F.directApproval?"Y":F.submitted:"N",planValidFromDate:null==F.savevalidFrom||null==F.savevalidFrom?r("date")(new Date,"yyyy-MM-dd hh:mm:ss.s"):r("date")(F.savevalidFrom,"yyyy-MM-dd hh:mm:ss.s"),planValidToDate:null==F.savevalidTo||null==F.savevalidTo?r("date")(new Date,"yyyy-MM-dd hh:mm:ss.s"):r("date")(F.savevalidTo,"yyyy-MM-dd hh:mm:ss.s"),approvedAmount:1==F.authAprBillLevel&&null!=F.authAprBillAmt&&null!=F.authAprBillAmt&&""!==F.authAprBillAmt?null!=F.appr&&F.appr.addNewApp&&null!=F.totalApprovedBillLevelAmt?parseFloat(F.authAprBillAmt)+parseFloat(F.totalApprovedBillLevelAmt):null==F.appr||F.appr.addNewApp||null==F.totalApprovedBillLevelAmt||null==F.prevAuthAprBillAmt?null!=F.totalApprovedBillLevelAmt?parseFloat(F.authAprBillAmt)+parseFloat(F.totalApprovedBillLevelAmt):parseFloat(F.authAprBillAmt):parseFloat(F.totalApprovedBillLevelAmt)-parseFloat(F.prevAuthAprBillAmt)+parseFloat(F.authAprBillAmt):null==F.appr||F.appr.addNewApp||null==F.totalApprovedBillLevelAmt||null==F.prevAuthAprBillAmt?void 0:parseFloat(F.totalApprovedBillLevelAmt)-parseFloat(F.prevAuthAprBillAmt),isPreAuthOrEnhancement:t&&!F.updateEnhanceflag?t:void 0,approxBillNo:F.updateEnhanceflag?F.approxBillNo:void 0}),F.dignsisModelSave=[],F.procedureModelSave=[],F.delgridOptionsDiagnosis.length>0&&angular.forEach(F.delgridOptionsDiagnosis,function(e,t){e.gnTranStatus=2,e.diagSeqId&&F.gridOptionsDiagnosis.data.push(e)}),F.delgridOptionsProcedure.length>0&&angular.forEach(F.delgridOptionsProcedure,function(e,t){e.gnTranStatus=2,e.approxProcSeqId&&F.gridOptionsProcedure.data.push(e)}),F.gridOptionsDiagnosis.data.length>0)for(var a=0;a<F.gridOptionsDiagnosis.data.length;a++)F.dignsisModelSave.push({diagSeqId:F.gridOptionsDiagnosis.data[a].diagSeqId&&!F.Enhanceflag?F.gridOptionsDiagnosis.data[a].diagSeqId:void 0,StrDiagnosisCode:F.gridOptionsDiagnosis.data[a].ICDCODE,StrDiagnosisName:F.gridOptionsDiagnosis.data[a].DESCRIPTION,gnTranStatus:F.gridOptionsDiagnosis.data[a].gnTranStatus?F.gridOptionsDiagnosis.data[a].gnTranStatus:1});if(F.gridOptionsProcedure.data.length>0)for(a=0;a<F.gridOptionsProcedure.data.length;a++)F.procedureModelSave.push({approxProcSeqId:F.gridOptionsProcedure.data[a].approxProcSeqId&&!F.Enhanceflag?F.gridOptionsProcedure.data[a].approxProcSeqId:void 0,procName:F.gridOptionsProcedure.data[a].DESCRIPTION,procCode:F.gridOptionsProcedure.data[a].CODE,isEstimateOrPreauth:F.preAuthFlag,gnTranStatus:F.gridOptionsProcedure.data[a].gnTranStatus?F.gridOptionsProcedure.data[a].gnTranStatus:1});F.delpreAuthDetailsGridOtions.length>0&&angular.forEach(F.delpreAuthDetailsGridOtions,function(e,t){e.gnTranStatus=2,e.approxBillDtSeqId&&F.preAuthDetailsGridOtions.data.push(e)}),F.servicePackageCom=[],F.materialPackageCom=[];var i,n=F.approvalActive?parseInt(0):parseInt(1);if((1==F.isServiceLevelFlag||F.delpreAuthDetailsGridOtions.length>0)&&F.preAuthDetailsGridOtions.data.length>0)for(a=n;a<F.preAuthDetailsGridOtions.data.length;a++)"N"==F.preAuthDetailsGridOtions.data[a].ismaterial?F.servicePackageCom.push({approxBillDtSeqId:F.preAuthDetailsGridOtions.data[a].approxBillDtSeqId&&!F.Enhanceflag?F.preAuthDetailsGridOtions.data[a].approxBillDtSeqId:void 0,serviceCode:null!=F.preAuthDetailsGridOtions.data[a].service?F.preAuthDetailsGridOtions.data[a].service.SERV_CODE:void 0,serviceSeqId:null!=F.preAuthDetailsGridOtions.data[a].service&&null!=F.preAuthDetailsGridOtions.data[a].service.SERV_SEQ_ID?F.preAuthDetailsGridOtions.data[a].service.SERV_SEQ_ID:void 0,serviceName:null!=F.preAuthDetailsGridOtions.data[a].service?F.preAuthDetailsGridOtions.data[a].service.SERV_NAME:void 0,serviceRate:void 0,serviceQty:null!=F.preAuthDetailsGridOtions.data[a].qty&&""!=F.preAuthDetailsGridOtions.data[a].qty?parseFloat(F.preAuthDetailsGridOtions.data[a].qty):void 0,serviceTax:void 0,serviceDiscountAmt:void 0,chargeableAmt:null!=F.preAuthDetailsGridOtions.data[a].valueAmt&&""!=F.preAuthDetailsGridOtions.data[a].valueAmt?parseFloat(F.preAuthDetailsGridOtions.data[a].valueAmt):void 0,expcServDate:"9999-03-05 00:00:00.000",gnTranStatus:F.preAuthDetailsGridOtions.data[a].gnTranStatus?F.preAuthDetailsGridOtions.data[a].gnTranStatus:1,serviceType:null!=F.preAuthDetailsGridOtions.data[a].service&&null!=F.preAuthDetailsGridOtions.data[a].service.SERV_SEQ_ID?parseFloat(4):null!=F.preAuthDetailsGridOtions.data[a].specialty&&null!=F.preAuthDetailsGridOtions.data[a].specialty.CODE?parseFloat(3):null!=F.preAuthDetailsGridOtions.data[a].department&&null!=F.preAuthDetailsGridOtions.data[a].department.CODE?parseFloat(2):null!=F.preAuthDetailsGridOtions.data[a].priServGroup&&null!=F.preAuthDetailsGridOtions.data[a].priServGroup.CODE?parseFloat(1):void 0,isAmtPercNl:1,primaryServCode:null!=F.preAuthDetailsGridOtions.data[a].priServGroup&&null!=F.preAuthDetailsGridOtions.data[a].priServGroup.CODE?F.preAuthDetailsGridOtions.data[a].priServGroup.CODE:void 0,deptCode:null!=F.preAuthDetailsGridOtions.data[a].department&&null!=F.preAuthDetailsGridOtions.data[a].department.CODE?F.preAuthDetailsGridOtions.data[a].department.CODE:void 0,specilityCode:null!=F.preAuthDetailsGridOtions.data[a].specialty&&null!=F.preAuthDetailsGridOtions.data[a].specialty.CODE?F.preAuthDetailsGridOtions.data[a].specialty.CODE:void 0,isApprovalRequired:F.preAuthDetailsGridOtions.data[a].isApprovalRequired?F.preAuthDetailsGridOtions.data[a].isApprovalRequired:void 0,isOrderFrom:F.preAuthDetailsGridOtions.data[a].isOrderFrom?F.preAuthDetailsGridOtions.data[a].isOrderFrom:void 0,gnStatus:1,apprIsAmtPercNl:null!=F.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl&&null!=F.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl&&""!==F.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl?parseInt(F.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl):void 0,approvedAmount:null!=F.preAuthDetailsGridOtions.data[a].approvedAmount&&null!=F.preAuthDetailsGridOtions.data[a].approvedAmount&&""!==F.preAuthDetailsGridOtions.data[a].approvedAmount?parseFloat(F.preAuthDetailsGridOtions.data[a].approvedAmount):void 0,approvedQty:null!=F.preAuthDetailsGridOtions.data[a].approvedQty&&null!=F.preAuthDetailsGridOtions.data[a].approvedQty&&""!==F.preAuthDetailsGridOtions.data[a].approvedQty?parseInt(F.preAuthDetailsGridOtions.data[a].approvedQty):void 0,approvedDetails:null!=F.preAuthDetailsGridOtions.data[a].approvedDetails&&null!=F.preAuthDetailsGridOtions.data[a].approvedDetails&&""!==F.preAuthDetailsGridOtions.data[a].approvedDetails?parseInt(F.preAuthDetailsGridOtions.data[a].approvedDetails):void 0,applicabilityType:null!=F.preAuthDetailsGridOtions.data[a].applicabilityType&&null!=F.preAuthDetailsGridOtions.data[a].applicabilityType&&""!==F.preAuthDetailsGridOtions.data[a].applicabilityType?parseInt(F.preAuthDetailsGridOtions.data[a].applicabilityType.DT_CODE):void 0}):("Y"==F.preAuthDetailsGridOtions.data[a].ismaterial||F.delpreAuthDetailsGridOtions.length>0)&&(i=k(F.preAuthDetailsGridOtions.data[a]),F.materialPackageCom.push({approxBillDtSeqId:F.preAuthDetailsGridOtions.data[a].approxBillDtSeqId&&!F.Enhanceflag?F.preAuthDetailsGridOtions.data[a].approxBillDtSeqId:void 0,materialName:null!=F.preAuthDetailsGridOtions.data[a].service?F.preAuthDetailsGridOtions.data[a].service.SERV_NAME:void 0,materialCode:null!=F.preAuthDetailsGridOtions.data[a].service&&null!=F.preAuthDetailsGridOtions.data[a].service.SERV_SEQ_ID?F.preAuthDetailsGridOtions.data[a].service.SERV_SEQ_ID:void 0,price:null!=F.preAuthDetailsGridOtions.data[a].valueAmt&&""!=F.preAuthDetailsGridOtions.data[a].valueAmt?parseFloat(F.preAuthDetailsGridOtions.data[a].valueAmt):void 0,quantaty:null!=F.preAuthDetailsGridOtions.data[a].qty&&""!=F.preAuthDetailsGridOtions.data[a].qty?parseFloat(F.preAuthDetailsGridOtions.data[a].qty):void 0,totalPrice:F.totalmrtlprice[a],expcMtrlDate:"9999-03-05 00:00:00.000",gnTranStatus:F.preAuthDetailsGridOtions.data[a].gnTranStatus?F.preAuthDetailsGridOtions.data[a].gnTranStatus:1,materialCategory:null!=F.preAuthDetailsGridOtions.data[a].priServGroup&&null!=F.preAuthDetailsGridOtions.data[a].priServGroup.CODE?F.preAuthDetailsGridOtions.data[a].priServGroup.CODE:void 0,materialGroup:null!=F.preAuthDetailsGridOtions.data[a].department&&null!=F.preAuthDetailsGridOtions.data[a].department.CODE?F.preAuthDetailsGridOtions.data[a].department.CODE:void 0,materialSubGroup:null!=F.preAuthDetailsGridOtions.data[a].specialty&&null!=F.preAuthDetailsGridOtions.data[a].specialty.CODE?F.preAuthDetailsGridOtions.data[a].specialty.CODE:void 0,hierarchyLevel:i,isOrderFrom:F.preAuthDetailsGridOtions.data[a].isOrderFrom?F.preAuthDetailsGridOtions.data[a].isOrderFrom:void 0,isApprovalRequired:F.preAuthDetailsGridOtions.data[a].isApprovalRequired?F.preAuthDetailsGridOtions.data[a].isApprovalRequired:void 0,apprIsAmtPercNl:null!=F.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl&&null!=F.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl&&""!==F.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl?parseInt(F.preAuthDetailsGridOtions.data[a].apprIsAmtPercNl):void 0,approvedAmount:null!=F.preAuthDetailsGridOtions.data[a].approvedAmount&&null!=F.preAuthDetailsGridOtions.data[a].approvedAmount&&""!==F.preAuthDetailsGridOtions.data[a].approvedAmount?parseFloat(F.preAuthDetailsGridOtions.data[a].approvedAmount):void 0,approvedQty:null!=F.preAuthDetailsGridOtions.data[a].approvedQty&&null!=F.preAuthDetailsGridOtions.data[a].approvedQty&&""!==F.preAuthDetailsGridOtions.data[a].approvedQty?parseInt(F.preAuthDetailsGridOtions.data[a].approvedQty):void 0,approvedDetails:null!=F.preAuthDetailsGridOtions.data[a].approvedDetails&&null!=F.preAuthDetailsGridOtions.data[a].approvedDetails&&""!==F.preAuthDetailsGridOtions.data[a].approvedDetails?parseInt(F.preAuthDetailsGridOtions.data[a].approvedDetails):void 0,applicabilityType:null!=F.preAuthDetailsGridOtions.data[a].applicabilityType&&null!=F.preAuthDetailsGridOtions.data[a].applicabilityType&&""!==F.preAuthDetailsGridOtions.data[a].applicabilityType?parseInt(F.preAuthDetailsGridOtions.data[a].applicabilityType.DT_CODE):void 0}));let s=null!=F.apprvalSaveData&&null!=F.apprvalSaveData.approvalHeaderData&&(F.approvalActive||F.directApproval)?F.apprvalSaveData.approvalHeaderData:[],o=null!=F.apprvalSaveData&&null!=F.apprvalSaveData.approvalOutOfPocketData&&(F.approvalActive||F.directApproval)?F.apprvalSaveData.approvalOutOfPocketData:[];l.savePreAuthForRegUpdated(F.saveDataInput[0],F.servicePackageCom,[],[],F.dignsisModelSave,[],[],F.procedureModelSave,F.materialPackageCom,s,o).then(function(t){if(null!=t.data.HITService.message&&null!=t.data.HITService.message.approxBillVos&&null!=t.data.HITService.message.approxBillVos[0]&&null!=t.data.HITService.message.approxBillVos[0]["com.napier.core.billgeneration.vo.ApproxBillVo"]&&null!=t.data.HITService.message.approxBillVos[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxBillNo){if(null!=t.data.HITService.message.approxBillVos[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxBillHdSeqId){for(let e=0;e<F.filesUploaded.length;e++)F.filesUploaded[e].referenceId=t.data.HITService.message.approxBillVos[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxBillHdSeqId,F.filesUploaded[e].prmryEntityId=t.data.HITService.message.approxBillVos[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxBillHdSeqId;y.saveDocument(F)}F.alertData.ok;let i=t.data.HITService.message.approxBillVos[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxBillNo;var a=null!=s&&s.length>0?F.updateApproval?F.alertData.authorizationDetailsFor+" "+s[0].approvalNo+" "+F.alertData.updatedSucsfuly:F.alertData.authorizationDetailsFor+" "+s[0].approvalNo+" "+F.alertData.savdSucesFuly:null!=F.preauthbillseqid&&"Y"==F.submitted?F.alertData.authorizationRequest+" "+i+" "+F.alertData.submittedSuccessfully:null!=F.preauthbillseqid?F.alertData.authorizationRequest+" "+i+" "+F.alertData.updatedSucsfuly:F.alertData.authorizationRequest+" "+i+" "+F.alertData.generatedSuccessFully;m.hisAlertMulti("success",F.alertData.alertTypeSucss,a,!1,!1,{buttonClose:function(){}},2e3);let r=e.regSqId;F.clear(),null!=s&&0!=s.length||null==F.saveDataInput||null==F.saveDataInput[0]||"Y"!=F.saveDataInput[0].isSubmitted?F.getPreAuthNoList(r):(F.flow=3,F.getPreAuthNoData(i,!0))}})}}else{var s=F.alertData.plzFilAtSrvDtDrugDtPakDtl;m.hisAlertMulti("information",F.alertData.alertTypeInfo,s,e.alertData,e.alertFunction,e.close)}else{var s=F.alertData.pleaseSelectBedClass;m.hisAlertMulti("information",F.alertData.alertTypeInfo,s,e.alertData,e.alertFunction,e.close)}else{var s=F.alertData.plzFilMandFild;m.hisAlertMulti("information",F.alertData.alertTypeInfo,s,e.alertData,e.alertFunction,e.close),null!=F.patientDetailsSearch&&null!=F.patientDetailsSearch.mrNo||(e.showError=!0),null==e.expectedDate&&(e.showErrorDate=!0),null==e.bedClassName&&(e.showErrorBed=!0),null==F.patientDetailsSearch.LOS&&(e.showErrorLOS=!0),null!=F.dignsisModel&&0!=F.dignsisModel.length||(e.showErrorDig=!0)}},F.openChiefComplaintspopup=function(){var e={mrno:F.mrNo,epSeqId:F.epSeqId};sessionStorage.setItem("newCurrentPatientInfo",angular.toJson(e)),I.open("Chief Complaints",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/estimateBill/estimate.chiefcomplaints.html",size:"lg",controller:"patientAssessmentDCCrtl",resolve:{}}).result.then(function(e){},function(){})},F.autoSearchOnDiagnosis=function(e,a){if(e&&(e.length>0&&1==a||e.length>1&&2==a)){F.diagnosisList=[],F.multipleComboDataForList={1:F.diagnosisList};var i=t.executeQueryURLReset();return F.diagnosisArray=new Array,t.prepareParamListWithParam("TYPE",F.diagnosis.type,F.diagnosisArray),t.prepareParamListWithParam("DIAG_CODE",1==a?e:"",F.diagnosisArray),t.prepareParamListWithParam("DIAG_DESC",2==a?e:"",F.diagnosisArray),t.executeQueryInput("USP_GET_DIAGNOSIS_DTLS",F.diagnosisArray,F.multipleComboDataForList,!0,!0,i,"popUp",!0).then(function(e){return e[1].map(function(e){return 1==F.diagnosis.type?(e.SEARCH_NAME=e.DESCRIPTION,e.SEARCH_CODE=e.ICDCODE):(e.SEARCH_NAME=e.HOSP_DIAG_DESC,e.SEARCH_CODE=e.HOSP_DIAG_CODE),e})})}},F.selectOnSuggestedDiagnosis=function(t,a,i){var r;r=[a][0];if(F.gridOptionsDiagnosis.data.length>0)if(Q(F.gridOptionsDiagnosis.data,r,1))F.gridOptionsDiagnosis.data.push(r);else{m.hisAlertMulti("warning",F.alertData.alertTypeWarn,"Selected diagnosis already added",!1,!1,e.close,2e3)}else F.gridOptionsDiagnosis.data.push(r);F.diagnosis={},F.diagnosis.type=1,F.diagnosis.desc="",F.diagnosis.code=""},F.deleteDiagnosis=function(e){let t={buttonText:F.alertData.no,buttonText2:F.alertData.yes},a={buttonCallBack1:function(){},buttonCallBack2:function(){F.delgridOptionsDiagnosis.push(F.gridOptionsDiagnosis.data[e]),F.gridOptionsDiagnosis.data.splice(e,1)}};m.hisAlertMulti("information",F.alertData.alertTypeInfo,"Do You Want To Delete The Record",t,a,{buttonClose:function(){}})},F.autoSearchOnProcedure=function(e,a){if(e&&(e.length>0&&1==a||e.length>1&&2==a)){var i=e.toString();i.length>0&&2==a&&(i="%"+i+"%"),F.procedureList=[],F.multipleComboDataForList={1:F.procedureList};var r=t.executeQueryURLReset();return F.procedureArray=new Array,t.prepareParamListWithParam("TYPE",F.procedure.type,F.procedureArray),t.prepareParamListWithParam("PROC_CODE",1==a?i:"",F.procedureArray),t.prepareParamListWithParam("PROC_DESC",2==a?i:"",F.procedureArray),t.executeQueryInput("USP_GET_PROCEDURE_DTLS",F.procedureArray,F.multipleComboDataForList,!0,!0,r,"popUp",!0).then(function(e){return e[1].map(function(e){return 1==F.procedure.type?(e.SEARCH_NAME=e.DESCRIPTION,e.SEARCH_CODE=e.CODE):(e.SEARCH_NAME=e.SUR_NAME,e.SEARCH_CODE=e.SUR_CODE),e})})}},F.selectOnSuggestedProcedure=function(t,a,i){var r;if(r=[a][0],F.gridOptionsProcedure.data.length>0)if(Q(F.gridOptionsProcedure.data,r,2))F.gridOptionsProcedure.data.push(r);else{m.hisAlertMulti("warning",F.alertData.alertTypeWarn,"Selected procedure already added",!1,!1,e.close,2e3)}else F.gridOptionsProcedure.data.push(r);F.procedure={},F.procedure.type=1,F.procedure.desc="",F.procedure.code=""},F.deleteProcedure=function(e){let t={buttonText:F.alertData.no,buttonText2:F.alertData.yes},a={buttonCallBack1:function(){},buttonCallBack2:function(){F.delgridOptionsProcedure.push(F.gridOptionsProcedure.data[e]),F.gridOptionsProcedure.data.splice(e,1)}};m.hisAlertMulti("information",F.alertData.alertTypeInfo,"Do You Want To Delete The Record",t,a,{buttonClose:function(){}})},F.searchPermanentPatient=function(e){return C.searchPatientMrNoBased(e).then(function(e){return angular.isArray(e)?e:[e]})},F.openDiagnosis=function(t){1===F.diagnosis.type?F.diagnosisSearch(F.diagnosis.code,F.diagnosis.desc,"true"):I.open("DIAGNOSES SEARCH",{animation:!0,templateUrl:"app/consumer/his17_1/operationtheater/screens/surgeryRequestNew/templates/diagnoses.model.html",size:"lg",controller:"diagnosisModalController",resolve:{diagnosis:function(){return t},selectedDiagnosisList:function(){return F.diagnosisList},isMultiSelect:function(){return!0}}}).result.then(function(t){for(var a={},i=0;i<t.length;i++)if(a=t[i],F.gridOptionsDiagnosis.data.length>0)if(Q(F.gridOptionsDiagnosis.data,a,1))F.gridOptionsDiagnosis.data.push(a);else{m.hisAlertMulti("warning",F.alertData.alertTypeWarn,"Selected diagnosis already added",!1,!1,e.close,2e3)}else F.gridOptionsDiagnosis.data.push(a);F.diagnosis={},F.diagnosis.type=1,F.diagnosis.desc="",F.diagnosis.code=""},function(){})},F.diagnosisSearch=function(t,a,i){F.updateDiagnosisDisable=!0,F.modalInstance=h.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_new_screen/pre_auth_diagnosis.html",backdrop:"static",keyboard:!1,scope:e}),F.modalInstance.result.then(function(t){let a=!1;t.length>0&&angular.forEach(t,function(t,i){let r={};if(r.IDNUM=t.idNum,r.DESCRIPTION=t.text,r.ICDCODE=t.mainID4,F.gridOptionsDiagnosis.data.length>0)if(a=Q(F.gridOptionsDiagnosis.data,r,1))F.gridOptionsDiagnosis.data.push(r);else{m.hisAlertMulti("warning",F.alertData.alertTypeWarn,"Selected diagnosis already added",!1,!1,e.close,2e3)}else F.gridOptionsDiagnosis.data.push(r)}),F.diagnosis={},F.diagnosis.type=1,F.diagnosis.desc="",F.diagnosis.code=""},function(){}),a=a||"",t=t||"",F.diagnosisSearchGrid(t,a,"","",i)},F.diagnoCodes=[],F.diagnoDesc=[],F.diagnosisSearchGrid=function(t,a,i,r,n){F.isDiagnosisCode=!0,F.isDiagnosisDesc=!0;if(F.numRows=10,F.dataArr=[],F.diagnosisGridOptions={enablePaginationControls:!1,paginationCurrentPage:1,enableFiltering:!1,multiSelect:!0,enableRowSelection:!0,enableSelectAll:!1,paginationPageSize:10,paginationPageSizes:[10,15,20],enableCellEdit:!1,enableColumnResizing:!0,enableCellEditOnFocus:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,enableSorting:!1,columnDefs:[{field:"mainID4",displayName:"Code",width:"*",resizable:!0,cellTooltip:!0,enableHiding:!1},{field:"text",displayName:"Disease",width:"*",resizable:!0,cellTooltip:!0,enableHiding:!1},{field:"level1CategoryText",displayName:"Level A Header",width:"*",resizable:!0,cellTooltip:!0,enableHiding:!1},{field:"level2CategoryText",displayName:"Level B Header",width:"*",resizable:!0,cellTooltip:!0,enableHiding:!1},{field:"notifiable",displayName:"Notifiable",width:"*",resizable:!0,cellTooltip:!0,enableHiding:!1},{field:"eventNotifiable",displayName:"Event Notifiable",width:"*",resizable:!0,cellTooltip:!0,enableHiding:!1}]},F.diagnosisGridOptions.onRegisterApi=function(t){F.diagnosisGridOptionsApi=t,t.selection.on.rowSelectionChanged(e,function(e){e.isSelected?F.updateDiagnosisDisable=!1:0==F.diagnosisGridOptionsApi.selection.getSelectedRows().length&&(F.updateDiagnosisDisable=!0)})},F.diagnosisGridOptions.data=[],"true"==n)var l={"@class":"com.napier.core.service.vo.qualifier.ICD9",type:"ICD9",mainID4:F.diagnosis.code?F.diagnosis.code+"%":"",level1CategoryText:"",level2CategoryText:"",text:F.diagnosis.desc?F.diagnosis.desc+"%":""};else l={"@class":"com.napier.core.service.vo.qualifier.ICD9",type:"ICD9",mainID4:t?t+"%":"",level1CategoryText:i?i+"%":"",level2CategoryText:r?r+"%":"",text:a?a+"%":""};var s={};s.url=b.HISSURGICALHISTORYDIAGNOSIS.URL,s.requestData={operation:"getCodes",messageId:"",destination:"qualifierservice",message:l},A.sendRestRequest(s).then(function(e){var i=e.data.HITService.message.iCD9List[0]["com.napier.core.service.vo.qualifier.ICD9"];Array.isArray(i)?_.forEach(i,function(e,t){F.diagnosisGridOptions.data.push(e),F.diagnoCodes.push(e.mainID4),F.diagnoDesc.push(e.text)}):(F.diagnosisGridOptions.data.push(i),F.diagnoCodes.push(i.mainID4),F.diagnoDesc.push(i.text),t&&(F.diagnosis.desc=i.text),a&&(F.diagnosis.code=i.mainID4))},function(e){})},F.diagnosisSearchGrid("","","","","false"),F.searchClose=function(e){e?F.modalInstance.close(e):F.modalInstance.close()},F.selectDiagnosis=function(){F.rowsSelected=F.diagnosisGridOptionsApi.selection.getSelectedRows(),F.searchClose(F.rowsSelected)},F.openProcedure=function(t){I.open("PROCEDURE SEARCH",{animation:!0,templateUrl:"app/consumer/his17_1/operationtheater/screens/surgeryRequestNew/templates/procedure.model.html",size:"lg",controller:"procedureModalController",resolve:{procedure:function(){return t}}}).result.then(function(t){var a;if(a=t[0],F.gridOptionsProcedure.data.length>0)if(Q(F.gridOptionsProcedure.data,a,2))F.gridOptionsProcedure.data.push(a);else{m.hisAlertMulti("warning",F.alertData.alertTypeWarn,"Selected procedure already added",!1,!1,e.close,2e3)}else F.gridOptionsProcedure.data.push(a);F.procedure={},F.procedure.type=1,F.procedure.desc="",F.procedure.code=""},function(){})},F.openPreAuthorizationReqSearch=function(){I.open("SEARCH AUTHORIZATION",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_new_screen/pre_auth_search_authorization_list.html",size:"lg",controller:"PreAuthorizationReqModalController",controllerAs:"prereqsearch"}).result.then(function(e){console.log(e),e&&e.length>0&&(F.flow=3,F.authorizationreqno=e[0],F.selectedPreAuthNo(e[0]))},function(){})},F.openPayerpopup=function(e){let t=!0;if(F.payerseqid&&F.planseqid&&F.policyNumber){for(let e=0;e<F.payerArr.length;e++)F.payerArr[e].INC_SEQ_ID==F.payerseqid&&F.payerArr[e].IN_PLC_SEQ_CD==F.planseqid&&F.payerArr[e].POLICY_NO==F.policyNumber?(t=!1,F.payerArr[e].select=!0):F.payerArr[e].select=!1;1==t&&H(F,5),console.log(F.payerArr)}F.savepayerinfo.push({payerType:3,regSeqId:F.patientDetailsSearch.regSeqId,patientType:F.visitType,gnStatus:1,insTypeSeqCd:1,piInPriority:1,isNewPayer:!0}),I.open("Payer Search",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_new_screen/pre_auth_payer_search.html",size:e,controller:"PreAuthorizationPayerModalController",controllerAs:"prePay",resolve:{payer:function(){return F.payerArr},patientdata:function(){return F.savepayerinfo[0]}}}).result.then(function(e){console.log(e),e&&e.length>0&&(null!=e[0].prePay.select&&0!=e[0].prePay.select||(F.payerName=e[0].prePay.payer,F.planName=e[0].prePay.plan,F.policyNumber=e[0].prePay.policyno,F.cardNumber=e[0].prePay.cardno,F.validFrom=e[0].prePay.viewfromDate,F.validTo=e[0].prePay.viewtoDate,F.savevalidFrom=e[0].prePay.fromDate,F.savevalidTo=e[0].prePay.toDate,F.payerseqid=e[0].prePay.payerobj.incSeqId,F.planseqid=e[0].prePay.planobj.INC_PLAN_SEQ_ID,F.tariffSeqId=e[0].prePay.tariffId,F.loadBedClass(e[0].prePay.payerobj,e[0].prePay.planobj),6==F.flow&&1==F.selfdataflag?(angular.forEach(F.tempapprovalDataList,function(e,t){F.approvalDataList.push(e)}),angular.forEach(F.temppreAuthDetailsGridOtions,function(e,t){j(e)}),F.preAuthDetailsGridOtions.data.length>0&&(F.isServiceLevelFlag=!0)):3==F.flow&&(F.payerchange=!0)))},function(){})},F.OnServiceLevelChange=function(t){if(null==F.payerseqid||null==F.planseqid||null==F.policyNumber){0==t?F.isServiceLevelFlag=!1:F.authAprServiceLevel=!1;var a=F.alertData.pleaseSelectPayer;m.hisAlertMulti("warning",F.alertData.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(0==F.gridOptionsDiagnosis.data.length){0==t?F.isServiceLevelFlag=!1:F.authAprServiceLevel=!1;a=F.alertData.pleaseSelectDiagnosis;m.hisAlertMulti("warning",F.alertData.alertTypeWarn,a,!1,!1,e.close,2e3)}else if(null==F.clinicalBedClass&&1==F.visitType){0==t?F.isServiceLevelFlag=!1:F.authAprServiceLevel=!1;a=F.alertData.PlzSlctBedCls;m.hisAlertMulti("warning",F.alertData.alertTypeWarn,a,!1,!1,e.close,2e3)}if(F.preAuthDetailsGridOtions.data.length>1&&0==F.isServiceLevelFlag&&0==t){F.isServiceLevelFlag=!0;a=F.alertData.serviceOrMaterialDataAlreadyAvailable;m.hisAlertMulti("warning",F.alertData.alertTypeWarn,a,!1,!1,e.close,2e3)}if(F.authApprovalGrid.data.length>1&&0==F.authAprServiceLevel&&1==t){F.authAprServiceLevel=!0,1==F.flow&&(F.isServiceLevelFlag=!0);a=F.alertData.serviceOrMaterialDataAlreadyAvailable;m.hisAlertMulti("warning",F.alertData.alertTypeWarn,a,!1,!1,e.close,2e3)}if(F.authAprServiceLevel&&0==t)F.authApprovalGrid.data=angular.copy(F.approvalDataList);else if(!F.authAprServiceLevel&&0==t&&null==F.tempAuthApprovalGridRemove){F.tempAuthApprovalGridRemove=[],F.tempAuthApprovalGridRemove=angular.copy(F.authApprovalGrid.data);for(let e=1;e<F.tempAuthApprovalGridRemove.length;e++)null!=F.tempAuthApprovalGridRemove[e].preAuthBillAprDtSeqId&&(F.tempAuthApprovalGridRemove[e].gnStatus=2,null==F.delAuthApprovalGrid&&(F.delAuthApprovalGrid=[]),F.delAuthApprovalGrid.push(F.tempAuthApprovalGridRemove[e]))}},F.appr={},F.appr.authCoPayApplicble="3",F.appr.authCoPayLevel="1",F.appr.authCoInsApplicable="3",F.appr.authCoInsLevel="1",F.appr.addNewApp=!0,F.approvalActive=!1,F.approvalFooterTotalAmt=0,F.requestFooterTotalAmt=0,F.getPreAuthNoData=function(a,i){F.authListData=[],F.multipleComboDataForList={1:F.authListData},e.disabledField=!1;var r=t.executeQueryURLReset();return F.authListDataList=new Array,t.prepareParamListWithParam("pPreAuthNo",a,F.authListDataList),t.executeQueryInput("GET_PREAUTH_PATIENT_DETAILS",F.authListDataList,F.multipleComboDataForList,!0,!0,r,"popUp",{}).then(function(e){return i&&(F.authorizationreqno=F.authListData[0],F.selectedPreAuthNo(F.authorizationreqno)),F.authListData.map(function(e){return e})})},F.preNewFiles=[],F.deleteFiles=[],F.numOffiles=0,F.totalFileSize=0,F.open=function(e){I.open("UPLOAD FILES",{animation:!0,templateUrl:"app/consumer/his17_2/ADT/screens/patientAdmission/sections/upload.files.modal.html",size:e,controller:"uploadFileController",controllerAs:"upfileCtrl",backdrop:"static",resolve:{addedFiles:function(){return F.preNewFiles},totalFileSize:function(){return F.totalFileSize},regSeqId:function(){return F.rgSeqId}}}).result.then(function(e){F.numOffiles=F.numOffiles+e.noffiles,angular.forEach(e.files,function(e){e.fileName=e.name,F.preNewFiles.push(e)}),F.totalFileSize=e.filsTotalSize,angular.forEach(e.seqIds,function(e){e.fileName=e.name,F.deleteFiles.push(e)}),P.log("modal selected Row: "+e)},function(){P.info("Modal dismissed at: "+new Date)})},F.dynamicPopoverForUploadFile={templateUrl:"myPopoverTemplateInAdm.html"},F.viewUploadedFile=function(e){F.adtAdmPatPopOverCls=!1;O.viewUploadedFileFun(e).then(function(e){if(!angular.isUndefined(e.data.HITService.message.napierDocumentList[0]["com.napier.core.service.vo.uploadfile.NapierDocument"])){var t=e.data.HITService.message.napierDocumentList[0]["com.napier.core.service.vo.uploadfile.NapierDocument"].uploadDocumnt[0],a=e.data.HITService.message.napierDocumentList[0]["com.napier.core.service.vo.uploadfile.NapierDocument"].docExtension,i=t.replace("dataimage/jpegbase64","").replace("dataapplication/pdfbase64","").replace("dataapplication/vndopenxmlformatsofficedocumentwordprocessingmldocumentbase6\n4","").replace("dataimage/pngbase64","").replace("\n","");i=i.slice(0,-2);var r=a.toLowerCase();if("pdf"==r||"jpg"==r||"png"==r||"gif"==r||"jpeg"==r||"tif"==r||"tiff"==r||"bmp"==r)Y(i,r);else if("xls"==r){var n=(s="data:application/vnd.ms-excel,")+i;window.open(n,"_self")}else if("xlsx"==r){var l=(s="data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")+";base64,"+i;window.open(l,"_self")}else if("docx"==r||"doc"==r){var s="data:application/octet-stream;base64,";downloadWithName(s+i,"download.docx")}}})};var Y=function(e,t){I.open("",{animation:!0,templateUrl:"app/consumer/his17_2/ADT/screens/patientAdmission/sections/upload.image.view.modal.html",size:"lg",controller:"viewUploadsCtrl",controllerAs:"viewCtrl",resolve:{imgUrl:function(){return e},extF:function(){return t}}})};F.deleteFile=function(e,t){var a=_.findIndex(t,function(t){return t.name==e.name});_.findIndex(F.preNewFiles,function(t){t.name==e.name&&F.preNewFiles.splice(a,1)}),O.deleteFileORRetriveFileFun("removeDocumentList",t[a],angular.fromJson(sessionStorage.userContextObj)).then(function(t){angular.isUndefined(t.data.HITService.message.napierDocumentList[0]["com.napier.core.service.vo.uploadfile.NapierDocument"])||m.success("Success",e.name+" file deleted successfully ")}),F.deleteFiles.splice(a,1),F.numOffiles=F.numOffiles-1},F.searchPatient=function(e,t,a){return C.getVisitBasedPatientDetails(F.visitType,t).then(function(t){if(t&&t.length>0){if(2==e)return F.opPatData=t,F.opPatData;if(1==e)return F.ipPatData=t,a&&(F.patientipno=t[0],F.flow=1,F.searchPatientResult(F.patientipno),F.onVisitorIPFlow(F.visitType,F.patientipno)),F.ipPatData}})},this.stateParamCall=function(e){null!=R&&null!=R.valueObj&&null!=R.valueObj&&""!==R.valueObj&&(F.hideCloseBtn=!0,F.visitType=1,null!=angular.fromJson(R.valueObj)[0]&&angular.fromJson(R.valueObj)[0].preAuthList&&(F.getAuthList=angular.fromJson(R.valueObj)[0].preAuthList),null!=angular.fromJson(R.valueObj)[0]&&null!=angular.fromJson(R.valueObj)[0].selectedData&&angular.fromJson(R.valueObj)[0].selectedData.length>0?(F.patientipno=angular.fromJson(R.valueObj)[0].ipNo,F.patientBillingServiceData=e?void 0:angular.fromJson(R.valueObj)[0].selectedData):null!=angular.fromJson(R.valueObj)[0]&&angular.fromJson(R.valueObj)[0].ipNo?F.patientipno=angular.fromJson(R.valueObj)[0].ipNo:F.patientipno=angular.fromJson(R.valueObj),F.searchPatient(F.visitType,F.patientipno,!0))},F.selectedPreAuthNo=function(e){let t=angular.copy(F.flow),a=angular.copy(e);var i;if(e.RG_INT_MR_NO?(F.searchPatientResult(e.RG_INT_MR_NO),F.futuredata=e.RG_INT_MR_NO):e.RG_EXT_MR_NO&&(F.searchPatientResult(e.RG_EXT_MR_NO),F.futuredata=e.RG_EXT_MR_NO),F.flow=t,M(F.flow),F.authorizationreqno=a,e=a,F.approxBillNo=e.PREAUTH_BILL_NO,F.isPreauthorLimit=e.IS_PREAUTH_OR_LIMIT,F.isCurrentorFuture=e.IS_CURRENT_FUTURE_VISIT,F.currentdata=e.VISIT_NO,2==F.isPreauthorLimit?(F.updateEnhanceflag=!0,C.loadPreauthbasedonLimit(e.PREAUTH_BILL_HD_SEQ_ID).then(function(e){F.preAuthList=e,console.log(F.preAuthList)})):1==F.isPreauthorLimit&&C.loadLimitbasedonPreauth(e.PREAUTH_BILL_HD_SEQ_ID).then(function(e){F.LimitList=e,console.log(F.LimitList)}),function(e){F.isBillLevelFlag=1==e.IS_BILL_LEVEL,F.isServiceLevelFlag=2==e.IS_SERVICE_LEVEL,F.preauthbillseqid=e.PREAUTH_BILL_HD_SEQ_ID,F.billLevelCap=e.GROSS_AMT,F.submitted=e.IS_SUBMITTED,F.tariffSeqId=e.TARIFF_SEQ_ID,F.enseqid=e.EN_SEQ_ID,F.totalApprovedBillLevelAmt=e.APPROVED_AMNT}(e),function(e){e.PREAUTH_BILL_HD_SEQ_ID&&C.getPreAuthBasedClinicalDetails(e.PREAUTH_BILL_HD_SEQ_ID).then(function(e){console.log(e),F.PatClinicalData=e,F.flow=3,F.temppayerobj={},F.tempplanobj={},F.payerName=F.PatClinicalData[0].INC_COMP_NAME,F.planName=F.PatClinicalData[0].INC_PLAN_NAME,F.policyNumber=F.PatClinicalData[0].POLICY_NUMBER,F.cardNumber=F.PatClinicalData[0].CARD_NUMBER,F.payerseqid=F.PatClinicalData[0].INC_SEQ_ID,F.planseqid=F.PatClinicalData[0].INC_PLAN_SEQ_ID,F.visitType=F.PatClinicalData[0].VISIT_TYPE,1==F.isCurrentorFuture?1==F.visitType?F.patientipno=F.currentdata:2==F.visitType&&(F.visitno=F.currentdata):2==F.isCurrentorFuture&&(F.patientId=F.futuredata),F.visitdisableflag=!0,F.tempplanobj.planName=F.planName,F.tempplanobj.INC_PLAN_SEQ_ID=F.planseqid,F.temppayerobj.payerName=F.payerName,F.temppayerobj.incSeqId=F.payerseqid,F.expDate=new Date(F.PatClinicalData[0].EXPECTED_SER_DATE),F.estLengthStay=parseInt(F.PatClinicalData[0].EXPECTEDLOS),F.expLengthUnit=F.PatClinicalData[0].EXPECTEDLOS_TYPE,F.ExpectedlengthList.length>0&&angular.forEach(F.ExpectedlengthList,function(e,t){e.DETAIL_DESC==F.expLengthUnit&&(F.expLengthUnit=e.DT_CODE)}),F.admReason=F.PatClinicalData[0].REASON_FOR_ADMISSION,F.tempclinicalBedClass=F.PatClinicalData[0].BC_SEQ_ID,F.loadBedClass(F.temppayerobj,F.tempplanobj),F.chiefComplaints=F.PatClinicalData[0].CHIEF_COMPLAINTS,F.remarks=F.PatClinicalData[0].REMARKS,F.validTo=moment(F.PatClinicalData[0].PLAN_EFFECTIVE_TO).format("DD/MM/YYYY"),F.validFrom=moment(F.PatClinicalData[0].PLAN_EFFECTIVE_FROM).format("DD/MM/YYYY"),F.savevalidFrom=F.PatClinicalData[0].PLAN_EFFECTIVE_FROM,F.savevalidTo=F.PatClinicalData[0].PLAN_EFFECTIVE_TO})}(e),function(e){e.PREAUTH_BILL_HD_SEQ_ID&&C.getEstorPreAuthBasedProcedureDetails(e.PREAUTH_BILL_HD_SEQ_ID,F.preAuthFlag).then(function(e){console.log(e),F.ProcedureData=e;let t={};angular.forEach(F.ProcedureData,function(e,a){t.approxProcSeqId=e.APPROX_PROC_SEQ_ID,t.ICD9=e.STANDARD_CODE,t.CODE=e.STANDARD_CODE,t.DESCRIPTION=e.STANDARD_NAME,t.SUR_CODE=e.HOSP_CODE,t.SUR_NAME=e.HOSP_NAME,F.gridOptionsProcedure.data.push(t),t={}})})}(e),function(e){e.PREAUTH_BILL_HD_SEQ_ID&&C.getPreAuthBasedDiagnosisDetails(e.PREAUTH_BILL_HD_SEQ_ID).then(function(e){console.log(e);let t={};F.DiagnosisData=e,angular.forEach(F.DiagnosisData,function(e,a){t.diagSeqId=e.PREAUTH_DIAG_SEQ_ID,t.ICDCODE=e.STANDARD_CODE,t.DESCRIPTION=e.STANDARD_NAME,t.HOSP_DIAG_CODE=e.HOSP_CODE,t.HOSP_DIAG_DESC=e.HOSP_NAME,F.gridOptionsDiagnosis.data.push(t),t={}})})}(e),i=F.futuredata,C.getPayerBasedMrNo(i).then(function(e){angular.forEach(e,function(e,t){H(e,F.flow)})}),F.preAuthDetailsGridOtions.data=[],F.preAuthDetailsGridOtions.data[0]=[],F.preAuthDetailsGridOtions.data[0].isAmtNlPercFlag="1",F.preAuthDetailsGridOtions.data[0].valueAmt="",F.preAuthDetailsGridOtions.data[0].qty="",F.authApprovalGrid.data=[],null!=e&&null!=e.IS_SUBMITTED&&"Y"==e.IS_SUBMITTED?(F.approvalActive=!0,F.preAuthDetailsGridOtions.columnDefs[11].visible=!1,F.preAuthDetailsGridOtions.columnDefs[9].visible=!0,F.preAuthDetailsGridOtions.columnDefs[8].visible=!0,F.preAuthDetailsGridOtions.columnDefs[6].visible=!0,F.preAuthDetailsGridOtions.data=[],F.authAprServiceLevel=2==e.IS_SERVICE_LEVEL,F.authAprBillLevel=1==e.IS_BILL_LEVEL):F.approvalActive=!1,null!=F.authorizationreqno&&null!=F.authorizationreqno.PREAUTH_BILL_HD_SEQ_ID){let e={approxBillHdSeqId:F.authorizationreqno.PREAUTH_BILL_HD_SEQ_ID};L.getPreAuthData(e,F).then(function(t){if(F.requestFooterTotalAmt=0,F.approvalFooterTotalAmt=0,F.approvalDataList=[],F.approvalDataList[0]={applicabilityType:F.applicabilityList[0]},F.preAuthServiceList.length>0){F.authApprovalGrid.data=[];for(let e=0;e<F.preAuthServiceList.length;e++){let t={isAmtNlPercFlag:F.preAuthServiceList[e].IS_AMT_PERC_NL_CODE,apprIsAmtPercNl:null!=F.preAuthServiceList[e].APPR_IS_AMT_PERC_NL?F.preAuthServiceList[e].APPR_IS_AMT_PERC_NL+"":"",approxBillDtSeqId:F.preAuthServiceList[e].PREAUTH_BILL_DT_SEQ_ID,valueAmt:F.preAuthServiceList[e].CHARGEABLE_AMT,qty:F.preAuthServiceList[e].SERV_QTY,serviceApprovalStatus:F.preAuthServiceList[e].SERV_APPR_STSTUS,isOrderFrom:F.preAuthServiceList[e].IS_ORDER_FROM,serviceType:F.preAuthServiceList[e].SERVICE_HIERARCHY_LEVEL,manualFlag:1==F.preAuthServiceList[e].IS_ORDER_FROM,isApprovalRequired:F.preAuthServiceList[e].SERV_APPR_STSTUS,priServGroup:{DESCRIPTION:F.preAuthServiceList[e].PRI_SERV_DESC,CODE:F.preAuthServiceList[e].PRI_SERV_CODE,IS_MATERIAL:F.preAuthServiceList[e].IS_MATERIAL},department:{DESCRIPTION:F.preAuthServiceList[e].DEPT_DESC,CODE:F.preAuthServiceList[e].DEPT_CODE},specialty:{DESCRIPTION:F.preAuthServiceList[e].SPL_DESC,CODE:F.preAuthServiceList[e].SPL_CODE},service:{SERV_NAME:F.preAuthServiceList[e].SERV_NAME,SERV_SEQ_ID:F.preAuthServiceList[e].SERV_SEQ_ID},approvedDetails:F.preAuthServiceList[e].APPROVD_DTLS,approvedAmount:F.preAuthServiceList[e].APPROVED_AMNT,approvedQty:F.preAuthServiceList[e].APPROVED_QTY,remarks:F.preAuthServiceList[e].APPROVE_REMARKS,ismaterial:F.preAuthServiceList[e].IS_MATERIAL,applicabilityType:{DETAIL_DESC:F.preAuthServiceList[e].APPLICABILITY_TYPE_DESC,DT_CODE:F.preAuthServiceList[e].APPLICABILITY_TYPE}};F.preAuthDetailsGridOtions.data.push(t),F.duppreAuthDetailsGridOtions.push(t),null!=t.valueAmt&&null!=t.valueAmt&&""!==t.valueAmt&&(F.requestFooterTotalAmt=F.requestFooterTotalAmt+parseFloat(t.valueAmt)),F.isServiceLevelFlag=!0;let a=angular.copy(t);a.approvedDetails="",a.approvedAmount="",a.approvedQty="",a.remarks="",a.apprIsAmtPercNl="1",a.previousApprIsAmtPercNl=1,F.approvalDataList.push(a)}B(F.preAuthDetailsGridOtions.data)}T.getPreAuthApprovalHeaderData(F,e.approxBillHdSeqId).then(function(e){F.authApprovalGrid.data=[],null==F.preAuthApprovalHeaderList||0==F.preAuthApprovalHeaderList.length?(F.firstApproval=!0,F.addNewApproval()):(F.firstApproval=!1,F.appr={},F.authAprServiceLevel=!1,F.authAprBillLevel=!1)}),F.patientDetails={approxBillHdSeqId:F.authorizationreqno.PREAUTH_BILL_HD_SEQ_ID},y.getDocument(F).then(function(e){for(var t=0;t<e.length;t++)F.filesUploaded.push({"@class":"com.napier.core.service.vo.uploadfile.NapierDocument",docName:e[t].DOC_NAME,docSeqId:e[t].DOC_SEQ_ID,regSeqId:e[t].PRMRY_ENTITY_ID,status:2,machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,fileSize:e[t].FILE_SIZE,trimFileName:y.trimFile(e[t].DOC_NAME),fSize:e[t].FILE_SIZE}),F.uploadedfileNames.push(e[t].DOC_NAME)})})}},E.preAuthApprovalTabGridDefination(F,"preNew"),T.preAuthApprovalInit(F),F.actionGridOOP=function(e,t,a,i){T.preAuthApprovalOOPGridValidtion(e,t,a,i,F)},F.changeApprovedDetails=function(e){T.approvalDetailsChangeCal(e),null!=F.preAuthApprovalHeaderList&&(F.preAuthApprovalHeaderList.length>1||1==F.preAuthApprovalHeaderList.length&&1==F.firstApproval&&0==F.updateApproval)&&(e.appflow=!0,T.approvalValueTypeChangeCal(e,F)),T.calTotalApprovalAmt(F.authApprovalGrid.data,F.appr,F),T.calTotalViewApprovalAmt(F.authApprovalGrid.data,F.appr,F)},F.changedValueType=function(e){null!=F.preAuthApprovalHeaderList&&(F.preAuthApprovalHeaderList.length>1||1==F.preAuthApprovalHeaderList.length&&1==F.firstApproval&&0==F.updateApproval)&&T.approvalValueTypeChangeCal(e,F),T.calTotalApprovalAmt(F.authApprovalGrid.data,F.appr,F),T.calTotalViewApprovalAmt(F.authApprovalGrid.data,F.appr,F)},F.changedApproveAmt=function(e){T.approvalAmtChangeCal(e,F),T.calTotalApprovalAmt(F.authApprovalGrid.data,F.appr,F),T.calTotalViewApprovalAmt(F.authApprovalGrid.data,F.appr,F)},F.addNewApproval=function(){F.appr={},F.appr.addNewApp=!0,F.updateApproval=!1,F.appr.authCoPayApplicble="3",F.appr.authCoInsApplicable="3",F.appr.authCoPayLevel="1",F.appr.authCoInsLevel="1",e.preNew.activeSecond=1,F.authAprBillAmt="",F.coPayGrid.data=[],F.coPayGrid.data[0]={},F.coInsGrid.data=[],F.coInsGrid.data[0]={},F.authApprovalGrid.columnDefs[12].visible=!0,null!=F.authorizationreqno&&null!=F.authorizationreqno.PREAUTH_BILL_HD_SEQ_ID&&"Y"==F.authorizationreqno.IS_SUBMITTED&&0==F.Enhanceflag?(F.authApprovalGrid.data=[],F.authAprServiceLevel=2==F.authorizationreqno.IS_SERVICE_LEVEL,F.authAprBillLevel=1==F.authorizationreqno.IS_BILL_LEVEL,F.authApprovalGrid.data=F.approvalDataList,F.firstApproval=!0,F.inactivateApp=!1):null!=F.authorizationreqno&&null!=F.authorizationreqno.PREAUTH_BILL_HD_SEQ_ID&&"N"==F.authorizationreqno.IS_SUBMITTED||1==F.Enhanceflag?(F.authApprovalGrid.data=[],F.authAprServiceLevel=!1,F.authAprBillLevel=!1,F.firstApproval=!1,F.approvalActive=!1,F.inactivateApp=!0):null==F.authorizationreqno&&null!=e.patientGlobalDtls&&(1!=F.flow&&2!=F.flow?(F.authApprovalGrid.data=[],F.authApprovalGrid.data[0]={applicabilityType:F.applicabilityList[0]}):1!=F.flow&&2!=F.flow||0!=F.directApproval||(1==F.ServiceStatus||1==F.ServiceStatus?F.loaddata(!0):0!=F.ServiceStatus&&2!=F.ServiceStatus||F.loaddata(!1)),F.directApproval=!0,F.firstApproval=!0,F.inactivateApp=!1)},F.fromOptions={},F.toOptions={},F.changedValidFromTo=function(t){null!=t.authApprovalVaildFrom&&null!=t.authApprovalVaildFrom&&""!==t.authApprovalVaildFrom&&null==e.patientGlobalDtls.ipNo&&(F.toOptions.minDate=new Date(t.authApprovalVaildFrom)),null!=t.authApprovalValidTo&&null!=t.authApprovalValidTo&&""!==t.authApprovalValidTo&&null==e.patientGlobalDtls.ipNo&&(F.fromOptions.maxDate=new Date(t.authApprovalValidTo))},F.approvalDataSet=function(t){F.updateApproval=!1,F.firstApproval=!1,F.coPayGrid.data=[{}],F.coInsGrid.data=[{}],F.authApprovalGrid.columnDefs[12].visible=!1,F.prevoisApprovalServiceData=void 0,e.preNew.activeSecond=1,null!=t.SERVICE_LEVEL&&2==t.SERVICE_LEVEL&&(F.approvalFooterTotalAmt=0,T.getPreAuthApprovalServiceData(F,t.PREAUTH_BILL_APR_SEQ_ID).then(function(e){T.validateAndAppendInGridApproval(F,F.preAuthApprovalServiceData);for(let e=0;e<F.preAuthApprovalHeaderList.length;e++)if(F.preAuthApprovalHeaderList[e].PREAUTH_BILL_APR_SEQ_ID==t.PREAUTH_BILL_APR_SEQ_ID){e>0?T.getPreAuthApprovalServiceData(F,F.preAuthApprovalHeaderList[e-1].PREAUTH_BILL_APR_SEQ_ID).then(function(e){F.prevoisApprovalServiceData=F.preAuthApprovalServiceData}):F.prevoisApprovalServiceData=void 0;break}})),T.setApprovalHeaderData(F,t,F.appr),T.getPreAuthOutOfPocketHeaderData(F,t.PREAUTH_BILL_APR_SEQ_ID).then(function(e){null!=F.preAuthOutOfPocketHeaderData&&F.preAuthOutOfPocketHeaderData.length>0&&(F.preAuthOutOfPocketHeaderData[0].COINSURNACE_IS_SERVICE_OR_BILL_LEVEL=1,2!=F.preAuthOutOfPocketHeaderData[0].COINSURNACE_IS_SERVICE_OR_BILL_LEVEL&&2!=F.preAuthOutOfPocketHeaderData[0].COPAY_IS_SERVICE_OR_BILL_LEVEL||T.getPreAuthOutOfPocketServiceData(F,F.preAuthOutOfPocketHeaderData[0].PCOPAY_SEQ_ID).then(function(e){T.validateAndAppendInGridOutOfPocket(F,F.preAuthOutOfPocketServiceData),F.previousOutOfPocketServiceList=void 0;for(let e=0;e<F.preAuthApprovalHeaderList.length;e++)if(F.preAuthApprovalHeaderList[e].PREAUTH_BILL_APR_SEQ_ID==t.PREAUTH_BILL_APR_SEQ_ID){e>0&&T.getPreAuthOutOfPocketHeaderData(F,F.preAuthApprovalHeaderList[e-1].PREAUTH_BILL_APR_SEQ_ID).then(function(e){T.getPreAuthOutOfPocketServiceData(F,F.preAuthOutOfPocketHeaderData[0].PCOPAY_SEQ_ID).then(function(e){F.previousOutOfPocketServiceList=F.preAuthOutOfPocketServiceData})});break}}),T.setOutOfPocketHeaderData(F,F.preAuthOutOfPocketHeaderData[0],F.appr))})},F.setOutOfPocket=function(){F.updateApproval=!0,F.inactivateApp=!1,1==F.appr.authCoPayApplicble&&"2"==F.appr.authCoPayLevel&&F.coPayGrid.data.splice(0,0,{}),1==F.appr.authCoInsApplicable&&"2"==F.appr.authCoInsLevel&&F.coInsGrid.data.splice(0,0,{}),F.authApprovalGrid.data.splice(0,0,{applicabilityType:F.applicabilityList[0]}),F.authApprovalGrid.columnDefs[12].visible=!0},F.changeApprovalNo=function(e){if(null!=e&&null!=e&&""!==e&&null!=e.PREAUTH_BILL_APR_SEQ_ID)if((null!=F.authAprServiceLevel&&null!=F.authAprServiceLevel&&F.authAprServiceLevel||null!=F.authAprBillLevel&&null!=F.authAprBillLevel&&F.authAprBillLevel)&&F.updateApproval){let t={buttonText:F.alertData.no,buttonText2:F.alertData.yes},a={buttonCallBack1:function(){},buttonCallBack2:function(){F.approvalDataSet(e)}},i={buttonClose:function(){}};m.hisAlertMulti("information",F.alertData.alertTypeInfo,F.alertData.unSavedDataWilBeLstDoYuWantCont,t,a,i)}else F.approvalDataSet(e)},F.preAuthApprovalSave=function(e){T.approvalValidationCheck(F,F.appr)&&(F.apprvalSaveData=T.approvalSaveRequestPrepartion(F,F.authApprovalGrid.data,F.appr,F.coPayGrid.data,F.coInsGrid.data),1==F.isPreauthorLimit?F.savePreAuth(1):2==F.isPreauthorLimit&&F.savePreAuth(),e&&(F.isServiceLevelFlag=!0,F.savePreAuth(1)))},F.limitEnhnmntPopup=function(t){I.open("Limit Enhancement",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/pre-authorazation-list/pre_auth_new_screen/limit.enhancement.modal.popup.html",size:t,controller:"limitEnhnmntCtrl",controllerAs:"limitenh",resolve:{service:function(){return F.duppreAuthDetailsGridOtions},submitStatus:function(){return F.submitted}}}).result.then(function(t){console.log(t),F.preAuthDetailsGridOtions.data=[],F.preAuthDetailsGridOtions.data[0]=[],"Y"==F.submitted&&(F.approvalActive=!1,e.preNew.activefirst=2,F.preAuthDetailsGridOtions.columnDefs[11].visible=!0,F.preAuthDetailsGridOtions.columnDefs[9].visible=!1,F.preAuthDetailsGridOtions.columnDefs[8].visible=!1),t.length>0&&angular.forEach(t,function(e,t){F.preAuthDetailsGridOtions.data.push(e)}),F.Enhanceflag=!0,F.submitted="N",F.isBillLevelFlag=!1,F.billLevelCap=void 0,F.remarks=void 0,B(F.preAuthDetailsGridOtions.data),F.addNewApproval()},function(){})},F.applicabilityList=[],F.reqObject={1:F.applicabilityList};var W=t.executeQueryURLReset();function $(){let t="",a=[];for(let e=0;e<F.preAuthNoList.length;e++)1==F.preAuthNoList[e].preAuthCheck&&a.push(F.preAuthNoList[e].PREAUTH_BILL_HD_SEQ_ID);a.length>0&&(t=_.toString(a)),e.$emit("addPreAuthNoToCal",t)}F.paramsValue=new Array,t.prepareParamListWithParam("pMasterSqId","800021",F.paramsValue),t.executeQueryInput("TRN003",F.paramsValue,F.reqObject,!0,!0,W,"popUp",{}),F.inActiveOtherPreNo=function(e){for(let t=0;t<F.preAuthNoList.length;t++)if(t!=e&&null!=F.preAuthNoList[t].activeThird&&1==F.preAuthNoList[t].activeThird){F.preAuthNoList[t].activeThird=void 0;break}},F.createNewPreAuth=function(){F.clear(),F.inActiveOtherPreNo(F.inActiveOtherPreNo.length+1)},F.loaddata=function(e){if(1==e)F.ServiceStatusDesc="Active",F.tempauthApprovalGrid.length>0&&(0==F.authApprovalGrid.data.length&&F.authApprovalGrid.data.splice(0,0,{applicabilityType:F.applicabilityList[0]}),angular.forEach(F.tempauthApprovalGrid,function(e,t){F.authApprovalGrid.data.push(e)}));else if(0==e){F.ServiceStatusDesc="InActive",F.tempauthApprovalGrid=[],angular.forEach(F.authApprovalGrid.data,function(e,t){2==e.isOrderFrom&&(F.tempauthApprovalGrid.push(e),delete F.authApprovalGrid.data[t])});for(let e=0;e<F.authApprovalGrid.data.length;e++)null==F.authApprovalGrid.data[e]&&(F.authApprovalGrid.data.splice(e,1),e--);0==F.authApprovalGrid.data.length&&F.authApprovalGrid.data.splice(0,0,{applicabilityType:F.applicabilityList[0]})}T.calTotalApprovalAmt(F.authApprovalGrid.data,F.appr,F),T.calTotalViewApprovalAmt(F.authApprovalGrid.data,F.appr,F)},F.changeServBillLevel=function(){1==F.authAprServiceLevel&&0==F.authAprBillLevel?(F.authAprBillAmt=void 0,T.calTotalApprovalAmt(F.authApprovalGrid.data,F.appr,F),T.calTotalViewApprovalAmt(F.authApprovalGrid.data,F.appr,F)):0==F.authAprServiceLevel&&0==F.authAprBillLevel?(F.appr.authApprovalAmt=void 0,F.appr.authApprovalAmtView=void 0,F.authAprBillAmt=void 0):0==F.authAprServiceLevel&&1==F.authAprBillLevel?(F.appr.authApprovalAmt=F.authAprBillAmt,F.appr.authApprovalAmtView=F.authAprBillAmt):1==F.authAprServiceLevel&&1==F.authAprBillLevel&&(F.appr.authApprovalAmt=F.authAprBillAmt,F.appr.authApprovalAmtView=F.authAprBillAmt,T.calTotalApprovalAmt(F.authApprovalGrid.data,F.appr,F),T.calTotalViewApprovalAmt(F.authApprovalGrid.data,F.appr,F))},this.onChangePreAuthCheck=function(t){if(t.preAuthCheck){if(null==e.patientGlobalDtls.insurancePlanSeqId){t.preAuthCheck=!1;let a="For Self Patient Can't Apply Pre-Authorzation";return m.hisAlertMulti("information",F.alertData.alertTypeInfo,a,e.alertData,e.alertFunction,e.close),!1}if(null!=e.patientGlobalDtls.insurancePlanSeqId&&e.patientGlobalDtls.insurancePlanSeqId!=t.INC_PLAN_SEQ_ID){t.preAuthCheck=!1;let a="Payer Should Same As Patient Payer For Pre-Authorzation.";return m.hisAlertMulti("information",F.alertData.alertTypeInfo,a,e.alertData,e.alertFunction,e.close),!1}if(null==t.SUB_ACC_SEQ_ID||null!=t.IS_CHECK_FUTURE_PREAUTH){let e="You are selecting future admission Authorization in current admission. Do you want to continue?",a={buttonText:F.alertData.no,buttonText2:F.alertData.yes},i={buttonCallBack1:function(){t.preAuthCheck=!1},buttonCallBack2:function(){$()}},r={buttonClose:function(){t.preAuthCheck=!1}};m.hisAlertMulti("information",F.alertData.alertTypeInfo,e,a,i,r)}else $()}else $()},this.stateParamCall(),F.validateGrid=function(){F.appr.authCoInsBillAmt&&parseFloat(F.appr.authCoInsBillAmt)>parseFloat(100)&&(F.appr.authCoInsBillAmt=100)}}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m){n.loadModule("billing");var g=l.getLanguageToSet();n.changeLanguage(g);var S=this;S.updatePayerListDisable=!0,S.alertData={},o.loadAlerts(g).then(function(e){S.alertData=e,S.alertData={buttonText:S.alertData.ok},S.alertFunction={buttonCallBack1:function(){}},S.close={buttonClose:function(){}}},function(e){}),S.payerDetailsGridOtions=angular.copy(s.payerDetailsGridOtions),S.payerDetailsGridOtions.data=[],S.payerDetailsGridOtions.data[0]=[],S.savepayerdata=[],function(){if(null!=t){let e={prePay:{}};e.prePay.payerobj={},e.prePay.planobj={},angular.forEach(t,function(t,a){t.INC_SEQ_ID&&t.IN_PLC_SEQ_CD&&(null!=t.select&&(e.prePay.select=t.select,e.prePay.selectFlag=t.select),e.prePay.billPayerSeqId=t.BL_PR_SEQ_ID,e.prePay.cardno=t.CARD_NUMBER,e.prePay.payer=t.COMP_NAME,e.prePay.payerid=t.INC_SEQ_ID,e.prePay.plan=t.PLAN_NAME,e.prePay.planid=t.IN_PLC_SEQ_CD,e.prePay.policyno=t.POLICY_NO,e.prePay.viewfromDate=moment(new Date(t.PI_FROM_DATE)).format("DD/MM/YYYY"),e.prePay.viewtoDate=moment(new Date(t.PI_TO_DATE)).format("DD/MM/YYYY"),e.prePay.fromDate=t.PI_FROM_DATE,e.prePay.toDate=t.PI_TO_DATE,e.prePay.payerobj.incSeqId=t.INC_SEQ_ID,e.prePay.planobj.INC_PLAN_SEQ_ID=t.IN_PLC_SEQ_CD,e.prePay.payerobj.inCompName=t.COMP_NAME,e.prePay.planobj.INC_PLAN_NAME=t.PLAN_NAME,S.payerDetailsGridOtions.data.push(e),(e={}).prePay={},e.prePay.payerobj={},e.prePay.planobj={})})}}(),S.fromDateOptions={maxDate:new Date,startingDay:1},S.toDateOptions={minDate:new Date,startingDay:1},S.fromDateChange=function(e){S.fromDateOptions.maxDate=e.prePay.toDate?e.prePay.toDate:new Date},S.toDateChange=function(e){S.toDateOptions.minDate=e.prePay.fromDate?e.prePay.fromDate:new Date},S.formats=["dd-MMMM-yyyy","dd/MM/yyyy","dd.MM.yyyy","shortDate"],S.format=S.formats[1],S.altInputFormats=["M!/d!/yyyy"],S.expectedDateService=function(){S.popup2.opened=!0},S.toDateCAL=function(){S.popup1.opened=!0},S.popup2={opened:!1},S.popup1={opened:!1},S.payerDetailsGridOtions.onRegisterApi=function(e){S.payerDetailsGridOtionsApi=e},S.advSearchRowClick=function(e){$("input[name=rdUserList]").attr("checked",!0),S.updatePayerListDisable=!1,S.rowsSelected=e.entity},S.selectPayer=function(){S.rowsSelected=Array.isArray(S.rowsSelected)?S.rowsSelected:[S.rowsSelected],null==S.rowsSelected[0].prePay.tariffId?S.fillPlans(S.rowsSelected).then(function(e){e.length>0&&(S.rowsSelected[0].prePay.tariffId=e[0].TARIFF_SEQ_ID),r.close(S.rowsSelected)}):r.close(S.rowsSelected)},S.preAuthListClean=function(){S.policyno="",S.cardno="",S.plan="",S.payer="",S.fromDate="",S.toDate="",data.prePay.viewtoDate="",data.prePay.viewfromDate="",S.payerDetailsGridOtions.data=[],S.updatePayerListDisable=!0,S.savepayerdata=[]},S.clearRecordFirst=function(t){null!=t&&t.entity.editable&&(t.entity.editable=!1,e.toggleText=""),S.payerDetailsGridOtions.data[0]=[]},S.addRowGrid=function(e){if(S.payerDetailsGridOtions.data.length>1&&(0==S.payerDetailsGridOtions.data[0].editable||null==S.payerDetailsGridOtions.data[0].editable)){var t=S.payerDetailsGridOtions.data.slice(1),i=t.find(t=>t.prePay.payerobj.incSeqId==e.entity.prePay.payer.incSeqId),r=t.find(t=>t.prePay.planobj.INC_PLAN_SEQ_ID==e.entity.prePay.plan.INC_PLAN_SEQ_ID);if(null!=i&&null!=r)return u.hisAlertMulti("information",S.alertData.alertTypeInfo,"Plan already exists. Please select any different plan",S.alertData,S.alertFunction,S.close),!1}let n={},l=!0;n.prePay={},n.prePay.billPayerSeqId=e.entity.prePay.billPayerSeqId,n.prePay.select=e.entity.prePay.select,n.prePay.cardno=e.entity.prePay.cardno,n.prePay.fromDate=e.entity.prePay.fromDate,n.prePay.payer=e.entity.prePay.payer.inCompName,n.prePay.payerobj=e.entity.prePay.payer,n.prePay.plan=e.entity.prePay.plan.INC_PLAN_NAME,n.prePay.planobj=e.entity.prePay.plan,n.prePay.policyno=e.entity.prePay.policyno,n.prePay.toDate=e.entity.prePay.toDate,n.prePay.viewfromDate=moment(e.entity.prePay.fromDate).format("DD/MM/YYYY"),n.prePay.viewtoDate=moment(e.entity.prePay.toDate).format("DD/MM/YYYY"),n.prePay.tariffId=e.entity.prePay.plan.TARIFF_SEQ_ID,null==n.prePay.toDate||""==n.prePay.toDate?(u.hisAlertMulti("information",S.alertData.alertTypeInfo,"Please Enter To Date",S.alertData,S.alertFunction,S.close),l=!1):null==n.prePay.payer||""==n.prePay.payer?(u.hisAlertMulti("information",S.alertData.alertTypeInfo,"Please Select Payer",S.alertData,S.alertFunction,S.close),l=!1):null==n.prePay.plan||""==n.prePay.plan?(u.hisAlertMulti("information",S.alertData.alertTypeInfo,"Please Select Plan",S.alertData,S.alertFunction,S.close),l=!1):null==n.prePay.policyno||""==n.prePay.policyno?(u.hisAlertMulti("information",S.alertData.alertTypeInfo,"Please Enter Policy Number",S.alertData,S.alertFunction,S.close),l=!1):null!=n.prePay.fromDate&&""!=n.prePay.fromDate||(u.hisAlertMulti("information",S.alertData.alertTypeInfo,"Please Enter From Date",S.alertData,S.alertFunction,S.close),l=!1),null!=a&&S.savepayerdata.push({enSeqId:a.enSeqId,gnStatus:a.gnStatus,insTypeSeqCd:a.insTypeSeqCd,ipAdmSeqId:a.ipAdmSeqId,isNewPayer:a.isNewPayer,patientType:a.patientType,payerType:a.payerType,piInPriority:a.piInPriority,regSeqId:a.regSeqId,insuranceSeqId:n.prePay.planobj.INC_SEQ_ID,insurancePlanSeqId:n.prePay.planobj.INC_PLAN_SEQ_ID,tariffCatgCode:n.prePay.tariffId,policyNumber:n.prePay.policyno,cardNumber:n.prePay.cardno,planValidFromDate:n.prePay.fromDate,planValidToDate:n.prePay.toDate}),1==l&&null==S.payerDetailsGridOtions.data[0].recordIndex&&(n.prePay.select=!1,n.prePay.selectFlag=!0,S.updatePayerListDisable=!1,S.rowsSelected=n,S.payerDetailsGridOtions.data.push(n),S.payerDetailsGridOtions.data[0]=[],null!=a&&m.savepayer(S.savepayerdata[0]),S.savepayerdata=[],S.clearRecordFirst(e))},S.editGridData=function(t,a){S.prevoisIndex=a;let i={prePay:{}};i.prePay.cardno=t.entity.prePay.cardno,i.prePay.fromDate=t.entity.prePay.fromDate,i.prePay.policyno=t.entity.prePay.policyno,i.prePay.toDate=t.entity.prePay.toDate,i.prePay.payer=t.entity.prePay.payerobj?t.entity.prePay.payerobj:t.entity.prePay.payer?t.entity.prePay.payer:void 0,i.prePay.plan=t.entity.prePay.planobj?t.entity.prePay.planobj:t.entity.prePay.plan?t.entity.prePay.plan:void 0,i.prePay.viewfromDate=moment(t.entity.prePay.fromDate).format("DD/MM/YYYY"),i.prePay.viewtoDate=moment(t.entity.prePay.toDate).format("DD/MM/YYYY"),i.prePay.tariffId=t.entity.prePay.tariffId,i.prePay.billPayerSeqId=t.entity.prePay.billPayerSeqId,i.prePay.select=t.entity.prePay.select,S.payerDetailsGridOtions.data[0]=i,S.payerDetailsGridOtions.data[0].editable=!0,S.payerDetailsGridOtions.data[0].recordIndex=a,e.toggleText="UPDATE"},S.payerSearch=function(e){var t={url:"HISServices/InsuranceCompanyMasterService"};return t.requestData={operation:"getSearchService",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",inCompId:e,payerType:S.selectedName?S.selectedName.Code:-999,payerFacilityLkVo:[{"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo":[{"@class":"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo",facilityId:S.insurerSearchModal?S.insurerSearchModal.CODE:""}]}]}},p.sendRestRequest(t).then(function(e){if(S.insurerFinal1=[],S.insSearchVar=!1,e.data.HITService.message)return S.insurerFinal1=e.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster"],S.insurerFinal1=Array.isArray(S.insurerFinal1)?S.insurerFinal1:[S.insurerFinal1],S.insSearchVar=!1,S.insurerFinal1.map(function(e){return e});S.insSearchVar=!0,delete S.insurerSearchModal})},S.fillPlans=function(e,t){let a,r;e.entity?(a=e.entity.prePay.payer.incSeqId,r=t):(a=e[0].prePay.payerobj.incSeqId,r=e[0].prePay.plan),S.dataForPlansList={1:S.plansList=[]};var n=i.executeQueryURLReset();return S.plansArr=new Array,i.prepareParamListWithParam("pFacilityID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID_DESC,S.plansArr),i.prepareParamListWithParam("pInsSeqId",a,S.plansArr),i.prepareParamListWithParam("pname",r,S.plansArr),i.executeQueryInput("GET_PAYER_PLANS",S.plansArr,S.dataForPlansList,!0,!0,n,"popUp",{}).then(function(e){return S.plansList.map(function(e){return e})})}}e.$inject=["$scope","payer","patientdata","QueryService","$uibModalInstance","hisTranslationsService","hisTranslationsGlobalLang","PreAuthConstants","hisGenericAlertService","IPINDENTAPIS","$filter","CallManager","hisAlertService","PreAuthSaveServices"],angular.module("napierContainerUi").controller("PreAuthorizationPayerModalController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d){i.loadModule("billing");var p=r.getLanguageToSet();i.changeLanguage(p);var u=this;u.updateReqListDisable=!0,u.alertData={},l.loadAlerts(p).then(function(t){u.alertData=t,e.alertData={buttonText:u.alertData.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}},function(e){}),u.searchListGridOptions=angular.copy(n.searchListGridOptions),u.fromDateOptions={maxDate:new Date,startingDay:1},u.toDateOptions={minDate:new Date,startingDay:1},u.fromDateChange=function(){u.fromDateOptions.maxDate=u.toDate},u.toDateChange=function(){u.toDateOptions.minDate=u.fromDate},u.formats=["dd-MMMM-yyyy","dd/MM/yyyy","dd.MM.yyyy","shortDate"],u.format=u.formats[1],u.altInputFormats=["M!/d!/yyyy"],u.expectedDateService=function(){u.popup2.opened=!0},u.toDateCAL=function(){u.popup1.opened=!0},u.popup2={opened:!1},u.popup1={opened:!1},u.fromDate=new Date,u.toDate=new Date,u.searchListGridOptions.onRegisterApi=function(e){u.searchListGridOptionsApi=e},u.advSearchRowClick=function(e){$("input[name=rdUserList]").attr("checked",!0),u.updateReqListDisable=!1,u.rowsSelected=e.entity},u.selectPreAuthData=function(){u.rowsSelected=Array.isArray(u.rowsSelected)?u.rowsSelected:[u.rowsSelected],a.close(u.rowsSelected)},u.preAuthListClean=function(){u.updateReqListDisable=!0,u.authorizationno="",u.uhid="",u.patientname="",u.payer="",u.fromDate=new Date,u.toDate=new Date,u.searchListGridOptions.data=[]},u.preAuthListSearch=function(a){if(null!=a.fromDate&&null==a.toDate)return void d.hisAlertMulti("warning",a.alertData.alertTypeWarn,"Please select To Date",!1,!1,e.close,2e3);if(null==a.fromDate&&null!=a.toDate)return void d.hisAlertMulti("warning",a.alertData.alertTypeWarn,"Please select From Date",!1,!1,e.close,2e3);a.preAuthList=[];let i={1:a.preAuthList},r=t.executeQueryURLReset(),n=new Array;t.prepareParamListWithParam("@pAuthNo",null==a.authorizationno||null==a.authorizationno?"":a.authorizationno,n),t.prepareParamListWithParam("@pPatientID",null==a.uhid||null==a.uhid?"":a.uhid,n),t.prepareParamListWithParam("@pPatientName",null==a.patientname||null==a.patientname?"":a.patientname,n),t.prepareParamListWithParam("@pPayer_Name",null==a.payer||null==a.payer?"":a.payer.inCompName,n),t.prepareParamListWithParam("@pFromDate",null!=a.fromDate?o("date")(a.fromDate,"yyyy-MM-dd")+" 00:00:00.000":"1800-01-01 00:00:00",n),t.prepareParamListWithParam("@pToDate",null!=a.toDate?o("date")(a.toDate,"yyyy-MM-dd")+" 23:59:59.000":"9999-01-01 00:00:00",n),t.executeQueryInput("GET_PREAUTH_SEARCH_DTLS_PREATHNO_UHID_PAYER",n,i,!0,!0,r,"popUp",{}).then(function(t){var i=t[1];if(a.searchListGridOptions.data=[],null==i||null==i||" "==i||0==i.length){a.searchListGridOptions.data=[],a.searchListGridOptions.enableVerticalScrollbar=0;var r=a.alertData.noRcrdFound;d.hisAlertMulti("information",a.alertData.alertTypeInfo,r,e.alertData,e.alertFunction,e.close)}else i instanceof Array?(a.searchListGridOptions.data=i,a.searchListGridOptions.data.length>5?a.searchListGridOptions.enableVerticalScrollbar=1:a.searchListGridOptions.enableVerticalScrollbar=0):(a.searchListGridOptions.data.push(i),a.searchListGridOptions.enableVerticalScrollbar=0)})},u.payerSearch=function(e){var t={url:"HISServices/InsuranceCompanyMasterService"};return t.requestData={operation:"getSearchService",messageId:"",destination:"com.napier.core.master.service.external.InsuranceCompanyMasterService",message:{"@class":"com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster",inCompId:e,payerType:u.selectedName?u.selectedName.Code:-999,payerFacilityLkVo:[{"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo":[{"@class":"com.napier.core.service.vo.emrmasters.PayerFacilityLkVo",facilityId:u.insurerSearchModal?u.insurerSearchModal.CODE:""}]}]}},c.sendRestRequest(t).then(function(e){if(u.insurerFinal1=[],u.insSearchVar=!1,e.data.HITService.message)return u.insurerFinal1=e.data.HITService.message[0]["com.napier.core.service.vo.emrmasters.InsuranceCmpanyMaster"],u.insurerFinal1=Array.isArray(u.insurerFinal1)?u.insurerFinal1:[u.insurerFinal1],u.insSearchVar=!1,u.insurerFinal1.map(function(e){return e});u.insSearchVar=!0,delete u.insurerSearchModal})}}e.$inject=["$scope","QueryService","$uibModalInstance","hisTranslationsService","hisTranslationsGlobalLang","PreAuthConstants","hisGenericAlertService","IPINDENTAPIS","$filter","CallManager","hisAlertService"],angular.module("napierContainerUi").controller("PreAuthorizationReqModalController",e)}(),angular.module("napierContainerUi").service("PreAuthService",["dropdownQueryService","otComService","QueryService",function(e,t,a){this.loadExpectedlength=function(){return e.getList("TRN003",[{ident:"0",value:"802"},{ident:"1",value:"802"}]).then(function(e){var a=[],i=t.getQryComboList(e);return angular.forEach(i,function(e,t){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={DT_CODE:i[0].data,DETAIL_DESC:i[1].data};a.push(r)}),a})},this.commonServiceOnLoad=function(e){e.priServGroupList=[];let t={1:e.priServGroupList},i=a.executeQueryURLReset(),r=new Array;a.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r),a.executeQueryInput("BL_GET_PSG_SEARCH_SP",r,t,!0,!0,i,"popUp",{})},this.getDepartment=function(e,t,i,r,n){if(e.deptList=[],e.speciltyList=[],e.duppriServ=t,null==t||null==t)i.service=void 0,i.valueAmt="",i.qty="",i.applicabilityType=e.applicabilityList[0];else if(null!=t&&null!=t.CODE&&"Y"!=t.IS_MATERIAL){let l={1:e.deptList},s=a.executeQueryURLReset(),o=new Array;a.prepareParamListWithParam("pPSG_CODE",t.CODE,o),a.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,o),a.executeQueryInput("BL_GET_DEPARTMENT_SEARCH_SP",o,l,!0,!0,s,"popUp",{}).then(function(t){n&&null!=r.department&&null!=r.department.CODE?(i.department=a.getObjectByAnyValue(e.deptList,r.department.CODE,"CODE"),e.changeDept(e.duppriServ,i.department,i,r,n)):null!=r?(i.department=a.getObjectByAnyValue(e.deptList,r.DEPT_CODE,"CODE"),null!=i.department&&e.changeDept(e.duppriServ,i.department,i,r)):null==r&&(i.service=void 0,i.valueAmt="",i.qty="",i.applicabilityType=e.applicabilityList[0])})}else if("Y"==t.IS_MATERIAL){let l={1:e.deptList},s=a.executeQueryURLReset(),o=new Array;a.prepareParamListWithParam("pMetSubCatSeqId",t.CODE,o),a.executeQueryInput("FETCH_MAT_GROUP",o,l,!0,!0,s,"popUp",{}).then(function(t){n&&null!=r.department&&null!=r.department.CODE?(i.department=a.getObjectByAnyValue(e.deptList,r.department.CODE,"CODE"),e.changeDept(e.duppriServ,i.department,i,r,n)):null!=r?(i.department=a.getObjectByAnyValue(e.deptList,r.DEPT_CODE,"CODE"),null!=i.department&&e.changeDept(e.duppriServ,i.department,i,r)):null==r&&(i.service=void 0,i.valueAmt="",i.qty="",i.applicabilityType=e.applicabilityList[0])})}},this.getSpeciltyData=function(e,t,i,r,n,l){if(e.speciltyList=[],null==i||null==i)r.service=void 0,r.valueAmt="",r.qty="",r.applicabilityType=e.applicabilityList[0],r.inActiveVal=!0;else if(null!=i&&null!=i.CODE&&"Y"!=t.IS_MATERIAL){let s={1:e.speciltyList},o=a.executeQueryURLReset(),c=new Array;a.prepareParamListWithParam("pPSG_CODE",t.CODE,c),a.prepareParamListWithParam("pDEPT_CODE",i.CODE,c),a.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,c),a.executeQueryInput("BL_GET_SPECIALITY_SEARCH_SP",c,s,!0,!0,o,"popUp",{}).then(function(t){l&&null!=n.specialty&&null!=n.specialty.CODE?r.specialty=a.getObjectByAnyValue(e.speciltyList,n.specialty.CODE,"CODE"):null!=n?(null!=r.addedServiceDirectly&&1==r.addedServiceDirectly?r.inActiveVal=!0:r.inActiveVal=!1,r.specialty=a.getObjectByAnyValue(e.speciltyList,n.SPL_CODE,"CODE")):null==n&&(r.service=void 0,r.valueAmt="",r.qty="",r.applicabilityType=e.applicabilityList[0],r.inActiveVal=!0)})}else if("Y"==t.IS_MATERIAL){let t={1:e.speciltyList},s=a.executeQueryURLReset(),o=new Array;a.prepareParamListWithParam("pMetMainCatSeqId",i.CODE,o),a.executeQueryInput("FETCH_MAT_SUB_GROUP",o,t,!0,!0,s,"popUp",{}).then(function(t){l&&null!=n.specialty&&null!=n.specialty.CODE?r.specialty=a.getObjectByAnyValue(e.speciltyList,n.specialty.CODE,"CODE"):null!=n?(null!=r.addedServiceDirectly&&1==r.addedServiceDirectly?r.inActiveVal=!0:r.inActiveVal=!1,r.specialty=a.getObjectByAnyValue(e.speciltyList,n.SPL_CODE,"CODE")):null==n&&(r.service=void 0,r.valueAmt="",r.qty="",r.applicabilityType=e.applicabilityList[0],r.inActiveVal=!0)})}},this.getServiceList=function(e,t,i){e.serviceListData=[];let r={1:e.serviceListData};if(e.priServGroup&&"Y"!=e.priServGroup.IS_MATERIAL){let n=a.executeQueryURLReset(),l=new Array;return a.prepareParamListWithParam("pPSG_CODE",null!=e.priServGroup&&null!=e.priServGroup.CODE?e.priServGroup.CODE:-999,l),a.prepareParamListWithParam("pDEPT_CODE",null!=e.department&&null!=e.department.CODE?e.department.CODE:-999,l),a.prepareParamListWithParam("pSPECL_CODE",null!=e.specialty&&null!=e.specialty.CODE?e.specialty.CODE:-999,l),a.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,l),a.prepareParamListWithParam("pSERV_NAME",null!=t&&null!=t?t:"",l),a.prepareParamListWithParam("pGN_FLOW",null!=i.visitType&&null!=i.visitType?i.visitType:-999,l),a.executeQueryInput("BL_GET_SERVICE_SEARCH_SP",l,r,!0,!0,n,"popUp",{}).then(function(t){return e.serviceListData.map(function(e){return e})})}if(e.priServGroup&&"Y"==e.priServGroup.IS_MATERIAL){let i=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pMaterialCat",null!=e.priServGroup&&null!=e.priServGroup.CODE?e.priServGroup.CODE:-999,n),a.prepareParamListWithParam("pMaterialGroup",null!=e.department&&null!=e.department.CODE?e.department.CODE:-999,n),a.prepareParamListWithParam("pMaterialSubGroup",null!=e.specialty&&null!=e.specialty.CODE?e.specialty.CODE:-999,n),a.prepareParamListWithParam("pMatCodeName",null!=t&&null!=t?t:"",n),a.executeQueryInput("PACKAGE_MATERIAL_DETAILS",n,r,!0,!0,i,"popUp",{}).then(function(t){return e.serviceListData.map(function(e){return e})})}{let n=a.executeQueryURLReset(),l=new Array;return a.prepareParamListWithParam("pPSG_CODE",-999,l),a.prepareParamListWithParam("pDEPT_CODE",-999,l),a.prepareParamListWithParam("pSPECL_CODE",-999,l),a.prepareParamListWithParam("pPRACTICEID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,l),a.prepareParamListWithParam("pSERV_NAME",null!=t&&null!=t?t:"",l),a.prepareParamListWithParam("pGN_FLOW",null!=i.visitType&&null!=i.visitType?i.visitType:-999,l),a.executeQueryInput("BL_GET_SERVICE_SEARCH_SP",l,r,!0,!0,n,"popUp",{}).then(function(t){return e.serviceListData.map(function(e){return e})})}},this.getDropDownBasedService=function(e,t,i){var r=!0;t&&t.priServGroup&&t.department&&t.specialty&&(r=!1,t.addedServiceDirectly=r),t.priServGroup&&t.department&&null==t.specialty&&(r=!1,t.addedServiceDirectly=r,t.inActiveVal=!1,t.specialty=a.getObjectByAnyValue(i.speciltyList,e.SPL_CODE,"CODE")),r&&(null!=e.PRI_SERV_CODE&&(t.priServGroup=a.getObjectByAnyValue(i.priServGroupList,e.PRI_SERV_CODE,"CODE")),null!=t.priServGroup&&i.changePriServ(t.priServGroup,t,e),t.addedServiceDirectly=r)},this.getVisitBasedPatientDetails=function(e,t){var i=[];let r={1:i},n=a.executeQueryURLReset(),l=new Array;return a.prepareParamListWithParam("@PAT_TYPE",null!=e&&null!=e?e:-999,l),a.prepareParamListWithParam("@VISIT_NO",null!=t&&null!=t?t:" ",l),a.prepareParamListWithParam("@FACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,l),a.executeQueryInput("GET_PATIENT_DTLS_BASED_ON_VISIT",l,r,!0,!0,n,"popUp",{}).then(function(e){return i.map(function(e){return e})})},this.getVisitorIPBasedPayerDetails=function(e,t){var i=[];let r={1:i},n=a.executeQueryURLReset(),l=new Array;return a.prepareParamListWithParam("@PAT_TYPE",null!=e&&null!=e?e:-999,l),a.prepareParamListWithParam("@VISIT_NO",null!=t&&null!=t?t:" ",l),a.prepareParamListWithParam("@FACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,l),a.executeQueryInput("GET_PATIENT_PAYER_DTLS_BASED_ON_VISIT_IP",l,r,!0,!0,n,"popUp",{}).then(function(e){return i.map(function(e){return e})})},this.getEnBasedProcedureDetails=function(e){var t=[];let i={1:t},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pEnSeqId",null!=e&&null!=e?e:" ",n),a.executeQueryInput("FETCH_PROCEDURE_DETAILS",n,i,!0,!0,r,"popUp",{}).then(function(e){return t.map(function(e){return e})})},this.getEnBasedDiagnosisDetails=function(e){var t=[];let i={1:t},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pEnSeqId",null!=e&&null!=e?e:" ",n),a.executeQueryInput("GET_DIAGNOSIS_DETAILS_ESTIMATE",n,i,!0,!0,r,"popUp",{}).then(function(e){return t.map(function(e){return e})})},this.getVisitorIPBasedClinicalDetails=function(e,t){var i=[];let r={1:i},n=a.executeQueryURLReset(),l=new Array;return a.prepareParamListWithParam("@PAT_TYPE",null!=e&&null!=e?e:-999,l),a.prepareParamListWithParam("@VISIT_NO",null!=t&&null!=t?t:" ",l),a.prepareParamListWithParam("@FACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,l),a.executeQueryInput("GET_PATIENT_BED_ADT_DTLS_BASED_ON_VISIT_IP",l,r,!0,!0,n,"popUp",{}).then(function(e){return i.map(function(e){return e})})},this.getPreAuthBasedClinicalDetails=function(e){var t=[];let i={1:t},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pPreAuthHdSeqId",null!=e&&null!=e?e:" ",n),a.executeQueryInput("GET_PREAUTH_PATIENT_PAYER_ADT_DETAILS",n,i,!0,!0,r,"popUp",{}).then(function(e){return t.map(function(e){return e})})},this.getEnBasedServiceDetails=function(e,t,i,r){var n=[];let l={1:n},s=a.executeQueryURLReset(),o=new Array;return a.prepareParamListWithParam("@pIpAdmSeqId",e||-999,o),a.prepareParamListWithParam("@PAT_TYPE",t||" ",o),a.prepareParamListWithParam("@PLAN_SEQ_ID",i||-999,o),a.prepareParamListWithParam("@BED_CLASS",r||-999,o),a.prepareParamListWithParam("@FACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID.toString(),o),a.prepareParamListWithParam("@Practice_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,o),a.executeQueryInput("PREAUTH_VISIT_IP_BASED_SERVICES",o,l,!0,!0,s,"popUp",{}).then(function(e){return n.map(function(e){return e})})},this.getEstorPreAuthBasedProcedureDetails=function(e,t){var i=[];let r={1:i},n=a.executeQueryURLReset(),l=new Array;return a.prepareParamListWithParam("pEstimateHdSeqId",e||" ",l),a.prepareParamListWithParam("pIs_extimate_or_preauth",t||" ",l),a.executeQueryInput("GET_EST_PROC_DTLS",l,r,!0,!0,n,"popUp",{}).then(function(e){return i.map(function(e){return e})})},this.getPreAuthBasedDiagnosisDetails=function(e){var t=[];let i={1:t},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pPreAuthHdSeqId",e||" ",n),a.executeQueryInput("GET_PREAUTH_DIAGNOSIS_DTLS_BY_PREAUTHSEQID",n,i,!0,!0,r,"popUp",{}).then(function(e){return t.map(function(e){return e})})},this.getInclusiveStatus=function(e,t,i,r,n,l){var s=[];let o={1:s},c=a.executeQueryURLReset(),d=new Array;return a.prepareParamListWithParam("IS_MATERAIL",e||" ",d),a.prepareParamListWithParam("PLAN_SEQ_ID",t||-999,d),a.prepareParamListWithParam("PSG_CODE",i||-999,d),a.prepareParamListWithParam("DEPT_CODE",r||-999,d),a.prepareParamListWithParam("SERV_SEQ_ID",n||-999,d),a.prepareParamListWithParam("SPEL_CODE",l||-999,d),a.executeQueryInput("GET_SERVICE_INCLUSION_STATUS",d,o,!0,!0,c,"popUp",{}).then(function(e){return s.map(function(e){return e})})},this.getPayerBasedMrNo=function(e){var t=[];let i={1:t},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("@MR_NO",e||" ",n),a.prepareParamListWithParam("@FACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,n),a.executeQueryInput("GET_PREAUTH_DTLS_FOR_FETURE_OP_IP",n,i,!0,!0,r,"popUp",{}).then(function(e){return t.map(function(e){return e})})},this.getRateBasedonPlan=function(e,t,i,r){var n=[];let l={1:n},s=a.executeQueryURLReset(),o=new Array;return a.prepareParamListWithParam("@SERV_SEQ_ID",e||-999,o),a.prepareParamListWithParam("@TARIFF_SEQ_ID",t||-999,o),a.prepareParamListWithParam("@DATE_ON",moment(new Date).format("YYYY-MM-DD HH:mm:ss.000"),o),a.prepareParamListWithParam("@PRACTICE_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,o),a.prepareParamListWithParam("@FACILITY_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,o),a.prepareParamListWithParam("@PRIORITY",1,o),a.prepareParamListWithParam("@DOCT_SEQ_ID",-999,o),a.prepareParamListWithParam("@SPL_SEQ_ID",-999,o),a.prepareParamListWithParam("@BED_CLASS_CODE",i||-999,o),a.prepareParamListWithParam("@PLAN_SEQ_ID",r||-999,o),a.executeQueryInput("GET_SERVICE_RATE_WITH_OUT_VERSION_NEW_SP",o,l,!0,!0,s,"popUp",{}).then(function(e){return n.map(function(e){return e})})},this.bedClassSearch=function(e,t){let i=[],r={1:i=[]},n=a.executeQueryURLReset(),l=new Array;return a.prepareParamListWithParam("@PRACTICE_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,l),a.prepareParamListWithParam("@INC_SEQ_ID",e.incSeqId,l),a.prepareParamListWithParam("@PLAN_SEQ_ID",t.INC_PLAN_SEQ_ID,l),a.executeQueryInput("GET_PLAN_BED_CLASS_DETAILS",l,r,!0,!0,n,"popUp",{}).then(function(e){return i.map(function(e){return e})})},this.loadPreauthbasedonLimit=function(e){let t=[],i={1:t},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pleHdseqid",e,n),a.executeQueryInput("GET_PRE_AUTH_DETAILS_BASED_ON_LIMITENCH",n,i,!0,!0,r,"popUp",{}).then(function(e){return t})},this.loadLimitbasedonPreauth=function(e){let t=[],i={1:t},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("ppreAuthHdSeqid",e,n),a.executeQueryInput("GET_LIMITENCH_DETAILS_BASED_ON_PRE_AUTH",n,i,!0,!0,r,"popUp",{}).then(function(e){return t})},this.getPreAuthonPayerChangeServiceDetails=function(e,t,i,r){var n=[];let l={1:n},s=a.executeQueryURLReset(),o=new Array;return a.prepareParamListWithParam("@EN_SEQ_ID",e||-999,o),a.prepareParamListWithParam("@PREAUTH_BILL_HD_SEQ_ID",t||-999,o),a.prepareParamListWithParam("@Plan_Seq_Id",i||-999,o),a.prepareParamListWithParam("@BED_CLASS",r||-999,o),a.prepareParamListWithParam("@Facility_ID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID.toString(),o),a.prepareParamListWithParam("@Practice_ID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,o),a.executeQueryInput("BL_GET_PREAUTH_CALCULATE_SERVICE_RATES",o,l,!0,!0,s,"popUp",{}).then(function(e){return n.map(function(e){return e})})}}]),function(){"use strict";angular.module("napierContainerUi").service("ServiceGet",["uiGridConstants","hisAlertService","CommonForServiceData",function(e,t,a){this.serviceGridData=function(e,t,i){a.commonServiceOnLoad(e),e.preAuthDetailsGridOtions={enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!1,multiSelect:!1,enableSelectAll:!1,enableVerticalScrollbar:2,columnDefs:[{name:"status",displayName:" ",category:"Item",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,pinnedLeft:!0,visible:!1,headerCellFilter:"translate",width:"4",cellTemplate:'<div ng-if="rowRenderIndex!=0" class="ui-grid-cell-contents grid-actions"  ng-class="{\'routinePriority\':row.entity.status==1,\'asapPriority\':row.entity.status==2}"></div>'},{name:"priServGroup",displayName:"Primary Service Group",enableCellEdit:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><span ng-if="rowRenderIndex!=0">{{row.entity.priServGroup.DESCRIPTION}}</span><select ng-if="rowRenderIndex==0" class="form-control" ng-model="row.entity.priServGroup" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.priServGroupList" ng-change="grid.appScope.'+t+'.changePriServ(row.entity.priServGroup,row.entity);"><option value="" selected>Select Primary Service Group</option></select></div>'},{name:"department",displayName:"Department",headerCellFilter:"translate",enableCellEdit:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><span ng-if="rowRenderIndex!=0">{{row.entity.department.DESCRIPTION}}</span><select ng-if="rowRenderIndex==0" class="form-control" ng-model="row.entity.department" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.deptList" ng-change="grid.appScope.'+t+'.changeDept(row.entity.department,row.entity);"><option value="" selected>Select Department</option></select></div>'},{name:"specialty",displayName:"Speciality",headerCellFilter:"translate",enableCellEdit:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><span ng-if="rowRenderIndex!=0">{{row.entity.specialty.DESCRIPTION}}</span><select ng-if="rowRenderIndex==0" class="form-control" ng-model="row.entity.specialty" ng-click="row.entity.inActiveVal = true;" ng-options="item as item.DESCRIPTION for item in grid.appScope.'+t+'.speciltyList" ng-change="grid.appScope.'+t+'.changeSpecialty(row.entity.specialty,row.entity);"><option value="" selected>Select Specialty</option></select></div>'},{name:"service",displayName:"Service",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><span ng-if="rowRenderIndex!=0">{{row.entity.service.SERV_NAME}}</span><input type="text" ng-if="rowRenderIndex==0" class="form-control" ng-disabled="row.entity.isEditable" ng-model="row.entity.service" placeholder="service" uib-typeahead="item as item.SERV_NAME+\' - \'+item.SPL_DESC for item in grid.appScope.'+t+'.serviceSearch($viewValue,row.entity)" style="" typeahead-on-select="grid.appScope.'+t+'.onSelected($item,row.entity);" ng-click="grid.appScope.'+t+'.checkBed();" typeahead-append-to-body=true ></div>'},{name:"serviceAmt",displayName:"Service Amt",headerCellFilter:"translate",enableCellEdit:!1,width:90,visible:!1},{name:"valueAmt",displayName:"Amount/NL/Percentage",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><span ng-if="rowRenderIndex!=0">{{row.entity.valueAmt==\'.\'?0:row.entity.valueAmt}} {{row.entity.isAmtNlPercFlag==3?"NL":row.entity.isAmtNlPercFlag==2&&row.entity.valueAmt!=undefined&&row.entity.valueAmt!=""?"%":""}}</span><input ng-if="rowRenderIndex==0" type="text" ng-if="rowRenderIndex==0" ng-model="row.entity.valueAmt" class="form-control" style="width:47% !important;float:left;" ng-disabled="row.entity.isAmtNlPercFlag==3" validate-percentage decimal-upto="2" allow-negative="false" ng-blur="grid.appScope.'+t+'.amountOrPercBlur(row.entity)"><select ng-if="rowRenderIndex==0" class="form-control" style="width:47% !important;float:left;" ng-model="row.entity.isAmtNlPercFlag" ng-init="row.entity.isAmtNlPercFlag=\'1\'" ng-change="row.entity.isAmtNlPercFlag==3?(row.entity.valueAmt=\'\')(row.entity.qty=\'\'):undefined"><option value="1" selected>Amt</option><option value="2">%</option><option value="3">NL</option></select></div>'},{name:"qty",displayName:"Qty.",headerCellFilter:"translate",enableCellEdit:!1,width:60,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><span ng-if="rowRenderIndex!=0">{{row.entity.qty}}</span><input ng-if="rowRenderIndex==0" type="text"  class="form-control" maxlength="4" ng-change="(!grid.appScope.'+t+".generatePreAuthFlag)?grid.appScope."+t+'.changeAmount(row.entity,rowRenderIndex):\'\'" numbers-only ng-model="MODEL_COL_FIELD"></div>'},{name:"amount",displayName:"Amount",headerCellFilter:"translate",visible:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents action-row"><span ng-if="rowRenderIndex!=0">{{row.entity.valueAmt}}</span><input ng-if="rowRenderIndex==0" type="text" numbers-only ng-disabled="row.entity.service.serviceAmt" ng-model="row.entity.valueAmt" style="" class="form-control"></div>',enableCellEdit:!1},{name:"inclDetails",displayName:"Incl. details",width:90,visible:!i,cellTemplate:'<div class="ui-grid-cell-contents action-row" style="text-align: center;"><i ng-if="row.entity.inclStatus==2" class="fa fa-check"></i><i ng-if="row.entity.inclStatus==3" class="fa fa-times"></i><img ng-if="row.entity.inclStatus==1" src="assets/stamp.png"><p ng-if="row.entity.inclStatus==4">NA</p></div>'},{name:"approvedDetails",displayName:"App. Details",headerCellFilter:"translate",enableCellEdit:!1,visible:!!i,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><select class="form-control" style="width:47%;float:left;" ng-if="row.entity.CONSUMABLE_AMOUNT==undefined&&row.entity.CONSUMABLE_QTY==undefined" ng-model="row.entity.approvedDetails" ng-change="grid.appScope.amountChange(row)" ng-disabled="rowRenderIndex==0&&(row.entity.valueAmt==undefined||row.entity.valueAmt==\'\')&&(row.entity.qty==undefined||row.entity.qty==\'\')&&row.entity.isAmtNlPercFlag!=3"><option value="AP" selected>AP</option><option value="PA">PA</option><option value="NA">NA</option></select><span ng-if="row.entity.CONSUMABLE_AMOUNT!=undefined||row.entity.CONSUMABLE_QTY!=undefined">{{row.entity.approvedDetails}}</span></div>'},{name:"remarks",displayName:"Remarks",headerCellFilter:"translate",enableCellEdit:!1,visible:!!i,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><input type="text" class="form-control" ng-model="row.entity.remarks" ng-if="row.entity.CONSUMABLE_AMOUNT==undefined&&row.entity.CONSUMABLE_QTY==undefined" my-maxlength="300"><span ng-if="row.entity.CONSUMABLE_AMOUNT!=undefined||row.entity.CONSUMABLE_QTY!=undefined" >{{row.entity.remarks}}</span></div>'},{name:"approvedAmount",displayName:"App. Amount",headerCellFilter:"translate",enableCellEdit:!1,visible:!!i,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><div ng-if="row.entity.CONSUMABLE_AMOUNT==undefined&&row.entity.CONSUMABLE_QTY==undefined"><span ng-if="row.entity.approvedDetails!=\'PA\'">{{row.entity.approvedAmount}}</span><input type="text" ng-model="row.entity.approvedAmount" ng-if="row.entity.approvedDetails==\'PA\'&&row.entity.valueAmt!=undefined&&row.entity.valueAmt!=\'\'" validate-percentage decimal-upto="2" allow-negative="false" ng-blur="grid.appScope.getPreAuthValue(row)"></div><span ng-if="row.entity.CONSUMABLE_AMOUNT!=undefined||row.entity.CONSUMABLE_QTY!=undefined">{{row.entity.approvedAmount}}</span></div>'},{name:"approvedQty",displayName:"App. Qty.",headerCellFilter:"translate",enableCellEdit:!1,visible:!!i,cellTemplate:'<div class="ui-grid-cell-contents action-row service-details-grid-contents"><div ng-if="row.entity.CONSUMABLE_AMOUNT==undefined&&row.entity.CONSUMABLE_QTY==undefined"><span ng-if="row.entity.approvedDetails!=\'PA\'">{{row.entity.approvedQty}}</span><input type="text" ng-model="row.entity.approvedQty" ng-if="row.entity.approvedDetails==\'PA\'&&((row.entity.qty!=undefined&&row.entity.qty!=\'\')||row.entity.isAmtNlPercFlag==3)" numbers-only ng-blur="grid.appScope.getPreAuthValue(row)"></div><span ng-if="row.entity.CONSUMABLE_AMOUNT!=undefined||row.entity.CONSUMABLE_QTY!=undefined">{{row.entity.approvedQty}}</span></div>'},{name:"Action",displayName:"Action",headerCellFilter:"translate",enableCellEdit:!1,visible:!0,width:70,cellTemplate:'<div class="ui-grid-cell-contents action-row"><div class="service-details-grid-actions" ng-if="!row.entity.preAuthApp"><div ng-if="row.entity.CONSUMABLE_AMOUNT==undefined&&row.entity.CONSUMABLE_QTY==undefined"><i class="fa fa-plus-square" style="" ng-click="grid.appScope.'+t+'.addRowGrid(row)" ng-show="rowRenderIndex==0"></i><i class="fa fa-pencil" ng-show="rowRenderIndex!=0" ng-click="grid.appScope.'+t+'.editGridData(row,rowRenderIndex)"></i><i class="fa fa-trash" ng-show="rowRenderIndex!=0" ng-click="grid.appScope.'+t+'.deleteRecord(row,rowRenderIndex)" ng-if="!row.entity.deleteDisble"></i><i class="fa fa-eraser" ng-show="rowRenderIndex==0" ng-click="grid.appScope.'+t+'.clearRecordFirst(row)"></i></div></div></div>'}]},e.preAuthDetailsGridOtions.data=[],e.preAuthDetailsGridOtions.data[0]=[]},this.estSearchGridOptions={enableHorizontalScrollbar:0,columnDefs:[{name:"radio_row",displayName:"",headerCellFilter:"translate",width:20,visible:!0,headerCellTemplate:"<div><div>",cellTemplate:'<div class="ngSelectionCell selector-group"><label class="radio-inline"><input ng-init="releaseAction=0" type="radio" name="rdUserList" ng-value="true"  ng-model="releaseAction" ng-click="grid.appScope.etb.advSearchRowClick(row)"></label></div>'},{name:"approxBillNo",displayName:"Estimation No.",visible:!0,headerCellFilter:"translate"},{name:"estimateBillDate",displayName:"Estimate Date",visible:!0,headerCellFilter:"translate"},{name:"mrNo",displayName:"UHID",visible:!0,headerCellFilter:"translate"},{name:"patientName",displayName:"Patient Name",visible:!0,headerCellFilter:"translate"},{name:"preAuthGenerated.",displayName:"Authorization No.",visible:!0,headerCellFilter:"translate"},{name:"mobileNo",displayName:"Mobile No.",visible:!0,headerCellFilter:"translate"}]},this.gridOptions={enableHorizontalScrollbar:0,columnDefs:[{field:"STANDARD",displayName:"Standard / ICD"},{field:"HOSDEFNIED",displayName:"Hospital Defined"},{field:"actions",displayName:"Actions",cellTemplate:'<div class="ui-grid-cell-contents action-row"><i class="fa fa-trash" ng-click="grid.appScope.etb.deleteDiagProcRecord(row,rowRenderIndex,row.entity)"></i></div>'}]},this.serviceGridDataForView=function(e,t,i){a.commonServiceOnLoad(e),e.preAuthDetailsGridOtions={enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!1,multiSelect:!1,enableSelectAll:!1,columnDefs:[{name:"status",displayName:" ",category:"Item",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,pinnedLeft:!0,headerCellFilter:"translate",width:"10",cellTemplate:"<div class=\"grid-actions ui-grid-cell-contents\"  ng-class=\"{'routinePriority':row.entity.status==1,'asapPriority':row.entity.status==2}\"></div>"},{name:"priServGroup",displayName:"Primary Service Group",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents service-details-grid-contents"><span >{{row.entity.priServGroup.DESCRIPTION}}</span> </div>'},{name:"department",displayName:"Department",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents service-details-grid-contents"><span >{{row.entity.department.DESCRIPTION}}</span></div>'},{name:"specialty",displayName:"Specialty",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents service-details-grid-contents"><span >{{row.entity.specialty.DESCRIPTION}}</span></div>'},{name:"service",displayName:"Service",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents service-details-grid-contents"><span >{{row.entity.service.SERV_NAME}}</span></div>'},{name:"serviceAmt",displayName:"Service Amount",headerCellFilter:"translate",enableCellEdit:!1},{name:"qty",displayName:"Quantity",headerCellFilter:"translate",enableCellEdit:!1},{name:"valueAmt",displayName:"Amount",headerCellFilter:"translate",enableCellEdit:!1}]},e.preAuthDetailsGridOtions.data=[]},this.preAuthViewRecords=function(e,t,a){e.preAuthViewDetailsGridOtions={enableHorizontalScrollbar:0,enableRowHeaderSelection:!1,enableRowSelection:!1,multiSelect:!1,enableSelectAll:!1,enableVerticalScrollbar:2,columnDefs:[{name:"priServGroup",displayName:"Primary Service Group",enableCellEdit:!1,cellTemplate:'<div class="service-details-grid-contents"><span>{{row.entity.priServGroup.DESCRIPTION}}</span></div>'},{name:"department",displayName:"Department",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="service-details-grid-contents"><span>{{row.entity.department.DESCRIPTION}}</span></div>'},{name:"specialty",displayName:"Specialty",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="service-details-grid-contents"><span>{{row.entity.specialty.DESCRIPTION}}</span></div>'},{name:"service",displayName:"Service",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="service-details-grid-contents"><span>{{row.entity.service.SERV_NAME}}</span></div>'},{name:"valueAmt",displayName:"Amount/NL/Percentage",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="service-details-grid-contents"><span>{{row.entity.valueAmt==\'.\'?0:row.entity.valueAmt}} {{row.entity.isAmtNlPercFlag==3?"NL":row.entity.isAmtNlPercFlag==2&&row.entity.valueAmt!=undefined&&row.entity.valueAmt!=""?"%":""}}</span></div>'},{name:"qty",displayName:"Qty.",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="service-details-grid-contents"><span>{{row.entity.qty}}</span></div>'},{name:"approvedDetails",displayName:"App. Details",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="service-details-grid-contents"><span>{{row.entity.approvedDetails}}</span></div>'},{name:"remarks",displayName:"Remarks",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="service-details-grid-contents"><span>{{row.entity.remarks}}</span></div>'},{name:"approvedAmount",displayName:"App. Amount",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="service-details-grid-contents"><span>{{row.entity.approvedAmount}}</span></div>'},{name:"approvedQty",displayName:"App. Qty.",headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="service-details-grid-contents"><span>{{row.entity.approvedQty}}</span></div>'}]},e.preAuthViewDetailsGridOtions.data=[]},this.serviceDuplicatesCheck=function(e,a,i,r,n,l){for(var s=[],o=[],c=[],d=0;d<e.length;d++){var p=!0;if(a.data.length>0){for(var u=0;u<a.data.length;u++)if(a.data[u].serviceSeqId==e[d].serviceSeqId&&(p=!1,c.push(e[d])),u==a.data.length-1&&p){angular.isUndefined(e[d].serviceTax)&&(e[d].serviceTax=0),angular.isUndefined(e[d].Qty)&&(e[d].Qty=1),angular.isUndefined(e[d].serviceDiscountAmt)&&(e[d].serviceDiscountAmt=0);var m=(e[d].serviceRate-e[d].serviceDiscountAmt)*(e[d].serviceTax/100),g=e[d].serviceRate*e[d].Qty-e[d].serviceDiscountAmt*e[d].Qty+m*e[d].Qty,S=e[d].serviceDiscountAmt*e[d].Qty;isNaN(g)?s.push(e[d].serviceName):o.push({serviceCode:e[d].serviceCode,serviceSeqId:e[d].serviceSeqId,serviceName:e[d].serviceName,serviceRate:Math.floor(1e4*e[d].serviceRate)/1e4,serviceQty:e[d].Qty,serviceTax:Math.floor(1e4*m)/1e4,serviceDiscountAmt:Math.floor(1e4*S)/1e4,chargeableAmt:Math.floor(1e4*g)/1e4,expcServDate:"9999-03-05 00:00:00.000",gnTranStatus:1})}if(d==e.length-1)for(var v=0;v<o.length;v++)a.data.push(o[v]),l.grossAmount=l.grossAmount+o[v].serviceRate*o[v].serviceQty,l.discounts=l.discounts+o[v].serviceDiscountAmt,l.estimateCost=Math.floor(1e4*l.estimateCost)/1e4+Math.floor(1e4*o[v].chargeableAmt)/1e4}else{angular.isUndefined(e[d].serviceTax)&&(e[d].serviceTax=0),angular.isUndefined(e[d].Qty)&&(e[d].Qty=1),angular.isUndefined(e[d].serviceDiscountAmt)&&(e[d].serviceDiscountAmt=0);var D=(e[d].serviceRate-e[d].serviceDiscountAmt)*(e[d].serviceTax/100),y=e[d].serviceRate*e[d].Qty-e[d].serviceDiscountAmt*e[d].Qty+D*e[d].Qty;S=e[d].serviceDiscountAmt*e[d].Qty;isNaN(y)?s.push(e[d].serviceName):(a.data.push({serviceCode:e[d].serviceCode,serviceSeqId:e[d].serviceSeqId,serviceName:e[d].serviceName,serviceRate:Math.floor(1e4*e[d].serviceRate)/1e4,serviceQty:e[d].Qty,serviceTax:Math.floor(1e4*D)/1e4,serviceDiscountAmt:Math.floor(1e4*S)/1e4,chargeableAmt:Math.floor(1e4*y)/1e4,expcServDate:"9999-03-05 00:00:00.000",gnTranStatus:1}),l.grossAmount=l.grossAmount+e[d].serviceRate*e[d].Qty,l.discounts=l.discounts+S,l.estimateCost=Math.floor(1e4*l.estimateCost)/1e4+Math.floor(1e4*y)/1e4)}if(d==e.length-1){if(c.length>0&&null!=c)for(var f=" ",C=0;C<c.length;C++)if(f=f+c[C].serviceCode+" - "+c[C].serviceName+"<br>",C==c.length-1){var I=f+"Selected Service Already Exists, Kindly Increase The Quantity";t.hisAlertMulti("information","Information",I,{buttonText:"OK"},{buttonCallBack1:function(){}})}if(s.length>0&&null!=s){f=" ";for(var A=0;A<s.length;A++)if(f=f+s[A]+"<br>",A==s.length-1){let e={buttonText:"OK"},a={buttonCallBack1:function(){}},i=f+" Rate Card Is Not Define";t.hisAlertMulti("information","Information",i,e,a)}}}}},this.editServiceCommon=function(a,i,r,n,l,s,o,c){if(c.editStart&&c.rowServiceIndex==i)if(0==a.entity.serviceQty||null==a.entity.serviceQty||null==a.entity.serviceQty){let e={buttonText:"OK"},a={buttonCallBack1:function(){}},i="Quantity Can't Be Zero Or Null";t.hisAlertMulti("information","Information",i,e,a)}else{var d=_.findIndex(l.data,function(e){return e.serviceSeqId==a.entity.serviceSeqId}),p=a.entity.serviceRate*a.entity.serviceQty-a.entity.serviceDiscountAmt/c.quantityValue*a.entity.serviceQty+a.entity.serviceTax*a.entity.serviceQty,u=a.entity.serviceDiscountAmt/c.quantityValue*a.entity.serviceQty;l.data.splice(d,1),l.data.splice(d,0,{serviceCode:a.entity.serviceCode,serviceSeqId:a.entity.serviceSeqId,serviceName:a.entity.serviceName,serviceRate:a.entity.serviceRate,serviceQty:a.entity.serviceQty,serviceTax:a.entity.serviceTax,serviceDiscountAmt:u,chargeableAmt:p,expcServDate:"9999-03-05 00:00:00.000",gnTranStatus:1}),c.grossAmount=c.grossAmount-c.grossCal+a.entity.serviceRate*parseInt(a.entity.serviceQty),c.discounts=c.discounts-c.discountsCharge+u,c.estimateCost=c.estimateCost-c.servciceCharge+p,c.editStart=!1,c.deleteRecord=!1,c.deleteTrue=!1,c.serviceGrid.selection.clearSelectedRows()}else{r.renderContainers.body.visibleRowCache.indexOf(a);var m=_.findIndex(l.data,function(e){return e.serviceSeqId==a.entity.serviceSeqId});null!=c.previousSelectedItem&&null!=c.previousSelectedItem&&(c.previousSelectedItem.editable=void 0,c.previousSelectedItem.chargeableAmt==c.servciceCharge&&c.previousSelectedItem.serviceQty!=c.quantityValue&&(c.previousSelectedItem.serviceQty=c.quantityValue)),c.previousSelectedItem=l.data[m],c.serviceDetailsGridOtions.data[m].editable?c.serviceDetailsGridOtions.data[m].editable=!1:c.serviceDetailsGridOtions.data[m].editable=!0,c.serviceGrid.core.notifyDataChange(e.dataChange.EDIT),c.grossCal=a.entity.serviceRate*parseInt(a.entity.serviceQty),c.servciceCharge=a.entity.chargeableAmt,c.netAmountCharge=a.entity.serviceRate,c.discountsCharge=a.entity.serviceDiscountAmt,c.quantityValue=a.entity.serviceQty,c.update=!0,c.editStart=!0,c.rowServiceIndex=i,c.deleteRecord=!0,c.deleteTrue=!0}},this.deleteService=function(e,t,a,i){e.estimateCost=i-parseInt(a.chargeableAmt),e.discounts=e.discounts-a.serviceDiscountAmt,null!=e.discounts&&null!=e.discounts||(e.discounts=0),e.grossAmount=e.grossAmount-parseInt(a.serviceRate*parseInt(a.serviceQty));var r=_.findIndex(t.data,function(e){return e.serviceSeqId==a.serviceSeqId});t.data.splice(r,1),e.maxSize=5,e.bigTotalItems=10*Math.ceil(t.data.length/t.paginationPageSize)},this.serviceGetData=function(e,t,a,i,r,n){var l=[];e instanceof Array?l=e:l.push(e);for(var s=0;s<l.length;s++)n.estimateCost=n.estimateCost+l[s].chargeableAmt,n.discounts=n.discounts+l[s].serviceDiscountAmt,n.grossAmount=n.grossAmount+l[s].serviceRate*l[s].serviceQty,angular.isUndefined(l[s].approvedAmount)||(n.preAuthValue=n.preAuthValue+l[s].approvedAmount),t.data.push(l[s])},this.otherGetData=function(e,t,a,i,r,n){var l=[];e instanceof Array?l=e:l.push(e);for(var s=0;s<l.length;s++)null!=l[s].durgTotalPrice?(n.estimateCost=n.estimateCost+l[s].durgTotalPrice,n.grossAmount=n.grossAmount+l[s].durgTotalPrice,t.data.push(l[s])):null!=l[s].limitAmt?(n.estimateCost=n.estimateCost+l[s].limitAmt,n.grossAmount=n.grossAmount+l[s].limitAmt,t.data.push(l[s])):null!=l[s].totalPrice&&(n.estimateCost=n.estimateCost+parseInt(l[s].totalPrice),n.grossAmount=n.grossAmount+parseInt(l[s].totalPrice),t.data.push(l[s]))}}])}(),function(){"use strict";angular.module("napierContainerUi").service("CommonForDrugPackage",function(){this.addDataFormService=function(e,t,a){var i=[];e instanceof Array?i=e:i.push(e);for(var r=0;r<i.length;r++)i[r].remainderDate=i[r].remainderDate.$,t.data.push(i[r])},this.getData=function(e,t,a,i,r,n){var l=[];e instanceof Array?l=e:l.push(e);for(var s=0;s<l.length;s++)null!=l[s].durgTotalPrice?(n.estimateCost=n.estimateCost+l[s].durgTotalPrice,n.grossAmount=n.grossAmount+l[s].durgTotalPrice,angular.isUndefined(l[s].approvedAmount)||(n.preAuthValue=n.preAuthValue+l[s].approvedAmount),t.data.push(l[s])):null!=l[s].limitAmt?(n.estimateCost=n.estimateCost+l[s].limitAmt,n.grossAmount=n.grossAmount+l[s].limitAmt,angular.isUndefined(l[s].approvedAmount)||(n.preAuthValue=n.preAuthValue+l[s].approvedAmount),t.data.push(l[s])):null!=l[s].totalPrice&&(n.estimateCost=n.estimateCost+l[s].totalPrice,n.grossAmount=n.grossAmount+l[s].totalPrice,angular.isUndefined(l[s].approvedAmount)||(n.preAuthValue=n.preAuthValue+l[s].approvedAmount),t.data.push(l[s]))}})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y){i.loadModule("billing");var f=r.getLanguageToSet();i.changeLanguage(f);var C,I=this;I.filesUploaded=[],I.uploadedfileNames=[],I.uploadingFile=!1,I.alertData={},y.loadAlerts(f).then(function(t){I.alertData=t,e.alertData={buttonText:I.alertData.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}}),I.CD=angular.copy(g),e.reminderDetails=JSON.parse(sessionStorage.userContextObj).LOGIN_NAME,e.estimateCost=0,e.grossAmount=0,e.discounts=0,I.reminderStatus="Approved",I.listSelectData=JSON.parse(s.id),I.patientDetails={approxBillHdSeqId:I.listSelectData[0][0].approxBillHdSeqId,regSeqId:null==I.listSelectData[0][0].regSeqId?I.listSelectData[1].regSeqId:I.listSelectData[0][0].regSeqId,admissionSeqid:null==I.listSelectData[0][0].ipAdmSeqId?I.listSelectData[1].ipAdmSeqId:I.listSelectData[0][0].ipAdmSeqId},I.remOptions={format:I.CD.dateOnly.format,minDate:new Date(I.listSelectData[0][0].approxBillDate.$)},I.reminderDate=new Date,I.patientDetailsSearch=null==I.listSelectData[1]?I.listSelectData[0][0]:I.listSelectData[1],null!=I.listSelectData[1]&&null!=I.listSelectData[1]&&null!=I.listSelectData[1].ListBedDtls&&null!=I.listSelectData[1].ListBedDtls[0]&&""!=I.listSelectData[1].ListBedDtls[0]?e.bedClassName=I.listSelectData[1].ListBedDtls[0]["com.napier.core.billgeneration.vo.BedDetailsVo"][0]:e.bedClassName=null;var A="1",E=I.patientDetails;A=null!=E.admissionSeqid?"1":"2",D.getPatientBanner(E,A).then(function(t){e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=12}),c.patientBannerDetail(I.patientDetails.regSeqId).then(function(t){e.patientBannerDetails=t,e.patBanShow=!0,e.patientRecordsDetail=e.patientBannerDetails.patientRecordsDetail,e.patientValue=e.patientBannerDetails.patientValue}),I.packageDetail=function(t){if(e.hidePackageCode=!1,t.length>0){var a=null==e.bedClassName?1:e.bedClassName.gQDataCode;m.searchPackageDetails(t,a).then(function(t){I.packageDetailsSearchValue=t.data.HITService.message.approxBillServiceDtlsVoList[0]["com.napier.core.billgeneration.vo.ApproxBillServiceDtlsVo"].approxBillPackageDtlsVoList[0]["com.napier.core.billgeneration.vo.ApproxBillPackageDtlsVo"],I.packageDetailsSearchValue instanceof Array?(e.packageSrchClick=I.packageDetailsSearchValue,I.packageDetailsSearchValue=I.packageDetailsSearchValue):(e.packageSrchClick=I.packageDetailsSearchValue,I.packageDetailsSearchValue=[I.packageDetailsSearchValue])})}},I.addPackageDetail=function(t){null==t.primaryServiceTypeCode?I.packageDetailsSearch=e.packageSrchClick:I.packageDetailsSearch=t},I.CPTCodeSrch=function(t){t.length>=1&&(e.hideCPTCode=!1,m.searchCPTCodeDetails(t).then(function(e){I.cptSearch=e.data.HITService.message.approxBillServiceDtlsVoList[0]["com.napier.core.billgeneration.vo.ApproxBillServiceDtlsVo"].approxBillPackageDtlsVoList[0]["com.napier.core.billgeneration.vo.ApproxBillPackageDtlsVo"].cptList[0]["com.napier.core.billgeneration.vo.CptCodeDtls"],I.cptSearch instanceof Array?I.cptSearch=I.cptSearch:I.cptSearch=[I.cptSearch]}))},e.searchDetails=function(t){var a;"Service"==t?a="service.details.screen.html":"Patient"==t&&(a="searchPatient.screen.html"),o.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",controller:"searchCtrl as srvCtrl",templateUrl:"app/consumer/his17_1/billing/screens/estimateBill/"+a,backdrop:"static",keyboard:!1,size:"lg",resolve:{bedClassId:function(){return null==e.bedClassName?1:e.bedClassName.strBedId},regSeqId:function(){return I.patientDetails.regSeqId}}}).result.then(function(t){p.serviceDuplicatesCheck(t,e.serviceDetailsGridOtions,e.estimateCost,e.discounts,e.grossAmount,e),e.maxSize=5,e.bigTotalItems=10*Math.ceil(e.serviceDetailsGridOtions.data.length/e.serviceDetailsGridOtions.paginationPageSize)})};var h;e.serviceDetailsGridOtions=t.serviceDetailsGridOtions,"Action"==e.serviceDetailsGridOtions.columnDefs[13].name&&(e.serviceDetailsGridOtions.columnDefs[13].visible=!1),e.getTemplate=function(e,t,a,i,r){return 0==t?"fa fa-pencil":1==e.editable&&1==t?"fa fa-check":"fa fa-pencil"},e.serviceDetailsGridOtions.onRegisterApi=function(t){e.serviceGrid=t},e.servciceCharge,e.editStart=!1,e.editService=function(t,a,i,r){p.editServiceCommon(t,a,i,r,e.serviceDetailsGridOtions,e.editStart,e.serviceGrid,e)},e.durgCnsmblesGridOtions=t.durgCnsmblesGridOtions,"Action"==e.durgCnsmblesGridOtions.columnDefs[8].name&&(e.durgCnsmblesGridOtions.columnDefs[8].visible=!1),e.toggleText="+ Add",e.toggleTextPackage="+ Add",I.changeDurg=function(e){null!=e&&null!=e.durgName&&null!=e.durgsPrice&&null!=e.durgsQty?I.durgDisable=!1:I.durgDisable=!0},I.packageDisable=!1,I.changePackage=function(e){I.packageDisable=null==e||null==e},e.durgPriceValue,I.addDurgsDetails=function(){if(null!=I.durgsDetails&&0==I.durgsDetails.durgsQty){var t="Quantity Can't Be Zero";v.hisAlertMulti("information","Information",t,e.alertData,e.alertFunction),e.toggleText="+ Add"}else if(null==I.durgsDetails||null==I.durgsDetails.durgName||null==I.durgsDetails.durgsPrice||null==I.durgsDetails.durgsQty){t="Please Fill Drugs And Consumables Details";v.hisAlertMulti("information","Information",t,e.alertData,e.alertFunction)}else I.durgsDetails.durgTotalPrice=I.durgsDetails.durgsPrice*I.durgsDetails.durgsQty,"UPDATE"==e.toggleText?(e.estimateCost=e.estimateCost-e.durgPriceValue+parseInt(I.durgsDetails.durgTotalPrice),e.grossAmount=e.grossAmount-e.durgPriceValue+parseInt(I.durgsDetails.durgTotalPrice),e.durgCnsmblesGridOtions.data.splice(h,1),e.durgCnsmblesGridOtions.data.splice(h,0,{materialName:I.durgsDetails.durgName,price:I.durgsDetails.durgsPrice,quantaty:I.durgsDetails.durgsQty,totalPrice:I.durgsDetails.durgTotalPrice,expcMtrlDate:"9999-12-27T00:00:00.000000+0530",gnTranStatus:4}),e.toggleText="+ Add"):(e.duplicateDurgs=function(){if(!(e.durgCnsmblesGridOtions.data.length>0))return!0;for(var t=0;t<e.durgCnsmblesGridOtions.data.length;t++){if(e.durgCnsmblesGridOtions.data[t].materialName==I.durgsDetails.durgName){return v.hisAlertMulti("information","Information","Durgs Details Already Existing",e.alertData,e.alertFunction),!1}if(t==e.durgCnsmblesGridOtions.data.length-1)return!0}},e.duplicateDurgs()&&(e.estimateCost=e.estimateCost+I.durgsDetails.durgTotalPrice,e.grossAmount=e.grossAmount+I.durgsDetails.durgTotalPrice,e.durgCnsmblesGridOtions.data.push({materialName:I.durgsDetails.durgName,price:I.durgsDetails.durgsPrice,quantaty:I.durgsDetails.durgsQty,totalPrice:I.durgsDetails.durgTotalPrice,expcMtrlDate:"9999-12-27T00:00:00.000000+0530",gnTranStatus:4}),e.bigTotalItemsDrug=10*Math.ceil(e.durgCnsmblesGridOtions.data.length/e.durgCnsmblesGridOtions.paginationPageSize)));I.durgsDetails.durgName=I.durgsDetails.durgsPrice=I.durgsDetails.durgsQty=null},e.serviceRow,e.serviceIndex,e.deleteAddRecord=function(t,a){e.serviceRow=t,e.serviceIndex=_.findIndex(e.durgCnsmblesGridOtions.data,function(e){return e.materialName==t.entity.materialName})},e.deletePackage=function(t,a){e.serviceRow=t,e.serviceIndex=_.findIndex(e.packageDetlOtions.data,function(e){return e.strPackCode==t.entity.strPackCode})},e.deleteRow=function(){null!=e.serviceRow.entity.chargeableAmt?p.deleteService(e,e.serviceDetailsGridOtions,e.serviceRow.entity,e.estimateCost):null!=e.serviceRow.entity.limitAmt?(e.estimateCost=e.estimateCost-parseInt(e.serviceRow.entity.limitAmt),e.grossAmount=e.grossAmount-parseInt(e.serviceRow.entity.limitAmt),e.packageDetlOtions.data.splice(e.serviceIndex,1),e.bigTotalItemsPak=10*Math.ceil(e.packageDetlOtions.data.length/e.packageDetlOtions.paginationPageSize)):null!=e.serviceRow.entity.totalPrice&&(e.estimateCost=e.estimateCost-parseInt(e.serviceRow.entity.totalPrice),e.grossAmount=e.grossAmount-parseInt(e.serviceRow.entity.totalPrice),e.durgCnsmblesGridOtions.data.splice(e.serviceIndex,1),e.bigTotalItemsDrug=10*Math.ceil(e.durgCnsmblesGridOtions.data.length/e.durgCnsmblesGridOtions.paginationPageSize))},e.deleteService=function(t,a){e.serviceRow=t,e.serviceIndex=_.findIndex(e.serviceDetailsGridOtions.data,function(e){return e.serviceSeqId==t.entity.serviceSeqId})},e.editRecord=function(t,a){I.durgsDetails={},e.durgPriceValue=t.entity.totalPrice,I.durgsDetails.durgName=t.entity.materialName,I.durgsDetails.durgsPrice=t.entity.price,I.durgsDetails.durgsQty=t.entity.quantaty,h=_.findIndex(e.durgCnsmblesGridOtions.data,function(e){return e.materialName==t.entity.materialName}),e.toggleText="UPDATE"},e.packagePrice,e.editPackage=function(t,a){I.packageDetailsSearch={},e.packagePrice=t.entity.limitAmt,I.packageDetailsId=t.entity.strPackCode,I.packageDetailsSearch.strPackCode=t.entity.strPackCode,I.packageDetailsSearch.primaryServiceTypeCode=t.entity.primaryServiceTypeCode,I.packageDetailsSearch.strPackageName=t.entity.primaryServiceTypeAliasName,I.packageDetailsSearch.limitAmt=t.entity.limitAmt,I.cptcode=t.entity.cptCode,I.packageDetailsSearch.remarks=t.entity.remarks,e.toggleTextPackage="UPDATE",C=_.findIndex(e.durgCnsmblesGridOtions.data,function(e){return e.strPackCode==t.entity.strPackCode}),e.deleteRecord=!0},e.packageDetlOtions=t.packageDetlOtions,"Action"==e.packageDetlOtions.columnDefs[11].name&&(e.packageDetlOtions.columnDefs[11].visible=!1),e.packageDetlOtions.data=[],I.packageDetailsAdd=function(){if(null==I.packageDetailsSearch||null==I.packageDetailsSearch.strPackCode||null==I.packageDetailsSearch.strPackageName||null==I.packageDetailsSearch.strPackageName){v.hisAlertMulti("information","Information","Please Search Package And Select Package",e.alertData,e.alertFunction)}else I.packageDisable=!1,null!=e.packagePrice&&(e.estimateCost=e.estimateCost-e.packagePrice+parseInt(I.packageDetailsSearch.limitAmt),e.grossAmount=e.grossAmount-e.packagePrice+parseInt(I.packageDetailsSearch.limitAmt)),"UPDATE"==e.toggleTextPackage?(e.packageDetlOtions.data.splice(C,1),e.packageDetlOtions.data.splice(C,0,{strPackCode:null==I.packageDetailsSearch.strPackCode?"":I.packageDetailsSearch.strPackCode,primaryServiceTypeCode:null==I.packageDetailsSearch.primaryServiceTypeCode?"":I.packageDetailsSearch.primaryServiceTypeCode,primaryServiceTypeAliasName:null==I.packageDetailsSearch.strPackageName?"":I.packageDetailsSearch.strPackageName,cptCode:null==I.cptcode?"":null==I.cptcode.cptcode?I.cptcode:I.cptcode.cptcode,limitAmt:null==I.packageDetailsSearch.limitAmt?0:I.packageDetailsSearch.limitAmt,remarks:null==I.packageDetailsSearch.remarks?"":I.packageDetailsSearch.remarks,gnTranStatus:4}),e.toggleTextPackage="+ Add",e.deleteRecord=!1):(e.duplicate=function(){if(!(e.packageDetlOtions.data.length>0))return!0;for(var t=0;t<e.packageDetlOtions.data.length;t++){if(null!=e.packageDetlOtions.data[t].primaryServiceTypeAliasName&&null!=e.packageDetlOtions.data[t].primaryServiceTypeAliasName&&e.packageDetlOtions.data[t].primaryServiceTypeAliasName==I.packageDetailsSearch.strPackageName){return v.hisAlertMulti("information","Information","Package Detail Already Added",e.alertData,e.alertFunction),!1}if(t==e.packageDetlOtions.data.length-1)return!0}},e.duplicate()&&(e.estimateCost=e.estimateCost+parseInt(I.packageDetailsSearch.limitAmt),e.grossAmount=e.grossAmount+parseInt(I.packageDetailsSearch.limitAmt),e.packageDetlOtions.data.push({strPackCode:null==I.packageDetailsSearch.strPackCode?"":I.packageDetailsSearch.strPackCode,primaryServiceTypeCode:null==I.packageDetailsSearch.primaryServiceTypeCode?"":I.packageDetailsSearch.primaryServiceTypeCode,primaryServiceTypeAliasName:null==I.packageDetailsSearch.strPackageName?"":I.packageDetailsSearch.strPackageName,cptCode:null==I.cptcode?"":I.cptcode.cptcode,limitAmt:null==I.packageDetailsSearch.limitAmt?0:I.packageDetailsSearch.limitAmt,remarks:I.packageDetailsSearch.remarks,gnTranStatus:4}),e.bigTotalItemsPak=10*Math.ceil(e.packageDetlOtions.data.length/e.packageDetlOtions.paginationPageSize))),I.packageDetailsSearch.strPackCode=I.packageDetailsSearch.strPackageName=I.cptcode=I.packageDetailsSearch.limitAmt=I.packageDetailsSearch.remarks=I.packageDetailsId=I.cptSearch=null},e.gridOptionsReminder={enableCellEdit:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,paginationCurrentPage:1,paginationPageSize:10,enableCellEditOnFocus:!0,enableRowSelection:!1,enableSelectAll:!0,enableFiltering:!1,columnDefs:[{field:"remainderseqId",visible:!1},{field:"remainder",displayName:"billing.reminder",headerCellFilter:"translate",width:"20%"},{field:"remainderDate",displayName:"billing.date",headerCellFilter:"translate",width:"20%",cellTemplate:'<div class="ui-grid-cell-contents"><span>{{row.entity.remainderDate.split("T")[0]}}</span></div>'},{field:"remainderStatus",displayName:"billing.status",headerCellFilter:"translate",width:"20%"},{field:"userDetails",displayName:"billing.userdetails",headerCellFilter:"translate",width:"20%"},{field:"remarks",displayName:"billing.remarks",headerCellFilter:"translate",width:"20%"}]},e.gridOptionsEnhance={enableCellEdit:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:0,paginationCurrentPage:1,paginationPageSize:10,enableCellEditOnFocus:!0,enableRowSelection:!1,enableSelectAll:!0,enableFiltering:!1,onRegisterApi:function(t){e.grid=t},columnDefs:[{field:"BillHdSeqId",visible:!1},{field:"enBillNmbr",displayName:"billing.enhanceNum",headerCellFilter:"translate",width:"25%"},{field:"enAmnt",displayName:"billing.enhanceAmount",headerCellFilter:"translate",width:"25%"},{field:"remarks",displayName:"billing.remarks",headerCellFilter:"translate",width:"25%"},{field:"viewFile",displayName:"billing.viewFile",headerCellFilter:"translate",width:"25%"}]},e.gridOptionsEnhance.data=[],e.$on("myFile",function(t,a){gridDefApproval.fileUploadCheck(a,I,e)}),I.preAuthFile=function(e){gridDefApproval.removeUploadedFile(e,I)},I.downloadFile=function(e){gridDefApproval.downloadDocument(e)},l.viewPreAuth(I.patientDetails).then(function(t){if(gridDefApproval.getDocument(I).then(function(e){for(var t=0;t<e.length;t++)I.filesUploaded.push({"@class":"com.napier.core.service.vo.uploadfile.NapierDocument",docName:e[t].DOC_NAME,docSeqId:e[t].DOC_SEQ_ID,status:2,machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,fileSize:e[t].FILE_SIZE,trimFileName:gridDefApproval.trimFile(e[t].DOC_NAME),fSize:e[t].FILE_SIZE}),I.uploadedfileNames.push(e[t].DOC_NAME)}),null!=t.data.HITService.message.approxBillsList){if(I.fetchResult=t.data.HITService.message.approxBillsList[0]["com.napier.core.billgeneration.vo.ApproxBillVo"],e.durgCnsmblesGridOtions.data=[],null!=I.fetchResult.materialVosList[0]&&""!=I.fetchResult.materialVosList[0]){var a=I.fetchResult.materialVosList[0]["com.napier.core.billgeneration.vo.MaterialVo"];u.getData(a,e.durgCnsmblesGridOtions,e.estimateCost,e.discounts,e.grossAmount,e)}if(e.durgCnsmblesGridOtions.data.length>5?e.durgCnsmblesGridOtions.enableVerticalScrollbar=1:e.durgCnsmblesGridOtions.enableVerticalScrollbar=0,e.packageDetlOtions.data=[],null!=I.fetchResult.approxBillPackageDtlsVos[0]&&""!=I.fetchResult.approxBillPackageDtlsVos[0]){var i=I.fetchResult.approxBillPackageDtlsVos[0]["com.napier.core.billgeneration.vo.ApproxBillPackageDtlsVo"];u.getData(i,e.packageDetlOtions,e.estimateCost,e.discounts,e.grossAmount,e)}if(e.packageDetlOtions.data.length>5?e.packageDetlOtions.enableVerticalScrollbar=1:e.packageDetlOtions.enableVerticalScrollbar=0,e.serviceDetailsGridOtions.data=[],null!=I.fetchResult.approxBillServiceDtlsVoList[0]&&""!=I.fetchResult.approxBillServiceDtlsVoList[0]){var r=I.fetchResult.approxBillServiceDtlsVoList[0]["com.napier.core.billgeneration.vo.ApproxBillServiceDtlsVo"];p.serviceGetData(r,e.serviceDetailsGridOtions,e.estimateCost,e.discounts,e.grossAmount,e),e.maxSize=5,e.bigTotalItems=10*Math.ceil(e.serviceDetailsGridOtions.data.length/e.serviceDetailsGridOtions.paginationPageSize)}if(e.serviceDetailsGridOtions.data.length>5?e.serviceDetailsGridOtions.enableVerticalScrollbar=1:e.serviceDetailsGridOtions.enableVerticalScrollbar=0,e.gridOptionsReminder.data=[],null!=I.fetchResult.remainderVos[0]&&""!=I.fetchResult.remainderVos[0]){var n=I.fetchResult.remainderVos[0]["com.napier.core.billgeneration.vo.RemainderVo"];u.addDataFormService(n,e.gridOptionsReminder,e)}if(e.gridOptionsEnhance.data=[],null!=I.fetchResult.enhncementvo[0]&&""!=I.fetchResult.enhncementvo[0]){var l=I.fetchResult.enhncementvo[0]["com.napier.core.billgeneration.vo.EnhancmentVo"];l instanceof Array?e.gridOptionsEnhance.data=l:e.gridOptionsEnhance.data.push(l)}e.gridOptionsReminder.data.length>5?e.gridOptionsReminder.enableVerticalScrollbar=1:e.gridOptionsReminder.enableVerticalScrollbar=0,e.gridOptionsEnhance.data.length>5?e.gridOptionsEnhance.enableVerticalScrollbar=1:e.gridOptionsEnhance.enableVerticalScrollbar=0}}),e.addReminder=function(){if(null!=I.reminder&&null!=I.reminder&&""!=I.reminder&&I.reminderStatus.length>0){if(e.gridOptionsReminder.data.length>0){var t=[];e.gridOptionsReminder.data instanceof Array?t=angular.copy(e.gridOptionsReminder.data):t.push(e.gridOptionsReminder.data);for(var a=0;a<t.length;a++){if(t[a].remainder==I.reminder){var i=I.alertData.remAlrdyExist;v.hisAlertMulti("information",I.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.close);break}a==t.length-1&&e.gridOptionsReminder.data.push({remainder:I.reminder,remainderDate:d("date")(new Date(I.reminderDate),"yyyy-MM-dd")+"T11:40:22.000023+0530",remainderStatus:I.reminderStatus,userDetails:e.reminderDetails,remarks:I.reminderRemarks})}}else e.gridOptionsReminder.data.push({remainder:I.reminder,remainderDate:d("date")(new Date(I.reminderDate),"yyyy-MM-dd")+"T11:40:22.000023+0530",remainderStatus:I.reminderStatus,userDetails:e.reminderDetails,remarks:I.reminderRemarks});I.reminder=null,I.reminderDate=new Date,I.reminderStatus=[],I.reminderRemarks=null,e.gridOptionsReminder.data.length>5?e.gridOptionsReminder.enableVerticalScrollbar=1:e.gridOptionsReminder.enableVerticalScrollbar=0}else if(I.reminderStatus.length>0){i=I.alertData.plzEntrRem;v.hisAlertMulti("information",I.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.close)}else if(null!=I.reminder&&null!=I.reminder&&""!=I.reminder||0!=I.reminderStatus.length)if(null==I.reminder||null==I.reminder||""==I.reminder){i=I.alertData.plzEntrRem;v.hisAlertMulti("information",I.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.close)}else{i=I.alertData.plzSlctStatus;v.hisAlertMulti("information",I.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.close)}else{var i=I.alertData.plzEntrRemStatus;v.hisAlertMulti("information",I.alertData.alertTypeInfo,i,e.alertData,e.alertFunction,e.close)}},e.addEnhancement=function(){if(e.gridOptionsEnhance.data.length>0){var t=[];e.gridOptionsEnhance.data instanceof Array?t=e.gridOptionsEnhance.data:t.push(e.gridOptionsEnhance.data);for(var a=0;a<t.length;a++){if(I.enhanceNum==t[a].enBillNmbr){v.hisAlertMulti("information","Information","Enhancement Already Existing",e.alertData,e.alertFunction);break}a==t.length-1&&e.gridOptionsEnhance.data.push({enBillNmbr:I.enhanceNum,enAmnt:I.enhanceAmount,remarks:I.enhRemarks})}I.enhanceNum=null,I.enhanceAmount=null,I.enhRemarks=null}else e.gridOptionsEnhance.data.push({enBillNmbr:I.enhanceNum,enAmnt:I.enhanceAmount,remarks:I.enhRemarks});e.gridOptionsEnhance.data.length>5?e.gridOptionsEnhance.enableVerticalScrollbar=1:e.gridOptionsEnhance.enableVerticalScrollbar=0},I.update=function(){I.saveDataInput=[],I.serviceData=[],I.saveDataInput.push({regSeqId:null!=I.patientDetailsSearch.regSeqId?I.patientDetailsSearch.regSeqId:I.patientDetails.regSeqId,patientcategorySeqId:null==I.patientDetailsSearch.patientcategorySeqId?691702168:I.patientDetailsSearch.patientcategorySeqId,tariffSeqId:null==I.patientDetailsSearch.tariffSeqId||null==I.patientDetailsSearch.tariffSeqId?4:I.patientDetailsSearch.tariffSeqId,approxBillDate:I.listSelectData[0][0].approxBillDate.$,grossAmt:I.estimateCost,approxBillHdSeqId:I.patientDetails.approxBillHdSeqId});for(var t=0;t<e.serviceDetailsGridOtions.data.length;t++)I.serviceData.push({serviceQty:e.serviceDetailsGridOtions.data[t].serviceQty,serviceSeqId:e.serviceDetailsGridOtions.data[t].serviceSeqId,chargeableAmt:e.serviceDetailsGridOtions.data[t].chargeableAmt,serviceDiscountAmt:e.serviceDetailsGridOtions.data[t].serviceDiscountAmt,serviceRate:e.serviceDetailsGridOtions.data[t].serviceRate,expcServDate:null==e.serviceDetailsGridOtions.data[t].expcServDate.$?"9999-03-16 00:00:00.000":e.serviceDetailsGridOtions.data[t].expcServDate.$,remarks:e.serviceDetailsGridOtions.data[t].remarks,approvedDetails:e.serviceDetailsGridOtions.data[t].approvedDetails,approxBillDtSeqId:e.serviceDetailsGridOtions.data[t].approxBillDtSeqId});e.dignsisModelSave=[],gridDefApproval.saveDocument(I).then(function(e){}),n.savePreAuthForReg(I.saveDataInput[0],I.serviceData,e.durgCnsmblesGridOtions.data,e.packageDetlOtions.data,e.dignsisModelSave,e.gridOptionsEnhance.data,e.gridOptionsReminder.data).then(function(t){if(null!=t.data.HITService.message.approxBillVos&&null!=t.data.HITService.message.approxBillVos&&""!=t.data.HITService.message.approxBillVos){var a=t.data.HITService.message.approxBillVos;if(null!=a&&null!=a[0]&&null!=a[0]["com.napier.core.billgeneration.vo.ApproxBillVo"].approxBillNo){var i={buttonText:I.alertData.ok},r={buttonCallBack1:function(){e.patientRecordsDetail.mrNo;S.go("index.billingSub.preAuthList",{id:e.patientRecordsDetail.mrNo})}},n={buttonClose:r.buttonCallBack1()},l=I.alertData.updatedSucsfuly;v.hisAlertMulti("success",I.alertData.alertTypeSucss,l,i,r,n,2e3)}}})}}e.$inject=["$scope","gridDefinationCommon","PatientBanner","hisTranslationsService","hisTranslationsGlobalLang","PreAuthSaveServices","PreAuthViewServices","$stateParams","$uibModal","PatientBannerBilling","$filter","ServiceGet","CommonForDrugPackage","PackageServices","hisCalDefConstant","$state","hisAlertService","PatientBannerGlobal","hisGenericAlertService"],angular.module("napierContainerUi").controller("preAuthUpdateCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d){t.loadModule("billing");var p=a.getLanguageToSet();t.changeLanguage(p);var u=this;u.filesUploaded=[],u.uploadedfileNames=[],u.uploadingFile=!1,u.viewDetails="1",u.alertData={},s.loadAlerts(p).then(function(t){u.alertData=t,e.alertData={buttonText:u.alertData.ok},e.alertFunction={buttonCallBack1:function(){}},e.close={buttonClose:function(){}}}),u.listSelectData=JSON.parse(r.id),u.patientDetails={approxBillHdSeqId:u.listSelectData[0][0].approxBillHdSeqId,regSeqId:null==u.listSelectData[0][0].regSeqId?u.listSelectData[1].regSeqId:u.listSelectData[0][0].regSeqId,admissionSeqid:null==u.listSelectData[0][0].ipAdmSeqId?null!=u.listSelectData[1]?u.listSelectData[1].ipAdmSeqId:void 0:u.listSelectData[0][0].ipAdmSeqId};var m="1",g=u.patientDetails;m=null!=g.admissionSeqid?"1":"2",l.getPatientBanner(g,m).then(function(t){e.patientGlobalDtls=t,e.patientGlobalDtls.userPermision=12}),n.patientBannerDetail(u.patientDetails.regSeqId).then(function(t){e.patientBannerDetails=t,e.patientRecordsDetail=e.patientBannerDetails.patientRecordsDetail}),c.preAuthViewRecords(u,"viewPre",!0),u.downloadFile=function(e){o.downloadDocument(e)},u.getPreAuthData=function(){i.getPreAuthDataHeader(u.patientDetails,u).then(function(t){u.preAuthHeaderList.length>0&&(u.isBillOrServiceFlag=u.preAuthHeaderList[0].IS_BILL_OR_SERVE_LEVEL+"",u.isCoPayAvl=null!=u.preAuthHeaderList[0].IS_COPAY_AVAILABLE?u.preAuthHeaderList[0].IS_COPAY_AVAILABLE+"":"3",u.coPayVal=u.preAuthHeaderList[0].COPAY_VALUE,u.maxCap=null!=u.preAuthHeaderList[0].IS_MAX_COPAY_AVAILABLE?u.preAuthHeaderList[0].IS_MAX_COPAY_AVAILABLE+"":"3",u.maxCapOnCopay=u.preAuthHeaderList[0].MAX_COPAY_VALUE,u.isDedctibleAvl=null!=u.preAuthHeaderList[0].IS_DEDUCTABLE_AVAILABLE?u.preAuthHeaderList[0].IS_DEDUCTABLE_AVAILABLE+"":"3",u.deductbleValue=u.preAuthHeaderList[0].DEDUCTABLE_VALUE,u.initialAuthAmount=u.preAuthHeaderList[0].APPROVED_AMNT,u.grossAmt=u.preAuthHeaderList[0].GROSS_AMT,u.preAuthHeaderObj=u.preAuthHeaderList[0]),u.preAuthHeaderObj.PREAUTH_BILL_NO.toString().indexOf("PA")>=0?e.hideAprv=!0:e.hideAprv=!1,null==u.initialAuthAmount||""===u.initialAuthAmount||null==u.initialAuthAmount?(u.preAuthViewDetailsGridOtions.columnDefs[9].visible=!1,u.preAuthViewDetailsGridOtions.columnDefs[8].visible=!1,u.preAuthViewDetailsGridOtions.columnDefs[7].visible=!1,u.preAuthViewDetailsGridOtions.columnDefs[6].visible=!1):(u.preAuthViewDetailsGridOtions.columnDefs[9].visible=!0,u.preAuthViewDetailsGridOtions.columnDefs[8].visible=!0,u.preAuthViewDetailsGridOtions.columnDefs[7].visible=!0,u.preAuthViewDetailsGridOtions.columnDefs[6].visible=!0),o.getDocument(u).then(function(e){for(var t=0;t<e.length;t++)u.filesUploaded.push({"@class":"com.napier.core.service.vo.uploadfile.NapierDocument",docName:e[t].DOC_NAME,docSeqId:e[t].DOC_SEQ_ID,status:2,machineIp:angular.fromJson(sessionStorage.userContextObj).WORKSTATION,fileSize:e[t].FILE_SIZE,trimFileName:o.trimFile(e[t].DOC_NAME),fSize:e[t].FILE_SIZE}),u.uploadedfileNames.push(e[t].DOC_NAME)}),i.getPreAuthData(u.patientDetails,u).then(function(e){if(u.preAuthViewDetailsGridOtions.data=[],u.preAuthServiceList.length>0)for(let e=0;e<u.preAuthServiceList.length;e++){let t={isAmtNlPercFlag:u.preAuthServiceList[e].IS_AMT_PERC_NL_CODE+"",approxBillDtSeqId:u.preAuthServiceList[e].PREAUTH_BILL_DT_SEQ_ID,valueAmt:u.preAuthServiceList[e].CHARGEABLE_AMT,qty:u.preAuthServiceList[e].SERV_QTY,priServGroup:{DESCRIPTION:u.preAuthServiceList[e].PRI_SERV_DESC,CODE:u.preAuthServiceList[e].PRI_SERV_CODE},department:{DESCRIPTION:u.preAuthServiceList[e].DEPT_DESC,CODE:u.preAuthServiceList[e].DEPT_CODE},specialty:{DESCRIPTION:u.preAuthServiceList[e].SPL_DESC,CODE:u.preAuthServiceList[e].SPL_CODE},service:{SERV_NAME:u.preAuthServiceList[e].SERV_NAME,SERV_SEQ_ID:u.preAuthServiceList[e].SERV_SEQ_ID},approvedDetails:u.preAuthServiceList[e].APPROVD_DTLS,approvedAmount:u.preAuthServiceList[e].APPROVED_AMNT,approvedQty:u.preAuthServiceList[e].APPROVED_QTY,remarks:u.preAuthServiceList[e].APPROVE_REMARKS,CONSUMABLE_AMOUNT:u.preAuthServiceList[e].CONSUMABLE_AMOUNT,CONSUMABLE_QTY:u.preAuthServiceList[e].CONSUMABLE_QTY,GN_STATUS:u.preAuthServiceList[e].GN_STATUS,viewPreAuthFlag:u.viewPreAuth};u.preAuthViewDetailsGridOtions.data.push(t)}})})},u.printPreAuth=function(){var t={regSeqId:u.patientDetails.regSeqId,encSeqId:e.patientGlobalDtls.encounterSeqId,approxBillHdSeqId:u.patientDetails.approxBillHdSeqId,reportId:"CLAIM_FORM_TEMPLATE_PRE_AUTH"};d.printReportModal("printPreAuthController","lg","PDF",t)},u.getPreAuthData()}e.$inject=["$scope","hisTranslationsService","hisTranslationsGlobalLang","PreAuthViewServices","$stateParams","PatientBannerBilling","PatientBannerGlobal","hisGenericAlertService","gridDefApproval","ServiceGet","PrintService"],angular.module("napierContainerUi").controller("preAuthViewCtrl",e)}(),function(){"use strict";angular.module("napierContainerUi").service("PreAuthUpdateServices",["CallManager","IPINDENTAPIS",function(e,t){this.savePreAuthUpdate=function(a,i,r,n,l){var s={};return s.url=t.HISIPINDENT.URL,s.requestData={operation:"saveEnhancementList",messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillList",approxBillVos:[{"com.napier.core.billgeneration.vo.ApproxBillVo":[{bedClassSeqId:a.bedClassSeqId,remarks:a.remarks,approxHdSeqId:a.approxHdSeqId,subAccSeqId:a.subAccSeqId,regSeqId:a.regSeqId,isBillOrServeLevel:a.isBillOrServeLevel,patientcategorySeqId:a.patientcategorySeqId,approxBillDate:a.approxBillDate,approvedAmount:a.approvedAmount,approxBillHdSeqId:a.approxBillHdSeqId,grossAmt:a.grossAmt,approxBillServiceDtlsVoList:[{"com.napier.core.billgeneration.vo.ApproxBillServiceDtlsVo":i}],approxBillPackageDtlsVos:[{"com.napier.core.billgeneration.vo.ApproxBillPackageDtlsVo":n}],materialVosList:[{"com.napier.core.billgeneration.vo.MaterialVo":r}],diagonsisVos:[{"com.napier.core.billgeneration.vo.DiagnosisDetailsVo":a.Values}],remainderVos:[{"com.napier.core.billgeneration.vo.RemainderVo":l}]}]}]}},e.sendRestRequest(s)}}])}(),function(){"use strict";angular.module("napierContainerUi").service("PreAuthSaveServices",["CallManager","IPINDENTAPIS",function(e,t){this.savePreAuthForReg=function(a,i,r,n,l,s,o){var c={};return c.url=t.HISIPINDENT.URL,c.requestData={operation:"savePreAuthGenList",messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillList",approxBillVos:[{"com.napier.core.billgeneration.vo.ApproxBillVo":[{bedClassSeqId:a.bedClassSeqId,StrExpectedDays:a.StrExpectedDays,approxHdSeqId:a.approxHdSeqId,tariffSeqId:a.tariffSeqId,icdCode:a.icdCode,regSeqId:a.regSeqId,payerType:a.payerType,patientcategorySeqId:a.patientcategorySeqId,approxBillDate:a.approxBillDate,grossAmt:a.grossAmt,gnStatus:null!=a.gnStatus?a.gnStatus:parseInt(1),approvedAmount:a.approvedAmount,approxBillHdSeqId:a.approxBillHdSeqId,remarks:a.remarks,approvalRefNo:a.approvalRefNo,subAccSeqId:a.subAccSeqId,isBillOrServeLevel:a.isBillOrServeLevel,isCopayAvailable:a.isCopayAvailable,copayValue:a.copayValue,isMaxCopayAvailable:a.isMaxCopayAvailable,maxCopayValue:a.maxCopayValue?parseFloat(a.maxCopayValue):void 0,isDeductableAvailable:a.isDeductableAvailable,deductableValue:a.deductableValue,effectiveFrom:a.effectiveFrom,effectiveTo:a.effectiveTo,gnTranStatus:1,isPreAuthOrEnhancement:1,approxBillServiceDtlsVoList:[{"com.napier.core.billgeneration.vo.ApproxBillServiceDtlsVo":i}],approxBillPackageDtlsVos:[{"com.napier.core.billgeneration.vo.ApproxBillPackageDtlsVo":n}],materialVosList:[{"com.napier.core.billgeneration.vo.MaterialVo":r}],diagonsisVos:[{"com.napier.core.billgeneration.vo.DiagnosisDetailsVo":l}],remainderVos:[{"com.napier.core.billgeneration.vo.RemainderVo":o}]}]}]}},e.sendRestRequest(c)},this.savePreAuthForRegUpdated=function(a,i,r,n,l,s,o,c,d,p,u){var m={};return m.url=t.HISIPINDENT.URL,m.requestData={operation:"savePreAuthGenList",messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillList",approxBillVos:[{"com.napier.core.billgeneration.vo.ApproxBillVo":[{bedClassSeqId:a.bedClassSeqId,StrExpectedDays:a.StrExpectedDays,approxHdSeqId:a.approxHdSeqId,tariffSeqId:a.tariffSeqId,icdCode:a.icdCode,regSeqId:a.regSeqId,payerType:a.payerType,patientcategorySeqId:a.patientcategorySeqId,approxBillDate:a.approxBillDate,grossAmt:a.grossAmt,gnStatus:null!=a.gnStatus?a.gnStatus:parseInt(1),approvedAmount:a.approvedAmount,approxBillHdSeqId:a.approxBillHdSeqId,remarks:a.remarks,approvalRefNo:a.approvalRefNo,subAccSeqId:a.subAccSeqId,isServiceLevel:a.isServiceLevel,isBillLevel:a.isBillLevel,isCopayAvailable:a.isCopayAvailable,copayValue:a.copayValue,isMaxCopayAvailable:a.isMaxCopayAvailable,maxCopayValue:a.maxCopayValue?parseFloat(a.maxCopayValue):void 0,isDeductableAvailable:a.isDeductableAvailable,deductableValue:a.deductableValue,effectiveFrom:a.effectiveFrom,effectiveTo:a.effectiveTo,insuranceSeqId:a.insuranceSeqId,insurancePlanSeqId:a.insurancePlanSeqId,admissionReason:a.admissionReason,policyNumber:a.policyNumber,cardNumber:a.cardNumber,gnFlow:a.gnFlow,StrExpectedDays:a.StrExpectedDays,gnTranStatus:a.gnTranStatus,chiefComplaints:a.chiefComplaints,isSubmitted:a.isSubmitted,planValidFromDate:a.planValidFromDate,planValidToDate:a.planValidToDate,isPreAuthOrEnhancement:a.isPreAuthOrEnhancement,approxBillNo:a.approxBillNo,approxBillServiceDtlsVoList:[{"com.napier.core.billgeneration.vo.ApproxBillServiceDtlsVo":i}],approxBillPackageDtlsVos:[{"com.napier.core.billgeneration.vo.ApproxBillPackageDtlsVo":n}],materialVosList:[{"com.napier.core.billgeneration.vo.MaterialVo":r}],diagonsisVos:[{"com.napier.core.billgeneration.vo.DiagnosisDetailsVo":l}],remainderVos:[{"com.napier.core.billgeneration.vo.RemainderVo":o}],procedureDetailsVos:[{"com.napier.core.billgeneration.vo.ApproxProcedureDetailsVo":c}],materialVosList:[{"com.napier.core.billgeneration.vo.MaterialVo":d}],preAuthApprovalVoList:[{"com.napier.core.billgeneration.vo.PreAuthApprovalVo":p}],preAuthOutOfPocketHDVoList:[{"com.napier.core.billgeneration.vo.PreAuthOutOfPocketHDVo":u}]}]}]}},e.sendRestRequest(m)},this.savepayer=function(a){var i={};return i.url=t.HISIPINDENT.URL,i.requestData={operation:"processUpdateInsurance",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.BillPayerConversionHistoryVo",insuranceSeqId:a.insuranceSeqId,insurancePlanSeqId:a.insurancePlanSeqId,tariffCatgCode:a.tariffCatgCode,policyNumber:a.policyNumber,cardNumber:a.cardNumber,planValidFromDate:a.planValidFromDate,planValidToDate:a.planValidToDate,payerType:a.payerType,regSeqId:a.regSeqId,patientType:a.patientType,gnStatus:a.gnStatus,insTypeSeqCd:a.insTypeSeqCd,piInPriority:a.piInPriority,isNewPayer:a.isNewPayer}},e.sendRestRequest(i)}}])}(),function(){"use strict";angular.module("napierContainerUi").service("PreAuthViewServices",["CallManager","IPINDENTAPIS","QueryService",function(e,t,a){this.viewPreAuth=function(a){var i={};return i.url=t.HISIPINDENT.URL,i.requestData={operation:"getPatientPreAuthDtls",messageId:"",destination:"com.napier.core.billgeneration.service.external.ApproximateBillService",message:{"@class":"com.napier.core.billgeneration.vo.ApproxBillVo",regSeqId:a.regSeqId,approxBillHdSeqId:a.approxBillHdSeqId}},e.sendRestRequest(i)},this.getPreAuthData=function(e,t){t.preAuthServiceList=[];let i={1:t.preAuthServiceList},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pPreAuthHdSeqId",e.approxBillHdSeqId,n),a.executeQueryInput("GET_PREAUTH_SERVICE_DETAILS",n,i,!0,!0,r,"popUp",{})},this.getPreAuthDataHeader=function(e,t){t.preAuthHeaderList=[];let i={1:t.preAuthHeaderList},r=a.executeQueryURLReset(),n=new Array;return a.prepareParamListWithParam("pPreAuthHDSeqId",e.approxBillHdSeqId,n),a.executeQueryInput("GET_PRE_AUTH_HEADER_DETAILS",n,i,!0,!0,r,"popUp",{})}}])}(),function(){"use strict";angular.module("napierContainerUi").constant("billListingReportGridColumnData",{multiSelect:!0,enableHorizontalScrollbar:1,enableVerticalScrollbar:0,enableColumnMenus:!1,enableSorting:!0,paginationPageSize:10,showGridFooter:!0,enableFiltering:!1,columnDefs:[{field:"SL_No",displayName:"SL No",enableColumnMenu:!1,enableCellEdit:!1,minWidth:60},{field:"PAT_CATG_DESC",displayName:"Patient Category",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100},{field:"ACCOUNT_NO",displayName:"Visit No/Admission No",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150},{field:"PATIENT_NAME",displayName:"Patient Name",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150,cellTooltip:function(e,t){return e.entity.PATIENT_NAME}},{field:"RG_INT_MR_NO",displayName:"MR No",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100},{field:"BILL_NO",displayName:"Bill No",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150,cellTooltip:function(e,t){return e.entity.BILL_NO}},{field:"BILL_DATE",displayName:"Bill Date",enableColumnMenu:!1,enableCellEdit:!1,cellFilter:"date:'dd-MM-yyyy'",minWidth:150},{field:"BILL_DESCRIPTION",displayName:"Bill Status",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100},{field:"Billed_User",displayName:"Billed User",enableColumnMenu:!1,enableCellEdit:!1,visible:!1},{field:"PAYER_NAME",displayName:"Payer Name",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100},{field:"CREDIT_NOTE",displayName:"Credit Note",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150},{field:"Debit_Note",displayName:"Debit Note",enableColumnMenu:!1,enableCellEdit:!1,visible:!1},{field:"BILL_AMT",displayName:"Bill Amount",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100,cellFilter:"number: 2",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:right;">{{row.entity.BILL_AMT-row.entity.TAX_AMT  | number:2}}</div>'},{field:"TAX_AMT",displayName:"Tax",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100,cellFilter:"number: 2",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:right;">{{row.entity.TAX_AMT | number:2}}</div>'},{field:"BILL_AMT",displayName:"Net Amount",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100,cellFilter:"number: 2",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:right;">{{row.entity.BILL_AMT | number:2}}</div>'},{field:"DISC_AMT",displayName:"Concession/Discount Amount",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100,cellFilter:"number: 2",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:right;">{{row.entity.DISC_AMT | number:2}}</div>'},{field:"DEP_ADJUST_AMT",displayName:"Deposit Adjusted amount",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100,cellFilter:"number: 2",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:right;">{{row.entity.DEP_ADJUST_AMT | number:2}}</div>'},{field:"PAID_AMT",displayName:"Paid Amount",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100,cellFilter:"number: 2",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:right;">{{row.entity.PAID_AMT | number:2}}</div>'},{field:"OUTSTD_AMT",displayName:"Outstanding Amount",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100,cellFilter:"number: 2",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:right;">{{row.entity.OUTSTD_AMT | number:2}}</div>'},{field:"RECEIPT_NO",displayName:"Receipt No.",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150,cellTooltip:function(e,t){return e.entity.RECEIPT_NO}},{field:"RECEIPT_DATE",displayName:"Receipt Date",enableColumnMenu:!1,enableCellEdit:!1,cellFilter:"date:'dd-MM-yyyy'",minWidth:150}]}).constant("billListingCancelledReportGridColumnData",{multiSelect:!0,enableHorizontalScrollbar:1,enableVerticalScrollbar:0,enableColumnMenus:!1,enableSorting:!0,paginationPageSize:10,showGridFooter:!0,enableFiltering:!1,columnDefs:[{field:"SL_No",displayName:"SL No",enableColumnMenu:!1,enableCellEdit:!1,minWidth:60},{field:"PAT_CATG_DESC",displayName:"Patient Category",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100},{field:"ACCOUNT_NO",displayName:"Visit No/Admission No",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150},{field:"PATIENT_NAME",displayName:"Patient Name",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150,cellTooltip:function(e,t){return e.entity.PATIENT_NAME}},{field:"RG_INT_MR_NO",displayName:"MR No",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100},{field:"BILL_NO",displayName:"Bill No",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150,cellTooltip:function(e,t){return e.entity.BILL_NO}},{field:"BILL_DATE",displayName:"Bill Date",enableColumnMenu:!1,enableCellEdit:!1,cellFilter:"date:'dd-MM-yyyy'",minWidth:150},{field:"BILL_DESCRIPTION",displayName:"Bill Status",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100},{field:"Billed_User",displayName:"Billed User",enableColumnMenu:!1,enableCellEdit:!1,visible:!1},{field:"PAYER_NAME",displayName:"Payer Name",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100},{field:"CREDIT_NOTE",displayName:"Credit Note",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150},{field:"Debit_Note",displayName:"Debit Note",enableColumnMenu:!1,enableCellEdit:!1,visible:!1},{field:"BILL_AMT",displayName:"Bill Amount",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100,cellFilter:"number: 2",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:right;">{{row.entity.BILL_AMT | number:2}}</div>'},{field:"DEP_ADJUST_AMT",displayName:"Deposit Adjusted amount",enableColumnMenu:!1,enableCellEdit:!1,minWidth:100,cellFilter:"number: 2",cellTemplate:'<div class="ui-grid-cell-contents" style="text-align:right;">{{row.entity.DEP_ADJUST_AMT | number:2}}</div>'},{field:"RECEIPT_NO",displayName:"Receipt No.",enableColumnMenu:!1,enableCellEdit:!1,minWidth:150,cellTooltip:function(e,t){return e.entity.RECEIPT_NO}},{field:"RECEIPT_DATE",displayName:"Receipt Date",enableColumnMenu:!1,enableCellEdit:!1,cellFilter:"date:'dd-MM-yyyy'",minWidth:150},{field:"CANCEL_REASON",displayName:"Cancel Reason",enableColumnMenu:!1,enableCellEdit:!1,cellFilter:"date:'dd-MM-yyyy'",minWidth:150},{field:"CANCEL_REMARKS",displayName:"Cancel Remarks",enableColumnMenu:!1,enableCellEdit:!1,cellFilter:"date:'dd-MM-yyyy'",minWidth:150}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("billListingSearchQuery",{operation:"ExecuteQuery",destination:"QueryService",voclass:"com.napier.core.service.vo.query.QueryData",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{idxList:[{"com.napier.core.service.vo.query.Index":[{}]}]}]}]}})}(),function(){"use strict";function e(e,t,a,i,r,n){this.getQuerys=function(e){var t={};return t.url=a.HISCOMBOFILLING.URL,t.requestData=angular.copy(r),angular.extend(t.requestData.message,{queryList:[{"com.napier.core.service.vo.query.Query":{identifier:e,idxList:[{"com.napier.core.service.vo.query.Index":[]}]}}]}),i.sendRestRequest(t)},this.getSearchGridQuery=function(t,a){var i=e.defer(),r=n.executeQueryURLReset(),l={1:[]},s=new Array;if(null!=a&&""!=a)for(var o in a)n.prepareParamListWithParam(o,a[o],s);return n.executeQueryInput(t,s,l,!0,!0,r,"popUp",{}).then(function(e){i.resolve(e)}),i.promise}}e.$inject=["$q","$http","BILLING_APIS","CallManager","billListingSearchQuery","QueryService"],angular.module("napierContainerUi").service("billLisitngService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("serviceMastersGridServiceDefinition",{enableSorting:!1,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScrollbar:0,rowTemplate:"<div  ng-class=\"{ 'ui-grid-row-header-cell': col.isRowHeader,'red':row.entity.isDuplicate}\" ng-style=\"{ 'cursor': 'pointer' }\" > <div ng-repeat=\"col in colContainer.renderedColumns track by col.colDef.name\"  class=\"ui-grid-cell\" ui-grid-cell></div></div>",columnDefs:[{name:"serviceCode",displayName:"billing.serviceCode",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0},{name:"serviceName",displayName:"billing.serviceName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTooltip:function(e,t){return e.entity.serviceName},cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"    >{{row.entity.serviceName | limitTo: 16}}{{row.entity.serviceName.length > 16 ? "..." : ""}}</div>'},{name:"pServiceGroup",enableSorting:!0,displayName:"billing.psGroup",headerCellFilter:"translate",cellTooltip:function(e,t){return e.entity.pServiceGroup.gQDataName},enableCellEdit:!0,cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div><div ng-if="row.entity.editable"><select  ng-required="row.entity.required" class="form-control" ng-model="row.entity.pServiceGroup"    ng-change="grid.appScope.sm.changePrimaryService(row.entity,rowRenderIndex)" ng-options="primary  as primary.gQDataName for primary in grid.appScope.sm.primaryService " >                                  </select></div>'},{name:"sServiceGroup",enableSorting:!0,displayName:"billing.ssGroup",cellTooltip:function(e,t){return e.entity.sServiceGroup.gQDataName},headerCellFilter:"translate",enableCellEdit:!0,cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div><div ng-if="row.entity.editable"><select  ng-required="row.entity.required" class="form-control" ng-model="row.entity.sServiceGroup"    ng-change="grid.appScope.sm.changeSecondaryService(row.entity,rowRenderIndex)" ng-options="second  as second.gQDataName for second in grid.appScope.sm.secondaryServiceList[rowRenderIndex] " ></select></div>'},{name:"serviceType",displayName:"billing.serviceType",headerCellFilter:"translate",enableSorting:!0,cellTooltip:function(e,t){return e.entity.serviceType?e.entity.serviceType.gQDataName:""},enableCellEdit:!0,cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div><div ng-if="row.entity.editable"><select   class="form-control" ng-model="row.entity.serviceType"     ng-options="serType  as serType.gQDataName for serType in grid.appScope.sm.serviceTypeList[rowRenderIndex] " >                  <option value="">select</option>                </select></div>'},{name:"gnTranStatus",displayName:"Actions",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="actionRow"><i ng-if="!row.entity.editable && grid.appScope.sm.permissionList.T_SCM_M_SERV_LIST_U && row.entity.gnTranStatus==1" class="fa fa-pencil" ng-click="grid.appScope.sm.editGrid(row.entity,rowRenderIndex)" ></i><i ng-if="row.entity.editable && grid.appScope.sm.permissionList.T_SCM_M_SERV_LIST_U" class="glyphicon glyphicon-ok" ng-click="grid.appScope.sm.closeGrid(row.entity,rowRenderIndex)" ></i> <md-switch    ng-change="grid.appScope.sm.changeStatus(row.entity)" ng-disabled="!grid.appScope.sm.permissionList.T_SCM_M_SERV_LIST_U" ng-true-value="1" ng-false-value="2" ng-model="row.entity.gnTranStatus" class=" md-primary actionSwitch wlabel" aria-label="Switch 1">{{ (row.entity.gnTranStatus==1)?"Active":"Inactive" }}</md-switch><i ng-click="grid.appScope.sm.removeData(row.entity)" ng-style="{ \'cursor\': \'pointer\' }" class="glyphicon glyphicon-remove" aria-hidden="true"></i></div>'}]}).constant("facilityMappingGridDefinitionForHSC",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1,columnDefs:[{name:"serviceCode",displayName:"billing.serviceCode",width:95,headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0},{name:"serviceName",displayName:"billing.serviceName",width:98,headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,cellTooltip:function(e,t){return e.entity.serviceName},cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"    >{{row.entity.serviceName | limitTo: 16}}{{row.entity.serviceName.length > 16 ? "..." : ""}}</div>'},{name:"pServiceGroup",enableSorting:!0,width:160,displayName:"billing.psGroup",headerCellFilter:"translate",pinnedLeft:!0,cellTooltip:function(e,t){return e.entity.pServiceGroup.gQDataName},enableCellEdit:!0,cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"  >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div>'},{name:"sServiceGroup",enableSorting:!0,pinnedLeft:!0,width:165,displayName:"billing.ssGroup",cellTooltip:function(e,t){return e.entity.sServiceGroup.gQDataName},headerCellFilter:"translate",enableCellEdit:!0,cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"    >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div>'},{name:"serviceType",displayName:"billing.serviceType",headerCellFilter:"translate",enableSorting:!0,width:100,pinnedLeft:!0,cellTooltip:function(e,t){return e.entity.serviceType?e.entity.serviceType.gQDataName:""},enableCellEdit:!0,cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"   >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div>'},{name:"department",enableSorting:!0,headerCellFilter:"translate",displayName:"billing.department",width:100,cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-change="grid.appScope.fm.changeDepartment(row.entity.department.gQDataCode,rowRenderIndex)" ng-model="row.entity.department"  ng-required="row.entity.required"   ng-options="dept  as dept.gQDataName for dept in grid.appScope.fm.departmentList" >                  <option value="">select</option>                </select> </div>'},{name:"subDepartment",enableSorting:!0,displayName:" billing.subDepartment",width:130,headerCellFilter:"translate",cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.subDepartment"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.subDepartmentList[rowRenderIndex]"><option value="">select</option></select> </div>'},{name:"billingSubGroup",enableSorting:!0,width:120,displayName:"billing.billingSubGroup",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataSequence | limitTo: 16}}{{COL_FIELD.gQDataSequence.length > 16 ? "..." : ""}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.billingSubGroup"  ng-required="row.entity.required"   ng-options="service  as service.gQDataSequence for service in grid.appScope.fm.billingSubList" >                  <option value="">select</option>                </select> </div>'},{name:"misSubGroup",enableSorting:!0,width:130,displayName:"billing.misSubGroup",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataSequence | limitTo: 16}}{{COL_FIELD.gQDataSequence.length > 16 ? "..." : ""}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.misSubGroup"  ng-required="row.entity.required"   ng-options="misSub as misSub.gQDataSequence for misSub in grid.appScope.fm.misSubList" >                  <option value="">select</option>                </select> </div>'},{name:"serviceDesign",enableSorting:!0,width:120,displayName:"billing.serviceDesign",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.serviceDesign"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.designList" >                           </select> </div>'},{name:"serviceApplicability",enableSorting:!0,width:150,displayName:"billing.serviceApplicability",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable"><select  style="margin-top: -4px;" class="form-control" ng-model="row.entity.serviceApplicability"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.applicabilityList" >                  <option value="">select</option>                </select> </div>'},{name:"servicePriority",enableSorting:!0,width:120,displayName:"billing.servicePriority",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD[0].gQDataName}},{{COL_FIELD[1].gQDataName}},{{COL_FIELD[2].gQDataName}}</div><div class="ui-grid-cell-contents his-md-select" ng-if="row.entity.editable" > <md-select style="margin-top: -4px !important;height: 30px"  data-md-container-class="selectdemoSelectHeader his-md-select"  ng-model="row.entity.servicePriority" multiple="true" ng-required="row.entity.required" ><md-option ng-value="priority" ng-repeat="priority in grid.appScope.fm.servicePriorityList ">{{priority.gQDataName }}</md-option></md-select> </div>'},{name:"serviceValidFrom",enableSorting:!0,width:150,type:"date",cellFilter:"date:{{grid.appScope.fm.format}}",displayName:"billing.serviceValidityFrom",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{row.entity.serviceValidFrom |date:grid.appScope.fm.format}}</div> <div class="ui-grid-cell-contents his-datepicker-main" ng-if="row.entity.editable"><input  ng-required="row.entity.required" style="margin-top:-4px"  class="form-control" type="text"  readonly is-open="grid.appScope.fm.openedFrom[rowRenderIndex]" ng-change="grid.appScope.fm.serviceValidTo[rowRenderIndex].minDate=row.entity.serviceValidFrom;row.entity.serviceValidTo=row.entity.serviceValidFrom" ng-focus="grid.appScope.fm.openedTo[rowRenderIndex]=false;grid.appScope.fm.openedFrom[rowRenderIndex]=true"  show-button-bar="false" uib-datepicker-popup="{{grid.appScope.fm.format}}"  datepicker-options="grid.appScope.fm.fromDateOptions[rowRenderIndex]"  datepicker-append-to-body=true ng-model="row.entity.serviceValidFrom" /></div>'},{name:"serviceValidTo",enableSorting:!0,type:"date",cellFilter:"date:'{{grid.appScope.fm.format}}'",width:140,displayName:"billing.serviceValidityTo",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{row.entity.serviceValidTo|date:grid.appScope.fm.format}}</div> <div class="ui-grid-cell-contents his-datepicker-main" ng-if="row.entity.editable"><input style="margin-top: -4px;"  class="form-control" readonly type="text"  is-open="grid.appScope.fm.openedTo[rowRenderIndex]" ng-change="grid.appScope.fm.dateChange(row.entity)" ng-focus="grid.appScope.fm.openedFrom[rowRenderIndex]=false;grid.appScope.fm.openedTo[rowRenderIndex]=true"   show-button-bar="false" uib-datepicker-popup="{{grid.appScope.fm.format}}"  datepicker-options="grid.appScope.fm.serviceValidTo[rowRenderIndex]"  datepicker-append-to-body=true ng-model="row.entity.serviceValidTo" /></div>'},{name:"genderApplicability",enableSorting:!0,width:150,displayName:"billing.genderApplicability",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.genderApplicability"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.genderList" >                  <option value="">select</option>                </select> </div>'},{name:"billable",enableSorting:!0,displayName:"billing.billable",width:80,headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.billable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                  <option value="">select</option>                </select> </div>'},{name:"serviceDiscountApplicable",enableSorting:!0,width:200,displayName:"billing.serviceDiscountApplicable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select  style="margin-top: -4px;" class="form-control" ng-model="row.entity.serviceDiscountApplicable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                                 </select> </div>'},{name:"billWiseDiscountApplicable",enableSorting:!0,width:200,displayName:"billing.billWiseDiscountApplicable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.billWiseDiscountApplicable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                                 </select> </div>'},{name:"srCitizenDiscountApplicable",enableSorting:!0,width:220,displayName:"billing.srCitizenDiscountApplicable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select  style="margin-top: -4px;" class="form-control" ng-model="row.entity.srCitizenDiscountApplicable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                               </select> </div>'},{name:"depositRequired",enableSorting:!0,width:120,displayName:"billing.depositRequired",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.depositRequired"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                               </select> </div>'},{name:"rateEditable",enableSorting:!0,width:120,displayName:"billing.rateEditable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select  style="margin-top: -4px;" class="form-control" ng-model="row.entity.rateEditable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                                </select> </div>'},{name:"hospitalSurchargeApplicable",enableSorting:!0,width:200,displayName:"billing.hospitalSurchargeApplicable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select  style="margin-top: -4px;" class="form-control" ng-model="row.entity.hospitalSurchargeApplicable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                                  </select> </div>'},{name:"payerSurchargeApplicable",enableSorting:!0,width:200,displayName:"billing.payerSurchargeApplicable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.payerSurchargeApplicable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                                  </select> </div>'},{name:"cosmeticSurgery",enableSorting:!0,width:120,displayName:"billing.cosmeticSurgery",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable"  ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.cosmeticSurgery"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.cosmeticList" >                                  </select> </div>'},{name:"taxesApplicable",enableSorting:!0,width:120,displayName:"billing.taxType",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataSequence}}</div><div ng-if="row.entity.editable" class="ui-grid-cell-contents" ><select  style="margin-top: -4px;" class="form-control" ng-disabled="row.entity.taxable.gQDataCode==2" ng-model="row.entity.taxesApplicable"     ng-options="service  as service.gQDataSequence for service in grid.appScope.fm.taxList" ng-required="row.entity.taxable.gQDataCode==1 && row.entity.required" ng-change="(!row.entity.taxesApplicable)?row.entity.taxPercentages=\'\':\'\'">                  <option value="">select</option>                </select> </div>'},{name:"taxPercentages",enableSorting:!0,width:120,displayName:"billing.taxPercentages",headerCellFilter:"translate"},{name:"associateRevenueCode",enableSorting:!0,width:170,displayName:"billing.associateRevenueCode",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div ng-if="row.entity.editable" class="ui-grid-cell-contents" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.associateRevenueCode"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" ng-change="(row.entity.associateRevenueCode.gQDataCode==2)?row.entity.revenueCode=\'\':\'\'"></select> </div>'},{name:"revenueCode",enableSorting:!0,width:120,type:"number",displayName:"billing.revenueCode",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD}}</div><div ng-if="row.entity.editable" class="ui-grid-cell-contents" ><input style="margin-top: -4px;"  numbers-only   type="text"  class="form-control" ng-model="row.entity.revenueCode" ng-required="row.entity.associateRevenueCode.gQDataCode==1 && row.entity.required" ng-disabled="row.entity.associateRevenueCode.gQDataCode==2"  > </div>'},{name:"schedulable",enableSorting:!0,width:120,displayName:"billing.schedulable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div ng-if="row.entity.editable" class="ui-grid-cell-contents" ><select style="margin-top: -4px;"   class="form-control" ng-model="row.entity.schedulable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >               </select> </div>'},{name:"MMACodeApp",enableSorting:!0,width:120,displayName:"billing.hscmmaCodeapp",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable">{{COL_FIELD.name}}</div><div ng-if="row.entity.editable" class="ui-grid-cell-contents" ><select style="margin-top: -4px;"   class="form-control" ng-model="row.entity.MMACodeApp"    ng-options="mmid  as mmid.name for mmid in grid.appScope.fm.mmid" ng-change="grid.appScope.fm.checkValue(row,row.entity.MMACodeApp)"><option value="">Select</option></select> </div>'},{name:"MMACode",enableSorting:!0,displayName:"billing.hscmmaCode",width:150,headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div  ng-if="!row.entity.editable">{{row.entity.MMACode}}</div><div ng-required="true" ng-if="!row.entity.mmCode"></div><div ng-if="row.entity.mmCode"><div ng-if="row.entity.editable" class="ui-grid-cell-contents" ><input ng-change = "" style= "width:153px;margin-top: -4px;height:29px" type="text"  maxlength="10" min="1" ng-required="row.entity.mmCode" ng-model="row.entity.MMACode"/></div></div>'},{name:"actions",enableSorting:!0,pinnedRight:!0,width:120,displayName:"billing.action",headerCellFilter:"translate",cellTemplate:'<div class="actionRow"><span ng-if="row.entity.gnStatus==1"><i ng-if="!row.entity.editable && grid.appScope.fm.permissionList.T_SCM_M_SERV_FAC_MAP_U" class="fa fa-pencil" ng-click="grid.appScope.fm.editGrid(row,row.entity,rowRenderIndex)" ></i><i ng-if="row.entity.editable && grid.appScope.fm.permissionList.T_SCM_M_SERV_FAC_MAP_U" class="glyphicon glyphicon-ok" ng-click="grid.appScope.fm.closeGrid(row.entity,rowRenderIndex)" ></i> </span><md-switch    ng-change="grid.appScope.fm.changeStatus(row.entity)" ng-disabled="!grid.appScope.fm.permissionList.T_SCM_M_SERV_FAC_MAP_U" ng-true-value="1" ng-false-value="2" ng-model="row.entity.gnStatus" class="md-primary actionSwitch wlabel" aria-label="Switch 1">{{ (row.entity.gnStatus==1)?"Active":"Inactive" }}</md-switch><span ng-click="grid.appScope.fm.removeData(row.entity)" ng-style="{ \'cursor\': \'pointer\' }"><i class="fa fa-times fa-lg" aria-hidden="true"></i></span></div>'}]}).constant("modalGridServiceDefinition",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScrollbar:0,columnDefs:[{name:"serviceCode",enableSorting:!0,displayName:"billing.serviceCode",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents" ><input style="margin-top: -4px;"  ng-pattern="/^[a-zA-Z0-9]*$/" ng-blur="grid.appScope.smc.validateServiceCode(row.entity)" ng-required="row.entity.required" type="text"  maxlength="10" class="form-control" ng-model="row.entity.serviceCode"   "></div>'},{name:"serviceName",enableSorting:!0,displayName:"billing.serviceName",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents" ><input style="margin-top: -4px;"   type="text"  ng-blur="grid.appScope.smc.validateServiceName(row.entity)" ng-required="row.entity.required" class="form-control" ng-model="row.entity.serviceName"  maxlength="100" ></div>'},{name:"pServiceGroup",enableSorting:!0,displayName:"billing.psGroup",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents" > <select style="margin-top: -4px;"  ng-required="row.entity.required" class="form-control" ng-model="row.entity.pServiceGroup"    ng-change="grid.appScope.smc.changePrimaryService(row.entity,rowRenderIndex)" ng-options="primary  as primary.gQDataName for primary in grid.appScope.smc.primaryService " >                  <option value="">select</option>                </select></div>'},{name:"sServiceGroup",enableSorting:!0,displayName:"billing.ssGroup",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents" ><select style="margin-top: -4px;"  ng-required="row.entity.required" ng-change="grid.appScope.smc.changeSecondaryService(row.entity,rowRenderIndex)" class="form-control" ng-model="row.entity.sServiceGroup"    ng-options="secondary  as secondary.gQDataName for secondary in grid.appScope.smc.secondaryService[rowRenderIndex] " >                  <option value="" >select</option>                </select></div>'},{name:"serviceType",enableSorting:!0,displayName:"billing.serviceType",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents" ><select style="margin-top: -4px;"   class="form-control" ng-model="row.entity.serviceType"    ng-options="service  as service.gQDataName for service in grid.appScope.smc.serviceTypeList[rowRenderIndex] " >                  <option value="">select</option>                </select> </div>'}]}).constant("facilityMappingGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1,columnDefs:[{name:"serviceCode",displayName:"billing.serviceCode",width:95,headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0},{name:"serviceName",displayName:"billing.serviceName",width:98,headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,cellTooltip:function(e,t){return e.entity.serviceName},cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"    >{{row.entity.serviceName | limitTo: 16}}{{row.entity.serviceName.length > 16 ? "..." : ""}}</div>'},{name:"pServiceGroup",enableSorting:!0,width:160,displayName:"billing.psGroup",headerCellFilter:"translate",pinnedLeft:!0,cellTooltip:function(e,t){return e.entity.pServiceGroup.gQDataName},enableCellEdit:!0,cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"  >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div>'},{name:"sServiceGroup",enableSorting:!0,pinnedLeft:!0,width:165,displayName:"billing.ssGroup",cellTooltip:function(e,t){return e.entity.sServiceGroup.gQDataName},headerCellFilter:"translate",enableCellEdit:!0,cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"    >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div>'},{name:"serviceType",displayName:"billing.serviceType",headerCellFilter:"translate",enableSorting:!0,width:100,pinnedLeft:!0,cellTooltip:function(e,t){return e.entity.serviceType?e.entity.serviceType.gQDataName:""},enableCellEdit:!0,cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"   >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div>'},{name:"department",enableSorting:!0,headerCellFilter:"translate",displayName:"billing.department",width:100,cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-change="grid.appScope.fm.changeDepartment(row.entity.department.gQDataCode,rowRenderIndex)" ng-model="row.entity.department"  ng-required="row.entity.required"   ng-options="dept  as dept.gQDataName for dept in grid.appScope.fm.departmentList" >                  <option value="">select</option>                </select> </div>'},{name:"subDepartment",enableSorting:!0,displayName:" billing.subDepartment",width:130,headerCellFilter:"translate",cellTemplate:'<div  ng-style="{ \'cursor\': \'pointer\' }" class="ui-grid-cell-contents custom-class" title="TOOLTIP"  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.subDepartment"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.subDepartmentList[rowRenderIndex]"><option value="">select</option></select> </div>'},{name:"billingSubGroup",enableSorting:!0,width:120,displayName:"billing.billingSubGroup",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataSequence | limitTo: 16}}{{COL_FIELD.gQDataSequence.length > 16 ? "..." : ""}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.billingSubGroup"  ng-required="row.entity.required"   ng-options="service  as service.gQDataSequence for service in grid.appScope.fm.billingSubList" >                  <option value="">select</option>                </select> </div>'},{name:"misSubGroup",enableSorting:!0,width:130,displayName:"billing.misSubGroup",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataSequence | limitTo: 16}}{{COL_FIELD.gQDataSequence.length > 16 ? "..." : ""}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.misSubGroup"  ng-required="row.entity.required"   ng-options="misSub as misSub.gQDataSequence for misSub in grid.appScope.fm.misSubList" >                  <option value="">select</option>                </select> </div>'},{name:"serviceDesign",enableSorting:!0,width:120,displayName:"billing.serviceDesign",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName | limitTo: 16}}{{COL_FIELD.gQDataName.length > 16 ? "..." : ""}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.serviceDesign"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.designList" >                           </select> </div>'},{name:"serviceApplicability",enableSorting:!0,width:150,displayName:"billing.serviceApplicability",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable"><select  style="margin-top: -4px;" class="form-control" ng-model="row.entity.serviceApplicability"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.applicabilityList" >                  <option value="">select</option>                </select> </div>'},{name:"servicePriority",enableSorting:!0,width:120,displayName:"billing.servicePriority",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD[0].gQDataName}},{{COL_FIELD[1].gQDataName}},{{COL_FIELD[2].gQDataName}}</div><div class="ui-grid-cell-contents his-md-select" ng-if="row.entity.editable" > <md-select style="margin-top: -4px !important;height: 30px"  data-md-container-class="selectdemoSelectHeader his-md-select"  ng-model="row.entity.servicePriority" multiple="true" ng-required="row.entity.required" ><md-option ng-value="priority" ng-repeat="priority in grid.appScope.fm.servicePriorityList ">{{priority.gQDataName }}</md-option></md-select> </div>'},{name:"serviceValidFrom",enableSorting:!0,width:150,type:"date",cellFilter:"date:{{grid.appScope.fm.format}}",displayName:"billing.serviceValidityFrom",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{row.entity.serviceValidFrom |date:grid.appScope.fm.format}}</div> <div class="ui-grid-cell-contents his-datepicker-main" ng-if="row.entity.editable"><input  ng-required="row.entity.required" style="margin-top:-4px"  class="form-control" type="text"  readonly is-open="grid.appScope.fm.openedFrom[rowRenderIndex]" ng-change="grid.appScope.fm.serviceValidTo[rowRenderIndex].minDate=row.entity.serviceValidFrom;row.entity.serviceValidTo=row.entity.serviceValidFrom" ng-focus="grid.appScope.fm.openedTo[rowRenderIndex]=false;grid.appScope.fm.openedFrom[rowRenderIndex]=true"  show-button-bar="false" uib-datepicker-popup="{{grid.appScope.fm.format}}"  datepicker-options="grid.appScope.fm.fromDateOptions[rowRenderIndex]"  datepicker-append-to-body=true ng-model="row.entity.serviceValidFrom" /></div>'},{name:"serviceValidTo",enableSorting:!0,type:"date",cellFilter:"date:'{{grid.appScope.fm.format}}'",width:140,displayName:"billing.serviceValidityTo",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{row.entity.serviceValidTo|date:grid.appScope.fm.format}}</div> <div class="ui-grid-cell-contents his-datepicker-main" ng-if="row.entity.editable"><input style="margin-top: -4px;"  class="form-control" readonly type="text"  is-open="grid.appScope.fm.openedTo[rowRenderIndex]" ng-change="grid.appScope.fm.dateChange(row.entity)" ng-focus="grid.appScope.fm.openedFrom[rowRenderIndex]=false;grid.appScope.fm.openedTo[rowRenderIndex]=true"   show-button-bar="false" uib-datepicker-popup="{{grid.appScope.fm.format}}"  datepicker-options="grid.appScope.fm.serviceValidTo[rowRenderIndex]"  datepicker-append-to-body=true ng-model="row.entity.serviceValidTo" /></div>'},{name:"genderApplicability",enableSorting:!0,width:150,displayName:"billing.genderApplicability",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.genderApplicability"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.genderList" >                  <option value="">select</option>                </select> </div>'},{name:"billable",enableSorting:!0,displayName:"billing.billable",width:80,headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.billable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                  <option value="">select</option>                </select> </div>'},{name:"serviceDiscountApplicable",enableSorting:!0,width:200,displayName:"billing.serviceDiscountApplicable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select  style="margin-top: -4px;" class="form-control" ng-model="row.entity.serviceDiscountApplicable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                                 </select> </div>'},{name:"billWiseDiscountApplicable",enableSorting:!0,width:200,displayName:"billing.billWiseDiscountApplicable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.billWiseDiscountApplicable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                                 </select> </div>'},{name:"srCitizenDiscountApplicable",enableSorting:!0,width:220,displayName:"billing.srCitizenDiscountApplicable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select  style="margin-top: -4px;" class="form-control" ng-model="row.entity.srCitizenDiscountApplicable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                               </select> </div>'},{name:"depositRequired",enableSorting:!0,width:120,displayName:"billing.depositRequired",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.depositRequired"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                               </select> </div>'},{name:"rateEditable",enableSorting:!0,width:120,displayName:"billing.rateEditable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select  style="margin-top: -4px;" class="form-control" ng-model="row.entity.rateEditable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                                </select> </div>'},{name:"hospitalSurchargeApplicable",enableSorting:!0,width:200,displayName:"billing.hospitalSurchargeApplicable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select  style="margin-top: -4px;" class="form-control" ng-model="row.entity.hospitalSurchargeApplicable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                                  </select> </div>'},{name:"payerSurchargeApplicable",enableSorting:!0,width:200,displayName:"billing.payerSurchargeApplicable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.payerSurchargeApplicable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                                  </select> </div>'},{name:"cosmeticSurgery",enableSorting:!0,width:120,displayName:"billing.cosmeticSurgery",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div class="ui-grid-cell-contents" ng-if="row.entity.editable"  ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.cosmeticSurgery"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.cosmeticList" >                                  </select> </div>'},{name:"taxable",enableSorting:!0,width:100,displayName:"billing.taxable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div ng-if="row.entity.editable" class="ui-grid-cell-contents" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.taxable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >                   </select> </div>'},{name:"taxesApplicable",enableSorting:!0,width:120,displayName:"billing.taxType",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataSequence}}</div><div ng-if="row.entity.editable" class="ui-grid-cell-contents" ><select  style="margin-top: -4px;" class="form-control"  ng-model="row.entity.taxesApplicable"     ng-options="service  as service.gQDataSequence for service in grid.appScope.fm.taxList" ng-required="row.entity.required" ng-change="grid.appScope.fm.changeTax(row.entity)">                  <option value="">select</option>                </select> </div>'},{name:"taxPercentages",enableSorting:!0,width:120,displayName:"billing.taxPercentages",headerCellFilter:"translate"},{name:"associateRevenueCode",enableSorting:!0,width:170,displayName:"billing.associateRevenueCode",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div ng-if="row.entity.editable" class="ui-grid-cell-contents" ><select style="margin-top: -4px;"  class="form-control" ng-model="row.entity.associateRevenueCode"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" ng-change="(row.entity.associateRevenueCode.gQDataCode==2)?row.entity.revenueCode=\'\':\'\'"></select> </div>'},{name:"revenueCode",enableSorting:!0,width:120,type:"number",displayName:"billing.revenueCode",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD}}</div><div ng-if="row.entity.editable" class="ui-grid-cell-contents" ><input style="margin-top: -4px;"  numbers-only   type="text"  class="form-control" ng-model="row.entity.revenueCode" ng-required="row.entity.associateRevenueCode.gQDataCode==1 && row.entity.required" ng-disabled="row.entity.associateRevenueCode.gQDataCode==2"  > </div>'},{name:"schedulable",enableSorting:!0,width:120,displayName:"billing.schedulable",headerCellFilter:"translate",cellTemplate:'<div  ng-if="!row.entity.editable"  >{{COL_FIELD.gQDataName}}</div><div ng-if="row.entity.editable" class="ui-grid-cell-contents" ><select style="margin-top: -4px;"   class="form-control" ng-model="row.entity.schedulable"  ng-required="row.entity.required"   ng-options="service  as service.gQDataName for service in grid.appScope.fm.commonList" >               </select> </div>'},{name:"actions",enableSorting:!0,pinnedRight:!0,width:120,displayName:"billing.action",headerCellFilter:"translate",cellTemplate:'<div class="actionRow"><span ng-if="row.entity.gnStatus==1"><i ng-if="!row.entity.editable && grid.appScope.fm.permissionList.T_SCM_M_SERV_FAC_MAP_U" class="fa fa-pencil" ng-click="grid.appScope.fm.editGrid(row.entity,rowRenderIndex)" ></i><i ng-if="row.entity.editable && grid.appScope.fm.permissionList.T_SCM_M_SERV_FAC_MAP_U" class="glyphicon glyphicon-ok" ng-click="grid.appScope.fm.closeGrid(row.entity,rowRenderIndex)" ></i> </span><md-switch    ng-change="grid.appScope.fm.changeStatus(row.entity)" ng-disabled="!grid.appScope.fm.permissionList.T_SCM_M_SERV_FAC_MAP_U" ng-true-value="1" ng-false-value="2" ng-model="row.entity.gnStatus" class="md-primary actionSwitch wlabel" aria-label="Switch 1">{{ (row.entity.gnStatus==1)?"Active":"Inactive" }}</md-switch><span ng-click="grid.appScope.fm.removeData(row.entity)" ng-style="{ \'cursor\': \'pointer\' }"><i class="fa fa-times fa-lg" aria-hidden="true"></i></span></div>'}]})}(),function(){"use strict";function e(e,t){this.saveServiceMastersData=function(a){var i={};return i.url=e.HISIPINDENT.URL,i.requestData={operation:"saveServiceList",messageId:"",destination:"com.napier.core.scm.master.service.external.ScmMasterService",message:{"@class":"com.napier.core.scm.master.vo.ServiceListVo",serviceList:[{"com.napier.core.scm.master.vo.ServiceVo":a}]}},t.sendRestRequest(i)},this.uploadFile=function(e){var a={url:"HISServices/ScmMasterService"};return a.requestData={operation:"bulkUploadService",destination:"com.napier.core.scm.master.service.external.ScmMasterService",message:{"@class":"com.napier.core.scm.master.vo.ServiceVo",uploadFilePath:e}},t.sendRestRequest(a)},this.updateStatus=function(e){var a={url:"HISServices/ScmMasterServiceStatus"};return a.requestData={operation:"actionActiveOrInActive",destination:"com.napier.core.scm.master.service.external.ScmMasterService",message:{"@class":"com.napier.core.scm.master.vo.ServiceVo",gnTranStatus:e.gnStatus?e.gnStatus:e.gnTranStatus,servSeqId:e.servSeqId}},t.sendRestRequest(a)}}e.$inject=["IPINDENTAPIS","CallManager"],angular.module("napierContainerUi").service("serviceMastersCreationService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("servMasterItemCodeGridDefn",{enableCellEditOnFocus:!1,enableRowSelection:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,multiSelect:!1,enableFiltering:!1,enableSorting:!1,columnDefs:[{name:"SECDESC",displayName:"Primary Service Group",enableSorting:!0,enableCellEdit:!1},{name:"SPECIALITY",displayName:"Speciality",enableSorting:!0,enableCellEdit:!1},{name:"SUBDEPTNAME",displayName:"Department",enableSorting:!0,enableCellEdit:!1},{name:"SERV_NAME",displayName:"Service Item Name",enableSorting:!0,enableCellEdit:!1},{name:"SERV_CODE",displayName:"Service Item Code",enableSorting:!0,enableCellEdit:!1}]})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d){e.getTaskPermissions=void o.getTaskPermissionDetails("T_MAT_TAX_CODE").then(function(t){e.matTaxCodeNewRoleTaskValue=t}),c.loadModule("billing");var p=d.getLanguageToSet();function u(e,t){return e.filter(function(e){return e.TAX_CODE==t.TAX_CODE}).length>0}c.changeLanguage(p),e.saveMode=!0,e.updateMode=!1,e.updateDisable=!0,e.taxObj={},e.saleTaxList=[],e.IPsaleTaxList=[],e.purTaxList=[],e.OTCsaleTaxList=[],"update"==t.mode&&t&&t.rowData&&(e.saveMode=!1,e.updateMode=!0,t.rowData.entity.purchaseTaxDetailsArray.length>0&&(e.purTaxList=t.rowData.entity.purchaseTaxDetailsArray),t.rowData.entity.outPatientTaxDetailsArray.length>0&&(e.saleTaxList=t.rowData.entity.outPatientTaxDetailsArray),t.rowData.entity.otcTaxDetailsArray.length>0&&(e.OTCsaleTaxList=t.rowData.entity.otcTaxDetailsArray),t.rowData.entity.inPatientTaxDetailsArray.length>0&&(e.IPsaleTaxList=t.rowData.entity.inPatientTaxDetailsArray),e.taxObj.materialTaxCode=t.rowData.entity.matTaxCode,e.taxObj.taxCodeSeqID=t.rowData.entity.taxCodeSeqId),"DirectCreateTaxFromAddNewMat"==t.mode&&(e.taxObj.materialTaxCode=t.rowData.matTaxCode),e.dupCheckMaterialTaxCode=function(){e.taxObj&&e.taxObj.materialTaxCode&&a.dupCheckMaterialTaxCodeData(e.taxObj).then(function(t){if(t&&t[0]){var a=t[0].columnList[0]["com.napier.core.service.vo.query.Column"];if(a&&1==a.data)return e.taxObj.materialTaxCode="",n.failure("WARNING","Material Tax Code Already Exists."),!1}})},e.taxListValue=function(t){if(t.length>0){var a=[{paramName:"pFacilityId",value:"1"},{paramName:"pTaxCode",value:t+"%"}];return l.getList("GET_PURCHASE_AND_SALES_TAX_VALUES_FORM_MASTER",a).then(function(t){e.taxListVal=[];var a=s.getQryComboList(t);return angular.forEach(a,function(t,a){var i=t.columnList[0]["com.napier.core.service.vo.query.Column"],r={TAX_M_SEQ_ID:i[0].data,TAX_CODE:i[1].data,TAX_NAME:i[2].data,TAX_PERCENTAGE:i[4].data};e.taxListVal.push(r)}),(e.taxListVal instanceof Array?e.taxListVal:[e.taxListVal]).map(function(e){return e})})}},e.selectOnSuggestedpurtax=function(t){u(e.purTaxList,t)?n.warning("Warning","Already Exist."):(t.taxType=1,e.purTaxList.push(t),e.taxObj.purchaseTaxItem="")},e.deletepurTax=function(t){e.purTaxList.splice(t,1)},e.selectOnSuggestedsaletax=function(t){u(e.saleTaxList,t)?n.warning("Warning","Already Exist."):(t.taxType=2,e.saleTaxList.push(t),e.taxObj.outPatientTaxItem="")},e.deletesaleTax=function(t){e.saleTaxList.splice(t,1)},e.selectOnSuggestedOTCsaletax=function(t){u(e.OTCsaleTaxList,t)?n.warning("Warning","Already Exist."):(t.taxType=3,e.OTCsaleTaxList.push(t),e.taxObj.OTCTaxItem="")},e.deleteOTCsaleTax=function(t){e.OTCsaleTaxList.splice(t,1)},e.selectOnSuggestedIPsaletax=function(t){u(e.IPsaleTaxList,t)?n.warning("Warning","Already Exist."):(t.taxType=4,e.IPsaleTaxList.push(t),e.taxObj.IPTaxItem="")},e.deleteIPsaleTax=function(t){e.IPsaleTaxList.splice(t,1)},e.materialTaxCodePopupClose=function(){e.taxObj={},e.purTaxList=[],e.saleTaxList=[],e.OTCsaleTaxList=[],e.IPsaleTaxList=[],e.updateDisable=!0,r.dismissAll()},e.materialTaxCodeSave=function(t){return"update"==t&&(e.updateDisable=!1),e.taxObj&&!e.taxObj.materialTaxCode?(n.warning("Warning","Service Tax Code Is Required."),!1):0==e.purTaxList.length&&0==e.saleTaxList.length&&0==e.OTCsaleTaxList.length&&0==e.IPsaleTaxList.length?(n.warning("Warning","Please Select Atleast One Tax"),!1):void a.materialTaxCodeDetailsSave(t,e.taxObj,e.purTaxList,e.saleTaxList,e.OTCsaleTaxList,e.IPsaleTaxList,1).then(function(a){var r;"save"==t&&((r=a.data.HITService.message)&&r.errorCode?n.failure("FAILED",r.errorMessage):r?(i.close(r),n.success("SUCCESS","Service Tax Code Saved Successfully")):n.failure("FAILED"," Save Failed"));"update"==t&&((r=a.data.HITService.message)&&r.errorCode?n.failure("FAILED",r.errorMessage):r?(i.close(r),e.updateDisable=!0,n.success("SUCCESS","Service Tax code Updated Successfully")):n.failure("FAILED"," Update Failed"))})}}e.$inject=["$scope","data","materialTaxService","$uibModalInstance","$uibModalStack","hisAlertService","dropdownQueryService","otComService","taskPermissionService","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("countryCodecreNewMatTaxCodeCtrlr",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l){n.loadModule("billing");var s=l.getLanguageToSet();n.changeLanguage(s),this.serviceCostHistoryGrid={enableCellEditOnFocus:!1,enableRowSelection:!1,enableFullRowSelection:!1,enableGridMenu:!1,enableColumnMenus:!1,enableSelectionBatchEvent:!1,multiSelect:!1,enableFiltering:!1,enableSorting:!1,columnDefs:[{name:"SERV_RATE",displayName:"Service Cost",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1},{name:"EFFECTIVE_FROM",displayName:"billing.effectiveFrm",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,type:"date",cellFilter:"date:'dd-MM-yyyy'"},{name:"EFFECTIVE_TO",displayName:"billing.effectTo",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,type:"date",cellFilter:"date:'dd-MM-yyyy'"}]},e.cancel=function(){t.dismiss("cancel")},this.serviceCostHistoryGrid.data=[],this.serviceCostHistoryGrid.data=r.gridData}e.$inject=["$scope","$uibModalInstance","QueryService","servMasterItemCodeGridDefn","data","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("serviceCostHistoryCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n){var l=this;l.servMasterSearchgridOptions=angular.copy(i),e.cancel=function(){t.dismiss("cancel")},r.loadModule("billing");var s=n.getLanguageToSet();r.changeLanguage(s),e.init=function(){e.servMasterSrchObj={},l.primaryService=[],l.specialityList=[],l.departmentList=[];var t=a.executeQueryURLReset(),i={1:l.primaryService,2:l.specialityList},r=new Array;a.executeQueryInput("SCM_SECONDARY_SERVICE_GROUP_DROP_DOWN_QUERY",r,i,!0,!1,t,"popUp",{});var n=new Array;a.executeQueryInput("SCM_SPECIALITY_DROP_DOWN_QUERY",n,i,!0,!0,t,"popUp",{})},e.init(),l.chgSpecility=function(e){l.departmentList=[];var t={1:l.departmentList},i=a.executeQueryURLReset(),r=new Array;a.prepareParamList("1",e,r),a.executeQueryInput("SCMSPECIALITY_DROPDOWNQUERY_BASEDON_DEPT",r,t,!0,!0,i,"popUp",{})},l.servMasterSearchgridOptions.onRegisterApi=function(e){l.gridApiserCode=e,e.selection.on.rowSelectionChanged(l,function(e){e.isSelected})},e.getSearch=function(){if(console.log("$scope.servMasterSrchObj",e.servMasterSrchObj),e.servMasterSrchObj.primaryServiceGrp)var t=e.servMasterSrchObj.primaryServiceGrp;else t=-999;if(e.servMasterSrchObj.speciality)var i=e.servMasterSrchObj.speciality;else i=-999;if(e.servMasterSrchObj.dept)var r=e.servMasterSrchObj.dept;else r=-999;if(e.servMasterSrchObj.serItem)var n=e.servMasterSrchObj.serItem;else n="";l.getFacilityMastersList=[];var s={1:l.getFacilityMastersList},o=a.executeQueryURLReset(),c=new Array;a.prepareParamListWithParam("pPrimaryservice",t,c),a.prepareParamListWithParam("pSpecialityCode",i,c),a.prepareParamListWithParam("pDeptCode",r,c),a.prepareParamListWithParam("pServName",n,c),a.executeQueryInput("SCM_GET_SERVICES_MAPPING_001",c,s,!0,!0,o,"popUp",{}).then(function(e){console.log("ressss",e[1]),l.servMasterSearchgridOptions.data=e[1]})},e.clrsrh=function(){e.servMasterSrchObj={}},l.isSelected=!0,l.selectedRow=function(e){l.isSelected=!1,l.selectedRow=e,console.log("sermodalCtrl.selectedRow",l.selectedRow)},l.getSelectedRow=function(){l.rowsSelected=l.gridApiserCode.selection.getSelectedRows(),t.close(l.rowsSelected)}}e.$inject=["$scope","$uibModalInstance","QueryService","servMasterItemCodeGridDefn","hisTranslationsService","hisTranslationsGlobalLang"],angular.module("napierContainerUi").controller("servMasterSerItemModalCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m){e.loadModule("billing"),e.changeLanguage("en");var g=this;g.isOpen=!0,g.cancelDate=new Date,g.patientInput=JSON.parse(l.patObj),g.gridInput=JSON.parse(l.gridObj);for(var S=0;S<g.gridInput.length;S++)g.gridInput[S].effectiveRate=g.gridInput[S].actualRate;if(d.flg="true"==l.flag,d.flg1="true"==l.flag1,g.servicepostingPackageCancelGridDefinition=angular.copy(a),g.servicepostingPackageCancelGridDefinition.data=g.gridInput,s.getPatientBanner(g.patientInput,l.visitType).then(function(e){d.patientGlobalDtls=e,d.patientGlobalDtls.userPermision=12,null!=d.patientGlobalDtls.mrNo?d.patientShow=!0:d.patientShow=!1}),c.patientBannerDetail(g.patientInput.regSeqId).then(function(e){d.patientBannerDetails=e,d.patientRecordsDetail=d.patientBannerDetails.patientRecordsDetail}),g.servicepostingPackageCancelGridDefinition.onRegisterApi=function(e){d.getCancelServicePostsList=e,e.selection.on.rowSelectionChanged(d,function(e){d.selectBatchSelection=d.getCancelServicePostsList.selection.getSelectedRows(),1==d.selectBatchSelection.length?d.multiDoctorData():g.servicepostingPackageCancelGridDefinition.data.length>1&&(g.servicepostingServiceVariantCancelGridDefinition.data=[])})},g.servicepostingServiceVariantCancelGridDefinition=angular.copy(r),g.servicepostingServiceVariantCancelGridDefinition.data=[],d.servceVarientData=JSON.parse(l.gridObj),1==d.servceVarientData.length&&"Y"==d.servceVarientData[0].multiDoctor)for(S=0;S<d.servceVarientData.length;S++)for(var v=d.servceVarientData[S].multiEmployeeShareList.employeeShareList[0]["com.napier.core.scm.serviceposting.vo.EmployeeShareVo"],D=0;D<v.length;D++)2==v[D].entityType&&g.servicepostingServiceVariantCancelGridDefinition.data.push(v[D]);d.multiDoctorData=function(){if("Y"==d.selectBatchSelection[0].multiDoctor){g.servicepostingServiceVariantCancelGridDefinition.data=[];for(var e=0;e<d.servceVarientData.length;e++)if(d.selectBatchSelection[0].servCode==d.servceVarientData[e].servCode)for(var t=d.servceVarientData[e].multiEmployeeShareList.employeeShareList[0]["com.napier.core.scm.serviceposting.vo.EmployeeShareVo"],a=0;a<t.length;a++)2==t[a].entityType&&g.servicepostingServiceVariantCancelGridDefinition.data.push(t[a])}},g.servicepostingCancelServiceSearchGridDefinition=angular.copy(a),g.servicepostingCancelServiceSearchGridDefinition.data=angular.copy(n),g.servicepostingNewServiceSearchAddGridDefinition=angular.copy(i),g.open=function(e){t.open("",{animation:!0,templateUrl:"app/consumer/his17_1/common/CancelPackage/templates/service.posting.popupmodal.html",size:e,controller:"servicePostingPackageCnclCtrl",controllerAs:"svppC"})},g.cancelRecord=function(){var e=[],t=!1;if(!g.cancelReasonData)return m.warning("Warning","Please Fill Cancel Reason"),!1;if(angular.forEach(g.servicepostingPackageCancelGridDefinition.data,function(a,i){var r=angular.copy(a.servicePostingSeqId);if(!a.cancelRequestedRole&&!a.cancelRequestedBy)return m.warning("Warning","Please Fill Canceled By and Canceled Role"),t=!0,!1;if(!a.cancelRequestedRole)return m.warning("Warning","Please Fill Canceled Role"),t=!0,!1;var n=angular.copy(a.cancelRequestedRole.DETAIL_DESC);if(!a.cancelRequestedBy.name)return m.warning("Warning","Please Fill Canceled By"),t=!0,!1;var l=angular.copy(a.cancelRequestedBy.name);e.push({spSeqId:r,cnclRole:n,cnclBy:l}),1}),t)return!1;p.getServicePostingCacel(e,g.cancelReasonData).then(function(e){e.data.HITService.message?(m.success("Success","Package Cancelled Successfully"),u.go("index.billingSub.servicePosting",{patObj:JSON.stringify(g.patientInput),visitType:l.visitType})):m.warning("Warning","Cancel Request Not processed")})},g.populateEmployee=function(e,a){"cancelRequestedBy"!=e||a.cancelRequestedRole?(angular.extend(a,{role:e,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}),t.open("",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/service_posting/service-posting-New/templates/service.posting.popupmodal.employee.html",size:"lg",controller:"servicePostingNewEmpModalController",controllerAs:"svpNE",resolve:{serviceDetails:angular.copy(a)}}).result.then(function(t){var i=g.servicepostingPackageCancelGridDefinition.data.indexOf(a);g.servicepostingPackageCancelGridDefinition.data[i][e]={name:t.EMP_NAME,seqId:t.STAFF_ID,code:t.CODE,firstName:t.FIRSTNAME,lastName:t.LASTNAME,salutation:t.SALUTATION,gender:t.GENDER,category:t.CATEGORY,designation:t.DESIGNATION,regdNo:t.REGDNO,gnStatus:t.GN_STATUS}})):m.warning("Warning","Please Select Canceled Role")},g.close=function(){u.go("index.billingSub.servicePosting",{patObj:JSON.stringify(g.patientInput),visitType:l.visitType})},g.patientDetails=angular.copy(angular.fromJson(l.patObj)),g.visitType=angular.copy(g.patientDetails.visitType),function(){g.roles=[],g.roleList={1:g.roles};var e=o.executeQueryURLReset();g.servRoleList=new Array,o.prepareParamListWithParam("pMasterSqId",104,g.servRoleList),o.prepareParamListWithParam("pType",g.patientDetails.typeOfReg.code,g.servRoleList),o.executeQueryInput("GET_CALLED_BY_ROLE",g.servRoleList,g.roleList,!0,!0,e,"popUp",g.servicepostingServiceVariantCancelGridDefinition)}()}e.$inject=["hisTranslationsService","hisModalService","servicepostingPackageCancelGridDefinition","servicepostingNewServiceSearchAddGridDefinition","servicepostingServiceVariantCancelGridDefinition","srchSerivceData","$stateParams","PatientBannerGlobal","QueryService","PatientBannerBilling","$scope","ServicePostingCancel","$state","hisAlertService"],angular.module("napierContainerUi").controller("servicePostingPackageCnclCtrl",e)}(),function(){"use strict";function e(e,t){e.openAlleries=function(e){sessionStorage.setItem("allergyFlagStatus",angular.toJson({allergyFlag:"true"}));t.open("Allergies",{animation:!0,templateUrl:"app/consumer/his17_1/EMR/allergies/allergies.component.html",size:e,controller:"dcAllergiesController"})}}e.$inject=["$scope","hisModalService"],angular.module("napierContainerUi").controller("allergyPopUpController",e)}(),function(){"use strict";angular.module("napierContainerUi").service("GetDocumentCommon",["CallManager","IPINDENTAPIS",function(e,t){this.getDocFile=function(a,i){var r={};r.url=t.HISIPINDENT.URL,r.requestData={operation:"getDocument",messageId:"",destination:"com.napier.core.fileupload.service.external.FileUploadService",message:{"@class":"com.napier.core.service.vo.uploadfile.DocumentSearch",context:1,contextDetail:1,entityId:a,primaryEntityId:a,subContextId:1}},e.sendRestRequest(r).then(function(e){if(null!=e.data.HITService.message.napierDocumentList[0]&&null!=e.data.HITService.message.napierDocumentList[0]&&""!=e.data.HITService.message.napierDocumentList[0]){var t=e.data.HITService.message.napierDocumentList[0]["com.napier.core.service.vo.uploadfile.NapierDocument"];null!=t.uploadDocumnt&&null!=t.uploadDocumnt[0]&&null!=t.uploadDocumnt[0]&&""!=t.uploadDocumnt[0]?i.upldDocUrl="data:image/jpeg;base64,"+t.uploadDocumnt[0]:null!=i.patientRecordsDetail&&null!=i.patientRecordsDetail.sex&&"001"==i.patientRecordsDetail.sex.code?i.upldDocUrl="assets/user-avatar-male.jpg":(null!=i.patientRecordsDetail&&null!=i.patientRecordsDetail.sex&&i.patientRecordsDetail.sex.code,i.upldDocUrl="assets/user-avatar-male.jpg")}else null!=i.patientRecordsDetail&&null!=i.patientRecordsDetail.sex&&"001"==i.patientRecordsDetail.sex.code?i.upldDocUrl="assets/user-avatar-male.jpg":null!=i.patientRecordsDetail&&null!=i.patientRecordsDetail.sex&&"002"==i.patientRecordsDetail.sex.code?i.upldDocUrl="assets/user-avatar-female.jpg":i.upldDocUrl="assets/user-avatar-unknown.jpg"})}}])}(),function(){"use strict";angular.module("napierContainerUi").service("PatientGlobal",["PatientSrchService",function(e){var t=function(t,a){return t.length>1&&e.patientSearch(t,a).then(function(e){if(null!=e.data.HITService.message.patientSearchResponsesList){var t=e.data.HITService.message.patientSearchResponsesList[0]["com.napier.core.service.vo.patientsearch.PatientSearchResponse"],a=null!=t?Array.isArray(t)?t:[t]:null;return null==a?a:a.map(function(e){return e})}return!1})};this.paitentAutoSearchWithStatus=function(e,a){return t(e,a)},this.paitentAutoSearchWithOutStatus=function(e){return t(e,3).then(function(a){return null==a?t(e,1):a})}}])}(),function(){"use strict";angular.module("napierContainerUi").service("PatientSrchService",["CallManager","IPINDENTAPIS",function(e,t){this.patientSearch=function(a,i){var r={};return r.url=t.HISIPINDENT.URL,r.requestData={operation:"getPatientSearchDetails",messageId:"",destination:"com.napier.core.patientsearch.service.external.PatientSearchService",message:{"@class":"com.napier.core.service.vo.patientsearch.PatientSearchRequest",context:1==i?3:1,facilityId:{"@class":"com.napier.core.service.vo.masters.FacilityMaster",code:JSON.parse(sessionStorage.userContextObj).FACILITY_CODE},mrNo:a}},e.sendRestRequest(r)}}])}(),function(){"use strict";angular.module("napierContainerUi").constant("servicePostingGridDefinition",{enableSorting:!0,enableCellEditOnFocus:!1,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,showGridFooter:!1,showColumnFooter:!0,paginationPageSize:10,useExternalSorting:!1,enableColumnMenus:!0})}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C,I,A,E,h){d.loadModule("billing");var b=C.getLanguageToSet();d.changeLanguage(b);var T=this;T.isPackageExist=!1,T.format=angular.copy(t.uibDateOnly.format),T.alertObj={},I.loadAlerts(b).then(function(e){T.alertObj=e,T.alertData={buttonText:T.alertObj.ok},T.alertFunction={buttonCallBack1:function(){}},T.buttonClose={buttonClose:function(){}}}),T.oneAtATime=!1,T.grandCal={},n.test=0,T.toBeAdjusted=0,n.corporateAmtFlag=0,n.test=!1,n.totalService=0,n.patientAmt=0,n.copayAmount=0,n.generateBillFalg=!1;var L,P=JSON.parse(m.allObj);function O(e){i.getBillServicePostingData(P).then(function(t){if(null==t.data.HITService.message.servicePostingDetailsList){var i={buttonText:T.alertObj.ok},r=T.alertObj.noRcrdFound;y.hisAlertMulti("information",T.alertObj.alertTypeInfo,r,i,{buttonCallBack1:function(){}},{buttonClose:function(){}})}else{T.deductCheck=!0;var l=t.data.HITService.message.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"];if(T.serviceObj=angular.copy(t.data.HITService.message),T.serviceObj["@class"]="com.napier.core.scm.serviceposting.vo.ServicePostingVo",u.gridDataService(l,n.serviceGridOptions,n.packageGridOptions,T,n),e?n.corporateAmt<T.grandCal.billedAmt?n.patientAmt=T.grandCal.billedAmt-n.corporateAmt:n.corporateAmt>T.grandCal.billedAmt?n.patientAmt=0:n.corporateAmt==T.grandCal.billedAmt&&(n.patientAmt=0):(n.corporateAmt=0,n.patientAmt=T.grandCal.billedAmt),L=null==l[0]?l.accSeqId:l[0].accSeqId,T.patientDeduAmt=angular.copy(n.patientAmt),T.CorpDeduAmt=angular.copy(n.corporateAmt),n.patientGlobalDtls.insurancePlanSeqId){var s=[],o={1:T.deductibleList=[]},c=a.executeQueryURLReset(),d=null==l[0]?l.subAccSeqId:l[0].subAccSeqId;a.prepareParamListWithParam("pSubAccSeqId",d,s),a.prepareParamListWithParam("pPlanSeqId",n.patientGlobalDtls.insurancePlanSeqId,s),a.executeQueryInput("BL_GET_DEDUCTABLE_AMOUNT",s,o,!0,!0,c,"popUp",{}).then(function(e){e[1][0]?(T.deductibleAmount=T.deductibleList[0].DEDUCTABLE_VALUE,T.deductibleType=T.deductibleList[0].TYPE,"Payer"==T.deductibleType&&(T.deductCheck=!1),T.changeDeductible()):(T.deductibleAmount=0,T.deductCheck=!0)})}else T.deductibleAmount=0,T.deductCheck=!0;g.getDeposit(L).then(function(e){var t=e.data.HITService.message.deposits[0]["com.napier.core.service.vo.deposits.DepositsVo"];u.gridDataDeposit(t,n.depositGridOptions,T)})}})}n.serviceGridOptions=angular.copy(e),n.packageGridOptions=angular.copy(S),n.depositGridOptions=angular.copy(S),p.getColumnDefAll(n.serviceGridOptions,s),p.packageColDef(n.packageGridOptions,s),p.depositColDef(n.depositGridOptions,s),n.serviceGridOptions.data=[],n.packageGridOptions.data=[],n.depositGridOptions.data=[],n.serviceGridOptions.onRegisterApi=function(e){n.gridApi=e,e.edit.on.afterCellEdit(n,function(e,t,a,i,r){"companyPayingAmt"==t.name?(null!=a&&""!=a||(a=0,e.companyPayingAmt=0),null==e.companyNonPayingAmt&&(e.companyNonPayingAmt=0),n.corporateAmt=n.corporateAmt-parseFloat(i),n.patientAmt=n.patientAmt-parseFloat(e.companyNonPayingAmt),e.companyNonPayingAmt=e.actualRate-parseFloat(a),n.corporateAmt=n.corporateAmt+parseFloat(a),n.patientAmt=n.patientAmt+parseFloat(e.companyNonPayingAmt)):"companyNonPayingAmt"==t.name&&(null!=a&&""!=a||(a=0,e.companyNonPayingAmt=0),n.corporateAmt=n.corporateAmt-parseFloat(e.companyPayingAmt),n.patientAmt=n.patientAmt-parseFloat(i),e.companyPayingAmt=e.actualRate-parseFloat(a),n.patientAmt=n.patientAmt+parseFloat(a),n.corporateAmt=n.corporateAmt+parseFloat(e.companyPayingAmt)),n.patientAmt=parseFloat(n.patientAmt.toFixed(2)),n.corporateAmt=parseFloat(n.corporateAmt.toFixed(2)),T.patientDeduAmt=angular.copy(n.patientAmt),T.CorpDeduAmt=angular.copy(n.corporateAmt)})},n.packageGridOptions.onRegisterApi=function(e){n.gridApiD=e,e.edit.on.afterCellEdit(n,function(e,t,a,i){if("discountAmt"==t.name){var r=0,l=0;r=null!=a&&""!=a?a:0,l=null!=i&&""!=a?i:0,T.grandCal.discAmt=T.grandCal.discAmt-parseFloat(l),T.grandCal.discAmt=T.grandCal.discAmt+parseFloat(r),parseFloat(l),parseFloat(r),T.grandCal.totalAmnt=T.grandCal.totalAmnt+parseFloat(l),T.grandCal.totalAmnt=T.grandCal.totalAmnt-parseFloat(r),T.grandCal.billedAmt=T.grandCal.billedAmt+parseFloat(l),T.grandCal.billedAmt=T.grandCal.billedAmt-parseFloat(r),T.grandCal.roundAmt=T.grandCal.roundAmt+parseFloat(l),T.grandCal.roundAmt=T.grandCal.roundAmt-parseFloat(r),n.patientAmt>0?(n.patientAmt=n.patientAmt+parseFloat(l),n.patientAmt=n.patientAmt-parseFloat(r)):n.corporateAmt>0&&(n.corporateAmt=n.corporateAmt+parseFloat(l),n.corporateAmt=n.corporateAmt-parseFloat(r)),n.patientAmt=parseFloat(n.patientAmt.toFixed(2)),n.corporateAmt=parseFloat(n.corporateAmt.toFixed(2)),null!=e.taxPercent&&null!=e.taxPercent&&""!==e.taxPercent||(e.taxPercent=0);var s=((e.serviceRate-parseFloat(r))*e.taxPercent).toFixed(2)/100;null!=e.taxAmt&&""!==e.taxAmt&&(T.grandCal.totalAmnt=T.grandCal.totalAmnt-e.taxAmt,T.grandCal.billedAmt=T.grandCal.billedAmt-e.taxAmt,T.grandCal.roundAmt=T.grandCal.roundAmt-e.taxAmt,T.grandCal.totalTax=T.grandCal.totalTax-e.taxAmt,n.patientAmt>0?n.patientAmt=n.patientAmt-parseFloat(e.taxAmt):n.corporateAmt>0&&(n.corporateAmt=n.corporateAmt-parseFloat(e.taxAmt))),e.taxAmt=parseFloat(s),null!=e.taxAmt&&""!==e.taxAmt&&(T.grandCal.totalAmnt=T.grandCal.totalAmnt+e.taxAmt,T.grandCal.billedAmt=T.grandCal.billedAmt+e.taxAmt,T.grandCal.roundAmt=T.grandCal.roundAmt+e.taxAmt,T.grandCal.totalTax=T.grandCal.totalTax+e.taxAmt,n.patientAmt>0?n.patientAmt=n.patientAmt+parseFloat(e.taxAmt):n.corporateAmt>0&&(n.corporateAmt=n.corporateAmt+parseFloat(e.taxAmt))),e.packNetAmt=parseFloat((e.serviceRate-parseFloat(r)+e.taxAmt).toFixed(2)),null!=e.companyPayingAmt&&e.companyPayingAmt>0?e.packNetAmt<parseFloat(e.companyPayingAmt)?(e.companyNonPayingAmt=0,e.companyPayingAmt=parseFloat(e.packNetAmt)):e.companyNonPayingAmt=parseFloat(e.packNetAmt-parseFloat(e.companyPayingAmt)):e.companyNonPayingAmt=parseFloat(e.packNetAmt)}})},T.searchResult=function(){T.serviceStatus=[],T.servicePriority=[],T.folio=[],T.multipleComboDataForList={1:T.serviceStatus,2:T.servicePriority};var e=a.executeQueryURLReset();T.serviceStatusList=new Array,a.prepareParamList(1,"45002",T.serviceStatusList),a.executeQueryInput("TRN003",T.serviceStatusList,T.multipleComboDataForList,!0,!1,e,"popUp"),T.servicePriorityList=new Array,a.executeQueryInput("PRIORITY_TYPE",T.servicePriorityList,T.multipleComboDataForList,!0,!0,e,"popUp"),T.docRes=[],T.multipleComboDoc={1:T.docRes};var t=a.executeQueryURLReset();T.docResList=new Array,a.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,T.docResList),a.executeQueryInput("NHIS_ADT_TR_052",T.docResList,T.multipleComboDoc,!0,!0,t,"popUp",n.depositGridOptions),T.billDtls=[],T.multipleValue={1:T.billDtls};var i=a.executeQueryURLReset();T.billDtlsList=new Array,a.prepareParamListWithParam("pAdmSeqID",P.patientInput.admissionSeqid,T.billDtlsList),a.prepareParamListWithParam("pCurrDate",r("date")(new Date,"yyyy-MM-dd"),T.billDtlsList),a.executeQueryInput("BL_M_COMMON_001",T.billDtlsList,T.multipleValue,!0,!0,i,"popUp",n.depositGridOptions).then(function(e){4!=T.billDtls[0].CHECK_FOR?(T.payerFlag=T.billDtls[0].CHECK_FOR,O(!0)):O(!1),T.payerCheck=[],T.multipleComboPayer={1:T.payerCheck};var t=a.executeQueryURLReset();T.payerCheckList=new Array,a.prepareParamListWithParam("pPatCatgCode",T.billDtls[0].PAT_CATG_CODE,T.payerCheckList),a.prepareParamListWithParam("pPatseqid",T.billDtls[0].RG_SEQ_ID,T.payerCheckList),a.prepareParamListWithParam("pFacilityID",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,T.payerCheckList),a.prepareParamListWithParam("pPracticeID",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,T.payerCheckList),a.executeQueryInput("NHIS_RG_TR_003",T.payerCheckList,T.multipleComboPayer,!0,!0,t,"popUp",n.depositGridOptions)})},n.zero=0,n.adjustAmountTotal=function(e,t){e.entity.adjustamtTotal<0?e.entity.adjustamtTotal=0:e.entity.adjustamtTotal>e.entity.availableAmount?e.entity.adjustamtTotal=parseFloat(e.entity.availableAmount.toFixed(2)):e.entity.adjustamtTotal=parseFloat(e.entity.adjustamtTotal.toFixed(2))},n.valueCheck=function(e){e.entity.discountAmt>e.entity.actualRate?e.entity.discountAmt=e.entity.actualRate:null==e.entity.discountAmt||null==e.entity.discountAmt||""===e.entity.discountAmt||e.entity.discountAmt<=0?e.entity.discountAmt=null:e.entity.discountAmt=e.entity.discountAmt},T.grandCal.adjAmt=0,T.adjustAmount=function(e){if(n.patientAmt=parseFloat((parseFloat(T.grandCal.totalAmnt)-n.corporateAmt).toFixed(2)),T.grandCal.adjAmt=e,null!=n.bAmt)T.grandCal.billedAmt=parseFloat((parseFloat(T.grandCal.totalAmnt)-n.bAmt).toFixed(2));else{if(parseFloat(T.grandCal.totalAmnt)<parseFloat(T.grandCal.adjAmt)){T.grandCal.adjAmt=0;var t={buttonText:T.alertObj.ok},a={buttonCallBack1:function(){}},i={buttonClose:function(){}},r=T.alertObj.adjAmtCntBilAmt;y.hisAlertMulti("warning",T.alertObj.alertTypeWarn,r,t,a,i)}else if(n.patientAmt<parseFloat(T.grandCal.adjAmt)){T.grandCal.adjAmt=0;t={buttonText:T.alertObj.ok},a={buttonCallBack1:function(){}},i={buttonClose:function(){}},r=T.alertObj.adjAmtCntPatAmt;y.hisAlertMulti("warning",T.alertObj.alertTypeWarn,r,t,a,i)}else T.grandCal.billedAmt=parseFloat((parseFloat(T.grandCal.totalAmnt)-parseFloat(T.grandCal.adjAmt)).toFixed(2));T.grandCal.billedAmt==n.corporateAmt?n.patientAmt=0:n.patientAmt=parseFloat((T.grandCal.billedAmt-n.corporateAmt).toFixed(2))}T.grandCal.roundAmt=T.grandCal.billedAmt,n.depositGridOptionsTemp=angular.copy(n.depositGridOptions),n.depositGridOptionsTemp.data=[];for(var l=0;l<n.depositGridOptions.data.length;l++)null!=n.depositGridOptions.data[l].adjustamtTotal&&parseFloat(n.depositGridOptions.data[l].adjustamtTotal)>0&&n.depositGridOptionsTemp.data.push(n.depositGridOptions.data[l])},n.changeCPAmt=function(e,t,a){e.entity.companyPayingAmt>e.entity.actualRate?e.entity.companyPayingAmt=e.entity.actualRate:e.entity.companyPayingAmt=e.entity.companyPayingAmt},n.changeCNPAmt=function(e,t,a){e.entity.companyNonPayingAmt>e.entity.actualRate?e.entity.companyNonPayingAmt=e.entity.actualRate:e.entity.companyNonPayingAmt=e.entity.companyNonPayingAmt},n.enableEdit=function(e,t,a){null!=e.entity.companyPayingAmt&&null!=e.entity.companyPayingAmt?(e.entity.enableCellEdit=!0,e.entity.enableCellEditOnFocus=!0):(e.entity.enableCellEdit=!1,e.entity.enableCellEditOnFocus=!1)},n.changeNumber=function(e,t,a){if(e.entity.packNumber<=0)e.entity.packNumber=null;else if(parseFloat(e.entity.packNumber)>n.packageGridOptions.data.length)e.entity.packNumber=null;else for(var i=0;i<n.packageGridOptions.data.length;i++)if(i==a)e.entity.packNumber=e.entity.packNumber;else{if(n.packageGridOptions.data[i].packNumber==e.entity.packNumber)return e.entity.packNumber=null,e.entity.packNumber;if(i==n.packageGridOptions.data.length-1)return e.entity.packNumber=e.entity.packNumber,e.entity.packNumber}},T.clearanceBillGen=function(){if(T.billNoForPrint="",null!=T.dischargeCheck&&T.dischargeCheck.length>0){var e=[],t={1:e},i=a.executeQueryURLReset(),r=new Array,l=angular.fromJson(sessionStorage.userContextObj).spLocation.LOC_SEQ_ID;a.prepareParamList(1,l||-999,r),a.prepareParamList(2,l||-999,r),a.prepareParamList(3,"",r),a.prepareParamList(4,"",r),a.prepareParamList(5,"1800-01-01 00:00:00",r),a.prepareParamList(6,"9999-01-01 00:00:00",r),a.prepareParamList(7,"1800-01-01 00:00:00",r),a.prepareParamList(8,"9999-01-01 00:00:00",r),a.prepareParamList(9,n.patientGlobalDtls.ipNo?n.patientGlobalDtls.ipNo:"",r),a.prepareParamList(11,"",r),a.prepareParamList(13,"",r),a.prepareParamList(15,"",r),a.prepareParamList(17,"",r),a.executeQueryInput("NHIS_IP_LOCATION_WISE_CLEARANCE_DATA",r,t,!0,!0,i,"popUp",!0).then(function(t){if(e.length>0&&null!=e[0]){var a=moment(e[0].AdivcedateTime).format("DD-MM-YYYY HH:mm"),i=moment(e[0].EXPECTED_DISCH_DATE).format("DD-MM-YYYY HH:mm"),r={ipNo:e[0].IP_NO,ipSeqid:e[0].IPADM_SEQ_ID,patName:e[0].PAT_NAME,age:e[0].AGE,gender:e[0].GENDER,disStatus:e[0].DS_STATUS,disposition:e[0].DISCH_DISPO,adviceDate:a,ipdaSeqId:e[0].IPDA_SEQ_ID,advicetoIntimationTime:e[0].AdvToInt,intimationtoDepts:e[0].AdvTodeptclear,intimationToFinaclearanceTime:e[0].deptToFinClr,financialToDischargeTime:e[0].FinclrToDis,disTAT:e[0].DISCH_TAT,admittedDocName:e[0].ADM_DOC_NAME,adviceDocName:e[0].ADV_DOC_NAME,disType:e[0].DISCH_TYPE,expDiscDate:i,location:e[0].LOCATION,disCriteria:e[0].DISCH_CRITERIA,disIntimationStatus:e[0].DISCHARGE_STATUS,disValue:e[0].GN_TRAN_STATUS,partialClearance:e[0].PARTIAL_CLEARANCE_GIVEN,rgSeqId:e[0].RG_SEQ_ID,admittedDocSeqId:e[0].ADM_DOC_SEQ_ID,disTypeId:e[0].GN_DISCH_TYPE,disDispositionId:e[0].GN_DISCH_DESTINATION,clearance:e[0].IS_CLEARANCE_GIVEN,episodeSeq:e[0].EP_SEQ_ID};sessionStorage.patientArrDetails&&delete sessionStorage.patientArrDetails,sessionStorage.setItem("adviceRowData",JSON.stringify(r)),c.go("index.billingSub.billingDischargeInitmationTemplateView")}else y.hisAlertMulti("warning",T.alertObj.alertTypeWarn,T.alertObj.discAdvRaisdSlctPat,T.alertData,T.alertFunction,T.close)})}else y.hisAlertMulti("warning",T.alertObj.alertTypeWarn,T.alertObj.discAdvRaisdSlctPat,T.alertData,T.alertFunction,T.close)},T.generateBill=function(){if(n.generateBillFalg=!0,0!=T.dischargeCheck.length)if(T.billNoForPrint="",null!=T.clearanceStatus&&"Y"==T.clearanceStatus){var e=D.saveBillService(n.serviceGridOptions,n.packageGridOptions,T.billDtls,T),t=null!=n.depositGridOptionsTemp?n.depositGridOptionsTemp:n.depositGridOptions,a=D.saveParamObject(t,n,T,e);let s=function(){v.generateBillService(e,a,T,P,L,T.billDtls,P.visitType,n,P.patientInput.admissionSeqid).then(function(e){var t={buttonClose:function(){c.go("index.billingSub.BillingWorkList")}};if("HSC"!=sessionStorage.productCustomization)var a="",i={buttonText:T.alertObj.ok},r={buttonCallBack1:function(){c.go("index.billingSub.BillingWorkList")}};else a="Do you want to Print?",i={buttonText:T.alertObj.yes,buttonText2:T.alertObj.no},r={buttonCallBack1:function(){T.showBillPrintOptions(T.billNoForPrint)},buttonCallBack2:function(){c.go("index.billingSub.BillingWorkList")}};if(null!=e.data.HITService.message.billingList){let n=e.data.HITService.message.billingList[0]["com.napier.core.billgeneration.vo.Bill"],l="",s=[];if(n instanceof Array)for(let e=0;e<n.length;e++)l+=n[e].billNo,s.push(n[e].billNo),e!=n.length-1&&(l+=", ");else l=n[0]?n[0]["com.napier.core.billgeneration.vo.Bill"].billNo:n.billNo,s.push(l);T.billNoForPrint=l;a=T.alertObj.bilGenSuccssfuly+" "+l+" . "+a;"HSC"==sessionStorage.productCustomization?T.showBillPrintOptionsForMulti(s):y.hisAlertMulti("success",T.alertObj.alertTypeSucss,a,i,r,t)}else e.data.HITService.message&&e.data.HITService.message.errorCode&&y.hisAlertMulti("warning",T.alertObj.alertTypeWarn,e.data.HITService.message.errorMessage,T.alertData,T.alertFunction,T.close)})};if(parseFloat(T.grandCal.adjAmt)>0||0==n.depositGridOptions.data.length)s();else{var i={buttonText:T.alertObj.yes,buttonText2:T.alertObj.no},r={buttonCallBack1:function(){n.generateBillFalg=!1},buttonCallBack2:function(){n.generateBillFalg=!1,s()}},l={buttonClose:function(){n.generateBillFalg=!1}};y.hisAlertMulti("information",T.alertObj.alertTypeConf,T.alertObj.depAmtAvlWntAdjAmt,i,r,l)}}else y.warning("Warning","Clearance Required For <b>"+T.clearanceStatusList+"</b>",!1,!1,h.time),n.generateBillFalg=!1;else y.hisAlertMulti("warning",T.alertObj.alertTypeWarn,T.alertObj.discAdvRaisdSlctPat,T.alertData,T.alertFunction,T.close)},n.exitPopUp=function(){c.go("index.billingSub.BillingWorkList")},T.showBillPrintOptionsForMulti=function(e){T.BillData=[],T.BillDataList={1:T.BillData};var t=a.executeQueryURLReset();T.billDetailsValues=new Array,a.prepareParamListWithParam("pMasterSqId","700411",T.billDetailsValues),a.executeQueryInput("TRN003",T.billDetailsValues,T.BillDataList,!0,!0,t,"popUp",{}).then(function(e){var t=e[1];t&&(n.BillTypeData=t,n.billType=n.BillTypeData[0])});n.PrintTypeData=[{code:1,desc:"PDF"}],n.printType=n.PrintTypeData[0];var i=e;n.BillNumberData=i,n.billNumber=n.BillNumberData[0];var r="";angular.forEach(i,function(e,t){r=r+" & "+e}),r=r.substring(2,r.length),n.message="Bill Generation Successful "+r+". Do you want to print?",E.open("Bill Generation",{animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",windowClass:"bill-print-model-popups",templateUrl:"app/consumer/his17_1/opVisitManagement/screens/opVisitManagement/templates/op-visit-mgt-multi-bill-print.html",size:"sm",scope:n}).closed.then(function(){c.go("index.billingSub.BillingWorkList")})},T.showBillPrintOptions=function(e){T.billNoData=e;T.BillData=[],T.BillDataList={1:T.BillData};var t=a.executeQueryURLReset();T.billDetailsValues=new Array,a.prepareParamListWithParam("pMasterSqId","700411",T.billDetailsValues),a.executeQueryInput("TRN003",T.billDetailsValues,T.BillDataList,!0,!0,t,"popUp",{}).then(function(e){var t=e[1];t&&(n.BillTypeData=t,n.billType=n.BillTypeData[0])}),T.patCatData=[],T.patCatDataList={1:T.patCatData};t=a.executeQueryURLReset();T.patCatDetailsValues=new Array,a.prepareParamListWithParam("pBillNo",e,T.patCatDetailsValues),a.executeQueryInput("BILL_PRINT_FOR_PAT_CATEGORY",T.patCatDetailsValues,T.patCatDataList,!0,!0,t,"popUp",{}).then(function(e){var t=e[1];t&&(T.patCatCode=t[0].CODE,T.patCatPayer=t[0].PAYER_NAME)});n.PrintTypeData=[{code:1,desc:"PDF"}],n.printType=n.PrintTypeData[0],E.open("Bill Print",{animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",windowClass:"bill-print-model-popups",templateUrl:"app/consumer/his17_1/opVisitManagement/screens/opVisitManagement/templates/op-visit-mgt-bill-print.html",size:"sm",scope:n})},n.generateBillPrintReportType=function(e,t,a){a&&(T.billNoData=a);var i=A.getPrintData(T.patCatCode,T.billNoData,t,e,T.patCatPayer);n.generateBillPrintReport(i)},n.generateBillPrintReport=function(e){f.printReportModal("printBillCtrl","lg","PDF",e)};var R={patientInput:P.patientInput,folioSeqId:P.folioDtls.gQDataSequence};T.billPrint=function(){R.reportId="BillingPostingSheetReceiptReport";let e=[];for(var t=0;t<n.serviceGridResult.length;t++)null!=n.serviceGridResult[t].packApplyType&&2!=n.serviceGridResult[t].packApplyType&&(n.serviceGridResult[t].servCode=n.serviceGridResult[t].servCode,n.serviceGridResult[t].servName=n.serviceGridResult[t].servName,n.serviceGridResult[t].chargeableAmt=3==n.serviceGridResult[t].packApplyType?n.serviceGridResult[t].chargeableAmt+(null!=n.serviceGridResult[t].taxAmt&&""!==n.serviceGridResult[t].taxAmt?n.serviceGridResult[t].taxAmt:parseInt(0)):n.serviceGridResult[t].chargeableAmt,e.push(n.serviceGridResult[t]));R.serviceListString=e,f.printReportModal("printPostingSheetController","lg","PDF",R)},T.close=function(){c.go("index.billingSub.servicePosting",{patObj:JSON.stringify(P.patientInput),visitType:P.visitType})},T.changeDeductible=function(){if(T.deductibleAmount=T.deductibleAmount?T.deductibleAmount:0,T.CorpDeduAmt<=parseFloat(T.deductibleAmount))return T.deductibleAmount=T.CorpDeduAmt,n.corporateAmt=0,n.patientAmt=parseFloat(angular.copy(T.patientDeduAmt+parseFloat(T.deductibleAmount)).toFixed(2)),n.patientAmt=parseFloat(n.patientAmt.toFixed(2)),n.corporateAmt=parseFloat(n.corporateAmt.toFixed(2)),void(T.deductibleAmount=parseFloat(T.deductibleAmount));T.grandCal.billedAmt>=T.deductibleAmount&&(n.corporateAmt=parseFloat(angular.copy(T.CorpDeduAmt-parseFloat(T.deductibleAmount)).toFixed(2)),n.patientAmt=parseFloat(angular.copy(T.patientDeduAmt+parseFloat(T.deductibleAmount)).toFixed(2))),n.patientAmt=parseFloat(n.patientAmt.toFixed(2)),n.corporateAmt=parseFloat(n.corporateAmt.toFixed(2)),T.deductibleAmount=parseFloat(T.deductibleAmount)},l.getPatientBanner(P.patientInput,P.visitType).then(function(e){var t,i,r;n.patientGlobalDtls=e,n.patientGlobalDtls.userPermision=12,P.patientGlobalDtls=e,null!=n.patientGlobalDtls.mrNo?n.patientShow=!0:n.patientShow=!1,t={1:T.crNoteDataList=[]},i=a.executeQueryURLReset(),r=new Array,a.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,r),a.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,r),a.prepareParamListWithParam("pFromDate","1800-01-01",r),a.prepareParamListWithParam("pToDate","9999-12-30",r),a.prepareParamListWithParam("pFirstName","",r),a.prepareParamListWithParam("pScrollStatus","",r),a.prepareParamListWithParam("pPaymentStatus","",r),a.prepareParamListWithParam("pPatientId",P.patientInput.mrNo,r),a.prepareParamListWithParam("pRefType","",r),a.prepareParamListWithParam("pIpNo","",r),a.executeQueryInput("BL_CREDIT_NOTE_001",r,t,!0,!0,i,"popUp",{}).then(function(e){if(e[1]&&e[1][0]&&T.crNoteDataList.length>0)for(var t=0;t<T.crNoteDataList.length;t++){var a={type:"Credit Note",typeId:2,deptranDate:{$:T.crNoteDataList[t].CR_NOTE_DATE},depositAmount:parseFloat(T.crNoteDataList[t].CR_NOTE_AMT.toFixed(2)),availableAmount:parseFloat(T.crNoteDataList[t].CR_NOTE_AMT)-parseFloat(T.crNoteDataList[t].CNH_ADJ_AMT),balanceAmount:parseFloat(T.crNoteDataList[t].CR_NOTE_AMT)-parseFloat(T.crNoteDataList[t].CNH_ADJ_AMT),adjustamtTotal:0,depositSeqId:T.crNoteDataList[t].CR_NOTE_DATE,depositTypeDesc:T.crNoteDataList[t].REF_TYPE_DESC,crHdSeqId:T.crNoteDataList[t].CRN_HD_SEQ_ID};n.depositGridOptions.data.push(a)}}),T.searchResult();var l=[],s={1:l};T.clearanceStatusList=[];var o=a.executeQueryURLReset(),c=[];a.prepareParamListWithParam("pAdmnSeqId",P.patientInput.admissionSeqid,c),a.prepareParamListWithParam("pUserSeqId",angular.fromJson(sessionStorage.userContextObj).USER_SEQ_ID,c),a.executeQueryInput("IS_CLEARANCE_GIVEN_STATUS_FOR_BILLING",c,s,!0,!0,o,"popUp",{}).then(function(e){if(null!=l[0]){for(var t=0;t<l.length;t++)"N"==l[t].IS_CLEARANCE_GIVEN&&T.clearanceStatusList.push(l[t].LOCATION_DESCRIPTION);0!=T.clearanceStatusList.length?T.clearanceStatus="N":T.clearanceStatus="Y"}else T.clearanceStatus="Y";T.dischargeCheck=[],T.multipleDataForList={1:T.dischargeCheck};var i=a.executeQueryURLReset();T.dischargeCheckList=new Array,a.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,T.dischargeCheckList),a.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,T.dischargeCheckList),a.prepareParamListWithParam("pAdmseqid",P.patientInput.admissionSeqid,T.dischargeCheckList),a.executeQueryInput("NHIS_ADT_TR_096",T.dischargeCheckList,T.multipleDataForList,!0,!0,i,"popUp")})}),o.patientBannerDetail(P.patientInput.regSeqId).then(function(e){n.patientBannerDetails=e,n.patientRecordsDetail=n.patientBannerDetails.patientRecordsDetail}),T.viewPackageDetails=function(e){if(T.serviceObj.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]&&!_.isArray(T.serviceObj.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]))var t=[angular.copy(T.serviceObj.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"])];else if(T.serviceObj.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"])t=angular.copy(T.serviceObj.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]);else t=[];for(var a=0;a<t.length;a++)"PM"==t[a].packApplyTypeDesc&&t.splice(a,1);sessionStorage.setItem("packageServiceList",angular.toJson(t)),sessionStorage.setItem("packageSeqId",e.serviceVo.servSeqId),sessionStorage.setItem("bedClassId",n.patientGlobalDtls.bedClassCode),E.open("Package Charge Details",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/packageAssignment/package.view.screen.html",size:"lg",controller:"packageAssignmentController",controllerAs:"packageAssignment",resolve:{}}).result.then(function(e){},function(e){})}}e.$inject=["billPostingGridDefinition","hisCalDefConstant","QueryService","GetServicePostingListData","$filter","$scope","PatientBannerGlobal","uiGridConstants","PatientBannerBilling","$state","hisTranslationsService","BillGridColDef","BillGridsData","$stateParams","GetDepositData","billGridPackageDefinition","BillSaveService","BillSavePrepare","hisAlertService","PrintService","hisTranslationsGlobalLang","hisGenericAlertService","opBillPrintService","hisModalService","hisAlertConstants"],angular.module("napierContainerUi").controller("billPostingController",e)}(),function(){"use strict";var e=angular.module("napierContainerUi");e.controller("servicePostSheetCtrl",["IPINDENTAPIS","PrintService","$scope","BILLING_APIS","PatientBannerGlobal","PatientBannerBilling","QueryService","CallManager","uiGridConstants","servpostsheetGridDefinition","packDetailstGridDefinition","mediDeatilGridDefinition","transferDeatilGridDefinition","depositDeatilGridDefinition","$stateParams","hisTranslationsService","$filter","$state","hisTranslationsGlobalLang","hisGenericAlertService","hisModalService",function(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f,C){S.loadModule("billing");var I=y.getLanguageToSet();S.changeLanguage(I);var A=this;A.alertObj={},f.loadAlerts(I).then(function(e){A.alertObj=e,A.alertData={buttonText:A.alertObj.ok},A.alertFunction={buttonCallBack1:function(){}},A.close={buttonClose:function(){}}});var E=JSON.parse(g.patObj),h=JSON.parse(g.visitType),b=JSON.parse(g.folio),T=JSON.parse(g.folioList),L=(angular.copy(JSON.parse(g.allObj)),{patientInput:E,folioSeqId:b});A.folioSeqId=!(T.length>0),c.columnDefs[0].footerCellTemplate='<div class="ui-grid-cell-contents">{{"billing.total"|translate}}</div>',c.columnDefs[4].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue() |number:2 }}</div>',c.columnDefs[4].aggregationType=o.aggregationTypes.sum,c.columnDefs[5].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue() |number:2  }}</div>',c.columnDefs[5].aggregationType=o.aggregationTypes.sum,c.columnDefs[6].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue()  |number:2 }}</div>',c.columnDefs[6].aggregationType=o.aggregationTypes.sum,c.columnDefs[7].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue() |number:2 }}</div>',c.columnDefs[7].aggregationType=o.aggregationTypes.sum,c.columnDefs[8].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue() |number:2 }}</div>',c.columnDefs[8].aggregationType=o.aggregationTypes.sum,c.columnDefs[9].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue() |number:2 }}</div>',c.columnDefs[9].aggregationType=o.aggregationTypes.sum,c.columnDefs[10].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue() |number:2 }}</div>',c.columnDefs[10].aggregationType=o.aggregationTypes.sum,c.columnDefs[16].aggregationType=o.aggregationTypes.sum,c.columnDefs[17].aggregationType=o.aggregationTypes.sum,A.servpostsheetGridDefinition=angular.copy(c),d.columnDefs[0].footerCellTemplate='<div class="ui-grid-cell-contents">{{"billing.total"|translate}}</div>',d.columnDefs[3].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue() |number:2 }}</div>',d.columnDefs[3].aggregationType=o.aggregationTypes.sum,d.columnDefs[4].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue() |number:2 }}</div>',d.columnDefs[4].aggregationType=o.aggregationTypes.sum,d.columnDefs[6].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue() |number:2 }}</div>',d.columnDefs[6].aggregationType=o.aggregationTypes.sum,d.columnDefs[7].aggregationType=o.aggregationTypes.sum,d.columnDefs[8].aggregationType=o.aggregationTypes.sum,A.packDetailstGridDefinition=angular.copy(d),p.columnDefs[0].footerCellTemplate='<div class="ui-grid-cell-contents">{{"billing.total"|translate}}</div>',p.columnDefs[4].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue() |number:2 }}</div>',p.columnDefs[4].aggregationType=o.aggregationTypes.sum,A.mediDeatilGridDefinition=angular.copy(p),A.transferDeatilGridDefinition=angular.copy(u),m.columnDefs[0].footerCellTemplate='<div class="ui-grid-cell-contents">{{"billing.total"|translate}}</div>',m.columnDefs[3].footerCellTemplate='<div class="ui-grid-cell-contents">{{col.getAggregationValue() |number:2 }}</div>',m.columnDefs[3].aggregationType=o.aggregationTypes.sum,A.depositDeatilGridDefinition=angular.copy(m),A.medicineDtls=[],A.depositDtls=[],A.bedTransferDtls=[],A.multipleComboDataForList={1:A.medicineDtls,2:A.depositDtls,3:A.bedTransferDtls},A.provisionalBill=l.executeQueryURLReset(),r.getPatientBanner(E,h).then(function(t){a.patientGlobalDtls=t,L.subAccSeqId=a.patientGlobalDtls.subAccSeqId,a.patientGlobalDtls.userPermision=12,null!=a.patientGlobalDtls.mrNo?a.patientShow=!0:a.patientShow=!1;var i={};i.url=e.HISIPINDENT.URL,i.requestData={operation:"applyPackageForProvisionalBill",messageId:"",destination:"applyPackageCoreService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ApplyPackageVo",subAccSeqId:a.patientGlobalDtls.subAccSeqId,patientIpSeqId:E.admissionSeqid,patientId:a.patientGlobalDtls.mrNo,billingStatus:"0",fromDate:v("date")(new Date(a.patientGlobalDtls.admissionDate),"yyyy-MM-dd")+" 00:00:00.000",toDate:v("date")(new Date,"yyyy-MM-dd")+" 23:59:59.000",flowValue:1,applyPackType:2,folioSeqId:b.gQDataCode,bedClassSequenceId:a.patientGlobalDtls.bedClassCode,payerSequenceId:4===a.patientGlobalDtls.checkFor?-999:a.patientGlobalDtls.insuranceSeqId}},s.sendRestRequest(i).then(function(e){var t=0;if(A.packageCoverList=e.data.HITService.message,null!=e.data.HITService.message.servicePostingDetailsList){A.rawData=e.data.HITService.message.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"];var a=[];t=0;if(A.packDetailstGridDefinition.data=[],null!=A.rawData.length&&A.rawData.length>0){for(var i=0;i<A.rawData.length;i++)if(2==A.rawData[i].isPackage&&null!=A.rawData[i].packApplyType&&2!=A.rawData[i].packApplyType)A.serviceDataObj=A.processServiceDataObject(A.rawData[i]),3!=A.rawData[i].servicePostingType&&a.push(A.serviceDataObj),A.servpostsheetGridDefinition.data=a;else if(1==A.rawData[i].isPackage&&3!=A.rawData[i].servicePostingType){t+=1,A.packageDataObj={serialNo:t,packagecode:A.rawData[i].serviceVo.servCode,packagename:A.rawData[i].serviceVo.servName,packageprice:A.rawData[i].serviceRate,packagenum:A.rawData[i].taxAmt,companyNonPayingAmt:A.rawData[i].companyNonPayingAmt,companyPayingAmt:A.rawData[i].companyPayingAmt,serviceVo:A.rawData[i].serviceVo,servicePostingSeqId:A.rawData[i].servicePostingSeqId};A.rawData[i].discountAmt,A.rawData[i].serviceRate;A.packageDataObj.discount=A.rawData[i].discountAmt,A.packageDataObj.packNetAmt=A.rawData[i].serviceRate-(null!=A.rawData[i].discountAmt&&null!=A.rawData[i].discountAmt&&""!==A.rawData[i].discountAmt?A.rawData[i].discountAmt:0)+(null!=A.rawData[i].taxAmt&&null!=A.rawData[i].taxAmt&&""!==A.rawData[i].taxAmt?A.rawData[i].taxAmt:0),A.packDetailstGridDefinition.data.push(A.packageDataObj)}}else if(2==A.rawData.isPackage)A.serviceDataObj=A.processServiceDataObject(A.rawData),3!=A.rawData.servicePostingType&&a.push(A.serviceDataObj),A.servpostsheetGridDefinition.data=a;else if(1==A.rawData.isPackage&&3!=A.rawData.servicePostingType){t+=1,A.packageDataObj={serialNo:t,packagecode:A.rawData.serviceVo.servCode,packagename:A.rawData.serviceVo.servName,packageprice:A.rawData.serviceRate,packagenum:A.rawData.taxAmt,companyNonPayingAmt:A.rawData.companyNonPayingAmt,companyPayingAmt:A.rawData.companyPayingAmt,serviceVo:A.rawData.serviceVo,servicePostingSeqId:A.rawData.servicePostingSeqId};A.rawData.discountAmt,A.rawData.serviceRate;A.packageDataObj.discount=A.rawData.discountAmt,A.packageDataObj.packNetAmt=A.rawData.serviceRate-(null!=A.rawData.discountAmt&&null!=A.rawData.discountAmt&&""!==A.rawData.discountAmt?A.rawData.discountAmt:0)+(null!=A.rawData.taxAmt&&null!=A.rawData.taxAmt&&""!==A.rawData.taxAmt?A.rawData.taxAmt:0),A.packDetailstGridDefinition.data.push(A.packageDataObj)}}})}),n.patientBannerDetail(E.regSeqId).then(function(e){a.patientBannerDetails=e,a.patientRecordsDetail=a.patientBannerDetails.patientRecordsDetail});var P={};P.url=i.HISCOMBOFILLING.URL,P.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"SP_SERVICEPOSTING_PRINT_MATERIAL_DETAILS",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pAdmSeqId",value:E.admissionSeqid},{paramName:"pFlioSeqId",value:null==b?"":b.gQDataCode}]}]}]}]}},s.sendRestRequest(P).then(function(e){if(A.medicineDtlsList=[],null!=e.data.HITService.message.queryList)if(A.temp=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"],null!=A.temp.length)angular.forEach(A.temp,function(e,t){for(var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={},r=0;r<a.length;r++)i[""+a[r].name.split(".")[1]]=a[r].data;i.TRAN_DATE=v("date")(i.TRAN_DATE,"dd/MM/yyyy"),A.medicineDtlsList.push(i)}),A.mediDeatilGridDefinition.data=A.medicineDtlsList;else if(A.temp){for(var t=A.temp.columnList[0]["com.napier.core.service.vo.query.Column"],a={},i=0;i<t.length;i++)a[""+t[i].name.split(".")[1]]=t[i].data;a.TRAN_DATE=v("date")(a.TRAN_DATE,"dd/MM/yyyy"),A.medicineDtlsList.push(a),A.mediDeatilGridDefinition.data=A.medicineDtlsList}},function(e){});var O={};O.url=i.HISCOMBOFILLING.URL,O.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"BILLABLE_POSTINGSHEET_DEPOSIT_DETAILS_QUERY",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pIpSeqId",value:E.admissionSeqid}]}]}]}]}},s.sendRestRequest(O).then(function(e){if(A.depositDtlsList=[],null!=e.data.HITService.message.queryList)if(A.temp1=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"],A.temp1&&null!=A.temp1.length)angular.forEach(A.temp1,function(e,t){for(var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={},r=0;r<a.length;r++)i[""+a[r].name.split(".")[1]]=a[r].data;i.COL_REQ_DATE=v("date")(i.COL_REQ_DATE,"dd/MM/yyyy"),A.depositDtlsList.push(i)}),A.depositDeatilGridDefinition.data=A.depositDtlsList;else if(A.temp1){for(var t=A.temp1.columnList[0]["com.napier.core.service.vo.query.Column"],a={},i=0;i<t.length;i++)a[""+t[i].name.split(".")[1]]=t[i].data;a.COL_REQ_DATE=v("date")(a.COL_REQ_DATE,"dd/MM/yyyy"),A.depositDtlsList.push(a),A.depositDeatilGridDefinition.data=A.depositDtlsList}},function(e){});var R={};R.url=i.HISCOMBOFILLING.URL,R.requestData={operation:"ExecuteQuery",destination:"QueryService",message:{"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"BILLABLE_POSTINGSHEET_BEDTRANSFER_DETAILS_QUERY",idxList:[{"com.napier.core.service.vo.query.Index":[{paramName:"pIpSeqId",value:E.admissionSeqid}]}]}]}]}},s.sendRestRequest(R).then(function(e){if(A.bedTransferDtlsList=[],null!=e.data.HITService.message.queryList)if(A.temp2=e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"],A.temp2&&null!=A.temp2.length)angular.forEach(A.temp2,function(e,t){for(var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={},r=0;r<a.length;r++)i[""+a[r].name.split(".")[1]]=a[r].data;i.TR_DATE=v("date")(i.TR_DATE,"dd/MM/yyyy HH:mm:ss"),A.bedTransferDtlsList.push(i)}),A.transferDeatilGridDefinition.data=A.bedTransferDtlsList;else if(A.temp2){for(var t=A.temp2.columnList[0]["com.napier.core.service.vo.query.Column"],a={},i=0;i<t.length;i++)a[""+t[i].name.split(".")[1]]=t[i].data;a.TR_DATE=v("date")(a.TR_DATE,"dd/MM/yyyy HH:mm:ss"),A.bedTransferDtlsList.push(a),A.transferDeatilGridDefinition.data=A.bedTransferDtlsList}},function(e){});var N="printPostingSheetController";A.provisionalPrint=function(){L.reportId="BillingPostingSheetReceiptReport";var e=angular.isArray(A.rawData)?angular.copy(A.rawData):angular.copy([A.rawData]);let a=[];for(var i=0;i<e.length;i++)if(null!=e[i].packApplyType&&2!=e[i].packApplyType){let t=null!=e[i].spDate&&null!=e[i].spDate.$?e[i].spDate.$:e[i].spDate;e[i].servCode=e[i].serviceVo.servCode,e[i].servName=e[i].serviceVo.servName,e[i].spDate=v("date")(t,"yyyy-MM-dd HH:MM:ss"),e[i].chargeableAmt=3==e[i].packApplyType?e[i].chargeableAmt+(null!=e[i].taxAmt&&""!==e[i].taxAmt?e[i].taxAmt:parseInt(0)):e[i].chargeableAmt,a.push(e[i])}L.serviceListString=a,t.printReportModal(N,"lg","PDF",L)},A.provisionalConsolidatedPrint=function(){L.reportId="BillingPostingSheetConsolidateReport",t.printReportModal("PrintTypeSelection","sm").then(function(e){t.printReportModal(N,"lg",e,L)})},A.shutter=function(){D.go("index.billingSub.servicePosting",{patObj:g.patObj,visitType:g.visitType})},A.processServiceDataObject=function(e){var t={RenderedDate:null==e.renderedDateTime?v("date")(e.requestedDateTime.$,"dd/MM/yyyy HH:MM:ss"):v("date")(e.renderedDateTime.$,"dd/MM/yyyy HH:MM:ss"),servicecode:e.serviceVo.servCode,servicename:e.serviceVo.servName,qty:e.quantity,rate:e.serviceRate,discount:e.discountAmt,tax:e.taxAmt,ChargableAmt:3==e.packApplyType?e.chargeableAmt+(null!=e.taxAmt&&""!==e.taxAmt&&e.taxAmt>0?e.taxAmt:parseInt(0)):e.chargeableAmt,nonChargableAmt:e.nonChargableAmt,copayAmount:e.copayAmt,doctorSurcharge:e.surchargeOnDoctor,payersSurcharge:e.payerSurcharge,hospitalShare:e.hospitalShare,doctorShare:e.doctorShare,tranType:e.transTypeDesc,department:e.department,doctorName:e.doctorName,multeDoctor:e.multiDoctor,surcharge:e.surcharge,nonPayableAmt:e.companyNonPayingAmt,createdBy:e.createdByDesc,companyPayingAmt:e.companyPayingAmt,companyNonPayingAmt:e.companyNonPayingAmt};return null!=e.isPharmacyService&&""!=e.isPharmacyService.trim()&&e.chargeableAmt<0&&(t.ChargableAmt=e.chargeableAmt),t},A.viewPackageDetails=function(e){if(A.packageCoverList.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]&&!_.isArray(A.packageCoverList.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]))var t=[angular.copy(A.packageCoverList.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"])];else if(A.packageCoverList.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"])t=angular.copy(A.packageCoverList.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]);else t=[];for(var i=0;i<t.length;i++)"PM"==t[i].packApplyTypeDesc&&t.splice(i,1);sessionStorage.setItem("packageServiceList",angular.toJson(t)),sessionStorage.setItem("packageSeqId",e.serviceVo.servSeqId),sessionStorage.setItem("bedClassId",a.patientGlobalDtls.bedClassCode),C.open("Package Charge Details",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/packageAssignment/package.view.screen.html",size:"lg",controller:"packageAssignmentController",controllerAs:"packageAssignment",resolve:{}}).result.then(function(e){},function(e){})}}]),e.controller("printPostingSheetController",["returnObj","$uibModalInstance","selectedPrintType","QueryService","PrintService","$sce","$rootScope","$scope","CallManager","IPINDENTAPIS","APIS","$window",function(e,t,a,i,r,n,l,s,o,c,d,p){if(s.pageName="Provisional Bill",s.cancel=function(){t.dismiss("cancel")},e.serviceListString)for(var u=0;u<e.serviceListString.length;u++)e.serviceListString[u].servCode=_.toString(e.serviceListString[u].servCode),e.serviceListString[u].servName=_.toString(e.serviceListString[u].servName);s.printParameterList=new Array,i.prepareParamList("pSubAccSeqId",e.subAccSeqId,s.printParameterList),i.prepareParamList("facilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,s.printParameterList),i.prepareParamList("practiceId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,s.printParameterList),i.prepareParamList("pIpSeqId",e.patientInput.admissionSeqid,s.printParameterList),i.prepareParamList("pFlioSeqId",null==e.folioSeqId?"":e.folioSeqId.gQDataCode,s.printParameterList),i.prepareParamList("pBillStatus",0,s.printParameterList),i.prepareParamList("pIpNo",e.patientInput.ipNo,s.printParameterList),i.prepareParamList("pFoliono",null==e.folioSeqId?"ALL":e.folioSeqId.gQDataName,s.printParameterList),i.prepareParamList("serviceListString",e.serviceListString?angular.toJson(e.serviceListString):void 0,s.printParameterList),s.printObject={},s.printObject.reportId=e.reportId,s.printObject.reportType={id:"PDF"==a?4:5,desc:a},s.printObject.paramsList=s.printParameterList,s.printObject.destination="reportingServiceImpl",r.printReportFunction(s.printObject,s)}])}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v){g.loadModule("billing");var D=S.getLanguageToSet();g.changeLanguage(D);var y=this;if(y.alertObj={},v.loadAlerts(D).then(function(e){y.alertObj=e,y.alertData={buttonText:y.alertObj.ok},y.alertFunction={buttonCallBack1:function(){}},y.buttonClose={buttonClose:function(){}}}),y.isOpen=!0,d.oneTimecancelRecord=!1,y.patientInput=JSON.parse(l.patObj),y.gridInput=JSON.parse(l.gridObj),d.flg="true"==l.flag,d.flg1="true"==l.flag1,y.servicepostingCancelGridDefinition=angular.copy(t),y.servicepostingCancelGridDefinition.data=y.gridInput,s.getPatientBanner(y.patientInput,l.visitType).then(function(e){d.patientGlobalDtls=e,d.patientGlobalDtls.userPermision=12,null!=d.patientGlobalDtls.mrNo?d.patientShow=!0:d.patientShow=!1}),c.patientBannerDetail(y.patientInput.regSeqId).then(function(e){d.patientBannerDetails=e,d.patientRecordsDetail=d.patientBannerDetails.patientRecordsDetail}),y.servicepostingCancelGridDefinition.onRegisterApi=function(e){d.getCancelServicePostsList=e,e.selection.on.rowSelectionChanged(d,function(e){d.selectBatchSelection=d.getCancelServicePostsList.selection.getSelectedRows(),1==d.selectBatchSelection.length?d.multiDoctorData():y.servicepostingCancelGridDefinition.data.length>1&&(y.servicepostingServiceVariantCancelGridDefinition.data=[])})},y.servicepostingServiceVariantCancelGridDefinition=angular.copy(i),y.servicepostingServiceVariantCancelGridDefinition.data=[],d.servceVarientData=JSON.parse(l.gridObj),1==d.servceVarientData.length&&"Y"==d.servceVarientData[0].multiDoctor)for(var f=0;f<d.servceVarientData.length;f++)for(var C=d.servceVarientData[f].multiEmployeeShareList.employeeShareList[0]["com.napier.core.scm.serviceposting.vo.EmployeeShareVo"],I=0;I<C.length;I++)2==C[I].entityType&&y.servicepostingServiceVariantCancelGridDefinition.data.push(C[I]);d.multiDoctorData=function(){if("Y"==d.selectBatchSelection[0].multiDoctor){y.servicepostingServiceVariantCancelGridDefinition.data=[];for(var e=0;e<d.servceVarientData.length;e++)if(d.selectBatchSelection[0].servCode==d.servceVarientData[e].servCode)for(var t=d.servceVarientData[e].multiEmployeeShareList.employeeShareList[0]["com.napier.core.scm.serviceposting.vo.EmployeeShareVo"],a=0;a<t.length;a++)2==t[a].entityType&&y.servicepostingServiceVariantCancelGridDefinition.data.push(t[a])}},y.servicepostingCancelServiceSearchGridDefinition=angular.copy(r),y.servicepostingCancelServiceSearchGridDefinition.data=angular.copy(n),y.servicepostingNewServiceSearchAddGridDefinition=angular.copy(a),y.open=function(t){e.open("",{animation:!0,templateUrl:"app/consumer/his17_1/common/service-posting-Cancel/templates/service.posting.popupmodal.html",size:t,controller:"servicePostingCnclCtrl",controllerAs:"svpC"})},y.cancelRecord=function(){d.oneTimecancelRecord=!0;var e=[],t=!1;return y.cancelReasonData?(angular.forEach(y.servicepostingCancelGridDefinition.data,function(a,i){var r={};if(r.spSeqId=a.servicePostingSeqId,!a.cancelRequestedRole&&!a.cancelRequestedBy&&1!=t)return m.warning(y.alertObj.alertTypeWarn,y.alertObj.plzFilCnclByCnclRole),d.oneTimecancelRecord=!1,t=!0,!1;if(a.cancelRequestedRole)r.cnclRole=a.cancelRequestedRole.DETAIL_DESC;else if(1!=t)return m.warning(y.alertObj.alertTypeWarn,y.alertObj.plzFilCnclRole),d.oneTimecancelRecord=!1,t=!0,!1;if(a.cancelRequestedBy.name)r.cnclBy=a.cancelRequestedBy.name;else if(1!=t)return m.warning(y.alertObj.alertTypeWarn,y.alertObj.plzFilCnclBy),d.oneTimecancelRecord=!1,t=!0,!1;e.push(r)}),!t&&void p.getServicePostingCacel(e,y.cancelReasonData).then(function(e){e.data.HITService.message?(m.success(y.alertObj.alertTypeSucss,y.alertObj.servCnclSuccsfuly),u.go("index.billingSub.servicePosting",{patObj:JSON.stringify(y.patientInput),visitType:l.visitType})):m.warning(y.alertObj.alertTypeWarn,y.alertObj.cnclReqNtPrcd)})):(m.warning(y.alertObj.alertTypeWarn,y.alertObj.plzFilCnclRsn),d.oneTimecancelRecord=!1,!1)},y.populateEmployee=function(t,a){"canceledBy"!=t||a.canceledRole?(angular.extend(a,{role:t,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID}),e.open("",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/service_posting/service-posting-New/templates/service.posting.popupmodal.employee.html",size:"lg",controller:"servicePostingNewEmpModalController",controllerAs:"svpNE",resolve:{serviceDetails:angular.copy(a)}}).result.then(function(e){var i=_.findIndex(y.servicepostingCancelGridDefinition.data,function(e){return e.servicePostingSeqId==a.servicePostingSeqId});y.servicepostingCancelGridDefinition.data[i][t]={name:e.EMP_NAME,seqId:e.STAFF_ID,code:e.CODE,firstName:e.FIRSTNAME,lastName:e.LASTNAME,salutation:e.SALUTATION,gender:e.GENDER,category:e.CATEGORY,designation:e.DESIGNATION,regdNo:e.REGDNO,gnStatus:e.GN_STATUS}})):m.warning(y.alertObj.alertTypeWarn,y.alertObj.plzFilCnclRole)},y.close=function(){u.go("index.billingSub.servicePosting",{patObj:JSON.stringify(y.patientInput),visitType:l.visitType})},y.patientDetails=angular.copy(angular.fromJson(l.patObj)),y.visitType=angular.copy(y.patientDetails.visitType),delete y.patientDetails.visitType,function(){y.roles=[],y.roleList={1:y.roles};var e=o.executeQueryURLReset();y.servRoleList=new Array,o.prepareParamListWithParam("pMasterSqId",104,y.servRoleList),o.prepareParamListWithParam("pType",y.patientDetails.typeOfReg.code,y.servRoleList),o.executeQueryInput("GET_CALLED_BY_ROLE",y.servRoleList,y.roleList,!0,!0,e,"popUp",y.servicepostingServiceVariantCancelGridDefinition)}()}e.$inject=["hisModalService","servicepostingCancelGridDefinition","servicepostingNewServiceSearchAddGridDefinition","servicepostingServiceVariantCancelGridDefinition","servicepostingCancelGridDefinitionData","srchSerivceData","$stateParams","PatientBannerGlobal","QueryService","PatientBannerBilling","$scope","ServicePostingCancel","$state","hisAlertService","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService"],angular.module("napierContainerUi").controller("servicePostingCnclCtrl",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d,p,u,m,g,S,v,D,y,f){var C=this;C.CD=angular.copy(e),C.oneAtATime=!1,C.format=angular.copy(e.uibDateOnly.format),i.loadModule("billing"),D.getDynamicConfig("GET_HIS_CONFIG_VALUE","Site_Ref").then(function(e){p.hscSpecific=e[1][0].VALUE,"HSC"==e[1][0].VALUE&&(C.projSpecApplicable=!0)}),D.getDynamicConfig("GET_HIS_CONFIG_VALUE","INTEGRATION_AAPLICABLE").then(function(e){e[1][0]&&(C.integrationApplicableFlag=e[1][0].VALUE)});var I=S.getLanguageToSet();function A(e,t){for(var a=[],i=angular.copy(e),r=0;r<e.length;r++)a.push(e[r].SERV_SEQ_ID?e[r].SERV_SEQ_ID:e[r].serviceVo.servSeqId);u.retriveServiceList(a).then(function(e){C.servicePostingDetailsVo=[],e.data.HITService.message.serviceList[0]["com.napier.core.scm.master.vo.ServiceVo"].length>0?C.retriveDetails=e.data.HITService.message.serviceList[0]["com.napier.core.scm.master.vo.ServiceVo"]:C.retriveDetails=[e.data.HITService.message.serviceList[0]["com.napier.core.scm.master.vo.ServiceVo"]];for(var a=0;a<i.length;a++){var r=_.findIndex(C.retriveDetails,function(e){return e.servSeqId==i[a].SERV_SEQ_ID?i[a].SERV_SEQ_ID:i[a].serviceVo?i[a].serviceVo.servSeqId:void 0});-1!=r&&(C.retriveDetails[r].tariffSeqId=angular.copy(i[a].tariffSeqId?i[a].tariffSeqId:i[a].serviceRateVo?i[a].serviceRateVo.tariffSeqId:void 0),C.retriveDetails[r].inflSeqId=angular.copy(i[a].inflSeqId?i[a].inflSeqId:i[a].serviceRateVo?i[a].serviceRateVo.inflSeqId:void 0))}t?E(!0,t):E()})}function E(e,t){if(C.retriveDetails&&C.retriveDetails.length>0)for(var a=0;a<C.retriveDetails.length;a++){var i={"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",accSeqId:C.blAccount[0].ACC_SEQ_ID,subAccSeqId:C.blAccount[0].SUB_ACC_SEQ_ID,servicePostingType:2,serviceVo:{"@class":"com.napier.core.scm.master.vo.ServiceVo",servSeqId:C.retriveDetails[a].servSeqId,gnServDesign:C.retriveDetails[a].servDesign,servCode:C.retriveDetails[a].servCode,servName:C.retriveDetails[a].servName,servTypeCode:C.retriveDetails[a].servTypeCode,secServTypeCode:C.retriveDetails[a].secServTypeCode,priServTypCode:C.retriveDetails[a].priServTypCode},serviceRateVo:{"@class":"com.napier.core.service.vo.ratecard.ServiceRateVo",servSeqId:C.retriveDetails[a].servSeqId,bedClassRateVos:[{"com.napier.core.service.vo.ratecard.BedClassRateVo":[{"@class":"com.napier.core.service.vo.ratecard.BedClassRateVo",bedClassSeqId:C.patientDetails.bedClass.bedClassSeqId}]}],tariffSeqId:C.retriveDetails[a].tariffSeqId,isRateEditable:C.retriveDetails[a].isRateEditable,datedOn:moment(new Date).format("YYYY-MM-DD HH:mm:ss.000")},encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:0,enProvider:0,enSpeciality:0,isAddendum:!1},patientCategoryCode:C.patientDetails.patientCategory.code,transType:1,facilityId:C.patientDetails.facilityId.code,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,gnFlow:1};if(10008==C.retriveDetails[a].priServTypCode)if(p.flagChk=e,e){i.serviceRateVo.doctSeqId=t.renderedBy.seqId,i.serviceRateVo.specSeqId=t.renderedBy.SPECIALIZATN;var r=_.findIndex(C.servicePostingDetailsVo,function(e){return e.serviceVo.servSeqId==C.retriveDetails[a].servSeqId});-1==r?C.servicePostingDetailsVo.push(i):C.servicePostingDetailsVo[r]=i}else i.serviceRateVo.doctSeqId=p.patientGlobalDtls.primaryDocSeqId,i.serviceRateVo.specSeqId=p.patientGlobalDtls.primaryDoctSpecSeqId,C.servicePostingDetailsVo.push(i);else i.inflSeqId=C.retriveDetails[a].inflSeqId,i.serviceRateVo.doctSeqId=p.patientGlobalDtls.primaryDocSeqId,i.serviceRateVo.specSeqId=p.patientGlobalDtls.primaryDoctSpecSeqId,C.servicePostingDetailsVo.push(i)}C.getObj1=t,C.servicePostingDetailsVo&&C.servicePostingDetailsVo.length>0&&u.getMultipleServicesPostingDetails(C.servicePostingDetailsVo,{accSeqId:C.blAccount[0].ACC_SEQ_ID,subAccSeqId:C.blAccount[0].SUB_ACC_SEQ_ID}).then(function(t){t.data.HITService.message.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"].length>0?(C.serviceData=t.data.HITService.message.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"],h(e),10008===C.serviceData[0].serviceVo.priServTypCode&&p.flagChk&&C.changeQuantity(C.serviceData[0],!1,-1==r?0:r,C.serviceData[0].serviceRate,2)):(C.serviceData=[t.data.HITService.message.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"]],h(e),10008===C.serviceData[0].serviceVo.priServTypCode&&p.flagChk&&(C.serviceData[0].renderedBy=C.getObj1.renderedBy,C.serviceData[0].renderedRole=C.getObj1.renderedRole,C.changeQuantity(C.serviceData[0],!1,-1==r?0:r,C.serviceData[0].serviceRate,2)))})}function h(e){let t=[];for(var a=0;a<C.serviceData.length;a++){angular.extend(C.serviceData[a],{requestedDate:new Date,renderedDate:new Date,requestedBy:{name:p.patientGlobalDtls.admittedDoctor?p.patientGlobalDtls.admittedDoctor:"",seqId:p.patientGlobalDtls.admittingDocSeqId?p.patientGlobalDtls.admittingDocSeqId:""},quantity:1,tax:C.serviceData[a].taxAmt?C.serviceData[a].taxAmt:0,applicableTariff:p.patientGlobalDtls.tarrifCategory,priority:1,requestedRole:4,renderedRole:"HSC"==p.hscSpecific?4:"",renderedBy:"HSC"==p.hscSpecific?{name:p.patientGlobalDtls.admittedDoctor?p.patientGlobalDtls.admittedDoctor:"",seqId:p.patientGlobalDtls.admittingDocSeqId?p.patientGlobalDtls.admittingDocSeqId:""}:"",discountAmt:C.serviceData[a].discountAmt?C.serviceData[a].discountAmt:0,discount:C.serviceData[a].discount?C.serviceData[a].discount:0,chargeableAmt:C.serviceData[a].serviceRate-C.serviceData[a].discountAmt,isEmergency:2,transType:1,isMultiDoctFlag:!1,proposedShareAfterDiscount:0,doctorModifiedAmount:0,multiDoctor:"N",employeeShareList:[]});var i=parseFloat(C.serviceData[a].serviceRate)-parseFloat(C.serviceData[a].discountAmt)+parseFloat(C.serviceData[a].tax);angular.extend(C.serviceData[a],{effectiveRate:parseFloat(i.toFixed(2))});var r=0;if(r=C.servicePostingNewGridDefinition.data.length>0?C.servicePostingNewGridDefinition.data.length:0,C.toDateOptions[r]={minDate:C.serviceData[a].requestedDate,maxDate:new Date},C.servicePostingNewGridDefinition.data.length>0){var n=_.findIndex(C.servicePostingNewGridDefinition.data,function(e){return e.serviceVo.servSeqId==C.serviceData[a].serviceVo.servSeqId});if(-1==n||e)if(e){let e=angular.copy(C.servicePostingNewGridDefinition.data[n].servicePostingSeqId);C.servicePostingNewGridDefinition.data[n]=C.serviceData[a],C.servicePostingNewGridDefinition.data[n].servicePostingSeqId=e}else C.servicePostingNewGridDefinition.data.push(C.serviceData[a]);else t.push(C.serviceData[a])}else C.servicePostingNewGridDefinition.data.push(C.serviceData[a])}if(t.length>0){var l={buttonText:C.alertObj.no,buttonText2:C.alertObj.yes},s={buttonCallBack1:function(){},buttonCallBack2:function(){for(let e=0;e<t.length;e++)C.servicePostingNewGridDefinition.data.push(t[e])}};let e="";for(let a=0;a<t.length;a++)e=e+" "+t[a].serviceVo.servName,a!=t.length-1&&(e+=",");var o="This "+e+" service already exist(s). Do you still want to continue?";g.hisAlertMulti("information",C.alertObj.alertTypeInfo,o,l,s,{buttonClose:function(){}})}}i.changeLanguage(I),C.alertObj={},v.loadAlerts(I).then(function(e){C.alertObj=e,C.alertData={buttonText:C.alertObj.ok},C.alertFunction={buttonCallBack1:function(){}},C.close={buttonClose:function(){}}}),C.toDateOptions={},C.fromDateOptions={maxDate:new Date},C.servicePostingNewGridDefinition=angular.copy(r),C.servicepostingServiceVariantGridDefinition=angular.copy(s),C.servicepostingNewServiceSearchGridDefinition=angular.copy(l),C.servicepostingNewServiceSearchAddGridDefinition=angular.copy(n),C.servicepostingServiceVariantGridDefinition.data=[],C.servicePostingNewGridDefinition.data=[],C.servicePostingNewGridDefinition.onRegisterApi=function(e){C.servicePostingNewGridDefinitionApi=e,e.core.on.sortChanged(p,function(e,t){})},C.servicepostingServiceVariantGridDefinition.onRegisterApi=function(e){C.servicepostingServiceVariantGridDefinitionApi=e,e.core.on.sortChanged(p,function(e,t){}),e.edit.on.afterCellEdit(p,function(e,t,a,i){null==e.doctorShare&&(e.doctorShare=0),C.changeDoctorShare(e)}),e.edit.on.beginCellEdit(p,function(e,t,a,i){null==e.doctorShare&&(e.doctorShare=0),C.share=parseFloat(e.doctorShare.toFixed(2))})},C.open=function(e){a.open("Add Service",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/service_posting/service-posting-New/templates/service.posting.popupmodal.html",size:e,backdrop:!0,controller:"servicePostingNewModalController",controllerAs:"svpNM",resolve:{patientDetails:{patientDetails:angular.copy(p.patientGlobalDtls),serviceDetailData:angular.copy(C.searchService)}}}).result.then(function(e){e&&A(e)},function(e){})},C.serviceVariantUpdate=function(){for(var e=0;e<C.servicepostingServiceVariantGridDefinition.data.length;e++)if(0==parseInt(C.servicepostingServiceVariantGridDefinition.data[e].doctorShare))return void g.hisAlertMulti("warning",C.alertObj.alertTypeWarn,C.alertObj.docShareShldNtAlwZero,C.alertData,C.alertFunction,C.close);C.serviceVar=!1;var t=angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0]);if(o.gridObj)var a=_.findIndex(C.servicePostingNewGridDefinition.data,function(e){return e.multiDoctor==t.multiDoctor});else a=_.findIndex(C.servicePostingNewGridDefinition.data,function(e){return e.multiDoctor==t.multiDoctor});C.servicePostingNewGridDefinition.data[a].employeeShareList=C.servicepostingServiceVariantGridDefinition.data,g.hisAlertMulti("success",C.alertObj.alertTypeSucss,C.alertObj.docShareSlctServSvdSucsfly,C.alertData,C.alertFunction,C.close),C.flag=!1},C.changeDoctorShare=function(e){C.serviceVar=!0;var t=_.findIndex(C.servicepostingServiceVariantGridDefinition.data,function(t){return t.seqId==e.seqId});if(0!=e.doctorShare){if(0!=t){if(C.servicepostingServiceVariantGridDefinition.data[0].doctorShare<e.doctorShare)return void(C.servicepostingServiceVariantGridDefinition.data[t].doctorShare=C.share);if(C.share<parseFloat(e.doctorShare)){var a=C.share-parseFloat(e.doctorShare);C.servicepostingServiceVariantGridDefinition.data[0].doctorShare=parseFloat(C.servicepostingServiceVariantGridDefinition.data[0].doctorShare)+parseFloat(a)}else{var i=parseFloat(C.share)-parseFloat(e.doctorShare);C.servicepostingServiceVariantGridDefinition.data[0].doctorShare=parseFloat(C.servicepostingServiceVariantGridDefinition.data[0].doctorShare)+parseFloat(i)}C.servicepostingServiceVariantGridDefinition.data[0].doctorShare=parseFloat(C.servicepostingServiceVariantGridDefinition.data[0].doctorShare.toFixed(2))}}else C.servicepostingServiceVariantGridDefinition.data[t].doctorShare=C.share},C.keyShare=function(e){var t=_.findIndex(C.servicepostingServiceVariantGridDefinition.data,function(t){return t.EMP_SEQ_ID==e.EMP_SEQ_ID});C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].doctorShare<e.doctorShare&&(C.servicepostingServiceVariantGridDefinition.data[t].doctorShare=C.share)},C.emptyCharges=function(e){var t=_.findIndex(C.servicePostingNewGridDefinition.data,function(t){return t.serviceVo.servSeqId==e.serviceVo.servSeqId});C.servicePostingNewGridDefinition.data[t].doctorAmount=0,C.servicePostingNewGridDefinition.data[t].doctorShare=0,C.servicePostingNewGridDefinition.data[t].doctorModifiedAmount=0,C.servicePostingNewGridDefinition.data[t].multiDoctor="N",C.servicePostingNewGridDefinition.data[t].surcharge=0,C.servicepostingServiceVariantGridDefinition.data=[],C.doctorShare="",C.serviceName=""},C.populateEmployee=function(e,t,i,r){"renderedBy"!=e||t.renderedRole?(angular.extend(t,{role:e}),a.open("Employee Search",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/service_posting/service-posting-New/templates/service.posting.popupmodal.employee.html",size:"lg",controller:"servicePostingNewEmpModalController",controllerAs:"svpNE",resolve:{serviceDetails:angular.copy(t)}}).result.then(function(a){var n=C.servicePostingNewGridDefinition.data[i][e];if(C.servicePostingNewGridDefinition.data[i][e]={name:a.EMP_NAME,seqId:a.STAFF_ID,code:a.CODE,firstName:a.FIRSTNAME,lastName:a.LASTNAME,salutation:a.SALUTATION,gender:a.GENDER,category:a.CATEGORY,designation:a.DESIGNATION,regdNo:a.REGDNO,gnStatus:a.GN_STATUS,GRP_MST_CODE:a.GRP_MST_CODE,SPECIALIZATN:a.SPECIALIZATN},"renderedBy"==e){var l=angular.copy(C.servicePostingNewGridDefinition.data[i]);C.servicePostingNewGridDefinition.data[i].employeeShareList=[],o.gridObj&&(angular.extend(l,{patientCategoryCode:C.patientDetails.patientCategory.code,enNo:C.patientDetails.enNo,encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:0,enProvider:0,enSpeciality:0,isAddendum:!1}}),angular.extend(l.serviceRateVo,{bedClassRateVos:[{"com.napier.core.service.vo.ratecard.BedClassRateVo":{"@class":"com.napier.core.service.vo.ratecard.BedClassRateVo",bedClassSeqId:C.patientDetails.bedClass.bedClassSeqId}}]})),p.priServTypCode=C.servicePostingNewGridDefinition.data[0].serviceVo.priServTypCode,u.getDoctorSurcharge(l).then(function(a){if(a.data.HITService.message&&a.data.HITService.message.errorMessage)return g.information("Information",a.data.HITService.message.errorMessage,!1,!1,f.time),void(C.servicePostingNewGridDefinition.data[i][e]=n);var l=angular.copy(C.servicePostingNewGridDefinition.data[i]);if(l.doctorAmount=a.data.HITService.message.doctorAmount,l.doctorShare=a.data.HITService.message.doctorShare,l.standardDoctorShare=a.data.HITService.message.standardDoctorShare,l.proposedShareAfterDiscount=a.data.HITService.message.proposedShareAfterDiscount,l.doctorSurcharge=a.data.HITService.message.doctorSurcharge,l.standardSurcharge=a.data.HITService.message.standardSurcharge,o.gridObj)var s=_.findIndex(C.gridPopulateData,function(e){return e.servicePostingSeqId==C.servicePostingNewGridDefinition.data[i].servicePostingSeqId});else s=_.findIndex(C.gridPopulateData,function(e){return e.serviceVo.servSeqId==C.servicePostingNewGridDefinition.data[i].serviceVo.servSeqId});-1==s&&C.gridPopulateData.push(l),10008==p.priServTypCode?A([l],l):C.changeQuantity(l,!1,i,t.serviceRate,r)})}})):g.hisAlertMulti("information",C.alertObj.alertTypeInfo,C.alertObj.plzSlctRndRole,C.alertData,C.alertFunction,C.close)},C.getSearchQuery=function(e,t){C.servicePostingSearchData=[],C.departmentDroupDown=[],C.searchList={1:C.servicePostingSearchData};var a=m.executeQueryURLReset();C.servicePostInputList=new Array,C.tempObj=[],e.renderedByEmpCode?(m.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,C.servicePostInputList),m.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,C.servicePostInputList),m.prepareParamListWithParam("pGnStatus",C.patientDetails.gnStatus?C.patientDetails.gnStatus:"%%",C.servicePostInputList),m.prepareParamListWithParam("pEmpseqid","",C.servicePostInputList),m.prepareParamListWithParam("pEmpCode","",C.servicePostInputList),m.prepareParamListWithParam("pEmpName",e.renderedByEmpName,C.servicePostInputList),m.prepareParamListWithParam("pEmpType",e.renderedByEmpCode,C.servicePostInputList),m.prepareParamListWithParam("pServSeqId",e.serviceVo.servSeqId,C.servicePostInputList),m.prepareParamListWithParam("pDeptCode",null,C.servicePostInputList),m.prepareParamListWithParam("pIsOpConsApplicable","",C.servicePostInputList),m.prepareParamListWithParam("pIsIpConsApplicable","",C.servicePostInputList),m.prepareParamListWithParam("pType","2",C.servicePostInputList),m.executeQueryInput("SP_EMPLOYEE_SEARCH_NEW",C.servicePostInputList,C.searchList,!0,!0,a,"popUp",C.servicePostingNewGridDefinition.data).then(function(a){if(a[1][0]){e[t]={name:a[1][0].EMP_NAME,seqId:a[1][0].STAFF_ID,code:a[1][0].CODE,firstName:a[1][0].FIRSTNAME,lastName:a[1][0].LASTNAME,salutation:a[1][0].SALUTATION,gender:a[1][0].GENDER,category:a[1][0].CATEGORY,designation:a[1][0].DESIGNATION,regdNo:a[1][0].REGDNO,gnStatus:a[1][0].GN_STATUS,entityType:4==e.renderedRole?2:angular.copy(e.renderedRole),GRP_MST_CODE:a[1][0].GRP_MST_CODE,SPECIALIZATN:a[1][0].SPECIALIZATN};var i=angular.copy(e);angular.extend(i,{patientCategoryCode:C.patientDetails.patientCategory.code,enNo:C.patientDetails.enNo,encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:0,enProvider:0,enSpeciality:0,isAddendum:!1}}),angular.extend(i.serviceRateVo,{bedClassRateVos:[{"com.napier.core.service.vo.ratecard.BedClassRateVo":{"@class":"com.napier.core.service.vo.ratecard.BedClassRateVo",bedClassSeqId:C.patientDetails.bedClass.bedClassSeqId}}]}),u.getDoctorSurcharge(i).then(function(t){angular.extend(e,{standardDoctorShare:t.data.HITService.message.standardDoctorShare,proposedShareAfterDiscount:t.data.HITService.message.proposedShareAfterDiscount,standardSurcharge:t.data.HITService.message.standardSurcharge}),-1==_.findIndex(C.gridPopulateData,function(t){return t.servicePostingSeqId==e.servicePostingSeqId})&&C.gridPopulateData.push(t.data.HITService.message),C.servicePostingNewGridDefinition.data.push(e)})}})):(e[t]={},C.servicePostingNewGridDefinition.data.push(e))},C.doctorSearch=function(e){C.flag&&a.open("Employee Search",{animation:!0,templateUrl:"app/consumer/his17_1/billing/screens/service_posting/service-posting-New/templates/service.posting.popupmodal.doctor.html",size:"lg",controller:"servicePostingNewDocModalController",controllerAs:"svpND",resolve:{serviceDetails:angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0])}}).result.then(function(e){for(var t=0;t<e.length;t++){if(angular.extend(e[t],{doctorShare:0,name:e[t].EMP_NAME,seqId:e[t].STAFF_ID,code:e[t].CODE,firstName:e[t].FIRSTNAME,lastName:e[t].LASTNAME,salutation:e[t].SALUTATION,gender:e[t].GENDER,category:e[t].CATEGORY,designation:e[t].DESIGNATION,regdNo:e[t].REGDNO,gnStatus:e[t].GN_STATUS,entityType:4==angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].renderedRole)?2:angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].renderedRole),proposedShare:angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].doctorAmount)}),C.servicepostingServiceVariantGridDefinition.data.length>0)-1==_.findIndex(C.servicepostingServiceVariantGridDefinition.data,function(a){return a.seqId==e[t].STAFF_ID})?C.servicepostingServiceVariantGridDefinition.data.push(e[t]):g.hisAlertMulti("information",C.alertObj.alertTypeInfo,C.alertObj.recdAlrExstGrid,C.alertData,C.alertFunction,C.close);else C.servicepostingServiceVariantGridDefinition.data.push(e[t])}})},C.dateChange=function(e,t){C.toDateOptions[t].minDate=C.servicePostingNewGridDefinition.data[t].requestedDate?new Date(C.servicePostingNewGridDefinition.data[t].requestedDate):new Date},C.removeData=function(e){C.serviceVar=!0;var t=_.findIndex(C.servicepostingServiceVariantGridDefinition.data,function(t){return t.seqId==e.seqId});C.servicepostingServiceVariantGridDefinition.data.splice(t,1);var a=angular.copy(C.servicepostingServiceVariantGridDefinition.data);a[0].doctorShare=parseFloat(a[0].doctorShare)+parseFloat(e.doctorShare),a[0].doctorShare,parseFloat(a[0].doctorShare.toFixed(2)),C.servicepostingServiceVariantGridDefinition.data=angular.copy(a)},C.changeQuantity=function(e,t,a,i,r){var n=!1,l=angular.copy(e);if(o.gridObj)var s=_.findIndex(C.gridPopulateData,function(t){return t.servicePostingSeqId==e.servicePostingSeqId});else s=_.findIndex(C.gridPopulateData,function(t){return t.serviceVo.servSeqId==e.serviceVo.servSeqId});if(C.transTypes=e.transType,C.priority=angular.copy(e.priority),e.quantity&&0!=e.quantity&&(1!=e.quantity||t||4!=e.renderedRole)||-1!=s&&(10008!=C.gridPopulateData[s].serviceVo.priServTypCode&&(e=angular.copy(C.gridPopulateData[s])),e.tempQty=l.tempQty,e.serviceRateVo.baseRate=l.serviceRateVo.baseRate,null!=i&&null!=i&&""!=i&&4==C.transTypes&&(e.serviceRate=i,e.serviceRateVo.baseRate=parseFloat(i.toFixed(2))),e.quantity=1,e.transType=C.transTypes,e.standardSurcharge=o.gridObj?0:e.standardSurcharge),t?(e.standardSurcharge=e.standardSurcharge,e.standardDoctorShare=null!=l.tempDoctorAmount&&null!=l.tempDoctorAmount&&""!==l.tempDoctorAmount&&l.tempDoctorAmount>0?angular.copy(l.tempDoctorAmount):e.standardDoctorShare,e.proposedShareAfterDiscount=e.proposedShareAfterDiscount):null!=l.doctorAmount&&0==l.doctorAmount&&(e.doctorAmount=l.doctorAmount,e.standardDoctorShare=null!=l.prvtransType&&l.prvtransType!=l.transType&&3==l.prvtransType?0:l.standardDoctorShare),l.doctorAmount&&!t&&(2==e.transType?(e.standardSurcharge=e.standardSurcharge,e.standardDoctorShare=0==e.serviceRate?0:null!=l.tempDoctorAmount&&null!=l.tempDoctorAmount&&""!==l.tempDoctorAmount&&l.tempDoctorAmount>0?angular.copy(l.tempDoctorAmount):angular.copy(l.doctorAmount),e.doctorModifiedAmount=0==e.serviceRate?0:angular.copy(l.doctorAmount),e.doctorAmount=0==e.serviceRate?0:angular.copy(l.doctorAmount),e.proposedShareAfterDiscount=e.proposedShareAfterDiscount,e.actualRate=e.actualRate*e.quantity,e.chargeableAmt=e.serviceRateVo.baseRate*e.quantity):3==e.transType?(e.standardSurcharge=e.standardSurcharge,e.standardDoctorShare=e.standardDoctorShare,e.doctorModifiedAmount=0,e.proposedShareAfterDiscount=e.proposedShareAfterDiscount,e.actualRate=e.actualRate,e.chargeableAmt=e.serviceRateVo.baseRate,e.doctorAmount=angular.copy(l.doctorAmount)):e.doctorModifiedAmount=0),o.gridObj){e.standardSurcharge=0,angular.extend(e,{enNo:p.patientGlobalDtls.encounterNo,patientCategoryCode:C.patientDetails.patientCategory.code,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:0,enProvider:0,enSpeciality:0,isAddendum:!1}}),angular.extend(e.serviceRateVo,{bedClassRateVos:[{"com.napier.core.service.vo.ratecard.BedClassRateVo":{"@class":"com.napier.core.service.vo.ratecard.BedClassRateVo",bedClassSeqId:C.patientDetails.bedClass.bedClassSeqId}}]});n=!0}e.serviceRateVo.bedClassRateVos[0]["com.napier.core.service.vo.ratecard.BedClassRateVo"].bedClassSeqId=angular.copy(C.patientDetails.bedClass.bedClassSeqId),e.priority=angular.copy(C.priority),u.quantityChangeDetails(e,n,r).then(function(t){if(null!=t.data.HITService.message&&null!=t.data.HITService.message.errorCode)g.information("Information",t.data.HITService.message.errorMessage,!1,!1,f.time);else if(t.data.HITService.message){null!=e.quantity&&null!=e.quantity&&""!==e.quantity&&(C.servicePostingNewGridDefinition.data[a].quantity=t.data.HITService.message.quantity,C.servicePostingNewGridDefinition.data[a].tempQty=t.data.HITService.message.quantity),C.servicePostingNewGridDefinition.data[a].serviceRate=t.data.HITService.message.serviceRate;var i=C.servicePostingNewGridDefinition.data[a].serviceRate/C.servicePostingNewGridDefinition.data[a].quantity;C.servicePostingNewGridDefinition.data[a].serviceRateVo.baseRate=parseFloat(i.toFixed(2)),C.servicePostingNewGridDefinition.data[a].tax=null!=t.data.HITService.message.tax?t.data.HITService.message.tax:null!=t.data.HITService.message.taxAmt?t.data.HITService.message.taxAmt:C.servicePostingNewGridDefinition.data[a].tax,C.servicePostingNewGridDefinition.data[a].discountAmt=null!=t.data.HITService.message.totalDiscountAmount?parseFloat(t.data.HITService.message.totalDiscountAmount.toFixed(2)):parseFloat(C.servicePostingNewGridDefinition.data[a].discountAmt.toFixed(2)),C.servicePostingNewGridDefinition.data[a].discount=null!=t.data.HITService.message.discount?t.data.HITService.message.discount:C.servicePostingNewGridDefinition.data[a].discount,C.servicePostingNewGridDefinition.data[a].servicePostingType=t.data.HITService.message.servicePostingType,C.servicePostingNewGridDefinition.data[a].transType=t.data.HITService.message.transType,C.servicePostingNewGridDefinition.data[a].prvtransType=t.data.HITService.message.transType,C.servicePostingNewGridDefinition.data[a].surcharge=t.data.HITService.message.surcharge,C.servicePostingNewGridDefinition.data[a].actualRate=t.data.HITService.message.actualRate,C.servicePostingNewGridDefinition.data[a].doctorAmount=t.data.HITService.message.doctorAmount,C.servicePostingNewGridDefinition.data[a].tempDoctorAmount=parseFloat(parseFloat(t.data.HITService.message.doctorAmount/C.servicePostingNewGridDefinition.data[a].quantity).toFixed(2)),C.servicePostingNewGridDefinition.data[a].hospitalShare=t.data.HITService.message.hospitalShare,C.servicePostingNewGridDefinition.data[a].doctorShare=t.data.HITService.message.doctorShare,C.servicePostingNewGridDefinition.data[a].serviceRateStatus=t.data.HITService.message.serviceRateStatus,C.servicePostingNewGridDefinition.data[a].isDeleteBill=t.data.HITService.message.isDeleteBill,C.servicePostingNewGridDefinition.data[a].serviceType=t.data.HITService.message.serviceType,C.servicePostingNewGridDefinition.data[a].isMLCFlag=t.data.HITService.message.isMLCFlag,2==t.data.HITService.message.transType?C.servicePostingNewGridDefinition.data[a].doctorModifiedAmount=t.data.HITService.message.doctorModifiedAmount:C.servicePostingNewGridDefinition.data[a].doctorModifiedAmount=0,C.servicePostingNewGridDefinition.data[a].chargeableAmt=C.servicePostingNewGridDefinition.data[a].serviceRate-C.servicePostingNewGridDefinition.data[a].discountAmt;var r=C.servicePostingNewGridDefinition.data[a].serviceRate-C.servicePostingNewGridDefinition.data[a].discountAmt+C.servicePostingNewGridDefinition.data[a].tax;if(C.servicePostingNewGridDefinition.data[a].effectiveRate=parseFloat(r.toFixed(2)),C.servicePostingNewGridDefinition.data[a].renderedBy){if(C.servicePostingNewGridDefinition.data[a].employeeShareList[0]=C.servicePostingNewGridDefinition.data[a].renderedBy,angular.extend(C.servicePostingNewGridDefinition.data[a].employeeShareList[0],{doctorShare:C.servicePostingNewGridDefinition.data[a].doctorShare,proposedShare:C.servicePostingNewGridDefinition.data[a].doctorAmount}),C.servicePostingNewGridDefinition.data[a].employeeShareList.length>0)for(var n=0;n<C.servicePostingNewGridDefinition.data[a].employeeShareList.length;n++)C.servicePostingNewGridDefinition.data[a].employeeShareList[n].doctorShare=0,C.servicePostingNewGridDefinition.data[a].employeeShareList[0].doctorShare=t.data.HITService.message.doctorShare;"Y"==C.servicePostingNewGridDefinition.data[a].multiDoctor&&(C.servicepostingServiceVariantGridDefinition.data=C.servicePostingNewGridDefinition.data[a].employeeShareList,C.doctorShare=C.servicePostingNewGridDefinition.data[a].employeeShareList[0].doctorShare),3==t.data.HITService.message.transType&&(C.servicePostingNewGridDefinition.data[a].multiDoctor="N",C.servicePostingNewGridDefinition.data[a].effectiveRate=C.servicePostingNewGridDefinition.data[a].hospitalShare,C.servicePostingNewGridDefinition.data[a].chargeableAmt=C.servicePostingNewGridDefinition.data[a].hospitalShare)}if(o.gridObj)var l=_.findIndex(C.gridPopulateData,function(e){return e.servicePostingSeqId==C.servicePostingNewGridDefinition.data[a].servicePostingSeqId});else l=_.findIndex(C.gridPopulateData,function(e){return e.serviceVo.servSeqId==C.servicePostingNewGridDefinition.data[a].serviceVo.servSeqId});-1!=l&&(C.servicePostingNewGridDefinition.data[a].standardDoctorShare=null!=t.data.HITService.message.standardDoctorShare?t.data.HITService.message.standardDoctorShare:C.gridPopulateData[l].standardDoctorShare,C.servicePostingNewGridDefinition.data[a].proposedShareAfterDiscount=C.gridPopulateData[l].proposedShareAfterDiscount,C.servicePostingNewGridDefinition.data[a].standardSurcharge=C.gridPopulateData[l].standardSurcharge)}else g.information("Information",C.alertObj.recdAlrExstGrid,!1,!1,f.time)})},C.getShare=function(e){C.share=e},C.saveRecord=function(){C.renderError=!1,C.requestedError=!1;for(var e=!!C.projSpecApplicable&&C.projSpecApplicable,t=0;t<C.servicePostingNewGridDefinition.data.length;t++)C.servicePostingNewGridDefinition.data[t].renderedRole&&C.servicePostingNewGridDefinition.data[t].renderedBy.name||(C.renderError=!0),C.servicePostingNewGridDefinition.data[t].requestedBy.name||(C.requestedError=!0);if(C.renderError)return g.hisAlertMulti("information",C.alertObj.alertTypeInfo,C.alertObj.plzFilRndRleRndBy,C.alertData,C.alertFunction,C.close),void(C.serviceVar=!1);if(C.requestedError)return g.hisAlertMulti("information",C.alertObj.alertTypeInfo,C.alertObj.plzFilReqBy,C.alertData,C.alertFunction,C.close),void(C.serviceVar=!1);var a=angular.copy(C.servicePostingNewGridDefinition.data);for(t=0;t<a.length;t++)angular.extend(a[t],{enNo:p.patientGlobalDtls.encounterNo,specific:e});u.submitServicePostingNew(a,C.servicepostingServiceVariantGridDefinition.data).then(function(e){if(C.serviceVar=!1,e.data.HITService.message.errorCode)return g.hisAlertMulti("warning",C.alertObj.alertTypeWarn,e.data.HITService.message.errorMessage,C.alertData,C.alertFunction,C.close),void(C.serviceVar=!1);if(e.data.HITService.message){C.alertObj.ok;var t={buttonCallBack1:function(){C.closeFun()}},a={buttonClose:function(){C.closeFun()}};if(g.hisAlertMulti("success",C.alertObj.alertTypeSucss,C.alertObj.rcdSvdScsfly,!1,t,a,2e3),"Y"==C.integrationApplicableFlag){var i=e.data.HITService.message.servicePostingDetailsList[0]["com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo"],r=C.patientDetails.regSeqId,n="";if(Array.isArray(i))for(var l=0;l<i.length;l++)n=0==l?i[l].servicePostingSeqId:n+","+i[l].servicePostingSeqId;else n=i.servicePostingSeqId;Array.isArray(i)||(i[0]=i),y.prepareOrderObject(n,i,r,"Admission","sendOrderFinalizedReportForRis","com.napier.his.integration.service.external.RisService").then(function(e){})}}else g.hisAlertMulti("information",C.alertObj.alertTypeInfo,C.alertObj.dataNotSvd,C.alertData,C.alertFunction,C.close),C.serviceVar=!1})},C.saveRecordTemp=function(){C.serviceVar=!0,setTimeout(function(){C.saveRecord()},3e3)},C.updateRecordTemp=function(){C.serviceVar=!0,setTimeout(function(){C.updateRecord()},3e3)},C.updateRecord=function(){C.renderError=!1,C.requestedError=!1;for(var e=0;e<C.servicePostingNewGridDefinition.data.length;e++)2!=C.servicePostingNewGridDefinition.data[e].servicePostingType||C.servicePostingNewGridDefinition.data[e].renderedRole&&C.servicePostingNewGridDefinition.data[e].renderedBy.name||(C.renderError=!0),C.servicePostingNewGridDefinition.data[e].requestedBy.name||(C.requestedError=!0);if(C.renderError)return g.hisAlertMulti("information",C.alertObj.alertTypeInfo,C.alertObj.plzFilRndRleRndBy,C.alertData,C.alertFunction,C.close),void(C.serviceVar=!1);if(C.requestedError)return g.hisAlertMulti("information",C.alertObj.alertTypeInfo,C.alertObj.plzFilReqBy,C.alertData,C.alertFunction,C.close),void(C.serviceVar=!1);var t=angular.copy(C.servicePostingNewGridDefinition.data);for(e=0;e<t.length;e++)angular.extend(t[e],{enNo:p.patientGlobalDtls.encounterNo,patientCategoryCode:C.patientDetails.patientCategory.code,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:0,enProvider:0,enSpeciality:0,isAddendum:!1}}),angular.extend(t[e].serviceRateVo,{bedClassRateVos:[{"com.napier.core.service.vo.ratecard.BedClassRateVo":{"@class":"com.napier.core.service.vo.ratecard.BedClassRateVo",bedClassSeqId:C.patientDetails.bedClass.bedClassSeqId}}]});u.updateServicePostingNew(t,C.servicepostingServiceVariantGridDefinition.data).then(function(e){if(C.serviceVar=!1,e.data.HITService.message.errorCode){var t=e.data.HITService.message.errorMessage;return g.hisAlertMulti("information",C.alertObj.alertTypeInfo,t,C.alertData,C.alertFunction,C.close,2e3),void(C.serviceVar=!1)}if(e.data.HITService.message){C.alertObj.ok;var a={buttonCallBack1:function(){C.closeFun()}},i={buttonClose:function(){C.closeFun()}};g.hisAlertMulti("success",C.alertObj.alertTypeSucss,C.alertObj.rcrdUpdateSucfly,!1,a,i,2e3)}else g.hisAlertMulti("information",C.alertObj.alertTypeInfo,C.alertObj.dataNotSvd,C.alertData,C.alertFunction,C.close),C.serviceVar=!1})},C.multiSelectChange=function(e,t){if("Y"!=e.multiDoctor)return C.flag=!1,C.serviceVar=!1,C.servicepostingServiceVariantGridDefinition.data=[],C.servicePostingSearchData=[],void(C.previousIndex=t);if(C.serviceVar=!1,C.flag=!0,null!=C.previousIndex&&C.previousIndex!=t&&(C.servicePostingNewGridDefinitionApi.selection.unSelectRow(C.servicePostingNewGridDefinition.data[C.previousIndex]),C.servicePostingNewGridDefinition.data[C.previousIndex].multiDoctor="N"),o.gridObj?e.servicePostingSeqId==C.servicePostingNewGridDefinition.data[t].servicePostingSeqId?C.servicePostingNewGridDefinitionApi.selection.selectRow(C.servicePostingNewGridDefinition.data[t]):(C.servicePostingNewGridDefinitionApi.selection.unSelectRow(C.servicePostingNewGridDefinition.data[t]),C.servicePostingNewGridDefinition.data[t].multiDoctor="N"):e.serviceVo.servSeqId==C.servicePostingNewGridDefinition.data[t].serviceVo.servSeqId?C.servicePostingNewGridDefinitionApi.selection.selectRow(C.servicePostingNewGridDefinition.data[t]):(C.servicePostingNewGridDefinitionApi.selection.unSelectRow(C.servicePostingNewGridDefinition.data[t]),C.servicePostingNewGridDefinition.data[t].multiDoctor="N"),C.previousIndex=t,C.doctorShare=angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].doctorShare),C.serviceName=angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].serviceVo.servName),C.servicePostingSearchData=[],o.gridObj){C.servicePostingSearchData=angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].employeeShareList);var a=4==angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].requestedBy)?2:angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].requestedBy);0==C.servicePostingSearchData.length&&(C.servicePostingSearchData.push(angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].renderedBy)),angular.extend(C.servicePostingSearchData[0],{doctorShare:angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].doctorShare),proposedShare:angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].doctorAmount),DOCT_CODE:C.servicePostingSearchData[0].code,DOCT_NAME:C.servicePostingSearchData[0].name,EMP_SEQ_ID:C.servicePostingSearchData[0].seqId,entityType:a}))}else C.servicePostingSearchData.push(angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].renderedBy)),angular.extend(C.servicePostingSearchData[0],{doctorShare:angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].doctorShare),DOCT_CODE:C.servicePostingSearchData[0].code,DOCT_NAME:C.servicePostingSearchData[0].name,EMP_SEQ_ID:C.servicePostingSearchData[0].seqId}),C.servicePostingSearchData=angular.copy(C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].employeeShareList);C.servicepostingServiceVariantGridDefinition.data=C.servicePostingSearchData},C.amountChange=function(e){var t=_.findIndex(C.servicePostingNewGridDefinition.data,function(t){return t.serviceVo.servSeqId==e.serviceVo.servSeqId}),a=C.servicePostingNewGridDefinition.data[t].doctorModifiedAmount?C.servicePostingNewGridDefinition.data[t].doctorModifiedAmount:0;C.servicePostingNewGridDefinition.data[t].doctorShare=parseFloat(C.servicePostingNewGridDefinition.data[t].doctorAmount)+parseFloat(a),C.servicePostingNewGridDefinition.data[t].doctorShare=parseFloat(C.servicePostingNewGridDefinition.data[t].doctorShare.toFixed(2));var i=parseFloat(C.servicePostingNewGridDefinition.data[t].actualRate)*parseInt(C.servicePostingNewGridDefinition.data[t].quantity)+parseFloat(C.servicePostingNewGridDefinition.data[t].doctorShare);C.servicePostingNewGridDefinition.data[t].serviceRate=parseFloat(i.toFixed(2))},C.getAutoSearchQuery=function(e,t){C.servicePostingSearchData=[],C.departmentDroupDown=[],C.searchList={1:C.servicePostingSearchData};var a=m.executeQueryURLReset();return C.servicePostInputList=new Array,m.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,C.servicePostInputList),m.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,C.servicePostInputList),m.prepareParamListWithParam("pGnStatus",C.patientDetails.gnStatus?C.patientDetails.gnStatus:"%%",C.servicePostInputList),m.prepareParamListWithParam("pEmpseqid","",C.servicePostInputList),m.prepareParamListWithParam("pEmpName","%"+e+"%",C.servicePostInputList),m.prepareParamListWithParam("pEmpCode","",C.servicePostInputList),m.prepareParamListWithParam("pEmpType",C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].requestedRole,C.servicePostInputList),m.prepareParamListWithParam("pServSeqId",C.servicePostingNewGridDefinitionApi.selection.getSelectedRows()[0].serviceVo.servSeqId,C.servicePostInputList),m.prepareParamListWithParam("pDeptCode",null,C.servicePostInputList),m.prepareParamListWithParam("pIsOpConsApplicable","",C.servicePostInputList),m.prepareParamListWithParam("pIsIpConsApplicable",1,C.servicePostInputList),m.prepareParamListWithParam("pType",C.patientDetails.typeOfReg.code,C.servicePostInputList),m.executeQueryInput("SP_EMPLOYEE_SEARCH_NEW",C.servicePostInputList,C.searchList,!0,!0,a,"popUp",C.servicePostingNewGridDefinition.data).then(function(e){return e[1].length>0?C.servicePostingSearchData.map(function(e){return e}):[]})},C.selectEmployee=function(e){(angular.extend(e,{doctorShare:0,name:e.EMP_NAME,seqId:e.STAFF_ID,code:e.CODE,firstName:e.FIRSTNAME,lastName:e.LASTNAME,salutation:e.SALUTATION,gender:e.GENDER,category:e.CATEGORY,designation:e.DESIGNATION,regdNo:e.REGDNO,gnStatus:e.GN_STATUS}),C.servicepostingServiceVariantGridDefinition.data.length>0)?-1==_.findIndex(C.servicepostingServiceVariantGridDefinition.data,function(t){return t.seqId==e.STAFF_ID})?C.servicepostingServiceVariantGridDefinition.data.push(e):g.hisAlertMulti("information",C.alertObj.alertTypeInfo,C.alertObj.recdAlrExstGrid,C.alertData,C.alertFunction,C.close):C.servicepostingServiceVariantGridDefinition.data.push(e);C.searchDoctor=""},C.closeFun=function(){t.go("index.billingSub.servicePosting",{patObj:JSON.stringify(C.patientDetails),visitType:C.visitType})},C.rateEditableChange=function(e,t,a){null!=e.minVal&&null!=e.maxVal&&null!=e.serviceRateVo&&null!=e.serviceRateVo.baseRate&&""!=e.serviceRateVo.baseRate?(parseFloat(e.serviceRateVo.baseRate)>=e.minVal?parseFloat(e.serviceRateVo.baseRate)<=e.maxVal||(e.serviceRateVo.baseRate=parseFloat(e.maxVal),e.tempValue=e.serviceRateVo.baseRate,g.hisAlertMulti("information",C.alertObj.alertTypeInfo,"Service Rate Can't Be More Than Maximum Value For Rate",C.alertData,C.alertFunction,C.close)):(e.serviceRateVo.baseRate=parseFloat(e.minVal),e.tempValue=e.serviceRateVo.baseRate,g.hisAlertMulti("information",C.alertObj.alertTypeInfo,"Service Rate Can't Be Less Than Minimum Value For Rate",C.alertData,C.alertFunction,C.close)),null!=e.quantity&&""!=e.quantity&&(e.serviceRate=e.serviceRateVo.baseRate*e.quantity,C.changeQuantity(e,!1,t,e.serviceRate,a))):(null!=e.minVal&&""!=e.minVal?(e.serviceRateVo.baseRate=parseFloat(e.minVal),e.tempValue=e.serviceRateVo.baseRate,null!=e.quantity&&""!=e.quantity?e.serviceRate=e.serviceRateVo.baseRate*e.quantity:e.serviceRate=e.serviceRateVo.baseRate,g.hisAlertMulti("information",C.alertObj.alertTypeInfo,"Service Rate Can't Be Less Than Minimum Value For Rate",C.alertData,C.alertFunction,C.close)):null!=e.serviceRateVo&&null!=e.serviceRateVo.baseRate&&""!=e.serviceRateVo.baseRate?(null!=e.quantity&&""!=e.quantity?e.serviceRate=e.serviceRateVo.baseRate*e.quantity:e.serviceRate=e.serviceRateVo.baseRate,C.changeQuantity(e,!1,t,e.serviceRate,a)):e.serviceRate=0,null!=e.quantity&&""!=e.quantity&&(e.serviceRate=e.serviceRateVo.baseRate*e.quantity,C.changeQuantity(e,!1,t,e.serviceRate,a)))},C.minMaxValidForDoc=function(e){if(null!=e.minVal&&null!=e.maxVal&&null!=e.serviceRateVo&&null!=e.serviceRateVo.baseRate&&""!=e.serviceRateVo.baseRate&&null!=e.doctorModifiedAmount&&null!=e.doctorModifiedAmount&&""!=e.doctorModifiedAmount&&1==e.priority){let t,a=0;return parseFloat(e.doctorModifiedAmount)>=parseFloat(e.doctorAmount)?(a=parseFloat(e.doctorModifiedAmount)-parseFloat(e.doctorAmount),t=parseFloat(e.serviceRateVo.baseRate)+parseFloat(a)):(a=parseFloat(e.doctorAmount)-parseFloat(e.doctorModifiedAmount),t=parseFloat(e.serviceRateVo.baseRate)-parseFloat(a)),t>=e.minVal?t<=e.maxVal||(e.doctorModifiedAmount=e.doctorAmount,g.hisAlertMulti("information",C.alertObj.alertTypeInfo,"Total  Of Hospital Share And Doctor Share Can't Be More Than Maximum Value For Rate",C.alertData,C.alertFunction,C.close),!1):(e.doctorModifiedAmount=e.doctorAmount,g.hisAlertMulti("information",C.alertObj.alertTypeInfo,"Total  Of Hospital Share And Doctor Share Can't Be Less Than Minimum Value For Rate",C.alertData,C.alertFunction,C.close),!1)}return 1!=e.priority||(null!=e.serviceRateVo&&null!=e.serviceRateVo.baseRate&&0==e.serviceRateVo.baseRate||void 0)},C.patientDetails=angular.copy(angular.fromJson(o.patObj)),C.visitType=angular.copy(C.patientDetails.visitType),d.getPatientBanner(C.patientDetails,C.visitType).then(function(e){p.patientGlobalDtls=e,p.patientGlobalDtls.userPermision=12,C.fromDateOptions.minDate=new Date(p.patientGlobalDtls.admissionDate)}),c.patientBannerDetail(C.patientDetails.regSeqId).then(function(e){if(p.patientBannerDetails=e,p.patientRecordsDetail=p.patientBannerDetails.patientRecordsDetail,o.gridObj){C.editOption=!0;for(var t=angular.copy(angular.fromJson(o.gridObj).length),a=0;a<t;a++){C.object=angular.copy(angular.fromJson(o.gridObj)[a]),C.object.servicePostingType="Rendered"==C.object.servicePostingType?2:1,C.renderedStatus[C.object.servicePostingSeqId]=C.object.servicePostingType,C.object.requestedDate=C.object.requestedDateTime?new Date(C.object.requestedDateTime.$):new Date,C.object.renderedDate=C.object.renderedDateTime?new Date(C.object.renderedDateTime.$):new Date,C.object.priority="Routine"==C.object.priority?1:"STAT"==C.object.priority?3:2,C.object.tax=C.object.taxAmt?C.object.taxAmt:0,C.object.multiDoctor="N",C.object.applicableTariff=C.object.tarrifCategory;var i=parseFloat(C.object.serviceRate)-parseFloat(C.object.discountAmt)+parseFloat(C.object.tax);C.object.effectiveRate=parseFloat(i.toFixed(2)),C.object.renderedRole=C.object.renderedByEmpCode,C.object.requestedRole=C.object.requestedByEmpCode,C.object.doctorShare=C.object.doctorShare?C.object.doctorShare:0,C.object.requestedBy={name:C.object.requestedByEmpName,seqId:C.object.requestedByEmpSeqID},C.object.employeeShareList=[];var r=null!=C.object.multiEmployeeShareList&&null!=C.object.multiEmployeeShareList.employeeShareList?angular.copy(C.object.multiEmployeeShareList.employeeShareList[0]["com.napier.core.scm.serviceposting.vo.EmployeeShareVo"]):[];r=r instanceof Array?r:[r];for(var n=0;n<r.length;n++)if(2==r[n].entityType&&4==C.object.renderedByEmpCode){var l={doctorShare:r[n].billedShare,code:r[n].employee.code,seqId:r[n].employee.empSeqId,name:r[n].employee.description,proposedShare:r[n].proposedShare,entityType:r[n].entityType};C.object.employeeShareList.push(l)}else if(3==r[n].entityType&&3==C.object.renderedByEmpCode){var l={doctorShare:r[n].billedShare,code:r[n].employee.code,seqId:r[n].employee.empSeqId,name:r[n].employee.description,proposedShare:r[n].proposedShare,entityType:r[n].entityType};C.object.employeeShareList.push(l)}else if(1==r[n].entityType&&1==C.object.renderedByEmpCode){var l={doctorShare:r[n].billedShare,code:r[n].employee.code,seqId:r[n].employee.empSeqId,name:r[n].employee.description,proposedShare:r[n].proposedShare,entityType:r[n].entityType};C.object.employeeShareList.push(l)}C.toDateOptions[a]={minDate:C.object.requestedDate,maxDate:new Date},C.getSearchQuery(angular.copy(C.object),"renderedBy")}}else C.editOption=!1}),delete C.patientDetails.visitType,C.openedFrom={},C.openedTo={},C.renderedStatus=[],function(){C.serviceStatus=[],C.serviceStatusComboList={1:C.serviceStatus};var e=m.executeQueryURLReset();C.serviceStatusList=new Array,m.prepareParamList(1,"45002",C.serviceStatusList),m.executeQueryInput("TRN003",C.serviceStatusList,C.serviceStatusComboList,!0,!1,e,"popUp",C.servicePostingNewGridDefinition)}(),function(){C.servicePriority=[],C.servicePriorityComboList={1:C.servicePriority};var e=m.executeQueryURLReset();C.servicePriorityList=new Array,m.prepareParamListWithParam("pMasterSqId",45005,C.servicePriorityList),m.executeQueryInput("PRIORITY_TYPE",C.servicePriorityList,C.servicePriorityComboList,!0,!0,e,"popUp",C.servicePostingNewGridDefinition)}(),function(){C.blAccount=[],C.blAccountList={1:C.blAccount};var e=m.executeQueryURLReset();C.blNameList=new Array,m.prepareParamListWithParam("pEnSeqId",C.patientDetails.encounterSeqId,C.blNameList),m.executeQueryInput("BL_ACCOUNT_DETAILS",C.blNameList,C.blAccountList,!0,!0,e,"popUp",C.servicepostingServiceVariantGridDefinition)}(),function(){C.common=[],C.commonList={1:C.common};var e=m.executeQueryURLReset();C.servNameList=new Array,m.prepareParamListWithParam("pAdmSeqID",C.patientDetails.admissionSeqid,C.servNameList),m.prepareParamListWithParam("pCurrDate",moment().format("YYYY-MM-DD"),C.servNameList),m.executeQueryInput("BL_M_COMMON_001",C.servNameList,C.commonList,!0,!0,e,"popUp",C.servicepostingServiceVariantGridDefinition)}(),function(){C.encounter=[],C.encounterList={1:C.encounter};var e=m.executeQueryURLReset();C.encounterNameList=new Array,m.prepareParamListWithParam("pRgSeqId",C.patientDetails.regSeqId,C.encounterNameList),m.prepareParamListWithParam("pFacilityId",C.patientDetails.facilityId.code,C.encounterNameList),m.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,C.encounterNameList),m.prepareParamListWithParam("pEncStrtDate","1901-01-01",C.encounterNameList),m.prepareParamListWithParam("pEncEndDate","2099-01-01",C.encounterNameList),m.executeQueryInput("SP_ENCOUNTER_NO",C.encounterNameList,C.encounterList,!0,!0,e,"popUp",C.servicePostingNewGridDefinition)}(),function(){C.folioNo=[],C.folioNoList={1:C.folioNo};var e=m.executeQueryURLReset();C.getFolioNo=new Array,m.prepareParamListWithParam("pAdmSeqId",C.patientDetails.admissionSeqid,C.getFolioNo),m.prepareParamListWithParam("pIsActive",1,C.getFolioNo),m.executeQueryInput("GET_FOLIO_NO",C.getFolioNo,C.folioNoList,!0,!0,e,"popUp",C.servicepostingServiceVariantGridDefinition)}(),function(){C.roles=[],C.roleList={1:C.roles};var e=m.executeQueryURLReset();C.servRoleList=new Array,m.prepareParamListWithParam("pMasterSqId",104,C.servRoleList),m.prepareParamListWithParam("pType",C.patientDetails.typeOfReg.code,C.servRoleList),m.executeQueryInput("GET_CALLED_BY_ROLE",C.servRoleList,C.roleList,!0,!0,e,"popUp",C.servicepostingServiceVariantGridDefinition)}(),function(){C.serviceTrans=[],C.serviceTransComboList={1:C.serviceTrans};var e=m.executeQueryURLReset();C.serviceTranList=new Array,m.prepareParamListWithParam("pMasterSqId",45003,C.serviceTranList),m.executeQueryInput("TRN003",C.serviceTranList,C.serviceTransComboList,!0,!0,e,"popUp",C.servicePostingNewGridDefinition)}(),C.gridPopulateData=[],C.servicePosting=[{id:1,description:"Planned"},{id:2,description:"Rendered"}]}e.$inject=["hisCalDefConstant","$state","hisModalService","hisTranslationsService","servicePostingNewGridDefinition","servicepostingNewServiceSearchAddGridDefinition","servicepostingNewServiceSearchGridDefinition","servicepostingServiceVariantGridDefinition","$stateParams","PatientBannerBilling","PatientBannerGlobal","$scope","servicePostingNewService","QueryService","hisAlertService","hisTranslationsGlobalLang","hisGenericAlertService","hisConfigurationService","integrationService","hisAlertConstants"],angular.module("napierContainerUi").controller("servicePostingNewController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o){var c=this;c.servicepostingNewDocSearchGridDefinition=angular.copy(e),l.loadModule("billing");var d=s.getLanguageToSet();l.changeLanguage(d),c.alertObj={},o.loadAlerts(d).then(function(e){c.alertObj=e,c.alertData={buttonText:c.alertObj.ok},c.alertFunction={buttonCallBack1:function(){}},c.close={buttonClose:function(){}}}),c.servicepostingNewDocSearchGridDefinition.onRegisterApi=function(e){c.servicepostingNewDocSearchGridDefinitionApi=e,e.core.on.sortChanged(t,function(e,t){})},c.getAutoSearchQuery=function(e,t){c.servicePostingSearchData=[],c.departmentDroupDown=[],c.searchList={1:c.servicePostingSearchData};var i=a.executeQueryURLReset();return c.servicePostInputList=new Array,a.prepareParamListWithParam("pPracticeId",c.serviceDetails.practiceId?c.serviceDetails.practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,c.servicePostInputList),a.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,c.servicePostInputList),a.prepareParamListWithParam("pGnStatus",c.patientDetails.gnStatus?c.patientDetails.gnStatus:"%%",c.servicePostInputList),a.prepareParamListWithParam("pEmpseqid","",c.servicePostInputList),"employeeName"==t?a.prepareParamListWithParam("pEmpName","%"+e+"%",c.servicePostInputList):a.prepareParamListWithParam("pEmpCode",e,c.servicePostInputList),a.prepareParamListWithParam("pEmpType",c.serviceDetails.renderedRole?c.serviceDetails.renderedRole:"",c.servicePostInputList),a.prepareParamListWithParam("pServSeqId",c.serviceDetails.serviceVo.servSeqId,c.servicePostInputList),a.prepareParamListWithParam("pDeptCode",null,c.servicePostInputList),a.prepareParamListWithParam("pIsOpConsApplicable","",c.servicePostInputList),a.prepareParamListWithParam("pIsIpConsApplicable",1,c.servicePostInputList),a.prepareParamListWithParam("pType","2",c.servicePostInputList),a.executeQueryInput("SP_EMPLOYEE_SEARCH_NEW",c.servicePostInputList,c.searchList,!0,!0,i,"popUp",c.servicepostingNewDocSearchGridDefinition).then(function(e){return e[1].length>0?c.servicePostingSearchData.map(function(e){return e}):[]})},c.getSearchQuery=function(){c.servicePostingSearchData=[],c.departmentDroupDown=[],c.searchList={1:c.servicePostingSearchData};var e=a.executeQueryURLReset();c.servicePostInputList=new Array,a.prepareParamListWithParam("pPracticeId",c.serviceDetails.practiceId?c.serviceDetails.practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,c.servicePostInputList),a.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,c.servicePostInputList),a.prepareParamListWithParam("pGnStatus",c.patientDetails.gnStatus?c.patientDetails.gnStatus:"%%",c.servicePostInputList),a.prepareParamListWithParam("pEmpName",c.searchData.pEmpName?c.searchData.pEmpName:"%%",c.servicePostInputList),a.prepareParamListWithParam("pEmpseqid",c.searchData.pEmpseqid?c.searchData.pEmpseqid.gQDataCode:"",c.servicePostInputList),a.prepareParamListWithParam("pEmpCode",c.searchData.pEmpCode?c.searchData.pEmpCode:"",c.servicePostInputList),a.prepareParamListWithParam("pEmpType",c.serviceDetails.renderedRole?c.serviceDetails.renderedRole:"",c.servicePostInputList),a.prepareParamListWithParam("pServSeqId",c.serviceDetails.serviceVo.servSeqId,c.servicePostInputList),a.prepareParamListWithParam("pDeptCode",c.searchData.pDeptCode?c.searchData.pDeptCode:null,c.servicePostInputList),a.prepareParamListWithParam("pIsOpConsApplicable",c.searchData.pIsOpConsApplicable?c.searchData.pIsOpConsApplicable:"",c.servicePostInputList),a.prepareParamListWithParam("pIsIpConsApplicable",1,c.servicePostInputList),a.prepareParamListWithParam("pType","2",c.servicePostInputList),a.executeQueryInput("SP_EMPLOYEE_SEARCH_NEW",c.servicePostInputList,c.searchList,!0,!0,e,"popUp",c.servicepostingNewDocSearchGridDefinition).then(function(e){c.servicepostingNewDocSearchGridDefinition.data=c.servicePostingSearchData})},c.addSelectedData=function(e){n.close(c.servicepostingNewDocSearchGridDefinitionApi.selection.getSelectedRows())},c.searchData={},c.serviceDetails=angular.copy(i),c.patientDetails=angular.copy(angular.fromJson(r.patObj)),function(){c.dept=[],c.deptComboList={1:c.dept};var e=a.executeQueryURLReset();c.deptList=new Array,a.prepareParamList(3,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,c.deptList),a.executeQueryInput("LBMAQ053",c.deptList,c.deptComboList,!0,!0,e,"popUp",c.servicepostingNewDocSearchGridDefinition)}(),c.getSearchQuery()}e.$inject=["servicePostingNewDocSearchGridDefinition","$scope","QueryService","serviceDetails","$stateParams","$uibModalInstance","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService"],angular.module("napierContainerUi").controller("servicePostingNewDocModalController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o){var c=this;c.servicepostingNewEmpSearchGridDefinition=angular.copy(e),l.loadModule("billing");var d=s.getLanguageToSet();l.changeLanguage(d),c.alertObj={},o.loadAlerts(d).then(function(e){c.alertObj=e,c.alertData={buttonText:c.alertObj.ok},c.alertFunction={buttonCallBack1:function(){}},c.close={buttonClose:function(){}}}),c.servicepostingNewEmpSearchGridDefinition.onRegisterApi=function(e){c.servicepostingNewEmpSearchGridDefinitionApi=e,e.core.on.sortChanged(t,function(e,t){})},c.getAutoSearchQuery=function(e,t){c.servicePostingSearchData=[],c.departmentDroupDown=[],c.searchList={1:c.servicePostingSearchData};var i=a.executeQueryURLReset();return c.servicePostInputList=new Array,a.prepareParamListWithParam("pPracticeId",c.serviceDetails.practiceId?c.serviceDetails.practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,c.servicePostInputList),a.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,c.servicePostInputList),a.prepareParamListWithParam("pGnStatus",c.patientDetails.gnStatus?c.patientDetails.gnStatus:"%%",c.servicePostInputList),a.prepareParamListWithParam("pEmpseqid","",c.servicePostInputList),"employeeName"==t?a.prepareParamListWithParam("pEmpName","%"+e+"%",c.servicePostInputList):a.prepareParamListWithParam("pEmpCode",e,c.servicePostInputList),"requestedBy"==c.serviceDetails.role?(a.prepareParamListWithParam("pEmpType",c.serviceDetails.requestedRole?c.serviceDetails.requestedRole:"",c.servicePostInputList),a.prepareParamListWithParam("pType","1",c.servicePostInputList)):"renderedBy"==c.serviceDetails.role?(a.prepareParamListWithParam("pEmpType",c.serviceDetails.renderedRole?c.serviceDetails.renderedRole:"",c.servicePostInputList),a.prepareParamListWithParam("pType","2",c.servicePostInputList)):"cancelRequestedBy"==c.serviceDetails.role&&(a.prepareParamListWithParam("pEmpType",c.serviceDetails.cancelRequestedRole?c.serviceDetails.cancelRequestedRole.DT_CODE:"",c.servicePostInputList),a.prepareParamListWithParam("pType","2",c.servicePostInputList)),a.prepareParamListWithParam("pServSeqId",c.serviceDetails.serviceVo.servSeqId,c.servicePostInputList),a.prepareParamListWithParam("pDeptCode",null,c.servicePostInputList),a.prepareParamListWithParam("pIsOpConsApplicable","",c.servicePostInputList),a.prepareParamListWithParam("pIsIpConsApplicable","",c.servicePostInputList),a.executeQueryInput("SP_EMPLOYEE_SEARCH_NEW",c.servicePostInputList,c.searchList,!0,!0,i,"popUp",c.servicepostingNewEmpSearchGridDefinition).then(function(e){return e[1].length>0?c.servicePostingSearchData.map(function(e){return e}):[]})},c.getSearchQuery=function(){c.servicePostingSearchData=[],c.departmentDroupDown=[],c.searchList={1:c.servicePostingSearchData};var e=a.executeQueryURLReset();c.servicePostInputList=new Array,a.prepareParamListWithParam("pPracticeId",c.serviceDetails.practiceId?c.serviceDetails.practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,c.servicePostInputList),a.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,c.servicePostInputList),a.prepareParamListWithParam("pGnStatus",c.patientDetails.gnStatus?c.patientDetails.gnStatus:"%%",c.servicePostInputList),a.prepareParamListWithParam("pEmpName",c.searchData.pEmpName?c.searchData.pEmpName:"%%",c.servicePostInputList),a.prepareParamListWithParam("pEmpseqid",c.searchData.pEmpseqid?c.searchData.pEmpseqid.gQDataCode:"",c.servicePostInputList),a.prepareParamListWithParam("pEmpCode",c.searchData.pEmpCode?c.searchData.pEmpCode:"",c.servicePostInputList),"requestedBy"==c.serviceDetails.role?(a.prepareParamListWithParam("pEmpType",c.serviceDetails.requestedRole?c.serviceDetails.requestedRole:"",c.servicePostInputList),a.prepareParamListWithParam("pType","1",c.servicePostInputList)):"renderedBy"==c.serviceDetails.role?(a.prepareParamListWithParam("pEmpType",c.serviceDetails.renderedRole?c.serviceDetails.renderedRole:"",c.servicePostInputList),a.prepareParamListWithParam("pType","2",c.servicePostInputList)):"cancelRequestedBy"==c.serviceDetails.role&&(a.prepareParamListWithParam("pEmpType",c.serviceDetails.cancelRequestedRole?c.serviceDetails.cancelRequestedRole.DT_CODE:"",c.servicePostInputList),a.prepareParamListWithParam("pType","2",c.servicePostInputList)),a.prepareParamListWithParam("pServSeqId",c.serviceDetails.serviceVo.servSeqId,c.servicePostInputList),a.prepareParamListWithParam("pDeptCode",c.searchData.pDeptCode?c.searchData.pDeptCode:null,c.servicePostInputList),a.prepareParamListWithParam("pIsOpConsApplicable",c.searchData.pIsOpConsApplicable?c.searchData.pIsOpConsApplicable:"",c.servicePostInputList),a.prepareParamListWithParam("pIsIpConsApplicable","",c.servicePostInputList),a.executeQueryInput("SP_EMPLOYEE_SEARCH_NEW",c.servicePostInputList,c.searchList,!0,!0,e,"popUp",c.servicepostingNewEmpSearchGridDefinition).then(function(e){c.servicepostingNewEmpSearchGridDefinition.data=c.servicePostingSearchData})},c.employeeSelection=function(e){n.close(e)},c.searchData={},c.serviceDetails=angular.copy(i),c.patientDetails=angular.copy(angular.fromJson(r.patObj)),function(){c.dept=[],c.deptComboList={1:c.dept};var e=a.executeQueryURLReset();c.deptList=new Array,a.prepareParamList(3,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,c.deptList),a.executeQueryInput("LBMAQ053",c.deptList,c.deptComboList,!0,!0,e,"popUp",c.servicepostingNewEmpSearchGridDefinition)}(),c.getSearchQuery()}e.$inject=["servicepostingNewEmpSearchGridDefinition","$scope","QueryService","serviceDetails","$stateParams","$uibModalInstance","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService"],angular.module("napierContainerUi").controller("servicePostingNewEmpModalController",e)}(),function(){"use strict";function e(e,t,a,i,r,n,l,s,o,c,d){var p=this;a.isOpen=!0,s.loadModule("billing");var u=o.getLanguageToSet();s.changeLanguage(u),p.alertObj={},c.loadAlerts(u).then(function(e){p.alertObj=e,p.alertData={buttonText:p.alertObj.ok},p.alertFunction={buttonCallBack1:function(){}},p.close={buttonClose:function(){}}}),p.servicepostingNewServiceSearchGridDefinition=angular.copy(t),p.servicepostingNewServiceSearchAddGridDefinition=angular.copy(e),p.servicepostingNewServiceSearchGridDefinition.onRegisterApi=function(e){p.servicepostingNewServiceSearchGridDefinitionApi=e},p.servicepostingNewServiceSearchAddGridDefinition.onRegisterApi=function(e){p.servicepostingNewServiceSearchAddGridDefinitionApi=e},p.secSrvceType=function(e){p.secServName=[],p.secSrvceList={1:p.secServName};var t=i.executeQueryURLReset();p.secServNameList=new Array,i.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,p.secServNameList),i.prepareParamList(2,e.gQDataCode,p.secServNameList),i.executeQueryInput("EST_BILL_SERV_002",p.secServNameList,p.secSrvceList,!0,!0,t,"popUp")},p.removeData=function(e){var t=_.findIndex(p.servicepostingNewServiceSearchAddGridDefinition.data,function(t){return t.servSeqId==e.servSeqId});p.servicepostingNewServiceSearchAddGridDefinition.data.splice(t,1)},p.serviceType=function(e){p.servName=[],p.serviceTypeList={1:p.servName};var t=i.executeQueryURLReset();p.servNameList=new Array,i.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,p.servNameList),i.prepareParamList(2,e.gQDataCode,p.servNameList),i.executeQueryInput("SCM_SERV_003",p.servNameList,p.serviceTypeList,!0,!0,t,"popUp")},p.getAutoSearchQuery=function(e,t){p.servicePostingSearchData=[],p.departmentDroupDown=[],p.searchList={1:p.servicePostingSearchData};var a=i.executeQueryURLReset();return p.servicePostInputList=new Array,i.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,p.servicePostInputList),i.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,p.servicePostInputList),"serviceCode"==t?i.prepareParamListWithParam("pServCode","%"+e+"%",p.servicePostInputList):i.prepareParamListWithParam("pServName","%"+e+"%",p.servicePostInputList),i.prepareParamListWithParam("pPriServTypeCode","-999",p.servicePostInputList),i.prepareParamListWithParam("pSecServTypeCode","-999",p.servicePostInputList),i.prepareParamListWithParam("pServTypeCode","-999",p.servicePostInputList),i.prepareParamListWithParam("pServDesign","-999",p.servicePostInputList),i.prepareParamListWithParam("pFlowElement","1",p.servicePostInputList),i.prepareParamListWithParam("pServStatus","1",p.servicePostInputList),i.prepareParamListWithParam("pServDefStatus","1",p.servicePostInputList),i.prepareParamListWithParam("pDepartment","-999",p.servicePostInputList),i.prepareParamListWithParam("pIsEmergency","-999",p.servicePostInputList),i.prepareParamListWithParam("pExcludePri","7",p.servicePostInputList),i.prepareParamListWithParam("pBedClass",p.patientDetails.bedClassCode,p.servicePostInputList),i.prepareParamListWithParam("pTariffCode",p.patientDetails.tariffSeqId,p.servicePostInputList),i.prepareParamListWithParam("pIsancillary","-999",p.servicePostInputList),i.prepareParamListWithParam("pDocSeqId",p.patientDetails.primaryDocSeqId,p.servicePostInputList),i.prepareParamListWithParam("pSpecSeqId",p.patientDetails.primaryDoctSpecSeqId,p.servicePostInputList),i.executeQueryInput("SCM_SERVICE_LIST_NEW",p.servicePostInputList,p.searchList,!0,!0,a,"popUp",p.servicepostingNewServiceSearchGridDefinition).then(function(e){return e[1].length>0?p.servicePostingSearchData.map(function(e){return e}):[]})},p.getSearchQuery=function(){p.servicePostingSearchData=[],p.departmentDroupDown=[],p.searchList={1:p.servicePostingSearchData};var e=i.executeQueryURLReset();p.servicePostInputList=new Array,i.prepareParamListWithParam("pPracticeId",angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,p.servicePostInputList),i.prepareParamListWithParam("pFacilityId",angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,p.servicePostInputList),i.prepareParamListWithParam("pServCode",p.searchData.pServCode?"%"+p.searchData.pServCode+"%":"%%",p.servicePostInputList),i.prepareParamListWithParam("pServName",p.searchData.pServName?"%"+p.searchData.pServName+"%":"%%",p.servicePostInputList),i.prepareParamListWithParam("pPriServTypeCode",p.searchData.priServType?p.searchData.priServType.gQDataCode:"-999",p.servicePostInputList),i.prepareParamListWithParam("pSecServTypeCode",p.searchData.secServType?p.searchData.secServType.gQDataCode:"-999",p.servicePostInputList),i.prepareParamListWithParam("pServTypeCode",p.searchData.servType?p.searchData.servType.gQDataCode:"-999",p.servicePostInputList),i.prepareParamListWithParam("pServDesign",p.searchData.pServDesign?p.searchData.pServDesign:"-999",p.servicePostInputList),i.prepareParamListWithParam("pFlowElement",p.searchData.pFlowElement?p.searchData.pFlowElement:"1",p.servicePostInputList),i.prepareParamListWithParam("pServStatus",p.searchData.pServStatus?p.searchData.pServStatus:"1",p.servicePostInputList),i.prepareParamListWithParam("pServDefStatus",p.searchData.pServDefStatus?p.searchData.pServDefStatus:"1",p.servicePostInputList),i.prepareParamListWithParam("pDepartment",p.searchData.pDepartment?p.searchData.pDepartment:"-999",p.servicePostInputList),i.prepareParamListWithParam("pIsEmergency",p.searchData.pIsEmergency?p.searchData.pIsEmergency:"-999",p.servicePostInputList),i.prepareParamListWithParam("pExcludePri",p.searchData.pExcludePri?p.searchData.pExcludePri:"7",p.servicePostInputList),i.prepareParamListWithParam("pBedClass",p.patientDetails.bedClassCode,p.servicePostInputList),i.prepareParamListWithParam("pTariffCode",p.patientDetails.tariffSeqId,p.servicePostInputList),i.prepareParamListWithParam("pIsancillary",p.searchData.pServTypeCode?p.searchData.pServTypeCode:"-999",p.servicePostInputList),i.prepareParamListWithParam("pDocSeqId",p.patientDetails.primaryDocSeqId,p.servicePostInputList),i.prepareParamListWithParam("pSpecSeqId",p.patientDetails.primaryDoctSpecSeqId,p.servicePostInputList),i.executeQueryInput("SCM_SERVICE_LIST_NEW",p.servicePostInputList,p.searchList,!0,!0,e,"popUp",p.servicepostingNewServiceSearchGridDefinition).then(function(e){p.servicepostingNewServiceSearchGridDefinition.data=p.servicePostingSearchData})},p.addSelectedData=function(){if(0!=p.servicepostingNewServiceSearchGridDefinitionApi.selection.getSelectedRows().length)for(var e=0;e<p.servicepostingNewServiceSearchGridDefinitionApi.selection.getSelectedRows().length;e++){p.count=0,p.selectData=p.servicepostingNewServiceSearchGridDefinitionApi.selection.getSelectedRows()[e];var t={servSeqId:p.servicepostingNewServiceSearchGridDefinitionApi.selection.getSelectedRows()[e].SERV_SEQ_ID,bedClassSeqId:p.patientDetails.bedClassCode,tariffSeqId:p.patientDetails.tariffSeqId,admissionDate:p.patientDetails.admissionDate,effectiveOption:p.servicepostingNewServiceSearchGridDefinitionApi.selection.getSelectedRows()[e].AA_EFFECTIVE_OPTION,compSeqId:p.patientDetails.insuranceSeqId?p.patientDetails.insuranceSeqId:p.patientDetails.corporatePlanSeqId?p.patientDetails.corporatePlanSeqId:p.patientDetails.sponsorSeqId?p.patientDetails.sponsorSeqId:void 0,doctSeqId:p.patientDetails.primaryDocSeqId,specSeqId:p.patientDetails.primaryDoctSpecSeqId};n.rateCardService(t).then(function(e){if(e.data.HITService.message.errorMessage){var t=e.data.HITService.message.errorMessage;d.hisAlertMulti("information",p.alertObj.alertTypeInfo,t,p.alertData,p.alertFunction,p.close),p.acceptData=!0}else if(e.data.HITService.message.rcvSeqId&&(p.count=p.count+1,p.count==p.servicepostingNewServiceSearchGridDefinitionApi.selection.getSelectedRows().length))for(var a=angular.copy(p.servicepostingNewServiceSearchGridDefinitionApi.selection.getSelectedRows()),i=0;i<a.length;i++){var r=_.findIndex(p.servicepostingNewServiceSearchAddGridDefinition.data,function(e){return e.SERV_SEQ_ID==a[i].SERV_SEQ_ID}),n=_.findIndex(p.servicepostingNewServiceSearchGridDefinition.data,function(e){return e.SERV_SEQ_ID==a[i].SERV_SEQ_ID});-1==r?(a[i].VALUE=e.data.HITService.message.baseRate,a[i].EFFECTIVE_FROM=e.data.HITService.message.effectiveFrom.$,a[i].EFFECTIVE_TO=e.data.HITService.message.effectiveTo.$,a[i].tariffSeqId=e.data.HITService.message.tariffSeqId,p.servicepostingNewServiceSearchAddGridDefinition.data.push(a[i])):d.hisAlertMulti("information",p.alertObj.alertTypeInfo,p.alertObj.RcdAldyExt,p.alertData,p.alertFunction,p.close),-1!=n&&p.servicepostingNewServiceSearchGridDefinitionApi.selection.unSelectRow(p.servicepostingNewServiceSearchGridDefinition.data[n])}})}else d.hisAlertMulti("information",p.alertObj.alertTypeInfo,p.alertObj.plzSlctAnyServGrid,p.alertData,p.alertFunction,p.close)},p.acceptGrid=function(){p.servicepostingNewServiceSearchAddGridDefinition.data?l.close(p.servicepostingNewServiceSearchAddGridDefinition.data):d.hisAlertMulti("information",p.alertObj.alertTypeInfo,p.alertObj.plzSlctAnyServGrid,p.alertData,p.alertFunction,p.close)},p.searchData={},p.patientDetails=angular.copy(r.patientDetails),p.searchData.pServName=angular.copy(r.serviceDetailData),function(){p.priServiceType=[],p.primaryServiceList={1:p.priServiceType};var e=i.executeQueryURLReset();p.priServiceTypeList=new Array,i.prepareParamList(1,angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,p.priServiceTypeList),i.executeQueryInput("EST_BILL_SERV_001",p.priServiceTypeList,p.primaryServiceList,!0,!0,e,"popUp")}(),p.getSearchQuery()}e.$inject=["servicepostingNewServiceSearchAddGridDefinition","servicepostingNewServiceSearchGridDefinition","$scope","QueryService","patientDetails","servicePostingNewService","$uibModalInstance","hisTranslationsService","hisTranslationsGlobalLang","hisGenericAlertService","hisAlertService"],angular.module("napierContainerUi").controller("servicePostingNewModalController",e)}(),function(){"use strict";angular.module("napierContainerUi").service("GroupWiseService",["CallManager","$filter","IPINDENTAPIS",function(e,t,a){this.getServiceWise=function(i){var r=moment(i.toDate).format("YYYY-MM-DD"),n=t("date")(new Date,"yyyy-MM-dd"),l=t("date")(new Date,"yyyy-MM-dd")+" 23:59:00.000",s=!1;r==n&&(s=!0);var o={};return o.url=a.HISIPINDENT.URL,o.requestData={operation:"getServicePostingListServicegroupwiseSummary",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingFilterVo",patientId:i.patientInput.mrNo,billingStatus:i.serviceType,fromDate:null==i.frmDate||null==i.frmDate?i.patientInput.admissionDate.$:i.frmDate,toDate:null==i.toDate||null==i.toDate?l:s?l:i.toDate,practiseId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,priority:null==i.servPriority?i.test:i.servPriority.gQDataCode,servicePostingType:null==i.servStatus?i.test:i.servStatus.gQDataCode,flowValue:parseInt(i.visitType),ipAdmSeqId:i.patientInput.admissionSeqid,applyPackType:2}},e.sendRestRequest(o)},this.getBillWise=function(i){var r=moment(i.toDate).format("YYYY-MM-DD"),n=t("date")(new Date,"yyyy-MM-dd"),l=t("date")(new Date,"yyyy-MM-dd")+" 23:59:00.000",s=!1;r==n&&(s=!0);var o={};return o.url=a.HISIPINDENT.URL,o.requestData={operation:"getServicePostingListBillingGroupwiseSummary",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingFilterVo",patientId:i.patientInput.mrNo,billingStatus:i.serviceType,fromDate:null==i.frmDate||null==i.frmDate?i.patientInput.admissionDate.$:i.frmDate,toDate:null==i.toDate||null==i.toDate?l:s?l:i.toDate,practiseId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,priority:null==i.servPriority?i.test:i.servPriority.gQDataCode,servicePostingType:null==i.servStatus?i.test:i.servStatus.gQDataCode,flowValue:parseInt(i.visitType),ipAdmSeqId:i.patientInput.admissionSeqid,applyPackType:2}},e.sendRestRequest(o)}}])}(),function(){"use strict";angular.module("napierContainerUi").service("PatientBannerGlobal",["CallManager","IPINDENTAPIS","$q","hisTranslationsService","hisTranslationsGlobalLang",function(e,t,a,i,r){i.loadModule("commonBanner");var n=r.getLanguageToSet();i.changeLanguage(n),this.getPatientBanner=function(i,r){var n,l=a.defer(),s={},o=null==i.admissionSeqid?i.ipAdmSeqId:i.admissionSeqid;return s.url=t.HISIPINDENT.URL,s.requestData={operation:"getPatientBanner",messageId:"",destination:"com.napier.core.patientbanner.service.external.PatientBannerService",message:{}},"1"==r&&o?s.requestData.message={"@class":"com.napier.core.patientbanner.vo.PatientBannerSearch",ipAdmissionSeqId:o,context:3}:"2"!=r&&o||(s.requestData.message={"@class":"com.napier.core.patientbanner.vo.PatientBannerSearch",rgSeqId:i.regSeqId,encounterSeqId:null==i.regSeqId?i.enSeqId:void 0,context:2}),e.sendRestRequest(s).then(function(e){(n=e.data.HITService.message).userPermision=3,n.notAvail="NA",null!=n.admissionDate&&(n.admissionDate=new Date(n.admissionDate)),l.resolve(n)},function(e){l.resolve(e)}),l.promise}}])}(),function(){"use strict";angular.module("napierContainerUi").service("GetServicePostingListData",["CallManager","$filter","IPINDENTAPIS","hisAlertService","$state","PatientGlobal","QueryService",function(e,t,a,i,r,n,l){this.getServicePosting=function(i){var r=moment(i.toDate).format("YYYY-MM-DD"),n=t("date")(new Date,"yyyy-MM-dd"),l=t("date")(new Date,"yyyy-MM-dd")+" 23:59:00.000",s=!1;r==n&&(s=!0);var o={};return o.url=a.HISIPINDENT.URL,o.requestData={operation:"getServicePostingList",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingFilterVo",patientId:i.patientInput.mrNo,billingStatus:i.serviceType,fromDate:null==i.frmDate||null==i.frmDate?i.patientInput.admissionDate.$:i.frmDate,toDate:null==i.toDate||null==i.toDate?l:s?l:i.toDate,practiseId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID,facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,priority:null==i.servPriority?i.test:i.servPriority.gQDataCode,servicePostingType:null==i.servStatus?i.test:i.servStatus.gQDataCode,flowValue:parseInt(i.visitType),ipAdmSeqId:i.patientInput.admissionSeqid,applyPackType:2,folioSeqId:null==i.folioDtls&&null==i.folioDtls?-999:i.folioDtls.gQDataCode}},e.sendRestRequest(o)},this.getBillServicePostingData=function(i){var r={};return r.url=a.HISIPINDENT.URL,r.requestData={operation:"applyPackageForProvisionalBill",messageId:"",destination:"applyPackageCoreService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ApplyPackageVo",subAccSeqId:i.patientGlobalDtls.subAccSeqId,patientIpSeqId:i.patientInput.admissionSeqid,patientId:i.patientGlobalDtls.mrNo,billingStatus:null!=i.serviceType?i.serviceType:"0",fromDate:t("date")(new Date(i.patientGlobalDtls.admissionDate),"yyyy-MM-dd")+" 00:00:00.000",toDate:t("date")(new Date,"yyyy-MM-dd")+" 23:59:59.000",flowValue:parseInt(i.visitType),applyPackType:2,folioSeqId:null==i.folioDtls&&null==i.folioDtls?-999:i.folioDtls.gQDataCode,bedClassSequenceId:i.patientGlobalDtls.bedClassCode,payerSequenceId:4===i.patientGlobalDtls.checkFor?-999:i.patientGlobalDtls.insuranceSeqId}},e.sendRestRequest(r)},this.getVerifyValid=function(e){for(var t=0;t<e.data.length;t++){if("Planned"==e.data[t].servicePostingType&&4!=e.data[t].packApplyType){var a={buttonText:"OK"},r={buttonCallBack1:function(){}};return i.hisAlertMulti("warning","Warning","Bill Can Be Generated Only For Rendered Postings ",a,r),!1}if(t==e.data.length-1)for(var n=0;n<e.data.length;n++){if("Rendered"==e.data[n].servicePostingType)return!0;if(n==e.data.length-1){a={buttonText:"OK"},r={buttonCallBack1:function(){}};return i.hisAlertMulti("warning","Warning","Bill Cannot Be Generated For Cancel Postings ",a,r),!1}}}};this.billPostingInjection=function(e,a){(function(e,t){return n.paitentAutoSearchWithStatus(e,t)})(e,a).then(function(e){!function(e,a,i){var n;if(i.patientInput=e,i.folioAll=!1,null!=e.admissionDate&&null!=e.admissionDate.$?i.frmDate=e.admissionDate.$:(i.frmDate=new Date,null!=e.regDate&&e.regDate.$,i.frmDate=new Date),null==e.dischargedDate||null==e.dischargedDate.$?i.toDate=new Date:i.toDate=new Date(e.dischargedDate.$),null!=e.admissionSeqid){i.adm=e.admissionSeqid,n=e.admissionSeqid,i.billDtls=[],i.multipleComboDataForList2={1:i.billDtls};var s=l.executeQueryURLReset();i.billDtlsList=new Array,l.prepareParamListWithParam("pAdmSeqID",e.admissionSeqid,i.billDtlsList),l.prepareParamListWithParam("pCurrDate",t("date")(new Date,"yyyy-MM-dd"),i.billDtlsList),l.executeQueryInput("BL_M_COMMON_001",i.billDtlsList,i.multipleComboDataForList2,!0,!0,s,"popUp",{}).then(function(e){var t=e[1][0];if(null!=t&&null!=t.ACC_SEQ_ID){i.authLimit=[],i.multipleComboDataForListL={1:i.authLimit};var s=l.executeQueryURLReset();i.authLimitList=new Array,l.prepareParamListWithParam("pSubAccSeqId",t.SUB_ACC_SEQ_ID,i.authLimitList),l.executeQueryInput("PRE_AUTH_LIMIT_NEW",i.authLimitList,i.multipleComboDataForListL,!0,!0,s,"popUp").then(function(e){null!=e[1]&&null!=e[1]&&null!=e[1][0]&&null!=e[1][0].gQDataCode?i.authLimitValue=e[1][0].gQDataCode:i.authLimitValue=0,i.folio=[],i.multipleComboDataForList1={1:i.folio};var t=l.executeQueryURLReset();i.servicePriorityList=new Array,l.prepareParamListWithParam("pAdmSeqId",n,i.servicePriorityList),l.executeQueryInput("GET_FOLIO_NO",i.servicePriorityList,i.multipleComboDataForList1,!0,!0,t,"popUp").then(function(e){if(i.folioDtls=i.folio[0],i.folioAll=!0,null!=a){var t={patientInput:i.patientInput,serviceType:0,frmDate:i.frmDate,toDate:i.toDate,servPriority:void 0,servStatus:void 0,visitType:1,folioDtls:i.folioDtls,ammountValue:i.authLimitValue};r.go(a,{allObj:JSON.stringify(t),gridObj:void 0,visitType:1})}})})}})}else n=e.regDate.$,i.folioAll=!1}(e[0],"index.billingSub.serviceBillPosting",{})})},this.upDateServiceAliasName=function(t){var i={};return i.url=a.HISIPINDENT.URL,i.requestData={operation:"simpleUpdateForServicePosting",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",servicePostingSeqId:t.servicePostingSeqId,philHealthCode:t.servCode.PAYER_ALIAS_CODE,philHealthName:t.servCode.PAYER_ALIAS_NAME}},e.sendRestRequest(i)}}])}(),function(){"use strict";angular.module("napierContainerUi").service("GridColDef",["$translate","hisTranslationsService",function(e,t){function a(t){return e.instant(t)}this.getColumnDefAll=function(e,a){e.gridMenuTitleFilter=t.menuTranslate,e.columnDefs=[{field:"moduleId",displayName:"",cellTemplate:'<div class=""><div class="grid-indicator-block" ng-class=\'{"routine":COL_FIELD != "10", "routinePriority":COL_FIELD == "10"}\'></div></div>',width:10,pinnedLeft:!0},{name:"servCode",displayName:"billing.serviceCode",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!1,width:180,cellTemplate:'<div ng-if="!row.entity.fillHealth" class="ui-grid-cell-contents leftAlign">{{row.entity.servCode}}<span ><i  ng-if="row.entity.PayerServSeqId&&row.entity.isMultiServName==\'Y\' && grid.appScope.svp.roleValue.T_SCM_SERV_POST_EPAC" class="fa fa-pencil" ng-click="grid.appScope.svp.editGrid(row.entity)" ></i> </span></div><div class="ui-grid-cell-contents" ng-if="row.entity.fillHealth" ><input type="text" ng-model="row.entity.servCode" uib-typeahead="query as query.PAYER_ALIAS_CODE  for query in grid.appScope.svp.getAutoSearchQuery($viewValue,row.entity.PayerServSeqId) "  typeahead-min-length="2"  typeahead-on-select="row.entity.servName=row.entity.servCode.PAYER_ALIAS_NAME" style="margin-top: -4px;width:60%" typeahead-append-to-body=true  ><span ><i   ng-disabled="!row.entity.servCode" class="fa fa-check" aria-hidden="true" ng-click="grid.appScope.svp.closeGrid(row.entity,rowRenderIndex)" ></i><i ng-disabled="!row.entity.servCode" ng-click="row.entity.servCode=row.entity.serviceVo.servCode;row.entity.servName=row.entity.serviceVo.servName;row.entity.fillHealth=false;" class="fa fa-ban" aria-hidden="true"></i></span></div>',footerCellTemplate:'<div class="ui-grid-cell-contents">{{"billing.total"|translate}}</div>',headerCellFilter:"translate"},{name:"servName",displayName:"billing.serviceName",enableSorting:!0,enableCellEdit:!1,width:150,cellTemplate:'<div class="ui-grid-cell-contents leftAlign">{{row.entity.servName}}</div>',headerCellFilter:"translate"},{name:"baseRate",displayName:"billing.baseRate",enableSorting:!0,enableCellEdit:!1,width:82,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.baseRate}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{grid.appScope.svp.patientInput.baseRate | number: 2  }}</div>',aggregationType:a.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"quantity",displayName:"billing.quantity",enableSorting:!0,enableCellEdit:!1,width:80,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.quantity}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  }}</div>',aggregationType:a.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"serviceRate",displayName:"billing.serviceAmount",enableSorting:!0,enableCellEdit:!1,width:120,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.serviceRate}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{grid.appScope.svp.patientInput.serviceAmount | number: 2  }}</div>',aggregationType:a.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"discountAmt",displayName:"billing.discount",enableSorting:!0,enableCellEdit:!1,width:80,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.discountAmt}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{grid.appScope.svp.patientInput.discounts  }}</div>',aggregationType:a.aggregationTypes.sum},{name:"taxAmt",displayName:"billing.tax",enableSorting:!0,enableCellEdit:!1,width:65,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.taxAmt}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{grid.appScope.svp.patientInput.taxTotal  }}</div>',aggregationType:a.aggregationTypes.sum},{name:"actualRate",displayName:"billing.effectiveRate",enableSorting:!0,enableCellEdit:!1,width:103,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.actualRate}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{grid.appScope.svp.patientInput.effectiveRate | number: 2}}</div>',aggregationType:a.aggregationTypes.sum},{name:"nonChargableAmt",displayName:"billing.nonChrgblAmnt",enableSorting:!0,enableCellEdit:!1,width:175,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.nonChargableAmt}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{grid.appScope.svp.patientInput.nonCharge }}</div>',aggregationType:a.aggregationTypes.sum},{name:"packApplyTypeDesc",displayName:"billing.packageType",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:100},{name:"changeBed",displayName:"billing.billingBedCls",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:120},{name:"apliTariffdDesc",displayName:"billing.applicTariff",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:150},{name:"requestedDateTime",displayName:"billing.reqDateTime",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.requestedDateTime.$|date:"dd/MM/yyyy HH:mm"}}</div>',width:160},{name:"renderedByEmpName",displayName:"billing.renderBy",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:200},{name:"renderedDateTime",displayName:"billing.renderDateTime",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.renderedDateTime.$|date:"dd/MM/yyyy HH:mm"}}</div>',width:154},{name:"hospitalShare",displayName:"billing.hospShare",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:110,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.hospitalShare}}</div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{grid.appScope.svp.patientInput.hospitalSh | number: 2}}</div>',aggregationType:a.aggregationTypes.sum},{name:"doctorShare",displayName:" billing.docShare",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:100,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.doctorShare}}</div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{grid.appScope.svp.patientInput.docShare  }}</div>',aggregationType:a.aggregationTypes.sum},{name:"surcharge",displayName:"billing.docSurcharge",enableSorting:!0,enableCellEdit:!1,width:130,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.surcharge}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{grid.appScope.svp.patientInput.docSurcharge}}</div>',aggregationType:a.aggregationTypes.sum},{name:"surchargeOnDoctNoCharge",displayName:"billing.paySurcharge",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:130,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.surchargeOnDoctNoCharge}}</div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{grid.appScope.svp.patientInput.payerSurcharge  }}</div>',aggregationType:a.aggregationTypes.sum},{name:"priority",displayName:"billing.priority",enableSorting:!0,headerCellFilter:"translate",enableCellEdit:!1,width:100},{name:"servicePostingType",displayName:"billing.serviceStatus",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:100},{name:"isPharmacyService",displayName:"Action",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><div class="rightAlign" ng-show="row.entity.isPharmacyService!=\'\'" ng-click="grid.appScope.svp.viewPharmacyDetails(row)" role="button"><i class="fa fa-eye eye-color" aria-hidden="true"></i></div></div>',width:100}]},this.serviceWiseColDef=function(e,t){e.gridMenuTitleFilter=a,e.columnDefs=[{name:"primaryServiceCode",displayName:"billing.serviceTypeCode",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">Total</div>'},{name:"primaryService",displayName:"billing.serviceTypeName",enableSorting:!0,headerCellFilter:"translate",enableCellEdit:!1},{name:"quantity",displayName:"billing.quantity",enableSorting:!0,enableCellEdit:!1,width:77,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.quantity}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()  }}</div>',aggregationType:t.aggregationTypes.sum},{name:"discountAmt",displayName:"billing.discount",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.discount}}</div>',width:77,headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  }}</div>',aggregationType:t.aggregationTypes.sum},{name:"chargeableAmt",displayName:"billing.amt",enableSorting:!0,enableCellEdit:!1,width:71,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.chargeableAmt}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  }}</div>',aggregationType:t.aggregationTypes.sum},{name:"surcharge",displayName:"billing.surchrgeAmt",enableSorting:!0,enableCellEdit:!1,width:136,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.surcharge}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  }}</div>',aggregationType:t.aggregationTypes.sum},{name:"billingGroup",displayName:"billing.billingGroup",enableSorting:!0,headerCellFilter:"translate",enableCellEdit:!1}]},this.billWiseColDef=function(e,t){e.gridMenuTitleFilter=a,e.columnDefs=[{name:"billingGrpCodeDesc",displayName:"billing.billGrpName",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">Total</div>'},{name:"discountAmt",displayName:"billing.discount",enableSorting:!0,enableCellEdit:!1,width:77,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.discountAmt}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  }}</div>',aggregationType:t.aggregationTypes.sum},{name:"chargeableAmt",displayName:"billing.amt",enableSorting:!0,enableCellEdit:!1,width:71,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.chargeableAmt}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  }}</div>',aggregationType:t.aggregationTypes.sum},{name:"surcharge",width:135,displayName:"billing.surchrgeAmt",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.surcharge}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  }}</div>',aggregationType:t.aggregationTypes.sum},{name:"billingGrpCode",displayName:"billing.billGrpCode",enableSorting:!0,headerCellFilter:"translate",enableCellEdit:!1}]}}])}(),function(){"use strict";angular.module("napierContainerUi").service("UniqueService",function(){this.uniqueCount=function(e,t,a){var i=[];e instanceof Array?i=e:i.push(e);var r=[];e instanceof Array?r=e:r.push(e);for(var n=[],l=0;l<i.length;l++)for(var s=0,o=0;o<r.length;o++)if(i[l].serviceVo.servCode==r[o].serviceVo.servCode?(s+=1,1):0,o==r.length-1){if(s>1)for(var c=!0,d=0;d<n.length;d++)n[d].name==i[l].serviceVo.servCode&&(n[d].name=i[l].serviceVo.servCode,n[d].data=[s],c=!1),d==n.length-1&&c&&n.push({name:i[l].serviceVo.servCode,data:[s]});else n.push({name:i[l].serviceVo.servCode,data:[s]});0==n.length&&n.push({name:i[l].serviceVo.servCode,data:[s]})}t.uniqueValue=n.length},this.getUniqueData=function(e,t){if(t.data.length>0){var a=[];t.data instanceof Array?a=t.data:a.push(t.data);var i=[];e.data instanceof Array?i=t.data:i.push(t.data);for(var r=[],n=0;n<a.length;n++)if("Cancelled"!=a[n].servicePostingType)for(var l=0,s=0;s<i.length;s++)if(a[n].servCode==i[s].servCode&&(l+=1),s==i.length-1){if(l>1){for(var o=!0,c=0;c<r.length;c++)r[c].servCode==a[n].servCode&&(r[c].servCode=a[n].servCode,r[c].servName=a[n].servName,r[c].quantity=a[n].quantity+r[c].quantity,r[c].discountAmt=a[n].discountAmt+r[c].discountAmt,r[c].chargebleAmount=a[n].actualRate+r[c].chargebleAmount,r[c].surcharge=a[n].surcharge+r[c].surcharge,r[c].servicePostingSeqId=a[n].servicePostingSeqId,r[c].PayerServSeqId=a[n].PayerServSeqId,r[c].isMultiServName=a[n].isMultiServName,o=!1);o&&r.push({servCode:a[n].servCode,servName:a[n].servName,quantity:a[n].quantity,discountAmt:a[n].discountAmt,chargebleAmount:a[n].actualRate,surcharge:a[n].surcharge,servicePostingSeqId:a[n].servicePostingSeqId,PayerServSeqId:a[n].PayerServSeqId,isMultiServName:a[n].isMultiServName})}else r.push({servCode:a[n].servCode,servName:a[n].servName,quantity:a[n].quantity,discountAmt:a[n].discountAmt,chargebleAmount:a[n].actualRate,surcharge:a[n].surcharge,servicePostingSeqId:a[n].servicePostingSeqId,PayerServSeqId:a[n].PayerServSeqId,isMultiServName:a[n].isMultiServName});0==r.length&&r.push({servCode:a[n].servCode,servName:a[n].servName,quantity:a[n].quantity,discountAmt:a[n].discountAmt,chargebleAmount:a[n].actualRate,surcharge:a[n].surcharge,ervicePostingSeqId:a[n].servicePostingSeqId,PayerServSeqId:a[n].PayerServSeqId,isMultiServName:a[n].isMultiServName})}e.data=r}},this.getColumnDefUniqueData=function(e,t){e.columnDefs=[{name:"servCode",displayName:"billing.serviceCode",enableSorting:!0,headerCellFilter:"translate",enableCellEdit:!1,width:180,cellTemplate:'<div ng-if="!row.entity.fillHealth" class="ui-grid-cell-contents leftAlign">{{row.entity.servCode}}<span ><i  ng-if="row.entity.PayerServSeqId&&row.entity.isMultiServName==\'Y\'" class="fa fa-pencil" ng-click="grid.appScope.svp.editGrid(row.entity)" ></i> </span></div><div class="ui-grid-cell-contents" ng-if="row.entity.fillHealth" ><input type="text" ng-model="row.entity.servCode" uib-typeahead="query as query.PAYER_ALIAS_CODE  for query in grid.appScope.svp.getAutoSearchQuery($viewValue,row.entity.PayerServSeqId) "  typeahead-min-length="2"  typeahead-on-select="row.entity.servName=row.entity.servCode.PAYER_ALIAS_NAME" style="margin-top: -4px;width:60%"   ><span ><i   ng-disabled="!row.entity.servCode" class="fa fa-check" aria-hidden="true" ng-click="grid.appScope.svp.closeGrid(row.entity,rowRenderIndex)" ></i><i ng-disabled="!row.entity.servCode" ng-click="row.entity.servCode=row.entity.serviceVo.servCode;row.entity.servName=row.entity.serviceVo.servName;row.entity.fillHealth=false;" class="fa fa-ban" aria-hidden="true"></i></span></div>',pinnedLeft:!1,footerCellTemplate:'<div class="ui-grid-cell-contents">Total</div>'},{name:"servName",displayName:"billing.serviceName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1},{name:"quantity",displayName:"billing.quantity",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:79,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.quantity}}</div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  }}</div>',aggregationType:t.aggregationTypes.sum},{name:"discountAmt",displayName:"billing.discount",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:76,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.discountAmt}}</div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  }}</div>',aggregationType:t.aggregationTypes.sum},{name:"chargebleAmount",displayName:"billing.chrgbleAmt",enableSorting:!0,headerCellFilter:"translate",enableCellEdit:!1,width:143,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.chargebleAmount}}</div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  }}</div>',aggregationType:t.aggregationTypes.sum},{name:"surcharge",displayName:"billing.docSurcharge",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:127,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.surcharge}}</div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  }}</div>',aggregationType:t.aggregationTypes.sum}]}})}(),function(){"use strict";angular.module("napierContainerUi").constant("transSummaryListGridDef",{enableSorting:!0,enableCellEditOnFocus:!1,enableRowHeaderSelection:!1,multiSelect:!1,enableFiltering:!1,enableFullRowSelection:!0,showGridFooter:!1,showColumnFooter:!1,enableHorizontalScrollbar:0,paginationPageSize:1e3,enablePaginationControls:!1,columnDefs:[{name:"summerySeqId",displayName:"Summary ID",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"dateAndTime",displayName:"Date & Time",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"cashCol",displayName:"Cash Collection",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"creditOrDebitCardCol",displayName:"Credit/Debit Card Collection",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"netBankingCol",displayName:"Net Banking Collection",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"eWalletCol",displayName:"E Wallet Collection",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"colStatus",displayName:"Status",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"actions",displayName:"Actions",enableSorting:!0,enableCellEdit:!1,width:"6%",cellTemplate:'<div style="" ng-click="grid.appScope.tsl.actionClicked(row.entity)" class="grid-eye action-row ui-grid-cell-contents"><i class="fa fa-eye" aria-hidden="true" title="View Summary"></i></div>'}],useExternalSorting:!1,enableColumnMenus:!1}).constant("sumcolSummaryGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!1,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,enableGridMenu:!0,paginationPageSizes:[10,25,50,100],paginationPageSize:10,useExternalSorting:!1,enableColumnMenus:!1,enablePaginationControls:!1,columnDefs:[{name:"AMT_RECEIVED_MODE",displayName:"",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"CASH_COL",displayName:"Cash",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"CREDIT_OR_DEBIT_CARD_COL",displayName:"Credit/Debit Card",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"EWALLET_COL",displayName:"E-Wallet",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"NET_BANKING_COL",displayName:"Net Banking",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"TOTAL",displayName:"Total",enableSorting:!0,enableCellEdit:!1,width:"*"}]})}(),function(){"use strict";function e(e,t,a){this.getSummaryListGridData=function(){var i=e.defer(),r={};return r.url=t.HISSUMMARYGRIDLIST.URL,r.requestData={operation:"getSummaryList",messageId:"",destination:"com.napier.core.collections.service.external.CounterService",message:{"@class":"java.lang.String",$:""}},a.sendRestRequest(r).then(function(e){var t=e.data.HITService.message[0]["com.napier.core.collections.vo.SummaryListVO"];if(null==t)return i.reject("No Data");var a=[];if(Array.isArray(t)){angular.forEach(t,function(e,t){var i={cashCol:null!=e.cashCol?e.cashCol:"",colStatus:null!=e.colStatus?e.colStatus:"",creditOrDebitCardCol:null!=e.creditOrDebitCardCol?e.creditOrDebitCardCol:"",dateAndTime:null!=e.dateAndTimes?moment(e.dateAndTimes).format("DD/MM/YYYY HH:mm"):"",eWalletCol:null!=e.eWalletCol?e.eWalletCol:"",gnStatus:null!=e.gnStatus?e.gnStatus:"",netBankingCol:null!=e.netBankingCol?e.netBankingCol:"",summerySeqId:null!=e.summerySeqId?e.summerySeqId:""};a.push(i)});var r={}}else{r={cashCol:null!=t.cashCol?t.cashCol:"",colStatus:null!=t.colStatus?t.colStatus:"",creditOrDebitCardCol:null!=t.creditOrDebitCardCol?t.creditOrDebitCardCol:"",dateAndTime:null!=t.dateAndTimes?moment(t.dateAndTimes).format("DD/MM/YYYY HH:mm"):"",eWalletCol:null!=t.eWalletCol?t.eWalletCol:"",gnStatus:null!=t.gnStatus?t.gnStatus:"",netBankingCol:null!=t.netBankingCol?t.netBankingCol:"",summerySeqId:null!=t.summerySeqId?t.summerySeqId:""};a.push(r)}i.resolve(a)}),i.promise},this.getCollectionSummaryData=function(i){var r=e.defer(),n={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:"COUNTER_MGMT_COLL_ACCEPT001",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:i}]}]},{identifier:"COUNTER_MGMT_COLL_ACCEPT002",idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:i},{ident:"2",value:i}]}]}]}]},l={};return l.url=t.HISSUMMARYGRIDLIST.URL,l.requestData={operation:"ExecuteQuery",destination:"QueryService",message:n},a.sendRestRequest(l).then(function(e){var t=e.data.HITService.message.queryList;if(null==t)return r.reject("No Data");t=t[0]["com.napier.core.service.vo.query.Query"];var a=[],i=[],n=[],l={};if(null!=t[0].rowList&&""!=t[0].rowList[0]){var s=t[0].rowList[0]["com.napier.core.service.vo.query.Row"];if(Array.isArray(s))angular.forEach(s,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"];angular.forEach(a,function(e,t){var a=e.name;1==a.includes(".",0)&&(l[e.name.substring(a.indexOf(".")+1)]=e.data)}),i.push(l),l={}});else{var o=s.columnList[0]["com.napier.core.service.vo.query.Column"];angular.forEach(o,function(e,t){var a=e.name;1==a.includes(".",0)&&(l[e.name.substring(a.indexOf(".")+1)]=e.data)}),i.push(l),l={}}}a.push(i);o=(s=t[1].rowList[0]["com.napier.core.service.vo.query.Row"]).columnList[0]["com.napier.core.service.vo.query.Column"];angular.forEach(o,function(e,t){var a=e.name;1==a.includes(".",0)&&(l[e.name.substring(a.indexOf(".")+1)]=e.data)}),n.push(l),l={},a.push(n),r.resolve(a)}),r.promise},this.submitSummaryData=function(i,r){var n=e.defer(),l={"@class":"com.napier.core.collections.vo.SummaryListVO",summerySeqId:i,colStatus:"accepted",acceptRemarks:r},s={};return s.url=t.HISSUMMARYGRIDLIST.URL,s.requestData={operation:"saveOrUpdateSummaryList",messageId:"",destination:"com.napier.core.collections.service.external.CounterService",message:l},a.sendRestRequest(s).then(function(e){var t=e.data.HITService.message;if(null==t)return n.reject("Not saved");n.resolve(t)}),n.promise}}e.$inject=["$q","BILLING_APIS","CallManager"],angular.module("napierContainerUi").service("angTranSummaryListControllerService",e)}(),function(){"use strict";function e(e,t,a){this.billingTariffCreateCategory=function(i){var r={};return r.url=e.HISSCMSERVICE.URL,r.requestData=angular.copy(a),angular.extend(r.requestData.message,{description:null==i||null==i.description?"":i.description,name:i.name,remarks:i.remarks,gnStatus:parseInt(i.gnStatus),tariffFacilityList:[{"com.napier.core.scm.master.vo.TariffCategoryLinkVo":i.dropdownValue[0]}]}),t.sendRestRequest(r)}}e.$inject=["BILLING_APIS","CallManager","billingTariffCategoryCreateQuery"],angular.module("napierContainerUi").service("billingTariffCategoryCreateService",e)}(),function(){"use strict";function e(e,t,a){this.billingTariffUpdateCategory=function(i,r){var n={};return n.url=e.HISSCMSERVICE.URL,n.requestData=angular.copy(a),angular.extend(n.requestData.message,{code:i.code,description:i.description?i.description:"",name:i.name,remarks:i.remarks,gnStatus:parseInt(i.gnStatus),tariffFacilityList:[{"com.napier.core.scm.master.vo.TariffCategoryLinkVo":r}]}),t.sendRestRequest(n)}}e.$inject=["BILLING_APIS","CallManager","billingTariffCategoryUpdateQuery"],angular.module("napierContainerUi").service("billingTariffCategoryUpdateService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("taxMastersGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,columnDefs:[{name:"taxName",displayName:"billing.TaxName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*"},{name:"taxCode",displayName:"billing.TaxCode",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*"},{name:"taxDesc",displayName:"billing.displayName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*"},{name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row" ng-if="row.entity.taxName != \'No Records Found\'"><div class=""><span style="" ng-disabled="row.entity.gnStatus==2?true:false"  ng-click="row.entity.gnStatus==1?grid.appScope.taxMasters.editTaxMasters(row):false"  ng-show="grid.appScope.taxMasters.roleTask.T_BL_M_TAX_U!=undefined"><i class="fa fa-pencil"></i></span><span style="" ng-show="grid.appScope.taxMasters.roleTask.T_BL_M_TAX_ACTV!=undefined"><md-switch class="md-primary wlabel" ng-model="row.entity.actStatus" ng-change="grid.appScope.taxMasters.activeInactiveStatusTaxType(row)"></md-switch></span><span style="">{{row.entity.gnStatusDesc}}</span></div></div>',width:"*"}],useExternalSorting:!1,enableColumnMenus:!1}).constant("taxMastersFormGridDef",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1,columnDefs:[{name:"facility",displayName:"billing.Facility",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",enableFiltering:!0,width:"*",cellTemplate:'<div ng-if="row.entity.editable" class="gridTextAlign">{{row.entity.gridfacility.DESCRIPTION}}</div><div ng-if="!row.entity.editable" class="col-sm-12 col-md-12 col-lg-12 taxgridFields"><div class="form-group"><select class="form-control" ng-model="row.entity.gridfacility" ng-options="facility.DESCRIPTION for facility in grid.appScope.taxMasters.facilityComboObj track by facility.CODE" ng-disabled="row.entity.isRowEditMode" ng-change="grid.appScope.taxMasters.facilitySelection(row)"><option value="">Select One</option></select><span></span></div></div>'},{name:"taxPercent",displayName:"billing.TaxPerc",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*",cellTemplate:'<div ng-if="row.entity.editable" class="gridTextAlign">{{row.entity.taxpercent}}</div><div ng-if="!row.entity.editable" class="col-sm-12 col-md-12 col-lg-12 taxgridFields"><div class="form-group"><input type="text" ng-disabled="row.entity.gridfacility?false:true" validate-percentage decimal-upto="2" degits-upto="2" allow-negative="false"class="form-control" placeholder="Enter" ng-model="row.entity.taxpercent" maxlength="200"></div></div>'},{name:"validFrom",displayName:"billing.validfrom",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*",cellTemplate:'<div ng-if="row.entity.editable" class="gridTextAlign">{{row.entity.showvalidFrom}}</div><div class="col-md-12 col-sm-12 col-lg-12 taxgridFields" ng-if="!row.entity.editable"><div class="his-datepicker-main"><div class="input-group"><input type="text" min-date="grid.appScope.taxMasters.minDate" ng-disabled="row.entity.gridfacility?false:true" class="form-control datePickerClass" uib-datepicker-popup="dd-MM-yyyy" ng-model="row.entity.validfrom"  is-open="grid.appScope.popup1.opened[rowRenderIndex]" datepicker-options="grid.appScope.taxMasters.taxfromDateOptions" datepicker-append-to-body=true  ng-change="grid.appScope.taxMasters.dateChanges()" ng-required="true" readonly style="top:3px;border-color:lightgray"/><div class="input-group-btn" style="top: 3px !important;"><button type="button" class="btn btn-default buttonFrmDt" ng-disabled="row.entity.gridfacility?false:true" ng-click="grid.appScope.popup1.opened[rowRenderIndex]=true;"><i class="fa fa-calendar"></i></button></div></div></div></div>'},{name:"validTo",displayName:"billing.validto",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*",cellTemplate:'<div ng-if="row.entity.editable" class="gridTextAlign">{{row.entity.showvalidTo}}</div><div class="col-md-12 col-sm-12 col-lg-12 taxgridFields" ng-if="!row.entity.editable"><div class="his-datepicker-main"><div class="input-group"><input type="text" ng-disabled="row.entity.gridfacility?false:true" min-date="grid.appScope.taxMasters.minDate" class="form-control datePickerClass" uib-datepicker-popup="dd-MM-yyyy" ng-model="row.entity.validto" is-open="grid.appScope.popup2.opened[rowRenderIndex]"  datepicker-options="grid.appScope.taxMasters.taxtoDateOptions" datepicker-append-to-body=true  ng-change="grid.appScope.taxMasters.dateChanges()" ng-required="true" readonly style="top:3px;border-color:lightgray"/><div class="input-group-btn" style="top: 3px !important;"><button type="button" ng-disabled="row.entity.gridfacility?false:true" class="btn btn-default buttonFrmDt" ng-click="grid.appScope.popup2.opened[rowRenderIndex]=true;"><i class="fa fa-calendar"></i></button></div></div></div></div>'},{name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="action-row ui-grid-cell-contents" ng-if="row.entity.editable"><span style="" ng-click="row.entity.gnStatus==1?grid.appScope.taxMasters.editGridDetails(row):false"><i class="fa fa-pencil"></i></span><md-switch class="md-primary wlabel" ng-model="row.entity.activeInactiveStat" ng-change="grid.appScope.taxMasters.activeInactive(row)"></md-switch><span style="">{{row.entity.gnStatusDesc}}</span></div><div class="action-row ui-grid-cell-contents" ng-if="!row.entity.editable"><span style="" ng-click="grid.appScope.taxMasters.dataEntered(row)"><i class="fa fa-check" aria-hidden="true"></i></span><span ng-click="grid.appScope.taxMasters.cancelGridValues(row)"><i class="fa fa-ban" aria-hidden="true"></i></span></div>',width:"*"}],useExternalSorting:!1,enableColumnMenus:!1}).constant("taxMastersServiceFormGridDef",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelection:!1,columnDefs:[{name:"facility",displayName:"billing.facility",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",enableFiltering:!0,width:"*",cellTemplate:'<div ng-if="row.entity.editable1" class="ui-grid-cell-contents gridTextAlign">{{row.entity.gridfacility1.DESCRIPTION}}</div><div ng-if="!row.entity.editable1" class="col-sm-12 col-md-12 col-lg-12 taxgridFields"><div class="form-group"><select class="form-control" ng-model="row.entity.gridfacility1" ng-options="facility.DESCRIPTION for facility in grid.appScope.taxMasters.facilityComboObj track by facility.CODE" ng-disabled="row.entity.isRowEditMode" ng-change="grid.appScope.taxMasters.facilityChange(row)"><option value="">Select One</option></select><span></span></div></div>'},{name:"taxPercent",displayName:"billing.currenttaxpercentage",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*",cellTemplate:'<div ng-if="row.entity.editable1" class="ui-grid-cell-contents gridTextAlign">{{row.entity.taxpercent}}</div><div ng-if="!row.entity.editable1" class="col-sm-12 col-md-12 col-lg-12 taxgridFields"><div class="form-group"><input type="text" ng-disabled="row.entity.facilityflag || row.entity.isRowEditMode"  class="form-control" placeholder="Enter" validate-percentage decimal-upto="2" degits-upto="2"  allow-negative="false" ng-model="row.entity.taxpercent" maxlength="200" ng-change="grid.appScope.taxMasters.curdateChanges1(row);"></div></div>'},{name:"validFrom",displayName:"Effective From",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*",cellTemplate:'<div ng-if="row.entity.editable1" class="ui-grid-cell-contents gridTextAlign">{{row.entity.showvalidFrom}}</div><div class="col-md-12 col-sm-12 col-lg-12 taxgridFields" ng-if="!row.entity.editable1"><div class="his-datepicker-main"><div class="input-group"><input type="text" min-date="grid.appScope.taxMasters.minDate" ng-disabled="row.entity.curdatesplflag ||row.entity.isRowEditMode" class="form-control datePickerClass" uib-datepicker-popup="dd-MM-yyyy" ng-model="row.entity.validfrom"  is-open="grid.appScope.popup1.opened[rowRenderIndex]" datepicker-options="grid.appScope.taxMasters.taxfromDateOptions" datepicker-append-to-body=true  ng-change="grid.appScope.taxMasters.curdateChanges2(row)" ng-required="true" readonly style="top:3px;border-color:lightgray"/><div class="input-group-btn" style="top: 3px !important;"><button type="button" class="btn btn-default buttonFrmDt" ng-disabled="row.entity.curdatesplflag||row.entity.isRowEditMode" ng-click="grid.appScope.popup1.opened[rowRenderIndex]=true;"><i class="fa fa-calendar"></i></button></div></div></div></div>'},{name:"newTaxPercentage",displayName:"billing.newtaxpercentage",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellClass:"noborder",width:"*",cellTemplate:'<div ng-if="row.entity.editable1" class="gridTextAlign ui-grid-cell-contents">{{row.entity.taxpercent2}}</div><div ng-if="!row.entity.editable1" class="col-sm-12 col-md-12 col-lg-12 taxgridFields"><div class="form-group"><input type="text" ng-disabled="row.entity.curdateflag" class="form-control" placeholder="Enter" ng-model="row.entity.taxpercent2" maxlength="200" validate-percentage decimal-upto="2" degits-upto="2"  allow-negative="false"  ng-change="grid.appScope.taxMasters.furdateChanges(row)"></div></div>'},{name:"validFromDate",displayName:"Effective From",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"*",cellTemplate:'<div ng-if="row.entity.editable1" class="ui-grid-cell-contents gridTextAlign">{{row.entity.showvalidnewFrom}}</div><div class="col-md-12 col-sm-12 col-lg-12 taxgridFields" ng-if="!row.entity.editable1"><div class="his-datepicker-main"><div class="input-group"><input type="text" ng-disabled="row.entity.furdateflag" min-date="grid.appScope.taxMasters.minDate" class="form-control datePickerClass" uib-datepicker-popup="dd-MM-yyyy" ng-model="row.entity.newvalidfromdate" is-open="grid.appScope.popup2.opened[rowRenderIndex]"  datepicker-options="row.entity.taxnewDateOptions" datepicker-append-to-body=true  ng-change="grid.appScope.taxMasters.dateChanges()" ng-required="true" readonly style="top:3px;border-color:lightgray"/><div class="input-group-btn" style="top: 3px !important;"><button type="button" ng-disabled="row.entity.furdateflag" class="btn btn-default buttonFrmDt" ng-click="grid.appScope.popup2.opened[rowRenderIndex]=true;"><i class="fa fa-calendar"></i></button></div></div></div></div>'},{name:"Action",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row" ng-if="row.entity.editable1 || row.entity.saveflag"><span style=""  ng-click="row.entity.gnStatus==1?grid.appScope.taxMasters.editGridDetails1(row):false"><i class="fa fa-pencil"></i></span><md-switch class="md-primary wlabel" ng-model="row.entity.activeInactiveStat" ng-change="grid.appScope.taxMasters.activeInactive(row)"></md-switch><span style="">{{row.entity.gnStatusDesc}}</span></div><div class="ui-grid-cell-contents action-row" ng-if="!row.entity.editable1 && row.entity.isEditable1"><span style="" ng-click="grid.appScope.taxMasters.dataEntered1(row)"><i class="fa fa-check" aria-hidden="true"></i></span><span style="" ng-click="grid.appScope.taxMasters.cancelServiceGridValues(row)"><i class="fa fa-ban" style="color: red;" aria-hidden="true"></i></span></div>',width:"*"}],useExternalSorting:!1,enableColumnMenus:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("depositMastersListData",[{id:1302,name:"Biochemistry"},{id:760299435,name:"Hematology"},{id:1305,name:"Microbiology"}])}(),function(){"use strict";angular.module("napierContainerUi").constant("depositMastersGridData",[]).constant("depositMastersFormGridData",[])}(),function(){"use strict";function e(e,t,a,i,r){function n(e){return e.data.HITService.message.queryList[0]["com.napier.core.service.vo.query.Query"].rowList[0]["com.napier.core.service.vo.query.Row"]}this.activeInactiveTaxType=function(i,r){var n=e.defer(),l={"@class":"com.napier.core.service.vo.taxes.TaxTypeDetailsVo",taxSeqId:i,gnStatus:0==r?2:1},s={};return s.url=t.HISDEPOSITSEARCH.URL,s.requestData={operation:"activeInactiveStatusTaxType",messageId:"",destination:"com.napier.core.taxes.service.external.TaxesServices",message:l},a.sendRestRequest(s).then(function(e){n.resolve(e)}),n.promise},this.activeInactiveFacility=function(i,r){var n=e.defer(),l={"@class":"com.napier.core.service.vo.taxes.TaxTypeDetailsVo",taxFactLinkVo:[{"com.napier.core.service.vo.taxes.TaxFactLinkVo":[{taxFactSeqId:i,gnStatus:0==r?2:1}]}]},s={};return s.url=t.HISDEPOSITSEARCH.URL,s.requestData={operation:"activeInactiveStatusTaxTypeFacility",messageId:"",destination:"com.napier.core.taxes.service.external.TaxesServices",message:l},a.sendRestRequest(s).then(function(e){n.resolve(e)}),n.promise},this.comboBoxFetch=function(i,r){var l=e.defer(),s={},o=i;"QS_FACILITY_USER_PERMITED"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{"com.napier.core.service.vo.query.Index":[{ident:"1",value:r},{ident:"1",value:r}]}]}]}]}),"QS_TAX_CAL_BASED"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{"com.napier.core.service.vo.query.Index":[]}]}]}]}),"QS_PAYMENT_TYPE"==o&&(s={"@class":"com.napier.core.service.vo.query.QueryData",queryList:[{"com.napier.core.service.vo.query.Query":[{identifier:o,idxList:[{"com.napier.core.service.vo.query.Index":[]}]}]}]});var c={};return c.url=t.HISCOMBOFILLING.URL,c.requestData={operation:"ExecuteQuery",destination:"QueryService",message:s},a.sendRestRequest(c).then(function(e){if("QS_FACILITY_USER_PERMITED"==o){var t=[],a=n(e);if(Array.isArray(a))angular.forEach(a,function(e,a){var i=e.columnList[0]["com.napier.core.service.vo.query.Column"],r={CODE:i[0].data,DESCRIPTION:i[1].data};t.push(r)});else{var i=a.columnList[0]["com.napier.core.service.vo.query.Column"],s={CODE:i[0].data,DESCRIPTION:i[1].data};t.push(s)}l.resolve(t)}if("QS_TAX_CAL_BASED"==o){var c=[],d=n(e);1==r?d.splice(2,1):d.splice(1,1),angular.forEach(d,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={CODE:a[0].data,DESCRIPTION:a[1].data};c.push(i)}),l.resolve(c)}if("QS_PAYMENT_TYPE"==o){var p=[],u=n(e);angular.forEach(u,function(e,t){var a=e.columnList[0]["com.napier.core.service.vo.query.Column"],i={CODE:a[0].data,DESCRIPTION:a[1].data};p.push(i)}),l.resolve(p)}}),l.promise},this.viewTaxTypeDetails=function(i){r=[];var n=e.defer(),l={"@class":"com.napier.core.service.vo.taxes.TaxTypeDetailsVo",taxSeqId:i},s={};return s.url=t.HISDEPOSITSEARCH.URL,s.requestData={operation:"viewTaxTypeDetails",messageId:"",destination:"com.napier.core.taxes.service.external.TaxesServices",message:l},a.sendRestRequest(s).then(function(e){var t,a,i;r=[];var l=e.data.HITService.message.taxFactLinkVo[0]["com.napier.core.service.vo.taxes.TaxFactLinkVo"];if(Array.isArray(l))angular.forEach(l,function(e,n){if(e.validFrom){var l=new Date(e.validFrom.$);a=moment(l).format("DD-MM-YYYY")}if(e.validTo){var s=new Date(e.validTo.$);t=moment(s).format("DD-MM-YYYY")}if(e.validFromDate){var o=new Date(e.validFromDate.$);i=moment(o).format("DD-MM-YYYY")}var c={CODE:e.facilityId,DESCRIPTION:e.facilityIdDesc},d={isRowEditMode:!0,isEditable:!0,isEditable1:!0,gnStatus:e.gnStatus,gnStatusDesc:e.gnStatusDesc,facility:e.facilityId,facilityIdDesc:e.facilityIdDesc,gridfacility:c,validfrom:l||void 0,validto:s||void 0,showvalidTo:t,showvalidFrom:a,taxSeqId:e.taxSeqId,taxFactSeqId:e.taxFactSeqId,maxvalue:e.maxAmount?e.maxAmount:void 0,minvalue:e.minAmount?e.minAmount:void 0,editable:!0,editable1:!0,gridfacility1:c,activeInactiveStat:1==e.gnStatus,showvalidnewFrom:i,newvalidfromdate:o||void 0};void 0!==e.taxPercentage&&(d.taxpercent=e.taxPercentage),void 0!==e.newTaxPercentage&&(d.taxpercent2=e.newTaxPercentage),a="",i="",r.push(d)});else{if(l.validFrom){var s=new Date(l.validFrom.$);a=moment(s).format("DD-MM-YYYY")}if(l.validTo){var o=new Date(l.validTo.$);t=moment(o).format("DD-MM-YYYY")}if(l.validFromDate){var c=new Date(l.validFromDate.$);i=moment(c).format("DD-MM-YYYY")}var d={CODE:l.facilityId,DESCRIPTION:l.facilityIdDesc},p={isRowEditMode:!0,isEditable:!0,isEditable1:!0,gnStatus:l.gnStatus,gnStatusDesc:l.gnStatusDesc,facility:l.facilityId,facilityIdDesc:l.facilityIdDesc,gridfacility:d,validfrom:s||void 0,validto:o||void 0,showvalidTo:t,showvalidFrom:a,taxSeqId:l.taxSeqId,taxFactSeqId:l.taxFactSeqId,maxvalue:l.maxAmount?l.maxAmount:void 0,minvalue:l.minAmount?l.minAmount:void 0,editable:!0,editable1:!0,gridfacility1:d,activeInactiveStat:1==l.gnStatus,showvalidnewFrom:i,newvalidfromdate:c||void 0};void 0!==l.taxPercentage&&(p.taxpercent=l.taxPercentage),void 0!==l.newTaxPercentage&&(p.taxpercent2=l.newTaxPercentage),a="",i="",r.push(p)}n.resolve(angular.copy(r))}),n.promise},this.getGridData=function(r){var n;n="object"!=typeof r?r:r.facility;var l=e.defer(),s={"@class":"com.napier.core.service.vo.taxes.TaxTypeDetailsVo",taxName:r.name?r.name:"",gnStatus:r.status?r.status:1,taxFactLinkVo:[{"com.napier.core.service.vo.taxes.TaxFactLinkVo":[{facilityId:n}]}]},o={};return o.url=t.HISDEPOSITSEARCH.URL,o.requestData={operation:"searchTaxTypeDetailsList",messageId:"",destination:"com.napier.core.taxes.service.external.TaxesServices",message:s},a.sendRestRequest(o).then(function(e){i=[];var t=e.data.HITService.message[0]["com.napier.core.service.vo.taxes.TaxTypeDetailsVo"];if(t)if(angular.isArray(t))angular.forEach(t,function(e,t){var a={taxName:e.taxName,taxCode:e.taxCode,applicability:e.applicability,taxDesc:e.taxDesc,taxCalBase:e.taxCalBase,taxCalBaseDesc:e.taxCalBaseDesc,gnStatus:e.gnStatus,gnStatusDesc:e.gnStatusDesc,applicabilityDesc:e.applicabilityDesc,paymentMode:e.paymentMode,paymentModeDesc:e.paymentModeDesc,taxSeqId:e.taxSeqId,remarks:e.remarks};1==e.gnStatus?a.actStatus=!0:a.actStatus=!1,i.push(a)});else{var a={taxName:t.taxName,taxCode:t.taxCode,applicability:t.applicability,taxDesc:t.taxDesc,taxCalBase:t.taxCalBase,taxCalBaseDesc:t.taxCalBaseDesc,gnStatus:t.gnStatus,gnStatusDesc:t.gnStatusDesc,applicabilityDesc:t.applicabilityDesc,paymentMode:t.paymentMode,paymentModeDesc:t.paymentModeDesc,taxSeqId:t.taxSeqId,remarks:t.remarks};1==t.gnStatus?a.actStatus=!0:a.actStatus=!1,i.push(a)}l.resolve(angular.copy(i))}),l.promise},this.submitTaxMastersForm=function(i,r,n){var l=e.defer(),s=[];if(angular.forEach(r,function(e,t){var a,i,r,l;e.validto&&(i=moment(e.validto).format("YYYY-MM-DD[T]HH:mm:ss.SSS"),i+="Z"),e.newvalidfromdate&&(l=moment(e.newvalidfromdate).format("YYYY-MM-DD[T]HH:mm:ss.SSS"),l+="Z"),e.validfrom&&(r=moment(e.validfrom).format("YYYY-MM-DD[T]HH:mm:ss.SSS"),r+="Z"),e.gridfacility?a=e.gridfacility.CODE:e.gridfacility1&&(a=e.gridfacility1.CODE);var o={facilityId:a,gnStatus:e.gnStatus?e.gnStatus:1,taxPercentage:e.taxpercent?e.taxpercent:void 0,validFrom:r||void 0,validTo:i||void 0,minAmount:e.minvalue?e.minvalue:void 0,maxAmount:e.maxvalue?e.maxvalue:void 0,newTaxPercentage:e.taxpercent2?e.taxpercent2:void 0,validFromDate:l||void 0};"save"!=n&&(o.taxFactSeqId=e.taxFactSeqId),s.push(o)}),"save"==n)var o={"@class":"com.napier.core.service.vo.taxes.TaxTypeDetailsVo",taxCode:i.taxCode,taxName:i.taxName,applicability:i.applicability?i.applicability:void 0,gnStatus:1,paymentMode:i.paymentmode?i.paymentmode:void 0,taxCalBase:i.taxcalculation?i.taxcalculation:void 0,taxDesc:i.taxDesc,remarks:i.remarks,taxFactLinkVo:[{"com.napier.core.service.vo.taxes.TaxFactLinkVo":s}]};else o={"@class":"com.napier.core.service.vo.taxes.TaxTypeDetailsVo",taxSeqId:i.taxSeqId,applicability:i.applicability,gnStatus:1,paymentMode:i.paymentmode?i.paymentmode:void 0,taxCalBase:i.taxcalculation,remarks:i.remarks,taxDesc:i.taxDesc,taxFactLinkVo:[{"com.napier.core.service.vo.taxes.TaxFactLinkVo":s}]};var c={};return"save"==n?(c.url=t.HISDEPOSITSEARCH.URL,c.requestData={operation:"saveTaxTypeDetails",messageId:"",destination:"com.napier.core.taxes.service.external.TaxesServices",message:o}):(c.url=t.HISDEPOSITSEARCH.URL,c.requestData={operation:"updateTaxTypeDetails",messageId:"",destination:"com.napier.core.taxes.service.external.TaxesServices",message:o}),a.sendRestRequest(c).then(function(e){l.resolve(angular.copy(e.data.HITService.message))}),l.promise}}e.$inject=["$q","BILLING_APIS","CallManager","taxMastersGridDef","taxMastersFormGridDef"],angular.module("napierContainerUi").service("angtaxMastersService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("splitBillGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,showColumnFooter:!0,columnDefs:[{displayName:"billing.billedServices",headerCellFilter:"translate",name:"billed_services",enableSorting:!0,enableCellEdit:!1},{displayName:"billing.totalBill",headerCellFilter:"translate",name:"total_bill",enableSorting:!0,enableCellEdit:!1,width:100},{displayName:"billing.self",headerCellFilter:"translate",name:"self",cellTemplate:'<div class="ui-grid-cell-contents"><input ng-class="{\'gray\':row.entity.billed_services == \'\'}" type="number" min="0" style="width: 99px;padding-left: 39px;height: 29px;margin-left: -7px;margin-top:-4px;" ng-model="MODEL_COL_FIELD" ng-change="grid.appScope.splitBill.calculateAmount(row,MODEL_COL_FIELD,col,grid)" ng-init="row.entity.self=0"/></div>',enableSorting:!0,enableCellEdit:!1,width:100,type:"number"}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("mtrlExclusionsGrid",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,columnDefs:[{field:"materialGroup",displayName:"billing.material.group",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0},{field:"materialSubGroup",displayName:"billing.material.subgroup",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1},{field:"materialName",displayName:"billing.materialName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1}],useExternalSorting:!1,enableColumnMenus:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("mtrlInclusionsGrid",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:1,enableVerticalScrollbar:1,columnDefs:[{field:"materialGroup",displayName:"billing.material.group",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0},{field:"materialSubGroup",displayName:"billing.material.subgroup",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1},{field:"materialName",displayName:"billing.materialName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1},{field:"noLimit",displayName:"billing.noLimit",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1},{field:"amount",displayName:"billing.amt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:100},{field:"qunatity",displayName:"billing.quantity",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1},{field:"validFrom",displayName:"billing.validfrom",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1},{field:"validTo",displayName:"billing.validto",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1},{field:"matBedClassEnabling",columnStatus:"existing",visible:!1}],useExternalSorting:!1,enableColumnMenus:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("packageCheckListGridColumnsData",{enableVerticalScrollbar:1,enableHorizontalScrollbar:0,enableCellEdit:!1,columnDefs:[{field:"checkListItemPriority",displayName:"Sequence",enableColumnMenu:!1,enableCellEdit:!1,width:"10%"},{field:"pkgCheckListItemDesc",displayName:"CheckList Parameter",enableColumnMenu:!1,enableCellEdit:!0,cellTemplate:"<div><form name='inputForm'><input type='text' maxlength='75' ng-model='row.entity.pkgCheckListItemDesc' class='form-control'/></div>",width:"50%"},{field:"waitingArea",displayName:"Waiting Area",enableColumnMenu:!0,enableCellEdit:!0,width:"30%"},{field:"hideShowRow",displayName:"Waiting Area",enableColumnMenu:!0,visible:!1},{field:"CheckListServiceSeqID",displayName:"CheckList Id",visible:!1},{field:"actions",displayName:"Action",enableColumnMenu:!1,width:"10%",cellTemplate:'<div class="ui-grid-cell-contents action-row"><i class="fa fa-trash-o"  tabindex="-1" aria-hidden="true" ng-click="grid.appScope.deleteRecord(row,rowRenderIndex,row.entity)"></i>&nbsp<i class="fa fa-plus" ng-click="grid.appScope.addExtraRow(rowRenderIndex)"" ng-show="row.entity.hideShowRow"></i></div>'}],paginationCurrentPage:1,enableGridMenu:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("packageCheckListSearchGridColumnsData",{enableVerticalScrollbar:1,enableHorizontalScrollbar:0,enableCellEdit:!1,columnDefs:[{field:"checkListItemPriority",displayName:"Sequence",enableColumnMenu:!1,enableCellEdit:!1,width:"10%"},{field:"pkgCheckListItemDesc",displayName:"CheckList Parameter",enableColumnMenu:!1,enableCellEdit:!1,width:"50%"},{field:"waitingArea",displayName:"Waiting Area",enableColumnMenu:!0,enableCellEdit:!1,width:"40%"},{field:"CheckListServiceSeqID",displayName:"CheckList Id",visible:!1}],paginationCurrentPage:1,enableGridMenu:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("serviceExclusionsGrid",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,columnDefs:[{field:"CESSEQID",displayName:"billing.CESSEQID",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0,visible:!1},{field:"EXCLSERVSEQID",displayName:"billing.quantity",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0,visible:!1},{field:"DEPTCODE",displayName:"billing.quantity",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0,visible:!1},{field:"department",displayName:"billing.department",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0},{field:"SUBDEPTCODE",displayName:"billing.SUBDEPTCODE",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0,visible:!1},{field:"subDepartment",displayName:"billing.subDepartment",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1},{field:"service",displayName:"billing.service",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1}],useExternalSorting:!1,enableColumnMenus:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("serviceInclusionsGrid",{enableSorting:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,enableHorizontalScrollbar:1,enableVerticalScrollbar:1,columnDefs:[{field:"department",displayName:"billing.department",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!0,width:150},{field:"subDepartment",displayName:"billing.subDepartment",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:150},{field:"service",displayName:"billing.service",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:100},{field:"noLimit",displayName:"billing.noLimit",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:100},{field:"amount",displayName:"billing.amt",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:100},{field:"qunatity",displayName:"billing.quantity",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:100},{field:"validFrom",displayName:"billing.validfrom",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:100},{field:"validTo",displayName:"billing.validto",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:100,pinnedRight:!0},{field:"BedClassEnabling",columnStatus:"existing",visible:!1}],useExternalSorting:!1,enableColumnMenus:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("payerRankAssignmentGridDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,multiSelect:!1,nounselect:!0,enableGridMenu:!0,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,columnDefs:[{name:"SNo",displayName:"billing.serialNum",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"20%"},{name:"DESCRIPTION",displayName:"billing.assignedPayer",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedright:!0,width:"80%"}],paginationPageSizes:[10,25,50,100],paginationPageSize:10})}(),function(){"use strict";angular.module("napierContainerUi").constant("payerRankNewGridDefinition",{enableHorizontalScrollbar:0,enableVerticalScrollbar:1,enableCellEdit:!1,enableCellEditOnFocus:!0,enableGridMenu:!1,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,multiSelect:!0,columnDefs:[{field:"SEC_PAYER_SEQ_ID",displayName:"billing.assignedPayer",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents action-row"><select ng-disabled="grid.appScope.payerRankAssignmentNew.newPayerBtn" class="form-control prankdrop"  ng-model="row.entity.SEC_PAYER_SEQ_ID" ng-options="item as item.DESCRIPTION for item in grid.appScope.payerRankAssignmentNew.payerData"></select></div>',width:"20%"},{field:"RANK_SEQ_ID",displayName:"billing.rank",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents action-row"><input type="number" class="form-control" min="0" ng-disabled="grid.appScope.payerRankAssignmentNew.newPayerBtn"   placeholder="Enter Rank"  ng-model="row.entity.RANK_SEQ_ID" ng-change="" ng-blur="grid.appScope.calculateAmount(row);grid.appScope.calculateAmountTotal()"/></div>',width:"20%"},{field:"VALID_FROM_DATE",displayName:"billing.validfrom",headerCellFilter:"translate",cellFilter:"date:'MM/dd/yyyy'",width:"25%",cellTemplate:'<div class="ui-grid-cell-contents action-row his-datepicker-main"><input type="text" class="prankvalidtxt form-control" ng-disabled="grid.appScope.payerRankAssignmentNew.newPayerBtn"  is-open="grid.appScope.popup1.opened[rowRenderIndex]" ng-click="grid.appScope.popup1.opened[rowRenderIndex]=true"  show-button-bar="false" uib-datepicker-popup="dd-MM-yyyy"  datepicker-options="grid.appScope.fromDateOptions"  datepicker-append-to-body=true ng-model="row.entity.VALID_FROM_DATE"  ng-change="grid.appScope.payerRankAssignmentNew.checkErr(row, rowRenderIndex, grid, col)" readonly/></div>'},{field:"VALID_TO_DATE",displayName:"billing.validto",headerCellFilter:"translate",cellFilter:"date:'MM/dd/yyyy'",cellTemplate:'<div class="ui-grid-cell-contents action-row his-datepicker-main" ><input type="text" class="prankvalidtxt form-control" ng-disabled="grid.appScope.payerRankAssignmentNew.newPayerBtn"  is-open="grid.appScope.popup2.opened[rowRenderIndex]" ng-click="grid.appScope.popup2.opened[rowRenderIndex]=true"  show-button-bar="false" uib-datepicker-popup="dd-MM-yyyy"  datepicker-options="grid.appScope.toDateOptions"  datepicker-append-to-body=true ng-model="row.entity.VALID_TO_DATE"  ng-change="grid.appScope.payerRankAssignmentNew.checkErr(row, rowRenderIndex, grid, col)" readonly/></div>',width:"25%"}],paginationPageSizes:[10,25,50,100],paginationPageSize:10,useExternalSorting:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("payerRankAssignmentUpdateGridDefinition",{enableHorizontalScrollbar:0,enableVerticalScrollbar:1,enableCellEdit:!1,enableCellEditOnFocus:!0,enableGridMenu:!1,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,columnDefs:[{name:"SEC_PAYER_SEQ_ID",displayName:"billing.assignedPayer",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row"> <select class="form-control prankdrop"   ng-model = "MODEL_COL_FIELD" ng-options="item as item.DESCRIPTION for item in grid.appScope.payerRankAssignmentUpdate.payerData track by item.CODE" ></select></div>',width:"25%"},{name:"RANK_SEQ_ID",displayName:"billing.rank",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedright:!0,width:"25%",cellTemplate:'<div class="ui-grid-cell-contents action-row"><input type="number"  class="pranktxt form-control" min="0"   placeholder="Enter Rank"  ng-model="row.entity.RANK_SEQ_ID" ng-change="" ng-blur="grid.appScope.calculateAmount(row);grid.appScope.calculateAmountTotal()"/></div>'},{name:"VALID_FROM_DATE",displayName:"billing.validfrom",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellFilter:"date:'MM/dd/yyyy'",cellTemplate:'<div class="ui-grid-cell-contents action-row"><input type="text" class="prankvalidtxt form-control" is-open="grid.appScope.popup.opened[rowRenderIndex]" ng-change="grid.appScope.payerRankAssignmentUpdate.checkErr(row, rowRenderIndex, grid, col)" ng-click="grid.appScope.popup.opened[rowRenderIndex]=true"  show-button-bar="false" uib-datepicker-popup="dd-MM-yyyy"  datepicker-options="grid.appScope.fromDateOptions"  datepicker-append-to-body=true ng-model="row.entity.VALID_FROM_DATE" /></div>',width:"25%"},{name:"VALID_TO_DATE",displayName:"billing.validto",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,cellFilter:"date:'MM/dd/yyyy'",cellTemplate:'<div class="ui-grid-cell-contents action-row"><input type="text" class="prankvalidtxt form-control" is-open="grid.appScope.popup1.opened[rowRenderIndex]" ng-click="grid.appScope.popup1.opened[rowRenderIndex]=true" ng-change="grid.appScope.payerRankAssignmentUpdate.checkErr(row, rowRenderIndex, grid, col)"  show-button-bar="false" uib-datepicker-popup="dd-MM-yyyy"  datepicker-options="grid.appScope.toDateOptions"  datepicker-append-to-body=true ng-model="row.entity.VALID_TO_DATE"  /></div>',width:"25%"},{name:"PAYER_SEQ_ID",visible:!1},{name:"PAYER_TYPE",visible:!1}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("payerRankListGridDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,columnDefs:[{name:"S No",displayName:"billing.serialNum",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,width:"20%"},{name:"DESCRIPTION",displayName:"billing.payerName",headerCellFilter:"translate",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,width:"80%"},{name:"PAYER_SEQ_ID",displayName:"billing.payerName",headerCellFilter:"translate",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,width:150,visible:!1}],paginationPageSizes:[10,25,50,100],paginationPageSize:10,useExternalSorting:!1,enableColumnMenus:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("payerRankList")}(),function(){"use strict";function e(e,t){this.getGridData=function(){var a=e.defer();return a.resolve(angular.copy(t)),a.promise}}e.$inject=["$q","payerRankList"],angular.module("napierContainerUi").service("payerRankListService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("payerRankViewGridDefinition",{enableRowHeaderSelection:!0,enableFullRowSelection:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,enableCellEdit:!1,enableCellEditOnFocus:!0,enableGridMenu:!1,enableColumnMenus:!1,enableSorting:!0,enableFiltering:!1,exporterLinkLabel:"get your csv here",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,multiSelect:!0,columnDefs:[{name:"assignedPayer.DESCRIPTION",displayName:"billing.assignedPayer",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedright:!0,width:"25%"},{name:"RANK_SEQ_ID",displayName:"billing.rank",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!1,pinnedright:!0,width:"25%"},{name:"VALID_FROM_DATE",displayName:"billing.validfrom",headerCellFilter:"translate",cellFilter:"date:'MM/dd/yyyy'",filterCellFiltered:!0,width:"25%"},{name:"VALID_TO_DATE",displayName:"billing.validto",headerCellFilter:"translate",cellFilter:"date:'MM/dd/yyyy'",filterCellFiltered:!0,width:"25%"}],paginationPageSizes:[10,25,50,100],paginationPageSize:10})}(),function(){"use strict";angular.module("napierContainerUi").constant("servicepostingServiceVariantCancelGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,columnDefs:[{name:"employee.code",displayName:"billing.empCode",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0},{name:"employee.description",displayName:"billing.doctorName",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0},{name:"billedShare",displayName:"billing.docShare",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("servicepostingPackageCancelGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!0,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,rowTemplate:'<div> <div ng-repeat="col in colContainer.renderedColumns track by col.colDef.name"  class="ui-grid-cell" ui-grid-cell></div></div>',columnDefs:[{name:"servCode",displayName:"billing.packageCode",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:100},{name:"servName",displayName:"billing.package.name",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:100},{name:"serviceRateVo.baseRate",displayName:"billing.rate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:100},{name:"servicePostingType",displayName:"billing.servicePostingType",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"serviceRate",displayName:"billing.serviceAmount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"actualRate",displayName:"billing.actualRate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"quantity",displayName:"billing.quantity",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:80},{name:"discountAmt",displayName:"billing.discount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:100},{name:"effectiveRate",displayName:"billing.effectiveRate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"taxAmt",displayName:"billing.tax",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:100},{name:"emergency",displayName:"billing.emergency",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"requestedByEmpTypeDesc",displayName:"billing.requestedRole",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"cancelRequestedRole",displayName:"billing.cancelledRole",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents"><select class="form-control" ng-model="row.entity.cancelRequestedRole" name="orderType" placeholder="select" ng-options="item.DETAIL_DESC for item in grid.appScope.svppC.roles" ng-change="(row.entity.cancelRequestedRole)?row.entity.cancelRequestedBy=\'{}\':\'\'"></select></div>',width:160},{name:"cancelRequestedBy",displayName:"billing.cancelledBy",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" style="width:90%" ng-model="row.entity.cancelRequestedBy.name"  ng-disabled="true"  /><span><i class="fa fa-search" ng-click="grid.appScope.svppC.populateEmployee(col.colDef.name,row.entity)"></i></span></div>',width:150},{name:"requestedDateTime",displayName:"billing.cancelledDate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.svppC.cancelDate|date:"dd/MM/yyyy HH:mm"}}</div>',width:170},{name:"renderedDateTime",displayName:"billing.renderedDate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.renderedDateTime.$|date:"dd/MM/yyyy HH:mm"}}</div>',width:170},{name:"transTypeDesc",displayName:"billing.transactionType",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"apliTariffdDesc",displayName:"billing.applicTariff",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"hospitalShare",displayName:"billing.netHospitalAmount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"doctorAmount",displayName:"billing.doctorAmount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"doctorModifiedAmount",displayName:"billing.docMdfdAmount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:200},{name:"doctorShare",displayName:"billing.docShare",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:100},{name:"surcharge",displayName:"billing.docSurcharge",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"surchargeOnDoctNoCharge",displayName:"billing.payerSurcharge",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"technicianShare",displayName:"billing.techShare",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:100},{name:"multiDoctor",displayName:"billing.multiDoctor",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:100,cellTemplate:'<div class="ui-grid-cell-contents"><input class="ui-grid-check-align" type="checkbox" ng-true-value="\'Y\'" ng-false-value="\'N\'" ng-disabled="!disableM" ng-model="row.entity.multiDoctor" /></div>'},{name:"priority",displayName:"billing.priority",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"remarks",displayName:"billing.serviceRemarks",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:200}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("servicepostingCancelGridDefinitionData",[{servicecode:"63911106",servicename:"LPID profile",rate:"5500.00",servicepostingType:"planned",serviceAmount:"5500.00",actualRate:"5500.00",quantity:"1",discount:"0.00",effectiveRate:"5500.00",doctorAmount:"0.00",doctorModifiedAmt:"0.00",doctorShare:"200.00",fareSurchrge:"1"}])}(),function(){"use strict";function e(e,t,a){this.getServicePostingCacel=function(i,r){var n=a.defer(),l=[];angular.forEach(i,function(e){var t={"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",servicePostingSeqId:e.spSeqId,cancelRequestedBy:e.cnclBy,cancelRequestedRole:e.cnclRole,encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:0,enProvider:0,enSpeciality:0,isAddendum:!1},servicePostingCacelReason:r};l.push(t)});var s={};return s.url=t.HISIPINDENT.URL,s.requestData={operation:"cancelServicePosting",messageId:"cancelServicePosting",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingVo",servicePostingDetailsList:[{"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo":l}],entityXml:"testentityXml",packBookingCancelReason:"test CancelReason"}},e.sendRestRequest(s).then(function(e){n.resolve(e)},function(e){}),n.promise}}e.$inject=["CallManager","IPINDENTAPIS","$q"],angular.module("napierContainerUi").service("ServicePostingCancel",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("billPostingGridDefinition",{enableSorting:!0,enableCellEditOnFocus:!1,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!1,showGridFooter:!1,showColumnFooter:!0,paginationPageSize:10,useExternalSorting:!1,enableColumnMenus:!1})}(),function(){"use strict";angular.module("napierContainerUi").constant("billGridPackageDefinition",{enableSorting:!0,enableCellEditOnFocus:!1,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!1,showGridFooter:!1,showColumnFooter:!0,paginationPageSize:10,useExternalSorting:!1,enableColumnMenus:!1})}(),function(){"use strict";angular.module("napierContainerUi").service("GetDepositData",["CallManager","IPINDENTAPIS",function(e,t){this.getDeposit=function(a){var i={};return i.url=t.HISIPINDENT.URL,i.requestData={operation:"getDepositsByAccountId",messageId:"",destination:"com.napier.core.deposits.service.external.DepositsService",message:{"@class":"com.napier.core.service.vo.deposits.DepositsVo",accSeqId:a}},e.sendRestRequest(i)}}])}(),function(){"use strict";angular.module("napierContainerUi").service("BillSaveService",["CallManager","$filter","IPINDENTAPIS",function(e,t,a){this.generateBillService=function(i,r,n,l,s,o,c,d,p){var u={},m=[];let g=[],S=[],v=1,D=!1;if(d.corporateAmt=parseFloat(d.corporateAmt),d.patientAmt=parseFloat(d.patientAmt),null!=o[0].ACC_SEQ_ID)if(d.corporateAmt>0){if(m.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:o[0].PAYER_ACC_SEQ_ID,payerAmount:d.corporateAmt,payerType:o[0].CHECK_FOR,payStatus:2,gnStatus:1}),d.patientAmt>0||i.billServicePackageObjNon.length>0||null!=r.corpAdjPat&&parseFloat(r.corpAdjPat)>0){let e=0==i.billServicePackageObjNon.length?parseFloat((d.patientAmt+r.corpAdjPat).toFixed(2)):i.patientNonCompAmt+n.deductibleAmount;parseFloat(e)>0&&m.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:o[0].ACC_SEQ_ID,payerAmount:0==i.billServicePackageObjNon.length?parseFloat((d.patientAmt+r.corpAdjPat).toFixed(2)):i.patientNonCompAmt+n.deductibleAmount,payerType:4,payStatus:2,gnStatus:1,blPatAdjAmt:null!=r.corpAdjPat&&""!==r.corpAdjPat&&parseFloat(r.corpAdjPat)>0?parseFloat(r.corpAdjPat):void 0}),d.calPatAmt=0,i.patientNonCompAmt>d.patientAmt?(d.calPatAmt=parseFloat(i.patientAmtOnly.toFixed(2)),D=!0):d.calPatAmt=parseFloat(i.patientAmtOnly.toFixed(2)),d.calPatAmt>0&&i.billServicePackageObjNon.length>0&&(v=2);let t=parseFloat(i.patientAmtOnly.toFixed(2));S.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:o[0].ACC_SEQ_ID,payerAmount:parseFloat(t.toFixed(2))>0?parseFloat(t.toFixed(2)):0,payerType:4,payStatus:2,gnStatus:1})}var y=d.limitAmt<d.corporateAmt?d.limitAmt:d.corporateAmt}else{y=0;m.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:o[0].ACC_SEQ_ID,payerAmount:n.grandCal.totalAmnt,payerType:4,payStatus:2,gnStatus:1})}var f=[],C=i.billServicePackageObj,I=i.billServicePackageObjNon,A=[];1==v?(f=(f=f.concat(C)).concat(I),A=(A=A.concat(i.highValueBillsDiscountVoList)).concat(i.highValueBillsDiscountVoListNon)):2==v&&(f=f.concat(C),A=A.concat(i.highValueBillsDiscountVoList));let E=0;E=n.grandCal.discAmt<i.patientDiscountAmt?i.patientDiscountAmt-n.grandCal.discAmt:n.grandCal.discAmt-i.patientDiscountAmt;let h=0;h=n.grandCal.adjAmt-r.corpAdjPat;for(let e=0;e<v;e++){let a=1==v?n.grandCal.totalAmnt:1!=e?d.corporateAmt+i.patientNonCompAmt+n.deductibleAmount:d.calPatAmt,s=1==v?n.grandCal.billedAmt:1!=e?i.patientNonCompAmt:d.calPatAmt;g.push({billDate:t("date")(new Date,"yyyy-MM-dd HH:mm:ss.s"),billStatus:{"@class":"com.napier.core.service.vo.masters.GeneralMaster",code:1},ipAdmSeqId:0==e?p:void 0,admissionStatus:0==e?11:void 0,billPayStatus:2,deductableAmt:1!=e?n.deductibleAmount:0,copayAmt:1!=e&&d.copayAmount?d.copayAmount:0,taxAmount:1==v?parseFloat(n.grandCal.totalTax):1!=e?i.payerTaxAmt:i.patientTaxAmt,billType:parseInt(c),billAmount:parseFloat(a.toFixed(2))>0?a:0,isCashAllowed:2,discountAmount:1==v?n.grandCal.discAmt:1!=e?E:i.patientDiscountAmt,tobePaidAmount:parseFloat(s.toFixed(2))>0?s:0,accSeqId:o[0].ACC_SEQ_ID,adjAmount:1==v?n.grandCal.adjAmt:1!=e?parseFloat(r.corpAdjPat):parseFloat(h),subAccSeqId:o[0].SUB_ACC_SEQ_ID,preAuthAdjAmount:y,billDetailsList:[{"com.napier.core.billgeneration.vo.BillDetails":1!=e?f:i.billServicePackageObjNon}],billPayerDtList:[{"com.napier.core.billgeneration.vo.BillPayerDetails":1!=e?m:S}],billDepositDetailsList:[{"com.napier.core.billgeneration.vo.BillDepositDetails":1==v?n.grandCal.adjAmt>0?r.depositSave.length>0?r.depositSave:r.depositObjCrop:[]:1!=e?null!=r.corpAdjPat&&parseFloat(r.corpAdjPat)>0?r.depositObjCrop:[]:null!=h&&parseFloat(h)>0?r.depositSave:[]}],creditNoteAdjList:[{"com.napier.core.billgeneration.vo.CreditNoteAdjustVo":1==e?r.creditSave:1==v?r.creditObjCrop.length>0?r.creditObjCrop:r.creditSave:r.creditObjCrop}],isPrimaryBill:!1,isBillClearedCheck:!0,folioSeqId:null==l.folioDtls&&null==l.folioDtls?void 0:l.folioDtls.gQDataCode,highValueBillsDiscountVoList:[{"com.napier.core.billgeneration.vo.HighValueBillsDiscountVo":1!=e?A:i.highValueBillsDiscountVoListNon}],transactionDiscount:4==o[0].CHECK_FOR?"0":"1",entityType:null!=n.docResp&&null!=n.docResp?n.docResp.EMP_TYPE:void 0,entitySeqId:null!=n.docResp?n.docResp.EMP_SEQ_ID:void 0,isDoctorResponsible:null!=n.docResp&&null!=n.docResp,remarks:null!=n.grandCal.remarks&&null!=n.grandCal.remarks?n.grandCal.remarks:void 0,isOPVisitBill:!1})}return u.url=a.HISIPINDENT.URL,u=this.processURLParams(u,n.serviceObj,g,n.isPackageExist),e.sendRestRequest(u)},this.processURLParams=function(e,t,a,i){return e.requestData=i?{operation:"saveServiceDetailsAndGenerateBill",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.billgeneration.vo.BillingList",billingList:[{"com.napier.core.billgeneration.vo.Bill":a}],servicePostingVo:t}}:{operation:"createBillGenerationList",messageId:"",destination:"com.napier.core.billgeneration.service.external.BillGenerationService",message:{"@class":"com.napier.core.billgeneration.vo.BillingList",billingList:[{"com.napier.core.billgeneration.vo.Bill":a}]}},e},this.generateBillFromPatientBilling=function(i,r,n,l,s,o,c,d,p,u,m){var g={},S=[];let v=[],D=[],y=1;o.corporateAmt=parseFloat(o.corporateAmt),o.patientAmt=parseFloat(o.patientAmt),null!=p.accSeqId&&(i.billServicePackageObj.length>0&&(S.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:null!=m&&null!=m[0]?m[0].BILL_PAYER_ACC_SEQ_ID:p.accSeqId,payerAmount:l.netAmount.payerAmount,payerType:p.checkFor,taxAmount:l.tax.payerAmount,discountAmt:l.discount.payerAmount,payStatus:2,gnStatus:1,incPlanSeqId:p.insurancePlanSeqId}),S.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:p.accSeqId,payerAmount:l.netAmount.patientAmount,taxAmount:l.tax.patientAmount,discountAmt:l.discount.patientAmount,payerType:4,payStatus:2,gnStatus:1,blPatAdjAmt:l.adjustments.patientAmount})),i.billServicePackageObjNon.length>0&&i.billServicePackageObj.length>0&&(D.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:p.accSeqId,payerAmount:l.netAmount.selfAmount,taxAmount:l.tax.selfAmount,discountAmt:l.discount.selfAmount,payerType:4,payStatus:2,gnStatus:1,blPatAdjAmt:l.adjustments.selfAmount}),y=2),i.billServicePackageObjNon.length>0&&0==i.billServicePackageObj.length&&S.push({"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",accPayerSeqId:p.accSeqId,payerAmount:l.netAmount.selfAmount,taxAmount:l.tax.selfAmount,discountAmt:l.discount.selfAmount,payerType:4,payStatus:2,gnStatus:1,blPatAdjAmt:l.adjustments.selfAmount}));var f=[],C=i.billServicePackageObj,I=i.billServicePackageObjNon,A=[];1==y?(f=(f=f.concat(C)).concat(I),A=(A=A.concat(i.highValueBillsDiscountVoList)).concat(i.highValueBillsDiscountVoListNon)):2==y&&(f=f.concat(C),A=A.concat(i.highValueBillsDiscountVoList));for(let e=0;e<y;e++){let a=1==y?l.netAmount.totalAmount:1!=e?l.netAmount.payerAmount+l.netAmount.patientAmount:l.netAmount.selfAmount,o=1==y?l.balance.totalAmount:1!=e?l.balance.payerAmount+l.balance.patientAmount:l.balance.selfAmount;v.push({billDate:t("date")(new Date,"yyyy-MM-dd HH:mm:ss.s"),billStatus:{"@class":"com.napier.core.service.vo.masters.GeneralMaster",code:1},ipAdmSeqId:0==e?c:void 0,admissionStatus:0==e?11:void 0,billPayStatus:2,deductableAmt:1!=e?l.deductible:0,copayAmt:1!=e&&l.billLevelCopay?l.billLevelCopay:0,coInsurance:1!=e&&l.coInsurance?l.coInsurance:0,taxAmount:1==y?parseFloat(l.tax.totalAmount):1!=e?l.tax.patientAmount+l.tax.payerAmount:l.tax.selfAmount,billType:parseInt(s),billAmount:parseFloat(a.toFixed(2))>0?a:0,isCashAllowed:2,discountAmount:1==y?l.discount.totalAmount:1!=e?l.discount.patientAmount+l.discount.payerAmount:l.discount.selfAmount,tobePaidAmount:parseFloat(o.toFixed(2))>0?o:0,accSeqId:p.accSeqId,adjAmount:1==y?l.adjustments.totalAmount:1!=e?parseFloat(l.adjustments.patientAmount):parseFloat(l.adjustments.selfAmount),subAccSeqId:p.subAccSeqId,preAuthAdjAmount:void 0,rgSeqId:d,payerDiscount:1==y?l.discount.payerDiscount:1!=e?l.discount.payerAmount:0,patientDiscount:1==y?l.discount.patientAmount+l.discount.selfAmount:1!=e?l.discount.patientAmount:l.discount.selfAmount,preAuthHdSeqIds:null!=u?u.preAuthIds:void 0,patName:p.patientName,billDetailsList:[{"com.napier.core.billgeneration.vo.BillDetails":1!=e?f:i.billServicePackageObjNon}],billPayerDtList:[{"com.napier.core.billgeneration.vo.BillPayerDetails":1!=e?S:D}],billDepositDetailsList:[{"com.napier.core.billgeneration.vo.BillDepositDetails":null==r?void 0:1==y?l.adjustments.totalAmount>0?r.depositSave.length>0?r.depositSave:r.depositObjCrop:[]:1!=e?r.depositObjCrop.length>0?r.depositObjCrop:[]:null!=r.depositSave&&r.depositSave.length>0?r.depositSave:[]}],creditNoteAdjList:[{"com.napier.core.billgeneration.vo.CreditNoteAdjustVo":null==r?void 0:1==e?r.creditSave:1==y?r.creditObjCrop.length>0?r.creditObjCrop:r.creditSave:r.creditObjCrop}],isPrimaryBill:!1,isBillClearedCheck:!0,folioSeqId:null==n.folioDtls&&null==n.folioDtls?void 0:n.folioDtls.gQDataCode,highValueBillsDiscountVoList:[{"com.napier.core.billgeneration.vo.HighValueBillsDiscountVo":1!=e?A:i.highValueBillsDiscountVoListNon}],transactionDiscount:4==p.checkFor?"0":"1",entityType:null!=n.docResp&&null!=n.docResp?n.docResp.EMP_TYPE:void 0,entitySeqId:null!=n.docResp?n.docResp.EMP_SEQ_ID:void 0,isDoctorResponsible:null!=n.docResp&&null!=n.docResp,remarks:void 0,isOPVisitBill:!1})}return g.url=a.HISIPINDENT.URL,g=this.processURLParams(g,n.serviceObj,v,!0),e.sendRestRequest(g)}}])}(),function(){"use strict";angular.module("napierContainerUi").service("BillGridsData",["CallManager","IPINDENTAPIS",function(e,t){this.gridDataService=function(e,t,a,i,r){i.grandCal.totalTax=0,i.grandCal.discAmt=0,r.corporateAmt=0,r.patientAmt=0,i.grandCal.surchargeNoCharge=0,i.fullyCoverdServiceList=[];var n=[];e instanceof Array?n=e:n.push(e);for(var l=0,s=0;s<n.length;s++){4==n[s].packApplyType&&1==n[s].servicePostingType&&(i.isPackageExist=!0),n[s].servCode=n[s].serviceVo.servCode,n[s].servName=n[s].serviceVo.servName,n[s].apliTariffdDesc=n[s].apliTariffdDesc,n[s].spDate=null==n[s].spDate.$?n[s].spDate:n[s].spDate.$,null!=n[s].discountAmt?n[s].discountAmt:0,null!=n[s].taxAmt?n[s].taxAmt:(n[s].taxAmt=0,0),n[s].surchargeOnDoctNoCharge=0;var o=null==n[s].multiEmployeeShareList.employeeShareList?void 0:n[s].multiEmployeeShareList.employeeShareList[0]["com.napier.core.scm.serviceposting.vo.EmployeeShareVo"];if(null!=o&&0==n[s].doctorShare){n[s].surcharge=0,o=o instanceof Array?o:[o];for(var c=0;c<o.length;c++)2==o[c].entityType&&(null==o[c].billedSurcharge&&(o[c].billedSurcharge=0),n[s].surchargeOnDoctNoCharge=n[s].surchargeOnDoctNoCharge+o[c].billedSurcharge)}if(3!=n[s].servicePostingType){if(null!=n[s].discountAmt&&null!=n[s].discountAmt?null!=n[s].quantity&&null!=n[s].quantity&&2!=n[s].packApplyType?i.grandCal.discAmt=i.grandCal.discAmt+n[s].discountAmt:i.grandCal.discAmt=i.grandCal.discAmt+0:n[s].discountAmt=0,null!=n[s].taxAmt&&null!=n[s].taxAmt?n[s].taxAmt=n[s].taxAmt:n[s].taxAmt=0,isNaN(n[s].serviceRate)?n[s].serviceRate=0:n[s].serviceRate=n[s].serviceRate,null==n[s].quantity&&(n[s].quantity=1),null!=n[s].chargeableAmt?n[s].actualRate=n[s].chargeableAmt:n[s].actualRate=parseFloat((n[s].actualRate*n[s].quantity).toFixed(2)),null!=n[s].taxAmt&&n[s].taxAmt>0&&3==n[s].packApplyType&&(n[s].actualRate=parseFloat((n[s].actualRate+n[s].taxAmt).toFixed(2))),"PM"==n[s].packApplyTypeDesc){l+=1,n[s].sNo=l,null!=n[s].discountAmt&&0!=n[s].discountAmt&&(n[s].discountAmt=n[s].discountAmt),n[s].packNetAmt=parseFloat((n[s].actualRate+n[s].taxAmt).toFixed(2));var d=n[s].serviceRate-n[s].discountAmt;n[s].taxPercent=parseFloat((n[s].taxAmt/d*100).toFixed(2)),r.patientAmt=r.patientAmt+n[s].packNetAmt,a.data.push(n[s])}else null!=n[s].packApplyType&&2!=n[s].packApplyType?(t.data.push(n[s]),r.patientAmt=r.patientAmt+n[s].actualRate):i.fullyCoverdServiceList.push(n[s]);r.patientAmt=parseFloat(r.patientAmt.toFixed(2)),null==n[s].creditCompSurcharge&&(n[s].creditCompSurcharge=0),null==n[s].companyPayingAmt&&(n[s].companyPayingAmt=0),r.corporateAmt=r.corporateAmt+n[s].companyPayingAmt,i.grandCal.surchargeNoCharge=i.grandCal.surchargeNoCharge+n[s].surchargeOnDoctNoCharge,null!=n[s].taxAmt&&2!=n[s].packApplyType&&(i.grandCal.totalTax=i.grandCal.totalTax+n[s].taxAmt),i.grandCal.totalAmnt=i.grandCal.billedAmt=i.grandCal.roundAmt=r.patientAmt,n[s].copayAmt&&(r.copayAmount=r.copayAmount+n[s].copayAmt)}}r.corporateAmt=angular.copy(parseFloat(r.corporateAmt.toFixed(2))),r.serviceGridResult=angular.copy(n),r.copayAmount=parseFloat(r.copayAmount.toFixed(2)),r.limitAmt=angular.copy(r.corporateAmt)},this.getPayerData=function(a,i){var r={};return r.url=t.HISIPINDENT.URL,r.requestData={operation:"getPayerSummaryDetailsforIp",messageId:"",destination:"com.napier.core.billgeneration.service.external.BillGenerationService",message:{"@class":"com.napier.core.billgeneration.vo.Bill",billType:2,ipAdmSeqId:a[0].IPADM_SEQ_ID,accSeqId:a[0].ACC_SEQ_ID,subAccSeqId:a[0].SUB_ACC_SEQ_ID,billPayerDtList:[{"com.napier.core.billgeneration.vo.BillPayerDetails":[{"@class":"com.napier.core.billgeneration.vo.BillPayerDetails",payerSeqId:a[0].PAYER_ACC_SEQ_ID}]}],encounterType:"IP",isPrimaryBill:!1,isBillClearedCheck:!0,folioSeqId:i}},e.sendRestRequest(r)},this.gridDataDeposit=function(e,t,a){var i=[];if(e instanceof Array?i=e:i.push(e),null!=e)for(var r=0;r<i.length;r++)i[r].balanceAmount=i[r].depositAmount-i[r].adjustamtTotal,i[r].adjustamtTotal=0,i[r].type="Deposit",i[r].typeId=1,t.data.push(i[r])}}])}(),function(){"use strict";angular.module("napierContainerUi").service("BillGridColDef",["hisTranslationsService",function(e){e.loadModule("billing"),e.changeLanguage("en");this.getColumnDefAll=function(e,t){e.columnDefs=[{field:"moduleId",displayName:"",cellTemplate:'<div class="ui-grid-cell-contents"><div class="grid-indicator-block" ng-class=\'{"routine":COL_FIELD != "10", "routinePriority":COL_FIELD == "10"}\'></div></div>',width:10,pinnedLeft:!0},{name:"spDate",displayName:"billing.serviceDate",enableSorting:!0,enableCellEdit:!1,width:150,sort:{direction:"desc"},headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.spDate|date:"dd/MM/yyyy"}}</div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{"billing.total"|translate}}</div>'},{name:"servicePostingSeqId",visible:!1},{name:"servCode",displayName:"billing.serviceCode",enableSorting:!0,enableCellEdit:!1,pinnedLeft:!1,width:100,headerCellFilter:"translate"},{name:"servName",displayName:"billing.serviceName",enableSorting:!0,enableCellEdit:!1,width:150,headerCellFilter:"translate"},{name:"baseRate",displayName:"billing.baseRate",enableSorting:!0,enableCellEdit:!1,width:85,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.baseRate |number:2}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2 }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"quantity",displayName:"billing.quantity",enableSorting:!0,enableCellEdit:!1,width:72,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.quantity}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"serviceRate",displayName:"billing.serviceAmount",enableSorting:!0,enableCellEdit:!1,width:113,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.serviceRate |number:2}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()|number:2  }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"discountAmt",displayName:"billing.discAmt",enableSorting:!0,enableCellEdit:!1,width:130,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.discountAmt |number:2}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2 }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"taxAmt",displayName:"billing.tax",enableSorting:!0,enableCellEdit:!1,width:65,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.taxAmt |number:2}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2  }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"actualRate",displayName:"billing.effectiveRate",enableSorting:!0,enableCellEdit:!1,width:110,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.actualRate |number:2}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{grid.appScope.patientAmt=col.getAggregationValue() |number:2  }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"nonChargableAmt",displayName:"billing.nonChrgblAmnt",enableSorting:!0,enableCellEdit:!1,width:200,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.nonChargableAmt |number:2}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2  }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"copayAmt",displayName:"Copay Amt",enableSorting:!0,enableCellEdit:!1,width:200,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.copayAmt |number:2}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2  }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center",visible:!1},{name:"apliTariffdDesc",displayName:"billing.applicTariff",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:150},{name:"changeBed",displayName:"billing.billingBedCls",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:120},{name:"hospitalShare",displayName:"billing.hospShare",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.hospitalShare |number:2}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2 }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center",width:120},{name:"doctorShare",displayName:" billing.docShare",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.doctorShare |number:2}}</div>',headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  |number:2}}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center",width:100},{name:"department",displayName:"billing.department",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:100},{name:"billingGroup",displayName:"billing.billingGroup",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",width:200},{name:"companyPayingAmt",displayName:"billing.cmpnypayingAmt",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate",enableCellEditOnFocus:!0,footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2 }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,cellTemplate:'<div class="ui-grid-cell-contents rightAlign"><span>{{row.entity.companyPayingAmt| number:2}}</span></div>',editableCellTemplate:'<div class="ui-grid-cell-contents" ><input type="text"  validate-percentage decimal-upto="2" min="1" allow-negative="false"  ui-grid-editor ng-model="MODEL_COL_FIELD"  ng-change="grid.appScope.changeCPAmt(row,grid,rowRenderIndex)" ></div>',editType:"number",headerCellClass:"center",cellClass:"center",footerCellClass:"center",width:187,cellEditableCondition:function(e){return null!=e.row.entity.companyPayingAmt}},{name:"companyNonPayingAmt",displayName:"billing.cmpnyNonPayingAmt",enableSorting:!0,enableCellEdit:!0,enableCellEditOnFocus:!0,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents rightAlign"><span>{{row.entity.companyNonPayingAmt| number:2}}</span></div>',editableCellTemplate:'<div class="ui-grid-cell-contents" ><input type="text" validate-percentage decimal-upto="2" min="1" ui-grid-editor ng-model="MODEL_COL_FIELD"  ng-change="grid.appScope.changeCNPAmt(row,grid,rowRenderIndex)" ></div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2 }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center",width:205,cellEditableCondition:function(e){return null!=e.row.entity.companyNonPayingAmt}}]},this.packageColDef=function(e,t){e.showColumnFooter=!1,e.columnDefs=[{name:"spDate",visible:!1},{name:"servicePostingSeqId",visible:!1},{name:"sNo",displayName:"billing.serialNo",enableSorting:!0,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.sNo}}</div>',headerCellFilter:"translate",showColumnFooter:!1},{name:"servCode",displayName:"billing.packageCode",enableSorting:!0,headerCellFilter:"translate",enableCellEdit:!1,showColumnFooter:!1},{name:"servName",displayName:"billing.package.name",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate"},{name:"serviceRate",displayName:"billing.packagePrice",enableSorting:!0,enableCellEdit:!1,width:90,cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.serviceRate |number:2}}</div>',headerCellFilter:"translate"},{name:"discountAmt",displayName:"billing.discount",enableSorting:!0,enableCellEdit:!0,width:100,headerCellFilter:"translate",enableCellEditOnFocus:!0,cellTemplate:'<div class="ui-grid-cell-contents rightAlign" ng-if="!row.entity.editable">{{row.entity.discountAmt |number:2}}</div>',editableCellTemplate:'<input type="text"  ng-class="\'colt\' + col.uid" ui-grid-editor ng-model="MODEL_COL_FIELD" numbers-only ng-change="grid.appScope.valueCheck(row)"  ng-blur="grid.appScope.getTotalNet(row)">',editType:"number"},{name:"taxAmt",displayName:"billing.tax",enableSorting:!0,enableCellEdit:!1,width:65,cellFilter:"number: 2",headerCellFilter:"translate",aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center"},{name:"packNumber",displayName:"billing.packageNumber",enableSorting:!0,enableCellEdit:!0,width:200,headerCellFilter:"translate",enableCellEditOnFocus:!0,cellTemplate:'<div class="ui-grid-cell-contents rightAlign"><span>{{row.entity.packNumber}}</span></div>',editableCellTemplate:'<div class="ui-grid-cell-contents" ><input type="text" numbers-only ui-grid-editor ng-model="MODEL_COL_FIELD"  ng-change="grid.appScope.changeNumber(row,grid,rowRenderIndex)" ></div>',editType:"number"},{name:"packNetAmt",displayName:"billing.packageNetAmount",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{row.entity.packNetAmt |number:2}}</div>',enableCellEditOnFocus:!1,cellFilter:"number: 2",editType:"number"},{name:"companyPayingAmt",displayName:"billing.payerAmt",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",enableCellEditOnFocus:!1,footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  |number:2}}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,cellTemplate:'<div class="ui-grid-cell-contents rightAlign"><span>{{row.entity.companyPayingAmt | number:2}}</span></div>',width:187},{name:"companyNonPayingAmt",displayName:"billing.patientAmt",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",enableCellEditOnFocus:!1,cellTemplate:'<div class="ui-grid-cell-contents rightAlign"><span>{{row.entity.companyNonPayingAmt| number:2}}</span></div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2 }}</div>',aggregationType:t.aggregationTypes.sum,aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center",width:205},{name:"actions",displayName:"Action",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents rightAlign"  ng-click="grid.appScope.bilP.viewPackageDetails(row.entity)" role="button"><i class="fa fa-eye eye-color" aria-hidden="true"></i></div>'}]},this.depositColDef=function(e,t){e.columnDefs=[{name:"depositSeqId",visible:!1},{name:"deptranDate",displayName:"billing.date",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.deptranDate.$|date:grid.appScope.bilP.format}}</div>'},{name:"type",displayName:"billing.type",enableSorting:!0,headerCellFilter:"translate",enableCellEditOnFocus:!0,enableCellEdit:!0},{name:"depositAmount",displayName:"billing.amt",enableSorting:!0,enableCellEdit:!1,cellFilter:"number: 2",headerCellFilter:"translate",footerCellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.depositAmount=col.getAggregationValue()  |number:2}}</div>',aggregationType:t.aggregationTypes.sum},{name:"availableAmount",displayName:"billing.availAmt",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",cellFilter:"number: 2"},{name:"balanceAmount",displayName:"billing.BalanceAmount",enableSorting:!0,headerCellFilter:"translate",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span>{{row.entity.balanceAmount=row.entity.availableAmount-row.entity.adjustamtTotal |number:2}}</span></div>',cellFilter:"number: 2"},{name:"adjustAmount",visible:!1,cellFilter:"number: 2"},{name:"adjustamtTotal",displayName:"billing.adjAmt",enableSorting:!0,headerCellFilter:"translate",enableCellEditOnFocus:!0,enableCellEdit:!0,cellFilter:"number: 2",cellTemplate:'<div class="ui-grid-cell-contents"><span>{{row.entity.adjustamtTotal>row.entity.availableAmount?grid.appScope.zero:row.entity.adjustamtTotal}}</span></div>',editableCellTemplate:'<div class="ui-grid-cell-contents" ><input type="number" ui-grid-editor ng-model="MODEL_COL_FIELD"  ng-change="grid.appScope.adjustAmountTotal(row,grid)"></div>',editType:"number",footerCellTemplate:'<div class="ui-grid-cell-contents">{{grid.appScope.bilP.toBeAdjusted=col.getAggregationValue() |number:2}}</div>',aggregationType:t.aggregationTypes.sum},{name:"depositTypeDesc",displayName:"billing.depositType",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate"}]}}])}(),function(){"use strict";angular.module("napierContainerUi").service("BillSavePrepare",["$filter",function(e){this.saveParamObject=function(e,t,a,i){var r=[],n=[],l=[],s=[];let o=a.grandCal.totalAmnt-t.corporateAmt,c=0,d=parseFloat(o.toFixed(2))-i.patientNonCompAmt-parseFloat(a.deductibleAmount);d<0&&(d=0),d<parseFloat(a.grandCal.adjAmt)&&(c=a.grandCal.adjAmt-d);let p=0,u=!1;for(let t=0;t<e.data.length;t++)if(1==e.data[t].typeId){if(null!=e.data[t].adjustamtTotal&&null!=e.data[t].adjustamtTotal)if(u||0==d)(u||0==d)&&l.push({"@class":"com.napier.core.billgeneration.vo.BillDepositDetails",depositSeqId:e.data[t].depositSeqId,depAdjAmount:e.data[t].adjustamtTotal,gnStatus:1,adjustamtTotal:e.data[t].adjustamtTotal,gnDepositStatus:"7",availableAmount:e.data[t].balanceAmount});else{let a=0,i=0;if(d<(p+=e.data[t].adjustamtTotal)){u=!0;let r=p-d;r<e.data[t].adjustamtTotal?(a=r,e.data[t].adjustamtTotal=e.data[t].adjustamtTotal-r,i=e.data[t].balanceAmount-e.data[t].adjustamtTotal):(a=c,e.data[t].adjustamtTotal=e.data[t].adjustamtTotal-c,i=e.data[t].balanceAmount-e.data[t].adjustamtTotal)}r.push({"@class":"com.napier.core.billgeneration.vo.BillDepositDetails",depositSeqId:e.data[t].depositSeqId,depAdjAmount:e.data[t].adjustamtTotal,gnStatus:1,adjustamtTotal:e.data[t].adjustamtTotal,gnDepositStatus:"7",availableAmount:e.data[t].balanceAmount}),u&&l.push({"@class":"com.napier.core.billgeneration.vo.BillDepositDetails",depositSeqId:e.data[t].depositSeqId,depAdjAmount:a,gnStatus:1,adjustamtTotal:a,gnDepositStatus:"7",availableAmount:a-a})}}else if(2==e.data[t].typeId&&e.data[t].adjustamtTotal>0)if(u||0==d)(u||0==d)&&s.push({creditNoteHdSeqId:e.data[t].crHdSeqId,crNoteAdjAmt:e.data[t].adjustamtTotal,balAmt:e.data[t].availableAmount-e.data[t].adjustamtTotal});else{let a=0,i=0;if(d<(p+=e.data[t].adjustamtTotal)){u=!0;let r=p-d;r<e.data[t].adjustamtTotal?(a=r,e.data[t].adjustamtTotal=e.data[t].adjustamtTotal-r,i=e.data[t].availableAmount-e.data[t].adjustamtTotal):(a=c,e.data[t].adjustamtTotal=e.data[t].adjustamtTotal-c,i=e.data[t].availableAmount-e.data[t].adjustamtTotal)}n.push({creditNoteHdSeqId:e.data[t].crHdSeqId,crNoteAdjAmt:e.data[t].adjustamtTotal,balAmt:e.data[t].availableAmount-e.data[t].adjustamtTotal}),u&&s.push({creditNoteHdSeqId:e.data[t].crHdSeqId,crNoteAdjAmt:a,balAmt:i-a})}return{depositSave:r,creditSave:n,depositObjCrop:l,creditObjCrop:s,corpAdjPat:c}},this.saveParamObjectForDeposit=function(e,t,a,i){var r=[],n=[];for(let t=0;t<e.length;t++)null!=e[t].depositAgainst&&(null!=e[t].applicableTo&&1==e[t].applicableTo&&r.push({"@class":"com.napier.core.billgeneration.vo.BillDepositDetails",depositSeqId:e[t].depositSeqId,depAdjAmount:e[t].depositAgainst,gnStatus:1,adjustamtTotal:e[t].depositAgainst+e[t].adjustAmount,gnDepositStatus:"7",availableAmount:e[t].availableAmount+e[t].depositAgainst}),null!=e[t].applicableTo&&2==e[t].applicableTo&&n.push({"@class":"com.napier.core.billgeneration.vo.BillDepositDetails",depositSeqId:e[t].depositSeqId,depAdjAmount:e[t].depositAgainst,gnStatus:1,adjustamtTotal:e[t].depositAgainst+e[t].adjustAmount,gnDepositStatus:"7",availableAmount:e[t].availableAmount+e[t].depositAgainst}));return{depositSave:r,creditSave:[],depositObjCrop:n,creditObjCrop:[],corpAdjPat:0}};var t=function(e,t){let a=[];if(null!=t&&t.length>0&&null!=t[0])for(let i=0;i<t.length;i++)t[i].materialSPSequenceId==e&&a.push({"@class":"com.napier.core.billgeneration.vo.BillMatDetails",matCode:null!=t[i].serviceVo?t[i].serviceVo.servSeqId:void 0,matRate:t[i].serviceRate,chargeableAmt:t[i].chargeableAmt,taxAmt:t[i].payerTax+t[i].patientTax,patientAmt:t[i].patientAmount,payerAmt:t[i].payerAmount,copayAmt:t[i].copayAmt,payerDiscount:t[i].payerDiscount,patientDiscount:t[i].patientDiscount,nonChargableAmt:t[i].nonChargableAmt,selfAmt:t[i].selfAmount,packApplyType:t[i].packApplyType,matQty:t[i].quantity,isCompanyPay:t[i].isCompanyPaying,gnStatus:t[i].gnStatus?t[i].gnStatus:parseInt(1),facilityId:angular.fromJson(sessionStorage.userContextObj).FACILITY_ID,practiceId:angular.fromJson(sessionStorage.userContextObj).CLIENT_REF_ID});return a},a=function(e,a,i,r,n,l){for(let s=0;s<a.length;s++){if(1==a[s].servicePostingType&&2==a[s].isPackage)return!1;null!=a[s].authService&&null!=a[s].authService&&1==parseFloat(a[s].authService)||null!=a[s].isCompanyPaying&&null!=a[s].isCompanyPaying&&1==parseFloat(a[s].isCompanyPaying)?(e.billServicePackageObj.push({"@class":"com.napier.core.billgeneration.vo.BillDetails",servicePostSeqId:a[s].servicePostingSeqId,spDate:a[s].spDate,companyPayingAmt:null!=a[s].companyPayingAmt&&null!=a[s].companyPayingAmt&&""!==a[s].companyPayingAmt?parseFloat(a[s].companyPayingAmt):parseFloat(0),companyNonPayingAmt:null!=a[s].companyNonPayingAmt&&null!=a[s].companyNonPayingAmt&&""!==a[s].companyNonPayingAmt?parseFloat(a[s].companyNonPayingAmt):parseFloat(0),servSeqId:null!=a[s].serviceVo?a[s].serviceVo.servSeqId:void 0,serviceRate:a[s].serviceRate,chargeableAmt:a[s].chargeableAmt,taxAmt:a[s].payerTax+a[s].patientTax,patientAmt:a[s].patientAmount,payerAmt:a[s].payerAmount,copayAmt:a[s].copayAmt,payerDiscount:a[s].payerDiscount,patientDiscount:a[s].patientDiscount,nonChargableAmt:a[s].nonChargableAmt,selfAmt:a[s].selfAmount,packApplyType:a[s].packApplyType,servQty:a[s].quantity,renderedLocation:a[s].renderedLocation,refTranSeqId:a[s].refTranSeqID,isCompanyPay:a[s].isCompanyPaying,isIndentServ:a[s].isIndentServ,actualRate:a[s].actualRate,effectiveFromDate:null!=a[s].startTime&&null!=a[s].startTime.$?a[s].startTime.$:a[s].startTime,effectiveToDate:null!=a[s].endTime&&null!=a[s].endTime.$?a[s].endTime.$:a[s].endTime,billMatDetails:[{"com.napier.core.billgeneration.vo.BillMatDetails":t(a[s].servicePostingSeqId,l)}]}),a[s].taxAmt&&!r&&(e.payerTaxAmt=e.payerTaxAmt+a[s].taxAmt),e.highValueBillsDiscountVoList.push({serviceSeqId:a[s].serviceVo.servSeqId,servicePostingSeqId:a[s].servicePostingSeqId,chargeableAmount:a[s].chargeableAmt,tarrifSeqId:a[s].apliTariff,payerType:null!=n?n.checkFor:i[0].CHECK_FOR,highValueDiscount:0,refTranSeqID:a[s].refTranSeqID})):(e.billServicePackageObjNon.push({"@class":"com.napier.core.billgeneration.vo.BillDetails",servicePostSeqId:a[s].servicePostingSeqId,spDate:a[s].spDate,companyPayingAmt:null!=a[s].companyPayingAmt&&null!=a[s].companyPayingAmt&&""!==a[s].companyPayingAmt?parseFloat(a[s].companyPayingAmt):parseFloat(0),companyNonPayingAmt:null!=a[s].companyNonPayingAmt&&null!=a[s].companyNonPayingAmt&&""!==a[s].companyNonPayingAmt?parseFloat(a[s].companyNonPayingAmt):parseFloat(0),servSeqId:null!=a[s].serviceVo?a[s].serviceVo.servSeqId:void 0,serviceRate:a[s].serviceRate,chargeableAmt:a[s].chargeableAmt,taxAmt:a[s].selfTax,patientAmt:a[s].patientAmount,payerAmt:a[s].payerAmount,copayAmt:a[s].copayAmt,payerDiscount:a[s].payerDiscount,patientDiscount:a[s].patientDiscount,nonChargableAmt:a[s].nonChargableAmt,selfAmt:a[s].selfAmount,packApplyType:a[s].packApplyType,servQty:a[s].quantity,renderedLocation:a[s].renderedLocation,refTranSeqId:a[s].refTranSeqID,isCompanyPay:a[s].isCompanyPaying,isIndentServ:a[s].isIndentServ,actualRate:a[s].actualRate,billMatDetails:[{"com.napier.core.billgeneration.vo.BillMatDetails":t(a[s].servicePostingSeqId,l)}]}),null==a[s].discountAmt||r||(e.patientDiscountAmt=e.patientDiscountAmt+parseFloat(a[s].discountAmt)),a[s].taxAmt&&!r&&(e.patientTaxAmt=e.patientTaxAmt+a[s].taxAmt),e.highValueBillsDiscountVoListNon.push({serviceSeqId:a[s].serviceVo.servSeqId,servicePostingSeqId:a[s].servicePostingSeqId,chargeableAmount:a[s].chargeableAmt,tarrifSeqId:a[s].apliTariff,payerType:null!=n?n.checkFor:i[0].CHECK_FOR,highValueDiscount:0,refTranSeqID:a[s].refTranSeqID})),null!=a[s].companyPayingAmt&&null!=a[s].companyPayingAmt&&""!==a[s].companyPayingAmt&&parseFloat(a[s].companyPayingAmt)>0&&null!=a[s].companyNonPayingAmt&&null!=a[s].companyNonPayingAmt&&""!==a[s].companyNonPayingAmt&&parseFloat(a[s].companyNonPayingAmt)>0||null!=a[s].authService&&null!=a[s].authService&&1==parseFloat(a[s].authService)?e.patientNonCompAmt=e.patientNonCompAmt+parseFloat(a[s].companyNonPayingAmt):(null!=a[s].companyPayingAmt&&null!=a[s].companyPayingAmt&&""!==a[s].companyPayingAmt&&0==parseFloat(a[s].companyPayingAmt)&&null!=a[s].companyNonPayingAmt&&null!=a[s].companyNonPayingAmt&&""!==a[s].companyNonPayingAmt&&parseFloat(a[s].companyNonPayingAmt)>0||null!=a[s].authService&&null!=a[s].authService&&1!=parseFloat(a[s].authService))&&(e.patientAmtOnly=e.patientAmtOnly+parseFloat(a[s].companyNonPayingAmt)),2==a[s].authService&&(e.authService=2)}};this.saveBillService=function(e,t,i,r,n,l){var s={highValueBillsDiscountVoList:[],billServicePackageObj:[],billServicePackageObjNon:[],highValueBillsDiscountVoListNon:[],authService:1,patientAmtOnly:0,patientNonCompAmt:0,patientDiscountAmt:0,payerTaxAmt:0,patientTaxAmt:0};if(0==a(s,e.data,i,void 0,n,l))return!1;null!=r.fullyCoverdServiceList&&r.fullyCoverdServiceList.length>0&&a(s,r.fullyCoverdServiceList,i,!0);for(let e=0;e<t.data.length;e++)null!=t.data[e].companyPayingAmt&&null!=t.data[e].companyPayingAmt&&""!=t.data[e].companyPayingAmt&&parseFloat(t.data[e].companyPayingAmt)>0?(s.billServicePackageObj.push({"@class":"com.napier.core.billgeneration.vo.BillDetails",servicePostSeqId:t.data[e].servicePostingSeqId,spDate:t.data[e].spDate,companyPayingAmt:null!=t.data[e].companyPayingAmt&&null!=t.data[e].companyPayingAmt&&""!==t.data[e].companyPayingAmt?parseFloat(t.data[e].companyPayingAmt):parseFloat(0),companyNonPayingAmt:null!=t.data[e].companyNonPayingAmt&&null!=t.data[e].companyNonPayingAmt&&""!==t.data[e].companyNonPayingAmt?parseFloat(t.data[e].companyNonPayingAmt):parseFloat(0)}),t.data[e].taxAmt&&(s.payerTaxAmt=s.payerTaxAmt+t.data[e].taxAmt),s.highValueBillsDiscountVoList.push({serviceSeqId:t.data[e].serviceVo.servSeqId,servicePostingSeqId:t.data[e].servicePostingSeqId,chargeableAmount:t.data[e].chargeableAmt,tarrifSeqId:t.data[e].apliTariff,payerType:i[0].CHECK_FOR,highValueDiscount:0})):(s.billServicePackageObjNon.push({"@class":"com.napier.core.billgeneration.vo.BillDetails",servicePostSeqId:t.data[e].servicePostingSeqId,spDate:t.data[e].spDate,companyPayingAmt:null!=t.data[e].companyPayingAmt&&null!=t.data[e].companyPayingAmt&&""!==t.data[e].companyPayingAmt?parseFloat(t.data[e].companyPayingAmt):parseFloat(0),companyNonPayingAmt:null!=t.data[e].companyNonPayingAmt&&null!=t.data[e].companyNonPayingAmt&&""!==t.data[e].companyNonPayingAmt?parseFloat(t.data[e].companyNonPayingAmt):parseFloat(0)}),null!=t.data[e].discountAmt&&(s.patientDiscountAmt=s.patientDiscountAmt+parseFloat(t.data[e].discountAmt)),t.data[e].taxAmt&&(s.patientTaxAmt=s.patientTaxAmt+t.data[e].taxAmt),s.highValueBillsDiscountVoListNon.push({serviceSeqId:t.data[e].serviceVo.servSeqId,servicePostingSeqId:t.data[e].servicePostingSeqId,chargeableAmount:t.data[e].chargeableAmt,tarrifSeqId:t.data[e].apliTariff,payerType:i[0].CHECK_FOR,highValueDiscount:0})),null!=t.data[e].companyPayingAmt&&null!=t.data[e].companyPayingAmt&&""!==t.data[e].companyPayingAmt&&parseFloat(t.data[e].companyPayingAmt)>0&&null!=t.data[e].companyNonPayingAmt&&null!=t.data[e].companyNonPayingAmt&&""!==t.data[e].companyNonPayingAmt&&parseFloat(t.data[e].companyNonPayingAmt)>0?s.patientNonCompAmt=s.patientNonCompAmt+parseFloat(t.data[e].companyNonPayingAmt):null!=t.data[e].companyPayingAmt&&null!=t.data[e].companyPayingAmt&&""!==t.data[e].companyPayingAmt&&0==parseFloat(t.data[e].companyPayingAmt)&&null!=t.data[e].companyNonPayingAmt&&null!=t.data[e].companyNonPayingAmt&&""!==t.data[e].companyNonPayingAmt&&parseFloat(t.data[e].companyNonPayingAmt)>0&&(s.patientAmtOnly=s.patientAmtOnly+parseFloat(t.data[e].companyNonPayingAmt));return s}}])}(),function(){"use strict";angular.module("napierContainerUi").constant("depositDeatilGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,paginationPageSize:10,columnDefs:[{name:"DEPOSIT_TYPE",displayName:"billing.depositType",headerCellFilter:"translate",pinnedLeft:!0},{name:"COL_REQ_DATE",displayName:"billing.scrollDate",headerCellFilter:"translate",pinnedLeft:!0},{name:"COL_REQ_NO",displayName:"billing.scrollNumber",headerCellFilter:"translate",pinnedLeft:!0},{name:"BALANCE",displayName:"billing.BalanceAmount",headerCellFilter:"translate"}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("mediDeatilGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,showColumnFooter:!0,paginationPageSize:10,columnDefs:[{name:"TRAN_DATE",displayName:"billing.date",headerCellFilter:"translate"},{name:"MTRL_CODE",displayName:"billing.materialCode",headerCellFilter:"translate"},{name:"MTRL_NAME",displayName:"billing.materialName",headerCellFilter:"translate"},{name:"QTY",displayName:"billing.quantity",headerCellFilter:"translate"},{name:"CHARG_AMT",displayName:"billing.chargableAmount",headerCellFilter:"translate"},{name:"NON_CHARG_AMT",displayName:"billing.nonChrgblAmnt",headerCellFilter:"translate"},{name:"STORE",displayName:"billing.Store",headerCellFilter:"translate"}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("packDetailstGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,showColumnFooter:!0,columnDefs:[{name:"serialNo",displayName:"billing.serialNo",headerCellFilter:"translate",width:80},{name:"packagecode",displayName:"billing.packageCode",headerCellFilter:"translate",width:100},{name:"packagename",displayName:"billing.package.name",headerCellFilter:"translate"},{name:"packageprice",displayName:"billing.packagePrice",headerCellFilter:"translate",width:100},{name:"discount",displayName:"billing.discount",headerCellFilter:"translate",width:100},{name:"packagenum",displayName:"billing.tax",headerCellFilter:"translate",width:100},{name:"packNetAmt",displayName:"billing.packageNetAmount",headerCellFilter:"translate",width:100},{name:"companyPayingAmt",displayName:"billing.payerAmt",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",enableCellEditOnFocus:!1,footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue()  |number:2}}</div>',aggregationHideLabel:!0,cellTemplate:'<div class="ui-grid-cell-contents rightAlign"><span>{{row.entity.companyPayingAmt | number:2}}</span></div>',width:187},{name:"companyNonPayingAmt",displayName:"billing.patientAmt",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",enableCellEditOnFocus:!1,cellTemplate:'<div class="ui-grid-cell-contents rightAlign"><span>{{row.entity.companyNonPayingAmt| number:2}}</span></div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2 }}</div>',aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center",width:205},{name:"actions",displayName:"Action",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents rightAlign"  ng-click="grid.appScope.pSheet.viewPackageDetails(row.entity)" role="button"><i class="fa fa-eye eye-color" aria-hidden="true"></i></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("servpostsheetGridDefinition",{enableSorting:!0,enableCellEditOnFocus:!0,enableRowHeaderSelection:!0,enableFiltering:!1,enableFullRowSelection:!1,enableGridMenu:!0,showGridFooter:!1,showColumnFooter:!0,paginationPageSize:10,useExternalSorting:!1,enableColumnMenus:!1,enableVerticalScrollbar:1,columnDefs:[{name:"RenderedDate",displayName:"billing.rendered",headerCellFilter:"translate",width:100},{name:"servicecode",displayName:"billing.serviceCode",headerCellFilter:"translate",width:100},{name:"servicename",displayName:"billing.serviceName",headerCellFilter:"translate",width:100},{name:"qty",displayName:"billing.quantity",headerCellFilter:"translate",width:80},{name:"rate",displayName:"billing.serviceRate",headerCellFilter:"translate",width:100},{name:"discount",displayName:"billing.discount",headerCellFilter:"translate",width:100},{name:"tax",displayName:"Tax",headerCellFilter:"translate",width:100},{name:"ChargableAmt",displayName:"billing.chargableAmount",headerCellFilter:"translate",width:100},{name:"nonChargableAmt",displayName:"billing.nonChrgblAmnt",headerCellFilter:"translate",width:100},{name:"copayAmount",displayName:"Copay Amount",headerCellFilter:"translate",width:80,visible:!1},{name:"hospitalShare",displayName:"billing.hospShare",headerCellFilter:"translate",width:100},{name:"doctorShare",displayName:"billing.docShare",headerCellFilter:"translate",width:100},{name:"tranType",displayName:"billing.tranType",headerCellFilter:"translate",width:100},{name:"department",displayName:"billing.department",headerCellFilter:"translate",width:100},{name:"doctorName",displayName:"billing.doctorName",headerCellFilter:"translate",width:100},{name:"multeDoctor",displayName:"billing.multiDoctor",headerCellFilter:"translate",width:100},{name:"createdBy",displayName:"billing.createdBy",headerCellFilter:"translate",width:100},{name:"companyPayingAmt",displayName:"billing.cmpnypayingAmt",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate",enableCellEditOnFocus:!0,footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2 }}</div>',aggregationHideLabel:!0,cellTemplate:'<div class="ui-grid-cell-contents rightAlign"><span>{{row.entity.companyPayingAmt| number:2}}</span></div>',editType:"number",headerCellClass:"center",cellClass:"center",footerCellClass:"center",width:187},{name:"companyNonPayingAmt",displayName:"billing.cmpnyNonPayingAmt",enableSorting:!0,enableCellEdit:!0,enableCellEditOnFocus:!0,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents rightAlign"><span>{{row.entity.companyNonPayingAmt| number:2}}</span></div>',footerCellTemplate:'<div class="ui-grid-cell-contents rightAlign">{{col.getAggregationValue() |number:2 }}</div>',aggregationHideLabel:!0,headerCellClass:"center",cellClass:"center",footerCellClass:"center",width:205}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("transferDeatilGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,paginationPageSize:10,columnDefs:[{name:"FBED_DESC",displayName:"From Bed",headerCellFilter:"translate"},{name:"TNRS_DESC",displayName:"To Bed",headerCellFilter:"translate"},{name:"TR_DATE",displayName:"Date & Time",headerCellFilter:"translate"},{name:"LEN_OF_STAY",displayName:"Days",headerCellFilter:"translate"},{name:"FBCLASS_DESC",displayName:"From Class",headerCellFilter:"translate"},{name:"TBCLASS_DESC",displayName:"To Class",headerCellFilter:"translate"}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("servicepostingServiceVariantCancelGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,columnDefs:[{name:"employee.code",displayName:"Emp Code",enableSorting:!0,enableCellEdit:!0},{name:"employee.description",displayName:"Doctor Name",enableSorting:!0,enableCellEdit:!0},{name:"billedShare",displayName:"Doctor Share",enableSorting:!0,enableCellEdit:!0}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("servicepostingCancelGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!0,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,rowTemplate:'<div   > <div ng-repeat="col in colContainer.renderedColumns track by col.colDef.name"  class="ui-grid-cell" ui-grid-cell></div></div>',columnDefs:[{field:"moduleId",displayName:"",cellTemplate:'<div class="ui-grid-cell-contents"><div class="grid-indicator-block" ng-class=\'{"routine":COL_FIELD != "10", "routinePriority":COL_FIELD == "10"}\'></div></div>',width:10,pinnedLeft:!0},{name:"servCode",displayName:"Service Code",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:100},{name:"servName",displayName:"Service Name",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:100},{name:"serviceRateVo.baseRate",displayName:"Rate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:100},{name:"servicePostingType",displayName:"Service Posting Type",enableSorting:!0,enableCellEdit:!0,width:150},{name:"quantity",displayName:"Quantity",enableSorting:!0,enableCellEdit:!0,width:80},{name:"priority",displayName:"Service Priority",enableSorting:!0,enableCellEdit:!0,width:150},{name:"serviceRate",displayName:"Service Amount",enableSorting:!0,enableCellEdit:!0,width:150},{name:"discountAmt",displayName:"Discount",enableSorting:!0,enableCellEdit:!0,width:100},{name:"taxAmt",displayName:"Tax",enableSorting:!0,enableCellEdit:!0,width:100},{name:"actualRate",displayName:"Effective Rate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"cancelRequestedRole",displayName:"Cancel Requested Role",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div ng-if="grid.appScope.flg" class="ui-grid-cell-contents"> <select class="form-control" ng-model="row.entity.cancelRequestedRole" name="orderType" placeholder="select" ng-options="item.DETAIL_DESC for item in grid.appScope.svpC.roles" ng-change="(row.entity.cancelRequestedRole)?row.entity.cancelRequestedBy=\'{}\':\'\'"></select></div><div ng-if="grid.appScope.flg1" class="ui-grid-cell-contents">{{row.entity.cancelRequestedRole}}</div>',width:160},{name:"cancelRequestedBy",displayName:"Cancel Requested By",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div ng-if="grid.appScope.flg" class="ui-grid-cell-contents"><input type="text" style="width:90%" ng-model="row.entity.cancelRequestedBy.name"  ng-disabled="true"  /><span><i class="fa fa-search" ng-click="grid.appScope.svpC.populateEmployee(col.colDef.name,row.entity)"></i></span></div><div ng-if="grid.appScope.flg1" class="ui-grid-cell-contents">{{row.entity.cancelRequestedBy}}</div>',width:150},{name:"requestedByEmpTypeDesc",displayName:"Requested Role",enableSorting:!0,enableCellEdit:!0,width:150},{name:"requestedByEmpName",displayName:"Requested By",enableSorting:!0,enableCellEdit:!0,width:150},{name:"requestedDateTime",displayName:"Requested Date And Time",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.requestedDateTime.$|date:"dd/MM/yyyy HH:mm"}}</div>',width:170},{name:"renderedByEmpTypeDesc",displayName:"Rendered Role",enableSorting:!0,enableCellEdit:!0,width:150},{name:"renderedByEmpName",displayName:"Rendered By",enableSorting:!0,enableCellEdit:!0,width:150},{name:"renderedDateTime",displayName:"Rendered Date And Time",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.renderedDateTime.$|date:"dd/MM/yyyy HH:mm"}}</div>',width:170},{name:"transTypeDesc",displayName:"Transaction Type",enableSorting:!0,enableCellEdit:!0,width:150},{name:"hospitalShare",displayName:"Net Hospital Amount",enableSorting:!0,enableCellEdit:!0,width:150},{name:"doctorAmount",displayName:"Doctor Amount",enableSorting:!0,enableCellEdit:!0,width:150},{name:"doctorModifiedAmount",displayName:"Doctor Modified Amount",enableSorting:!0,enableCellEdit:!0,width:200},{name:"doctorShare",displayName:"Doctor Share",enableSorting:!0,enableCellEdit:!0,width:100},{name:"apliTariffdDesc",displayName:"Applicable Tariff",enableSorting:!0,enableCellEdit:!0,width:150},{name:"surchargeOnDoctNoCharge",displayName:"Payer Surcharge",enableSorting:!0,enableCellEdit:!0,width:150},{name:"multiDoctor",displayName:"Multi Doctor",enableSorting:!0,enableCellEdit:!0,width:100,cellTemplate:'<div class="ui-grid-cell-contents"><input class="ui-grid-check-align" type="checkbox" ng-true-value="\'Y\'" ng-false-value="\'N\'" ng-disabled="!disableM" ng-model="row.entity.multiDoctor" /></div>'},{name:"remarks",displayName:"Remarks",enableSorting:!0,enableCellEdit:!0,width:200}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("servicepostingCancelGridDefinitionData",[{servicecode:"63911106",servicename:"LPID profile",rate:"5500.00",servicepostingType:"planned",serviceAmount:"5500.00",actualRate:"5500.00",quantity:"1",discount:"0.00",effectiveRate:"5500.00",doctorAmount:"0.00",doctorModifiedAmt:"0.00",doctorShare:"200.00",fareSurchrge:"1"}])}(),function(){"use strict";function e(e,t,a,i,r,n){this.getServicePostingCacel=function(t,a){var r=n.defer(),l=[];angular.forEach(t,function(e){var t={"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",servicePostingSeqId:e.spSeqId,cancelRequestedBy:e.cnclBy,cancelRequestedRole:e.cnclRole,encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:0,enProvider:0,enSpeciality:0,isAddendum:!1},servicePostingCacelReason:a};l.push(t)});var s={};return s.url=i.HISIPINDENT.URL,s.requestData={operation:"cancelServicePosting",messageId:"cancelServicePosting",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingVo",servicePostingDetailsList:[{"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo":l}],entityXml:"testentityXml",packBookingCancelReason:"test CancelReason"}},e.sendRestRequest(s).then(function(e){r.resolve(e)},function(e){}),r.promise}}e.$inject=["CallManager","$filter","$http","IPINDENTAPIS","$rootScope","$q"],angular.module("napierContainerUi").service("ServicePostingCancel",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("srchSerivceData",[{servicecode:"USG1",servicename:"USG Abdomen",rate:"2500",effectiveFrom:"12/12/2016",effectiveTo:"12/12/2017",effectivedate:"Admission"},{servicecode:"JPSK123",servicename:"Operation",rate:"1500",effectiveFrom:"12/12/2016",effectiveTo:"12/12/2017",effectivedate:"Admission"},{servicecode:"USG1",servicename:"USG Abdomen",rate:"2500",effectiveFrom:"12/12/2016",effectiveTo:"12/12/2017",effectivedate:"Admission"},{servicecode:"JPSK123",servicename:"USG Abdomen",rate:"1500",effectiveFrom:"12/12/2016",effectiveTo:"12/12/2017",effectivedate:"Admission"},{servicecode:"USG1",servicename:"USG Abdomen",rate:"2500",effectiveFrom:"12/12/2016",effectiveTo:"12/12/2017",effectivedate:"Admission"},{servicecode:"JPSK123",servicename:"USG Abdomen",rate:"1500",effectiveFrom:"12/12/2016",effectiveTo:"12/12/2017",effectivedate:"Admission"},{servicecode:"USG1",servicename:"USG Abdomen",rate:"2500",effectiveFrom:"12/12/2016",effectiveTo:"12/12/2017",effectivedate:"Admission"},{servicecode:"JPSK123",servicename:"USG Abdomen",rate:"1500",effectiveFrom:"12/12/2016",effectiveTo:"12/12/2017",effectivedate:"Admission"}])}(),function(){"use strict";angular.module("napierContainerUi").constant("servicePostingNewDocSearchGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,paginationPageSizes:[10,20,40,80],paginationPageSize:10,enableHorizontalScrollbar:0,paginationCurrentPage:1,columnDefs:[{name:"CODE",displayName:"billing.empCode",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate"},{name:"EMP_NAME",displayName:"billing.empname",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate"}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("servicepostingNewEmpSearchGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,paginationPageSizes:[10,20,40,80],paginationPageSize:10,enableHorizontalScrollbar:0,paginationCurrentPage:1,columnDefs:[{name:"CODE",displayName:"billing.empCode",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate"},{name:"EMP_NAME",displayName:"billing.empname",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.EMP_NAME + " / " + row.entity.SPECIALIZATN_DESC}}</div>'}],rowTemplate:'<div   > <div ng-style="{ \'cursor\': \'pointer\' }" ng-click="grid.appScope.svpNE.employeeSelection(row.entity)" ng-repeat="col in colContainer.renderedColumns track by col.colDef.name"  class="ui-grid-cell" ui-grid-cell></div></div>'})}(),function(){"use strict";angular.module("napierContainerUi").constant("servicePostingNewGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,enableSelectAll:!1,enableGridMenu:!0,enableColumnMenus:!0,multiSelect:!1,columnDefs:[{field:"moduleId",displayName:"",cellTemplate:'<div ng-if="row.entity.servicePostingSeqId!=undefined" class="ui-grid-cell-contents"><div class="grid-indicator-block" ng-class=\'{"routine":COL_FIELD != "10", "routinePriority":COL_FIELD == "10"}\'></div></div>',width:10,pinnedLeft:!0},{name:"serviceVo.servCode",displayName:"billing.serviceCode",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,headerCellFilter:"translate",width:100},{name:"serviceVo.servName",displayName:"billing.serviceName",enableSorting:!0,headerCellFilter:"translate",enableCellEdit:!0,cellTooltip:function(e,t){return e.entity.serviceVo.servName},pinnedLeft:!0,width:110},{name:"serviceRateVo.baseRate",displayName:"billing.serviceRate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,pinnedLeft:!0,width:130,cellTemplate:'<div class="ui-grid-cell-contents" ng-init="row.entity.serviceRateVo.baseRate=row.entity.serviceRate;row.entity.tempRate=row.entity.serviceRateVo.baseRate;"><input type="number" style="margin-top: -4px;"  class="form-control" ng-disabled="row.entity.serviceVo.scmMasterServBillingAttrVo.faIsBillable==2||(row.entity.isPharmacyService!=undefined&&(row.entity.isPharmacyService==\'Pharmacy Issues\'||row.entity.isPharmacyService==\'Pharmacy Retruns\'))||row.entity.priority!=1||row.entity.serviceVo.scmMasterServBillingAttrVo.faIsRateEditable==2" ng-model="row.entity.serviceRateVo.baseRate" ng-change="(row.entity.tempRate==row.entity.serviceRateVo.baseRate?row.entity.updateRateFlag=false:row.entity.updateRateFlag=true);" ng-blur="grid.appScope.svpN.rateEditableChange(row.entity,rowRenderIndex,1);"></div>'},{name:"servicePostingType",displayName:"billing.servicePostingType",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div ng-if="!grid.appScope.svpN.editOption&& row.entity.servicePostingType==2 ||grid.appScope.svpN.editOption&&grid.appScope.svpN.renderedStatus[row.entity.servicePostingSeqId]==2 " class="ui-grid-cell-contents">{{(row.entity.servicePostingType==2)?"Rendered":"Planned"}}</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.svpN.editOption&& grid.appScope.svpN.renderedStatus[row.entity.servicePostingSeqId]==1" > <select class="form-control"  ng-model="row.entity.servicePostingType" name="orderType" ng-disabled="row.entity.packApplyType==4"  placeholder="select" ng-options="post.id as post.description for post in grid.appScope.svpN.servicePosting" ></select></div>',width:150},{name:"quantity",displayName:"billing.quantity",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" ng-init="row.entity.tempQty=row.entity.quantity;" style="margin-top: -4px;" numbers-only ng-required="true"  my-maxlength="6" class="form-control" ng-disabled="grid.appScope.svpN.editOption" ng-model="row.entity.quantity" ng-change="(row.entity.quantity==0)?row.entity.quantity=1:row.entity.quantity;(row.entity.quantity)?grid.appScope.svpN.changeQuantity(row.entity,false,rowRenderIndex,row.entity.serviceRate,1):\'\'"></div>',width:80},{name:"priority",displayName:"billing.servicePriority",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents"> <select class="form-control" style="margin-top: -4px;"  ng-model="row.entity.priority" ng-init="row.entity.tempPriority=row.entity.priority;" name="orderType"  ng-disabled="row.entity.serviceVo.scmMasterServBillingAttrVo.faIsBillable==2||(row.entity.isPharmacyService!=undefined&&(row.entity.isPharmacyService==\'Pharmacy Issues\'||row.entity.isPharmacyService==\'Pharmacy Retruns\'))" ng-change="row.entity.tempPriority==row.entity.priority?row.entity.updatePriorityFlag=false:row.entity.updatePriorityFlag=true;grid.appScope.svpN.changeQuantity(row.entity,false,rowRenderIndex,undefined,2)" placeholder="select" ng-options="item.DT_CODE as item.DESCRIPTION for item in grid.appScope.svpN.servicePriority"></select></div>',width:150},{name:"serviceRate",displayName:"billing.serviceAmount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"discountAmt",displayName:"billing.discount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:100},{name:"tax",displayName:"billing.tax",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate",width:100},{name:"effectiveRate",displayName:"billing.effectiveRate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:100},{name:"requestedRole",displayName:"billing.requestedRole",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents"> <select class="form-control" style="margin-top: -4px;"    ng-model="row.entity.requestedRole" name="orderType" placeholder="select" ng-options="item.DT_CODE as item.DETAIL_DESC for item in grid.appScope.svpN.roles" ng-disabled="grid.appScope.svpN.editOption" ng-change="(row.entity.requestedRole)?row.entity.requestedBy=\'{}\':\'\'"></select></div>',width:150},{name:"requestedBy",displayName:"billing.reqestBy",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents"><input class="form-control" style="width: 106px;margin-top: -4px;" ng-required="grid.appScope.svpN.requestedError" type="text"  ng-model="row.entity.requestedBy.name"  ng-disabled="true"/><span ng-if="!grid.appScope.svpN.editOption"><i class="fa fa-search" style="position: relative;top: -21px;margin-left: 104px;border: 1px solid #ffff;height: 26px;padding: 7%;margin-top: -5px;padding-top: 7px;color: #3596FF;" ng-click="grid.appScope.svpN.populateEmployee(col.colDef.name,row.entity,rowRenderIndex,1)" ></i><span></div>',width:150},{name:"requestedDate",displayName:"billing.reqstDate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents his-datepicker-main" ><input  ng-required="true" style="margin-top: -4px;" ng-disabled="grid.appScope.svpN.editOption" class="form-control" type="text"  is-open="grid.appScope.svpN.openedFrom[rowRenderIndex]" ng-change="grid.appScope.svpN.dateChange(row.entity,rowRenderIndex)" ng-focus="grid.appScope.svpN.openedFrom[rowRenderIndex]=true"  show-button-bar="false" uib-datepicker-popup="{{grid.appScope.svpN.format}}"  datepicker-options="grid.appScope.svpN.fromDateOptions"  datepicker-append-to-body=true ng-model="row.entity.requestedDate" /></div>',width:150},{name:"renderedRole",displayName:"billing.renderRole",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents"> <select class="form-control" style="margin-top: -4px;"    ng-required="grid.appScope.svpN.renderError" ng-model="row.entity.renderedRole" name="orderType" placeholder="select" ng-options="item.DT_CODE as item.DETAIL_DESC for item in grid.appScope.svpN.roles" ng-change="(row.entity.renderedRole)?row.entity.renderedBy=\'{}\':\'\'"></select></div>',width:150},{name:"renderedBy",displayName:"billing.renderBy",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" class="form-control"  style="margin-top: -4px;width: 106px"  ng-required="grid.appScope.svpN.renderError" ng-model="row.entity.renderedBy.name"  ng-disabled="true"  /><span><i class="fa fa-search" style="position: relative;top: -21px;margin-left: 104px;border: 1px solid #ffff;height: 26px;padding: 7%;margin-top: -5px;padding-top: 7px;color: #3596FF;" ng-click="grid.appScope.svpN.populateEmployee(col.colDef.name,row.entity,rowRenderIndex,1)"></i></span></div>',width:150},{name:"renderedDate",displayName:"billing.renderedDate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents his-datepicker-main" ><input  class="form-control" type="text" style="margin-top: -4px;"  is-open="grid.appScope.svpN.openedTo[rowRenderIndex]" class="form-control" ng-change="grid.appScope.svpN.dateChange(row.entity,rowRenderIndex)" ng-focus="grid.appScope.svpN.openedTo[rowRenderIndex]=true"  show-button-bar="false" uib-datepicker-popup="{{grid.appScope.svpN.format}}"  datepicker-options="grid.appScope.svpN.toDateOptions[rowRenderIndex]"  datepicker-append-to-body=true ng-model="row.entity.renderedDate" /></div>',width:150},{name:"transType",displayName:"billing.transactionType",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents"> <select class="form-control" style="margin-top: -4px;"  ng-disabled="!row.entity.renderedBy.name" ng-model="row.entity.transType" name="orderType"  placeholder="select" ng-options="item.DT_CODE as item.DETAIL_DESC for item in grid.appScope.svpN.serviceTrans" ng-change="grid.appScope.svpN.changeQuantity(row.entity,false,rowRenderIndex,row.entity.serviceRate)" ng-init="row.entity.prvtransType=row.entity.transType;"></select></div>',width:150},{name:"hospitalShare",displayName:"billing.netHospitalAmount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"doctorAmount",displayName:"billing.doctorAmount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"doctorModifiedAmount",displayName:"billing.docMdfdAmount",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents"><input style="width:50%;margin-top: -4px;" type="text" numbers-only my-maxlength="6"  class="form-control" ng-disabled="row.entity.transType!=2" ng-model="row.entity.doctorModifiedAmount"   ng-blur="(row.entity.doctorModifiedAmount)?grid.appScope.svpN.minMaxValidForDoc(row.entity)?grid.appScope.svpN.changeQuantity(row.entity,row.entity.doctorModifiedAmount,rowRenderIndex,undefined,1):\'\':\'\'"   /></div>',width:170},{name:"doctorShare",displayName:"billing.docShare",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:100},{name:"surcharge",displayName:"billing.surcharge",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"applicableTariff",displayName:"billing.applicTariff",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:150},{name:"multiDoctor",displayName:"billing.multiDoctor",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,width:100,cellTemplate:'<div class="ui-grid-cell-contents"><input type="checkbox" class="checkboxClass" ng-true-value="\'Y\'" ng-false-value="\'N\'" ng-model="row.entity.multiDoctor" ng-disabled="row.entity.doctorShare==0||row.entity.flagDoc==\'Y\'" ng-change="grid.appScope.svpN.multiSelectChange(row.entity,rowRenderIndex)" /></div>'},{name:"remarks",displayName:"billing.remarks",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,cellTemplate:'<div class="ui-grid-cell-contents"><input type="text" style="margin-top: -4px;" class="form-control" maxlength="100" ng-model="row.entity.remarks"></div>',width:200}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("servicepostingNewServiceSearchAddGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,enableHorizontalScrollbar:0,multiSelect:!0,paginationCurrentPage:1,columnDefs:[{name:"SERV_CODE",displayName:"billing.serviceCode",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate"},{name:"SERV_NAME",displayName:"billing.serviceName",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate"},{name:"VALUE",displayName:"billing.rate",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0},{name:"EFFECTIVE_FROM",displayName:"billing.effectiveFrm",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,type:"date",cellFilter:"date:'dd-MM-yyyy'"},{name:"EFFECTIVE_TO",displayName:"billing.effectTo",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,type:"date",cellFilter:"date:'dd-MM-yyyy'"},{name:"action",displayName:"billing.actions",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-click="grid.appScope.svpNM.removeData(row.entity,rowRenderIndex)" ng-style="{ \'cursor\': \'pointer\' }"><i class="fa fa-times fa-lg" aria-hidden="true"></i></span></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("servicepostingNewServiceSearchGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!0,enableFiltering:!1,enableFullRowSelection:!1,paginationPageSizes:[10,20,40,80],paginationPageSize:10,enableHorizontalScrollbar:0,multiSelect:!0,paginationCurrentPage:1,columnDefs:[{name:"SERV_CODE",displayName:"billing.serviceCode",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate"},{name:"SERV_NAME",displayName:"billing.serviceName",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate"},{name:"VALUE",displayName:"billing.rate",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate"},{name:"EFFECTIVE_FROM",displayName:"billing.effectiveFrm",enableSorting:!0,enableCellEdit:!0,headerCellFilter:"translate",type:"date",cellFilter:"date:'dd-MM-yyyy'"},{name:"EFFECTIVE_TO",displayName:"billing.effectTo",headerCellFilter:"translate",enableSorting:!0,enableCellEdit:!0,type:"date",cellFilter:"date:'dd-MM-yyyy'"}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("servicepostingServiceVariantGridDefinition",{enableSorting:!1,enableCellEditOnFocus:!1,enableFiltering:!1,enableFullRowSelection:!1,columnDefs:[{name:"code",displayName:"billing.empCode",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate"},{name:"name",displayName:"billing.doctorName",enableSorting:!0,enableCellEdit:!1,headerCellFilter:"translate"},{name:"doctorShare",displayName:"billing.docShare",headerCellFilter:"translate",enableSorting:!0,enableCellEditOnFocus:!0,enableCellEdit:!0,cellTemplate:'<div  class="ui-grid-cell-contents"><label class="labelColor" ></label><span>{{row.entity.doctorShare}}</span></div>',editableCellTemplate:'<div class="ui-grid-cell-contents" ><input ng-disabled="rowRenderIndex==0"  type="text" numbers-only  class="form-control" ng-model="row.entity.doctorShare"  ui-grid-editor "></div>',editType:"text"},{name:"action",displayName:"billing.actions",headerCellFilter:"translate",enableCellEditOnFocus:!1,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><span ng-style="{ \'cursor\': \'pointer\' }" ng-hide="rowRenderIndex==0" ng-click="grid.appScope.svpN.removeData(row.entity)"><i class="fa fa-times fa-lg" aria-hidden="true"></i></span></div>'}]})}(),function(){"use strict";function e(e,t){this.submitServicePostingNew=function(a,i){var r=[],n={};n.url=e.HISIPINDENT.URL;for(var l=0;l<a.length;l++){var s,o;null==a[l].tax&&(a[l].tax=0),null!=a[l].serviceVo&&null!=a[l].serviceVo.atomicDetailsVo&&null!=a[l].serviceVo.atomicDetailsVo.scmMasterServiceDeptSpeclVoList&&null!=a[l].serviceVo.atomicDetailsVo.scmMasterServiceDeptSpeclVoList[0]&&null!=a[l].serviceVo.atomicDetailsVo.scmMasterServiceDeptSpeclVoList[0]["com.napier.core.scm.master.vo.ServiceDepartmentSpecailityLinkVo"]&&(null!=a[l].serviceVo.atomicDetailsVo.scmMasterServiceDeptSpeclVoList[0]["com.napier.core.scm.master.vo.ServiceDepartmentSpecailityLinkVo"].departmentMaster&&(s=a[l].serviceVo.atomicDetailsVo.scmMasterServiceDeptSpeclVoList[0]["com.napier.core.scm.master.vo.ServiceDepartmentSpecailityLinkVo"].departmentMaster.code),null!=a[l].serviceVo.atomicDetailsVo.scmMasterServiceDeptSpeclVoList[0]["com.napier.core.scm.master.vo.ServiceDepartmentSpecailityLinkVo"].specialityCode&&null!=a[l].serviceVo.atomicDetailsVo.scmMasterServiceDeptSpeclVoList[0]["com.napier.core.scm.master.vo.ServiceDepartmentSpecailityLinkVo"].specialityCode[0]&&null!=a[l].serviceVo.atomicDetailsVo.scmMasterServiceDeptSpeclVoList[0]["com.napier.core.scm.master.vo.ServiceDepartmentSpecailityLinkVo"].specialityCode[0]["com.napier.core.service.vo.masters.SpecialityMaster"]&&(o=a[l].serviceVo.atomicDetailsVo.scmMasterServiceDeptSpeclVoList[0]["com.napier.core.scm.master.vo.ServiceDepartmentSpecailityLinkVo"].specialityCode[0]["com.napier.core.service.vo.masters.SpecialityMaster"].code));var c={"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",accSeqId:a[l].accSeqId,subAccSeqId:a[l].subAccSeqId,servicePostingType:a[l].servicePostingType,specific:a[l].specific,currentChargableAmt:3==a[l].transType?a[l].chargeableAmt:parseFloat(parseFloat((a[l].chargeableAmt+parseFloat(a[l].tax))/a[l].quantity).toFixed(2)),serviceVo:{"@class":"com.napier.core.scm.master.vo.ServiceVo",servSeqId:a[l].serviceVo.servSeqId},philHealthCode:a[l].serviceVo.servCode,philHealthName:a[l].serviceVo.servName,requestedByEmpSeqID:a[l].requestedBy.seqId,requestedByEmpName:a[l].requestedBy.name,requestedByEmpType:a[l].requestedRole,requestedDateTime:moment(new Date(a[l].requestedDate)).format("YYYY-MM-DD HH:mm:ss.000"),renderedByEmpSeqID:a[l].renderedBy.seqId,renderedByEmpName:a[l].renderedBy.name,renderedByEmpType:a[l].renderedRole,renderedDateTime:moment(new Date(a[l].renderedDate)).format("YYYY-MM-DD HH:mm:ss.000"),quantity:a[l].quantity,priority:a[l].priority,primaryServiceCode:a[l].serviceVo.secServTypeCode,specilityCode:o,deptCode:s,serviceRateVo:{"@class":"com.napier.core.service.vo.ratecard.ServiceRateVo",rcvSeqId:a[l].serviceRateVo.rcvSeqId,inflSeqId:a[l].serviceRateVo.inflSeqId,servSeqId:a[l].serviceRateVo.servSeqId,baseRate:a[l].serviceRateVo.baseRate,specSeqId:a[l].renderedBy.SPECIALIZATN,bedClassRateVos:[{"com.napier.core.service.vo.ratecard.BedClassRateVo":{bedClassSeqId:a[l].serviceRateVo.bedClassRateVos[0]["com.napier.core.service.vo.ratecard.BedClassRateVo"].bedClassSeqId}}],tariffSeqId:a[l].serviceRateVo.tariffSeqId,datedOn:moment(new Date).format("YYYY-MM-DD HH:mm:ss.000")},encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:a[l].encounter.enAmbultryStatus,enProvider:a[l].encounter.enProvider,enSpeciality:a[l].encounter.enSpeciality,isAddendum:a[l].encounter.isAddendum},enNo:a[l].enNo,patientCategoryCode:a[l].patientCategoryCode,facilityId:a[l].facilityId,practiceId:a[l].practiceId,gnTranStatus:1,gnFlow:a[l].gnFlow,surcharge:a[l].surcharge,serviceRate:a[l].serviceRate,baseRate:a[l].serviceRateVo.baseRate,actualRate:a[l].actualRate,technicianAmount:a[l].technicianAmount,doctorAmount:a[l].doctorAmount,proposedShareAfterDiscount:a[l].proposedShareAfterDiscount,doctorModifiedAmount:a[l].doctorModifiedAmount,chargeableAmt:3==a[l].transType?a[l].chargeableAmt:a[l].chargeableAmt+parseFloat(a[l].tax),discountAmt:a[l].discountAmt,doctorShare:a[l].doctorShare,isEmergency:a[l].isEmergency,transType:a[l].transType,remarks:a[l].remarks,renderFlagcheck:a[l].renderFlagcheck,moduleId:null!=sessionStorage.getItem("moduleId")&&null!=sessionStorage.getItem("moduleId")&&""!==sessionStorage.getItem("moduleId")?parseInt(sessionStorage.getItem("moduleId")):void 0},d=[];if(a[l].employeeShareList.length>0){for(var p=0;p<a[l].employeeShareList.length;p++)d.push({"@class":"com.napier.core.scm.serviceposting.vo.EmployeeShareVo",employee:{category:a[l].employeeShareList[p].category,code:a[l].employeeShareList[p].code,designation:a[l].employeeShareList[p].designation,empSeqId:a[l].employeeShareList[p].seqId,facilityId:a[l].facilityId,firstName:a[l].employeeShareList[p].firstName,gender:a[l].employeeShareList[p].gender,gnStatus:a[l].employeeShareList[p].gnStatus,lastName:a[l].employeeShareList[p].lastName,salutation:a[l].employeeShareList[p].salutation},entityType:4==a[l].renderedRole?2:a[l].renderedRole,billedShare:parseFloat(a[l].employeeShareList[p].doctorShare),proposedShare:angular.copy(a[l].doctorAmount),gnTranStatus:1,grpMstCode:a[l].employeeShareList[p].GRP_MST_CODE});angular.extend(c,{multiEmployeeShareList:{"@class":"com.napier.core.scm.serviceposting.vo.EmployeeShareListVo",employeeShareList:[{"com.napier.core.scm.serviceposting.vo.EmployeeShareVo":d}]}})}r.push(c)}return n.requestData={operation:"saveServicePosting",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingVo",subAccSeqId:a[0].subAccSeqId,servicePostingDetailsList:{"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo":r}}},t.sendRestRequest(n)},this.updateServicePostingNew=function(a,i){var r={};r.url=e.HISIPINDENT.URL;for(var n=[],l=0;l<a.length;l++){null==a[l].tax&&(a[l].tax=0);var s={"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",accSeqId:a[l].accSeqId,subAccSeqId:a[l].subAccSeqId,servicePostingType:a[l].servicePostingType,servicePostingSeqId:a[l].servicePostingSeqId,currentChargableAmt:3==a[l].transType?a[l].chargeableAmt:parseFloat(parseFloat((a[l].chargeableAmt+parseFloat(a[l].tax))/a[l].quantity).toFixed(2)),serviceVo:{"@class":"com.napier.core.scm.master.vo.ServiceVo",servSeqId:a[l].serviceVo.servSeqId},philHealthCode:a[l].serviceVo.servCode,philHealthName:a[l].serviceVo.servName,copayLevel:a[l].copayLevel,requestedByEmpSeqID:a[l].requestedBy.seqId,requestedByEmpName:a[l].requestedBy.name,requestedByEmpType:a[l].requestedRole,requestedDateTime:moment(new Date(a[l].requestedDate)).format("YYYY-MM-DD HH:mm:ss.000"),renderedByEmpSeqID:a[l].renderedBy.seqId?a[l].renderedBy.seqId:void 0,renderedByEmpName:a[l].renderedBy.name?a[l].renderedBy.name:void 0,renderedByEmpType:a[l].renderedRole?a[l].renderedRole:void 0,renderedDateTime:a[l].renderedDate?moment(new Date(a[l].renderedDate)).format("YYYY-MM-DD HH:mm:ss.000"):void 0,quantity:a[l].quantity,priority:a[l].priority,serviceRateVo:{"@class":"com.napier.core.service.vo.ratecard.ServiceRateVo",rcvSeqId:a[l].serviceRateVo.rcvSeqId,inflSeqId:a[l].serviceRateVo.inflSeqId,servSeqId:a[l].serviceRateVo.servSeqId,baseRate:a[l].serviceRateVo.baseRate,specSeqId:a[l].renderedBy.SPECIALIZATN,bedClassRateVos:[{"com.napier.core.service.vo.ratecard.BedClassRateVo":{bedClassSeqId:a[l].serviceRateVo.bedClassRateVos[0]["com.napier.core.service.vo.ratecard.BedClassRateVo"].bedClassSeqId}}],tariffSeqId:a[l].serviceRateVo.tariffSeqId,datedOn:moment(new Date).format("YYYY-MM-DD HH:mm:ss.000")},encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:a[l].encounter.enAmbultryStatus,enProvider:a[l].encounter.enProvider,enSpeciality:a[l].encounter.enSpeciality,isAddendum:a[l].encounter.isAddendum},enNo:a[l].enNo,patientCategoryCode:a[l].patientCategoryCode,facilityId:a[l].facilityId,practiceId:a[l].practiceId,gnTranStatus:1,gnFlow:a[l].gnFlow,surcharge:a[l].surcharge,serviceRate:a[l].serviceRate,baseRate:a[l].serviceRateVo.baseRate,actualRate:a[l].actualRate,doctorAmount:a[l].doctorAmount,technicianAmount:a[l].technicianAmount?a[l].technicianAmount:0,doctorModifiedAmount:a[l].doctorModifiedAmount,chargeableAmt:3==a[l].transType?a[l].chargeableAmt:a[l].chargeableAmt+parseFloat(a[l].tax),discountAmt:a[l].discountAmt,doctorShare:a[l].doctorShare,isEmergency:a[l].isEmergency,transType:a[l].transType,remarks:a[l].remarks,modifiedServiceName:a[l].servName,renderFlagcheck:!a[l].renderFlagcheck||a[l].renderFlagcheck,packApplyType:a[l].packApplyType,moduleId:null!=a[l].moduleId&&null!=a[l].moduleId&&""!=a[l].moduleId?a[l].moduleId:void 0};3==a[l].transType&&angular.extend(s,{proposedShareAfterDiscount:a[l].proposedShareAfterDiscount});var o=[];if(a[l].employeeShareList.length>0){for(var c=0;c<a[l].employeeShareList.length;c++)o.push({"@class":"com.napier.core.scm.serviceposting.vo.EmployeeShareVo",employee:{code:a[l].employeeShareList[c].code,empSeqId:a[l].employeeShareList[c].seqId},entityType:a[l].employeeShareList[c].entityType?a[l].employeeShareList[c].entityType:4==a[l].requestedRole?2:a[l].requestedRole,billedShare:a[l].employeeShareList[c].doctorShare,billedSurcharge:a[l].employeeShareList[c].billedSurcharge,proposedShare:angular.copy(a[l].doctorAmount),gnTranStatus:1});angular.extend(s,{multiEmployeeShareList:{"@class":"com.napier.core.scm.serviceposting.vo.EmployeeShareListVo",employeeShareList:[{"com.napier.core.scm.serviceposting.vo.EmployeeShareVo":o}]}})}n.push(s)}return r.requestData={operation:"updateServicePostingForSCM",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingVo",subAccSeqId:a[0].subAccSeqId,servicePostingDetailsList:[{"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo":n}]}},t.sendRestRequest(r)},this.rateCardService=function(a){var i={};return i.url=e.HISIPINDENT.URL,i.requestData={operation:"getServiceRate",destination:"com.napier.core.ratecard.service.external.RateCardService",message:{"@class":"com.napier.core.service.vo.ratecard.ServiceRateVo",servSeqId:a.servSeqId,bedClassRateVos:{"com.napier.core.service.vo.ratecard.BedClassRateVo":[{bedClassSeqId:a.bedClassSeqId}]},bedSeqId:a.bedClassSeqId,compSeqId:a.compSeqId?a.compSeqId:void 0,tariffSeqId:a.tariffSeqId,admissionDate:moment(a.admissionDate).format("YYYY-MM-DD HH:mm:ss.000"),rateEffectiveOption:a.effectiveOption,datedOn:moment(new Date).format("YYYY-MM-DD HH:mm:ss.000"),doctSeqId:a.doctSeqId,specSeqId:a.specSeqId}},t.sendRestRequest(i)},this.retriveServiceList=function(a){var i={};return i.url=e.HISIPINDENT.URL,i.requestData={operation:"retriveServiceList",destination:"com.napier.core.scm.master.service.external.ScmMasterService",message:{"@class":"com.napier.core.scm.master.vo.ServiceFilterVo",serviceSeqIdList:[{"java.math.BigDecimal":a}]}},t.sendRestRequest(i)},this.getMultipleServicesPostingDetails=function(a,i){var r={};return r.url=e.HISIPINDENT.URL,r.requestData={operation:"getMultipleServicesPostingDetails",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingVo",bill:i,servicePostingDetailsList:[{"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo":a}]}},t.sendRestRequest(r)},this.getDoctorSurcharge=function(a){var i={};return i.url=e.HISIPINDENT.URL,i.requestData={operation:"getDoctorAmountAndSurcharge",messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",accSeqId:a.accSeqId,subAccSeqId:a.subAccSeqId,servicePostingType:a.servicePostingType,serviceVo:{"@class":"com.napier.core.scm.master.vo.ServiceVo",servSeqId:a.serviceVo.servSeqId},renderedByEmployee:{"@class":"com.napier.core.service.vo.masters.Employee",empSeqId:_.toString(a.renderedBy.seqId),facilityId:a.facilityId,code:a.renderedBy.code,salutation:a.renderedBy.salutation,firstName:a.renderedBy.firstName,lastName:a.renderedBy.lastName,gender:a.renderedBy.gender,category:a.renderedBy.category,designation:a.renderedBy.designation,regdNo:a.renderedBy.regdNo,gnStatus:a.renderedBy.gnStatus},renderedByEmpSeqID:a.renderedBy.seqId,serviceRateVo:{"@class":"com.napier.core.service.vo.ratecard.ServiceRateVo",rcvSeqId:10008==a.serviceVo.priServTypCode?void 0:a.serviceRateVo.rcvSeqId,inflSeqId:10008==a.serviceVo.priServTypCode?void 0:a.serviceRateVo.inflSeqId,doctSeqId:10008==a.serviceVo.priServTypCode?a.renderedBy.seqId:void 0,specSeqId:10008==a.serviceVo.priServTypCode?a.renderedBy.SPECIALIZATN:void 0,servSeqId:a.serviceRateVo.servSeqId,baseRate:a.serviceRateVo.baseRate,bedClassRateVos:[{"com.napier.core.service.vo.ratecard.BedClassRateVo":{bedClassSeqId:a.serviceRateVo.bedClassRateVos[0]["com.napier.core.service.vo.ratecard.BedClassRateVo"].bedClassSeqId}}],tariffSeqId:a.serviceRateVo.tariffSeqId,datedOn:moment(new Date).format("YYYY-MM-DD HH:mm:ss.000")},encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:a.encounter.enAmbultryStatus,enProvider:a.encounter.enProvider,enSpeciality:a.encounter.enSpeciality,isAddendum:a.encounter.isAddendum},patientCategoryCode:a.patientCategoryCode,transType:a.transType,gnFlow:a.gnFlow,bedClassCode:a.serviceRateVo.bedClassRateVos[0]["com.napier.core.service.vo.ratecard.BedClassRateVo"].bedClassSeqId}},t.sendRestRequest(i)},this.quantityChangeDetails=function(a,i,r){var n={};return n.url=e.HISIPINDENT.URL,n.requestData={messageId:"",destination:"com.napier.core.scm.serviceposting.service.external.ServicePostingService",message:{"@class":"com.napier.core.scm.serviceposting.vo.ServicePostingDetailsVo",accSeqId:a.accSeqId,subAccSeqId:a.subAccSeqId,servicePostingType:a.servicePostingType,servicePostingSeqId:a.servicePostingSeqId,isRateEditable:null!=a.serviceVo&&null!=a.serviceVo.scmMasterServBillingAttrVo&&null!=a.serviceVo.scmMasterServBillingAttrVo.faIsRateEditable?a.serviceVo.scmMasterServBillingAttrVo.faIsRateEditable:void 0,serviceVo:{"@class":"com.napier.core.scm.master.vo.ServiceVo",servSeqId:a.serviceVo.servSeqId},quantity:parseInt(a.quantity),priority:a.priority,serviceRateVo:{"@class":"com.napier.core.service.vo.ratecard.ServiceRateVo",servSeqId:a.serviceRateVo.servSeqId,rcvSeqId:a.serviceRateVo.rcvSeqId,inflSeqId:a.serviceRateVo.inflSeqId,bedClassRateVos:[{"com.napier.core.service.vo.ratecard.BedClassRateVo":[{"@class":"com.napier.core.service.vo.ratecard.BedClassRateVo",bedClassSeqId:a.serviceRateVo.bedClassRateVos[0]["com.napier.core.service.vo.ratecard.BedClassRateVo"].bedClassSeqId}]}],tariffSeqId:a.serviceRateVo.tariffSeqId,datedOn:moment(new Date).format("YYYY-MM-DD HH:mm:ss.000"),doctSeqId:a.serviceRateVo.doctSeqId?a.serviceRateVo.doctSeqId:a.renderedBy.seqId,specSeqId:a.serviceRateVo.specSeqId?a.serviceRateVo.specSeqId:a.renderedBy.SPECIALIZATN},encounter:{"@class":"com.napier.core.service.vo.visitmanagement.Encounter",enAmbultryStatus:a.encounter.enAmbultryStatus,enProvider:a.encounter.enProvider,enSpeciality:a.encounter.enSpeciality,isAddendum:a.encounter.isAddendum},patientCategoryCode:a.patientCategoryCode,transType:a.transType,facilityId:a.facilityId,practiceId:a.practiceId,gnFlow:a.gnFlow,surcharge:a.surcharge,standardSurcharge:a.standardSurcharge,serviceRate:null!=a.serviceRateVo.baseRate&&""!=a.serviceRateVo.baseRate?parseFloat(a.serviceRateVo.baseRate):a.serviceRateVo.baseRate,actualRate:a.actualRate,doctorAmount:a.doctorAmount,proposedShareAfterDiscount:a.proposedShareAfterDiscount,standardDoctorShare:2==a.transType?a.standardDoctorShare:void 0,doctorModifiedAmount:a.doctorModifiedAmount,discountAmt:a.discountAmt,bedClassCode:a.serviceRateVo.bedClassRateVos[0]["com.napier.core.service.vo.ratecard.BedClassRateVo"].bedClassSeqId,chargeableAmt:a.chargeableAmt,isEmergency:a.isEmergency,taxAmt:a.tax,isServiceRateEditable:r}},2==a.transType?(angular.extend(n.requestData,{operation:"recalculateServiceRateForNegotiable"}),angular.extend(n.requestData.message,{previousQty:null!=a.tempQty&&null!=a.tempQty&&""!==a.tempQty?parseInt(a.tempQty):a.quantity})):1==a.transType?angular.extend(n.requestData,{operation:"recalculateServiceRateForStandard"}):3==a.transType&&angular.extend(n.requestData,{operation:"recalculateServiceRateForNocharge"}),a.renderedBy&&a.renderedBy.seqId&&(i?angular.extend(n.requestData.message,{renderedByEmployee:{"@class":"com.napier.core.service.vo.masters.Employee",empSeqId:_.toString(a.renderedBy.seqId)},renderedByEmpSeqID:a.renderedBy.seqId}):angular.extend(n.requestData.message,{renderedByEmployee:{"@class":"com.napier.core.service.vo.masters.Employee",empSeqId:_.toString(a.renderedBy.seqId),facilityId:a.facilityId,code:a.renderedBy.code,salutation:a.renderedBy.salutation,firstName:a.renderedBy.firstName,lastName:a.renderedBy.lastName,gender:a.renderedBy.gender,category:a.renderedBy.category,designation:a.renderedBy.designation,regdNo:a.renderedBy.regdNo,gnStatus:a.renderedBy.gnStatus},renderedByEmpSeqID:a.renderedBy.seqId})),a.renderedRole&&!i&&angular.extend(n.requestData.message,{renderedByEmpType:a.renderedRole}),t.sendRestRequest(n)}}e.$inject=["IPINDENTAPIS","CallManager"],angular.module("napierContainerUi").service("servicePostingNewService",e)}(),function(){"use strict";angular.module("napierContainerUi").constant("tariffCategoryGridOptions",{enableRowHeaderSelection:!1,enableHorizontalScrollbar:0,multiSelect:!1,showGridFooter:!1,columnDefs:[{field:"facilityDesc",displayName:"billing.facility",headerCellFilter:"translate",headerCellClass:"noborderHeader"},{field:"name",displayName:"billing.name",headerCellFilter:"translate",headerCellClass:"noborderHeader"},{field:"gnStatusDesc",displayName:"billing.descrption",headerCellFilter:"translate",headerCellClass:"noborderHeader"},{field:"gnStatus",displayName:"billing.actions",headerCellFilter:"translate",width:"20%",height:"15%",headerCellClass:"noborderHeader",cellTemplate:'<div class="ui-grid-cell-contents action-row"><i class="fa fa-pencil" ng-click="row.entity.gnStatus==1&&grid.appScope.editrow(row.entity,rowRenderIndex)" ng-if="grid.appScope.roleTask.T_BL_M_TARIFF_CATEGORY_U!=undefined"></i><md-switch ng-click="" ng-true-value="1" ng-false-value="2" ng-model="row.entity.gnStatus" ng-change="grid.appScope.activeCorpClick(row.entity,rowRenderIndex)" class=" md-primary actionSwitch" aria-label="Switch 1" style="display:initial;" ng-if="grid.appScope.roleTask.T_BL_M_TARIFF_CATEGORY_ACTV!=undefined">{{(row.entity.gnStatus==1)?"Active":"Inactive"}}</md-switch></div>'},{field:"code",visible:!1},{field:"tarfaclnkSeqId",visible:!1}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("billingTariffCategoryCreateQuery",{operation:"saveTariffCategory",messageId:"",destination:"com.napier.core.scm.master.service.external.ScmMasterService",message:{"@class":"com.napier.core.scm.master.vo.TariffCategoryVo"}})}(),function(){"use strict";angular.module("napierContainerUi").constant("billingTariffCategoryCreateQuery",{operation:"saveTariffCategory",messageId:"",destination:"com.napier.core.scm.master.service.external.ScmMasterService",message:{"@class":"com.napier.core.scm.master.vo.TariffCategoryVo"}})}(),function(){"use strict";angular.module("napierContainerUi").constant("billingTariffCategoryUpdateQuery",{operation:"saveTariffCategory",messageId:"",destination:"com.napier.core.scm.master.service.external.ScmMasterService",message:{"@class":"com.napier.core.scm.master.vo.TariffCategoryVo"}})}(),function(){"use strict";angular.module("napierContainerUi").constant("IPGrid",{enableRowHeaderSelection:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,multiSelect:!1,showGridFooter:!0,columnDefs:[{field:"DEPARTMENTCODE",displayName:"Department Code",visible:!1},{field:"SERV_SEQ_ID",displayName:"Sequence Id",visible:!1},{field:"DEPARTMENTDESCRIPTION",displayName:"Department"},{field:"SERV_MAP_SEQ_ID",displayName:"Service Map Id",visible:!1},{field:"SUBDEPARTMENTCODE",displayName:"Sub-Department Id",visible:!1},{field:"SUBDEPARTMENTDESCRIPTION",displayName:"Sub-Department"},{field:"SERVICECODE",displayName:"Service Code"},{field:"SERVICENAME",displayName:"Service Name"},{field:"GN_STATUS",displayName:"gnStatus",visible:!1},{field:"Action",displayName:"Actions",width:"20%",height:"15%",cellEditableCondition:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row"><md-switch ng-click="" ng-true-value="1" ng-false-value="2" ng-model="row.entity.GN_STATUS" ng-change="grid.appScope.serviceMappingChangeStatus()" class=" md-primary actionSwitch" aria-label="Switch 1" style="display:initial;">{{(row.entity.GN_STATUS==1)?"Active":"Inactive"}}</md-switch></div>'}]})}(),function(){"use strict";angular.module("napierContainerUi").constant("tariffClassGrid",{enableRowHeaderSelection:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,multiSelect:!1,columnDefs:[{field:"facilityName",displayName:"billing.facility",headerCellFilter:"translate"},{field:"bedClassSeqId",displayName:"billing.tariffclasscode",headerCellFilter:"translate"},{field:"bedClassDesc",displayName:"billing.tariffclassname",headerCellFilter:"translate"},{field:"shortName",displayName:"billing.alias.name",headerCellFilter:"translate"},{field:"encounterType",displayName:"billing.type",headerCellFilter:"translate",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-if="row.entity.encounterType == 1">OP</span><span ng-if="row.entity.encounterType == 3">Emergency</span><span ng-if="row.entity.encounterType == 17">IP</span></div>'},{field:"billLevelDiscount",displayName:"billD",visible:!1},{field:"serviceDiscount",displayName:"serviceD",visible:!1},{field:"isSrCitizenAppclb",displayName:"seniorD",visible:!1},{field:"isNegotiable",displayName:"negotiable",visible:!1},{field:"remarks",displayName:"remarks",visible:!1},{field:"isPharmacyMrpOrCost",displayName:"PharmacyMrpOrCost",visible:!1},{field:"intrimDnForIcuBed",displayName:"ICU",visible:!1},{field:"gnStatus",displayName:"billing.actions",headerCellFilter:"translate",width:"20%",height:"15%",cellEditableCondition:!1,cellTemplate:'<div class="ui-grid-cell-contents action-row" style=""><i class="fa fa-pencil" ng-click="row.entity.gnStatus==1&&grid.appScope.editrow(row.entity,rowRenderIndex)" ng-if="grid.appScope.roleTask.T_BL_M_TARIFF_CLASS_U!=undefined"><md-switch ng-click="" ng-true-value="1" ng-false-value="2" ng-model="row.entity.gnStatus" ng-change="grid.appScope.activeCorpClick(row.entity,rowRenderIndex)" class=" md-primary actionSwitch" aria-label="Switch 1" style="display:initial;" ng-if="grid.appScope.roleTask.T_BL_M_TARIFF_CLASS_ACTV!=undefined">{{(row.entity.gnStatus==1)?"Active":"Inactive"}}</md-switch></div>'}]})}();